[{"categories":["å·¥å…·"],"content":"è´´ä¸€ä¸‹å¯ä»¥ç©çš„shortcodeã€‚ ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:0:0","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"éŸ³ä¹æ’­æ”¾ ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:1:0","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"æ’­æ”¾åˆ—è¡¨ å¤æ—¥å£è¢‹ä¸“è¾‘ï¼š ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:1:1","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"æ’­æ”¾å•æ›² æœ€çˆ±çš„ä¸€é¦–ï¼ˆæˆ‘æ˜¯ç´¬å¨ï¼‰ï¼š ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:1:2","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"è§†é¢‘æ’­æ”¾ ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:2:0","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"bilibili æœ‰å¤šPå¯ä»¥é€‰æ‹©é›†æ•° ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:2:1","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"admonition ç±»å‹æœ‰ï¼šnoteã€abstractã€infoã€tipã€successã€questionã€warningã€failureã€dangerã€bugã€exampleã€quoteã€‚ æŠ€å·§ ä¸€ä¸ª æŠ€å·§ æ¨ªå¹… ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:3:0","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["å·¥å…·"],"content":"mapbox ","date":"2023-03-07","objectID":"/shortcode%E7%BD%AE%E9%A1%B6/:4:0","tags":["å·¥å…·"],"title":"shortcode(ç½®é¡¶)","uri":"/shortcode%E7%BD%AE%E9%A1%B6/"},{"categories":["model","LLM"],"content":"------------------------------------------------------------------------------------------------------ # Qwen-1 + Embedding and output projection. (Untied embedding for input embedding and output projection) + ROPE + QKV bias required + Pre-Norm \u0026 RMSNorm + SwiGLU ------------------------------------------------------------------------------------------------------ # Qwen-2 - Multi-Head Attention + MoE + Grouped Query Attention + Dual Chunk Attention + YARN + Expert Granularity + Expert Routing + Expert Initialization + Shared Experts ------------------------------------------------------------------------------------------------------ # Qwen-2.5 + More control tokens. 3 -\u003e 22 ------------------------------------------------------------------------------------------------------ # Qwen-3 - QKV bias - Shared experts + QK-Norm ------------------------------------------------------------------------------------------------------ ","date":"2025-08-08","objectID":"/qwen/:0:0","tags":["LLM","model"],"title":"qwen","uri":"/qwen/"},{"categories":["model","LLM"],"content":"å‚è€ƒ Qwen å„ç‰ˆæœ¬ä¸»è¦ç»“æ„å˜åŒ– ","date":"2025-08-08","objectID":"/qwen/:1:0","tags":["LLM","model"],"title":"qwen","uri":"/qwen/"},{"categories":["reasoning","LLM"],"content":"æœ€è¿‘æ¶Œç°äº†å¾ˆå¤šå…³äºä¿¡ç”¨åˆ†é…çš„è®ºæ–‡ï¼Œå› æ­¤æ•´ç†ä¸€ä¸‹ ","date":"2025-08-05","objectID":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/:0:0","tags":["LLM","reasoning"],"title":"ä¿¡ç”¨åˆ†é…","uri":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/"},{"categories":["reasoning","LLM"],"content":"First Return, Entropy-Eliciting Explore Good Learners Think Their Thinkingï¼šGenerative PRM Makes Large Reasoning Model More Efficient Math Learne ","date":"2025-08-05","objectID":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/:1:0","tags":["LLM","reasoning"],"title":"ä¿¡ç”¨åˆ†é…","uri":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/"},{"categories":["reasoning","LLM"],"content":"Group Sequence Policy Optimization ","date":"2025-08-05","objectID":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/:2:0","tags":["LLM","reasoning"],"title":"ä¿¡ç”¨åˆ†é…","uri":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/"},{"categories":["reasoning","LLM"],"content":"PROCESS REINFORCEMENT THROUGH IMPLICIT REWARDS RLVMRï¼šReinforcement Learning with Verifiable Meta-Reasoning Rewards for Robust Long-Horizon Agents VAPOï¼šEfficient and Reliable Reinforcement Learning for Advanced Reasoning Tasks ","date":"2025-08-05","objectID":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/:3:0","tags":["LLM","reasoning"],"title":"ä¿¡ç”¨åˆ†é…","uri":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/"},{"categories":["reasoning","LLM"],"content":"Group-in-Group Policy Optimization for LLM Agent Training CAPOï¼šTowards Enhancing LLM Reasoning through Verifiable Generative Credit Assignment Beyond Policy Optimizationï¼šA Data Curation Flywheel for Sparse-Reward Long-Horizon Planning GTPO and GRPO-Sï¼šToken and Sequence-Level Reward Shaping with Policy Entropy GTPOï¼šTrajectory-Based Policy Optimization in Large Language Models ","date":"2025-08-05","objectID":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/:4:0","tags":["LLM","reasoning"],"title":"ä¿¡ç”¨åˆ†é…","uri":"/%E4%BF%A1%E7%94%A8%E5%88%86%E9%85%8D/"},{"categories":["model","LLM"],"content":"é¢„è®­ç»ƒ ","date":"2025-07-30","objectID":"/k2/:1:0","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"Muon-clip è¯¦è§Muon é€šè¿‡è£å‰ªæƒé‡è§£å†³Max-Logité—®é¢˜ï¼Œå®ç°ç¨³å®šè®­ç»ƒã€‚ ","date":"2025-07-30","objectID":"/k2/:1:1","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"æ•°æ®å¢å¼º é€šè¿‡æ”¹å†™å¥å­æ¥æé«˜tokenæ•ˆç‡ï¼Œé¿å…é‡å¤ä½¿ç”¨tokené€ æˆçš„è¿‡æ‹Ÿåˆï¼Œæ”¹å†™æ–¹æ³•å¦‚ä¸‹ï¼š å¤šæ ·åŒ–é£æ ¼å’Œè§†è§’çš„æç¤ºè¯ï¼šä¸ºåœ¨ä¿æŒäº‹å®å®Œæ•´æ€§çš„åŒæ—¶å¢å¼ºè¯­è¨€å¤šæ ·æ€§ï¼Œç ”ç©¶å›¢é˜Ÿåº”ç”¨äº†ä¸€ç³»åˆ—ç²¾å¿ƒæ„å»ºçš„æç¤ºè¯ã€‚è¿™äº›æç¤ºè¯å¼•å¯¼å¤§è¯­è¨€æ¨¡å‹ä»ä¸åŒé£æ ¼å’Œè§†è§’ç”ŸæˆåŸå§‹æ–‡æœ¬çš„å¿ å®æ”¹å†™ç‰ˆæœ¬ã€‚ åˆ†å—å¼è‡ªå›å½’ç”Ÿæˆï¼šä¸ºä¿æŒå…¨å±€è¿è´¯æ€§å¹¶é¿å…é•¿æ–‡æ¡£ä¿¡æ¯ä¸¢å¤±ï¼Œç ”ç©¶å›¢é˜Ÿé‡‡ç”¨äº†åŸºäºåˆ†å—çš„è‡ªå›å½’é‡å†™ç­–ç•¥ã€‚æ–‡æœ¬è¢«åˆ’åˆ†ä¸ºè‹¥å¹²æ®µè½ï¼Œåˆ†åˆ«è¿›è¡Œæ”¹å†™ï¼Œç„¶åé‡æ–°ç»„åˆå½¢æˆå®Œæ•´æ–‡ç« ã€‚è¿™ç§æ–¹æ³•ç¼“è§£äº†å¤§è¯­è¨€æ¨¡å‹é€šå¸¸å­˜åœ¨çš„éšå¼è¾“å‡ºé•¿åº¦é™åˆ¶é—®é¢˜ï¼Œå¦‚å›¾4æ‰€ç¤ºã€‚ ä¿çœŸåº¦éªŒè¯ï¼šä¸ºç¡®ä¿åŸå§‹å†…å®¹ä¸æ”¹å†™å†…å®¹çš„ä¸€è‡´æ€§ï¼Œç ”ç©¶å›¢é˜Ÿæ‰§è¡Œä¿çœŸåº¦æ£€æŸ¥ï¼Œæ¯”è¾ƒæ¯ä¸ªæ”¹å†™æ®µè½ä¸åŸæ–‡çš„è¯­ä¹‰å¯¹é½ç¨‹åº¦ã€‚è¿™ä½œä¸ºè®­ç»ƒå‰çš„åˆæ­¥è´¨é‡æ§åˆ¶ç¯èŠ‚ã€‚ ","date":"2025-07-30","objectID":"/k2/:1:2","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"æ¨¡å‹æ¶æ„ k2é€šè¿‡å®éªŒå‘ç°äº†ç¨€ç–æ€§æ‰©å±•æ³•åˆ™ï¼ˆç¨€ç–æ€§å®šä¹‰ä¸ºä¸“å®¶æ€»æ•°ä¸æ¿€æ´»ä¸“å®¶æ•°é‡çš„æ¯”å€¼ï¼‰ã€‚ ä»¥åŠæ³¨æ„åŠ›å¤´çš„æ•°é‡å¤šåªèƒ½æå‡å°‘é‡æ€§èƒ½ï¼Œä½†å¸¦æ¥äº†å¤§é‡çš„è®¡ç®—é‡ã€‚ ","date":"2025-07-30","objectID":"/k2/:1:3","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"infra åˆ†ä¸ºå¹¶è¡ŒåŒ–ç­–ç•¥å’Œæ¿€æ´»å€¼å‹ç¼© å¹¶è¡ŒåŒ–ç­–ç•¥ï¼šEPé€šä¿¡ä¸äº¤é”™1F1Bçš„é‡å ä¸æ›´å°çš„EPè§„æ¨¡ æ¿€æ´»å€¼å‹ç¼©ï¼š é€‰æ‹©æ€§é‡è®¡ç®—Â å¯¹è®¡ç®—æˆæœ¬ä½ä½†å†…å­˜å ç”¨é«˜çš„æ“ä½œè¿›è¡Œé‡è®¡ç®—ï¼ŒåŒ…æ‹¬LayerNormã€SwiGLUå’ŒMLAä¸ŠæŠ•å½±ã€‚æ­¤å¤–ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­è¿˜å¯¹MoEä¸‹æŠ•å½±è¿›è¡Œé‡è®¡ç®—ä»¥è¿›ä¸€æ­¥é™ä½æ¿€æ´»å€¼å†…å­˜éœ€æ±‚ã€‚è™½ç„¶è¿™ç§é‡è®¡ç®—æ˜¯å¯é€‰çš„ï¼Œä½†å®ƒèƒ½å¤Ÿç»´æŒå……è¶³çš„GPUå†…å­˜ï¼Œé˜²æ­¢æ—©æœŸè®­ç»ƒé˜¶æ®µå› ä¸“å®¶è´Ÿè½½ä¸å‡è¡¡å¯¼è‡´çš„ç³»ç»Ÿå´©æºƒã€‚ ä¸æ•æ„Ÿæ¿€æ´»å€¼çš„FP8å­˜å‚¨Â å°†MoEä¸ŠæŠ•å½±å’ŒSwiGLUçš„è¾“å…¥å‹ç¼©ä¸º1Ã—128æ•°æ®å—ä¸­çš„FP8-E4M3æ ¼å¼ï¼Œé…åˆFP32ç¼©æ”¾å› å­ã€‚å°è§„æ¨¡å®éªŒè¡¨æ˜è¿™ç§å‹ç¼©ä¸ä¼šå¯¼è‡´å¯æµ‹é‡çš„æŸå¤±å¢åŠ ã€‚ç”±äºåˆæ­¥ç ”ç©¶ä¸­è§‚å¯Ÿåˆ°æ½œåœ¨çš„æ€§èƒ½ä¸‹é™é£é™©ï¼Œç ”ç©¶å›¢é˜Ÿæœªåœ¨è®¡ç®—è¿‡ç¨‹ä¸­é‡‡ç”¨FP8æ ¼å¼ã€‚ æ¿€æ´»å€¼CPUå¸è½½Â å°†æ‰€æœ‰å‰©ä½™æ¿€æ´»å€¼å¸è½½è‡³CPUå†…å­˜ã€‚æ•°æ®ä¼ è¾“å¼•æ“è´Ÿè´£æµå¼å¸è½½å’ŒåŠ è½½ï¼Œä¸è®¡ç®—å’Œé€šä¿¡æ ¸å¿ƒå®ç°é‡å å¤„ç†ã€‚åœ¨1F1Bé˜¶æ®µï¼Œç³»ç»Ÿåœ¨é¢„å–ä¸‹ä¸€ä¸ªå¾®æ‰¹æ¬¡çš„åå‘æ¿€æ´»å€¼çš„åŒæ—¶å¸è½½å‰ä¸€ä¸ªå¾®æ‰¹æ¬¡çš„å‰å‘æ¿€æ´»å€¼ã€‚ ","date":"2025-07-30","objectID":"/k2/:1:4","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"Post-training ","date":"2025-07-30","objectID":"/k2/:2:0","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"å·¥å…·èƒ½åŠ›å¢å¼º åˆæˆäº†å¤§é‡å·¥å…·æ¥è¿›è¡Œå¾®è°ƒã€‚ - å·¥å…·è§„èŒƒç”Ÿæˆï¼šé¦–å…ˆä»ç°å®ä¸–ç•Œå·¥å…·å’ŒLLMåˆæˆå·¥å…·ä¸­æ„å»ºå¤§å‹å·¥å…·è§„èŒƒåº“ - æ™ºèƒ½ä½“å’Œä»»åŠ¡ç”Ÿæˆï¼šé’ˆå¯¹ä»å·¥å…·åº“ä¸­é‡‡æ ·çš„æ¯ä¸ªå·¥å…·é›†ï¼Œç”Ÿæˆä½¿ç”¨è¯¥å·¥å…·é›†çš„æ™ºèƒ½ä½“å’Œç›¸åº”ä»»åŠ¡ - è½¨è¿¹ç”Ÿæˆï¼šä¸ºæ¯ä¸ªæ™ºèƒ½ä½“å’Œä»»åŠ¡ç”Ÿæˆæ™ºèƒ½ä½“é€šè¿‡å·¥å…·è°ƒç”¨å®Œæˆä»»åŠ¡çš„è½¨è¿¹ image.png æ™ºèƒ½ä½“çš„å¤šæ ·åŒ–Â å›¢é˜Ÿé€šè¿‡åˆæˆå„ç§ç³»ç»Ÿæç¤ºè¯å¹¶ä¸ºå…¶é…å¤‡æ¥è‡ªèµ„æºåº“çš„ä¸åŒå·¥å…·ç»„åˆï¼Œç”Ÿæˆäº†æ•°åƒä¸ªä¸åŒçš„æ™ºèƒ½ä½“ã€‚è¿™åˆ›å»ºäº†å…·æœ‰ä¸åŒèƒ½åŠ›ã€ä¸“ä¸šé¢†åŸŸå’Œè¡Œä¸ºæ¨¡å¼çš„å¤šæ ·åŒ–æ™ºèƒ½ä½“ç¾¤ä½“ï¼Œç¡®ä¿äº†æ½œåœ¨ç”¨ä¾‹çš„å¹¿æ³›è¦†ç›–ã€‚ åŸºäºè¯„ä»·æ ‡å‡†çš„ä»»åŠ¡ç”ŸæˆÂ é’ˆå¯¹æ¯ä¸ªæ™ºèƒ½ä½“é…ç½®ï¼Œå›¢é˜Ÿç”Ÿæˆä»ç®€å•åˆ°å¤æ‚çš„å„ç§æ“ä½œä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éƒ½é…å¤‡æ˜ç¡®çš„è¯„ä»·æ ‡å‡†ï¼Œè§„å®šæˆåŠŸæ ‡å‡†ã€æœŸæœ›çš„å·¥å…·ä½¿ç”¨æ¨¡å¼å’Œè¯„ä¼°æ£€æŸ¥ç‚¹ã€‚è¿™ç§åŸºäºè¯„ä»·æ ‡å‡†çš„æ–¹æ³•ç¡®ä¿äº†æ™ºèƒ½ä½“æ€§èƒ½è¯„ä¼°çš„ä¸€è‡´æ€§å’Œå®¢è§‚æ€§ã€‚ å¤šè½®è½¨è¿¹ç”ŸæˆÂ å›¢é˜Ÿé€šè¿‡ä»¥ä¸‹ç»„ä»¶æ¨¡æ‹ŸçœŸå®çš„å·¥å…·ä½¿ç”¨åœºæ™¯ï¼š ç”¨æˆ·æ¨¡æ‹Ÿï¼šLLMç”Ÿæˆå…·æœ‰ä¸åŒæ²Ÿé€šé£æ ¼å’Œåå¥½çš„ç”¨æˆ·è§’è‰²ï¼Œä¸æ™ºèƒ½ä½“è¿›è¡Œå¤šè½®å¯¹è¯ï¼Œåˆ›å»ºè‡ªç„¶çš„äº¤äº’æ¨¡å¼ã€‚ å·¥å…·æ‰§è¡Œç¯å¢ƒï¼šå¤æ‚çš„å·¥å…·æ¨¡æ‹Ÿå™¨ï¼ˆåŠŸèƒ½ç­‰åŒäºä¸–ç•Œæ¨¡å‹ï¼‰æ‰§è¡Œå·¥å…·è°ƒç”¨å¹¶æä¾›çœŸå®åé¦ˆã€‚æ¨¡æ‹Ÿå™¨åœ¨æ¯æ¬¡å·¥å…·æ‰§è¡Œåç»´æŠ¤å’Œæ›´æ–°çŠ¶æ€ï¼Œæ”¯æŒå…·æœ‰æŒç»­æ•ˆæœçš„å¤æ‚å¤šæ­¥äº¤äº’ã€‚å®ƒå¼•å…¥å—æ§éšæœºæ€§ï¼Œäº§ç”ŸåŒ…æ‹¬æˆåŠŸã€éƒ¨åˆ†å¤±è´¥å’Œè¾¹ç¼˜æƒ…å†µåœ¨å†…çš„å„ç§ç»“æœã€‚ è´¨é‡è¯„ä¼°å’Œç­›é€‰Â åŸºäºLLMçš„è¯„åˆ¤è€…æ ¹æ®ä»»åŠ¡è¯„ä»·æ ‡å‡†è¯„ä¼°æ¯ä¸ªè½¨è¿¹ã€‚åªæœ‰æ»¡è¶³æˆåŠŸæ ‡å‡†çš„è½¨è¿¹è¢«ä¿ç•™ç”¨äºè®­ç»ƒï¼Œç¡®ä¿æ•°æ®è´¨é‡çš„åŒæ—¶å…è®¸ä»»åŠ¡å®Œæˆç­–ç•¥çš„è‡ªç„¶å˜åŒ–ã€‚ ä¸çœŸå®æ‰§è¡Œç¯å¢ƒçš„æ··åˆæ–¹æ³•Â è™½ç„¶æ¨¡æ‹Ÿæä¾›äº†å¯æ‰©å±•æ€§ï¼Œä½†å›¢é˜Ÿè®¤è¯†åˆ°æ¨¡æ‹Ÿä¿çœŸåº¦çš„å›ºæœ‰å±€é™æ€§ã€‚ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼Œå›¢é˜Ÿåœ¨çœŸå®æ€§è‡³å…³é‡è¦çš„åœºæ™¯ï¼ˆç‰¹åˆ«æ˜¯ç¼–ç¨‹å’Œè½¯ä»¶å·¥ç¨‹ä»»åŠ¡ï¼‰ä¸­ï¼Œä½¿ç”¨çœŸå®æ‰§è¡Œæ²™ç›’æ¥è¡¥å……æ¨¡æ‹Ÿç¯å¢ƒã€‚è¿™äº›çœŸå®æ²™ç›’æ‰§è¡Œå®é™…ä»£ç ï¼Œä¸çœŸæ­£çš„å¼€å‘ç¯å¢ƒäº¤äº’ï¼Œå¹¶é€šè¿‡æµ‹è¯•å¥—ä»¶é€šè¿‡ç‡ç­‰å®¢è§‚æŒ‡æ ‡æä¾›çœŸå®åé¦ˆã€‚è¿™ç§ç»„åˆç¡®ä¿æ¨¡å‹èƒ½å¤Ÿä»æ¨¡æ‹Ÿåœºæ™¯çš„å¤šæ ·æ€§å’ŒçœŸå®æ‰§è¡Œçš„å‡†ç¡®æ€§ä¸­å­¦ä¹ ï¼Œæ˜¾è‘—å¢å¼ºå®é™…æ™ºèƒ½ä½“èƒ½åŠ›ã€‚ ","date":"2025-07-30","objectID":"/k2/:2:1","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["model","LLM"],"content":"å‚è€ƒ [2507.20534] Kimi K2: Open Agentic Intelligence https://zhuanlan.zhihu.com/p/1933619657589384402 ","date":"2025-07-30","objectID":"/k2/:3:0","tags":["LLM","model"],"title":"K2","uri":"/k2/"},{"categories":["basic","LLM"],"content":"åœ¨softmaxçš„ç»“æœåæ·»åŠ ä¸€ä¸ªé™æ€çš„ä¸å¯å­¦ä¹ çš„åç½®é¡¹ã€‚ q1å’Œk1ä¹‹é—´çš„è·ç¦»æ˜¯0ï¼Œæ‰€ä»¥å¯¹åº”ä½ç½®å°±æ˜¯0 q2å’Œk1ä¹‹é—´çš„è·ç¦»æ˜¯ã€Œç›¸å¯¹ä½ç½®åç§»ä¸ºâ€œkçš„ç´¢å¼•â€1ã€ - ã€Œqçš„ç´¢å¼•2ã€ï¼Œå¾—åˆ°1-2 = -1ï¼Œå°±å¯¹åº”åˆ°äº†ä¸­é—´çŸ©é˜µçš„å–å€¼ä¸º-1äº† ä»¥æ­¤ç±»æ¨ï¼Œç›¸å¯¹è·ç¦»çŸ©é˜µçš„ä¸­é—´å¯¹è§’çº¿ä¸Šéƒ½æ˜¯0ï¼Œç„¶åå·¦ä¸‹è§’çš„å–å€¼éƒ½æ˜¯å¯¹åº”çš„ã€Œkçš„ç´¢å¼•ã€-ã€Œqçš„ç´¢å¼•ã€äº† ","date":"2025-07-29","objectID":"/alibi/:0:0","tags":["LLM","basic"],"title":"ALiBi","uri":"/alibi/"},{"categories":["model","LLM"],"content":"Gemma 3 ","date":"2025-07-29","objectID":"/gemma/:1:0","tags":["LLM","model"],"title":"Gemma","uri":"/gemma/"},{"categories":["model","LLM"],"content":"QK-Norm ç®€å•æ¥è¯´å°±æ˜¯åœ¨Qå’ŒKçŸ©é˜µä¸Šè¿›è¡ŒRMSNormï¼Œå³ï¼š \\[ \\begin{aligned} O \u0026= softmax(\\bar{Q}\\bar{K}^T)V \\\\ \\bar{Q} \u0026=RMSNorm(Q) \\\\ \\bar{K} \u0026=RMSNorm(V) \\end{aligned}\\ \\] ä½†è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ä¸é€‚ç”¨MLAçš„æ¨ç†é˜¶æ®µï¼Œå› ä¸ºæ¨ç†é˜¶æ®µçš„MLAå°†Wkå¸å–åˆ°äº†Qä¸­ï¼Œå…·ä½“è§MLA ","date":"2025-07-29","objectID":"/gemma/:1:1","tags":["LLM","model"],"title":"Gemma","uri":"/gemma/"},{"categories":["verl","coding"],"content":"è¯¦ç»†è®²è§£ä¸€ä¸‹verlä¸­çš„RLHFDatasetï¼Œå®ƒç»§æ‰¿è‡ªtorchçš„Datasetï¼Œéœ€è¦å®ç°__getitem__æ¥è¿”å›æ•°æ®ã€‚ ","date":"2025-07-26","objectID":"/dataset/:0:0","tags":["coding","verl"],"title":"Dataset","uri":"/dataset/"},{"categories":["verl","coding"],"content":"åˆå§‹åŒ– class RLHFDataset(Dataset): \"\"\" Load and preprocess RLHF data from Parquet files. - Caches files locally. - Reads into a HuggingFace Dataset and tokenizes prompts. - Optionally handles images/videos via a ProcessorMixin. - Filters prompts over a max length. - Supports resuming from checkpoints. Args: data_files (str or list): Path(s) to Parquet file(s). tokenizer (PreTrainedTokenizer): For the tokenization of text to token IDs. config (DictConfig): Options like cache_dir, prompt_key, max_prompt_length, truncation, etc. processor (ProcessorMixin, optional): Multimodal preprocessor for images/videos. \"\"\" def __init__( self, data_files: str | list[str], tokenizer: PreTrainedTokenizer, config: DictConfig, processor: Optional[ProcessorMixin] = None, ): if not isinstance(data_files, list | ListConfig): data_files = [data_files] self.data_files = copy.deepcopy(data_files) self.original_data_files = copy.deepcopy(data_files) # use for resume self.tokenizer = tokenizer self.processor = processor self.config = config self.cache_dir = os.path.expanduser(config.get(\"cache_dir\", \"~/.cache/verl/rlhf\")) self.prompt_key = config.get(\"prompt_key\", \"prompt\") self.image_key = config.get(\"image_key\", \"images\") self.video_key = config.get(\"video_key\", \"videos\") self.max_prompt_length = config.get(\"max_prompt_length\", 1024) self.return_raw_chat = config.get(\"return_raw_chat\", False) self.return_full_prompt = config.get(\"return_full_prompt\", False) self.truncation = config.get(\"truncation\", \"error\") self.filter_overlong_prompts = config.get(\"filter_overlong_prompts\", True) self.num_workers = config.get(\"filter_overlong_prompts_workers\", max(1, os.cpu_count() // 4)) self.num_workers = min(self.num_workers, os.cpu_count()) self.use_shm = config.get(\"use_shm\", False) self.chat_template_func = config.get(\"chat_template_func\", None) self.need_tools_kwargs = config.get(\"need_tools_kwargs\", False) self.filter_prompts = config.get(\"filter_prompts\", True) self.serialize_dataset = False self.return_multi_modal_inputs = config.get(\"return_multi_modal_inputs\", True) self._download() self._read_files_and_tokenize() ï¼ˆæ¥è‡ªdeepwikiï¼‰ downloadæ–¹æ³•å°±æ˜¯æŠŠhdfsæ–‡ä»¶æˆ–è€…æœ¬åœ°æ–‡ä»¶ç¼“å­˜åˆ°ç¼“å­˜è·¯å¾„ä¸‹ã€‚ æ¥ä¸‹æ¥é‡ç‚¹çœ‹ä¸€ä¸‹read_files_and_tokenizeæ–¹æ³•ï¼š def _read_files_and_tokenize(self): dataframes = [] for parquet_file in self.data_files: # read parquet files and cache dataframe = datasets.load_dataset(\"parquet\", data_files=parquet_file)[\"train\"] dataframes.append(dataframe) self.dataframe: datasets.Dataset = datasets.concatenate_datasets(dataframes) print(f\"dataset len: {len(self.dataframe)}\") self.dataframe = self.maybe_filter_out_long_prompts(self.dataframe) def maybe_filter_out_long_prompts(self, dataframe: datasets.Dataset = None): # filter out too long prompts if self.filter_overlong_prompts: tokenizer = self.tokenizer processor = self.processor prompt_key = self.prompt_key image_key = self.image_key video_key = self.video_key if processor is not None: from verl.utils.dataset.vision_utils import process_image, process_video def doc2len(doc) -\u003e int: messages = self._build_messages(doc) raw_prompt = self.processor.apply_chat_template( messages, add_generation_prompt=True, tokenize=False ) images = [process_image(image) for image in doc[image_key]] if image_key in doc else None videos = [process_video(video) for video in doc[video_key]] if video_key in doc else None return len(processor(text=[raw_prompt], images=images, videos=videos)[\"input_ids\"][0]) else: def doc2len(doc) -\u003e int: return len(tokenizer.apply_chat_template(doc[prompt_key], add_generation_prompt=True)) dataframe = dataframe.filter( lambda doc: doc2len(doc) \u003c= self.max_prompt_length, num_proc=self.num_workers, desc=f\"Filtering prompts longer than {self.max_prompt_length} tokens\", ) print(f\"filter dataset len: {len(dataframe)}\") return dataframe å®ç°äº†è¯»å–parquetæ–‡ä»¶ï¼Œç„¶åå†æ ¹æ®ä¼ å…¥çš„prompt_lengthç­›é€‰æ‰prompté•¿åº¦è¶…è¿‡lengthçš„æ ·æœ¬ã€‚è¿”å›çš„æ˜¯dataframeã€‚ ç„¶åå°±åˆ°äº†æœ€é‡è¦çš„__getitem__æ–¹æ³•ï¼Œæ¥æ„é€ æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼š def __getitem__(self, item): \"\"\" Note that we also return the raw_input_ids so that it can be co","date":"2025-07-26","objectID":"/dataset/:1:0","tags":["coding","verl"],"title":"Dataset","uri":"/dataset/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"verlä¸­çš„device_mesh verlä¸­æœ‰3ä¸ªdevice_meshï¼Œåˆ†åˆ«æ˜¯ï¼š - è®­ç»ƒç”¨çš„FSDP meshï¼ˆé€šå¸¸æ˜¯ä¸€ç»´ï¼‰ - æ¨ç†ç”¨çš„rollout meshï¼ˆåŒ…å«tpç»´åº¦ï¼‰ - Ulyssesåºåˆ—å¹¶è¡Œçš„meshï¼ˆdpÃ—spï¼‰ ","date":"2025-07-26","objectID":"/device_mesh/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"device_mesh","uri":"/device_mesh/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"fsdp mesh ","date":"2025-07-26","objectID":"/device_mesh/:2:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"device_mesh","uri":"/device_mesh/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"rollout mesh ","date":"2025-07-26","objectID":"/device_mesh/:3:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"device_mesh","uri":"/device_mesh/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"ulysses mesh ","date":"2025-07-26","objectID":"/device_mesh/:4:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"device_mesh","uri":"/device_mesh/"},{"categories":["verl","coding"],"content":"Verl æœ€è¿‘å®ç°äº† agent loop åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¤šè½®å·¥å…·è°ƒç”¨ RL ï¼Œå¼¥è¡¥äº† verl ä¸­ vllm æ— æ³•ä½¿ç”¨å¤šè½® rollout çš„ä¸è¶³ã€‚æ•´ä½“æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼ˆæ¥è‡ª https://github.com/zhaochenyang20/Awesome-ML-SYS-Tutorial/blob/main/rlhf/verl/multi-turn/imgs/Multi-Turn_Rollout_Workflow.pngï¼‰ image.png åœ¨å®˜æ–¹å®ç°ä¸­ï¼ˆç›®å‰åœ¨ verl/experimental/agent_loop ç›®å½•ä¸‹ï¼‰ï¼Œæ ¸å¿ƒä»£ç åœ¨ agent_loop.pyä¸­ï¼Œsingle_turn_agent_loop.pyå’Œtool_agent_loopå¯¹åº”ä¸¤ç§agent_loopï¼Œtool_parser.pyå®šä¹‰äº†hermeså·¥å…·è§£æç±»ã€‚æ‰€ä»¥é‡ç‚¹å°±æ˜¯åœ¨agent_loop.pyä¸­ï¼Œå„ä¸ªç±»çš„åä½œæµç¨‹å¦‚ä¸‹å›¾ï¼š image.png verlå®˜ç½‘å›¾å¦‚ä¸‹ï¼ˆAgent Loop â€” verl documentationï¼‰ï¼š æŒ‰ç…§ä¸Šé¢çš„æµç¨‹å›¾è¿›è¡Œé€æ­¥è®²è§£ã€‚ ","date":"2025-07-24","objectID":"/agent_loop/:0:0","tags":["coding","verl"],"title":"agent_loop","uri":"/agent_loop/"},{"categories":["verl","coding"],"content":"AgentLoopManager AgentLoopManageræ˜¯å…¥å£å¤„ï¼Œåœ¨ray_trainer.pyä¸­ç”±actor_rollout_wgåˆå§‹åŒ–ï¼š if self.config.actor_rollout_ref.rollout.mode == \"async\": from verl.experimental.agent_loop import AgentLoopManager self.async_rollout_mode = True self.async_rollout_manager = AgentLoopManager( config=self.config, worker_group=self.actor_rollout_wg, ) AgentLoopManageréœ€è¦å…ˆå¯åŠ¨å¤šä¸ªæ¨ç†å¼•æ“æœåŠ¡å™¨ï¼Œæ•°é‡ä¸ºdp_sizeï¼ˆworld_size/tp_sizeï¼‰ã€‚ä»£ç ï¼š class AgentLoopManager: \"\"\"Agent loop manager that manages a group of agent loop workers.\"\"\" def __init__(self, config: DictConfig, worker_group: RayWorkerGroup): \"\"\"Initialize agent loop manager. Args: config (DictConfig): trainer config. worker_group (RayWorkerGroup): ActorRolloutRef worker group. \"\"\" self.config = config self.worker_group = worker_group self._initialize_llm_servers() self._init_agent_loop_workers() def _initialize_llm_servers(self): # è¿™é‡Œä¹Ÿå¯¹åº”äº†ä¸€å¼€å§‹å›¾ä¸­çš„æœ€ä¸‹é¢çš„éƒ¨åˆ† self.rollout_tp_size = self.config.actor_rollout_ref.rollout.tensor_model_parallel_size self.rollout_dp_size = self.worker_group.world_size // self.rollout_tp_size ... unready_dp_ranks = set(range(self.rollout_dp_size)) while len(unready_dp_ranks) \u003e 0: servers = { rollout_dp_rank: server_class.options( # make sure AsyncvLLMServer colocates with its corresponding workers scheduling_strategy=ray.util.scheduling_strategies.NodeAffinitySchedulingStrategy( node_id=workers_info[rollout_dp_rank * self.rollout_tp_size], soft=False, ), name=f\"async_llm_server_{rollout_dp_rank}\", ).remote(self.config, self.rollout_dp_size, rollout_dp_rank, self.worker_group.name_prefix) for rollout_dp_rank in unready_dp_ranks } for rollout_dp_rank, server in servers.items(): try: address = ray.get(server.get_server_address.remote()) self.server_addresses[rollout_dp_rank] = address self.async_llm_servers[rollout_dp_rank] = server unready_dp_ranks.remove(rollout_dp_rank) except Exception: ray.kill(server) print(f\"rollout server {rollout_dp_rank} failed, maybe address already in use, restarting...\") # All server instances are ready, init AsyncLLM engine. ray.get([server.init_engine.remote() for server in self.async_llm_servers]) AgentLoopManagerè´Ÿè´£ç®¡ç†å¤šä¸ªAgentLoopWorkerï¼Œä¸ªæ•°ç”±å‚æ•°rollout.agent.num_workersç¡®å®šã€‚ç„¶åå°†promptåˆ‡åˆ†æˆnum_workerä¸ªï¼Œè®©å„ä¸ªworkeråˆ†åˆ«è¿›è¡Œæ¨ç†ï¼Œè¿™éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š ## åˆå§‹åŒ–å„ä¸ªworker def _init_agent_loop_workers(self): self.agent_loop_workers = [] for i in range(self.config.actor_rollout_ref.rollout.agent.num_workers): self.agent_loop_workers.append( AgentLoopWorker.options( name=f\"agent_loop_worker_{i}\", ).remote(self.config, self.async_llm_servers) ) ... ## æ ¹æ®workerçš„æ•°é‡åˆ‡åˆ†promptsï¼Œæ¨ç†åå†åˆå¹¶èµ·æ¥ def generate_sequences(self, prompts: DataProto) -\u003e DataProto: if self.config.actor_rollout_ref.rollout.free_cache_engine: self.wake_up() chunkes = prompts.chunk(len(self.agent_loop_workers)) outputs = ray.get( [ worker.generate_sequences.remote(chunk) for worker, chunk in zip(self.agent_loop_workers, chunkes, strict=True) ] ) output = DataProto.concat(outputs) ä»åˆå§‹åŒ–ä¹Ÿè¯´æ˜äº†ï¼Œæˆ‘ä»¬åœ¨RayPPOTrainerä¸­init_workersæ–¹æ³•é‡Œé¢åˆå§‹åŒ–å¥½AgentLoopManagerï¼ŒåŒæ—¶ä¹Ÿåˆå§‹åŒ–å¥½äº†æ¨ç†æœåŠ¡å™¨å’Œå„ä¸ªworkersã€‚ ## AsyncLLMServerManager åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨åˆ›å»ºå„ä¸ªworkerçš„æ—¶å€™ä¼ å…¥äº†åˆå§‹åŒ–å¥½çš„serversï¼Œéœ€è¦ä¸€ä¸ªç±»æ¥å¯¹è¿™äº›serverè¿›è¡Œç®¡ç†ï¼Œå³AsyncLLMServerManagerç±»ã€‚å…·ä½“çš„ä½œç”¨å°±æ˜¯é’ˆå¯¹ä¸åŒçš„requestï¼Œæ¥é€‰æ‹©å“ªä¸€ä¸ªserverè¿›è¡Œæ¨ç†ï¼Œä½¿ç”¨LRUç®—æ³•æ¥è¿›è¡Œç®¡ç†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š def __init__(self, config: DictConfig, server_handles: list[ray.actor.ActorHandle], max_cache_size: int = 10000): \"\"\"Initialize the AsyncLLMServerManager. Args: config (DictConfig): YAML config. server_handles (List[ray.actor.ActorHandle]): OpenAI compatible LLM server actor handles. max_cache_size (int, optional): max cache size for request_id to server mapping. Defaults to 10000. \"\"\" self.config = config self.server_handles = server_handles random.shuffle(self.server_handles) # Least requests load balancing self.weighted_serveres = [[0, (hash(server), server)] for server in server_handles] heapq.heapify(self.weighted_serveres) # LRU cache to map request_id to server self.request_id_to_server = LRUCache(maxsize=max_cache_size) def _choose_server(self, request_id: str) -\u003e ray.actor.ActorHandle: # TODO: implement server pressure a","date":"2025-07-24","objectID":"/agent_loop/:1:0","tags":["coding","verl"],"title":"agent_loop","uri":"/agent_loop/"},{"categories":["verl","coding"],"content":"AgentLoopWorker ç°åœ¨å›åˆ°AgentLoopWorkerä¸­ï¼Œå‰é¢å·²ç»æåˆ°äº†ï¼Œæˆ‘ä»¬ç”¨AgentLoopManagerç®¡ç†å¤šä¸ªWorkerï¼Œæ¯ä¸€ä¸ªWorkeréƒ½å¯ä»¥ç”¨æ‰€æœ‰åˆ›å»ºçš„serverè¿›è¡Œæ¨ç†ï¼Œæ¥ä¸‹æ¥å°±çœ‹workerçš„generate_sequcencesæ–¹æ³•åšäº†ä»€ä¹ˆï¼š async def generate_sequences(self, batch: DataProto) -\u003e DataProto: \"\"\"Generate sequences from agent loop. Args: batch (DataProto): Input batch. Returns: DataProto: Output batch. - prompts: [bsz, prompt_length], prompt token ids from dataset. - responses: [bsz, response_length], output token ids include response tokens from LLM generation and observation tokens from tool_calls. - response_mask: [bsz, response_length], 1 for LLM generated tokens, 0 for observation/padding tokens. - input_ids: [bsz, prompt_length + response_length], whole sequence token ids, including prompt tokens and response tokens. - attention_mask: [bsz, prompt_length + response_length], 0 for padding tokens, 1 for other tokens. - position_ids: [bsz, prompt_length + response_length], incremental position ids. For multi-turn conversations: responses: |\u003c- LLM generation -\u003e|\u003c- tool_calls -\u003e|\u003c- LLM generation -\u003e|\u003c- padding -\u003e| response_mask: | 1, 1, 1, ..., 1, 1 | 0, 0, .., 0, 0 | 1, 1, 1, ..., 1, 1 | 0, 0, ..., 0| \"\"\" config = self.config.actor_rollout_ref.rollout sampling_params = dict( temperature=config.temperature, top_p=config.top_p, repetition_penalty=1.0, ) # override sampling params for validation if batch.meta_info.get(\"validate\", False): sampling_params[\"top_p\"] = config.val_kwargs.top_p sampling_params[\"temperature\"] = config.val_kwargs.temperature # by default, we assume it's a single turn agent if \"agent_name\" not in batch.non_tensor_batch: batch.non_tensor_batch[\"agent_name\"] = np.array([\"single_turn_agent\"] * len(batch), dtype=object) tasks = [] agent_names = batch.non_tensor_batch[\"agent_name\"] raw_prompts = batch.non_tensor_batch[\"raw_prompt\"] if \"index\" in batch.non_tensor_batch: index = batch.non_tensor_batch[\"index\"] else: index = np.arange(len(raw_prompts)) trajectory_info = await get_trajectory_info( batch.meta_info.get(\"global_steps\", -1), index, batch.meta_info.get(\"validate\", False) ) for agent_name, messages, trajectory in zip(agent_names, raw_prompts, trajectory_info, strict=True): tasks.append( asyncio.create_task(self._run_agent_loop(agent_name, messages.tolist(), sampling_params, trajectory)) ) outputs = await asyncio.gather(*tasks) output = self._postprocess(outputs) return output æ ¹æ®æ³¨é‡Šçš„ä¿¡æ¯ï¼Œè¾“å…¥ä¸ºbatchæ•°æ®ï¼Œè¾“å‡ºä¸ºæ¨ç†åçš„promptã€responseã€maskç­‰ã€‚è¿™é‡Œéœ€è¦å…ˆåˆ¤æ–­ä½¿ç”¨çš„agent_loopçš„ç±»å‹ï¼Œå‰é¢æåˆ°è¿™é‡Œå®ç°äº†single_turnå’Œtoolä¸¤ç§agent_loopï¼Œæ­¤å¤–ç”¨æˆ·å¯ä»¥æ ¹æ®AgentLoopBaseæŠ½è±¡ç±»æ¥è‡ªå®šä¹‰agent_loopï¼ˆinit_classå’Œrunä¸¤ä¸ªæ–¹æ³•ï¼‰ã€‚ è¿™é‡Œå…ˆæ˜¯æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœæ•°æ®é›†ä¸­æ²¡æœ‰agent_nameå­—æ®µï¼Œåˆ™é»˜è®¤å°±æ˜¯single_turnç±»å‹ï¼Œå› æ­¤å¦‚æœä½ æƒ³ä½¿ç”¨agent_loopï¼Œå¿…é¡»åœ¨æ•°æ®é¢„å¤„ç†çš„æ—¶å€™åŠ å…¥agent_nameå­—æ®µä¸ºtool_agentã€‚è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«trajectory_infoçš„å˜é‡ï¼Œç›®çš„æ˜¯ä¸ºäº†rollout_traceï¼Œæ¥åŒºåˆ†ä¿å­˜åˆ°æ–‡ä»¶ä¸­çš„å„ä¸ªpromptç”Ÿæˆçš„responseã€‚æ¥ä¸‹æ¥è¿›å…¥åˆ°_run_agent_loopæ–¹æ³•ä¸­ï¼š async def _run_agent_loop( self, agent_name: str, messages: list[dict[str, Any]], sampling_params: dict[str, Any], trajectory: dict[str, Any], ) -\u003e AgentLoopOutput: with rollout_trace_attr( step=trajectory[\"step\"], sample_index=trajectory[\"sample_index\"], rollout_n=trajectory[\"rollout_n\"], validate=trajectory[\"validate\"], name=\"agent_loop\", ): assert agent_name in _agent_loop_registry, ( f\"Agent loop {agent_name} not registered, registered agent loops: {_agent_loop_registry.keys()}\" ) agent_loop_config = _agent_loop_registry[agent_name] agent_loop = hydra.utils.instantiate( config=agent_loop_config, trainer_config=_DummyConfig(config=self.config), server_manager=self.server_manager, tokenizer=self.tokenizer, ) output = await agent_loop.run(messages, sampling_params) return output å¯¹äºå®šä¹‰çš„ä¸åŒçš„agent_loopï¼Œéœ€è¦ç”¨registerè£…é¥°å™¨è¿›è¡Œæ³¨å†Œï¼ˆè®¾è®¡æ¨¡å¼ä¸­çš„å·¥å‚æ¨¡å¼ï¼‰ï¼Œregisterè£…é¥°å™¨å¦‚ä¸‹ï¼š def register(agent_name: str): \"\"\"Register agent loop class.\"\"\" def decorator(subclass: type[AgentLoopBase]) -\u003e type[AgentLoopBase]: fqdn = f\"{subclass.__module__}.{subclass.__qualname__}\" _agent_loop_registry[agent_name] = {\"_target_\": fqdn} return subclass return decorator å¯¹äºè£…é¥°çš„ç±»ï¼Œå°†è¿™ä¸ªä¿¡æ¯å­˜å…¥ä¸€ä¸ªåä¸ºÂ _agent_loop_registryÂ çš„å…¨å±€å­—å…¸ä¸­ã€‚ - é”® (Key)ï¼šåœ¨è£…é¥°å™¨ä¸­æä¾›çš„Â agent_nameÂ å­—ç¬¦ä¸² (e.g.,Â â€œmy_agentâ€)ã€‚ å€¼ (Value)ï¼šä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„å­—å…¸Â {â€œtargetâ€","date":"2025-07-24","objectID":"/agent_loop/:2:0","tags":["coding","verl"],"title":"agent_loop","uri":"/agent_loop/"},{"categories":["verl","coding"],"content":"ToolAgentLoop é¦–å…ˆçœ‹åˆå§‹åŒ–ï¼š @register(\"tool_agent\") class ToolAgentLoop(AgentLoopBase): @classmethod def init_class(cls, config, tokenizer, **kwargs): if cls._class_initialized: return cls._class_initialized = True print(\"Performing class-level ToolAgentLoop initialization\") # Initialize tools from config file cls.tokenizer = tokenizer cls.max_user_turns = config.actor_rollout_ref.rollout.multi_turn.max_user_turns cls.max_assistant_turns = config.actor_rollout_ref.rollout.multi_turn.max_assistant_turns cls.max_parallel_calls = config.actor_rollout_ref.rollout.multi_turn.max_parallel_calls cls.max_tool_response_length = config.actor_rollout_ref.rollout.multi_turn.max_tool_response_length cls.tool_response_truncate_side = config.actor_rollout_ref.rollout.multi_turn.tool_response_truncate_side tool_config_path = config.actor_rollout_ref.rollout.multi_turn.tool_config_path tool_list = initialize_tools_from_config(tool_config_path) if tool_config_path else [] cls.tools = {tool.name: tool for tool in tool_list} cls.tool_schemas = [tool.tool_schema.model_dump(exclude_unset=True, exclude_none=True) for tool in tool_list] cls.tool_parser = ToolParser.get_tool_parser(config.actor_rollout_ref.rollout.multi_turn.format, cls.tokenizer) print(f\"Initialized tools: {cls.tools}\") cls.prompt_length = config.actor_rollout_ref.rollout.prompt_length cls.response_length = config.actor_rollout_ref.rollout.response_length cls.system_prompt = tokenizer.apply_chat_template([{}], add_generation_prompt=False, tokenize=True) å…³äºå·¥å…·çš„åˆå§‹åŒ–ï¼Œæ¥è‡ªäºsglangå›¢é˜Ÿï¼Œè¯¦ç»†å¯ä»¥çœ‹åšå®¢ï¼šAwesome-ML-SYS-Tutorial/rlhf/verl/multi-turn/release_log/verl-multiturn-rollout-Release_ZH.md at main Â· zhaochenyang20/Awesome-ML-SYS-Tutorial Â· GitHub ç®€å•æ¥è¯´å°±æ˜¯å°†å·¥å…·çš„ä¿¡æ¯å®šä¹‰åœ¨ä¸€ä¸ªyamlæ–‡ä»¶ä¸­ï¼Œå°†æ–‡ä»¶è·¯å¾„ä¼ å…¥åˆ°actor_rollout_ref.rollout.multi_turn.tool_config_pathå‚æ•°ï¼Œç„¶åè·å–tool_schemasç”¨äºåç»­ä¼ å…¥åˆ°chat_templateä¸­ï¼Œæ­¤å¤–åœ¨tool_parser.pyä¸­å®šä¹‰äº†tool_parserã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯system_promptï¼Œè¿™æ˜¯å› ä¸ºè¿›è¡Œchat_templateçš„æ—¶å€™å¦‚æœæ²¡æœ‰roleä¸ºsystemçš„ä¼šè‡ªåŠ¨åŠ ä¸Šï¼Œè€Œåœ¨åé¢å¯¹å·¥å…·è¿”å›ç»“æœè¿›è¡Œå•ç‹¬chat_templateçš„æ—¶å€™éœ€è¦å°†è‡ªåŠ¨æ·»åŠ çš„system promptç»™åˆ é™¤ï¼Œæ‰€ä»¥è¿™é‡Œé¢„å­˜äº†ä¸€ä¸ªsystem_promptã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹æœ€æ ¸å¿ƒçš„å¤šè½®rolloutä»£ç ï¼š @rollout_trace_op async def run(self, messages: list[dict[str, Any]], sampling_params: dict[str, Any]) -\u003e AgentLoopOutput: metrics = {} request_id = uuid4().hex prompt_ids = await self.loop.run_in_executor( None, lambda: self.tokenizer.apply_chat_template( messages, tools=self.tool_schemas, add_generation_prompt=True, tokenize=True ), ) response_mask = [] user_turns, assistant_turns = 0, 0 while True: with simple_timer(\"generate_sequences\", metrics): response_ids = await self.server_manager.generate( request_id=request_id, prompt_ids=prompt_ids, sampling_params=sampling_params ) prompt_ids += response_ids response_mask += [1] * len(response_ids) assistant_turns += 1 # reach max response length if len(response_mask) \u003e= self.response_length: break # reach max assistant turns if self.max_assistant_turns and assistant_turns \u003e= self.max_assistant_turns: break # reach max user turns if self.max_user_turns and user_turns \u003e= self.max_user_turns: break # no tool calls _, tool_calls = await self.tool_parser.extract_tool_calls(response_ids) if not tool_calls: break # call tools tasks = [] for tool_call in tool_calls[: self.max_parallel_calls]: tasks.append(self._call_tool(tool_call)) with simple_timer(\"tool_calls\", metrics): tool_responses = await asyncio.gather(*tasks) if any(isinstance(item, Exception) for item in tool_responses): break # append tool_response_ids tool_response_ids = await self.loop.run_in_executor( None, lambda messages=tool_responses: self.tokenizer.apply_chat_template( messages, add_generation_prompt=True, tokenize=True ), ) tool_response_ids = tool_response_ids[len(self.system_prompt) :] # NOTE: last turn should not be user turn, or the EOS token reward # can't be propagated to previous token in GAE. if len(response_mask) + len(tool_response_ids) \u003e= self.response_length: break prompt_ids += tool_response_ids response_mask += [0] * len(tool_response_ids) user_turns += 1 response_ids = prompt_ids[-len(response_mask) :] prompt_","date":"2025-07-24","objectID":"/agent_loop/:3:0","tags":["coding","verl"],"title":"agent_loop","uri":"/agent_loop/"},{"categories":["verl","coding"],"content":"è¿”å› è¿”å›åï¼Œæˆ‘ä»¬å›åˆ°AgentLoopWorkerçš„generate_sequencesæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°†è¿”å›çš„ç»“æœéƒ½æ”¾å…¥äº†outputså˜é‡ä¸­ï¼Œè€Œåœ¨æœ€ç»ˆè¾“å‡ºå‰ï¼Œéœ€è¦è¿›è¡Œåå¤„ç†ï¼Œä¹Ÿå°±æ˜¯_postprocessæ–¹æ³•ã€‚éœ€è¦å¯¹promptè¿›è¡Œå·¦padï¼Œå¯¹responseè¿›è¡Œå³padï¼Œæœ€åæ•´åˆæˆDataProtoè¿”å›ã€‚ def generate_sequences(self, prompts: DataProto) -\u003e DataProto: \"\"\"Split input batch and dispatch to agent loop workers. Args: prompts (DataProto): Input batch. Returns: DataProto: Output batch. \"\"\" if self.config.actor_rollout_ref.rollout.free_cache_engine: self.wake_up() chunkes = prompts.chunk(len(self.agent_loop_workers)) outputs = ray.get( [ worker.generate_sequences.remote(chunk) for worker, chunk in zip(self.agent_loop_workers, chunkes, strict=True) ] ) output = DataProto.concat(outputs) if self.config.actor_rollout_ref.rollout.free_cache_engine: self.sleep() # calculate performance metrics metrics = [output.meta_info[\"metrics\"] for output in outputs] # List[List[Dict[str, str]]] timing = self._performance_metrics(metrics, output) output.meta_info = {\"timing\": timing} return output ç„¶åå›åˆ°AgentLoopWorkerçš„generate_sequencesæ–¹æ³•ä¸­ï¼Œå°†å„ä¸ªworkeræ¨ç†çš„ç»“æœconcatèµ·æ¥ã€‚å¹¶å°†ä¸€äº›metricæ”¾å…¥meta_infoæ¥loggerã€‚ ","date":"2025-07-24","objectID":"/agent_loop/:4:0","tags":["coding","verl"],"title":"agent_loop","uri":"/agent_loop/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"å¦‚æœæƒ³å°†æ¨¡å‹è®­ç»ƒæ‰©å±•åˆ°å¤§çš„æ‰¹æ¬¡ï¼Œåˆ™å¾ˆå¿«å°±ä¼šè¾¾åˆ°åœ¨å•ä¸ª GPU ä¸Šå¯ä»¥åšçš„æé™ã€‚å…·ä½“æ¥è¯´ï¼Œä¼šå‘ç”Ÿ RuntimeError: CUDA out of memoryã€‚ æ¢¯åº¦ç´¯è®¡ã€Activation checkpointing å’Œ CPU offloading éƒ½å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æ˜¾å­˜çš„å ç”¨ï¼Œä¸ºäº†_æœ‰æ•ˆåœ°_æ‰©å±•åˆ°æ›´å¤§çš„æ¨¡å‹å¤§å°å’Œä¸æ–­å¢é•¿çš„æ•°æ®é›†ï¼ŒåŒæ—¶ä»ç„¶åœ¨åˆç†çš„æ—¶é—´å†…è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦å°†è®¡ç®—åˆ†å¸ƒåœ¨ä¸€ç»„æœºå™¨ä¸Šã€‚ 3 D å¹¶è¡Œå³ï¼šæ•°æ®å¹¶è¡Œã€å¼ é‡å¹¶è¡Œã€æµæ°´çº¿å¹¶è¡Œ åä¸¤è€…å¯ä»¥ç»Ÿä¸€åˆ’åˆ†åˆ°æ¨¡å‹å¹¶è¡Œï¼ŒåŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯å±‚å†…å¹¶è¡Œï¼Œä¸€ä¸ªæ˜¯å±‚é—´å¹¶è¡Œã€‚ è¿™é‡Œä»‹ç»æ•°æ®å¹¶è¡Œã€‚ ","date":"2025-07-23","objectID":"/data_parallel/:0:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"data_parallel","uri":"/data_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"Naive data parallel ä¸€ä¸ªå¾ˆç›´è§‰çš„åšæ³•å°±æ˜¯åœ¨ batch ç»´åº¦ä¸Šè¿›è¡Œåˆ’åˆ†ï¼Œå„ä¸ªå¡ä¸Šåˆå§‹åŒ–å®Œæ•´çš„æ¨¡å‹ï¼Œç„¶åå°†å°†åˆ’åˆ†çš„ä¸åŒçš„ batch å‘é€åˆ°å„ä¸ªå¡ä¸Šè¿›è¡Œå‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œå†ç”±ä¸€ä¸ªå¡æ•´åˆæ¢¯åº¦å†ä¸‹å‘ç»™å„ GPUï¼Œç„¶åå„ GPU æ›´æ–°è‡ªå·±ç»´æŠ¤çš„æ¨¡å‹å‚æ•°ã€‚ image.png ä½†è¿™ç§åšæ³•æ˜¾ç„¶æœ‰å¾ˆå¤šé—®é¢˜ï¼Œéœ€è¦æœ‰ä¸€ä¸ª gpu æ‹…ä»»æ¢¯åº¦èšåˆå’Œä¸‹å‘çš„è§’è‰²ï¼Œå¦‚æœè¿™ä¸ª gpu å‡ºé—®é¢˜äº†æ€ä¹ˆåŠï¼Ÿæ¯ä¸€ä¸ª gpu éƒ½éœ€è¦ç»´æŠ¤å®Œæ•´çš„æ¨¡å‹å‚æ•°ã€æ¢¯åº¦å’Œä¼˜åŒ–å™¨ï¼Œè¿™éƒ¨åˆ†çš„æ˜¾å­˜æ²¡æœ‰å¾—åˆ°å‡å°‘ï¼›æ­¤å¤–è¿™ç§æ–¹å¼é€šè®¯é‡å¾ˆå¤§ï¼Œè¯¦è§æ˜¾å­˜å ç”¨è®¡ç®— ","date":"2025-07-23","objectID":"/data_parallel/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"data_parallel","uri":"/data_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"DDP DDP è§£å†³çš„é—®é¢˜å°±æ˜¯å°† Server ä¸Šçš„é€šè®¯å‹åŠ›å‡è¡¡è½¬ç§»åˆ°å„ä¸ª worker ä¸Šï¼ˆServer å³æ‹…ä»»æ¢¯åº¦èšåˆå’Œä¸‹å‘çš„è§’è‰²ï¼Œè€Œ worker å°±æ˜¯å„ä¸ª gpuï¼‰ï¼Œå› æ­¤å¼•å…¥äº† ring-all-reduce ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚éœ€è¦æŠŠåå‘ä¼ æ’­åçš„æ¢¯åº¦åˆ‡åˆ†æˆ Nï¼ˆworld_sizeï¼‰ä»½æ¥è¿›è¡Œ ring-all-reduce ç®—æ³•ã€‚ ","date":"2025-07-23","objectID":"/data_parallel/:2:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"data_parallel","uri":"/data_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"zero zero ## fsdp fsdp ## å‚è€ƒ The Ultra-Scale Playbook: Training LLMs on GPU Clusters ğŸ’¥ Training Neural Nets on Larger Batches: Practical Tips for 1-GPU, Multi-GPU \u0026 Distributed setups | by Thomas Wolf | HuggingFace | Medium Training extremely large neural networks across thousands of GPUs. # å›¾è§£å¤§æ¨¡å‹è®­ç»ƒä¹‹ï¼šæ•°æ®å¹¶è¡Œä¸Šç¯‡(DP, DDPä¸ZeRO) ","date":"2025-07-23","objectID":"/data_parallel/:3:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"data_parallel","uri":"/data_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"å‚è€ƒ The Ultra-Scale Playbook: Training LLMs on GPU Clusters ğŸ’¥ Training Neural Nets on Larger Batches: Practical Tips for 1-GPU, Multi-GPU \u0026 Distributed setups | by Thomas Wolf | HuggingFace | Medium Training extremely large neural networks across thousands of GPUs. ","date":"2025-07-23","objectID":"/pipeline-parallelism/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"pipeline parallelism","uri":"/pipeline-parallelism/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"å‚è€ƒ The Ultra-Scale Playbook: Training LLMs on GPU Clusters ğŸ’¥ Training Neural Nets on Larger Batches: Practical Tips for 1-GPU, Multi-GPU \u0026 Distributed setups | by Thomas Wolf | HuggingFace | Medium Training extremely large neural networks across thousands of GPUs. ","date":"2025-07-23","objectID":"/tensor_parallel/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"tensor_parallel","uri":"/tensor_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"åˆ†ä¸ºzero1ã€zero2ã€zero3ï¼Œè™½ç„¶zero3å¯¹æ¨¡å‹è¿›è¡Œäº†åˆ†å‰²ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯å±äºæ•°æ®å¹¶è¡Œï¼Œå› ä¸ºåœ¨å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­éœ€è¦all-gatheræ¨¡å‹å‚æ•°ï¼Œéœ€è¦å®Œæ•´çš„æ¨¡å‹æƒé‡ã€‚ å…ˆæ¥ä¸€å¼ ç»å…¸çš„å›¾ç‰‡ï¼š image.png è¿™é‡Œçš„Kå…·ä½“æ˜¯å¤šå°‘å¯ä»¥çœ‹æ˜¾å­˜å ç”¨è®¡ç®— æ¥ä¸‹æ¥é€ä¸ªä»‹ç»å„ä¸ªstage zeroã€‚éšç€zeroä¼˜åŒ–çš„æ·±å…¥ï¼Œè¶Šæ¥è¶ŠèŠ‚çœæ˜¾å­˜ï¼Œä½†é€šè®¯æ—¶é—´ä¹Ÿå¤§å¤§å¢åŠ ï¼Œå¯¼è‡´è®­ç»ƒæ—¶é—´å¢åŠ ã€‚ ## zero1 é’ˆå¯¹ä¼˜åŒ–å™¨çŠ¶æ€è¿›è¡Œåˆ†å‰²ã€‚ ","date":"2025-07-22","objectID":"/zero/:0:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"zero","uri":"/zero/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"zero2 é’ˆå¯¹ä¼˜åŒ–å™¨çŠ¶æ€å’Œæ¢¯åº¦è¿›è¡Œåˆ†å‰²ã€‚ ","date":"2025-07-22","objectID":"/zero/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"zero","uri":"/zero/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"zero3 é’ˆå¯¹ä¼˜åŒ–å™¨çŠ¶æ€ã€æ¢¯åº¦å’Œæ¨¡å‹å‚æ•°è¿›è¡Œåˆ†å‰²ã€‚ ","date":"2025-07-22","objectID":"/zero/:2:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"zero","uri":"/zero/"},{"categories":["infra","LLM"],"content":" FLOPs, floating point operations, è¡¨ç¤ºæµ®ç‚¹æ•°è¿ç®—æ¬¡æ•°ï¼Œè¡¡é‡äº†è®¡ç®—é‡çš„å¤§å°ã€‚ å¦‚ä½•è®¡ç®—çŸ©é˜µä¹˜æ³•çš„ FLOPs å‘¢ï¼Ÿ å¯¹äº \\(A\\in R^{1\\times n},B\\in R^{n\\times1}\\) ,è®¡ç®— \\(AB\\) éœ€è¦è¿›è¡Œ \\(n\\) æ¬¡ä¹˜æ³•è¿ç®—å’Œ \\(n\\) æ¬¡åŠ æ³•è¿ç®—ï¼Œå…±è®¡ \\(2n\\) æ¬¡æµ®ç‚¹æ•°è¿ç®—ï¼Œéœ€è¦ \\(2n\\) çš„ FLOPsã€‚å¯¹äº \\(A\\in R^{m\\times n},B\\in R^{n\\times p}\\) ,è®¡ç®— \\(AB\\) éœ€è¦çš„æµ®ç‚¹æ•°è¿ç®—æ¬¡æ•°ä¸º \\(2mnp\\) ã€‚ åœ¨ä¸€æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œå‡è®¾è¾“å…¥æ•°æ®çš„å½¢çŠ¶ä¸º \\([b,s]\\) ã€‚æˆ‘ä»¬å…ˆåˆ†æ self-attention å—çš„è®¡ç®—ï¼Œè®¡ ç®—å…¬å¼å¦‚ä¸‹ï¼š \\[Q=xW_Q,K=xW_K,V=xW_V\\] \\[x_{out}=softmax(\\frac{QK^T}{\\sqrt{h}})\\cdot V\\cdot W_o+x\\] è®¡ç®— \\(Q,K,V:\\) çŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,s,h]\\times[h,h]\\to[b,s,h]\\) ã€‚è®¡ç®—é‡ä¸º \\(3*2bsh^2=6bsh^2\\) ã€‚ \\(2.QK^T\\) çŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,head\\_num,s,per\\_head\\_hidden\\_size]\\) \\(\\times[b,head\\_num,per\\_head\\_hidden\\_size,s]\\rightarrow[b,head\\_num,s,s]\\) ã€‚è®¡ç®—é‡ä¸º \\(2bs^2h\\) ã€‚ 3. è®¡ç®—åœ¨ \\(V\\) ä¸Šçš„åŠ æƒ \\(score\\cdot V\\), çŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,head\\_num,s,s]\\times[b,head\\_num,s,per\\_head\\_hidden\\_size]\\) ã€‚è®¡ç®—é‡ä¸º \\(2bs^2h\\) ã€‚ 4. Attention åçš„çº¿æ€§æ˜ å°„ï¼ŒçŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,s,h]\\times[h,h]\\to[b,s,h]\\) ã€‚è®¡ ç®—é‡ä¸º \\(2bsh^2\\) ã€‚ æ¥ä¸‹æ¥åˆ†æ MLP å—çš„è®¡ç®—ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š \\[x=f_{gelu}(x_{out}W_1)W_2+x_{out}\\] ç¬¬ä¸€ä¸ªçº¿æ€§å±‚ï¼ŒçŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,s,h]\\times[h,4h]\\to[b,s,4h]\\)ã€‚è®¡ç®—é‡ ä¸º \\(8bsh^2\\) ã€‚ ç¬¬äºŒä¸ªçº¿æ€§å±‚ï¼ŒçŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶ä¸º \\([b,s,4h]\\times[4h,h]\\to[b,s,h]\\)ã€‚è®¡ç®—é‡ ä¸º \\(8bsh^2\\) ã€‚ å°†ä¸Šè¿°è®¡ç®—é‡ç›¸åŠ ï¼Œå¾—åˆ°æ¯ä¸ª transformer å±‚çš„è®¡ç®—é‡å¤§çº¦ä¸º \\(24bsh^2+4bs^2h\\) ã€‚ æ­¤å¤–ï¼Œå¦ä¸€ä¸ªè®¡ç®—é‡çš„å¤§å¤´æ˜¯ logits çš„è®¡ç®—ï¼Œå°†éšè—å‘é‡æ˜ å°„ä¸ºè¯è¡¨å¤§å°ã€‚çŸ©é˜µä¹˜æ³•çš„è¾“å…¥å’Œ è¾“å‡ºå½¢çŠ¶ä¸º \\([b,s,h]\\times[h,V]\\to[b,s,V]\\) ,è®¡ç®—é‡ä¸º \\(2bshV\\) ã€‚ å› æ­¤ï¼Œå¯¹äºä¸€ä¸ª \\(l\\) å±‚çš„ transformer æ¨¡å‹ï¼Œè¾“å…¥æ•°æ®å½¢çŠ¶ä¸º \\([b,s]\\) çš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¡è®­ç»ƒè¿­ä»£çš„ è®¡ç®—é‡ä¸º \\(l*(24bsh^2+4bs^2h)+2bshV\\) ã€‚ ","date":"2025-07-19","objectID":"/flops%E5%88%86%E6%9E%90/:0:0","tags":["LLM","infra"],"title":"flopsåˆ†æ","uri":"/flops%E5%88%86%E6%9E%90/"},{"categories":["infra","LLM"],"content":"è®¡ç®—é‡ä¸å‚æ•°é‡çš„å…³è” å½“éšè—ç»´åº¦ \\(h\\) æ¯”è¾ƒå¤§ï¼Œä¸”è¿œå¤§äºåºåˆ—é•¿åº¦ \\(s\\) æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥ä¸€æ¬¡é¡¹ï¼Œè®¡ç®—é‡å¯ä»¥è¿‘ä¼¼ä¸º \\(24bsh^2*l\\) ã€‚å‰é¢æåˆ°å½“æ¨¡å‹å‚æ•°é‡ä¸º \\(12lh^2\\), è¾“å…¥çš„ tokens æ•°ä¸º \\(bs\\) ,å­˜åœ¨ç­‰å¼ \\(\\frac{24bsh^2l}{12h^2\\times bs}=2\\)ã€‚æˆ‘ä»¬å¯ä»¥è¿‘ä¼¼è®¤ä¸ºï¼šåœ¨ä¸€æ¬¡å‰å‘ä¼ é€’ä¸­ï¼Œå¯¹äºæ¯ä¸ª tokenï¼Œæ¯ä¸ªæ¨¡å‹å‚æ•°ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡æµ®ç‚¹æ•°è¿ç®—ï¼Œå³ä¸€æ¬¡ä¹˜æ³•æ³•è¿ç®—å’Œä¸€æ¬¡åŠ æ³•è¿ç®—ã€‚ ä¸€æ¬¡è®­ç»ƒè¿­ä»£åŒ…å«äº†å‰å‘ä¼ é€’å’Œåå‘ä¼ é€’ï¼Œåå‘ä¼ é€’çš„è®¡ç®—é‡æ˜¯å‰å‘ä¼ é€’çš„ 2 å€ã€‚å› æ­¤ï¼Œå‰å‘ä¼ é€’+åå‘ä¼ é€’çš„ç³»æ•°=1+2=3 ã€‚ä¸€æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œå¯¹äºæ¯ä¸ª tokenï¼Œæ¯ä¸ªæ¨¡å‹å‚æ•°ï¼Œéœ€è¦è¿›è¡Œ 2*3=6 æ¬¡æµ®ç‚¹æ•°è¿ç®—ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¼°è®¡è®­ç»ƒ GPT 3-175 B æ‰€éœ€è¦çš„è®¡ç®—é‡ã€‚å¯¹äº GPT 3ï¼Œæ¯ä¸ª tokenï¼Œæ¯ä¸ªå‚æ•°è¿›è¡Œäº† 6 æ¬¡æµ®ç‚¹æ•°è¿ç®—ï¼Œå†ä¹˜ä»¥å‚æ•°é‡å’Œæ€» tokens æ•°å°±å¾—åˆ°äº†æ€»çš„è®¡ç®—é‡ã€‚GPT 3 çš„æ¨¡å‹å‚æ•°é‡ä¸º 174600 \\(M\\) ,è®­ç»ƒæ•°æ®é‡ä¸º \\(300B\\) tokensã€‚ \\[6\\times174600\\times10^6\\times300\\times10^9=3.1428\\times10^{23}flops\\] ","date":"2025-07-19","objectID":"/flops%E5%88%86%E6%9E%90/:1:0","tags":["LLM","infra"],"title":"flopsåˆ†æ","uri":"/flops%E5%88%86%E6%9E%90/"},{"categories":["infra","LLM"],"content":"è®­ç»ƒæ—¶é—´ \\[ è®­ç»ƒæ—¶é—´=\\frac{8 * tokensæ•° *æ¨¡å‹å‚æ•°é‡}{GPUæ•° * GPUå³°å€¼flops*GPUåˆ©ç”¨ç‡} \\] ä¹Ÿå°±æ˜¯è®­ç»ƒæ—¶çš„ flops / gpu çš„ flopsã€‚8 æ˜¯å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ã€Activation checkpointing ã€‚å‰å‘ä¼ æ’­ç³»æ•°ä¸º 1ï¼Œåå‘ä¼ æ’­æ˜¯å‰å‘ä¼ æ’­è®¡ç®—é‡çš„ 2 å€ï¼Œå†åŠ ä¸Šåœ¨åå‘ä¼ æ’­æ—¶éœ€è¦å‰å‘ä¼ æ’­ä¸€æ¬¡ï¼Œå› æ­¤æ€»ç³»æ•°ä¸º 4ï¼Œ1 ä¸ªå‚æ•°éœ€è¦ 2 æ¬¡æµ®ç‚¹æ•°è¿ç®—ï¼Œè¿™å°±æ˜¯ 8 æ€ä¹ˆæ¥çš„ã€‚ ","date":"2025-07-19","objectID":"/flops%E5%88%86%E6%9E%90/:2:0","tags":["LLM","infra"],"title":"flopsåˆ†æ","uri":"/flops%E5%88%86%E6%9E%90/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"All-reduced=all-gather+reduce-scatter All-GatherÂ ï¼šå°†åˆ†å¸ƒå¼æ•°æ®æ±‡æ€»åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€‚ç”¨äºéœ€è¦å…¨å±€æ•°æ®åŒæ­¥çš„åœºæ™¯ã€‚ Reduce-Scatterï¼šå°†åˆ†å¸ƒå¼æ•°æ®è¿›è¡Œè§„çº¦å¹¶åˆ†æ•£åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€‚ç”¨äºéœ€è¦å±€éƒ¨ç»“æœåˆ†å‘çš„åœºæ™¯ã€‚ All-ReduceÂ ï¼š Reduce-Scatter å’Œ All-Gather çš„ç»„åˆã€‚ ","date":"2025-07-17","objectID":"/ring-all-reduce/:0:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"All-gather æ ¸å¿ƒåŠŸèƒ½ï¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„éƒ¨åˆ†æ•°æ®æ±‡æ€»åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œæœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹æ‹¥æœ‰å®Œæ•´æ•°æ®å‰¯æœ¬ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ¨¡å‹å¹¶è¡Œä¸­çš„å‚æ•°åŒæ­¥ã€å…¨å±€ç»Ÿè®¡ä¿¡æ¯èšåˆã€‚ image.png ","date":"2025-07-17","objectID":"/ring-all-reduce/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"Reduce-Scatter æ ¸å¿ƒåŠŸèƒ½ï¼šå…ˆå¯¹å¤šèŠ‚ç‚¹æ•°æ®è¿›è¡Œè§„çº¦ï¼ˆå¦‚æ±‚å’Œï¼‰ï¼Œå†å°†ç»“æœåˆ†æ•£åˆ°å„èŠ‚ç‚¹ï¼Œä½¿æ¯ä¸ªèŠ‚ç‚¹ä»…ä¿ç•™éƒ¨åˆ†è§„çº¦ç»“æœã€‚ é€‚ç”¨åœºæ™¯ï¼šZeROæ˜¾å­˜ä¼˜åŒ–ã€æ¢¯åº¦åˆ†ç‰‡æ›´æ–°ã€‚ image.png ","date":"2025-07-17","objectID":"/ring-all-reduce/:2:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"åŒºåˆ« All-Gatherï¼šåªè¿›è¡Œæ•°æ®æ”¶é›†å’Œåˆ†å‘ï¼Œä¸è¿›è¡Œä»»ä½•è®¡ç®—æˆ–è§„çº¦æ“ä½œã€‚æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ã€‚ Reduce-Scatterï¼šå…ˆè¿›è¡Œæ•°æ®è§„çº¦ï¼ˆreduceï¼‰ï¼Œç„¶åå†è¿›è¡Œæ•°æ®åˆ†æ•£ï¼ˆscatterï¼‰ã€‚æ¯ä¸ªèŠ‚ç‚¹åªæ‹¥æœ‰éƒ¨åˆ†è§„çº¦åçš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„æ•°æ® ","date":"2025-07-17","objectID":"/ring-all-reduce/:3:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"ä¾‹å­ ","date":"2025-07-17","objectID":"/ring-all-reduce/:4:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"é€šä¿¡é‡è®¡ç®— å‡è®¾æ¨¡å‹å‚æ•°å¤§å°ä¸º \\(\\theta\\)ï¼ŒGPU ä¸ªæ•°ä¸º Nï¼Œåˆ™æ¯ä¸€ä¸ªæ¢¯åº¦å—å¤§å°ä¸º \\(\\frac{\\theta}{N}\\) å¯¹äºå•å¡è€Œè¨€ï¼š - Reduce-Scatter é˜¶æ®µé€šè®¯é‡ï¼š\\((N-1) \\frac{\\theta}{N}\\) - All-Reduce é˜¶æ®µé€šè®¯é‡ï¼š\\((N-1) \\frac{\\theta}{N}\\) å•å¡é€šè®¯é‡ä¸º \\(2(N-1) \\frac{\\theta}{N}\\)ï¼Œæ‰€æœ‰å¡çš„é€šè®¯é‡ä¸º \\(2(N-1) \\theta\\) ","date":"2025-07-17","objectID":"/ring-all-reduce/:5:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"å‚è€ƒ # åˆ†å¸ƒå¼è®­ç»ƒä¸­All-Reduceã€All-Gatherã€Reduce-ScatteråŸç†ä»‹ç» ","date":"2025-07-17","objectID":"/ring-all-reduce/:6:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ring-all-reduce","uri":"/ring-all-reduce/"},{"categories":["verl","coding"],"content":"batch_sizeçš„å¤æ‚æ€§æ¥è‡ªäºtpã€dpã€spï¼Œå¼•ç”¨ä¸€ä¸‹æµ…å…¥ç†è§£verlä¸­çš„batch_sizeçš„è§£é‡Šï¼š vllm + fsdp è®­æ¨æ—¶ï¼Œå¦‚æœæ¯å¼ å¡éƒ½æ˜¯ä¸€ä¸ª DPï¼Œäº‹æƒ…ä¼šç®€å•å¾ˆå¤šã€‚ä½† verl ä¸­æœ‰ä¸¤ä¸ªåŠŸèƒ½ä¸æ»¡è¶³è¿™ä¸€æ¡ä»¶ï¼Œä¸€æ˜¯ rollout æ—¶è®© vllm å¼€å¯ TPï¼ŒäºŒæ˜¯åœ¨ fsdp ä¸­ä½¿ç”¨ ulyssesï¼ˆSPï¼‰ã€‚verl ä¸­æ•°æ®åˆ†å‘ä½¿ç”¨çš„æ˜¯ dispatch mode è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚ fsdp workers ä¸»è¦ä½¿ç”¨Â Dispatch.DP_COMPUTE_PROTOè¿™ä¸ª modeï¼Œå®ƒæ˜¯åœ¨ worker group çš„å±‚æ¬¡ä¸Šè¿›è¡Œæ•°æ®åˆ†å‘ä»¥åŠç»“æœæ”¶é›†çš„ã€‚ç”±äºè¿™ä¸ªå±‚æ¬¡æ˜¯æ²¡æœ‰ TP/SP æ¦‚å¿µçš„ï¼Œæ‰€ä»¥å®ƒä»…åœ¨ one GPU one DP æ—¶æ‰æ˜¯æ­£ç¡®çš„ã€‚é‚£ä¹ˆä¸ºäº†æ­£ç¡®æ”¯æŒ TP/SPï¼Œå°±éœ€è¦å¯¹æ•°æ®åšä¸€äº›å‰åå¤„ç†ã€‚ è¿™ä¸€ç‚¹åœ¨DataProtoä¹Ÿæœ‰æåˆ°ï¼Œå…·ä½“çš„å®ç°å°±æ˜¯all_gather_data_protoå‡½æ•°ã€‚ TPéœ€è¦åœ¨TP rankä¸Šall-gatheræ¥ä¿è¯å„ä¸ªtp rankçš„è¾“å…¥ç›¸åŒï¼Œç„¶åå†å°†è¾“å‡ºsplitè¿”å›å½“å‰rankçš„éƒ¨åˆ†ï¼Œä¿æŒå’Œè¾“å…¥ä¸€è‡´ã€‚ SPä¸ TP ä¸€æ ·ï¼Œåœ¨ SP group ä¸Šè¿›è¡Œ allgather æ¥ä¿è¯å„ä¸ª SP rank çš„è¾“å…¥ç›¸åŒï¼ˆulysses çš„éœ€è¦ï¼‰ï¼›å¯¹è¾“å‡ºè¿›è¡Œ split å¹¶è¿”å›å½“å‰ rank å¯¹åº”çš„éƒ¨åˆ†ã€‚ åœ¨fsdp_workerä¸­ï¼Œåˆå§‹åŒ–é˜¶æ®µå¯¹batch_sizeè¿›è¡Œäº†å¤„ç†ï¼š # normalize config if self._is_actor: self.config.actor.ppo_mini_batch_size *= self.config.rollout.n self.config.actor.ppo_mini_batch_size //= self.device_mesh.size() // self.ulysses_sequence_parallel_size assert self.config.actor.ppo_mini_batch_size \u003e 0, ( f\"ppo_mini_batch_size {self.config.actor.ppo_mini_batch_size} should be larger than 0 after \" f\"normalization\" ) # micro bsz if self.config.actor.ppo_micro_batch_size is not None: self.config.actor.ppo_micro_batch_size //= ( self.device_mesh.size() // self.ulysses_sequence_parallel_size ) self.config.actor.ppo_micro_batch_size_per_gpu = self.config.actor.ppo_micro_batch_size if self.config.actor.ppo_micro_batch_size_per_gpu is not None: assert self.config.actor.ppo_mini_batch_size % self.config.actor.ppo_micro_batch_size_per_gpu == 0, ( f\"normalized ppo_mini_batch_size {self.config.actor.ppo_mini_batch_size} should be divisible by \" f\"ppo_micro_batch_size_per_gpu {self.config.actor.ppo_micro_batch_size_per_gpu}\" ) assert self.config.actor.ppo_mini_batch_size // self.config.actor.ppo_micro_batch_size_per_gpu \u003e 0, ( f\"normalized ppo_mini_batch_size {self.config.actor.ppo_mini_batch_size} should be larger than \" f\"ppo_micro_batch_size_per_gpu {self.config.actor.ppo_micro_batch_size_per_gpu}\" ) # normalize rollout config if self._is_rollout and self.config.rollout.log_prob_micro_batch_size is not None: self.config.rollout.log_prob_micro_batch_size //= ( self.device_mesh.size() // self.ulysses_sequence_parallel_size ) self.config.rollout.log_prob_micro_batch_size_per_gpu = self.config.rollout.log_prob_micro_batch_size # normalize ref config if self._is_ref and self.config.ref.log_prob_micro_batch_size is not None: self.config.ref.log_prob_micro_batch_size //= self.device_mesh.size() // self.ulysses_sequence_parallel_size self.config.ref.log_prob_micro_batch_size_per_gpu = self.config.ref.log_prob_micro_batch_size å‰é¢åˆ›å»ºäº†fsdp_devicmeshï¼ˆdpï¼‰ã€ulysses_device_meshï¼ˆdpå’Œspï¼‰ä»¥åŠåœ¨åˆå§‹åŒ–rolloutä¸­åˆ›å»ºäº†rollout_device_meshï¼ˆdpå’Œtpï¼‰ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹device_meshã€‚ ","date":"2025-07-16","objectID":"/batch_size%E8%A7%A3%E9%87%8A/:0:0","tags":["coding","verl"],"title":"batch_sizeè§£é‡Š","uri":"/batch_size%E8%A7%A3%E9%87%8A/"},{"categories":["verl","coding"],"content":"Rollout æ³¨æ„verl v0.5.0çš„å®ç°ä¸­ï¼Œæ‰€æœ‰çš„promptsç›´æ¥ç”±driveré‡å¤ç„¶åå†dispatchï¼Œè€Œä¸æ˜¯å…ˆdispatchç„¶åå†äº¤ç»™Workeré‡å¤æ ·æœ¬ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å¦‚æœå…ˆåˆ†ç‰‡çš„è¯ï¼Œæœ‰å¯èƒ½batch_sizeå°äºworld_sizeï¼ˆå¯¹æˆ‘æ¥è¯´åŸºæœ¬ä¸å¯èƒ½ï¼‰ï¼Œå¯¼è‡´ä¸èƒ½æ­£ç¡®åˆ‡åˆ†ï¼Œå¦‚æœæ˜¯å…ˆrepeatçš„è¯å°±å¯ä»¥äº†ã€‚ å› æ­¤å¯¹äºRolloutï¼š - å…¨å±€ï¼štrain_batch_size * nä¸ªpromptsï¼Œè¾“å‡ºtrain_batch_size * nä¸ªprompts + responsesã€‚ - å•å¡ï¼šè¾“å…¥train_batch_size * n / world_sizeä¸ªpromptsï¼Œè¿›è¡Œå‰å¤„ç†ä¸º\\(\\frac{train\\_batch\\_size * n}{world\\_size} * tp\\_size\\)ä¸ªpromptsï¼Œç„¶åè¿›è¡Œæ¨ç†ï¼Œå¾—åˆ°\\(\\frac{train\\_batch\\_size * n}{world\\_size} * tp\\_size\\)ä¸ªprompts+responsesï¼Œå†è¿›è¡Œåå¤„ç†ï¼Œè¾“å‡ºtrain_batch_size * n / world_sizeä¸ªprompts+responsesã€‚ ","date":"2025-07-16","objectID":"/batch_size%E8%A7%A3%E9%87%8A/:1:0","tags":["coding","verl"],"title":"batch_sizeè§£é‡Š","uri":"/batch_size%E8%A7%A3%E9%87%8A/"},{"categories":["verl","coding"],"content":"Actor ä¸Actoræœ‰å…³çš„å‚æ•°ä¸ºppo_mini_batch_sizeï¼ˆå†³å®šä¸€æ‰¹experienceçš„æ›´æ–°æ¬¡æ•°ï¼‰ã€rollout.log_prob_micro_batch_size_per_gpuï¼ˆè®¡ç®—old_logpï¼‰ã€ref.log_prob_micro_batch_size_per_gpuï¼ˆè®¡ç®—ref_logpï¼‰ã€micro_batch_size_per_gpuï¼ˆç›´æ¥æŒ‡å®šå•å¡ä¸Šçš„batch_sizeï¼‰ã€‚ é‡ç‚¹çœ‹ppo_mini_batch_sizeç”¨äºupdate_policyçš„å¤„ç†ï¼Œå…¶å®ƒçš„éƒ½å¤§åŒå°å¼‚ï¼š å…¨å±€ï¼štrain_batch_size * nå¤§å°çš„batchï¼ŒåŒ…å«äº†éƒ¨åˆ†è®¡ç®—å¥½çš„experienceã€‚ å•å¡ï¼šè¾“å…¥ä¸ºtrain_batch_size * n / world_sizeï¼Œç»è¿‡å‰å¤„ç†ä¸ºtrain_batch_size * rollout_n * sp_size / world_sizeã€‚è¿™å’Œfsdp_workeråˆå§‹åŒ–æ—¶çš„ppo_mini_batch_sizeä¸€è‡´ï¼Œå³ self.config.actor.ppo_mini_batch_size *= self.config.rollout.n self.config.actor.ppo_mini_batch_size //= self.device_mesh.size() // self.ulysses_sequence_parallel_size è¿™æ ·çš„è¯å¯¹äºä¸€æ‰¹experienceçš„æ›´æ–°æ¬¡æ•°ï¼Œå°±ç­‰äºä½ ä¼ å…¥çš„train_batch_size // mini_batch_sizeã€‚å¯¹äºmicro_batch_size_per_gpuå‚æ•°æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå•å¡çš„bsã€‚å¯¹äºä¼ å…¥micro_batch_sizeå†è®¡ç®—çš„æ–¹å¼ï¼Œverlå·²ç»åºŸå¼ƒäº†ã€‚ ","date":"2025-07-16","objectID":"/batch_size%E8%A7%A3%E9%87%8A/:2:0","tags":["coding","verl"],"title":"batch_sizeè§£é‡Š","uri":"/batch_size%E8%A7%A3%E9%87%8A/"},{"categories":["verl","coding"],"content":"ppoæµç¨‹ ä»å›¾ä¸­å¯ä»¥å¾—åˆ°çš„æ˜¯ppo_mini_batch_sizeæ˜¯å…¨å±€çš„prompt batchï¼Œè€Œppo_micro_batch_per_gpuæ˜¯æ¯ä¸€ä¸ªgpuä¸Šçš„prompt+response batchï¼Œæ‰€ä»¥ç”±æ­¤å¯ä»¥å¾—åˆ°æ¢¯åº¦ç´¯è®¡çš„stepsä¸º ppo_mini_batch_size * n * sp_size // world_size // micro_batch_per_gpuã€‚å³micro_batch_per_gpuä»£è¡¨æ¢¯åº¦ç´¯è®¡çš„bsã€‚ ","date":"2025-07-16","objectID":"/batch_size%E8%A7%A3%E9%87%8A/:3:0","tags":["coding","verl"],"title":"batch_sizeè§£é‡Š","uri":"/batch_size%E8%A7%A3%E9%87%8A/"},{"categories":["verl","coding"],"content":"å‚è€ƒ æµ…å…¥ç†è§£verlä¸­çš„batch_size ","date":"2025-07-16","objectID":"/batch_size%E8%A7%A3%E9%87%8A/:4:0","tags":["coding","verl"],"title":"batch_sizeè§£é‡Š","uri":"/batch_size%E8%A7%A3%E9%87%8A/"},{"categories":["","LLM","attention","NLP"],"content":"Self-attention é¦–å…ˆä»‹ç»ä¸€ä¸‹æœ€ä¸»è¦çš„ self-attentionï¼Œå¯ä»¥è¯´æ˜¯ self-attention å®ç°äº†ä¸Šè¿°çš„ token ä¹‹é—´äº¤äº’çš„åŠŸèƒ½ã€‚ è‡ªæ³¨æ„åŠ›æ˜¯æ¨¡å‹çš„å…³é”®ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚æ³¨æ„å’Œè‡ªæ³¨æ„ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œè‡ªæ³¨æ„åœ¨ç›¸åŒæ€§è´¨çš„è¡¨ç¤ºä¹‹é—´è¿è¡Œï¼šä¾‹å¦‚ï¼ŒæŸä¸ªå±‚ä¸­çš„æ‰€æœ‰ç¼–ç å™¨çŠ¶æ€ã€‚ å½¢å¼ä¸Šï¼Œè¿™ç§ç›´è§‰æ˜¯é€šè¿‡æŸ¥è¯¢é”®å€¼æ³¨æ„æ¥å®ç°çš„ã€‚Self-attention ä¸­çš„æ¯ä¸ªè¾“å…¥æ ‡è®°éƒ½ä¼šæ”¶åˆ°ä¸‰ç§è¡¨ç¤ºï¼Œå¯¹åº”äºå®ƒå¯ä»¥æ‰®æ¼”çš„è§’è‰²ï¼š Query Key Value è¿›å…¥æ­£é¢˜ï¼š ä½œä¸ºæˆ‘ä»¬æƒ³è¦ç¿»è¯‘çš„è¾“å…¥è¯­å¥â€œThe animal didnâ€™t cross the street because it was too tiredâ€ã€‚å¥å­ä¸­â€itâ€æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€œitâ€æŒ‡çš„æ˜¯â€streetâ€ è¿˜æ˜¯â€œanimalâ€ï¼Ÿå¯¹äººæ¥è¯´å¾ˆç®€å•çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹ç®—æ³•è€Œè¨€å¹¶ä¸ç®€å•ã€‚ å½“æ¨¡å‹å¤„ç†å•è¯â€œitâ€æ—¶ï¼Œself-attention å…è®¸å°†â€œitâ€å’Œâ€œanimalâ€è”ç³»èµ·æ¥ã€‚å½“æ¨¡å‹å¤„ç†æ¯ä¸ªä½ç½®çš„è¯æ—¶ï¼Œself-attention å…è®¸æ¨¡å‹çœ‹åˆ°å¥å­çš„å…¶ä»–ä½ç½®ä¿¡æ¯ä½œè¾…åŠ©çº¿ç´¢æ¥æ›´å¥½åœ°ç¼–ç å½“å‰è¯ã€‚å¦‚æœä½ å¯¹ RNN ç†Ÿæ‚‰ï¼Œå°±èƒ½æƒ³åˆ° RNN çš„éšçŠ¶æ€æ˜¯å¦‚ä½•å…è®¸ä¹‹å‰çš„è¯å‘é‡æ¥è§£é‡Šåˆæˆå½“å‰è¯çš„è§£é‡Šå‘é‡ã€‚Transformer ä½¿ç”¨ self-attention æ¥å°†ç›¸å…³è¯çš„ç†è§£ç¼–ç åˆ°å½“å‰è¯ä¸­ã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹ self-attention æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼š ","date":"2025-07-16","objectID":"/mha/:1:0","tags":["LLM","Attention","NLP"],"title":"MHA","uri":"/mha/"},{"categories":["","LLM","attention","NLP"],"content":"å‘é‡è®¡ç®— ç¬¬ä¸€æ­¥ï¼Œæ ¹æ®ç¼–ç å™¨çš„è¾“å…¥å‘é‡ï¼Œç”Ÿæˆä¸‰ä¸ªå‘é‡ï¼Œæ¯”å¦‚ï¼Œå¯¹æ¯ä¸ªè¯å‘é‡ï¼Œç”Ÿæˆ query-vec, key-vec, value-vecï¼Œç”Ÿæˆæ–¹æ³•ä¸ºåˆ†åˆ«ä¹˜ä»¥ä¸‰ä¸ªçŸ©é˜µï¼Œè¿™äº›çŸ©é˜µåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦å­¦ä¹ ã€‚ã€æ³¨æ„ï¼šä¸æ˜¯æ¯ä¸ªè¯å‘é‡ç‹¬äº« 3 ä¸ª matrixï¼Œè€Œæ˜¯æ‰€æœ‰è¾“å…¥å…±äº« 3 ä¸ªè½¬æ¢çŸ©é˜µï¼›æƒé‡çŸ©é˜µæ˜¯åŸºäºè¾“å…¥ä½ç½®çš„è½¬æ¢çŸ©é˜µï¼›æœ‰ä¸ªå¯ä»¥å°è¯•çš„ç‚¹ï¼Œå¦‚æœæ¯ä¸ªè¯ç‹¬äº«ä¸€ä¸ªè½¬æ¢çŸ©é˜µï¼Œä¼šä¸ä¼šæ•ˆæœæ›´å‰å®³å‘¢ï¼Ÿã€‘ æ³¨æ„åˆ°è¿™äº›æ–°å‘é‡çš„ç»´åº¦æ¯”è¾“å…¥è¯å‘é‡çš„ç»´åº¦è¦å°ï¼ˆ512â€“\u003e64ï¼‰ï¼Œå¹¶ä¸æ˜¯å¿…é¡»è¦å°çš„ï¼Œæ˜¯ä¸ºäº†è®©å¤šå¤´ attention çš„è®¡ç®—æ›´ç¨³å®šã€‚ ç¬¬äºŒæ­¥ï¼Œè®¡ç®— attention å°±æ˜¯è®¡ç®—ä¸€ä¸ªåˆ†å€¼ã€‚å¯¹â€œThinking Matchinesâ€è¿™å¥è¯ï¼Œå¯¹â€œThinkingâ€ï¼ˆpos #1 ï¼‰è®¡ç®— attention åˆ†å€¼ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªè¯ä¸â€œThinkingâ€çš„è¯„ä¼°åˆ†ï¼Œè¿™ä¸ªåˆ†å†³å®šç€ç¼–ç â€œThinkingâ€æ—¶ï¼ˆæŸä¸ªå›ºå®šä½ç½®æ—¶ï¼‰ï¼Œæ¯ä¸ªè¾“å…¥è¯éœ€è¦é›†ä¸­å¤šå°‘å…³æ³¨åº¦ã€‚ è¿™ä¸ªåˆ†ï¼Œé€šè¿‡â€œThingâ€å¯¹åº” query-vector ä¸æ‰€æœ‰è¯çš„ key-vec ä¾æ¬¡åšç‚¹ç§¯å¾—åˆ°ã€‚æ‰€ä»¥å½“æˆ‘ä»¬å¤„ç†ä½ç½® #1æ—¶ ï¼Œç¬¬ä¸€ä¸ªåˆ†å€¼æ˜¯ q 1 å’Œ k 1 çš„ç‚¹ç§¯ï¼Œç¬¬äºŒä¸ªåˆ†å€¼æ˜¯ q 1 å’Œ k 2 çš„ç‚¹ç§¯ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ³¨æ„åŠ›å¾—åˆ†. ç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥ï¼Œé™¤ä»¥ 8 (\\(=\\sqrt{dim_{key}}\\))ï¼Œè¿™æ ·æ¢¯åº¦ä¼šæ›´ç¨³å®šã€‚ç„¶ååŠ ä¸Š softmax æ“ä½œï¼Œå½’ä¸€åŒ–åˆ†å€¼ä½¿å¾—å…¨ä¸ºæ­£æ•°ä¸”åŠ å’Œä¸º 1ã€‚ Softmax åˆ†å€¼å†³å®šç€åœ¨è¿™ä¸ªä½ç½®ï¼Œæ¯ä¸ªè¯çš„è¡¨è¾¾ç¨‹åº¦ï¼ˆå…³æ³¨åº¦ï¼‰ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªä½ç½®çš„è¯åº”è¯¥æœ‰æœ€é«˜çš„å½’ä¸€åŒ–åˆ†æ•°ï¼Œä½†å¤§éƒ¨åˆ†æ—¶å€™æ€»æ˜¯æœ‰åŠ©äºå…³æ³¨è¯¥è¯çš„ç›¸å…³çš„è¯ã€‚ ç¬¬äº”æ­¥ï¼Œå°† softmax åˆ†å€¼ä¸ value-vec æŒ‰ä½ç›¸ä¹˜ã€‚ä¿ç•™å…³æ³¨è¯çš„ value å€¼ï¼Œå‰Šå¼±éç›¸å…³è¯çš„ value å€¼ã€‚ ç¬¬å…­æ­¥ï¼Œå°†æ‰€æœ‰åŠ æƒå‘é‡åŠ å’Œï¼Œäº§ç”Ÿè¯¥ä½ç½®çš„ self-attention çš„è¾“å‡ºç»“æœã€‚ ä¸Šè¿°å°±æ˜¯ self-attention çš„è®¡ç®—è¿‡ç¨‹ï¼Œç”Ÿæˆçš„å‘é‡æµå…¥å‰å‘ç½‘ç»œã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸Šè¿°è®¡ç®—æ˜¯ä»¥é€Ÿåº¦æ›´å¿«çš„çŸ©é˜µå½¢å¼è¿›è¡Œçš„ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹åœ¨å•è¯çº§åˆ«çš„çŸ©é˜µè®¡ç®—ã€‚ ","date":"2025-07-16","objectID":"/mha/:1:1","tags":["LLM","Attention","NLP"],"title":"MHA","uri":"/mha/"},{"categories":["","LLM","attention","NLP"],"content":"çŸ©é˜µè®¡ç®— ç¬¬ä¸€æ­¥ï¼Œè®¡ç®— query/key/value matrixï¼Œå°†æ‰€æœ‰è¾“å…¥è¯å‘é‡åˆå¹¶æˆè¾“å…¥çŸ©é˜µ \\(X\\)ï¼Œå¹¶ä¸”å°†å…¶åˆ†åˆ«ä¹˜ä»¥æƒé‡çŸ©é˜µ \\(W^q, W^k,W^v\\) æœ€åï¼Œé‰´äºæˆ‘ä»¬ä½¿ç”¨çŸ©é˜µå¤„ç†ï¼Œå°†æ­¥éª¤ 2~6 åˆå¹¶æˆä¸€ä¸ªè®¡ç®— self-attention å±‚è¾“å‡ºçš„å…¬å¼ã€‚ ","date":"2025-07-16","objectID":"/mha/:1:2","tags":["LLM","Attention","NLP"],"title":"MHA","uri":"/mha/"},{"categories":["","LLM","attention","NLP"],"content":"å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ è®ºæ–‡è¿›ä¸€æ­¥å¢åŠ äº† multi-headed çš„æœºåˆ¶åˆ° self-attention ä¸Šï¼Œåœ¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢æé«˜äº† attention å±‚çš„æ•ˆæœï¼š å¤šå¤´æœºåˆ¶æ‰©å±•äº†æ¨¡å‹é›†ä¸­äºä¸åŒä½ç½®çš„èƒ½åŠ›ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œz 1 åªåŒ…å«äº†å…¶ä»–è¯çš„å¾ˆå°‘ä¿¡æ¯ï¼Œä»…ç”±å®é™…è‡ªå·±è¯å†³å®šã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ç¿»è¯‘ â€œThe animal didnâ€™t cross the street because it was too tiredâ€æ—¶ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å•è¯â€itâ€æŒ‡çš„æ˜¯ä»€ä¹ˆã€‚ å¤šå¤´æœºåˆ¶èµ‹äºˆ attention å¤šç§å­è¡¨è¾¾æ–¹å¼ã€‚åƒä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œåœ¨å¤šå¤´ä¸‹æœ‰å¤šç»„ query/key/value-matrixï¼Œè€Œéä»…ä»…ä¸€ç»„ï¼ˆè®ºæ–‡ä¸­ä½¿ç”¨ 8-headsï¼‰ã€‚æ¯ä¸€ç»„éƒ½æ˜¯éšæœºåˆå§‹åŒ–ï¼Œç»è¿‡è®­ç»ƒä¹‹åï¼Œè¾“å…¥å‘é‡å¯ä»¥è¢«æ˜ å°„åˆ°ä¸åŒçš„å­è¡¨è¾¾ç©ºé—´ä¸­ã€‚ å¦‚æœæˆ‘ä»¬è®¡ç®— multi-headed self-attention çš„ï¼Œåˆ†åˆ«æœ‰å…«ç»„ä¸åŒçš„ Q/K/V matrixï¼Œæˆ‘ä»¬å¾—åˆ°å…«ä¸ªä¸åŒçš„çŸ©é˜µã€‚ è¿™ä¼šå¸¦æ¥ç‚¹éº»çƒ¦ï¼Œå‰å‘ç½‘ç»œå¹¶ä¸èƒ½æ¥æ”¶å…«ä¸ªçŸ©é˜µï¼Œè€Œæ˜¯å¸Œæœ›è¾“å…¥æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæ‰€ä»¥è¦æœ‰ç§æ–¹å¼å¤„ç†ä¸‹å…«ä¸ªçŸ©é˜µåˆå¹¶æˆä¸€ä¸ªçŸ©é˜µã€‚ ä¸Šè¿°å°±æ˜¯å¤šå¤´è‡ªæ³¨æ„æœºåˆ¶çš„å†…å®¹ï¼Œæˆ‘è®¤ä¸ºè¿˜ä»…æ˜¯ä¸€éƒ¨åˆ†çŸ©é˜µï¼Œä¸‹é¢å°è¯•ç€å°†å®ƒä»¬æ”¾åˆ°ä¸€ä¸ªå›¾ä¸Šå¯è§†åŒ–å¦‚ä¸‹ã€‚ #### ä»£ç  ä¸‹é¢å®ç°ä¸€ä¸‹å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨åŸè®ºæ–‡ä¸­ï¼Œå®ç°çš„æ–¹æ³•å¦‚ä¸‹ï¼š ä¹Ÿå°±æ˜¯å¯¹æ¯ä¸ª W è¿›è¡Œå¤šå¤´çš„è®¾ç½®ï¼Œå³ä¸ºåŸç»´åº¦/headï¼Œç„¶åæ‹¼æ¥åï¼Œå†ç»è¿‡ \\(hd_v\\times d_{model}\\) çš„è½¬æ¢åˆå¾—åˆ°åŸæ¥çš„ç»´åº¦ï¼Œä»£ç çš„å®ç°ä¸å¤ªä¸€æ ·ï¼Œä»£ç æ˜¯ W è¿˜æ˜¯ \\(d_{model}\\times d_{model}\\) çš„çŸ©é˜µç„¶åå¾—åˆ° q, k, v ä¹‹åå†è¿›è¡Œæˆªæ–­ï¼Œå®ç°å¦‚ä¸‹ã€‚ class MultiHeadedAttention(nn.Module): def __init__(self, h, d_model, dropout=0.1) -\u003e None: # hä¸ºheadï¼Œè¿™é‡Œä¸º8ï¼Œd_modelä¸ºembeddingçš„ç»´åº¦ï¼Œè¿™é‡Œä¸º512 super().__init__() assert d_model % h == 0 self.d_k = d_model // h # 64 self.h = h self.Q_Linear = nn.Linear(d_model, d_model) self.K_Linear = nn.Linear(d_model, d_model) self.V_Linear = nn.Linear(d_model, d_model) self.res_Linear = nn.Linear(d_model, d_model) self.attn = None self.dropout = nn.Dropout(p=dropout) def forward(self, query, key, value, mask=None): if mask is not None: mask = mask.unsqueeze(1) batch_size = query.size(0) query = self.Q_Linear(query).view(batch_size, -1, self.h, self.d_k) # (batch_size, seq_len, h, d_k)å³(batch_size, seq_len, 8, 64) query = query.transpose(1, 2) # (batch_size, h, seq_len, d_k)å³(batch_size, 8, seq_len, 64) key = self.K_Linear(key).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) value = self.V_Linear(value).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout) # xä¸º(batch_size, h, seq_len, d_k) # attnä¸º(batch_size, h, seq_len1, seq_len2) x = x.transpose(1, 2).contiguous().view(batch_size, -1, self.h * self.d_k) # (batch_size, h, seq_len, d_k) -\u003e (batch_size, seq_len, h, d_k) -\u003e (batch_size, seq_len, h * d_k) = (batch_size, seq_len, 512) return self.res_Linear(x) ","date":"2025-07-16","objectID":"/mha/:1:3","tags":["LLM","Attention","NLP"],"title":"MHA","uri":"/mha/"},{"categories":["","LLM","attention","NLP"],"content":"Masked self-attention åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œä¸»è¦æ˜¯æ¶ˆé™¤åé¢çš„ä¿¡æ¯å¯¹é¢„æµ‹çš„å½±å“ï¼Œå› ä¸º decoder è¾“å…¥çš„æ˜¯æ•´ä¸ªå¥å­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„å‚è€ƒç­”æ¡ˆï¼Œè€Œå®é™…é¢„æµ‹çš„æ—¶å€™å°±æ˜¯é¢„æµ‹åé¢çš„ tokenï¼Œç”¨ä¸åˆ°åé¢çš„ tokenï¼Œå¦‚æœä¸ mask æ‰ï¼Œå½“å‰çš„ token å°†çœ‹åˆ°â€œæœªæ¥â€ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› æ­¤å¿…é¡»è¦ mask æ‰ã€‚ å…¶å® decoder é‡Œçš„ sequence mask ä¸ encoder é‡Œçš„ padding mask å¼‚æ›²åŒå·¥ï¼Œpadding mask å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†ä½¿å¥å­é•¿åº¦ä¸€è‡´è¿›è¡Œäº† paddingï¼Œè€Œä¸ºäº†é¿å…å…³æ³¨ padding çš„ä½ç½®ï¼Œè¿›è¡Œäº† maskï¼Œå…·ä½“çš„åšæ³•å°±æ˜¯å°†è¿™äº›ä½ç½®çš„å€¼å˜æˆè´Ÿæ— ç©·ï¼Œè¿™æ · softmax ä¹‹åå°±æ¥è¿‘äº 0 äº†ã€‚ è€Œ sequence mask æ€æƒ³ä¹Ÿå·®ä¸å¤šï¼š å‡è®¾ç°åœ¨è§£ç å™¨çš„è¾“å…¥â€\u003c s \u003e who am i \u003c e \u003eâ€œåœ¨åˆ†åˆ«ä¹˜ä¸Šä¸€ä¸ªçŸ©é˜µè¿›è¡Œçº¿æ€§å˜æ¢åå¾—åˆ°äº† Qã€Kã€Vï¼Œä¸” Q ä¸ K ä½œç”¨åå¾—åˆ°äº†æ³¨æ„åŠ›æƒé‡çŸ©é˜µï¼ˆæ­¤æ—¶è¿˜æœªè¿›è¡Œ softmax æ“ä½œï¼‰ï¼Œå¦‚å›¾ 17 æ‰€ç¤ºã€‚ æ­¤æ—¶å·²ç»è®¡ç®—å¾—åˆ°äº†æ³¨æ„åŠ›æƒé‡çŸ©é˜µã€‚ç”±ç¬¬ 1 è¡Œçš„æƒé‡å‘é‡å¯çŸ¥ï¼Œåœ¨è§£ç ç¬¬ 1 ä¸ªæ—¶åˆ»æ—¶åº”è¯¥å°† 20%ï¼ˆä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯ç»è¿‡ softmax åçš„å€¼ï¼‰çš„æ³¨æ„åŠ›æ”¾åˆ°â€™\u003c s \u003eâ€™ä¸Šï¼Œ30%çš„æ³¨æ„åŠ›æ”¾åˆ°â€™whoâ€™ä¸Šç­‰ç­‰ã€‚ä¸è¿‡æ­¤æ—¶æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæ¨¡å‹åœ¨å®é™…çš„é¢„æµ‹è¿‡ç¨‹ä¸­åªæ˜¯å°†å½“å‰æ—¶åˆ»ä¹‹å‰ï¼ˆåŒ…æ‹¬å½“å‰æ—¶åˆ»ï¼‰çš„æ‰€æœ‰æ—¶åˆ»ä½œä¸ºè¾“å…¥æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡å‹åœ¨é¢„æµ‹æ—¶æ˜¯çœ‹ä¸åˆ°å½“å‰æ—¶åˆ»ä¹‹åçš„ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTransformer ä¸­çš„ Decoder é€šè¿‡åŠ å…¥æ³¨æ„åŠ›æ©ç æœºåˆ¶æ¥è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚ å½“ç„¶è¿˜è¦è¿›è¡Œ softmax ç­‰è®¡ç®—ã€‚ åœ¨ç½‘ä¸ŠæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œè¯´æ³•éƒ½å¾ˆä¸ä¸€æ ·ï¼Œä¸è¿‡æˆ‘æ›´å€¾å‘äºè¿™æ ·çš„çœ‹æ³•ã€‚è€Œåœ¨é¢„æµ‹çš„æ—¶å€™æ˜¯ç”¨å‰é¢çš„è¾“å‡ºç»“æœä½œä¸ºè¾“å…¥çš„ã€‚ å‡ å¼ å›¾å¸®åŠ©ç†è§£ï¼š åé¢è¿˜æœ‰ padding maskï¼Œæ‰€æœ‰çš„ self attention éƒ½è¦ç”¨è¿™ä¸ªï¼Œå› ä¸º pad çš„ä½ç½®æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å®è·µä¸€ä¸‹åŠ æ·±ç†è§£ï¼š é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰æ¨¡å‹ï¼š # è¯å…¸æ•°ä¸º10ï¼Œ è¯å‘é‡ç»´åº¦ä¸º8 embedding = nn.Embedding(10, 8) # å®šä¹‰Transformerï¼Œæ³¨æ„ä¸€å®šè¦æ”¹æˆevalæ¨¡å‹ï¼Œå¦åˆ™æ¯æ¬¡è¾“å‡ºç»“æœä¸ä¸€æ · transformer = nn.Transformer(d_model=8, batch_first=True).eval() æ¥ä¸‹æ¥å®šä¹‰æˆ‘ä»¬çš„ src å’Œ tgtï¼š # Encoderçš„è¾“å…¥ src = torch.LongTensor([[0, 1, 2, 3, 4]]) # Decoderçš„è¾“å…¥ tgt = torch.LongTensor([[4, 3, 2, 1, 0]]) ç„¶åæˆ‘ä»¬å°† [4] é€ç»™ Transformer è¿›è¡Œé¢„æµ‹ï¼Œæ¨¡æ‹Ÿæ¨ç†æ—¶çš„ç¬¬ä¸€æ­¥ï¼š transformer(embedding(src), embedding(tgt[:, :1]), # è¿™ä¸ªå°±æ˜¯ç”¨æ¥ç”Ÿæˆé˜¶æ¢¯å¼çš„maskçš„ tgt_mask=nn.Transformer.generate_square_subsequent_mask(1)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) ç„¶åæˆ‘ä»¬å°† [4, 3] é€ç»™ Transformerï¼Œæ¨¡æ‹Ÿæ¨ç†æ—¶çš„ç¬¬äºŒæ­¥ï¼š transformer(embedding(src), embedding(tgt[:, :2]), tgt_mask=nn.Transformer.generate_square_subsequent_mask(2)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598], [ 1.2726, -0.3516, 0.6584, 0.3297, 1.1161, -1.4204, -1.5652, -0.0396]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) å‡ºçš„ç¬¬ä¸€ä¸ªå‘é‡å’Œä¸Šé¢é‚£ä¸ªä¸€æ¨¡ä¸€æ ·ã€‚ æœ€åæˆ‘ä»¬å†å°† tgt ä¸€æ¬¡æ€§é€ç»™ transformerï¼Œæ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹ï¼š transformer(embedding(src), embedding(tgt), tgt_mask=nn.Transformer.generate_square_subsequent_mask(5)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598], [ 1.2726, -0.3516, 0.6584, 0.3297, 1.1161, -1.4204, -1.5652, -0.0396], [ 1.4799, -0.3575, 0.8310, 0.1642, 0.8811, -1.3140, -1.5643, -0.1204], [ 1.4359, -0.6524, 0.8377, 0.1742, 1.0521, -1.3222, -1.3799, -0.1454], [ 1.3465, -0.3771, 0.9107, 0.1636, 0.8627, -1.5061, -1.4732, 0.0729]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) å¯ä»¥çœ‹åˆ°ä½¿ç”¨ mask åå°±å¯ä»¥ä¿è¯å‰é¢çš„ç»“æœéƒ½æ˜¯ä¸å˜çš„ï¼Œä¸ç„¶å¦‚æœæ²¡æœ‰ mask åˆ™è®¡ç®— attention æ—¶å› ä¸ºè®¡ç®—æ³¨æ„åŠ›å˜åŒ–æ‰€ä»¥ç»“æœéƒ½ä¼šå˜åŒ–ï¼Œè¿™å°±æ˜¯ Mask self-attention çš„æ„ä¹‰ã€‚ åˆ°è¿™é‡Œ self-attention å°±ä»‹ç»å®Œäº† ","date":"2025-07-16","objectID":"/mha/:1:4","tags":["LLM","Attention","NLP"],"title":"MHA","uri":"/mha/"},{"categories":[""],"content":" image.png æ ‡å‡†çš„ mha ä¸­ï¼ŒKV heads çš„æ•°é‡å’Œ Query heads çš„æ•°é‡ç›¸åŒï¼Œæ¯ä¸€ä¸ª q head å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ kv headï¼Œä½†è¿™æ ·çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ MQA (Multi Queries Attention): MQA æ¯”è¾ƒæç«¯ï¼Œåªä¿ç•™ä¸€ä¸ª KV Headï¼Œå¤šä¸ª Query Heads å…±äº«ç›¸åŒçš„ KV Headã€‚è¿™ç›¸å½“äºä¸åŒ Head çš„ Attention å·®å¼‚ï¼Œå…¨éƒ¨éƒ½æ”¾åœ¨äº† Query ä¸Šï¼Œéœ€è¦æ¨¡å‹ä»…ä»ä¸åŒçš„ Query Heads ä¸Šå°±èƒ½å¤Ÿå…³æ³¨åˆ°è¾“å…¥ hidden states ä¸åŒæ–¹é¢çš„ä¿¡æ¯ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæå¤§åœ°é™ä½äº† KV Cache çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ¨¡å‹æ•ˆæœæœ‰æ‰€ä¸‹é™ã€‚ï¼ˆå±‚å†…å…±äº«ï¼‰ ","date":"2025-07-16","objectID":"/mqa/:0:0","tags":null,"title":"MQA","uri":"/mqa/"},{"categories":["RLHF","LLM"],"content":"DAPO æ˜¯å¯¹ GRPO çš„æ”¹è¿›ã€‚DAPOï¼ˆDecoupled Clip and Dynamic sAmpling Policy Optimizationï¼Œå³è§£è€¦è£å‰ªå’ŒåŠ¨æ€é‡‡æ ·ç­–ç•¥ä¼˜åŒ–ï¼‰çš„ä¼˜åŒ–ç‚¹æœ‰å››ä¸ªï¼ˆå…¶ä¸­å‰ 2 ä¸ªæ˜¯ä¸»è¦äº®ç‚¹ï¼Œæ˜¯å‘½åçš„æ¥æºï¼‰ image.png ","date":"2025-07-15","objectID":"/dapo/:0:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["RLHF","LLM"],"content":"æ›´é«˜è£å‰ª clipçš„ä¸Šè¾¹ç•Œå¯ä»¥æ”¾å®½ä¸€äº›ï¼Œå³ clip_high ä» 0.2 æé«˜åˆ°äº† 0.28ã€‚ ä¼ ç»Ÿçš„PPOç®—æ³•ä¸­ï¼Œä¸Šé™è£å‰ªï¼ˆupper clipï¼‰ä¼šé™åˆ¶ç­–ç•¥çš„æ¢ç´¢èƒ½åŠ›ã€‚è¿™ä¸ªé—®é¢˜åœ¨ä½æ¦‚ç‡çš„â€æ¢ç´¢å‹â€tokenä¸Šç‰¹åˆ«æ˜æ˜¾ï¼Œå› ä¸ºè¿™äº›tokençš„æ¦‚ç‡æå‡ä¼šè¢«é™åˆ¶åœ¨ä¸€ä¸ªä¸¥æ ¼çš„èŒƒå›´å†…ã€‚è¿™å¯¼è‡´äº†â€ç†µåå¡Œâ€ç°è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ç­–ç•¥çš„ä¿¡æ¯ç†µä¸‹é™ï¼Œé‡‡æ ·çš„å“åº”è¶‹äºå‡ ä¸ªç›¸åŒçš„ç»“æœï¼Œé™åˆ¶äº†æ¢ç´¢ã€‚DAPOé€šè¿‡è°ƒæ•´ä¸Šé™ehighè£å‰ªèŒƒå›´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡æé«˜ehighçš„å€¼ï¼Œä¸ºä½æ¦‚ç‡tokençš„æ¦‚ç‡æå‡ç•™å‡ºæ›´å¤šç©ºé—´ã€‚å®éªŒè¯æ˜è¿™ç§æ–¹æ³•æœ‰æ•ˆå¢å¼ºäº†ç­–ç•¥çš„æ¢ç´¢æ€§ï¼ŒæˆåŠŸè§£å†³äº†ç†µåå¡Œé—®é¢˜ã€‚ ","date":"2025-07-15","objectID":"/dapo/:1:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["RLHF","LLM"],"content":"åŠ¨æ€é‡‡æ ·ï¼ˆDynamic Samplingï¼‰ åœ¨ç°æœ‰çš„RLç®—æ³•ä¸­ï¼Œå¦‚æœæŸäº›æç¤ºçš„å‡†ç¡®ç‡è¾¾åˆ°1æ—¶ï¼Œä¼šé‡åˆ°æ¢¯åº¦ä¸‹é™çš„é—®é¢˜ã€‚æ¯”å¦‚åœ¨GRPOä¸­ï¼Œå¦‚æœä¸€ä¸ªç‰¹å®šæç¤ºçš„æ‰€æœ‰è¾“å‡ºéƒ½æ˜¯æ­£ç¡®çš„å¹¶è·å¾—ç›¸åŒçš„å¥–åŠ±ï¼Œé‚£ä¹ˆè¿™ç»„æ•°æ®çš„ä¼˜åŠ¿ï¼ˆadvantageï¼‰å°±ä¼šå˜ä¸ºé›¶ã€‚è¿™ç§æƒ…å†µä¼šå¯¼è‡´ç­–ç•¥æ¢¯åº¦ä¸ºé›¶ï¼Œç¼©å°äº†æ‰¹æ¬¡æ¢¯åº¦çš„å¹…åº¦å¹¶å¢åŠ äº†å™ªå£°æ•æ„Ÿæ€§ï¼Œé™ä½äº†é‡‡æ ·æ•ˆç‡ã€‚éšç€è®­ç»ƒçš„è¿›è¡Œï¼Œå‡†ç¡®ç‡ä¸º1çš„æ ·æœ¬æ•°é‡ä¸æ–­å¢åŠ ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæ‰¹æ¬¡ä¸­æœ‰æ•ˆæç¤ºçš„æ•°é‡ä¸æ–­å‡å°‘ï¼Œå¯¼è‡´æ¢¯åº¦æ–¹å·®å¢å¤§å¹¶å‰Šå¼±äº†æ¨¡å‹è®­ç»ƒçš„æ¢¯åº¦ä¿¡å·ã€‚åŒæ ·åœ°ï¼Œå‡†ç¡®ç‡ä¸º0çš„æ ·æœ¬ä¹Ÿä¼šå¯¼è‡´é›¶æ¢¯åº¦é—®é¢˜ã€‚DAPOçš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨è®­ç»ƒå‰ï¼Œé‡‡æ ·å¹¶è¿‡æ»¤å‡†ç¡®ç‡ä¸º1å’Œ0çš„æç¤ºï¼Œç¡®ä¿è®­ç»ƒæ‰¹æ¬¡ä¸­æœ‰å……æ»¡å‡†ç¡®ç‡æ—¢é0ä¹Ÿé1çš„æ ·æœ¬ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ‰¹æ¬¡ä¸­æ‰€æœ‰çš„æç¤ºéƒ½å¸¦æœ‰æœ‰æ•ˆçš„æ¢¯åº¦ä¿¡å·ï¼Œä¿æŒäº†æ‰¹æ¬¡ä¸­æœ‰æ•ˆæç¤ºæ•°é‡çš„ä¸€è‡´æ€§ï¼Œä»è€Œæé«˜äº†è®­ç»ƒæ•ˆç‡å’Œç¨³å®šæ€§ã€‚ image.png image.png ","date":"2025-07-15","objectID":"/dapo/:2:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["RLHF","LLM"],"content":"Token çº§ç­–ç•¥æ¢¯åº¦æŸå¤±ï¼ˆToken-Level Policy Gradient Lossï¼‰ è¿™ç§ç­–ç•¥å¯ä»¥ä½¿å¾—response lengthç¨³æ­¥å¢é•¿ï¼Œè€Œä¸æ˜¯æ³¢åŠ¨å¤§ã€‚ image.png image.png ","date":"2025-07-15","objectID":"/dapo/:3:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["RLHF","LLM"],"content":"è¶…é•¿å¥–åŠ±å¡‘é€ ï¼ˆOverlong Reward Shapingï¼‰ image.png image.png ","date":"2025-07-15","objectID":"/dapo/:4:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["RLHF","LLM"],"content":"å‚è€ƒ # DAPOå…¨æ˜¯å·²æœ‰çš„å°trickï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆç«? ","date":"2025-07-15","objectID":"/dapo/:5:0","tags":["LLM","RLHF"],"title":"dapo","uri":"/dapo/"},{"categories":["Attention","LLM"],"content":"Safe softmax å¹¶æ²¡æœ‰ 1-pass ç®—æ³•ï¼Œé‚£ä¹ˆ Attention ä¼šä¸ä¼šæœ‰å‘¢ï¼Ÿæœ‰ï¼è¿™å°±æ˜¯ FlashAttentionï¼ åœ¨ä½¿ç”¨ online attention çš„æƒ…å†µä¸‹ï¼Œä»å¤´å¼€å§‹è®¡ç®— attention score çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š \\(\\operatorname{NOTATIONS}\\) \\(Q[k,:]:\\) the \\(k\\) -th row vector of \\(Q\\) matrix. \\(\\begin{aligned}O[k,:]:\\mathrm{~the~}k\\text{-th row of output }O\\mathrm{~matrix.}\\\\\\mathbf{V}[i,i]:\\mathrm{~the~}k\\text{-th row of output }O\\mathrm{~matrix.}\\end{aligned}\\) \\(V[i,:]{:\\text{ the }i\\text{-th row of }V\\text{ matrix}}.\\) \\(\\{\\boldsymbol{o}_i\\}{:}\\sum_{j=1}^ia_jV[j,:]\\), a row vector storing partial aggregation result \\(A[k,:i]\\times V[:i,:]\\) BODY \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[\\begin{aligned}x_i\u0026\\leftarrow\\quad Q[k,:]\\:K^T[:,i]\\\\m_i\u0026\\leftarrow\\quad\\max\\left(m_{i-1},x_i\\right)\\\\d_i'\u0026\\leftarrow\\quad d_{i-1}'e^{m_{i-1}-m_i}+e^{x_i-m_i}\\end{aligned}\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[\\begin{aligned}\u0026a_i\\:\\leftarrow\\:\\frac{e^{x_i-m_N}}{d_N^{\\prime}}\\\\\u0026o_i\\:\\leftarrow\\:o_{i-1}+a_i\\:V[i,:\\:]\\end{aligned}\\] \\(\\mathbf{end}\\) \\[O[k,:]\\leftarrow\\boldsymbol{o}_N\\] ä¼˜åŒ–æ€è·¯å’Œ online attention ä¸€æ ·ï¼Œå°† \\(o_{i}\\) çš„è®¡ç®—ç®€åŒ–ä»¥ä¾¿äºå¯ä»¥å†™æˆè¿­ä»£å¼ã€‚ åŸæ¥çš„ \\(o_{i}\\) ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼Œä¾èµ–äºå…¨å±€çš„ \\(m_{N}\\) å’Œ \\(d_{N}\\)ã€‚ \\[\\boldsymbol{o}_i:=\\sum_{j=1}^i\\left(\\frac{e^{x_j-m_N}}{d_N^{\\prime}}V[j,:]\\right)\\] å°†å…¶æ”¹å†™æˆå¦‚ä¸‹å½¢å¼ï¼š \\[\\boldsymbol{o}_i^{\\prime}:=\\left(\\sum_{j=1}^i\\frac{e^{x_j-m_i}}{d_i^{\\prime}}V[j,:]\\right)\\] è¿™æ ·æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼æ‹“å±•ä¸‹å»ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ªç¯è¿­ä»£å¼ã€‚ \\[\\begin{aligned} \\mathbf{o}_i^{\\prime}\u0026 =\\sum_{j=1}^i\\frac{e^{x_j-m_i}}{d'}V[j,:] \\\\ \u0026= \\left(\\sum_{j=1}^{i-1}\\frac{e^{x_j-m_i}}{d_i^{\\prime}}V[j,:] \\right)+\\frac{e^{x_i-m_i}}{d_i^{\\prime}}V[i,:] \\\\ \u0026= \\left(\\sum_{j=1}^{i-1}\\frac{e^{x_j-m_{i-1}}}{d_{i-1}^{\\prime}}\\frac{e^{x_j-m_i}}{e^{x_j-m_{i-1}}}\\frac{d_{i-1}^{\\prime}}{d_i^{\\prime}}V[j,:]\\right)+\\frac{e^{x_i-m_i}}{d_i^{\\prime}}V[i,:] \\\\ \u0026= \\left(\\sum_{j=1}^{i-1}\\frac{e^{x_j-m_{i-1}}}{d_{i-1}^{\\prime}}V[j,.]\\right)\\frac{d_{i-1}^{\\prime}}{d_i^{\\prime}}e^{m_{i-1}-m_i}+\\frac{e^{x_i-m_i}}{d_i^{\\prime}}V[i,.] \\\\ \u0026= \\boldsymbol{o}_{i-1}'\\frac{d_{i-1}'e^{m_{i-1}-m_i}}{d_i'}+\\frac{e^{x_i-m_i}}{d_i'}V[i,:] \\end{aligned}\\] è¿™æ ·å°±æ‰¾åˆ°äº† \\(o_{i}\\) çš„é€’æ¨è¡¨è¾¾å¼ã€‚ ä¹‹åå¯¹ Q, K è¿›è¡Œ tiling åè®¡ç®—ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š \\[\\begin{aligned}\u0026\\textbf{for }i\\leftarrow1,\\#\\text{tiles do}\\\\\u0026\u0026\u0026\\boldsymbol{x}_i\\quad\\leftarrow\\quad Q[k;\\cdot] K^T[\\cdot,(i-1) b; i b]\\\\\u0026\u0026\u0026m_i^{(\\mathrm{local})}=\\begin{array}{c}\\overset{b}{\\operatorname*{max}}\\left(\\boldsymbol{x}_i[j]\\right)\\\\\\end{array}\\\\\u0026\u0026\u0026m_i \\leftarrow \\max\\left(m_{i-1},m_i^{(\\mathrm{local})}\\right)\\\\\u0026\u0026\u0026a_i^{\\prime} \\leftarrow d_{i-1}^{\\prime}e^{m_{i-1}-m_i}+\\sum_{j=1}^be^{\\boldsymbol{x}_i[j]-m_i}\\\\\u0026\u0026\u0026\\boldsymbol{o}_i^{\\prime} \\leftarrow \\boldsymbol{o}_{i-1}^{\\prime}\\frac{d_{i-1}^{\\prime}e^{m_{i-1}-m_i}}{d_i^{\\prime}}+\\sum_{j=1}^b\\frac{e^{\\boldsymbol{x}_i[j]-m_i}}{d_i^{\\prime}}V[(i-1) b+j,:]\\\\\u0026\\text{end}\\\\\u0026\u0026\u0026O[k,:]\\leftarrow\\boldsymbol{o}_{N/b}^{\\prime}\\end{aligned}\\] å¯¹äº tilesï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š å¯ä»¥ç†è§£æˆæ»‘åŠ¨çª—å£ï¼Œ\\(K^{T}\\) ä»å·¦å‘å³æ»‘åŠ¨ï¼ˆæŒ‰åˆ—è¯»å–ï¼‰ï¼Œ\\(V\\) ä»ä¸Šå‘ä¸‹æ»‘åŠ¨ï¼ˆæŒ‰è¡Œè¯»å–ï¼‰ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ç†è§£æˆåˆ†å—çŸ©é˜µï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œå‚è€ƒï¼šCuda ç¼–ç¨‹ä¹‹ Tiling - çŸ¥ä¹ (zhihu.com) ","date":"2025-07-15","objectID":"/flash-attention/:0:0","tags":["Attention"],"title":"flash attention","uri":"/flash-attention/"},{"categories":["Attention","LLM"],"content":"å‚è€ƒ From Online Softmax to FlashAttention.Â ) ","date":"2025-07-15","objectID":"/flash-attention/:1:0","tags":["Attention"],"title":"flash attention","uri":"/flash-attention/"},{"categories":["Attention","LLM"],"content":" image.png å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒGQA å°±æ˜¯åœ¨ MHA å’Œ MQA ä¹‹é—´åšäº†ä¸€ä¸ªå¹³è¡¡ã€‚å¯¹ query heads è¿›è¡Œåˆ†ç»„ï¼Œåˆ†æˆå‡ ç»„å°±å¯¹åº”å¤šå°‘ä¸ª kv headsï¼Œç„¶åæ¯ä¸€ç»„å†…çš„ query Heads å…±äº«ç›¸åŒçš„ KV headã€‚ GQA å¯ä»¥åœ¨å‡å°‘è®¡ç®—é‡å’Œ KV Cache åŒæ—¶ç¡®ä¿æ¨¡å‹æ•ˆæœä¸å—åˆ°å¤§çš„å½±å“ã€‚ ç°åœ¨åŸºæœ¬éƒ½ä½¿ç”¨ GQAï¼Œä»£ç å¦‚ä¸‹ï¼ˆæ ¸å¿ƒæ˜¯ repeat_kv å‡½æ•°ï¼‰ï¼š ```python def repeat_kv(x: torch.Tensor, n_rep: int) -\u003e torch.Tensor: â€œâ€œâ€œtorch.repeat_interleave(x, dim=2, repeats=n_rep)â€â€œâ€ bs, slen, n_kv_heads, head_dim = x.shape if n_rep == 1: return x return ( x[:, :, :, None, :] .expand(bs, slen, n_kv_heads, n_rep, head_dim) .reshape(bs, slen, n_kv_heads * n_rep, head_dim) ) class Attention(nn.Module): â€œâ€œâ€œMulti-head attention module.â€â€œâ€ def __init__(self, args: ModelArgs): \"\"\" Initialize the Attention module. Args: args (ModelArgs): Model configuration parameters. Attributes: n_kv_heads (int): Number of key and value heads. n_local_heads (int): Number of local query heads. n_local_kv_heads (int): Number of local key and value heads. n_rep (int): Number of repetitions for local heads. head_dim (int): Dimension size of each attention head. wq (ColumnParallelLinear): Linear transformation for queries. wk (ColumnParallelLinear): Linear transformation for keys. wv (ColumnParallelLinear): Linear transformation for values. wo (RowParallelLinear): Linear transformation for output. cache_k (torch.Tensor): Cached keys for attention. cache_v (torch.Tensor): Cached values for attention. \"\"\" super().__init__() self.n_kv_heads = args.n_heads if args.n_kv_heads is None else args.n_kv_heads model_parallel_size = fs_init.get_model_parallel_world_size() self.n_local_heads = args.n_heads // model_parallel_size self.n_local_kv_heads = self.n_kv_heads // model_parallel_size self.n_rep = self.n_local_heads // self.n_local_kv_heads self.head_dim = args.dim // args.n_heads self.wq = ColumnParallelLinear( args.dim, args.n_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wk = ColumnParallelLinear( args.dim, self.n_kv_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wv = ColumnParallelLinear( args.dim, self.n_kv_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wo = RowParallelLinear( args.n_heads * self.head_dim, args.dim, bias=False, input_is_parallel=True, init_method=lambda x: x, ) # kv_cacheæ˜¯ç¼“å­˜é”®å€¼å¯¹ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªä¿å­˜æœ€è¿‘nä¸ªé”®å€¼å¯¹ self.cache_k = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() self.cache_v = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() def forward( self, x: torch.Tensor, start_pos: int, freqs_cis: torch.Tensor, mask: Optional[torch.Tensor], ): \"\"\" Forward pass of the attention module. Args: x (torch.Tensor): Input tensor. start_pos (int): Starting position for caching. freqs_cis (torch.Tensor): Precomputed frequency tensor. mask (torch.Tensor, optional): Attention mask tensor. Returns: torch.Tensor: Output tensor after attention. \"\"\" # å‡è®¾å½“å‰xä¸º(1, 1, dim)ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªé¢„æµ‹çš„token # self-attentionçš„è¾“å…¥ï¼Œæ ‡å‡†çš„(bs, seqlen, hidden_dim) bsz, seqlen, _ = x.shape # è®¡ç®—å½“å‰tokençš„qkv # q k våˆ†åˆ«è¿›è¡Œæ˜ å°„ï¼Œæ³¨æ„è¿™é‡Œkey, valueä¹Ÿéœ€è¦å…ˆç”±è¾“å…¥è¿›è¡Œæ˜ å°„å†å’Œkv_cacheé‡Œé¢çš„key, valueè¿›è¡Œæ‹¼æ¥ xq, xk, xv = self.wq(x), self.wk(x), self.wv(x) xq = xq.view(bsz, seqlen, self.n_local_heads, self.head_dim) xk = xk.view(bsz, seqlen, self.n_local_kv_heads, self.head_dim) xv = xv.view(bsz, seqlen, self.n_local_kv_heads, self.head_dim) # å¯¹å½“å‰è¾“å…¥çš„queryå’Œkeyè¿›è¡ŒRoPEï¼Œæ³¨æ„kv_cacheé‡Œé¢çš„keyå·²ç»åšè¿‡äº†RoPE xq, xk = apply_rotary_emb(xq, xk, freqs_cis=freqs_cis) # ç¼“å­˜å½“å‰tokençš„kv self.cache_k = self.cache_k.to(xq) self.cache_v = self.cache_v.to(xq) self.cache_k[:bsz, start_pos: start_pos + seqlen] = xk self.cache_v[:bsz, start_pos: start_pos + seqlen] = xv # å–å‡ºå‰seqlenä¸ªtokençš„kvç¼“å­˜ # å–å‡ºå…¨éƒ¨ç¼“å­˜çš„keyå’Œvalueï¼ˆåŒ…æ‹¬ä¹‹å‰åœ¨cacheé‡Œé¢çš„å’Œæœ¬æ¬¡è¾“å…¥çš„ï¼‰ï¼Œä½œä¸ºæœ€ç»ˆçš„keyå’Œvalue keys = self.cache_k[:bsz, : start_pos + seqlen] values = self.cache_v[:bsz, : start_pos + seqlen] # å°†kvé‡å¤å¡«å……ï¼Œä½¿kvå’Œqçš„å¤´æ•°ä¸ªæ•°ç›¸åŒ # repeat k/v heads if n_kv_heads \u003c n_headsï¼Œå¯¹é½å¤´çš„æ•°é‡ keys = repeat_kv(keys, self.n_rep) # (bs, cache_len + seqlen, n_local_heads, head_dim) values = repea","date":"2025-07-15","objectID":"/gqa/:0:0","tags":["Attention"],"title":"GQA","uri":"/gqa/"},{"categories":["RLHF","LLM"],"content":"GRPO (trl åº“) ","date":"2025-07-15","objectID":"/grpo/:0:0","tags":["LLM","RLHF"],"title":"grpo","uri":"/grpo/"},{"categories":["RLHF","LLM"],"content":"é‡è¦å‚æ•° Num_generations: Number of generations to sample. The effective batch size (num_processes * per_device_batch_size * gradient_accumulation_steps) must be evenly divisible by this value. generation_batch_size: Batch size to use for generation. If None, it defaults to the effective training batch size: per_device_train_batch_size * num_processes * steps_per_generation. steps_per_generation: Number of optimization steps per generation. If None, it defaults to gradient_accumulation_steps. Num_iterations: Number of iterations per batch (denoted as Î¼ in the algorithm). Per_device_train_batch_size Num_processes (world_size) trl åº“çš„é‡è¦å‚æ•°æ¯”è¾ƒå°‘ã€‚å…¶ä¸­æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œgeneration_batch_size = `per_device_train_batch_size * num_processes * steps_per_generation Gradient_accumulation_steps ä¸€èˆ¬å°±æ˜¯ steps_per_generation (å¯¹åº” verl ä¸­çš„ mini_batch_size / n_gpus / ppo_micro_batch_size_per_gpu)ï¼Œå¯ä»¥ç†è§£ä¸º per_device_train_bs (å¯¹åº” verl ä¸­çš„ ppo_micro_batch_size_per_gpu) æ˜¯ä½¿ç”¨æ¢¯åº¦ç´¯è®¡åçš„ bsï¼Œä¹˜ gpu æ•°ï¼Œå†ä¹˜æ¢¯åº¦ç´¯è®¡çš„ steps å°±æ˜¯æ€»çš„ batch_sizeï¼ˆå¯¹åº” verl ä¸­çš„ train_batch_size * rollout. Nï¼‰ã€‚æ‰€ä»¥æ³¨æ„ï¼Œæ€»çš„ batch_size (generation_batch_size) æ˜¯å·²ç» rollout é‡‡æ ·åçš„ bsï¼Œé™¤ä»¥ num_generations æ‰æ˜¯é’ˆå¯¹ prompts çš„ bsï¼ˆverl ä¸­çš„ train_batch_sizeï¼‰ã€‚ ä¸‹é¢æ˜¯_get_train_sampler æ–¹æ³•çš„æ³¨é‡Šï¼Œå¯¹æ¯ä¸€ä¸ª prompt é‡å¤ num_generations æ˜¯è¯¥æ–¹æ³•å®ç°çš„ã€‚ if dataset is None: dataset = self.train_dataset return RepeatSampler( data_source=dataset, mini_repeat_count=self.num_generations, # æ¯ä¸ª prompt ç”Ÿæˆ self.num_generations ä¸ª completions # ä¾‹å¦‚ï¼Œå¦‚æœ per_device_train_batch_size=8, num_generations=2, steps_per_generation=4, # åˆ™ generation_batch_size = 8 (per_device_train_batch_size) * 4 (steps_per_generation) = 32 # è¿™é‡Œçš„ batch_size = 32 / 2 = 16ï¼Œè¡¨ç¤ºä¸€ä¸ª \"generation block\" ä¸­æœ‰16ä¸ªä¸åŒçš„promptã€‚ batch_size=self.args.generation_batch_size // self.num_generations, # æ¯ä¸ª \"generation block\" (åŒ…å«16ä¸ªä¸åŒpromptï¼Œæ¯ä¸ªpromptæœ‰2ä¸ªcompletion) ä¼šè¢«ç”¨äº num_iterations * steps_per_generation æ¬¡æ›´æ–° # ä¾‹å¦‚ num_iterations=1, steps_per_generation=4, åˆ™è¿™ä¸ª block ä¼šè¢«é‡å¤ 1*4=4 æ¬¡ï¼Œæ¯æ¬¡å–å‡ºä¸€ä¸ª per_device_train_batch_size çš„æ•°æ®è¿›è¡Œè®­ç»ƒ repeat_count=self.num_iterations * self.args.steps_per_generation, shuffle=self.shuffle_dataset, seed=self.args.seed, ) ç»“åˆä¸‹é¢çš„ä¾‹å­å¸®åŠ©ç†è§£ï¼Œä¾‹å­ä¸­æ¢¯åº¦ç´¯è®¡ steps ä¸ç­‰äº steps_per_generation åœ¨ GRPO_trainer ä¸­ï¼Œæœ€é‡è¦çš„æ–¹æ³•æ˜¯ _generate_and_score_completions æ–¹æ³•ï¼Œè¾“å…¥ä¸º inputï¼Œè¾“å‡ºä¸ºè®¡ç®—å¾—åˆ°çš„ä¼˜åŠ¿å€¼å’Œ old_logp ç”¨äºè®¡ç®— ratioã€‚ä¸€äº›æ ¸å¿ƒçš„éƒ¨åˆ†å’Œæ³¨é‡Šå¦‚ä¸‹ï¼š with unwrap_model_for_generation( self.model_wrapped, self.accelerator, gather_deepspeed3_params=self.args.ds3_gather_for_generation ) as unwrapped_model: with ( FSDP.summon_full_params(self.model_wrapped, recurse=False) if self.is_fsdp_enabled else nullcontext() ): # prompt_ids: (B_gen_local, P_max) # prompt_mask: (B_gen_local, P_max) # prompt_completion_ids: torch.Tensor (B_gen_local, P_max + C_new), C_new æ˜¯ HF generate ç”Ÿæˆçš„æ–° token æ•°é‡ (æœ€å¤§ä¸º max_completion_length) prompt_completion_ids = unwrapped_model.generate( prompt_ids, attention_mask=prompt_mask, generation_config=self.generation_config ) # Compute prompt length and extract completion ids prompt_length = prompt_ids.size(1) # P_max # prompt_ids ä¿æŒä¸å˜: (B_gen_local, P_max) prompt_ids = prompt_completion_ids[:, :prompt_length] # completion_ids: torch.Tensor (B_gen_local, C_new_hf) completion_ids = prompt_completion_ids[:, prompt_length:] ä¸Šé¢ä¸º generate çš„è¿‡ç¨‹ï¼Œä¸è¿‡ç°åœ¨åŸºæœ¬ä¸Šä½¿ç”¨ vllm æˆ–è€… sglang åŠ é€Ÿæ¨ç†ã€‚ä¸ºäº†é€»è¾‘ç®€å•ï¼Œè¿™é‡Œå±•ç¤ºäº† HF generate çš„è¿‡ç¨‹ã€‚Trl å®ç°çš„æ—¶å€™ï¼Œå°†ä¸€ä¸ª prompt é‡‡æ ·å¤šæ¬¡çš„é€»è¾‘å®ç°åœ¨äº† get_train_dataloader æ–¹æ³•ä¸­ï¼Œå³ä¸€å¼€å§‹å°±ä½¿ç”¨ get_train_sampler æ–¹æ³•å¯¹åŒä¸€ä¸ª prompt repeat äº†å¤šæ¬¡ã€‚å› æ­¤è¿™é‡Œä¸éœ€è¦å†è¿›è¡Œ repeatã€‚ ä¹‹åå¾—åˆ°è¡¥å……éƒ¨åˆ†çš„ mask: # Mask everything after the first EOS token # is_eos: torch.Tensor (B_gen_local, C_new), C_new æ˜¯ completion çš„å®é™…é•¿åº¦ (C_max_vllm æˆ– C_new_hf) is_eos = completion_ids == self.processing_class.eos_token_id # eos_idx: torch.Tensor (B_gen_local,), å­˜å‚¨æ¯ä¸ª completion ä¸­ç¬¬ä¸€ä¸ª EOS token çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰EOSåˆ™ä¸ºåºåˆ—é•¿åº¦ eos_idx = torch.full((is_eos.size(0),), is_eos.size(1), dtype=torch.long, device=device) eos_idx[is_eos.any(dim=1)] = is_eos.int().argmax(dim=1)[is_eos.any(dim=1)] sequence_indices = torch.arange(is_eos.size(1), device=device).expand(is_eos.size(0), -1) # completion_mask: torch.Tensor (B_gen_local, C_new), æ ‡è®°æœ‰æ•ˆ token (EOSä¹‹å‰åŠEOSæœ¬èº«) completion_mask = (sequence_","date":"2025-07-15","objectID":"/grpo/:1:0","tags":["LLM","RLHF"],"title":"grpo","uri":"/grpo/"},{"categories":["Attention","LLM"],"content":"3-pass \\(\\mathsf{NO}\\) TATIONS \\(\\{m_i\\}{:}\\max_{j=1}^i\\left\\{x_j\\right\\}\\), with initial value \\(m_0=-\\infty.\\) \\(\\{d_i\\}{:}\\sum_{j=1}^ie^{x_j-m_N}\\), with initial value \\(d_0=0,d_N\\) is the denominator of safe softmax. \\(\\{a_i\\}{:\\text{ the final softmax value}}.\\) BODY \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[m_i\\leftarrow\\max\\left(m_{i-1},x_i\\right)\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[d_i\\leftarrow d_{i-1}+e^{x_i-m_N}\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[a_i\\leftarrow\\frac{e^{x_i-m_N}}{d_N}\\] \\(\\mathbf{end}\\) è¿™æ˜¯ 3 step è®¡ç®— attention çš„æ–¹æ³•ï¼Œæ¯ä¸€æ­¥éƒ½éœ€è¦ä¸Šä¸€æ­¥çš„ç»“æœæ‰å¯ä»¥ç»§ç»­è®¡ç®—ã€‚è¿™æ ·çš„è¯ç”±äº sram ä¸­æ²¡æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤éœ€è¦å¤šæ¬¡è®¿å­˜ã€‚ ### Online attention \\[\\begin{aligned} d_i^{\\prime}\u0026 =\\sum_{j=1}^ie^{x_j-m_i} \\\\ \u0026= \\left(\\sum_{j=1}^{i-1} e^{x_j-m_i}\\right)+e^{x_i-m_i} \\\\ \u0026= \\left(\\sum_{j=1}^{i-1} e^{x_j-m_{i-1}}\\right)e^{m_{i-1}-m_i}+e^{x_i-m_i} \\\\ \u0026= d_{i-1}' e^{m_{i-1}-m_i}+e^{x_i-m_i} \\end{aligned}\\] æ‰¾åˆ°è¿­ä»£å¼ä¹‹åå°±å¯ä»¥ä» 3 step é™åˆ° 2 step \\[\\begin{aligned}\u0026\\mathbf{for~}i\\leftarrow1,N\\textbf{ do}\\\\\u0026\u0026\u0026m_i\u0026\u0026\\leftarrow\u0026\\max\\left(m_{i-1},x_i\\right)\\\\\u0026\u0026\u0026d_i^{\\prime}\u0026\u0026\\leftarrow\u0026d_{i-1}^{\\prime}e^{m_{i-1}-m_i}+e^{x_i-m_i}\\\\\u0026\\mathbf{end}\\\\\u0026\\mathbf{for~}i\\leftarrow1,N\\textbf{ do}\\\\\u0026\u0026\u0026a_i\\leftarrow\u0026\u0026\\frac{e^{x_i-m_N}}{d_N^{\\prime}}\\\\\u0026\\mathbf{end}\\end{aligned}\\] å¥½åƒ FLOPs è®¡ç®—é‡å¹¶æ²¡æœ‰å‡å°‘ï¼Œç”šè‡³è¿˜ç•¥æœ‰å¢åŠ ï¼Œå› ä¸ºç°åœ¨æ¯æ¬¡éƒ½éœ€è¦è®¡ç®—é¢å¤–çš„ scale X å€¼ï¼Œä¹Ÿå°±æ˜¯ pre-softmax logitsï¼Œç”±äºéœ€è¦ O (N^2) çš„æ˜¾å­˜æ— æ³•æ”¾åœ¨ SRAM ä¸­ã€‚å› æ­¤ï¼š 1. è¦ä¹ˆæå‰è®¡ç®—å¥½ xï¼Œä¿å­˜åœ¨å…¨å±€æ˜¾å­˜ä¸­ï¼Œéœ€è¦ O (N^2) çš„æ˜¾å­˜ï¼Œå®¹æ˜“çˆ†æ˜¾å­˜ã€‚ 2. è¦ä¹ˆåœ¨ç®—æ³•ä¸­ online è®¡ç®—ï¼Œæ¯æ¬¡å¾ªç¯ä¸­å» load ä¸€éƒ¨åˆ† Qï¼ŒK åˆ°ç‰‡ä¸Šå†…å­˜ï¼Œè®¡ç®—å¾—åˆ° xã€‚ Attention ä¼˜åŒ–çš„ç›®æ ‡å°±æ˜¯é¿å¼€ç¬¬ä¸€ç§æƒ…å†µï¼Œå°½å¯èƒ½èŠ‚çœæ˜¾å­˜ï¼Œå¦åˆ™ï¼ŒLLM æ ¹æœ¬æ— æ³•å¤„ç†ç±»ä¼¼ 100 K ä»¥ä¸Šè¿™ç§ long context çš„æƒ…å†µã€‚è€Œå¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿å­˜ä¸­é—´çŸ©é˜µ xï¼ŒèŠ‚çœäº†æ˜¾å­˜ï¼Œä½†æ˜¯è®¡ç®—æ²¡æœ‰èŠ‚çœï¼Œå¹¶ä¸”å¢åŠ äº† HBM IO Accessesï¼ˆéœ€è¦ä¸æ–­åœ° load Q, Kï¼‰ã€‚æ­¤æ—¶ï¼Œ2-pass ç®—æ³•ç›¸å¯¹äº 3-pass ç®—æ³•ï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡æ•´ä½“çš„ load Q, K ä»¥åŠå‡å°‘ä¸€æ¬¡å¯¹Â xiÂ çš„ online recomputeï¼Œå› ä¸ºåœ¨ 2-pass çš„ç¬¬ä¸€ä¸ª pass ä¸­ï¼ŒÂ xiÂ æ˜¯è¢«ä¸¤æ¬¡è®¡ç®—å…±äº«çš„ã€‚ç±»ä¼¼ online-softmax è¿™ç§ç®—æ³•ï¼Œå¯¹åº”åˆ° Attention ä¸­çš„åº”ç”¨ï¼Œå°±æ˜¯ Memory Efficient Attentionï¼ˆæ³¨æ„ä¸æ˜¯ FlashAttentionï¼‰ã€‚ ","date":"2025-07-15","objectID":"/online-attention/:0:1","tags":["Attention"],"title":"online attention","uri":"/online-attention/"},{"categories":["Attention","LLM"],"content":"å‚è€ƒ # å›¾è§£å¤§æ¨¡å‹è®¡ç®—åŠ é€Ÿç³»åˆ—ä¹‹ï¼švLLMæ ¸å¿ƒæŠ€æœ¯PagedAttentionåŸç† ","date":"2025-07-15","objectID":"/paged-attention/:1:0","tags":["LLM","Attention"],"title":"paged attention","uri":"/paged-attention/"},{"categories":["RLHF","LLM"],"content":"PPO (openrlhf åº“) é‡ç‚¹è®°å½•ä¸€ä¸‹ experience çš„é‡‡é›†è¿‡ç¨‹ã€‚è®­ç»ƒå…¶å®å¾ˆç®€å•ã€‚Actor åœ¨ RLHF ä¼šè¿›è¡Œ auto-regressive decodingï¼Œè€Œ critic, reward å’Œ reference åˆ™åªä¼š prefillï¼Œä¸ä¼š decodeã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°† actor çš„æ¨ç†ç‰¹å®šç§°ä¸º rolloutï¼Œè€Œå…¶ä»–æ¨¡å‹çš„æ¨ç†ç§°ä¸º inferenceã€‚ è·å– experience çš„æ€»ä½“æµç¨‹ï¼š #################### # 1. è°ƒç”¨Actor generate()æ–¹æ³•è·å–Promptçš„ç”Ÿæˆç»“æœï¼ŒæŠŠç»“æœå­˜å‚¨åˆ°Sampleå¯¹è±¡ #################### samples_list = self.generate_samples(all_prompts, **generate_kwargs) torch.distributed.barrier() #################### # 2. è°ƒç”¨make_experience å¯¹æ¯ä¸ªSampleåšå¤„ç†ï¼Œç»„è£…Experienceéƒ¨åˆ†å­—æ®µï¼ˆé™¤äº†advantageå’Œreturnï¼‰ #################### experiences = [] for samples in samples_list: experiences.append(self.make_experience(samples).to_device(\"cpu\")) experiences, rewards = self.process_experiences(experiences) #################### # 3. é€šè¿‡ä»åå¾€å‰å›æº¯è®¡ç®—çš„æ–¹å¼ï¼Œè·å–advantageå’Œreturnå€¼ #################### for experience, reward in zip(experiences, rewards): num_actions = experience.info[\"num_actions\"] if self.advantage_estimator == \"gae\": experience.advantages, experience.returns = self.get_advantages_and_returns( experience.values, reward, experience.action_mask, generate_kwargs[\"gamma\"], generate_kwargs[\"lambd\"], ) if not getattr(self, \"packing_samples\", False): return_sums = reward.sum(dim=-1) else: return_sums = torch.tensor( [each_reward.sum() for each_reward in reward], device=torch.cuda.current_device() ) experience.info[\"return\"] = return_sums return experiences å…³äºå¥å­åºåˆ—ä¸­çš„ state å’Œ action å®šä¹‰å¦‚ä¸‹ï¼š ## Prompt -\u003e sample é¦–å…ˆå¯¹ batch è¿›è¡Œ pad, æ³¨æ„æ¨ç†æ—¶éœ€è¦å·¦ padã€‚ ç„¶åç”Ÿæˆ sequencesï¼Œattention_mask, action_maskï¼š Sequencesï¼š Attention_maskï¼š Action_maskï¼š è‡³æ­¤ sample æ•°æ®å°±å¾—åˆ°äº†ã€‚ ## Sample -\u003e experience é¦–å…ˆæ ¹æ®å‰é¢ generate çš„ prompt+response è®¡ç®—å¾—åˆ° response éƒ¨åˆ†çš„ logpï¼š åŒæ ·çš„æ–¹å¼å¾—åˆ° reference_model çš„ logpï¼Œç„¶åå°±å¯ä»¥è®¡ç®— kl æ•£åº¦ã€‚ Critic æ˜¯é¢„ä¼°çŠ¶æ€çš„ä»·å€¼ï¼Œçœ‹ä»£ç å®ç°æ—¶ï¼Œå‚è€ƒå›¾ 3ï¼Œå…ˆç†è§£ LLM ä¸­çŠ¶æ€çš„èµ·å§‹ä½ç½®ã€‚æœ€ç»ˆçŠ¶æ€åºåˆ—é•¿åº¦æ˜¯ num_actions (ç”Ÿæˆ token çš„æ•°é‡)ï¼ŒçŠ¶æ€åºåˆ—èµ·å§‹ä½ç½®æ˜¯ Prompt çš„æœ€åä¸€ä¸ª tokenï¼Œç»“æŸä½ç½®æ˜¯æœ€å eos token å‰ä¸€ä¸ª tokenï¼Œæ‰€ä»¥è®¡ç®—å‡ºçš„ Critic é¢„ä¼°çŠ¶æ€ä»·å€¼çš„æ•°æ®ä¸ºï¼š æ³¨æ„ï¼Œå›¾é‡Œ eos token å’Œ pad token çš„ä½ç½®è¾“å‡ºåº”è¯¥å¹¶ä¸æ˜¯ 0ï¼Œæ˜¯ regression head çš„è¾“å‡ºï¼ˆå°å®æ•°å€¼ï¼‰ï¼Œåªæ˜¯æˆ‘ä»¬æœŸæœ›è‰¯å¥½çš„ä»·å€¼å‡½æ•°åœ¨è¿™äº›ä½ç½®è¾“å‡º 0 åœ¨ RLHF ä¸­ï¼ŒReward Model æ˜¯ä¸€ä¸ª ORMï¼ˆoutcome Reward Modelï¼‰ ä¹Ÿå°±æ˜¯å¯¹å®Œæ•´çš„ç”Ÿæˆ response è¾“å‡ºä¸€ä¸ªæ‰“åˆ†ã€‚ä»£ç å®ç°ä¸Šå–æ¯ä¸ª sequence eos token ä½ç½®çš„é¢„ä¼°æ‰“åˆ†å€¼ã€‚å¦‚å›¾ 11ï¼Œå›¾ä¸­â€xxâ€ä¹Ÿæ˜¯ä¼šå¹¶è¡Œè®¡ç®—å‡ºçš„ Reward å€¼ï¼Œå•æœ€ç»ˆåªå–äº†åºåˆ—æœ€å eos ä½ç½®çš„ score ä½œä¸ºå®Œæ•´åºåˆ—çš„æ‰“åˆ†å€¼ã€‚æœ€å reward å¤„ç†æˆ[B, 1]æ ¼å¼ï¼Œæ¯ä¸ªåºåˆ—ä¸€ä¸ªæ‰“åˆ†ã€‚ Gae (Generalized Advantage Estimation) æ˜¯ PPO è®ºæ–‡ä¸­å®ç°çš„ä¼˜åŠ¿å¥–åŠ±å€¼è®¡ç®—æ–¹æ³•ï¼Œå¯å¹³è¡¡ä¼˜åŠ¿é¢„ä¼°çš„åå·®å’Œæ–¹å·®ã€‚ç»“åˆå…¬å¼å’Œå›¾ç‰‡å†…å®¹æ›´å®¹æ˜“ç†è§£ï¼š def get_advantages_and_returns(values: torch.Tensor, rewards: torch.Tensor,ï¼‰ Advantages looks like this: Adv1 = R1 + Î³ * Î» * R2 + Î³^2 * Î»^2 * R3 + ... - V1 + Î³ * (1 - Î») V2 + Î³^2 * Î» * (1 - Î») V3 + ... Returns looks like this: Ret1 = R1 + Î³ * Î» * R2 + Î³^2 * Î»^2 * R3 + ... + Î³ * (1 - Î») V2 + Î³^2 * Î» * (1 - Î») V3 + ... è®¡ç®— returnsï¼š image.png æ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† experience çš„é‡‡é›†è¿‡ç¨‹ã€‚ ","date":"2025-07-15","objectID":"/ppo/:1:0","tags":["LLM","RLHF"],"title":"ppo","uri":"/ppo/"},{"categories":["RLHF","LLM"],"content":"Clip çš„ä¸€äº›ç»†èŠ‚ image.png image.png ä¸Šé¢è¿™å¼ å›¾æ˜¯å¾ˆç»å…¸çš„ä¸€å¼ å›¾ï¼Œæ¥åˆ†æä»€ä¹ˆæƒ…å†µä¸‹ clip é¡¹è®¡ç®—æ¢¯åº¦ã€‚ ","date":"2025-07-15","objectID":"/ppo/:2:0","tags":["LLM","RLHF"],"title":"ppo","uri":"/ppo/"},{"categories":["RLHF","LLM"],"content":"ä¾‹å­ image.png stateå¯¹äºæ–‡æœ¬åºåˆ—æ¥è¯´å°±æ˜¯ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰tokensï¼ŒV(s)å°±æ˜¯å½“å‰æ‰€æœ‰tokensä¸ºçŠ¶æ€ä¸‹çš„å›æŠ¥ã€‚è€Œrewardæ˜¯å¯¹äºæ•´ä¸ªå¥å­è€Œè¨€çš„ï¼Œå› æ­¤åªæœ‰æœ€åä¸€ä¸ªçŠ¶æ€æ‰æœ‰rewardã€‚ ","date":"2025-07-15","objectID":"/ppo/:3:0","tags":["LLM","RLHF"],"title":"ppo","uri":"/ppo/"},{"categories":["RLHF","LLM"],"content":"å‚è€ƒ å¦‚ä½•ç†è§£Qå€¼å’ŒVå€¼ (https://zhuanlan.zhihu.com/p/14569025663) ","date":"2025-07-15","objectID":"/ppo/:4:0","tags":["LLM","RLHF"],"title":"ppo","uri":"/ppo/"},{"categories":["","ä¼˜åŒ–å™¨"],"content":" AdaGrad ç›´æ¥æš´åŠ›ç´¯åŠ å¹³æ–¹æ¢¯åº¦ï¼Œè¿™ç§åšæ³•çš„ç¼ºç‚¹å°±æ˜¯ç´¯åŠ çš„å’Œä¼šæŒç»­å¢é•¿ï¼Œä¼šå¯¼è‡´å­¦ä¹ ç‡å˜å°æœ€ç»ˆå˜å¾—æ— ç©·å°ï¼Œæœ€åå°†æ— æ³•è·å¾—é¢å¤–ä¿¡æ¯ã€‚ ","date":"2025-07-12","objectID":"/adagrad/:0:0","tags":["ä¼˜åŒ–å™¨"],"title":"AdaGrad","uri":"/adagrad/"},{"categories":["","ä¼˜åŒ–å™¨","ä¼˜åŒ–ç®—æ³•"],"content":"AdamWç›¸å¯¹ä¸Adamçš„æ”¹åŠ¨ååˆ†ç®€å•ï¼Œå…¶å°†æƒé‡è¡°å‡é¡¹ä»æ¢¯åº¦çš„è®¡ç®—ä¸­æ‹¿å‡ºæ¥ç›´æ¥åŠ åœ¨äº†æœ€åçš„æƒé‡æ›´æ–°æ­¥éª¤ä¸Šï¼ˆå›¾1ï¼Œå¼12ï¼‰ã€‚å…¶æå‡ºçš„åŠ¨æœºåœ¨äºï¼šåŸå…ˆAdamçš„å®ç°ä¸­å¦‚æœé‡‡ç”¨äº† L2æƒé‡è¡°å‡ï¼Œåˆ™ç›¸åº”çš„æƒé‡è¡°å‡é¡¹ä¼šè¢«ç›´æ¥åŠ åœ¨lossé‡Œï¼Œä»è€Œå¯¼è‡´åŠ¨é‡çš„ä¸€é˜¶ä¸äºŒé˜¶æ»‘åŠ¨å¹³å‡å‡è€ƒè™‘äº†è¯¥æƒé‡è¡°å‡é¡¹ï¼Œè€Œè¿™å½±å“äº†Adamçš„ä¼˜åŒ–æ•ˆæœï¼Œè€Œå°†æƒé‡è¡°å‡ä¸æ¢¯åº¦çš„è®¡ç®—è¿›è¡Œè§£è€¦èƒ½å¤Ÿæ˜¾è‘—æå‡Adamçš„æ•ˆæœã€‚ç›®å‰ï¼ŒAdamWç°åœ¨å·²ç»æˆä¸ºtransformerè®­ç»ƒä¸­çš„é»˜è®¤ä¼˜åŒ–å™¨äº†ã€‚ image.png å‚è€ƒï¼š# Adamå’ŒAdamW ","date":"2025-07-12","objectID":"/adamw/:0:0","tags":["ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","AdamW"],"title":"AdamW","uri":"/adamw/"},{"categories":["","ä¼˜åŒ–å™¨"],"content":" RMSProp å’Œ Adagrad ç®—æ³•çš„æœ€å¤§åŒºåˆ«å°±æ˜¯åœ¨äºæ›´æ–°ç´¯ç§¯æ¢¯åº¦å€¼Â rÂ çš„æ—¶å€™ RMSProp è€ƒè™‘åŠ å…¥äº†ä¸€ä¸ªæƒé‡ç³»æ•°Â ÏÂ ã€‚ å®ƒä½¿ç”¨äº†ä¸€ä¸ªæ¢¯åº¦å¹³æ–¹çš„æ»‘åŠ¨å¹³å‡ã€‚å…¶ä¸»è¦æ€è·¯å°±æ˜¯è€ƒè™‘å†å²çš„æ¢¯åº¦ï¼Œå¯¹äºç¦»å¾—è¿‘çš„æ¢¯åº¦é‡ç‚¹è€ƒè™‘ï¼Œè€Œè·ç¦»æ¯”è¾ƒè¿œçš„æ¢¯åº¦åˆ™é€æ¸å¿½ç•¥ã€‚æ³¨æ„å›¾ä¸­çš„æ˜¯å†…ç§¯ã€‚ ","date":"2025-07-12","objectID":"/rmsprop/:0:0","tags":["ä¼˜åŒ–å™¨"],"title":"RMSProp","uri":"/rmsprop/"},{"categories":["ä¼˜åŒ–å™¨"],"content":"ä½œä¸ºæœºå™¨å­¦ä¹ çš„åˆå­¦è€…å¿…ç„¶ä¼šæ¥è§¦æ¢¯åº¦ä¸‹é™ç®—æ³•ä»¥åŠ SGDï¼ŒåŸºæœ¬ä¸Šå½¢å¼å¦‚ä¸‹ï¼š \\[ \\theta_t = \\theta_{t-1} - \\alpha \\;g(\\theta) \\] å…¶ä¸­ \\(\\alpha\\) ä¸ºå­¦ä¹ ç‡ï¼Œ\\(g(\\theta)\\) ä¸ºæ¢¯åº¦ã€‚ ","date":"2025-07-12","objectID":"/sgd/:0:0","tags":["ä¼˜åŒ–å™¨"],"title":"SGD","uri":"/sgd/"},{"categories":["","ä¼˜åŒ–å™¨"],"content":"å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™æ–¹æ³• å®ƒçš„æ€è·¯å°±æ˜¯è®¡ç®—å‰é¢æ¢¯åº¦çš„è¯¥å˜é‡ï¼Œæ¯æ¬¡è¿­ä»£ä¼šè€ƒè™‘å‰é¢çš„è®¡ç®—ç»“æœã€‚è¿™æ ·å¦‚æœåœ¨æŸä¸ªç»´åº¦ä¸Šæ³¢åŠ¨å‰å®³çš„ç‰¹å¾ï¼Œä¼šç”±äºâ€œmomentumâ€çš„å½±å“ï¼Œè€ŒæŠµæ¶ˆæ³¢åŠ¨çš„æ–¹å‘ï¼ˆå› ä¸ºæ³¢åŠ¨å‰§çƒˆçš„ç»´åº¦æ¯æ¬¡æ›´æ–°çš„æ–¹å‘æ˜¯ç›¸åçš„ï¼Œmomentum èƒ½æŠµæ¶ˆè¿™ç§æ³¢åŠ¨ï¼‰ã€‚ä½¿å¾—æ¢¯åº¦ä¸‹é™æ›´åŠ çš„å¹³æ»‘ï¼Œå¾—åˆ°æ›´å¿«çš„æ”¶æ•›æ•ˆç‡ã€‚è€Œåç»­æå‡ºçš„ Adagradï¼ŒRMSProp ä»¥åŠç»“åˆä¸¤è€…ä¼˜ç‚¹çš„ Adam ç®—æ³•éƒ½è€ƒè™‘äº†è¿™ç§â€œmomentumâ€çš„æ€æƒ³ã€‚ å‰é¢æ±‚æ¢¯åº¦çš„è¿‡ç¨‹çœç•¥äº†ï¼Œåé¢å¯ä»¥è¿™æ ·å†™ï¼š \\[ \\begin{align} \u0026 v_t = \\beta v_{t-1} + (1-\\beta)g_t \\\\\\\\ \u0026 \\theta = \\theta - \\alpha v_t \\end{align} \\] å…¶ä¸­ \\(\\alpha\\) ä¸ºå­¦ä¹ ç‡ï¼Œä¸€èˆ¬çš„ \\(\\beta\\) ä¸º 0.9ã€‚V å°±æ˜¯åŠ¨é‡ã€‚ æ‰€ä»¥ï¼ŒSGD + Momentum å¯ä»¥ç†è§£ä¸ºï¼Œåˆ©ç”¨å†å²æƒé‡æ¢¯åº¦çŸ©é˜µ \\(W_{i} l(i\u003ct)\\) å’Œå½“å‰æƒé‡æ¢¯åº¦çŸ©é˜µ \\(W_{t} l\\) çš„åŠ æƒå¹³å‡å’Œï¼Œæ¥æ›´æ–°æƒé‡çŸ©é˜µ \\(W\\) ã€‚ç”±äº \\(\\beta \\in(0,1)\\) ï¼Œæ‰€ä»¥éšç€ \\(t\\) çš„å¢å¤§å’Œ \\(i\\) çš„å‡å°ï¼Œ \\(\\beta^{t-i}\\) ä¼šå‡å°ï¼Œå†å²æƒé‡æ¢¯åº¦çŸ©é˜µ \\(W_{i} l(i\u003ct)\\) ä¼šé€æ¸å‡å°ã€‚é€šä¿—æ¥è®²ï¼Œä¼šé€æ¸é—å¿˜è¶Šæ—§çš„æƒé‡æ¢¯åº¦çŸ©é˜µã€‚ ","date":"2025-07-12","objectID":"/sgd-momentum/:0:0","tags":["ä¼˜åŒ–å™¨"],"title":"SGD-Momentum","uri":"/sgd-momentum/"},{"categories":["","LLM","attention"],"content":"å‰ç½®é˜…è¯»ï¼šMHA ã€MQAã€GQA å’Œ rope åœ¨æ ‡å‡†çš„ Transformerä¸­ï¼Œå¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attention, MHAï¼‰æœºåˆ¶é€šè¿‡å¹¶è¡Œè®¡ç®—å¤šä¸ªæ³¨æ„åŠ›å¤´æ¥æ•æ‰è¾“å…¥åºåˆ—ä¸­çš„ä¸åŒç‰¹å¾ã€‚æ¯ä¸ªæ³¨æ„åŠ›å¤´éƒ½æœ‰è‡ªå·±çš„æŸ¥è¯¢ï¼ˆQuery, Qï¼‰ã€é”®ï¼ˆKey, Kï¼‰å’Œå€¼ï¼ˆValue, Vï¼‰çŸ©é˜µï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š æŸ¥è¯¢çŸ©é˜µ Qï¼šç”¨äºè®¡ç®—è¾“å…¥åºåˆ—ä¸­æ¯ä¸ªä½ç½®çš„æ³¨æ„åŠ›æƒé‡ã€‚ é”®çŸ©é˜µ Kï¼šç”¨äºä¸æŸ¥è¯¢çŸ©é˜µ Q è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ã€‚ å€¼çŸ©é˜µ Vï¼šç”¨äºæ ¹æ®æ³¨æ„åŠ›åˆ†æ•°åŠ æƒæ±‚å’Œï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚ MLA çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä½ç§©è”åˆå‹ç¼©æŠ€æœ¯ï¼Œå‡å°‘è®­ç»ƒæ—¶çš„æ¿€æ´»å ç”¨å’Œæ¨ç†æ—¶çš„ kv cache çš„å ç”¨ï¼Œä»è€ŒèŠ‚çœæ˜¾å­˜ã€‚ ","date":"2025-07-11","objectID":"/mla/:0:0","tags":["LLM","Attention"],"title":"MLA","uri":"/mla/"},{"categories":["","LLM","attention"],"content":"æ ¸å¿ƒæ€æƒ³ å½“å‰æˆ‘è¦å­˜çš„K cacheæ˜¯4ä¸ªk_headï¼Œä½†å¦‚æœæˆ‘èƒ½ä»è¿™4ä¸ªk_headä¸­æŠ½å–å‡º1ä»½å…±æœ‰çš„ä¿¡æ¯ï¼Œç„¶ååœ¨åšattnè®¡ç®—æ—¶ï¼Œæ¯ä¸ªheadéƒ½ç”¨è¿™1ä»½å…±æœ‰çš„ä¿¡æ¯åšè®¡ç®—ï¼Œé‚£ä¹ˆæˆ‘ä¹Ÿåªéœ€å­˜è¿™1ä»½å…±æœ‰ä¿¡æ¯ä½œä¸ºK cacheäº†ã€‚è¿™æ ·æˆ‘å°±æŠŠK cacheä»åŸæ¥num_heads = 4å˜æˆnum_heads = 1ï¼Œè¿™ä¸å°±èƒ½èŠ‚çœK cacheäº†å—ï¼Ÿ ä½†æ˜¯ç­‰ç­‰ï¼Œç°åœ¨å…±æœ‰çš„k_headä¿¡æ¯æ˜¯æŠ½å–å‡ºæ¥äº†ï¼Œé‚£ä¹ˆç›¸å¼‚çš„k_headä¿¡æ¯å‘¢ï¼Ÿï¼ˆç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”± \\(W_{K}\\) ä¸åŒheadéƒ¨åˆ†å­¦ä¹ åˆ°çš„ç›¸å¼‚ä¿¡æ¯ï¼‰ã€‚æˆ‘ä»¬å½“ç„¶æ˜¯å¸Œæœ›k_headé—´ç›¸å¼‚çš„ä¿¡æ¯ä¹Ÿèƒ½ä¿ç•™ä¸‹æ¥ï¼Œé‚£ä¹ˆè¯¥æŠŠå®ƒä»¬ä¿ç•™è‡³å“ªé‡Œå‘¢ï¼Ÿå½“ä½ å›é¡¾attn_weightsçš„è®¡ç®—å…¬å¼æ—¶ï¼Œä¸€ä¸ªæƒ³æ³•åœ¨ä½ è„‘ä¸­é—ªç°ï¼šqéƒ¨åˆ†ä¸æ˜¯ä¹Ÿæœ‰headså—ï¼æˆ‘å¯ä»¥æŠŠæ¯ä¸ªk_headç‹¬æœ‰çš„ä¿¡æ¯è½¬ç§»åˆ°å¯¹åº”çš„q_headä¸Šå—ï¼å†™æˆå…¬å¼è§£é‡Šå°±æ˜¯ï¼š åŸæ¥Â \\(attention\\_weights=(W_{Q}h_{i})^T * (W_{k}h_{j})\\)Â ï¼Œæ‹¬å·è¡¨ç¤ºè¿ç®—é¡ºåºï¼Œå³å…ˆå„è‡ªç®—2ä¸ªæ‹¬å·å†…çš„ï¼Œå†åš * è®¡ç®— ç°åœ¨ \\(attention\\_weights=(h_{i}^TW_{Q}W_{k})^T * h_{j}\\)ï¼ŒåŒç†æ‹¬å·è¡¨ç¤ºè¿ç®—é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡çŸ©é˜µä¹˜æ³•çš„äº¤æ¢å¾‹ï¼Œå·§å¦™åœ°æŠŠ1ä¸ªtokenä¸Šk_headsç‹¬æœ‰çš„ä¿¡æ¯è½¬ç§»åˆ°äº†å¯¹åº”çš„q_headä¸Šæ¥ï¼Œè¿™æ ·1ä¸ªtokenä¸Šk_headsé—´å…±äº«çš„ç›¸åŒä¿¡æ¯å°±èƒ½è¢«æˆ‘ä»¬å½“ä½œK cacheå­˜å‚¨ä¸‹æ¥ã€‚ ï¼ˆåœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æŠ½è±¡åœ°æŠŠ \\(h_{j}\\) ç†è§£æˆæ˜¯4ä¸ªk_headså…±äº«çš„ä¿¡æ¯ï¼Œä½†æœ€ç»ˆK cacheçš„å½¢å¼è¿˜ä¼šåœ¨è¿™åŸºç¡€ä¸Šæœ‰æ‰€å˜åŒ–ã€‚æˆ‘çŸ¥é“æ­¤æ—¶ä½ è„‘æµ·ä¸­ä¸€å®šæœ‰å¾ˆå¤šç–‘æƒ‘ã€‚ä½†æˆ‘ä»¬å…ˆä¸è¦çº ç»“ç»†èŠ‚çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨åæ–‡ä¼šå±•ç¤ºå…¨éƒ¨ç»†èŠ‚ï¼Œè¿™é‡Œæˆ‘ä»¬è¦åšçš„æ˜¯ä»å®è§‚ä¸Šç†è§£MLAè®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ã€‚ï¼‰ ä¸Šè¿°å™è¿°æ¥è‡ªå†è¯»MLAï¼Œè¿˜æœ‰å¤šå°‘ç»†èŠ‚æ˜¯ä½ ä¸çŸ¥é“çš„ å› æ­¤ MLA çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå‹ç¼©çš„ \\(h_{j}\\) æ¥è¡¨ç¤ºæ‰€æœ‰ head çš„å…±æœ‰ä¿¡æ¯ï¼Œè€Œå°† head ä¹‹é—´ç›¸å¼‚ä¿¡æ¯è®© q æ¥å¸æ”¶ï¼Œè¿™æ ·å°±å¤§å¤§å‹ç¼©äº† k çš„ head_numï¼Œv ä¹Ÿæ˜¯åŒç†ï¼Œä¸åŒæ˜¯ \\(W_{V}\\) å’Œ \\(W_{O}\\) å¸æ”¶ã€‚å› æ­¤ MLA å¹¶æ²¡æœ‰æŸå¤±ä¿¡æ¯ï¼Œè€Œæ˜¯å°†ä¿¡æ¯è½¬ç§»åˆ°äº† q_head ä¸Šã€‚æ€»ç»´åº¦å¹¶æ²¡æœ‰å‡å°‘ã€‚ ","date":"2025-07-11","objectID":"/mla/:1:0","tags":["LLM","Attention"],"title":"MLA","uri":"/mla/"},{"categories":["","LLM","attention"],"content":"è‹ç¥æ€è·¯ æˆ‘è®¤ä¸ºå…ˆçœ‹è‹ç¥çš„åšå®¢å†å»çœ‹çŒ›çŒ¿å¤§ä½¬çš„åšå®¢æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚ è‹ç¥è®¤ä¸º MLA æ˜¯åœ¨ GQA çš„åŸºç¡€ä¸Šå°†ç®€å•çš„çº¿æ€§å˜æ¢ï¼ˆåˆ†å‰²ã€å¤åˆ¶ï¼‰æ¢æˆä¸€èˆ¬çš„çº¿æ€§å˜æ¢æ¥å¢å¼ºæ¨¡å‹çš„èƒ½åŠ›ã€‚GQA ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ä½ç§©æŠ•å½±ã€‚åŸå› è§åŸæ–‡ï¼š å…¶ä¸­ g æ˜¯ç»„æ•°ã€‚è¿™é‡Œçš„ c åªæ˜¯ç®€å•çš„æ‹¼æ¥ï¼ŒMLA çš„åˆå§‹æƒ³æ³•å°±æ˜¯ä½¿ç”¨ä¸€ç§çº¿æ€§è½¬æ¢ä»£æ›¿æ‹¼æ¥ã€‚è¿™ä¸ªçº¿æ€§è½¬æ¢ä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥å­¦ä¹ çš„çŸ©é˜µ \\(W\\)ã€‚å› æ­¤ä¸€ä¸ªè‡ªç„¶çš„æƒ³æ³•å°±å‡ºæ¥äº†ï¼š ç„¶è€Œè¿™ç§æ–¹æ³•åœ¨æ¨ç†é˜¶æ®µå¹¶ä¸ä¼šå‡å°‘ kv cache çš„æ˜¾å­˜å ç”¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å­˜å‚¨ k å’Œ v è€Œä¸æ˜¯ cï¼Œå¹¶ä¸” kv cache å¤§å°åè€Œå’Œ MHA ä¸€æ ·å¤§äº†ã€‚è¿™æ—¶å¼•å…¥ä¸€ä¸ªæ’ç­‰å˜æ¢å°±å¯ä»¥è§£å†³é—®é¢˜ï¼š è¿™æ ·å°±å¯ä»¥æŠŠ c å–ä»£åŸæ¥çš„ kï¼Œè€ŒæŠŠä¸¤ä¸ª W å½“ä½œæ–°çš„ Qï¼ŒåŒç†åé¢å¯ä»¥æŠŠ Wv å’Œ Wo åˆå¹¶ï¼Œv ä¹Ÿå¯ä»¥ç”¨ c å–ä»£ã€‚è¿™ä¸ª c å°±æ˜¯ä¸Šé¢è¯´çš„æ‰€æœ‰ head çš„å…±äº«ä¿¡æ¯ã€‚è€Œç›¸å¼‚ä¿¡æ¯æ”¾å…¥äº†æ–°çš„ Q ä¸­æ¥å­¦ä¹ ã€‚è¿™æ ·åœ¨æ¨ç†é˜¶æ®µå°±å¯ä»¥åªä¿å­˜ c æ¥ä½œä¸º kv cache äº†ã€‚æ‰€ä»¥å¯ä»¥é™ä½ c çš„ç»´åº¦æ¥è¿›ä¸€æ­¥é™ä½æ˜¾å­˜å ç”¨ã€‚ ç°åœ¨æˆåŠŸé™ä½äº†æ˜¾å­˜å ç”¨ï¼Œä½†æœ‰äº†ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå¦‚ä½•åœ¨è¿™é‡Œå¼•å…¥ rope å‘¢ï¼Œä¼—æ‰€å‘¨çŸ¥ rope æ˜¯åœ¨è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°æ—¶åŠ å…¥äº†ä½ç½®ä¿¡æ¯ã€‚å¦‚æœå¼ºè¡ŒåŠ å…¥åˆ™ä¼šäº§ç”Ÿä¸‹é¢çš„é—®é¢˜ï¼š image.png ä¹Ÿå°±æ˜¯æ–°çš„ Q çŸ©é˜µä¸ i æœ‰å…³ï¼Œè€Œä¸æ˜¯å›ºå®šçš„ä¸€ä¸ªçŸ©é˜µäº†ã€‚ è§£å†³çš„åŠæ³•ä¹Ÿç®€å•ç²—æš´ï¼Œå°±æ˜¯åœ¨ q å’Œ k çš„ç»´åº¦ä¸Šå¢åŠ  rope çš„ç»´åº¦ã€‚ä¹Ÿå°±æ˜¯ï¼š image.png å…¶ä¸­å‰åŠéƒ¨åˆ†æ˜¯ nopeï¼ŒååŠéƒ¨åˆ†æ˜¯ ropeï¼Œè¿™ä¸ªåœ¨åé¢çŒ›çŒ¿å¤§ä½¬è®²è§£çš„æºç ä¸­ä¼šæœ‰ä½“ç°ã€‚ æœ€åä¸ºäº†é™ä½æ¿€æ´»å€¼ï¼Œåˆå¯¹ q è¿›è¡Œäº†ä½ç§©æŠ•å½±ï¼Œæœ€åå˜æˆäº†ï¼š è‡³äºä¸ºä»€ä¹ˆ q çš„ rope é¡¹æ˜¯ cï¼Œè€Œ k çš„ rope é¡¹æ˜¯ xï¼Œè¿™ä¸ªæˆ‘ä¹Ÿä¸æ¸…æ¥šã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼ŒMLA åªæ˜¯åœ¨ MHA çš„åŸºç¡€ä¸ŠåŠ äº†ä½ç§©æŠ•å½±ï¼Œä»¥åŠä¸ºäº† rope çš„è®¡ç®—åœ¨åŸæœ¬ dk çš„ç»´åº¦ä¸Šå¢åŠ äº† dr ç»´åº¦ã€‚ åŒºåˆ«åœ¨äºè§£ç é˜¶æ®µï¼ŒMLA å¯ä»¥åƒ MQA ä¸€æ ·ç®€å•ï¼š åœ¨è§£ç é˜¶æ®µï¼Œåªéœ€è¦ä¿å­˜ cï¼ˆæ³¨æ„ c æ˜¯ k å’Œ v çš„é›†åˆä½“ï¼‰ï¼Œè¿™å¤§å¤§é™ä½äº†æ˜¾å­˜å ç”¨ã€‚è‹ç¥åšå®¢å†™ prefill é˜¶æ®µä½¿ç”¨ (10)ï¼Œgeneration é˜¶æ®µä½¿ç”¨ (12)ï¼Œå› ä¸º prefill æ˜¯ compute-boundï¼Œéœ€è¦é™ä½è®¡ç®—é‡ï¼Œè€Œ generation é˜¶æ®µæ˜¯ memory-boundï¼Œéœ€è¦é™ä½æ˜¾å­˜å ç”¨ï¼Œè¿™æ ·ç»“åˆå®Œç¾ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚ ","date":"2025-07-11","objectID":"/mla/:2:0","tags":["LLM","Attention"],"title":"MLA","uri":"/mla/"},{"categories":["","LLM","attention"],"content":"çŒ›çŒ¿å¤§ä½¬æ€è·¯ ä¸€åˆ‡ä»ä¸‹é¢è¿™å¼ å›¾è¯´èµ·ï¼Œè¿™æ˜¯å¯¹æºç å®ç°é€»è¾‘çš„æŠ½ç¦»ï¼š (å›¾ä¸­çš„ kv_b_proj ç»´åº¦æ ‡æ³¨é”™è¯¯ï¼Œåº”è¯¥ä¸º(nope+v_head_dim)ï¼Œè¿™é‡Œçš„ v_head_dim=nope) ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ q_len ä¸º 1ï¼Œkv_len ä¸º 1024ï¼Œq_lora_rank å¤§å°ä¸º 1536ï¼Œè€Œ kv_lora_rank å¤§å°ä¸º 512ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°å·¦è·¯å’Œå³è·¯çš„è®¡ç®—æµç¨‹ä¸å¤ªä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸ºä¸Šé¢å…¬å¼ (10) ä¸­ q å’Œ k çš„ rope éƒ¨åˆ†ä½¿ç”¨çš„ä¸ä¸€æ ·ï¼Œq ä½¿ç”¨çš„æ˜¯å‹ç¼©åçš„ cï¼Œè€Œ k ä½¿ç”¨çš„æ˜¯åŸå§‹ x, å› æ­¤åœ¨ x ä¸ºè¾“å…¥çš„æ—¶å€™ kv éƒ¨åˆ†å°±å¯ä»¥å°† rope éƒ¨åˆ†ç®—å‡ºæ¥ï¼Œè€Œ q éƒ¨åˆ†éœ€è¦å°†å‹ç¼©åçš„ q å¾—åˆ°åæ‰å¯ä»¥è®¡ç®—ã€‚q æ˜¯å°† PE å’Œ NoPE split å¼€ï¼Œè€Œ kv æ˜¯å°† NoPE çš„ k å’Œ v split å¼€ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ nope ä¸­ï¼Œhead_dim ä¸º 128ï¼Œè€Œè¿™å¤§äº hsz // num_headsï¼ŒçŒ›çŒ¿å¤§ä½¬çŒœæµ‹è¿™æ˜¯ä¸ºäº†æé«˜æ¨¡å‹çš„å¤æ‚åº¦ï¼Œå› ä¸ºæ¨ç†çš„æ—¶å€™é€šè¿‡åªä¿å­˜å‹ç¼©åçš„ kv æ¥å‡å°‘äº† kv cache å ç”¨ï¼Œé‚£ä¹ˆè®­ç»ƒçš„æ—¶å€™å°±å¯ä»¥ç¨å¾®æé«˜å¤æ‚åº¦ã€‚ ä¸‹é¢çš„ä»£ç æ˜¯ä¸Šå›¾ä¸­çš„ä¸€äº›å®šä¹‰ã€‚ç»“åˆè‹ç¥çš„æ¨å¯¼è¿‡ç¨‹ç›¸ä¿¡å¯ä»¥ç†è§£ MLAã€‚ class DeepseekV2Attention(nn.Module): \"\"\"Multi-headed attention from 'Attention Is All You Need' paper\"\"\" def __init__(self, config: DeepseekV2Config, layer_idx: Optional[int] = None): super().__init__() self.config = config self.layer_idx = layer_idx self.attention_dropout = config.attention_dropout self.hidden_size = config.hidden_size self.num_heads = config.num_attention_heads self.head_dim = config.head_dim self.max_position_embeddings = config.max_position_embeddings self.rope_theta = config.rope_theta self.q_lora_rank = config.q_lora_rank self.qk_rope_head_dim = config.qk_rope_head_dim self.kv_lora_rank = config.kv_lora_rank self.v_head_dim = config.v_head_dim self.qk_nope_head_dim = config.qk_nope_head_dim self.qk_head_dim = config.qk_nope_head_dim + config.qk_rope_head_dim self.num_key_value_groups = config.num_attention_heads // config.num_key_value_heads self.is_causal = True if self.q_lora_rank is None: self.q_proj = nn.Linear(self.hidden_size, self.num_heads * self.qk_head_dim, bias=False) else: self.q_a_proj = nn.Linear(self.hidden_size, config.q_lora_rank, bias=config.attention_bias) self.q_a_layernorm = DeepseekV2RMSNorm(config.q_lora_rank) self.q_b_proj = nn.Linear(config.q_lora_rank, self.num_heads * self.qk_head_dim, bias=False) self.kv_a_proj_with_mqa = nn.Linear( self.hidden_size, config.kv_lora_rank + config.qk_rope_head_dim, bias=config.attention_bias, ) self.kv_a_layernorm = DeepseekV2RMSNorm(config.kv_lora_rank) self.kv_b_proj = nn.Linear( config.kv_lora_rank, self.num_heads * (self.qk_head_dim - self.qk_rope_head_dim + self.v_head_dim), bias=False, ) self.o_proj = nn.Linear( self.num_heads * self.v_head_dim, self.hidden_size, bias=config.attention_bias, ) self.scaling = self.qk_head_dim ** (-0.5) ","date":"2025-07-11","objectID":"/mla/:3:0","tags":["LLM","Attention"],"title":"MLA","uri":"/mla/"},{"categories":["","LLM","attention"],"content":"å‚è€ƒ ç¼“å­˜ä¸æ•ˆæœçš„æé™æ‹‰æ‰¯ï¼šä»MHAã€MQAã€GQAåˆ°MLA - ç§‘å­¦ç©ºé—´|Scientific Spaces # Multi-Head Latent Attention (MLA) è¯¦ç»†ä»‹ç»ï¼ˆæ¥è‡ªDeepseek V3çš„å›ç­”ï¼‰ å†è¯»MLAï¼Œè¿˜æœ‰å¤šå°‘ç»†èŠ‚æ˜¯ä½ ä¸çŸ¥é“çš„ modeling_deepseek.py Â· deepseek-ai/DeepSeek-V2 at main ","date":"2025-07-11","objectID":"/mla/:4:0","tags":["LLM","Attention"],"title":"MLA","uri":"/mla/"},{"categories":["","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","Muon","LLM"],"content":"Muon ç®—æ³•æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š image.png å…¶ä¸­æœ€ä¸»è¦çš„éƒ¨åˆ†æ˜¯ NewtonSchulz 5 ç®—æ³•ï¼Œæµç¨‹å¦‚ä¸‹ï¼š def newtonschulz5(G, steps=5, eps=1e-7): assert G.ndim == 2 a, b, c = (3.4445, -4.7750, 2.0315) X = G.bfloat16() X /= (X.norm() + eps) if G.size(0) \u003e G.size(1): X = X.T for _ in range(steps): A = X @ X.T B = b * A + c * A @ A X = a * X + B @ X if G.size(0) \u003e G.size(1): X = X.T return X è¿™ä¸ªç®—æ³•çš„ä½œç”¨æ˜¯å°† G è¿‘ä¼¼ä¸ºä¸€ä¸ªæœ€æ¥è¿‘ä»–çš„åŠæ­£äº¤çŸ©é˜µï¼Œå³ï¼š image.png å¯¹äºç»éªŒåŠ¨æœºï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼ŒåŸºäºæ‰‹åŠ¨æ£€æŸ¥ï¼ŒSGD-momentum å’Œ Adam å¯¹åŸºäº Transformer çš„ç¥ç»ç½‘ç»œä¸­çš„ 2D å‚æ•°äº§ç”Ÿçš„æ›´æ–°é€šå¸¸å…·æœ‰éå¸¸é«˜çš„æ¡ä»¶æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å‡ ä¹æ˜¯ä½ç§©çŸ©é˜µï¼Œæ‰€æœ‰ç¥ç»å…ƒçš„æ›´æ–°ä»…ç”±å‡ ä¸ªæ–¹å‘ä¸»å¯¼ã€‚æˆ‘ä»¬æ¨æµ‹æ­£äº¤åŒ–æœ‰æ•ˆåœ°å¢åŠ äº†å…¶ä»–â€œç½•è§æ–¹å‘â€çš„è§„æ¨¡ï¼Œè¿™äº›æ–¹å‘åœ¨æ›´æ–°ä¸­å¹…åº¦è¾ƒå°ï¼Œä½†å¯¹å­¦ä¹ ä»ç„¶å¾ˆé‡è¦ã€‚ ","date":"2025-07-11","objectID":"/muon/:0:0","tags":["ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","LLM"],"title":"Muon","uri":"/muon/"},{"categories":["","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","Muon","LLM"],"content":"Muon in Moonlight æ¥è‡ªMuonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿ - ç§‘å­¦ç©ºé—´|Scientific Spaces ### Weight Decay kimiå›¢é˜Ÿç ”ç©¶å‘ç°å¦‚æœä¸åŠ ä¸Šæƒé‡è¡°å‡æ”¶æ•›é€Ÿåº¦åˆ°åé¢ä¼šè¢«adamè¿½ä¸Šï¼Œå› æ­¤åŠ ä¸Šäº†æƒé‡è¡°å‡ï¼š \\[ \\Delta W =-\\eta[msign(M) + \\lambda W] \\] æ€»çš„æ¥è¯´ï¼Œè¿™ç§åšæ³•å¯ä»¥ç¼“è§£MaxLogitçˆ†ç‚¸çš„é—®é¢˜ï¼Œå› ä¸ºqkç›¸ä¹˜çš„ç»“æœå’Œxqã€xkä»¥åŠWqå’ŒWkæœ‰å…³ï¼Œxä¼šç»è¿‡rmsnormï¼Œæ‰€ä»¥çˆ†ç‚¸çš„åŸå› æ¥è‡ªäºWçš„çˆ†ç‚¸ï¼Œæ‰€ä»¥æƒé‡è¡°å‡å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚ ","date":"2025-07-11","objectID":"/muon/:1:0","tags":["ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","LLM"],"title":"Muon","uri":"/muon/"},{"categories":["","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","Muon","LLM"],"content":"RMSå¯¹é½ æˆ‘ç†è§£ä¸ºè¿™æ˜¯ä¸€ç§å°†Adamè°ƒå¥½çš„è¶…å‚æ•°ç”¨åˆ°å…¶å®ƒä¼˜åŒ–å™¨çš„æ–¹æ³•ã€‚ ","date":"2025-07-11","objectID":"/muon/:1:1","tags":["ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","LLM"],"title":"Muon","uri":"/muon/"},{"categories":["","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","Muon","LLM"],"content":"QK-clip QK-normå¯ä»¥å¾ˆå¥½çš„å‹åˆ¶MaxLogitï¼Œä½†å®ƒåªé€‚ç”¨äºMHAã€GQAï¼Œä¸é€‚ç”¨äºMLAçš„æ¨ç†é˜¶æ®µã€‚å› ä¸ºæ¨ç†é˜¶æ®µçš„Wkè¢«å¸æ”¶åˆ°äº†Qä¸­ã€‚ è¿™æ—¶å€™å°±éœ€è¦è¿”ç’å½’çœŸï¼Œæ—¢ç„¶MaxLogitå¤ªå¤§ï¼Œé‚£å°±è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå½“Logitçš„å€¼è¶…è¿‡é˜ˆå€¼çš„æ—¶å€™ï¼Œå°± ç›´æ¥è£å‰ªåˆ°è¿™ä¸ªé˜ˆå€¼ã€‚ è¿™å°±æœ‰äº†ä»–ä»¬æœ€åˆå§‹çš„æƒ³æ³•ï¼ˆå› ä¸ºLogitæ˜¯\\(QK^T\\)ï¼Œç›®çš„æ˜¯åœ¨\\(QK^T\\)ä¸Šè¿›è¡Œè£å‰ªï¼Œæ‰€ä»¥è¦å¯¹å„è‡ªçš„å‚æ•°çŸ©é˜µè£å‰ªsqrtã€‚ï¼‰ï¼š image.png å¦‚æœmax_logitï¼ˆåœ¨batchä¸Šä¹Ÿè¦æ‰¾æœ€å¤§ï¼‰å¤§äºé˜ˆå€¼å¹¶ä¸”å³å°†ä¼˜åŒ–çš„å‚æ•°æ˜¯qæˆ–è€…kçš„çº¿æ€§çŸ©é˜µå‚æ•°ï¼Œå°±å°†çŸ©é˜µå‚æ•°è¿›è¡Œclipï¼Œæ¥è¾¾åˆ°ç¼©æ”¾max_logitçš„ç›®çš„ã€‚ ä½†åé¢ä»–ä»¬å‘ç°è¿™æ ·ä¸€åˆ€åˆ‡å¾ˆå®¹æ˜“ä¼¤åŠæ— è¾œï¼Œå› ä¸ºå¤šå¤´æ³¨æ„åŠ›ä¸­ï¼Œæœ‰å¯èƒ½åªæœ‰1ä¸ªå¤´å‡ºç°äº†max_logitè¶…å‡ºé˜ˆå€¼ï¼Œä½†å…¶å®ƒå¤´çš„å‚æ•°ä¹Ÿä¼šè¢«è£å‡ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡å“ªç§Attentionå˜ä½“éƒ½æœ‰å¤šä¸ªHeadï¼Œä¸€å¼€å§‹æˆ‘ä»¬æ˜¯æ¯ä¸€å±‚Attentionåªç›‘æ§ä¸€ä¸ªMaxLogitæŒ‡æ ‡ï¼Œæ‰€æœ‰Headçš„Logitæ˜¯æ”¾åœ¨ä¸€èµ·å–Maxçš„ï¼Œè¿™å¯¼è‡´QK-Clipä¹Ÿæ˜¯æ‰€æœ‰Headä¸€èµ·Clipçš„ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬åˆ†åˆ«ç›‘æ§æ¯ä¸ªHeadçš„MaxLogitåå‘ç°ï¼Œå®é™…ä¸Šæ¯å±‚åªæœ‰ä¸ºæ•°ä¸å¤šçš„Headä¼šå‡ºç°MaxLogitçˆ†ç‚¸ï¼Œå¦‚æœæ‰€æœ‰HeadæŒ‰åŒä¸€ä¸ªæ¯”ä¾‹æ¥Clipï¼Œé‚£ä¹ˆå¤§éƒ¨ä»½Headéƒ½æ˜¯è¢«â€œæ— è¾œå—ç´¯â€çš„äº†ï¼Œè¿™å°±æ˜¯è¿‡åº¦è£å‰ªçš„å«ä¹‰ã€‚ ç®€å•æ¥è¯´ï¼ŒQK-Clipçš„æ“ä½œæ˜¯ä¹˜ä»¥ä¸€ä¸ªå°äº1çš„æ•°ï¼Œè¿™ä¸ªæ•°å¯¹äºMaxLogitçˆ†ç‚¸çš„Headæ¥è¯´æ˜¯åˆšåˆšå¥½æŠµæ¶ˆå¢é•¿è¶‹åŠ¿ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–headæ¥è¯´æ˜¯å•çº¯çš„ç¼©å°ï¼ˆå®ƒä»¬æ²¡æœ‰å¢é•¿è¶‹åŠ¿æˆ–è€…å¢é•¿è¶‹åŠ¿å¾ˆå¼±ï¼‰ã€‚ç”±äºé•¿æœŸæ— ç«¯è¢«ä¹˜ä¸€ä¸ªå°äº1çš„æ•°ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å‡ºç°å°±è¶‹äºé›¶çš„ç°è±¡ï¼Œè¿™æ˜¯â€œè¿‡åº¦è£å‰ªâ€çš„è¡¨ç°ã€‚ å› æ­¤è¿˜éœ€è¦ç›‘æ§å„ä¸ªå¤´çš„max_logitï¼Œå¦‚æœæŸä¸ªå¤´å‡ºç°äº†è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±å•ç‹¬å¯¹è¿™ä¸ªå¤´çš„å‚æ•°çŸ©é˜µè¿›è¡Œè£å‰ªã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¯¹äºMLAè€Œè¨€ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„å­˜åœ¨Wqå’ŒWkï¼Œè€Œæ˜¯Wqcã€Wkcã€Wqrã€Wkrï¼Œè€ŒWkræ˜¯æ‰€æœ‰çš„headå…±äº«çš„ï¼Œå¦‚æœè£å‰ªWkrä¹Ÿä¼šå¯¼è‡´å‡ºç°æ— è¾œå¤´ï¼Œæ‰€ä»¥åªéœ€è¦è£å‰ªWqrã€‚ æ‰€ä»¥æœ€ç»ˆç‰ˆæœ¬å¦‚ä¸‹ï¼š image.png å°†QK-clipåº”ç”¨åˆ°Muonä¼˜åŒ–å™¨å°±å˜æˆäº†Muon-Clipï¼š image.png image.png å¯¹æ¯”åŸç”ŸMuonå¯è§æ”¹è¿›äº†è›®å¤šã€‚ ","date":"2025-07-11","objectID":"/muon/:2:0","tags":["ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨","LLM"],"title":"Muon","uri":"/muon/"},{"categories":["","LLM","infra"],"content":"ä¸ºä»€ä¹ˆå­˜å‚¨æ¿€æ´»å€¼ï¼Ÿ é¦–å…ˆå›é¡¾ä¸ºä»€ä¹ˆè¦å­˜å‚¨æ¿€æ´»å€¼ã€‚ ç®€å•æ¥è¯´ï¼Œæ¨¡å‹å‚æ•°æ˜¯æ ¹æ®å¯¼æ•°æ›´æ–°çš„ã€‚ä¸ºäº†æœ‰æ•ˆåœ°è®¡ç®—è¿™äº›å¯¼æ•°ï¼Œå¿…é¡»ç¼“å­˜æŸäº›å¼ é‡ã€‚æ¿€æ´»å†…å­˜æ˜¯è¿™äº›ç¼“å­˜å¼ é‡çš„å†…å­˜æˆæœ¬ã€‚ å…·ä½“æ¥è¯´ï¼Œä»¥ \\(f\\) æ˜¯çŸ©é˜µä¹˜æ³•è¿ç®—ï¼š \\[y=f(x)=W\\cdot x\\] \\(W\\)æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„æƒé‡çŸ©é˜µã€‚å‡è®¾æˆ‘ä»¬æœ‰å…³äº æ—©æœŸåå‘ä¼ æ’­é˜¶æ®µçš„æ‰‹å¤´è¾“å‡ºï¼Œ\\(\\frac{\\partial L}{\\partial y}\\),æˆ‘ä»¬ éœ€è¦è®¡ç®— ä¸¤ä¸ªé¢å¤–çš„æ¢¯åº¦ï¼š 1.å…³äº\\(W\\),ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ›´æ–°æ­¤æƒé‡ã€‚ 2.å…³äº\\(x\\),è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­åå‘ä¼ æ’­ç®—æ³• åˆ°äº§ç”Ÿçš„ä»»ä½•ä½œ\\(x\\) å‰å¯¼æ•°æ˜¯ \\[\\frac{\\partial L}{\\partial W}=\\frac{\\partial L}{\\partial y}\\frac{\\partial y}{\\partial W}=\\frac{\\partial L}{\\partial y}\\times x\\] è€Œåè€…çš„å¯¼æ•°æ˜¯ \\[\\frac{\\partial L}{\\partial x}=\\frac{\\partial L}{\\partial y}\\cdot W\\] å› æ­¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦ç¼“å­˜è¾“å…¥å¼ é‡ \\(x\\) ä¸ºäº†èƒ½å¤Ÿè®¡ç®—æˆ‘ä»¬å…³å¿ƒçš„å¯¼æ•°ã€‚èŠ‚çœçš„æˆæœ¬ \\(x\\) æ˜¯æ¿€æ´» memoryã€‚ æˆ‘ä»¬å‘ç°åªéœ€è¦ä¿å­˜ xï¼Œè€Œå¯¹äº y ä¸éœ€è¦ä¿å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªä¿å­˜åå‘ä¼ æ’­æ—¶ç»å¯¹éœ€è¦çš„æ¿€æ´»å€¼ï¼Œå…¶å®ƒçš„ä¸´æ—¶å˜é‡è¦ç«‹å³é‡Šæ”¾ã€‚ ","date":"2025-07-10","objectID":"/activation-checkpointing/:1:0","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"MLP class MLP(nn.Module): \"\"\" Basic MLP (multi-layer perceptron) layer with optional Dropout. \"\"\" def __init__( self, d_model: int, act_fn: nn.Module, dropout_prob: Optional[float] = None, device: Optional[Union[str, torch.device]] = None, dtype: Optional[torch.dtype] = None, ) -\u003e None: super().__init__() self.d_model = d_model self.act_fn = act_fn self.dropout_prob = dropout_prob factory_kwargs = {\"device\": device, \"dtype\": dtype} self.lin_0 = nn.Linear(self.d_model, 4 * self.d_model, **factory_kwargs) self.lin_1 = nn.Linear(4 * self.d_model, self.d_model, **factory_kwargs) self.dropout = nn.Dropout(self.dropout_prob) if self.dropout_prob else None def forward(self, inputs: torch.Tensor) -\u003e torch.Tensor: x = self.lin_0(inputs) x = self.act_fn(x) x = self.lin_1(x) if self.dropout is not None: x = self.dropout(x) return x image.png Maybe saved çš„æ˜¯å¦ æ˜¯æ ¹æ®æ¿€æ´»å‡½æ•°çš„ç±»å‹æ¥çš„ï¼š å¦‚æœæ˜¯ GELU æ¿€æ´»å‡½æ•° \\[y=\\frac x2\\times\\tanh\\left(\\sqrt{\\frac2\\pi}\\left(x+.044715x^3\\right)\\right)\\] è¿™æ—¶å€™è®¡ç®—æ¢¯åº¦çš„è¯è¿˜æ˜¯éœ€è¦è¾“å…¥ xï¼Œè¿™æ˜¯éœ€è¦å­˜å‚¨çš„æƒ…å†µ è€Œå¦‚æœæ˜¯ä¸€äº›ç‰¹æ®Šçš„æ¿€æ´»å‡½æ•°çš„è¯ï¼Œæ¯”å¦‚ ReLU \\[y=\\mathsf{ReLU}(x)=\\begin{cases}x\u0026\\mathrm{if~}x\u003e0\\\\0\u0026\\mathrm{if~}x\u003c0\u0026\\end{cases}\\] æ¢¯åº¦ä¸ºï¼š \\[\\frac{dy}{dx}=\\frac{d\\text{ ReLU}(x)}{dx}=\\begin{cases}1\u0026\\mathrm{if~}x\u003e0\\\\0\u0026\\mathrm{if~}x\u003c0\u0026\\end{cases}\\] å°±ä¸éœ€è¦å­˜å‚¨ã€‚ Tanh ä¹Ÿæ˜¯åŒç†ï¼š \\[ \\frac{dy}{dx} = \\frac{d\\tanh (x)}{dx} = 1-\\tanh(x)^2 = 1-y^2 \\] å¦‚æœæƒ³è¦æ€§èƒ½ï¼Œé€‰æ‹© GELUï¼Œæƒ³è¦ä½æ˜¾å­˜ï¼Œä½¿ç”¨ ReLUã€‚ ","date":"2025-07-10","objectID":"/activation-checkpointing/:2:0","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"æ¿€æ´»å€¼è®¡ç®— æ ¹æ®åšå®¢ # åˆ†ætransformeræ¨¡å‹çš„å‚æ•°é‡ã€è®¡ç®—é‡ã€ä¸­é—´æ¿€æ´»ã€KV cache å†…å®¹æ¥å¾—åˆ°æ¿€æ´»å€¼çš„è®¡ç®—å…¬å¼ã€‚ å¤§æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€šå¸¸é‡‡ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼Œä¸­é—´æ¿€æ´»å€¼ä¸€èˆ¬æ˜¯float16æˆ–è€…bfloat16æ•°æ®ç±»å‹çš„ã€‚åœ¨åˆ†æä¸­é—´æ¿€æ´»çš„æ˜¾å­˜å ç”¨æ—¶ï¼Œå‡è®¾ä¸­é—´æ¿€æ´»å€¼æ˜¯ä»¥float16æˆ–bfloat16æ•°æ®æ ¼å¼æ¥ä¿å­˜çš„ï¼Œæ¯ä¸ªå…ƒç´ å äº†2ä¸ªbytesã€‚å”¯ä¸€ä¾‹å¤–çš„æ˜¯ï¼Œdropoutæ“ä½œçš„maskçŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ åªå 1ä¸ªbytesã€‚åœ¨ä¸‹é¢çš„åˆ†æä¸­ï¼Œå•ä½æ˜¯bytesï¼Œè€Œä¸æ˜¯å…ƒç´ ä¸ªæ•°ã€‚ å…ˆåˆ†æ self-attention å—çš„ä¸­é—´æ¿€æ´»ã€‚Self-attention å—çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š \\[Q=xW_Q,K=xW_K,V=xW_V\\] \\[x_{out}=softmax(\\frac{QK^T}{\\sqrt{h}})\\cdot V\\cdot W_o+x\\] å¯¹äº \\(Q,K,V\\) ,éœ€è¦ä¿å­˜å®ƒä»¬å…±åŒçš„è¾“å…¥ \\(x\\) ,è¿™å°±æ˜¯ä¸­é—´æ¿€æ´»ã€‚è¾“å…¥ \\(x\\) çš„å½¢çŠ¶ä¸º \\([b,s,h]\\) ,å…ƒç´ ä¸ªæ•°ä¸º bsh ,å ç”¨æ˜¾å­˜å¤§å°ä¸º \\(2*bsh=2bsh\\) ã€‚ å¯¹äº \\(QK^T\\) çŸ©é˜µä¹˜æ³•ï¼Œéœ€è¦ä¿å­˜ä¸­é—´æ¿€æ´» \\(Q,K\\) ,ä¸¤ä¸ªå¼ é‡çš„å½¢çŠ¶éƒ½æ˜¯ \\([b,s,h]\\) ,å ç”¨æ˜¾ å­˜å¤§å°åˆè®¡ä¸º \\(2*2*bsh=4bsh\\) ã€‚ å¯¹äº \\(softmax()\\) å‡½æ•°ï¼Œéœ€è¦ä¿å­˜å‡½æ•°çš„è¾“å…¥ \\(QK^T\\) ,å ç”¨æ˜¾å­˜å¤§å°ä¸º \\(2bs^2a\\) ,è¿™é‡Œçš„ \\(a\\) è¡¨ç¤ºæ³¨æ„åŠ›å¤´æ•°ã€‚ \\[score=softmax(\\frac{QK^T}{\\sqrt{d_k}})\\] \\(Q\\) çš„å½¢çŠ¶ä¸ºï¼š\\([ b, head\\_ num, s, per\\_ head\\_ hidden\\_ size]\\) \\(K^T\\) çš„å½¢çŠ¶ä¸ºï¼š\\([b,head\\_num,per\\_head\\_hidden\\_size,s]\\) \\(QK^T\\) çš„å½¢çŠ¶ä¸ºï¼š\\([b,head\\_num,s,s]\\) ,å…ƒç´ ä¸ªæ•°ä¸º \\(bs^2a\\) ,å ç”¨æ˜¾å­˜å¤§å°ä¸º \\(2bs^2a\\) ã€‚ 4. è®¡ç®—å®Œ \\(softmax()\\) å‡½æ•°åï¼Œä¼šè¿›è¡Œ dropout æ“ä½œã€‚éœ€è¦ä¿å­˜ä¸€ä¸ª mask çŸ©é˜µï¼Œmask çŸ©é˜µçš„å½¢çŠ¶ä¸ \\(QK^T\\) ç›¸åŒï¼Œå ç”¨æ˜¾å­˜å¤§å°ä¸º \\(bs^2a\\) ã€‚ 5. è®¡ç®—åœ¨ \\(V\\) ä¸Šçš„ attentionï¼Œå³ \\(score\\cdot V\\), éœ€è¦ä¿å­˜ score ,å¤§å°ä¸º \\(2bs^2a\\) ;ä»¥åŠ \\(V\\) ,å¤§å°ä¸º \\(2bsh\\) ã€‚äºŒè€…å ç”¨æ˜¾å­˜å¤§å°åˆè®¡ä¸º \\(2bs^2a+2bsh\\) ã€‚ 6. è®¡ç®—è¾“å‡ºæ˜ å°„ä»¥åŠä¸€ä¸ª dropout æ“ä½œã€‚è¾“å…¥æ˜ å°„éœ€è¦ä¿å­˜å…¶è¾“å…¥ï¼Œå¤§å°ä¸º \\(2bsh\\) ;dropout éœ€è¦ä¿å­˜ mask çŸ©é˜µï¼Œå¤§å°ä¸º bsh ã€‚äºŒè€…å ç”¨æ˜¾å­˜å¤§å°åˆè®¡ä¸º \\(3bsh\\) ã€‚ å› æ­¤ï¼Œå°†ä¸Šè¿°ä¸­é—´æ¿€æ´»ç›¸åŠ å¾—åˆ°ï¼Œself-attention å—çš„ä¸­é—´æ¿€æ´»å ç”¨æ˜¾å­˜å¤§å°ä¸º \\(11bsh+5bs^2a\\) ã€‚ æ¥ä¸‹æ¥çœ‹ MLP å—çš„ä¸­é—´æ¿€æ´»ã€‚MLP å—çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š \\[x=f_{gelu}(x_{out}W_1)W_2+x_{out}\\] ç¬¬ä¸€ä¸ªçº¿æ€§å±‚éœ€è¦ä¿å­˜å…¶è¾“å…¥ï¼Œå ç”¨æ˜¾å­˜å¤§å°ä¸º \\(2bsh\\) ã€‚ æ¿€æ´»å‡½æ•°éœ€è¦ä¿å­˜å…¶è¾“å…¥ï¼Œå ç”¨æ˜¾å­˜å¤§å°ä¸º \\(8bsh\\) ã€‚ ç¬¬äºŒä¸ªçº¿æ€§å±‚éœ€è¦ä¿å­˜å…¶è¾“å…¥ï¼Œå ç”¨æ˜¾å­˜å¤§å°ä¸º \\(8bsh\\) ã€‚ æœ€åæœ‰ä¸€ä¸ª dropout æ“ä½œï¼Œéœ€è¦ä¿å­˜ mask çŸ©é˜µï¼Œå ç”¨æ˜¾å­˜å¤§å°ä¸º bsh ã€‚ å¯¹äº MLP å—ï¼Œéœ€è¦ä¿å­˜çš„ä¸­é—´æ¿€æ´»å€¼ä¸º 19 bsh ã€‚ å¦å¤–ï¼Œself-attention å—å’Œ MLP å—åˆ†åˆ«å¯¹åº”äº†ä¸€ä¸ª layer normalizationã€‚æ¯ä¸ª layer norm éœ€è¦ä¿å­˜å…¶è¾“å…¥ï¼Œå¤§å°ä¸º \\(2bsh\\) ï¼ˆå¿½ç•¥äº†å‡å€¼å’Œæ–¹å·®çš„2 bsï¼Œå¦‚æœä¸å¿½ç•¥åº”å½“ä¸º 2 bsh+4 bsï¼Œè¿™é‡Œçš„å•ä½éƒ½æ˜¯ bytesï¼‰ã€‚2 ä¸ª layer norm éœ€è¦ä¿å­˜çš„ä¸­é—´æ¿€æ´»ä¸º \\(4bsh\\) ã€‚ ç»¼ä¸Šï¼Œæ¯ä¸ª transformer å±‚éœ€è¦ä¿å­˜çš„ä¸­é—´æ¿€æ´»å ç”¨æ˜¾å­˜å¤§å°ä¸º \\(34bsh+5bs^2a\\)ã€‚å¯¹äº \\(l\\) å±‚ transformer æ¨¡å‹ï¼Œè¿˜æœ‰ embedding å±‚ã€æœ€åçš„è¾“å‡ºå±‚ã€‚Embedding å±‚ä¸éœ€è¦ä¸­é—´æ¿€æ´»ã€‚æ€»çš„è€Œè¨€ï¼Œå½“éšè—ç»´åº¦ \\(h\\) æ¯”è¾ƒå¤§ï¼Œå±‚æ•° \\(l\\) è¾ƒæ·±æ—¶ï¼Œè¿™éƒ¨åˆ†çš„ä¸­é—´æ¿€æ´»æ˜¯å¾ˆå°‘çš„ï¼Œå¯ä»¥å¿½ç•¥ã€‚å›  æ­¤ï¼Œå¯¹äº \\(l\\) å±‚ transformer æ¨¡å‹ï¼Œä¸­é—´æ¿€æ´»å ç”¨çš„æ˜¾å­˜å¤§å°å¯ä»¥è¿‘ä¼¼ä¸º \\((34bsh+5bs^2a)*l\\) ","date":"2025-07-10","objectID":"/activation-checkpointing/:3:0","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"Activation checkpointing å½“ä½¿ç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿å­˜ä¸€äº›å…³é”®çš„æ¿€æ´»å€¼ï¼Œå¯ä»¥èˆå¼ƒä¸€äº›æ¿€æ´»å€¼ä»è€Œåœ¨åå‘ä¼ æ’­çš„è¿‡ç¨‹ä¸­é‡æ–°è®¡ç®—ï¼Œé€šå¸¸æœ‰ä¸¤ç§ç­–ç•¥ï¼š Fullï¼šæˆ‘ä»¬åœ¨ Transformer æ¨¡å‹æ¯ä¸€å±‚ä¹‹é—´çš„è¿‡æ¸¡ç‚¹æ£€æŸ¥æ¿€æ´»å€¼ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œå®Œæ•´â€ç­–ç•¥ï¼Œå› ä¸ºå®ƒéœ€è¦æ¯å±‚éƒ½è¿›è¡Œä¸€æ¬¡å‰å‘ä¼ æ’­ï¼Œå³åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­å¢åŠ äº†ä¸€æ¬¡å®Œæ•´çš„å‰å‘ä¼ æ’­ã€‚è¿™ç§ç­–ç•¥èŠ‚çœçš„å†…å­˜æœ€å¤šï¼Œä½†åœ¨è®¡ç®—æ–¹é¢æˆæœ¬æœ€é«˜ã€‚å®ƒé€šå¸¸ä¼šä½¿è®¡ç®—æˆæœ¬å’Œæ—¶é—´å¢åŠ é«˜è¾¾ 30-40%ï¼Œè¿™ä¸€å½±å“éå¸¸æ˜¾è‘—ã€‚ Selectï¼šæ€»ä½“è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”å…¨é¢ä¼˜åŒ–åšå¾—æ›´å¥½ã€‚é‚£ç¯‡å…³äºé‡æ–°è®¡ç®—çš„è®ºæ–‡çš„ä½œè€…è¿›è¡Œäº†è¯¦ç»†åˆ†æï¼Œç ”ç©¶äº†å“ªäº›æ¿€æ´»å€¼çš„å¢é•¿æœ€å¤§ï¼Œå¹¶ä¸”ä»¥æ¯ç§’æµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼ˆFLOPSï¼‰ä¸ºæ ‡å‡†ï¼Œå…¶é‡æ–°è®¡ç®—æˆæœ¬æœ€ä½ã€‚ç»“æœè¡¨æ˜ï¼Œæ³¨æ„åŠ›è®¡ç®—å±äºè¿™ä¸€ç±»åˆ«ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸å¯ä»¥ä¸¢å¼ƒå®ƒä»¬ï¼Œè€Œä¸“æ³¨äºå¯¹æ˜‚è´µçš„å‰é¦ˆè®¡ç®—è¿›è¡Œæ£€æŸ¥ç‚¹è®¾ç½®ã€‚å¯¹äº GPT-3ï¼ˆ1750 äº¿å‚æ•°ï¼‰æ¨¡å‹è€Œè¨€ï¼Œè¿™æ„å‘³ç€åœ¨è®¡ç®—æˆæœ¬ä»…å¢åŠ  2.7%çš„æƒ…å†µä¸‹ï¼Œæ¿€æ´»å€¼å†…å­˜å‡å°‘äº† 70%ã€‚ å¦‚ä»Šï¼Œå¤§å¤šæ•°è®­ç»ƒæ¡†æ¶éƒ½ä½¿ç”¨ FlashAttentionï¼Œå®ƒé€šè¿‡åœ¨åå‘ä¼ æ’­ä¸­é‡æ–°è®¡ç®—æ³¨æ„åŠ›å¾—åˆ†å’ŒçŸ©é˜µï¼Œè€Œä¸æ˜¯å­˜å‚¨å®ƒä»¬ï¼Œå°†æ¿€æ´»é‡æ–°è®¡ç®—é›†æˆåˆ°å…¶ä¼˜åŒ–ç­–ç•¥ä¸­ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°ä½¿ç”¨ FlashAttention çš„äººå·²ç»åœ¨ä½¿ç”¨ ACã€‚ ç”±äºé‡æ–°è®¡ç®—ï¼Œæ¿€æ´»é‡æ–°è®¡ç®—ç•¥å¾®å¢åŠ äº† FLOPS çš„æ•°é‡ï¼ŒåŒæ—¶æ˜¾è‘—é™ä½äº†å†…å­˜è®¿é—®å¼€é”€ã€‚ è¿™ç§æƒè¡¡åœ¨ GPU ç­‰é«˜é€Ÿå†…å­˜æœ‰é™çš„ç¡¬ä»¶ä¸Šç‰¹åˆ«æœ‰åˆ©ï¼Œå› ä¸ºè®¿é—®å†…å­˜é€šå¸¸æ¯”æ‰§è¡Œè®¡ç®—æ…¢ã€‚å°½ç®¡æ¶‰åŠé¢å¤–çš„æ“ä½œï¼Œä½†æ€»ä½“æ•ˆæœé€šå¸¸æ˜¯è®¡ç®—é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´å°‘ã€‚ ","date":"2025-07-10","objectID":"/activation-checkpointing/:4:0","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"1. Full Activation Checkpointing (å…¨é‡æ¿€æ´»å€¼æ£€æŸ¥ç‚¹) è¿™æ˜¯æœ€ç»å…¸ã€æœ€ç›´æ¥çš„æ£€æŸ¥ç‚¹æ–¹æ³•ã€‚ å·¥ä½œåŸç†ï¼š åˆ†æ®µ: å°†æ•´ä¸ªæ¨¡å‹çš„è®¡ç®—å›¾ï¼ˆæ‰€æœ‰å±‚ï¼‰åœ¨é€»è¾‘ä¸Šåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µ (Segment)ã€‚ ä¿å­˜: åœ¨å‰å‘ä¼ æ’­æ—¶ï¼Œåªä¿å­˜æ¯ä¸ªæ®µçš„è¾“å…¥å¼ é‡ (Input Tensor)ã€‚è¿™äº›è¢«ä¿å­˜çš„å¼ é‡å°±æ˜¯â€œæ£€æŸ¥ç‚¹â€ã€‚æ®µå†…æ‰€æœ‰ä¸­é—´å±‚çš„æ¿€æ´»å€¼éƒ½ä¼šåœ¨è®¡ç®—åè¢«ç«‹å³ä¸¢å¼ƒï¼Œä¸å ç”¨æ˜¾å­˜ã€‚ é‡ç®—: åœ¨åå‘ä¼ æ’­æ—¶ï¼Œå½“éœ€è¦æŸä¸ªæ®µå†…çš„æ¿€æ´»å€¼æ¥è®¡ç®—æ¢¯åº¦æ—¶ï¼Œå®ƒä¼šæ‰¾åˆ°è¯¥æ®µçš„æ£€æŸ¥ç‚¹ï¼ˆå³è¯¥æ®µçš„è¾“å…¥ï¼‰ï¼Œç„¶åé‡æ–°æ‰§è¡Œè¯¥æ®µçš„å‰å‘ä¼ æ’­ï¼Œä»¥æ¢å¤æ‰€éœ€è¦çš„æ¿€æ´»å€¼ã€‚ä¸€æ—¦è¿™ä¸ªæ¿€æ´»å€¼è¢«ä½¿ç”¨å®Œæ¯•ï¼Œå®ƒä¼šå†æ¬¡è¢«ä¸¢å¼ƒã€‚ å›¾è§£ï¼š å‡è®¾ä¸€ä¸ªæ¨¡å‹æœ‰16å±‚ï¼Œæˆ‘ä»¬æ¯4å±‚è®¾ç½®ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼š æ ‡å‡†è®­ç»ƒ (æ— Checkpointing): [Input] -\u003e L1 -\u003e L2 -\u003e ... -\u003e L16 -\u003e [Output] - å‰å‘ä¼ æ’­: è®¡ç®—å¹¶å­˜å‚¨ L1 åˆ° L16 çš„æ‰€æœ‰æ¿€æ´»å€¼ã€‚ - å†…å­˜å ç”¨: æé«˜ã€‚ Full Activation Checkpointing: [Input] -\u003e [Segment 1: L1-L4] -\u003e [Segment 2: L5-L8] -\u003e [Segment 3: L9-L12] -\u003e [Segment 4: L13-L16] -\u003e [Output] - å‰å‘ä¼ æ’­: - æ‰§è¡Œ Segment 1 (L1-L4)ï¼Œåªä¿å­˜ L5 çš„è¾“å…¥ï¼ˆå³L4çš„è¾“å‡ºï¼‰ä½œä¸ºæ£€æŸ¥ç‚¹ï¼Œä¸¢å¼ƒ L1-L3 çš„æ¿€æ´»å€¼ã€‚ - æ‰§è¡Œ Segment 2 (L5-L8)ï¼Œåªä¿å­˜ L9 çš„è¾“å…¥ä½œä¸ºæ£€æŸ¥ç‚¹ï¼Œä¸¢å¼ƒ L5-L7 çš„æ¿€æ´»å€¼ã€‚ - â€¦ä»¥æ­¤ç±»æ¨ã€‚ - åå‘ä¼ æ’­: - å½“éœ€è¦è®¡ç®— L12 çš„æ¢¯åº¦æ—¶ï¼Œå‘ç°å®ƒçš„æ¿€æ´»å€¼æ²¡æœ‰è¢«ä¿å­˜ã€‚ - ç³»ç»ŸåŠ è½½æœ€è¿‘çš„æ£€æŸ¥ç‚¹ï¼ˆL9çš„è¾“å…¥ï¼‰ã€‚ - é‡æ–°è®¡ç®— L9 -\u003e L10 -\u003e L11 -\u003e L12 çš„å‰å‘ä¼ æ’­ï¼Œå¾—åˆ° L12 çš„æ¿€æ´»å€¼ã€‚ - ä½¿ç”¨è¯¥æ¿€æ´»å€¼è®¡ç®—æ¢¯åº¦ï¼Œç„¶åä¸¢å¼ƒå®ƒã€‚ ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹: æ•ˆæœæ˜¾è‘—: å¯ä»¥å¤§å¹…åº¦é™ä½æ˜¾å­˜å ç”¨ï¼Œå†…å­˜å ç”¨é‡ä¸æ¨¡å‹çš„å±‚æ•°åŸºæœ¬æ— å…³ï¼Œåªä¸æœ€é•¿çš„é‚£ä¸ªæ®µçš„è®¡ç®—å¤æ‚åº¦æœ‰å…³ã€‚ å®ç°ç®€å•: é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºåœ¨å„ç§æ¡†æ¶ä¸­å®ç°ï¼ˆä¾‹å¦‚ PyTorch çš„ torch.utils.checkpointï¼‰ã€‚ ç¼ºç‚¹: è®¡ç®—å¼€é”€å¤§: æ¯ä¸ªè¢« checkpoint çš„æ®µï¼ˆé™¤äº†æœ€åä¸€ä¸ªï¼‰éƒ½ä¼šè¢«é‡æ–°è®¡ç®—ä¸€æ¬¡ã€‚å¦‚æœæ¨¡å‹å¾ˆå¤§ï¼Œè¿™ä¼šå¸¦æ¥å¤§çº¦ 30%-50% ç”šè‡³æ›´é«˜çš„è®­ç»ƒæ—¶é—´å¼€é”€ã€‚ ","date":"2025-07-10","objectID":"/activation-checkpointing/:4:1","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"2. Selective Activation Checkpointing (é€‰æ‹©æ€§æ¿€æ´»å€¼æ£€æŸ¥ç‚¹) è¿™æ˜¯å¯¹å…¨é‡æ£€æŸ¥ç‚¹æ–¹æ³•çš„æ™ºèƒ½åŒ–å‡çº§ï¼Œä¹Ÿæ˜¯ç›®å‰æ›´å—å…³æ³¨çš„é‡ç‚¹ã€‚å®ƒè®¤è¯†åˆ°â€œå…¨é‡ä¸¢å¼ƒã€å…¨é‡é‡ç®—â€çš„ç­–ç•¥è¿‡äºç²—æš´å’Œä½æ•ˆã€‚ æ ¸å¿ƒæ€æƒ³ï¼š åœ¨åŒä¸€ä¸ªè®¡ç®—æ®µå†…ï¼Œä¸åŒçš„æ“ä½œï¼ˆOpï¼‰æˆ–æ¿€æ´»å€¼ï¼Œå…¶å­˜å‚¨æˆæœ¬å’Œé‡ç®—æˆæœ¬æ˜¯ä¸åŒçš„ã€‚ æœ‰äº›æ¿€æ´»å€¼å ç”¨æ˜¾å­˜å¤§ï¼Œä½†é‡ç®—å¾ˆå¿«ï¼ˆä¾‹å¦‚ ReLU, Dropout ç­‰å…ƒç´ çº§æ“ä½œï¼‰ã€‚ æœ‰äº›æ¿€æ´»å€¼å ç”¨æ˜¾å­˜å°ï¼Œä½†é‡ç®—å¾ˆæ…¢ï¼ˆä¾‹å¦‚ MatMul, Convolution çš„è¾“å‡ºï¼‰ã€‚ Selective Checkpointing çš„ç›®æ ‡å°±æ˜¯ï¼šåœ¨æ¯ä¸ªæ®µå†…ï¼Œä¸å†ä¸¢å¼ƒæ‰€æœ‰æ¿€æ´»å€¼ï¼Œè€Œæ˜¯æœ‰é€‰æ‹©æ€§åœ°ä¿å­˜é‚£äº›â€œé‡ç®—æˆæœ¬é«˜ã€å­˜å‚¨æˆæœ¬ä½â€çš„æ¿€æ´»å€¼ï¼Œä»è€Œåœ¨åå‘ä¼ æ’­æ—¶ï¼Œé¿å…ä»£ä»·é«˜æ˜‚çš„é‡è®¡ç®—ã€‚ å·¥ä½œåŸç†ï¼š æˆæœ¬åˆ†æ: å®ƒéœ€è¦å¯¹è®¡ç®—å›¾ä¸­çš„æ¯ä¸ªæ“ä½œè¿›è¡Œæˆæœ¬åˆ†æã€‚ å­˜å‚¨æˆæœ¬: è¯¥æ“ä½œè¾“å‡ºçš„æ¿€æ´»å€¼å¼ é‡å ç”¨çš„æ˜¾å­˜å¤§å°ã€‚ é‡ç®—æˆæœ¬: é‡æ–°è®¡ç®—å‡ºè¿™ä¸ªæ¿€æ´»å€¼æ‰€éœ€è¦çš„æ—¶é—´ï¼ˆé€šå¸¸ç”¨ FLOPs è¡¡é‡ï¼‰ã€‚ æ™ºèƒ½å†³ç­–: åŸºäºæˆæœ¬åˆ†æï¼Œç®—æ³•ï¼ˆé€šå¸¸æ˜¯åŠ¨æ€è§„åˆ’æˆ–å¯å‘å¼æœç´¢ï¼‰ä¼šåšå‡ºå†³ç­–ã€‚å¯¹äºæ®µå†…çš„æ¯ä¸€ä¸ªæ¿€æ´»å€¼ï¼Œå®ƒä¼šåˆ¤æ–­ï¼š æ˜¯ç›´æ¥ä¿å­˜å®ƒæ›´åˆ’ç®—ï¼Ÿ è¿˜æ˜¯ä¸¢å¼ƒå®ƒï¼Œä¹‹åå†é€šè¿‡é‡è®¡ç®—æ¢å¤æ›´åˆ’ç®—ï¼Ÿ é€‰æ‹©æ€§ä¿å­˜ä¸é‡ç®—: åœ¨å‰å‘ä¼ æ’­æ—¶ï¼Œé™¤äº†ä¿å­˜æ¯ä¸ªæ®µçš„è¾“å…¥ï¼ˆä¸»æ£€æŸ¥ç‚¹ï¼‰å¤–ï¼Œè¿˜ä¼šé¢å¤–ä¿å­˜æ®µå†…é‚£äº›è¢«åˆ¤å®šä¸ºâ€œå€¼å¾—ä¿å­˜â€çš„å°‘é‡å…³é”®æ¿€æ´»å€¼ã€‚ åœ¨åå‘ä¼ æ’­æ—¶ï¼Œå½“éœ€è¦ä¸€ä¸ªæ¿€æ´»å€¼æ—¶ï¼Œå¦‚æœå®ƒè¢«ä¿å­˜äº†ï¼Œå°±ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœæ²¡è¢«ä¿å­˜ï¼Œç³»ç»Ÿä¼šä»æœ€è¿‘çš„ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆæ— è®ºæ˜¯ä¸»æ£€æŸ¥ç‚¹è¿˜æ˜¯æ®µå†…ä¿å­˜çš„æ¬¡çº§æ£€æŸ¥ç‚¹ï¼‰å¼€å§‹é‡ç®—ï¼Œè€Œä¸æ˜¯å¿…é¡»ä»æ®µçš„å¼€å¤´å¼€å§‹ã€‚ å›¾è§£ï¼ˆç»­ä¸Šä¾‹ï¼‰ï¼š åœ¨ Segment 3 (L9-L12) ä¸­ï¼š L9 (MatMul) -\u003e L10 (LayerNorm) -\u003e L11 (ReLU) -\u003e L12 (MatMul) Full Checkpointing ä¼šä¸¢å¼ƒ L9, L10, L11 çš„æ‰€æœ‰è¾“å‡ºã€‚é‡ç®— L12 æ—¶éœ€è¦ä» L9 çš„è¾“å…¥å¼€å§‹ï¼Œé‡æ–°æ‰§è¡Œ MatMul, LayerNorm, ReLUã€‚ Selective Checkpointing å¯èƒ½ä¼šåšå‡ºå¦‚ä¸‹å†³ç­–ï¼š L9 (MatMul) çš„è¾“å‡ºï¼šé‡ç®—æˆæœ¬æé«˜ï¼Œä½†å­˜å‚¨æˆæœ¬å¯èƒ½ç›¸å¯¹å¯æ§ã€‚å†³ç­–ï¼šä¿å­˜ã€‚ L11 (ReLU) çš„è¾“å‡ºï¼šå ç”¨æ˜¾å­˜å’Œ L10 ä¸€æ ·å¤§ï¼Œä½†é‡ç®—æˆæœ¬æä½ï¼ˆåªéœ€å¯¹ L10 çš„è¾“å‡ºå†åšä¸€æ¬¡ ReLUï¼‰ã€‚å†³ç­–ï¼šä¸¢å¼ƒã€‚ åœ¨åå‘ä¼ æ’­æ—¶ï¼š - å½“éœ€è¦ L11 çš„æ¿€æ´»å€¼æ—¶ï¼Œå‘ç°å®ƒæ²¡è¢«ä¿å­˜ã€‚ä½†ç³»ç»Ÿå‘ç° L10 çš„æ¿€æ´»å€¼ï¼ˆæˆ–è€… L9 çš„ï¼‰è¢«ä¿å­˜äº†ã€‚ - å®ƒåªéœ€ä» L10 å¼€å§‹é‡ç®— L10 -\u003e L11 (ReLU)ï¼Œè€Œæ— éœ€é‡ç®—æ˜‚è´µçš„ L9 (MatMul)ã€‚ ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹: æœ€ä½³å¹³è¡¡: åœ¨å®ç°ä¸ Full Checkpointing å‡ ä¹ç›¸åŒæ˜¾å­˜èŠ‚çœæ•ˆæœçš„åŒæ—¶ï¼Œæ˜¾è‘—é™ä½äº†é‡è®¡ç®—çš„å¼€é”€ï¼Œä»è€Œç¼©çŸ­äº†è®­ç»ƒæ—¶é—´ã€‚å®ƒåœ¨â€œæ—¶é—´â€å’Œâ€œç©ºé—´â€ä¹‹é—´æ‰¾åˆ°äº†ä¸€ä¸ªæ›´ä¼˜çš„å¹³è¡¡ç‚¹ã€‚ é«˜æ•ˆ: ç›¸æ¯” Full Checkpointingï¼Œè®­ç»ƒé€Ÿåº¦æ›´å¿«ã€‚ ç¼ºç‚¹: å®ç°å¤æ‚: éœ€è¦å¯¹æ¨¡å‹çš„è®¡ç®—å›¾è¿›è¡Œæ·±å…¥åˆ†æï¼Œå¹¶å»ºç«‹å‡†ç¡®çš„æˆæœ¬æ¨¡å‹ã€‚è¿™é€šå¸¸éœ€è¦æ·±åº¦å­¦ä¹ æ¡†æ¶æˆ–ç‰¹å®šåº“ï¼ˆå¦‚ DeepSpeedï¼‰çš„åº•å±‚æ”¯æŒã€‚ æ¨¡å‹ä¾èµ–: ä¼˜åŒ–çš„æ•ˆæœä¾èµ–äºæ¨¡å‹ç»“æ„ã€‚å¯¹äºåŒ…å«å¤§é‡æ˜‚è´µæ“ä½œçš„æ¨¡å‹ï¼Œæ•ˆæœä¼šæ›´æ˜æ˜¾ã€‚ ","date":"2025-07-10","objectID":"/activation-checkpointing/:4:2","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"æ€»ç»“å¯¹æ¯” ç‰¹æ€§ Full Activation Checkpointing Selective Activation Checkpointing æ ¸å¿ƒç­–ç•¥ ä»¥æ—¶é—´æ¢ç©ºé—´ åœ¨æ—¶é—´å’Œç©ºé—´ä¹‹é—´å¯»æ‰¾æœ€ä¼˜å¹³è¡¡ ç²’åº¦ ç²—ç²’åº¦ (æ®µçº§åˆ«) ç»†ç²’åº¦ (æ“ä½œçº§åˆ«) ä¿å­˜å†…å®¹ ä»…ä¿å­˜æ¯ä¸ªæ®µçš„è¾“å…¥ ä¿å­˜æ¯ä¸ªæ®µçš„è¾“å…¥ + æ®µå†…éƒ¨åˆ†å…³é”®æ¿€æ´»å€¼ é‡ç®—æ–¹å¼ æ€»æ˜¯ä»æ®µçš„å¼€å¤´é‡ç®—æ•´ä¸ªæ®µ ä»æœ€è¿‘çš„å¯ç”¨æ£€æŸ¥ç‚¹å¼€å§‹é‡ç®—ï¼Œè·¯å¾„æ›´çŸ­ è®¡ç®—å¼€é”€ é«˜ è¾ƒä½ æ˜¾å­˜èŠ‚çœ éå¸¸é«˜ éå¸¸é«˜ (ä¸ Full ç±»ä¼¼) å®ç°å¤æ‚åº¦ ä½ é«˜ æ€»è€Œè¨€ä¹‹ï¼ŒSelective Activation Checkpointing æ˜¯å¯¹ä¼ ç»Ÿæ£€æŸ¥ç‚¹æŠ€æœ¯çš„ä¸€æ¬¡é‡å¤§ä¼˜åŒ–ã€‚å®ƒé€šè¿‡æ›´ç²¾ç»†åŒ–çš„èµ„æºç®¡ç†ï¼Œåœ¨ä¸ç‰ºç‰²å¤ªå¤šå†…å­˜èŠ‚çœçš„å‰æä¸‹ï¼Œå¤§å¹…å‡å°‘äº†å› é‡è®¡ç®—å¸¦æ¥çš„æ—¶é—´æƒ©ç½šï¼Œæ˜¯ç›®å‰è®­ç»ƒè¶…å¤§è§„æ¨¡æ¨¡å‹æ—¶æ›´ä¸ºå…ˆè¿›å’Œé«˜æ•ˆçš„ä¸»æµæŠ€æœ¯ä¹‹ä¸€ã€‚ ## å‚è€ƒ Activation Memory: A Deep Dive using PyTorch | Determined AI ","date":"2025-07-10","objectID":"/activation-checkpointing/:4:3","tags":["LLM","infra"],"title":"Activation checkpointing","uri":"/activation-checkpointing/"},{"categories":["","LLM","infra"],"content":"CPU å¸è½½å…è®¸æˆ‘ä»¬å°†ä¸€äº›çŠ¶æ€ä¼ è¾“åˆ° CPUï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…å°†æ‰€æœ‰å†…å®¹éƒ½ä¿å­˜åœ¨ GPU RAM ä¸­ã€‚è™½ç„¶ CPUä½œæ¯” GPUä½œæ…¢ï¼Œä½†å°†ä¸å¸¸è®¿é—®çš„æ•°æ®ç§»åŠ¨åˆ° CPU å†…å­˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¿æŒåœ¨ GPU å†…å­˜é™åˆ¶èŒƒå›´å†…ã€‚ ","date":"2025-07-10","objectID":"/cpu-offloading/:0:0","tags":["LLM","infra"],"title":"CPU offloading","uri":"/cpu-offloading/"},{"categories":["","LLM","infra"],"content":"æ¢¯åº¦ç´¯ç§¯ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æŒ‰é¡ºåºå¤„ç†è¾ƒå°çš„æ‰¹æ¬¡æ¥æ‰©å±•åˆ°æ›´å¤§çš„æœ‰æ•ˆæ‰¹æ¬¡ã€‚æˆ‘ä»¬ä¸æ˜¯ä¸€æ¬¡è®¡ç®—æ•´ä¸ªæ‰¹æ¬¡çš„æ¢¯åº¦ï¼ˆè¿™éœ€è¦å°†æ‰€æœ‰æ¿€æ´»å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼‰ï¼Œè€Œæ˜¯åœ¨æ›´æ–°æ¨¡å‹å‚æ•°ä¹‹å‰å°†æ¯ä¸ªå°æ‰¹æ¬¡çš„æ¢¯åº¦ç›¸åŠ ã€‚è¿™å‡å°‘äº†å†…å­˜ä½¿ç”¨é‡ï¼Œä½†éœ€è¦æ›´å¤šçš„å‘å‰/å‘åä¼ é€’ã€‚ ","date":"2025-07-10","objectID":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/:0:0","tags":["LLM","infra"],"title":"æ¢¯åº¦ç´¯è®¡","uri":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/"},{"categories":["","LLM","infra"],"content":"ä»£ç  loss = loss / gradient_accumulation_stepsloss.backward() if step% gradient_accumulation_steps == 0: optimizer.step() optimizer.zero_grad() step+=1 gradient_accumulation_steps æ˜¯æ¢¯åº¦ç´¯ç§¯æ¬¡æ•°ï¼Œç´¯ç§¯å‡ æ¬¡ï¼ŒåŸæœ¬çš„ loss å°±è¦é™¤ä»¥å‡ ï¼Œè¿™æ˜¯ä¸ºäº†å¯¹å¤šä¸ªæ‰¹æ¬¡çš„æ•°æ®çš„æ¢¯åº¦åšç´¯ç§¯ã€‚ æœ‰äººè¯´ï¼Œåº”è¯¥æœ‰è¿™ä¸€è¡Œä»£ç æ‰ç®—ç´¯åŠ  losses += loss è¿™æ ·ç†è§£æ˜¯é”™è¯¯çš„ã€‚ è¦æ˜ç™½æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ¢¯åº¦ç´¯åŠ ï¼Œç´¯åŠ çš„å¹¶ä¸æ˜¯æŸå¤±ï¼Œè€Œæ˜¯æ ¹æ®æŸå¤±å¾—åˆ°çš„æ¢¯åº¦ã€‚ ","date":"2025-07-10","objectID":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/:1:0","tags":["LLM","infra"],"title":"æ¢¯åº¦ç´¯è®¡","uri":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/"},{"categories":["","LLM","infra"],"content":"æ¢¯åº¦ç´¯è®¡å¦‚ä½•èŠ‚çœæ˜¾å­˜ å‡å°‘ç¬æ—¶æ¿€æ´»å€¼æ˜¾å­˜ï¼šæ¯æ¬¡ä»…å¤„ç†å°æ‰¹é‡çš„æ•°æ®ï¼Œæ¿€æ´»å€¼æ˜¾å­˜å ç”¨é™ä½ä¸ºåŸæ¥çš„ 1/kï¼ˆä¾‹å¦‚ k=4 æ—¶ï¼Œæ˜¾å­˜å ç”¨é™è‡³ 25%ï¼‰ã€‚ å¤ç”¨æ˜¾å­˜ï¼šæ¯æ¬¡å°æ‰¹é‡è®¡ç®—å®Œæˆåï¼Œé‡Šæ”¾å½“å‰æ¿€æ´»å€¼æ˜¾å­˜ï¼Œä¾›ä¸‹ä¸€æ¬¡è®¡ç®—ä½¿ç”¨ï¼ˆæ˜¾å­˜å ç”¨å³°å€¼å§‹ç»ˆä¸ºå°æ‰¹é‡å¯¹åº”çš„é‡ï¼‰ã€‚ æ¢¯åº¦æ˜¾å­˜ä¸å˜ï¼šæ¨¡å‹å‚æ•°å’Œæ¢¯åº¦çš„æ˜¾å­˜å ç”¨ä¸æ‰¹é‡å¤§å°æ— å…³ï¼Œå› æ­¤ä¸å—å½±å“ï¼ˆä½†éœ€é¢å¤–å­˜å‚¨ç´¯ç§¯æ¢¯åº¦çš„å˜é‡ï¼Œè¿™éƒ¨åˆ†å¼€é”€æå°ï¼‰ã€‚ æ¢¯åº¦ç´¯ç§¯ä¸¤æ¬¡ï¼Œè·Ÿ batch size å¢å¤§ 2 å€ï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•ˆæœä¸€æ ·å—ï¼Ÿï¼ˆloss çš„ 3 æ¬¡å¹³å‡ï¼‰ ç†è®ºä¸Šï¼Œæ¢¯åº¦ç´¯è®¡åœ¨æ•°å­¦ä¸Šåº”è¯¥ç­‰åŒäºå…¨æ‰¹é‡è®­ç»ƒï¼Œä½†å®é™…å‘ç° loss å¹¶ä¸åŒ¹é…ã€‚( Gradient accumulation yields worse results than the equivalent batch size Â· Issue #2175 Â· huggingface/trl) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œloss è®¡ç®—ä¼šç»å†ä¸‰æ¬¡å¹³å‡ micro batch ç»´åº¦ï¼Œåˆ†æ¯æ˜¯è¿™ä¸ª micro batch ä¸­çš„æ‰€æœ‰ label ä¸æ˜¯ -100 çš„ token æ•°ï¼ˆä¸åŒ token ä¹‹é—´ loss çš„å¹³å‡ï¼‰ DP ç»´åº¦ï¼Œåˆ†æ¯æ˜¯ DP size ï¼ˆå’Œ GPU æ•°é‡ç›¸å…³ï¼Œä¸åŒæœºå™¨ä¹‹é—´ loss çš„å¹³å‡ï¼‰ æ¢¯åº¦ç´¯åŠ ç»´åº¦ï¼Œåˆ†æ¯æ˜¯æ¢¯åº¦ç´¯åŠ æ•°ã€‚ï¼ˆä¸åŒ batch ä¹‹é—´çš„ loss çš„å¹³å‡ï¼‰ image.png ","date":"2025-07-10","objectID":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/:2:0","tags":["LLM","infra"],"title":"æ¢¯åº¦ç´¯è®¡","uri":"/%E6%A2%AF%E5%BA%A6%E7%B4%AF%E8%AE%A1/"},{"categories":["coding","verl"],"content":" image.png ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°DataProtoå¯ä»¥åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼š - non_tensor_batch - batch - meta_info å…¶ä¸­non_tensor_batchå’Œmeta_infoéƒ½æ˜¯ä¸ªå­—å…¸ï¼Œè€Œbatchæ˜¯TensorDictç±»å‹çš„å˜é‡ã€‚ image.png DataProtoæ”¯æŒçš„ä¸€äº›æ“ä½œå¦‚ä¸‹ï¼š - concat: Combines multiple DataProto objects along the batch dimension - chunk: Splits a DataProto into equal chunks (requires batch size to be divisible by chunks) - split: Splits a DataProto into chunks of specified size (handles uneven splits) - repeat: Repeats the entire batch a specified number of times - sample_level_repeat: Repeats each sample a variable number of times - union: Merges two DataProto objects, combining their tensors and non-tensors - select/pop: Filter or remove specific keys from the batch - rename: Rename keys in the batch ","date":"2025-07-09","objectID":"/dataproto/:0:0","tags":["coding","verl"],"title":"DataProto","uri":"/dataproto/"},{"categories":["coding","verl"],"content":"DataProtoConfig è¿™ä¸ªè®¾ç½®ä¸»è¦ç”¨äºç®¡ç†auto_paddingé…ç½®ï¼Œç”¨åœ¨dpä¸­ï¼Œå³å¦‚æœæ•°æ®æ‰¹æ¬¡ / world_sizeä¸èƒ½æ•´é™¤çš„è¯ï¼Œå°±éœ€è¦paddingã€‚è¿™éƒ¨åˆ†ä½“ç°åœ¨ï¼š def _split_args_kwargs_data_proto_with_auto_padding(chunks, *args, **kwargs): from verl.protocol import DataProto, DataProtoFuture data_proto_len = None padding_size = None def _padding_and_split_data(obj, chunks): nonlocal data_proto_len, padding_size assert isinstance(obj, DataProto | DataProtoFuture) if isinstance(obj, DataProto) and obj.is_padding_enabled(): # for padding, we only support DataProto with same length if data_proto_len is None: data_proto_len = len(obj) padding_size = (chunks - (data_proto_len % chunks)) if (data_proto_len % chunks \u003e 0) else 0 else: assert data_proto_len == len(obj), ( f\"expecting all arg share same length of {data_proto_len}, but got {len(obj)}\" ) obj.padding(padding_size=padding_size) return obj.chunk(chunks=chunks) splitted_args = [_padding_and_split_data(arg, chunks) for arg in args] splitted_kwargs = {key: _padding_and_split_data(val, chunks) for key, val in kwargs.items()} if padding_size is not None: splitted_kwargs[_padding_size_key] = padding_size return splitted_args, splitted_kwargs è®¡ç®—éœ€è¦å¤šå°‘ä¸ªé¢å¤–çš„é¡¹ç›®æ‰èƒ½ä½¿æ‰¹é‡å¤§å°èƒ½è¢«ç›®æ ‡é™¤æ•°æ•´é™¤ ä»æ‰¹æ¬¡çš„å¼€å¤´è·å–é¡¹ä»¥ç”¨ä½œå¡«å…… å°†åŸå§‹æ‰¹æ¬¡ä¸å¡«å……é¡¹è¿æ¥èµ·æ¥ è·Ÿè¸ªå¡«å……å¤§å°ä»¥ä¾›ä»¥ååˆ é™¤ ","date":"2025-07-09","objectID":"/dataproto/:1:0","tags":["coding","verl"],"title":"DataProto","uri":"/dataproto/"},{"categories":["coding","verl"],"content":"DataProtoFuture DataProtoFutureç±»ç”¨äºveRLä¸­çš„åˆ†å¸ƒå¼è®¡ç®— image.png å…³äºcollect_fnå’Œdispatch_fnè¯¦è§init_workersè¯¦è§£ æ¥ä¸‹æ¥æ˜¯åˆ†å¸ƒå¼dataprotoçš„å·¥ä½œæµï¼š image.png å…¶ä¸­all_gather_data_protoå‡½æ•°ä¸ºï¼š def all_gather_data_proto(data: DataProto, process_group): # Note that this is an inplace operator just like torch.distributed.all_gather group_size = torch.distributed.get_world_size(group=process_group) assert isinstance(data, DataProto) prev_device = data.batch.device data.batch = data.batch.to(get_device_id()) data.batch = allgather_dict_tensors(data.batch.contiguous(), size=group_size, group=process_group, dim=0) data.batch = data.batch.to(prev_device) # all gather non_tensor_batch all_non_tensor_batch = [None for _ in range(group_size)] torch.distributed.all_gather_object(all_non_tensor_batch, data.non_tensor_batch, group=process_group) data.non_tensor_batch = {k: np.concatenate([d[k] for d in all_non_tensor_batch]) for k in data.non_tensor_batch} ä¹Ÿå°±æ˜¯all_gatheræ“ä½œæ¥æ”¶é›†dataï¼Œä¸»è¦ç”¨äºå¯¹tpåˆ†ç»„ä¸Šçš„æ•°æ®all_gatherï¼Œå› ä¸ºtpåˆ†ç»„éœ€è¦ç›¸åŒçš„è¾“å…¥ã€‚ \u003evllm + fsdp è®­æ¨æ—¶ï¼Œå¦‚æœæ¯å¼ å¡éƒ½æ˜¯ä¸€ä¸ª DPï¼Œäº‹æƒ…ä¼šç®€å•å¾ˆå¤šã€‚ä½† verl ä¸­æœ‰ä¸¤ä¸ªåŠŸèƒ½ä¸æ»¡è¶³è¿™ä¸€æ¡ä»¶ï¼Œä¸€æ˜¯ rollout æ—¶è®© vllm å¼€å¯ TPï¼ŒäºŒæ˜¯åœ¨ fsdp ä¸­ä½¿ç”¨ ulyssesï¼ˆSPï¼‰ã€‚verl ä¸­æ•°æ®åˆ†å‘ä½¿ç”¨çš„æ˜¯ dispatch mode è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚ fsdp workers ä¸»è¦ä½¿ç”¨Â Dispatch.DP_COMPUTE_PROTOè¿™ä¸ª modeï¼Œå®ƒæ˜¯åœ¨ worker group çš„å±‚æ¬¡ä¸Šè¿›è¡Œæ•°æ®åˆ†å‘ä»¥åŠç»“æœæ”¶é›†çš„ã€‚ç”±äºè¿™ä¸ªå±‚æ¬¡æ˜¯æ²¡æœ‰ TP/SP æ¦‚å¿µçš„ï¼Œæ‰€ä»¥å®ƒä»…åœ¨ one GPU one DP æ—¶æ‰æ˜¯æ­£ç¡®çš„ã€‚é‚£ä¹ˆä¸ºäº†æ­£ç¡®æ”¯æŒ TP/SPï¼Œå°±éœ€è¦å¯¹æ•°æ®åšä¸€äº›å‰åå¤„ç†ã€‚ (ä¸Šæ–‡å¼•ç”¨è‡ªæµ…å…¥ç†è§£verlä¸­çš„batch_size) ä½“ç°åœ¨ShardingManagerä¸­ï¼Œå³ï¼š @GPUMemoryLogger(role=\"fsdp vllm sharding_manager\", logger=logger) def preprocess_data(self, data: DataProto) -\u003e DataProto: \"\"\"All gather across tp group to make each rank has identical input.\"\"\" if self.tp_size == 1: return data # TODO: Current impl doesn't consider FSDP with torch micro-dp group = vllm_ps.get_tensor_model_parallel_group().device_group all_gather_data_proto(data=data, process_group=group) return data å¯è§è¿™é‡Œè·å–äº†tp groupï¼Œç„¶ååœ¨groupä¸­è¿›è¡Œall_gatheræ“ä½œã€‚post_process_dataå°±æ˜¯å†å°†æ•°æ®æŒ‰ç…§tpåˆ†ç»„dispatchå‡ºå»ã€‚åœ¨fsdpä¸­éœ€è¦spï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œã€‚ with self.rollout_sharding_manager: log_gpu_memory_usage(\"After entering rollout sharding manager\", logger=logger) prompts = self.rollout_sharding_manager.preprocess_data(prompts) with simple_timer(\"generate_sequences\", timing_generate): output = self.rollout.generate_sequences(prompts=prompts) log_gpu_memory_usage(\"After rollout generation\", logger=logger) output = self.rollout_sharding_manager.postprocess_data(output) æ€»ç»“ï¼šå› ä¸ºæˆ‘ä»¬åœ¨è¿›è¡Œdispatchçš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§world_sizeè¿›è¡Œçš„ï¼Œä½†æ˜¯å¯¹äºtpåˆ†ç»„éœ€è¦ç›¸åŒçš„è¾“å…¥ï¼Œæ‰€ä»¥è¦è¿›è¡Œall_gatherã€‚ ## Sequence Balancing verlä¸­å¯¹åºåˆ—ä¼˜åŒ–çš„åšæ³•æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š - åºåˆ—é•¿åº¦å¹³è¡¡ï¼šåœ¨å·¥ä½œçº¿ç¨‹ä¹‹é—´åˆ†é…åºåˆ—ä»¥å¹³è¡¡è®¡ç®—å·¥ä½œè´Ÿè½½ï¼ˆæœ¬ç« èŠ‚ï¼‰ - åŠ¨æ€æ‰¹å¤„ç†ï¼šæŒ‰ä»¤ç‰Œè®¡æ•°è€Œä¸æ˜¯å›ºå®šæ‰¹æ¬¡å¤§å°å¯¹åºåˆ—è¿›è¡Œåˆ†ç»„ï¼ˆdynamic_bszï¼‰ - åºåˆ—æ‰“åŒ…ï¼šåˆ é™¤å¡«å……æ ‡è®°ä»¥æé«˜å†…å­˜æ•ˆç‡remove_padding - å¾®æ‰¹æ¬¡ä¼˜åŒ–ï¼šé‡æ–°æ’åˆ—æ‰¹æ¬¡ä»¥å®ç°æœ€ä½³ GPU åˆ©ç”¨ç‡ image.png å¹³è¡¡ç®—æ³•ï¼šå¯¹åºåˆ—è¿›è¡Œåˆ†ç»„ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å¡«å……ï¼ŒåŒæ—¶å°Šé‡æ ‡è®°é™åˆ¶ï¼Œä»è€Œå‡å°‘å¡«å……æ ‡è®°ä¸Šçš„è®¡ç®—æµªè´¹ã€‚ ","date":"2025-07-09","objectID":"/dataproto/:2:0","tags":["coding","verl"],"title":"DataProto","uri":"/dataproto/"},{"categories":["coding","verl"],"content":"æ•°æ®å¤„ç†æµç¨‹ verlçš„æ•°æ®å¤„ç†æµç¨‹å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š image.png ","date":"2025-07-09","objectID":"/dataproto/:3:0","tags":["coding","verl"],"title":"DataProto","uri":"/dataproto/"},{"categories":["","infra","LLM"],"content":"å³ packingï¼Œå°†ä¸åŒé•¿åº¦çš„åºåˆ—ç´§å‡‘å­˜å‚¨ï¼Œé¿å…å¡«å……ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œå­˜å‚¨ï¼Œæå‡æ•ˆç‡ã€‚ ","date":"2025-07-08","objectID":"/remove_padding/:0:0","tags":["LLM","infra"],"title":"remove_padding","uri":"/remove_padding/"},{"categories":["","infra","LLM"],"content":"åŠ¨æœº sftè¿›è¡Œå¾®è°ƒï¼Œå› ä¸ºgpuæ˜¯å¹¶è¡Œè®¡ç®—çš„ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªbatché‡Œé¢çš„æ•°æ®ï¼Œæ¯æ¡æ•°æ®é•¿åº¦ä¸ç›¸ç­‰ï¼Œå°±éœ€è¦å¯¹æ•°æ®è¿›è¡Œtruncationï¼ˆæˆªæ–­ï¼‰å’Œpaddingï¼ˆpadæ•°æ®åˆ°ç›¸åŒçš„seq_lengthï¼‰ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä½¿ç”¨äº†paddingï¼Œé‚£ä¹ˆä¸€ä¸ªbatché‡Œé¢ï¼Œå°±ä¼šæœ‰å¾ˆå¤šçš„pad_tokenï¼Œè¿™äº›pad_tokenè¾“å…¥è¿›å…¥åˆ°äº†æ¨¡å‹ï¼Œä½†æ˜¯å´æ²¡æœ‰æ ·æœ¬è®­ç»ƒï¼Œé€ æˆäº†è®¡ç®—é‡çš„æµªè´¹ã€‚ å› æ­¤ï¼Œå¯¹äºè¿™äº›é•¿åº¦ä¸ç›¸ç­‰çš„æ ·æœ¬ï¼Œå°±å¯ä»¥ä½¿ç”¨packingï¼ˆç±»ä¼¼äºæ‰“åŒ…ï¼‰ï¼ŒæŠŠè¿™äº›æ ·æœ¬æ‹¼æ¥æˆé•¿åº¦ç›¸ç­‰çš„æ–‡æœ¬ï¼ˆæ¯”å¦‚20480, 4096, 8192ï¼‰ç­‰é•¿åº¦ã€‚è¿™æ ·å°±èƒ½å¤Ÿæ˜¯æ ·æœ¬å…¨éƒ¨è®­ç»ƒï¼Œå¢åŠ äº†æ ·æœ¬çš„è®¡ç®—æ•ˆç‡ã€‚å¦‚å›¾æ‰€ç¤ºã€‚æ¯ä¸ªæ ·æœ¬ä¹‹é—´ä¸ç­‰é•¿ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨eos_tokenè¿›è¡Œæ‹¼æ¥ï¼Œè¾¾åˆ°åŠ é€Ÿè®­ç»ƒçš„ç›®çš„ image.png ","date":"2025-07-08","objectID":"/remove_padding/:1:0","tags":["LLM","infra"],"title":"remove_padding","uri":"/remove_padding/"},{"categories":["","infra","LLM"],"content":"å¸¦æ¥çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ˆç†è®ºä¸Šï¼‰ å¦‚æœä½¿ç”¨äº†packingï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼šattentionå’Œä½ç½®ç¼–ç ã€‚ç›¸æ¯”äºä¸ä½¿ç”¨packingï¼Œä½¿ç”¨packingå¯¼è‡´ï¼š attenitonæœ‰é—®é¢˜ï¼šæœ¬æ¥æˆ‘åªéœ€è¦å’Œsample1çš„tokenè®¡ç®—attentionï¼Œç°åœ¨packingä»¥åï¼Œæˆ‘çš„attentionä¸ä»…ä»…æ˜¯sample1å†…éƒ¨è®¡ç®—ã€‚ç°åœ¨æ˜¯sample1ï¼Œsample2ï¼Œsample3ï¼Œé€šé€šä¸€èµ·è®¡ç®—attentionã€‚è¿™æ ·æ˜¯ä¸æ˜¯ä¼šæœ‰é—®é¢˜ï¼Ÿ ä½ç½®ç¼–ç ï¼šæœ¬æ¥sample1çš„ä½ç½®ç¼–ç æ˜¯ä»0å¼€å§‹çš„ï¼Œç°åœ¨æˆ‘sample1,2,3ä¸€èµ·packingï¼Œé‚£sample2ï¼Œ3çš„ä½ç½®ç¼–ç å°±å˜äº†ï¼Œæ— æ³•å’Œå•æ¡æ ·æœ¬è®­ç»ƒä¸€è‡´ã€‚ è§£å†³æ–¹æ¡ˆï¼š - å°†packingä¸­çš„attentionæ–¹å¼è¿›è¡Œä¿®æ”¹ï¼ˆæ¯æ¡æ ·æœ¬åªå’Œè‡ªå·±å†…éƒ¨åšattentionï¼‰ï¼Œå¦‚ä¸‹å›¾ - å°†packingçš„ä½ç½®ç¼–ç ï¼Œä¿®æ”¹æˆå’Œä¸ä½¿ç”¨packingä¸€æ ·çš„ä½ç½®ç¼–ç ã€‚ ","date":"2025-07-08","objectID":"/remove_padding/:2:0","tags":["LLM","infra"],"title":"remove_padding","uri":"/remove_padding/"},{"categories":["","infra","LLM"],"content":"ä»£ç åšæ³• å¼•ç”¨ verl ä¸­ tests çš„ä»£ç ï¼š def test_hf_casual_models(): batch_size = 4 seqlen = 128 response_length = 127 for config in test_configs: # config = AutoConfig.from_pretrained(test_case) with torch.device(\"cuda\"): model = AutoModelForCausalLM.from_config( config=config, torch_dtype=torch.bfloat16, attn_implementation=\"flash_attention_2\" ) model = model.to(device=\"cuda\") breakpoint() input_ids = torch.randint(low=0, high=config.vocab_size, size=(batch_size, seqlen), device=\"cuda\") attention_mask = create_random_mask( input_ids=input_ids, max_ratio_of_left_padding=0.1, max_ratio_of_valid_token=0.8, min_ratio_of_valid_token=0.5, ) position_ids = compute_position_id_with_mask( attention_mask ) # TODO(sgm): we can construct the position_ids_rmpad here input_ids_rmpad, indices, *_ = unpad_input( input_ids.unsqueeze(-1), attention_mask ) # input_ids_rmpad (total_nnz, ...) input_ids_rmpad = input_ids_rmpad.transpose(0, 1) # (1, total_nnz) # unpad the position_ids to align the rotary position_ids_rmpad = index_first_axis( rearrange(position_ids.unsqueeze(-1), \"b s ... -\u003e (b s) ...\"), indices ).transpose(0, 1) # input with input_ids_rmpad and postition_ids to enable flash attention varlen logits_rmpad = model( input_ids_rmpad, position_ids=position_ids_rmpad, use_cache=False ).logits # (1, total_nnz, vocab_size) origin_logits = model( input_ids=input_ids, attention_mask=attention_mask, position_ids=position_ids, use_cache=False ).logits origin_logits_rmpad, origin_logits_indices, *_ = unpad_input(origin_logits, attention_mask) logits_rmpad = logits_rmpad.squeeze(0) log_probs = log_probs_from_logits_all_rmpad( input_ids_rmpad=input_ids_rmpad, logits_rmpad=logits_rmpad, indices=indices, batch_size=batch_size, seqlen=seqlen, response_length=response_length, ) # (batch, seqlen) origin_log_probs = log_probs_from_logits_all_rmpad( input_ids_rmpad=input_ids_rmpad, logits_rmpad=origin_logits_rmpad, indices=origin_logits_indices, batch_size=batch_size, seqlen=seqlen, response_length=response_length, ) # (batch, seqlen) torch.testing.assert_close( masked_mean(log_probs, attention_mask[:, -response_length - 1 : -1]), masked_mean(origin_log_probs, attention_mask[:, -response_length - 1 : -1]), atol=1e-2, rtol=1e-5, ) print(\"Check pass\") å…¶ä¸­ unpad_input å‡½æ•°ç®€åŒ–é€»è¾‘çš„ä»£ç å¦‚ä¸‹ï¼š def unpad_input(hidden_states, attention_mask): # 1. æ‰¾åˆ°æ‰€æœ‰æœ‰æ•ˆ token çš„ä½ç½® # seqlens_in_batch æ˜¯ä¸€ä¸ªåŒ…å«æ‰¹æ¬¡ä¸­æ¯ä¸ªåºåˆ—å®é™…é•¿åº¦çš„åˆ—è¡¨ï¼Œä¾‹å¦‚ [3, 4] seqlens_in_batch = attention_mask.sum(dim=-1, dtype=torch.int32) # indices æ˜¯ä¸€ä¸ªä¸€ç»´å¼ é‡ï¼ŒåŒ…å«äº†æ‰€æœ‰å€¼ä¸º1çš„ mask å…ƒç´ çš„å±•å¹³åç´¢å¼• indices = torch.nonzero(attention_mask.flatten(), as_tuple=False).flatten() # 2. ä» hidden_states ä¸­æå–å‡ºæ‰€æœ‰æœ‰æ•ˆçš„ token # é¦–å…ˆå°† hidden_states å±•å¹³æˆ (batch_size * sequence_length, ...) flat_hidden_states = hidden_states.reshape(-1, hidden_states.shape[-1]) # ç„¶åä½¿ç”¨ indices æ¥æŒ‘é€‰å‡ºæ‰€æœ‰æœ‰æ•ˆçš„ token hidden_states_unpadded = flat_hidden_states[indices] # 3. è®¡ç®—ç´¯ç§¯åºåˆ—é•¿åº¦ (cu_seqlens) # ä¾‹å¦‚ï¼Œå¦‚æœ seqlens_in_batch æ˜¯ [3, 4]ï¼Œcu_seqlens ä¼šæ˜¯ [0, 3, 7] cu_seqlens = torch.cat( [torch.zeros(1, dtype=torch.int32), seqlens_in_batch.cumsum(dim=0)], dim=0 ) max_seqlen_in_batch = seqlens_in_batch.max().item() return hidden_states_unpadded, indices, cu_seqlens, max_seqlen_in_batch è¿™é‡Œçš„ cu_seqlens å°±æ˜¯ä¸éœ€è¦ä¼ å…¥ attention_mask çš„åŸå› ï¼Œç›¸å½“äºå–ä»£äº† mask çš„åŠŸèƒ½ã€‚ è°ƒè¯•è¾“å‡ºä¸€äº›å¼ é‡çš„ shapeï¼š (Pdb) input_ids.shape torch.Size([4, 128]) (Pdb) attention_mask.shape torch.Size([4, 128]) (Pdb) position_ids.shape torch.Size([4, 128]) (Pdb) input_ids_rmpad.shape torch.Size([1, 359]) # ä¹Ÿå°±æ˜¯è¯´å»æ‰padå4ä¸ªsampleåœ¨ä¸€èµ·çš„æœ‰æ•ˆé•¿åº¦ä¸º359 ç®€å•æ¥è¯´ï¼ŒindicesÂ æ˜¯ä¸€ä¸ªâ€œç´¢å¼•åœ°å›¾â€ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯è®°å½•åœ¨åŸå§‹çš„ã€å¸¦å¡«å……çš„ã€è¢«å±•å¹³ï¼ˆflattenedï¼‰çš„æ‰¹æ¬¡æ•°æ®ä¸­ï¼Œæ‰€æœ‰æœ‰æ•ˆï¼ˆéå¡«å……ï¼‰è¯å…ƒçš„ä½ç½®ã€‚ å½“Â unpad_inputÂ å¤„ç†Â input_idsÂ æ—¶ï¼Œå®ƒä¼šä¸¢æ‰æ‰€æœ‰çš„å¡«å……è¯å…ƒï¼Œåªä¿ç•™æœ‰æ•ˆè¯å…ƒï¼Œå¹¶ç”Ÿæˆè¿™ä¸ªÂ indicesÂ åœ°å›¾ã€‚è¿™ä¸ªåœ°å›¾è‡³å…³é‡è¦ï¼Œå› ä¸ºæ‰¹æ¬¡ä¸­çš„æ•°æ®å¾€å¾€ä¸æ­¢Â input_idsï¼Œè¿˜æœ‰ä¸ä¹‹ä¸¥æ ¼å¯¹é½çš„Â position_idsã€token_type_idsÂ ç­‰ã€‚ indicesÂ çš„ä¸»è¦ç”¨é€”æ˜¯ï¼šç¡®ä¿å…¶ä»–è¾…åŠ©å¼ é‡ï¼ˆå¦‚Â position_idsï¼‰èƒ½å¤Ÿä»¥ä¸Â input_idsÂ å®Œå…¨ç›¸åŒçš„æ–¹å¼è¢«â€œè§£å¡«å……â€ï¼ˆunpadï¼‰ï¼Œä»è€Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§å’Œå¯¹é½ã€‚Â å¦‚æœÂ position_idsÂ çš„è§£å¡«å……æ–¹å¼ä¸Â input_idsÂ ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæ—‹è½¬ä½ç½®ç¼–ç ï¼ˆRotary Position Embedding, RoPEï¼‰ç­‰ä¾èµ–ä½ç½®ä¿¡æ¯çš„æ“ä½œå°±ä¼šå®Œå…¨é”™ä¹±ã€‚ ","date":"2025-07-08","objectID":"/remove_padding/:3:0","tags":["LLM","infra"],"title":"remove_padding","uri":"/remove_padding/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"ä¸€å¥è¯ï¼šåœ¨sequenceç»´åº¦ä¸Šè¿›è¡Œåˆ‡åˆ† å°†è¾“å…¥åºåˆ— X (é•¿åº¦ N) æ²¿åºåˆ—ç»´åº¦åˆ‡åˆ†ä¸º SP å—ï¼Œæ¯ä¸ª GPU åˆ†é…åˆ° N/SP é•¿åº¦çš„å­åºåˆ—ã€‚ å¯¹äºéæ³¨æ„åŠ›å±‚ (å¦‚ MLP)ï¼Œè®¡ç®—æ˜¯å®Œå…¨å±€éƒ¨çš„ï¼Œæ¯ä¸ª GPU å¤„ç†è‡ªå·±çš„å­åºåˆ—å³å¯ã€‚ token ä¹‹é—´ç‹¬ç«‹ï¼Œtoken-level projection Ulysses SPçš„æ ¸å¿ƒå¤æ‚æ€§åœ¨äºAttentionå±‚ã€‚ä¸ºäº†è®©æ¯ä¸ªtokenåœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶èƒ½å¤Ÿè€ƒè™‘åˆ°å…¨å±€åºåˆ—ä¿¡æ¯ï¼ˆæˆ–è€…è¯´ï¼Œè®©æ¯ä¸ªheadåœ¨è®¡ç®—æ—¶èƒ½çœ‹åˆ°å®Œæ•´çš„åºåˆ—ï¼Œå³ä½¿è¿™ä¸ªheadåªåœ¨å½“å‰rankè®¡ç®—ï¼‰ï¼ŒAttentionæ¨¡å—å‰åéœ€è¦è¿›è¡Œä¸¤æ¬¡ç²¾å¯†çš„all-to-allæ•°æ®é‡æ’ã€‚MLPå±‚åˆ™æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæ•°æ®åœ¨è¿›å…¥MLPæ—¶å·²ç»æ˜¯æŒ‰åºåˆ—åˆ†ç‰‡å¥½çš„ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæœ¬åœ°è®¡ç®—ã€‚ å¯¹äºæ³¨æ„åŠ›å±‚: æ­¥éª¤ 1 (è®¡ç®— Q, K, V): æ¯ä¸ª GPU åŸºäºå…¶æœ¬åœ°å­åºåˆ—è®¡ç®—å‡ºæœ¬åœ°çš„ Q_local, K_local, V_local (ç»´åº¦çº¦ä¸º N/SP x dï¼Œd æ˜¯éšè—ç»´åº¦)ã€‚ æ­¥éª¤ 2 (å…¨å±€ K, V æ”¶é›† - å…³é”®): ä½¿ç”¨Â All-to-AllÂ é€šä¿¡æ“ä½œï¼ˆAll-Gather??ï¼‰ã€‚æ¯ä¸ª GPU å°†è‡ªå·±çš„ K_local, V_local å‘é€ç»™æ‰€æœ‰å…¶ä»– GPUï¼Œå¹¶æ¥æ”¶æ¥è‡ªæ‰€æœ‰å…¶ä»– GPU çš„ K, V å—ã€‚æ‰§è¡Œåï¼Œæ¯ä¸ª GPU æ‹¥æœ‰å®Œæ•´çš„å…¨å±€ K å’Œ V çŸ©é˜µ (ç»´åº¦ N x d)ï¼Œä½†ä»ç„¶åªæ‹¥æœ‰æœ¬åœ°çš„ Q_local (ç»´åº¦ N/SP x d)ã€‚ https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/usage/collectives.html æ­¥éª¤ 3 (æœ¬åœ°æ³¨æ„åŠ›è®¡ç®—): æ¯ä¸ª GPU ä½¿ç”¨å…¶ Q_local å’Œå®Œæ•´çš„å…¨å±€ K, V è®¡ç®—å…¶è´Ÿè´£çš„é‚£éƒ¨åˆ†æ³¨æ„åŠ›è¾“å‡º O_local (ç»´åº¦ N/SP x d)ã€‚è®¡ç®—å…¬å¼ä¸º Attention(Q_local, K_global, V_global)ã€‚è¿™ä¸€æ­¥çš„è®¡ç®—é‡æ˜¯ (N/SP) * N * dï¼Œå†…å­˜ç“¶é¢ˆåœ¨äºå­˜å‚¨ä¸´æ—¶çš„æ³¨æ„åŠ›åˆ†æ•°çŸ©é˜µï¼Œå¤§å°çº¦ä¸ºÂ (N/SP) * Nã€‚ç›¸æ¯”åŸå§‹çš„Â **N*N**ï¼Œå†…å­˜æ˜¾è‘—é™ä½ã€‚ æ­¥éª¤ 4 (å¯é€‰çš„è¾“å‡ºé‡ç»„): å¦‚æœåç»­å±‚éœ€è¦æŒ‰åºåˆ—æ‹¼æ¥çš„å®Œæ•´è¾“å‡ºï¼Œå¯èƒ½éœ€è¦å¦ä¸€æ¬¡é€šä¿¡ï¼ˆå¦‚ All-Gather æˆ–å¦ä¸€æ¬¡ All-to-All çš„å˜ç§ï¼‰æ¥ç»„åˆ O_localã€‚ä½†åœ¨ DeepSpeed å®ç°ä¸­ï¼Œé€šå¸¸ä¿æŒåˆ†å¸ƒå¼çŠ¶æ€ï¼Œç›´æ¥è¾“å…¥åˆ°ä¸‹ä¸€ä¸ªåŒæ ·æŒ‰åºåˆ—å¹¶è¡Œçš„å±‚ã€‚ ","date":"2025-07-08","objectID":"/ulysses_sequence_parallel/:0:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ulysses_sequence_parallel","uri":"/ulysses_sequence_parallel/"},{"categories":["å¤§æ¨¡å‹åˆ†å¸ƒå¼","LLM"],"content":"verlä¸­çš„åºåˆ—å¹¶è¡Œ åœ¨verlä¸­ï¼Œä¸€èˆ¬ä¸remove_paddingä¸€èµ·ä½¿ç”¨ï¼Œå³ if config.actor_rollout_ref.actor.strategy in {\"fsdp\", \"fsdp2\"}: if ( config.actor_rollout_ref.actor.get(\"ulysses_sequence_parallel_size\", 1) \u003e 1 or config.actor_rollout_ref.ref.get(\"ulysses_sequence_parallel_size\", 1) \u003e 1 ): assert config.actor_rollout_ref.model.use_remove_padding, ( \"When using sequence parallelism for actor/ref policy, you must enable `use_remove_padding`.\" ) if self.use_critic and config.critic.strategy in {\"fsdp\", \"fsdp2\"}: if config.critic.get(\"ulysses_sequence_parallel_size\", 1) \u003e 1: assert config.critic.model.use_remove_padding, ( \"When using sequence parallelism for critic, you must enable `use_remove_padding`.\" ) å…ˆè¿›è¡Œremove paddingæ“ä½œ ç„¶åè¿›è¡Œåºåˆ—å¹¶è¡Œçš„padå’Œsliceæ“ä½œ ## å‚è€ƒ pytorch_distribute_tutorials/tutorials/3D-parallel/SP-åºåˆ—å¹¶è¡Œ.ipynb at main Â· chunhuizhang/pytorch_distribute_tutorials Â· GitHub ","date":"2025-07-08","objectID":"/ulysses_sequence_parallel/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"ulysses_sequence_parallel","uri":"/ulysses_sequence_parallel/"},{"categories":["","LLM","reasoning"],"content":"ç†µåå¡Œ UloRLï¼šAn Ultra-Long Output Reinforcement Learning Approach for Advancing Large Language Modelsâ€™ Reasoning Abilities UloRLçš„æ ¸å¿ƒåˆ›æ–° åŠ¨æ€æ©ç ç†Ÿç»ƒæŒæ¡æ­£å‘è¯å…ƒï¼ˆDynamic Masking of well-Mastered Positive Tokens, DMMPTsï¼‰ã€‚è®ºæ–‡ä½œè€…æ•é”åœ°æŒ‡å‡ºï¼Œç†µåå¡Œçš„æ ¹æºå¹¶éâ€œè®­ç»ƒæ­£æ ·æœ¬â€ï¼Œè€Œæ˜¯â€œè¿‡åº¦è®­ç»ƒå·²ç»ç†Ÿç»ƒæŒæ¡çš„æ­£å‘è¯å…ƒï¼ˆMPTsï¼‰â€ã€‚MPTsæŒ‡çš„æ˜¯é‚£äº›åœ¨æ­£ç¡®ç­”æ¡ˆä¸­ï¼Œä¸”æ¨¡å‹å·²ç»èƒ½ä»¥æé«˜æ¦‚ç‡ï¼ˆå¦‚\u003e99%ï¼‰é¢„æµ‹å‡ºæ¥çš„è¯å…ƒã€‚DMMPTsä¸ºæ­¤è®¾è®¡äº†ä¸€ä¸ªâ€œç†µå€¼æ’æ¸©å™¨â€ï¼š 1. è®¾å®šä¸€ä¸ªç†æƒ³çš„â€œç›®æ ‡ç†µå€¼â€ã€‚ 2. åœ¨è®­ç»ƒæ—¶ï¼Œå¦‚æœæ¨¡å‹çš„å½“å‰ç†µä½äºè¿™ä¸ªç›®æ ‡å€¼ï¼Œè¯´æ˜æ¨¡å‹å¼€å§‹å˜å¾—â€œåƒµåŒ–â€äº†ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨â€œå±è”½â€ï¼ˆmaskï¼‰æ‰é‚£äº›MPTsï¼Œä¸å†å¯¹å®ƒä»¬è¿›è¡Œè®­ç»ƒï¼Œè¿«ä½¿æ¨¡å‹å…³æ³¨é‚£äº›è¿˜æœªæŒæ¡å¥½çš„éƒ¨åˆ†ã€‚ 3. å¦‚æœæ¨¡å‹ç†µå€¼é«˜äºæˆ–ç­‰äºç›®æ ‡å€¼ï¼Œåˆ™æ­£å¸¸è¿›è¡Œè®­ç»ƒã€‚ ProRLï¼šProlonged Reinforcement Learning Expands Reasoning Boundaries in Large Language Models ","date":"2025-07-06","objectID":"/entropyreasoning/:1:0","tags":["LLM","reasoning"],"title":"entropy(reasoning)","uri":"/entropyreasoning/"},{"categories":["","LLM","reasoning"],"content":"åˆ©ç”¨ç†µ ","date":"2025-07-06","objectID":"/entropyreasoning/:2:0","tags":["LLM","reasoning"],"title":"entropy(reasoning)","uri":"/entropyreasoning/"},{"categories":["","LLM","reasoning"],"content":"First Return, Entropy-Eliciting Explore ","date":"2025-07-06","objectID":"/entropyreasoning/:2:1","tags":["LLM","reasoning"],"title":"entropy(reasoning)","uri":"/entropyreasoning/"},{"categories":["","LLM","reasoning"],"content":"AGENTIC REINFORCED POLICY OPTIMIZATION ","date":"2025-07-06","objectID":"/entropyreasoning/:2:2","tags":["LLM","reasoning"],"title":"entropy(reasoning)","uri":"/entropyreasoning/"},{"categories":["","LLM","reasoning"],"content":"å‚è€ƒ å°ä½œåŠçš„å¼ºåŒ–ä¹‹è·¯ ","date":"2025-07-06","objectID":"/entropyreasoning/:3:0","tags":["LLM","reasoning"],"title":"entropy(reasoning)","uri":"/entropyreasoning/"},{"categories":["","LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"content":"å‚è€ƒ RL ç³»ç»Ÿæ·±æ€ï¼šFSDP è®­ç»ƒåç«¯ PyTorch FSDP è®¾è®¡è§£è¯» ","date":"2025-07-06","objectID":"/fsdp/:1:0","tags":["LLM","å¤§æ¨¡å‹åˆ†å¸ƒå¼"],"title":"fsdp","uri":"/fsdp/"},{"categories":["","LLM","infra"],"content":"è¿›å…¥å¤§æ¨¡å‹æ—¶ä»£ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰å¤§æ¨¡å‹éƒ½ä½¿ç”¨ decoder éƒ¨åˆ†ï¼Œå› æ­¤æœ¬æ–‡åªåˆ†æ decoder éƒ¨åˆ†çš„å‚æ•°é‡ã€‚ Transformer çš„ decoder æ¯ä¸€å±‚ç”± attention å’Œ mlp ç»„æˆï¼Œä¸€èˆ¬æœ‰ l å±‚ã€‚ ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:0:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"Self-attention Self-attention å±‚ç”± \\(W_{Q}\\) ã€\\(W_{K}\\)ã€\\(W_{V}\\) å’Œè¾“å‡ºçŸ©é˜µ \\(W_{O}\\) å’Œå®ƒä»¬çš„åç½®ç»„æˆï¼Œæƒé‡çŸ©é˜µçš„å½¢çŠ¶ä¸º \\([h,h]\\)ï¼Œåç½®å½¢çŠ¶ä¸º \\([h]\\)ï¼Œåˆ™ self-attention éƒ¨åˆ†çš„å‚æ•°é‡ä¸º \\(4h^2+4h\\) ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:1:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"MLP MLP ç”± 2 ä¸ªçº¿æ€§å±‚æ„æˆï¼Œç¬¬ä¸€ä¸ªçº¿æ€§å±‚å°†ç»´åº¦ä» h å˜ä¸º 4 hï¼Œç¬¬äºŒä¸ªå°†ç»´åº¦ç”± 4 h å˜ä¸º hï¼Œç¬¬ä¸€ä¸ªæƒé‡çŸ©é˜µå½¢çŠ¶ä¸º \\([h,4h]\\)ï¼Œåç½®ä¸º \\([4h]\\)ï¼Œç¬¬äºŒä¸ªå½¢çŠ¶ä¸º \\([4h,h]\\)ï¼Œåç½®ä¸º \\([h]\\)ï¼Œåˆ™å‚æ•°é‡ä¸º \\(8h^2+5h\\) ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:2:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"Layer norm åœ¨ self-attention å’Œ mlp ä¸­éƒ½å­˜åœ¨ layer normï¼Œæœ‰ 2 ä¸ªå¯è®­ç»ƒå‚æ•°ï¼šç¼©æ”¾å‚æ•° \\(\\gamma\\) å’Œå¹³ç§»å‚æ•° \\(\\beta\\)ï¼Œå½¢çŠ¶éƒ½æ˜¯ \\([h]\\)ï¼Œ2 ä¸ª layer norm çš„å‚æ•°é‡ä¸º 4 hã€‚ ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:3:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"è¯åµŒå…¥ è¯åµŒå…¥çŸ©é˜µçš„å‚æ•°é‡å’Œè¯è¡¨å¤§å° V æœ‰å…³ï¼Œè€Œä¸”è¾“å…¥å’Œè¾“å‡ºä¸€èˆ¬å…¬ç”¨ä¸€ä¸ªçŸ©é˜µï¼Œå› æ­¤å‚æ•°é‡ä¸º \\(Vh\\) ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:4:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"ä½ç½®ç¼–ç  å¦‚æœæ˜¯å¯è®­ç»ƒå¼çš„ä½ç½®ç¼–ç ï¼Œåˆ™å æ®ä¸€å®šçš„å‚æ•°é‡ï¼Œå¦åˆ™ä¸å å‚æ•°é‡ ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:5:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"æ€»å‚æ•° ç»¼ä¸Šæ‰€è¿°ï¼Œtransformer ä¸€ä¸ªå±‚çš„å‚æ•°é‡ä¸º \\(12h^2+13h\\)ï¼Œl å±‚å°±æ˜¯ \\(l(12h^2+13h)\\)ï¼Œå†åŠ ä¸Šè¯åµŒå…¥çŸ©é˜µï¼Œæ€»å‚æ•°é‡ä¸º \\(l(12h^2+13h)+Vh\\)ï¼Œh è¾ƒå¤§æ—¶ï¼Œå¯ä»¥å¿½ç•¥ä¸€æ¬¡é¡¹ï¼Œè¿‘ä¼¼ä¸º \\(12lh^2\\) å®é™…å‚æ•°é‡ éšè—ç»´åº¦h å±‚æ•°l 12lh^2 6.7B 4096 32 6,442,450,944 13.0B 5120 40 12,582,912,000 32.5B 6656 60 31,897,681,920 65.2B 8192 80 64,424,509,440 è¡¨æ¥è‡ª åˆ†æ transformer æ¨¡å‹çš„å‚æ•°é‡ã€è®¡ç®—é‡ã€ä¸­é—´æ¿€æ´»ã€KV cache ## å‚è€ƒ # åˆ†ætransformeræ¨¡å‹çš„å‚æ•°é‡ã€è®¡ç®—é‡ã€ä¸­é—´æ¿€æ´»ã€KV cache Transformer Math (Part 1) - Counting Model Parameters ","date":"2025-07-06","objectID":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/:6:0","tags":["LLM","infra"],"title":"transformerå‚æ•°é‡åˆ†æ","uri":"/transformer%E5%8F%82%E6%95%B0%E9%87%8F%E5%88%86%E6%9E%90/"},{"categories":["","LLM","infra"],"content":"è®­ç»ƒæ—¶ æ¨¡å‹å‚æ•°ï¼šæˆ‘ä»¬æ¨¡å‹çš„å¯å­¦ä¹ æƒé‡ã€‚ Optimizer statesï¼ˆä¼˜åŒ–å™¨çŠ¶æ€ï¼‰ï¼šæ‚¨éœ€è¦è·Ÿè¸ªçš„ç¡®åˆ‡çŠ¶æ€å–å†³äºæ‚¨ä½¿ç”¨çš„ä¼˜åŒ–å™¨;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Â AdamWï¼Œåˆ™é™¤äº†æ¨¡å‹å‚æ•°ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦è·Ÿè¸ªç¬¬ä¸€å’Œç¬¬äºŒåŠ¨é‡ä¼°è®¡å€¼ã€‚ æ¨¡å‹æ¿€æ´»å€¼ï¼šè¿™å°†æ ¹æ®æ‚¨çš„ç½‘ç»œæ¶æ„å’Œæ‰¹å¤„ç†å¤§å°è€Œæœ‰æ‰€ä¸åŒï¼Œä½†ä¼šæ˜¾è‘—å½±å“å†…å­˜ä½¿ç”¨ã€‚åå‘ä¼ æ’­éœ€è¦æ­¤ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°è®¡ç®—æ¢¯åº¦ã€‚ æ¢¯åº¦ï¼šä¸ºæ¨¡å‹çš„æ¯ä¸ªå‚æ•°å­˜å‚¨ï¼Œä¸æ¨¡å‹å‚æ•°ç›¸åŒçš„å†…å­˜å ç”¨ã€‚ Input dataï¼šè¦ä¼ é€’ç»™æ¨¡å‹çš„ Importing æ•°æ®æ‰¹æ¬¡ï¼Œå†…å­˜å ç”¨å–å†³äºæ­£åœ¨å»ºæ¨¡çš„æ•°æ®çš„å¤§å°å’Œç±»å‹ã€‚ å›¾ç¤ºï¼š å…·ä½“æ•°å€¼ï¼š å¯¹äºä¸€ä¸ª transformer æ¥è¯´ï¼Œå‚æ•°é‡å¯ä»¥ç”±ä»¥ä¸‹å…¬å¼ç»™å‡ºï¼ˆè¯¦è§ transformerå‚æ•°é‡åˆ†æï¼‰ï¼š \\[N=h*v+L*(12*h^2+13*h)+2*h\\] In that equation, \\(h\\) is the hidden dimension, \\(v\\) the vocabulary size, and \\(L\\) the number of layers in the model. Note that looking at the equation we can see that the term that will dominate with large hidden dimensions is the \\(h^{2}\\) term, since itâ€™s the only one growing quadratically As we scale the parameters. åœ¨å…¨ç²¾åº¦è®­ç»ƒä¸­ï¼ˆæ‰€æœ‰çš„å­˜å‚¨å•ä½éƒ½æ˜¯ fp 32ï¼‰ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ adam çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹éƒ¨åˆ†æˆ‘ä»¬éœ€è¦å­˜å‚¨ï¼š \\[\\begin{aligned}\u0026m_{params}=4*N\\\\\u0026m_{grad}=4*N\\\\\u0026m_{opt}=(4+4)*N\\end{aligned}\\] è€Œåœ¨ä½¿ç”¨æ··åˆç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„å‚æ•°å’Œæ¢¯åº¦ä½¿ç”¨ bf 16ï¼Œä¸ºäº†ç¨³å®šæ€§ï¼Œä¼˜åŒ–å™¨è¿˜éœ€è¦å­˜å‚¨ fp 32 çš„æ¨¡å‹å‚æ•°ï¼Œå³ï¼š \\[\\begin{aligned}\u0026m_{params}=2*N\\\\\u0026m_{grad}=2*N\\\\\u0026m_{params\\_fp32}=4*N\\\\\u0026m_{opt} =(4+4)*N\\end{aligned}\\] Some libraries store grads in FP32, which would require an additionalÂ mparams_fp32=4âˆ—Nmparams_fp32â€‹=4âˆ—NÂ memory. This is done, for example, in Nanotron, because BF16 is lossy for smaller values and we always prioritize stability. SeeÂ this DeepSpeed issueÂ for more information. ä¹Ÿå°±æ˜¯è¯´æœ‰çš„åº“è¿˜å®ç°äº†å­˜å‚¨ fp 32 çš„æ¢¯åº¦ï¼Œè€ƒè™‘ç¨³å®šæ€§ã€‚ The FP32 copy of the parameters (mparams_fp32mparams_fp32â€‹) is sometimes called the â€œmaster weightsâ€ in the literature and codebases. ä¿å­˜ fp 32 æ¨¡å‹å‚æ•°çš„åŸå› æ˜¯ bf 16 çš„ç²¾åº¦ä¸è¶³ä»¥æ”¯æŒé«˜æ•ˆå‚æ•°æ›´æ–°ï¼Œfp 32 å¯ä»¥é¿å…è¯¯å·®ç´¯è®¡ï¼Œä¿è¯ä¼˜åŒ–å™¨çš„æ•°å€¼ç¨³å®šæ€§å’Œè®­ç»ƒæ•ˆæœã€‚å…·ä½“åˆ†æå¦‚ä¸‹ï¼ˆæ¥è‡ªä¸ºä»€ä¹ˆLLMä¸€èˆ¬ä½¿ç”¨è¾ƒå¤§çš„æƒé‡è¡°å‡ç³»æ•°ï¼Ÿï¼‰ï¼š ä»æµ®ç‚¹æ•°çš„å­˜å‚¨æ ¼å¼å»ºç«‹äº†ã€Œè®¡ç®—æœºæµ®ç‚¹æ•°çš„æ•°å€¼ç»å¯¹å€¼è¶Šå¤§ï¼Œåˆ™ç²¾åº¦è¶Šä½ã€çš„ç»“è®ºï¼Œå¯¹äºæ·±åº¦å­¦ä¹ è®­ç»ƒè¿‡ç¨‹ï¼ˆå‰å‘-åå‘-æ›´æ–°ï¼‰æ¥è¯´ï¼š å¦‚æœä½¿ç”¨ä½ç²¾åº¦æµ®ç‚¹æ•°ä¿å­˜å’Œæ›´æ–°æ¨¡å‹å‚æ•°æ—¶ï¼Œå¦‚æœæ¨¡å‹å‚æ•°ç»å¯¹å€¼æ¯”è¾ƒå¤§ï¼Œè€Œæ›´æ–°çš„æ­¥å¹…æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆæ›´æ–°ä¼šç”±äºèˆå…¥è¯¯å·®è€Œå¤±æ•ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç»´æŠ¤ä¸€ä¸ª fp 32 çš„æ¨¡å‹å‚æ•°çš„åŸå› ã€‚ å¹¶ä¸”ä»ä¸€ä¸ªé«˜ç²¾åº¦çš„æ¨¡å‹è½¬åŒ–ä¸ºä½ç²¾åº¦æ¨¡å‹çš„æ—¶å€™ï¼Œå‚æ•°çš„ç»å¯¹å€¼è¶Šå¤§ï¼Œåˆ™ä¸¢å¤±çš„ç²¾åº¦è¶Šå¤šã€‚åœ¨æ¨¡å‹æ›´æ–°äº†fp32çš„å¤‡ä»½ä¹‹åï¼Œè¿˜éœ€è¦å°†fp32çš„æƒé‡è½¬åŒ–ä¸ºä½ç²¾åº¦çš„ç‰ˆæœ¬ï¼Œå‚ä¸åç»­çš„forwardè¿‡ç¨‹ã€‚ç”±äºæµ®ç‚¹æ•°çš„ç²¾åº¦éšç€ç»å¯¹å€¼çš„å¢åŠ è€Œé™ä½ï¼Œå› æ­¤å‚æ•°çš„ç»å¯¹å€¼è¶Šå¤§ï¼Œåœ¨ç²¾åº¦çš„è½¬åŒ–ä¸­æŸå¤±çš„ç²¾åº¦ä¹Ÿè¶Šå¤šã€‚æ­¤å¤–ï¼Œåœ¨å‰å‘å’Œåå‘è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œæ¿€æ´»å€¼ä¹Ÿä¼šå­˜åœ¨ç±»ä¼¼çš„ç²¾åº¦æŸå¤±é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥æƒé‡è¡°å‡ï¼Œé‚£ä¹ˆæ¨¡å‹çš„æƒé‡çš„ç»å¯¹å€¼å°±å¯ä»¥å¾—åˆ°ä¸€å®šçš„æ§åˆ¶ã€‚é™¤äº†æä¾›ä¸€å®šçš„æ­£åˆ™åŒ–æ•ˆåº”ä¹‹å¤–ï¼Œä¹Ÿèƒ½å¤Ÿé™ä½ç”±äºæ¨¡å‹çš„å‚æ•°èŒƒæ•°å¢é•¿è€Œå¯¼è‡´çš„ç²¾åº¦æŸå¤±çš„é£é™©ã€‚ æ··åˆç²¾åº¦è®­ç»ƒç¤ºæ„å›¾ï¼š 1. å‚æ•°ä»¥FP32å­˜å‚¨ï¼›è¿™ä¸»è¦æ˜¯å› ä¸ºï¼Œåœ¨åŸºäºæ¢¯åº¦æ›´æ–°æƒé‡çš„æ—¶å€™ï¼Œå¾€å¾€å…¬å¼:æƒé‡ = æ—§æƒé‡ + lr * æ¢¯åº¦ï¼Œè€Œåœ¨æ·±åº¦æ¨¡å‹ä¸­ï¼Œlr * æ¢¯åº¦è¿™ä¸ªå€¼å¾€å¾€æ˜¯éå¸¸å°çš„ï¼Œå¦‚æœåˆ©ç”¨ fp16 æ¥è¿›è¡Œç›¸åŠ çš„è¯ï¼Œ åˆ™å¾ˆå¯èƒ½å‡ºç°ç²¾åº¦çš„é—®é¢˜ï¼Œå¯¼è‡´æ¨¡å‹æ— æ³•æ›´æ–°ã€‚å› æ­¤å‚æ•°ä»¥FP32çš„å½¢å¼å­˜å‚¨ 2. æ­£å‘è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°FP16ç®—å­ï¼Œéœ€è¦æŠŠç®—å­è¾“å…¥å’Œå‚æ•°ä»FP32 castæˆFP16è¿›è¡Œè®¡ç®—ï¼› 3. å°†Losså±‚è®¾ç½®ä¸ºFP32è¿›è¡Œè®¡ç®—ï¼› 4. åå‘è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¹˜ä»¥Loss Scaleå€¼ï¼Œé¿å…åå‘æ¢¯åº¦è¿‡å°è€Œäº§ç”Ÿä¸‹æº¢ï¼› 5. FP16å‚æ•°å‚ä¸æ¢¯åº¦è®¡ç®—ï¼Œå…¶ç»“æœå°†è¢«castå›FP32ï¼› 6. é™¤ä»¥Loss scaleå€¼ï¼Œè¿˜åŸè¢«æ”¾å¤§çš„æ¢¯åº¦ï¼› 7. åˆ¤æ–­æ¢¯åº¦æ˜¯å¦å­˜åœ¨æº¢å‡ºï¼Œå¦‚æœæº¢å‡ºåˆ™è·³è¿‡æ›´æ–°ï¼Œå¦åˆ™ä¼˜åŒ–å™¨ä»¥FP32å¯¹åŸå§‹å‚æ•°è¿›è¡Œæ›´æ–°ã€‚ æ ¹æ®ä¸Šè¿°å…¬å¼å¯ä»¥å¿«é€Ÿå¾—åˆ°ä¸€äº›æ¨¡å‹è®­ç»ƒæ—¶å ç”¨æ˜¾å­˜ï¼š image.png æ­¤å¤–æ¿€æ´»å€¼ä¹Ÿæ˜¯æ˜¾å­˜çš„å·¨å¤§æ€æ‰‹ï¼Œéšç€å¥å­é•¿åº¦çš„å¢åŠ è€Œå¢åŠ ï¼Œæœ‰ä»¥ä¸‹çš„è®¡ç®—å…¬å¼ï¼š \\[m_{act}=L\\cdot seq\\cdot bs\\cdot h\\cdot(34+\\frac{5\\cdot n_{heads}\\cdot seq}h)\\] Here, \\(L\\) is the number of layers, seq the sequence length, \\(bs\\) the batch size in samples, \\(h\\) the hidden dimension of the model, and \\(n_{heads}\\) the number of heads. image.png å¯è§åœ¨é•¿ä¸Šä¸‹æ–‡çš„è®­ç»ƒä¸­ï¼Œæ¿€æ´»å€¼æ‰æ˜¯æ˜¾å­˜æœ€å¤§çš„æ€æ‰‹ã€‚è¿™å°±éœ€è¦Activation checkpointing æ¥é™ä½è¿™éƒ¨åˆ†çš„æ˜¾å­˜å ç”¨ï¼Œè¯¦è§ Activation checkpointing ","date":"2025-07-06","objectID":"/%E6%98%BE%E5%AD%98%E5%8D%A0%E7%94%A8%E8%AE%A1%E7%AE%97/:1:0","tags":["LLM","infra"],"title":"æ˜¾å­˜å ç”¨è®¡ç®—","uri":"/%E6%98%BE%E5%AD%98%E5%8D%A0%E7%94%A8%E8%AE%A1%E7%AE%97/"},{"categories":["","LLM","infra"],"content":"æ¨ç†æ—¶ ä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯ï¼šæ¨ç†æ—¶çš„å³°å€¼æ˜¾å­˜å¤§è‡´æ˜¯æ¨¡å‹å‚æ•°æ˜¾å­˜çš„ 1.5 - 2.5 å€ï¼ˆå°¤å…¶åœ¨å¤„ç†é•¿åºåˆ—æˆ–å¤§æ‰¹æ¬¡æ—¶ï¼‰ã€‚æ›´ç²¾ç¡®çš„ä¼°è®¡éœ€è¦ç»“åˆå…·ä½“æ¨¡å‹å’Œè¾“å…¥ è¾“å…¥/è¾“å‡ºçš„ Token å­˜å‚¨ï¼šéœ€è¦æ˜¾å­˜å­˜å‚¨è¾“å…¥çš„ Token åµŒå…¥ï¼ˆembeddingï¼‰å’Œç”Ÿæˆçš„è¾“å‡º Tokenã€‚ Key-Value ç¼“å­˜ï¼ˆKV Cacheï¼‰ï¼šè‡ªå›å½’ç”Ÿæˆæ—¶ï¼Œä¸ºé¿å…é‡å¤è®¡ç®—å†å² Token çš„ Key/Valueï¼Œéœ€ç¼“å­˜è¿™äº›ä¸­é—´ç»“æœï¼ˆæ˜¾å­˜å ç”¨ä¸è¾“å…¥+è¾“å‡ºé•¿åº¦æˆæ­£æ¯”ï¼‰ å…³äº kv cache å ç”¨æ˜¾å­˜çš„è®¡ç®—ï¼Œè¯¦è§ KV cache ## å‚è€ƒ The Ultra-Scale Playbook - a Hugging Face Space by nanotron ","date":"2025-07-06","objectID":"/%E6%98%BE%E5%AD%98%E5%8D%A0%E7%94%A8%E8%AE%A1%E7%AE%97/:2:0","tags":["LLM","infra"],"title":"æ˜¾å­˜å ç”¨è®¡ç®—","uri":"/%E6%98%BE%E5%AD%98%E5%8D%A0%E7%94%A8%E8%AE%A1%E7%AE%97/"},{"categories":["","é¢ç»"],"content":"å¸¸è§é—®é¢˜æ€»ç»“ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:0:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"å¤šè½®å¯¹è¯sftæ ·æœ¬æ€ä¹ˆæ„é€ ï¼Ÿ [å¤§æ¨¡å‹å¾®è°ƒæ ·æœ¬æ„é€  trick]ï¼ˆhttps://zhuanlan.zhihu.com/p/641562439) å¤šè½®å¯¹è¯çš„ä¼ ç»Ÿç»„ç»‡æ–¹å¼ï¼šå°†å¤šè½®å¯¹è¯æ‹†åˆ†ä¸ºå¤šæ¡ç‹¬ç«‹çš„è®­ç»ƒæ ·æœ¬ï¼Œå¦‚ Q1A1/Q2A2/Q3A3 å¯æ‹†åˆ†ä¸º Q1â€”\u003eA1ï¼Œ Q1A1Q2-\u003eA2ï¼Œ Q1A1Q2A2Q3-\u003eA3 ä¸‰æ¡æ ·æœ¬ã€‚ å°†æ•´ä¸ª session çš„å¯¹è¯å†…å®¹æ‹¼æ¥æˆä¸€ä¸ªé•¿æ–‡æœ¬åºåˆ—ï¼Œä¾‹å¦‚ï¼šQ1 A1 Q2 A2 Q3 A3ã€‚è¿™æ ·ï¼Œæ•´ä¸ª session è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªè¿ç»­çš„æ–‡æœ¬åºåˆ—ï¼Œè€Œä¸æ˜¯å¤šæ¡ç‹¬ç«‹çš„æ ·æœ¬ã€‚ æ„é€ æ—¶è®¡ç®—æŸå¤±æœ‰ä¸€äº›å‘ï¼Œè¯¦è§ https://zhuanlan.zhihu.com/p/721652210 ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:1:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"SFT æ˜¯å¦å¯ä»¥æ³¨å…¥çŸ¥è¯†ï¼Ÿ continue pretrain æ³¨å…¥çŸ¥è¯†ã€‚ sft å¯¹é½è¾“å‡ºæ ¼å¼ã€‚ï¼ˆsft åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ç¡®å®æ˜¯å¯ä»¥æ³¨å…¥çŸ¥è¯†çš„ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:2:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"å¦‚ä½•è§£å†³ç¾éš¾æ€§é—å¿˜ï¼Ÿ ä¿ç•™é€šç”¨æ•°æ®ï¼šåœ¨è¿›è¡Œé¢†åŸŸæ•°æ®è®­ç»ƒæ—¶ï¼Œä»ç„¶éœ€è¦ä¿ç•™ä¸€éƒ¨åˆ†é€šç”¨æ•°æ®ç”¨äºæ¨¡å‹è®­ç»ƒã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¨¡å‹ä»ç„¶èƒ½å¤Ÿå­¦ä¹ åˆ°é€šç”¨çš„è¯­è¨€å’ŒçŸ¥è¯†ï¼Œä»è€Œä¿æŒä¸€å®šçš„é€šç”¨èƒ½åŠ›ã€‚ å¢é‡å­¦ä¹ ï¼šä½¿ç”¨å¢é‡å­¦ä¹ ï¼ˆIncremental Learningï¼‰çš„æ–¹æ³•ï¼Œå°†é¢†åŸŸæ•°æ®ä¸é€šç”¨æ•°æ®é€æ­¥äº¤æ›¿è¿›è¡Œè®­ç»ƒã€‚è¿™æ ·å¯ä»¥åœ¨å­¦ä¹ æ–°é¢†åŸŸçš„åŒæ—¶ï¼Œä¿æŒå¯¹é€šç”¨çŸ¥è¯†çš„è®°å¿†ã€‚ æ•°æ®é‡é‡‡æ ·ï¼šåœ¨è¿›è¡Œé¢†åŸŸæ•°æ®è®­ç»ƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ®é‡é‡‡æ ·çš„æ–¹æ³•ï¼Œä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ›´å¤šåœ°æ¥è§¦åˆ°é€šç”¨æ•°æ®ï¼Œä»è€Œç¼“è§£é—å¿˜é€šç”¨èƒ½åŠ›çš„é—®é¢˜ã€‚ å¼ºåŒ–å­¦ä¹ ï¼šä½¿ç”¨å¼ºåŒ–å­¦ä¹ çš„æ–¹æ³•ï¼Œé€šè¿‡ç»™æ¨¡å‹è®¾ç½®å¥–åŠ±æœºåˆ¶ï¼Œé¼“åŠ±æ¨¡å‹åœ¨é¢†åŸŸä»»åŠ¡ä¸Šè¡¨ç°å¥½ï¼ŒåŒæ—¶ä¿æŒä¸€å®šçš„é€šç”¨èƒ½åŠ›ã€‚ é¢†åŸŸé€‚åº”æŠ€æœ¯ï¼šä½¿ç”¨é¢†åŸŸé€‚åº”æŠ€æœ¯ï¼Œå¦‚é¢†åŸŸè‡ªé€‚åº”ï¼ˆDomain Adaptationï¼‰å’Œé¢†åŸŸå¯¹æŠ—è®­ç»ƒï¼ˆDomain Adversarial Trainingï¼‰ï¼Œå¸®åŠ©æ¨¡å‹åœ¨ä¸åŒé¢†åŸŸä¹‹é—´è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œä»è€Œå‡å°‘é—å¿˜é€šç”¨èƒ½åŠ›çš„é—®é¢˜ã€‚ SDFTï¼šå¾®è°ƒå‰ï¼Œè®©å¤§æ¨¡å‹å°†ä»»åŠ¡æ•°æ®é›†é‡å†™ä¸€éã€‚è¿™æ ·çš„è¯ï¼Œé‡å†™åçš„ä»»åŠ¡æ•°æ®é›†çš„åˆ†å¸ƒå’Œå¤§æ¨¡å‹çš„å·®å¼‚å°±å°äº†å¾ˆå¤šã€‚åœ¨è¿™æ ·çš„æ•°æ®é›†ä¸Šå¾®è°ƒå¯¹å¤§æ¨¡å‹åˆ†å¸ƒä¸Šçš„æ”¹å˜ä¼šå°å¾ˆå¤šï¼Œå¯¹å¤§æ¨¡å‹é€šç”¨èƒ½åŠ›çš„æŸå®³ä¹Ÿä¼šé™ä½ã€‚ Llama-Pro:åœ¨åŸå§‹æ¨¡å‹ä¸­æ¯ä¸ªTransformerå—æˆ–è€…æŸå‡ ä¸ªTransformerå—åå¢åŠ ä¸€ä¸ªTransformerå—ï¼Œä½†ä¸ºäº†ä¿æŒæ‰©å±•åçš„æ¨¡å‹è¾“å‡ºä¿æŒä¸å˜ï¼Œéœ€è¦å¢åŠ çš„å—ä¸ºæ’ç­‰å—ï¼ˆè¾“å…¥è¾“å‡ºç›¸åŒï¼‰ ä¸ºä»€ä¹ˆå¤§æ¨¡å‹éƒ½æ˜¯ Decoder-Only æ¶æ„ï¼Ÿï¼ˆhttps://www.zhihu.com/question/588325646/answer/3357252612ï¼‰ æ³›åŒ–æ€§èƒ½æ›´å¥½ï¼šICML 22çš„What language model architecture and pretraining objective works best for zero-shot generalization?. åœ¨æœ€å¤§5Bå‚æ•°é‡ã€170B tokenæ•°æ®é‡çš„è§„æ¨¡ä¸‹åšäº†ä¸€äº›åˆ—å®éªŒï¼Œå‘ç°ç”¨next token predictioné¢„è®­ç»ƒçš„decoder-onlyæ¨¡å‹åœ¨å„ç§ä¸‹æ¸¸ä»»åŠ¡ä¸Šzero-shotæ³›åŒ–æ€§èƒ½æœ€å¥½ è‹ç¥å¼ºè°ƒçš„æ³¨æ„åŠ›æ»¡ç§©çš„é—®é¢˜ï¼ŒåŒå‘attentionçš„æ³¨æ„åŠ›çŸ©é˜µå®¹æ˜“é€€åŒ–ä¸ºä½ç§©çŠ¶æ€ï¼Œè€Œ causal attentionçš„æ³¨æ„åŠ›çŸ©é˜µæ˜¯ä¸‹ä¸‰è§’çŸ©é˜µï¼Œå¿…ç„¶æ˜¯æ»¡ç§©çš„ï¼Œå»ºæ¨¡èƒ½åŠ›æ›´å¼ºï¼› @yiliå¤§ä½¬å¼ºè°ƒçš„é¢„è®­ç»ƒä»»åŠ¡éš¾åº¦é—®é¢˜ï¼Œçº¯ç²¹çš„decoder-onlyæ¶æ„+next token predicitioné¢„è®­ç»ƒï¼Œæ¯ä¸ªä½ç½®æ‰€èƒ½æ¥è§¦çš„ä¿¡æ¯æ¯”å…¶ä»–æ¶æ„å°‘ï¼Œè¦é¢„æµ‹ä¸‹ä¸€ä¸ªtokenéš¾åº¦æ›´é«˜ï¼Œå½“æ¨¡å‹è¶³å¤Ÿå¤§ï¼Œæ•°æ®è¶³å¤Ÿå¤šçš„æ—¶å€™ï¼Œdecoder-onlyæ¨¡å‹å­¦ä¹ é€šç”¨è¡¨å¾çš„ä¸Šé™æ›´é«˜ï¼› @mimimumu å¤§ä½¬å¼ºè°ƒï¼Œä¸Šä¸‹æ–‡å­¦ä¹ ä¸ºdecoder-onlyæ¶æ„å¸¦æ¥çš„æ›´å¥½çš„few-shotæ€§èƒ½ï¼šprompt å’Œdemonstrationçš„ä¿¡æ¯å¯ä»¥è§†ä¸ºå¯¹æ¨¡å‹å‚æ•°çš„éšå¼å¾®è°ƒï¼Œdecoder-onlyçš„æ¶æ„ç›¸æ¯”encoder-decoderåœ¨in-context learningä¸Šä¼šæ›´æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºpromptå¯ä»¥æ›´åŠ ç›´æ¥åœ°ä½œç”¨äºdecoderæ¯ä¸€å±‚çš„å‚æ•°ï¼Œå¾®è°ƒçš„ä¿¡å·æ›´å¼ºï¼› å¤šä½å¤§ä½¬å¼ºè°ƒäº†ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½è§†çš„å±æ€§ï¼Œcausal attentionï¼ˆå°±æ˜¯decoder-onlyçš„å•å‘ attentionï¼‰å…·æœ‰éšå¼çš„ä½ç½®ç¼–ç åŠŸèƒ½ï¼Œæ‰“ç ´äº†transformerçš„ä½ç½®ä¸å˜æ€§ï¼Œè€Œå¸¦æœ‰åŒå‘ attentionçš„æ¨¡å‹ï¼Œå¦‚æœä¸å¸¦ä½ç½®ç¼–ç ï¼ŒåŒå‘attentionçš„éƒ¨åˆ†tokenå¯ä»¥å¯¹æ¢ä¹Ÿä¸æ”¹å˜è¡¨ç¤ºï¼Œå¯¹è¯­åºçš„åŒºåˆ†èƒ½åŠ›å¤©ç”Ÿè¾ƒå¼±ã€‚ decoder-onlyæ”¯æŒä¸€ç›´å¤ç”¨KV-Cacheï¼Œå¯¹å¤šè½®å¯¹è¯æ›´å‹å¥½ï¼Œå› ä¸ºæ¯ä¸ªtokençš„è¡¨ç¤ºåªå’Œå®ƒä¹‹å‰çš„è¾“å…¥æœ‰å…³ï¼Œè€Œencoder-decoderå’ŒPrefixLMå°±éš¾ä»¥åšåˆ°ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:3:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Transfomer attentionè®¡ç®—ä¸ºä»€ä¹ˆé™¤ä»¥æ ¹å· dï¼Ÿ ä¸ºä»€ä¹ˆä¸åœ¨rollouté˜¶æ®µä¿å­˜logpè€Œæ˜¯å†è®¡ç®—ä¸€élogpï¼Ÿ å› ä¸ºforwardçš„æ—¶å€™å’Œgenerateçš„æ—¶å€™logprobç”±äºæ¨ç†å¼•æ“ï¼ˆvllmï¼‰å’Œè®­ç»ƒå¼•æ“ï¼ˆfsdpï¼‰çš„ä¼˜åŒ–ç›®æ ‡ä¸ä¸€æ ·ï¼Œä¼šé€ æˆä¸¤è€…å¯¹ä¸ä¸Šï¼Œå› æ­¤éœ€è¦åšä¸¤æ¬¡ã€‚ batch ç®—å­çš„ç»†å¾®å·®å¼‚ï¼Œéƒ½ä¼šé€ æˆè¿™ä¸¤ä¸ª log_prob ä¸å®Œå…¨ä¸€è‡´ã€‚æ¨ç†å¼•æ“è¦çš„æ˜¯å¿«é€Ÿå‡º token idï¼Œè®­ç»ƒå¼•æ“éœ€è¦ä¿è¯ä¸€å®šçš„log_prob ç²¾åº¦ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:4:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ä¸ºä»€ä¹ˆéœ€è¦ Server æ¥å®Œæˆ rolloutï¼Ÿ ä¸ºäº†é…åˆ agentic LLM çš„è®­ç»ƒï¼Œåœ¨ç°æœ‰çš„PPO/GRPO ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œä» single turn rollout æ”¹åŠ¨ä¸º environment interactive multi-turn rollout çš„éœ€æ±‚éå¸¸å¼ºçƒˆã€‚ è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œpolicy ä¸ environment çš„äº¤äº’å­˜åœ¨ç»å¯¹ä¸å¯å¿½è§†çš„å»¶è¿Ÿï¼Œturn ä¹‹é—´çš„ç­‰å¾…æ—¶é—´å¾ˆé•¿ã€‚ä¸€ç›´ç”¨ Engine åš rollout çš„è¯ï¼ˆ engine.generateï¼‰ï¼Œå¯èƒ½è¿ continuous batching éƒ½ç»„ä¸èµ·æ¥ã€‚æ‰€ä»¥ï¼Œæ”¹ç”¨ server æ¥é€šè¿‡ https åš rolloutçš„éœ€æ±‚å°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚å®é™…ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ æœ€è‡ªç„¶çš„å·¥ä½œæ–¹å¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œenvironment çš„äº¤äº’å¾€å¾€ä¹Ÿæ˜¯é€šè¿‡ https è¯·æ±‚æ¥å®Œæˆçš„ã€‚è­¬å¦‚ï¼Œä¼—å¤š coding sandbox éƒ½æ˜¯ environment è‡ªå·±å¯åŠ¨ä¸€ä¸ª server æš´éœ²ä¸€ä¸ª portï¼Œç„¶åå¾€é‡Œé¢å‘è¯·æ±‚æ¥å®ç°äº¤äº’çš„ã€‚ æ€»ä¹‹ï¼Œä¸ºäº†åœ¨ training engine,rollout å’Œ environment ä¸‰ä¸ªå­è¿›ç¨‹ä¸­ä¿æŒè‰¯å¥½çš„é€šè®¯å’Œäº¤äº’ï¼Œé€‰æ‹© server åŠ¿åœ¨å¿…è¡Œã€‚ MCPå’Œfuction callçš„åŒºåˆ«ï¼Ÿï¼ˆhttps://zhuanlan.zhihu.com/p/1898326676087223572ï¼‰ å‡½æ•°è°ƒç”¨æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸ LLM æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è¯†åˆ«å®ƒéœ€è¦ä»€ä¹ˆå·¥å…·ä»¥åŠä½•æ—¶è°ƒç”¨å®ƒã€‚ MCPï¼ˆå³æ¨¡å‹ä¸Šä¸‹æ–‡åè®®,Model Context Protocolï¼‰è¯•å›¾æ ‡å‡†åŒ–æ­¤è¿‡ç¨‹ã€‚ MCP (Model Context Protocol):æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®å’Œæ ‡å‡†ï¼Œæ—¨åœ¨æ ‡å‡†åŒ–AI åº”ç”¨ï¼ˆMCP å®¢æˆ·ç«¯ï¼‰å¦‚ä½•å‘ç°ã€è¿æ¥å’Œä¸å¤–éƒ¨å·¥å…·/æ•°æ®æºï¼ˆå®ç°ä¸º MCP æœåŠ¡å™¨ï¼‰è¿›è¡Œäº¤äº’ã€‚å®ƒå…³æ³¨çš„æ˜¯ç³»ç»Ÿé—´çš„é€šä¿¡å’Œé›†æˆï¼Œè§£å†³ Function Calling æŒ‡ä»¤ç”Ÿæˆåï¼Œå¦‚ä½•é«˜æ•ˆã€å®‰å…¨ã€å¯æ‰©å±•åœ°æ‰§è¡Œè¿™äº›è°ƒç”¨ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:5:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ä¸ºä»€ä¹ˆR1ä¸ä½¿ç”¨æ¨¡å‹rewardï¼Ÿ reward hacking è®­ç»ƒèµ„æºé—®é¢˜ï¼Œæˆæœ¬è¿‡é«˜ã€‚ ä¸ºä»€ä¹ˆPRM+MCTSè¿™æ¡è·¯èµ°ä¸é€šï¼Ÿï¼ˆhttps://zhuanlan.zhihu.com/p/19623772462ï¼‰ åœ¨reasoningä»»åŠ¡ä¸­å¦‚ä½•æ˜¾å¼å®šä¹‰stepï¼Œæ¯”å¦‚ä»¥\\n è¿˜æ˜¯ä»¥æ¨ç†é€»è¾‘æ¥åˆ’åˆ†stepï¼Ÿ å¦‚ä½•å®šä¹‰stepæ­£ç¡®æ€§ï¼Œå°†å½±å“step labeleræ¥é«˜æ•ˆæ ‡æ³¨ PRMå®¹æ˜“reward hacking LLMæ¯”è±¡æ£‹æœç´¢ç©ºé—´å¤§å¤ªå¤š MCTSä»·å€¼å½±å“æ¨¡å‹ç”Ÿæˆè´¨é‡ï¼ˆä¸å¦‚çº¯CoTé‡‡æ ·ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:6:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"GRPOä¸­å¯ä»¥å»æ‰KLé¡¹å—ï¼Ÿ å¯ä»¥ã€‚ å»é™¤KLé¡¹, æ„å‘³ç€ä¸éœ€è¦ref-model, å‡å°‘ä¸€ä¸ªæ¨¡å‹çš„æ˜¾å­˜ï¼Œå‡å°‘ä¸€æ¬¡å‰å‘ref_policyçš„è®¡ç®—ã€‚ æ²¡æœ‰KLçš„çº¦æŸï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿‡å¤§çš„æ¢¯åº¦è¿›è¡Œè£å‰ª(max_grad_norm)ï¼Œé¿å…ä¼˜åŒ–çš„ä¸ç¨³å®šæ€§(è¿™ä¹Ÿæ˜¯å¦ä¸€ç§å±‚é¢çš„clip)ã€‚ æ²¡æœ‰KLçš„çº¦æŸï¼Œå‚æ•°çš„ä¼˜åŒ–æ›´åŠ è‡ªç”±ï¼Œæ›´å®¹æ˜“æ¢ç´¢åˆ°å¥½çš„å›ç­” GRPO çš„æŸå¤±ä¸ºä»€ä¹ˆä¼šä¸ºè´Ÿï¼ˆå‚è€ƒ https://zhuanlan.zhihu.com/p/28326620566ï¼‰ æ€»ç»“ï¼šç»„å¥–åŠ±å˜åŒ–å¯¹ loss ä¸Šå‡å½±å“ä¸ç›´è§‚ã€‚ä¼˜åŒ–ç­–ç•¥è¿œç¦» refï¼ŒKL å˜åŒ–å¤§ï¼Œå¯¼è‡´ Loss ä¸Šå‡æ˜æ˜¾ã€‚ Qwenæ¨¡å‹ä¸ºä»€ä¹ˆéšæœºå¥–åŠ±ä¹Ÿèƒ½workï¼Ÿï¼ˆhttps://rethink-rlvr.notion.site/Spurious-Rewards-Rethinking-Training-Signals-in-RLVR-1f4df34dac1880948858f95aeb88872fï¼‰ æ¨¡å‹ä¾èµ–æ€§ï¼šç ”ç©¶å‘ç°ï¼ŒRLVRçš„æœ‰æ•ˆæ€§æ›´å¤šåœ°ä¾èµ–äºæ¨¡å‹çš„é¢„è®­ç»ƒèƒ½åŠ›ï¼Œè€Œä¸æ˜¯ç›‘ç£ä¿¡å·çš„è´¨é‡ã€‚Qwenæ¨¡å‹åœ¨é¢„è®­ç»ƒæœŸé—´å­¦ä¼šäº†ç‰¹å®šçš„æ¨ç†ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥é€šè¿‡RLVRè½»æ˜“åœ°è¢«æ¿€å‘å‡ºæ¥ï¼Œè€Œå…¶ä»–æ¨¡å‹åˆ™ä¸å…·å¤‡è¿™äº›ç­–ç•¥ã€‚ ä»£ç æ¨ç†ç­–ç•¥ï¼šQwen-Mathæ¨¡å‹åœ¨é¢„è®­ç»ƒé˜¶æ®µå°±é¢‘ç¹åœ°ä½¿ç”¨Pythonä»£ç æ¥è§£å†³æ•°å­¦é—®é¢˜ï¼Œå³ä½¿åœ¨æ²¡æœ‰ä»£ç æ‰§è¡Œå™¨çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½ç”Ÿæˆæ­£ç¡®çš„ä»£ç è¾“å‡ºå’Œç­”æ¡ˆã€‚RLVRè®­ç»ƒï¼ˆæ— è®ºå¥–åŠ±è´¨é‡å¦‚ä½•ï¼‰è¿›ä¸€æ­¥å¢åŠ äº†è¿™ç§ä»£ç æ¨ç†çš„é¢‘ç‡ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚ å¥–åŠ±ä¿¡å·çš„ä½œç”¨ï¼šä¸å¯é å¥–åŠ±é€šè¿‡æ”¾å¤§æ¨¡å‹åœ¨é¢„è®­ç»ƒæœŸé—´å­¦åˆ°çš„æœ‰ç”¨æ¨ç†è¡¨ç¤ºæ¥å‘æŒ¥ä½œç”¨ã€‚è¿™äº›å¥–åŠ±ä¿¡å·å¹¶æ²¡æœ‰æ•™ä¼šæ¨¡å‹ä»»åŠ¡è´¨é‡ï¼Œè€Œæ˜¯è§¦å‘äº†ä¸€ç§é›†ä¸­æ•ˆåº”ï¼Œä½¿æ¨¡å‹ä¸“æ³¨äºå…¶ç°æœ‰çš„æ¨ç†æ¨¡å¼åˆ†å¸ƒã€‚ ä¸ºä»€ä¹ˆDPOé‡ŒChosenå’ŒRejectedæ¦‚ç‡ä¼šåŒæ—¶ä¸‹é™?ï¼ˆhttps://zhuanlan.zhihu.com/p/6327313416ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:7:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"reward hackingå¦‚ä½•è§£å†³ï¼Ÿ æ¢¯åº¦ç´¯ç§¯ä¸¤æ¬¡ï¼Œè·Ÿ batch size å¢å¤§ 2 å€ï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•ˆæœä¸€æ ·å—ï¼Ÿï¼ˆloss çš„ 3 æ¬¡å¹³å‡ï¼‰ ç†è®ºä¸Šï¼Œæ¢¯åº¦ç´¯è®¡åœ¨æ•°å­¦ä¸Šåº”è¯¥ç­‰åŒäºå…¨æ‰¹é‡è®­ç»ƒï¼Œä½†å®é™…å‘ç° loss å¹¶ä¸åŒ¹é…ã€‚( Gradient accumulation yields worse results than the equivalent batch size Â· Issue #2175 Â· huggingface/trl) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œloss è®¡ç®—ä¼šç»å†ä¸‰æ¬¡å¹³å‡ micro batch ç»´åº¦ï¼Œåˆ†æ¯æ˜¯è¿™ä¸ª micro batch ä¸­çš„æ‰€æœ‰ label ä¸æ˜¯ -100 çš„ token æ•°ï¼ˆä¸åŒ token ä¹‹é—´ loss çš„å¹³å‡ï¼‰ DP ç»´åº¦ï¼Œåˆ†æ¯æ˜¯ DP size ï¼ˆå’Œ GPU æ•°é‡ç›¸å…³ï¼Œä¸åŒæœºå™¨ä¹‹é—´ loss çš„å¹³å‡ï¼‰ æ¢¯åº¦ç´¯åŠ ç»´åº¦ï¼Œåˆ†æ¯æ˜¯æ¢¯åº¦ç´¯åŠ æ•°ã€‚ï¼ˆä¸åŒ batch ä¹‹é—´çš„ loss çš„å¹³å‡ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:8:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ä¸ºä»€ä¹ˆä¸ç”¨å¤§æ¨¡å‹åš embeddingï¼Ÿ å¤§æ¨¡å‹ä¸»è¦è®­ç»ƒçš„é¢„æµ‹ next token çš„èƒ½åŠ›ï¼Œè€Œéåˆ¤æ–­æ•´ä¸ªå¥å­ embedding çš„å¥½åã€‚å› æ­¤ä½¿ç”¨ LLM åšåµŒå…¥æ•ˆæœä¸ç†æƒ³ã€‚ éƒ¨ç½²æˆæœ¬é«˜ã€‚ åŸºç¡€çŸ¥è¯† Post-Trainingæ€»ç»“ï¼ˆhttps://mp.weixin.qq.com/s/VLWU3YnJa1SZRCySZQc4Hwï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:9:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Flash Attention ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:10:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"MoE ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:11:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"KV cache ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:12:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ä» MHA åˆ° MLA ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:13:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Transformer ç›¸å…³ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:14:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"æ‰‹æ’•å„æ¨¡å—ä»£ç  free-running mode å’Œ teacher forcing modeï¼ˆhttps://zhuanlan.zhihu.com/p/630356292) ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:14:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Transformer å‚æ•°é‡è®¡ç®— ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:14:2","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"overthinking æ€ä¹ˆè§£å†³ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:15:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ç›¸å…³æ–‡çŒ® ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:15:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"æ–¹æ³• æ¨ç†é“¾å‹ç¼©ï¼šåœ¨ä¿æŒæ¨ç†è´¨é‡çš„åŒæ—¶ï¼Œå‡å°‘ç”Ÿæˆçš„ token æ•°é‡ã€‚ é•¿åº¦é¢„ç®—æ§åˆ¶ï¼šåœ¨æ¨ç†è¿‡ç¨‹ä¸­åŠ¨æ€è°ƒæ•´ç”Ÿæˆå†…å®¹çš„é•¿åº¦ï¼Œä»¥æé«˜æ•ˆç‡ã€‚ ç³»ç»Ÿåˆ‡æ¢ä¸æ¨¡å‹åˆ‡æ¢ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚çµæ´»é€‰æ‹©ä¸åŒçš„æ¨¡å‹æˆ–æ¨ç†è·¯å¾„ã€‚ å¹¶è¡Œæœç´¢ï¼šåˆ©ç”¨å¹¶è¡Œè®¡ç®—åŠ é€Ÿæ¨ç†è¿‡ç¨‹ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:15:2","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"DeepSpeedï¼ˆzero æ˜¾å­˜ä¼˜åŒ–ï¼‰ æ¨¡å‹æ˜¾å­˜å ç”¨ï¼ˆbf16/fp16ï¼‰ï¼ˆhttps://zhuanlan.zhihu.com/p/665172400ï¼‰ è®­ç»ƒæ—¶ å¯è§æ¿€æ´»å€¼å å¤§å¤´ã€‚ ä¼˜åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š æ¨ç†æ—¶ ä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯ï¼šæ¨ç†æ—¶çš„å³°å€¼æ˜¾å­˜å¤§è‡´æ˜¯æ¨¡å‹å‚æ•°æ˜¾å­˜çš„ 1.5 - 2.5 å€ï¼ˆå°¤å…¶åœ¨å¤„ç†é•¿åºåˆ—æˆ–å¤§æ‰¹æ¬¡æ—¶ï¼‰ã€‚æ›´ç²¾ç¡®çš„ä¼°è®¡éœ€è¦ç»“åˆå…·ä½“æ¨¡å‹å’Œè¾“å…¥ è¾“å…¥/è¾“å‡ºçš„ Token å­˜å‚¨ï¼šéœ€è¦æ˜¾å­˜å­˜å‚¨è¾“å…¥çš„ Token åµŒå…¥ï¼ˆembeddingï¼‰å’Œç”Ÿæˆçš„è¾“å‡º Tokenã€‚ ä¸­é—´æ¿€æ´»å€¼ï¼ˆIntermediate Activationsï¼‰ï¼šå‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­æ¯ä¸€å±‚çš„è¾“å‡ºï¼ˆå¦‚ Attention çš„ Key/Value ç¼“å­˜ã€FFN çš„ä¸­é—´ç»“æœç­‰ï¼‰ã€‚ Key-Value ç¼“å­˜ï¼ˆKV Cacheï¼‰ï¼šè‡ªå›å½’ç”Ÿæˆæ—¶ï¼Œä¸ºé¿å…é‡å¤è®¡ç®—å†å² Token çš„ Key/Valueï¼Œéœ€ç¼“å­˜è¿™äº›ä¸­é—´ç»“æœï¼ˆæ˜¾å­˜å ç”¨ä¸è¾“å…¥+è¾“å‡ºé•¿åº¦æˆæ­£æ¯”ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:16:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"zero3 è¿™æ˜¯inter-layer + broadcast + reduce-scatterçš„å®ç°æ–¹æ³•ï¼Œæ˜¯å¾ˆä¹…ä¹‹å‰å®˜æ–¹çš„å®ç°ï¼Œç°åœ¨å®˜æ–¹çš„çœŸæ­£åšæ³•æ˜¯ï¼šintra-layer + all-gather+ reduce-scatterï¼ˆä¸fsdpä¸€è‡´ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:16:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ä½ç½®ç¼–ç ï¼ˆRoPEï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:17:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"LoRAï¼ˆæ‰‹æ’•ï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:18:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"R1 ç›¸å…³ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"è®­ç»ƒæ•´ä½“æµç¨‹ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"aha monment åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç ”ç©¶å›¢é˜Ÿä½¿ç”¨æ•°å­¦é—®é¢˜æ¥è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹çš„é€»è¾‘æ¨ç†èƒ½åŠ›ã€‚åœ¨è§‚å¯Ÿæ¨¡å‹è¾“å‡ºæ—¶ï¼Œç ”ç©¶äººå‘˜æ­£æ˜¯åœ¨ä¸‹é¢è¿™ä¸ªæ•°å­¦æ–¹ç¨‹çš„è§£é¢˜è¿‡ç¨‹ä¸­æ•æ‰åˆ°äº†ä¸€ä¸ªå¼•äººæ³¨ç›®çš„â€é¡¿æ‚Ÿæ—¶åˆ»â€ï¼Œå……åˆ†å±•ç°äº†æ¨¡å‹é€šè¿‡å¼ºåŒ–å­¦ä¹ è‡ªç„¶è·å¾—çš„è‡ªä¸»åæ€èƒ½åŠ›ï¼š ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:2","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"k1 k2 k3 ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:3","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"R1-zero qwen2.5-0.5B æ¨¡å‹ï¼Œnum_generations ä¸º 2ï¼Œgsm8k æ•°æ®é›†å‡†ç¡®ç‡ 0.45489006823351025ã€‚num_generations ä¸º 4ï¼Œå‡†ç¡®ç‡ä¸º 0.47763457164518575 ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:4","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Rule-based reward å‡†ç¡®æ€§å¥–åŠ±ï¼ˆAccuracy Rewardsï¼‰ï¼šç­”æ¡ˆæ˜¯å¦æ­£ç¡® æ ¼å¼å¥–åŠ±ï¼ˆFormat Rewardsï¼‰ï¼šæ˜¯å¦æœ‰æ€è€ƒæ ‡ç­¾ è¯­è¨€æ··åˆé—®é¢˜ï¼šå¯¹è¯­è¨€ä¸€è‡´æ€§è¿›è¡Œæ‰“åˆ† ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:19:5","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"æ¢¯åº¦ç´¯è®¡ ä»£ç ï¼ˆhttps://zhuanlan.zhihu.com/p/423359955) æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹ gradient_accumulation_steps æ˜¯æ¢¯åº¦ç´¯ç§¯æ¬¡æ•°ï¼Œç´¯ç§¯å‡ æ¬¡ï¼ŒåŸæœ¬çš„ loss å°±è¦é™¤ä»¥å‡ ï¼Œè¿™æ˜¯ä¸ºäº†å¯¹å¤šä¸ªæ‰¹æ¬¡çš„æ•°æ®çš„æ¢¯åº¦åšç´¯ç§¯ã€‚ æœ‰äººè¯´ï¼Œåº”è¯¥æœ‰è¿™ä¸€è¡Œä»£ç æ‰ç®—ç´¯åŠ  æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹ è¿™æ ·ç†è§£æ˜¯é”™è¯¯çš„ã€‚ è¦æ˜ç™½æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ¢¯åº¦ç´¯åŠ ï¼Œç´¯åŠ çš„å¹¶ä¸æ˜¯æŸå¤±ï¼Œè€Œæ˜¯æ ¹æ®æŸå¤±å¾—åˆ°çš„æ¢¯åº¦ã€‚ æ¢¯åº¦ç´¯è®¡å¦‚ä½•èŠ‚çœæ˜¾å­˜ å‡å°‘ç¬æ—¶æ¿€æ´»å€¼æ˜¾å­˜ï¼šæ¯æ¬¡ä»…å¤„ç†å°æ‰¹é‡çš„æ•°æ®ï¼Œæ¿€æ´»å€¼æ˜¾å­˜å ç”¨é™ä½ä¸ºåŸæ¥çš„ 1/kï¼ˆä¾‹å¦‚ k=4 æ—¶ï¼Œæ˜¾å­˜å ç”¨é™è‡³ 25%ï¼‰ã€‚ å¤ç”¨æ˜¾å­˜ï¼šæ¯æ¬¡å°æ‰¹é‡è®¡ç®—å®Œæˆåï¼Œé‡Šæ”¾å½“å‰æ¿€æ´»å€¼æ˜¾å­˜ï¼Œä¾›ä¸‹ä¸€æ¬¡è®¡ç®—ä½¿ç”¨ï¼ˆæ˜¾å­˜å ç”¨å³°å€¼å§‹ç»ˆä¸ºå°æ‰¹é‡å¯¹åº”çš„é‡ï¼‰ã€‚ æ¢¯åº¦æ˜¾å­˜ä¸å˜ï¼šæ¨¡å‹å‚æ•°å’Œæ¢¯åº¦çš„æ˜¾å­˜å ç”¨ä¸æ‰¹é‡å¤§å°æ— å…³ï¼Œå› æ­¤ä¸å—å½±å“ï¼ˆä½†éœ€é¢å¤–å­˜å‚¨ç´¯ç§¯æ¢¯åº¦çš„å˜é‡ï¼Œè¿™éƒ¨åˆ†å¼€é”€æå°ï¼‰ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:20:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Adam å’Œ AdamW ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:21:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"RLHF ç›¸å…³ï¼ˆPPOã€RLOOã€REINFORCE++ã€ReMaxã€GRPOã€SACï¼‰ on-policy å’Œ off-policyï¼ˆå‚è€ƒ https://zhuanlan.zhihu.com/p/346433931ï¼‰ Off-policy: the learning is from the data off the target policyï¼ˆå¼•è‡ªã€ŠReinforcement Learning An Introductionã€‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ RL ç®—æ³•ä¸­ï¼Œæ•°æ®æ¥æºäºä¸€ä¸ªå•ç‹¬çš„ç”¨äºæ¢ç´¢çš„ç­–ç•¥ï¼ˆä¸æ˜¯æœ€ç»ˆè¦æ±‚çš„ç­–ç•¥ï¼‰ã€‚ï¼ˆOff-policy æ–¹æ³•ä¸­ä¸ä¸€å®šéè¦é‡‡ç”¨é‡è¦æ€§é‡‡æ ·ï¼Œè¦æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨ï¼ˆæ¯”å¦‚ï¼Œéœ€è¦ç²¾ç¡®ä¼°è®¡å€¼å‡½æ•°æ—¶éœ€è¦é‡‡ç”¨é‡è¦æ€§é‡‡æ ·ï¼›è‹¥æ˜¯ç”¨äºä½¿å€¼å‡½æ•°é è¿‘æœ€ä¼˜å€¼å‡½æ•°åˆ™ä¸ä¸€å®šï¼‰ï¼‰ On-policy: the target and the behavior polices are the same. ä¹Ÿå°±æ˜¯è¯´ on-policy é‡Œé¢åªæœ‰ä¸€ç§ç­–ç•¥ï¼Œå®ƒæ—¢ä¸ºç›®æ ‡ç­–ç•¥åˆä¸ºè¡Œä¸ºç­–ç•¥ã€‚ æ€»ç»“ï¼šPPO ç®—æ³•ï¼Œè™½ç„¶æœ‰ 2 ä¸ª policyï¼Œç”¨\\(\\pi_{old}\\)é‡‡æ ·å»æ›´æ–° piï¼Œä½†æ˜¯ç”±äº pi_old çš„å‚æ•°æ˜¯ä» pi å¤åˆ¶çš„ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯å±äºåŒä¸€ä¸ªç­–ç•¥ã€‚æ‰€ä»¥ PPO æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆåƒ off-policy çš„ on-policy ç®—æ³•ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"online å’Œ offline æ›´æ–°çš„æ•°æ®æ˜¯å¦æ˜¯æœ€æ–° agent çš„æ¨¡å‹ç”Ÿæˆçš„æ•°æ® Online: æ›´æ–°çš„æ•°æ®ä¸ºæœ€æ–°æ¨¡å‹é‡‡æ ·å¾—åˆ°çš„ï¼ˆé‡‡æ ·çš„æ•°æ®ä¸€æ¬¡æ€§ç”¨å®Œï¼‰ Offline: æ›´æ–°çš„æ•°æ®ä¸º x æ¬¡æ›´æ–°å‰æ¨¡å‹é‡‡æ ·å¾—åˆ°çš„ï¼ˆé‡‡æ ·çš„æ•°æ®æ›´æ–°å¤šæ¬¡ï¼‰ onlineã€offlineã€on-policyã€off-policy online å­¦ä¹ ä¸­å¯ä»¥æ˜¯ on/off policy çš„ã€‚è€Œ offline å­¦ä¹ ä¸­é™¤äº†ç¬¬ä¸€æ¬¡æ›´æ–°æ¨¡å‹çš„å­¦ä¹ å¯èƒ½æ˜¯ on policy çš„ï¼Œä¹‹åçš„æ‰€æœ‰å­¦ä¹ åªæœ‰ä»æ˜¯ offline çš„åˆ™ä¸€å®šæ˜¯ off policyã€‚ critic å’Œ reward åŒºåˆ«ï¼ˆå‚è€ƒ https://www.zhihu.com/question/1900547615495545054/answer/1901411039406457541ï¼‰ reward model è¯„ä¼°æ•´ä¸ª response è´¨é‡ï¼Œç»™å‡ºæ•´ä½“å¥–åŠ±ä¿¡å·ï¼Œæ— æ³•ç›´æ¥æ˜ å°„åˆ°æ¯ä¸ª token çš„è´¡çŒ®ã€‚ critic model ä¼°è®¡ä»·å€¼å‡½æ•°ï¼Œé¢„æµ‹æœªæ¥å¯èƒ½è·å¾—çš„ç´¯ç§¯å¥–åŠ±ï¼Œä¸ºç­–ç•¥æ›´æ–°æä¾›ç¨³å®šçš„ advantage ä¿¡å· reward æ‰®æ¼”çš„æ˜¯ç¯å¢ƒçš„è§’è‰²ï¼Œè€Œ critic å±äº llm è¿™ä¸ªæ™ºèƒ½ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå°±å¥½æ¯”åœ¨è€ƒè¯•ä¸­ï¼Œä½ è‡ªå·±æ£€æŸ¥å·å­å’Œè€å¸ˆç»™ä½ æ‰“åˆ†çš„åŒºåˆ«ã€‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"clip ç»†èŠ‚ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:2","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"PPO å’Œ GRPO çš„åŒºåˆ« ä¼˜åŠ¿å€¼åŒºåˆ« kl æ•£åº¦åŒºåˆ« PPO çš„ KL è®¡ç®—æ˜¯åœ¨æ¯ä¸ª token çš„ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿçš„ï¼Œä¸æ–­è®¡ç®—å½“å‰ token å’Œ ref_model çš„ KL æ•£åº¦ã€‚ GRPO çš„ KL è®¡ç®—æ˜¯åœ¨ä¸€ä¸ªå›ç­”ç”Ÿæˆç»“æŸåå‘ç”Ÿçš„ï¼Œä¸€æ¬¡æ€§å¯¹å¥å­ä¸­çš„æ¯ä¸ª token è®¡ç®— KL æ•£åº¦ï¼Œå¹¶å‚ä¸æœ€ç»ˆ loss çš„è®¡ç®—ï¼› PPO çš„ KL å¡åˆ° reward é‡Œï¼ˆreward shapingï¼‰ GRPO çš„ KL æ˜¯ç‹¬ç«‹çš„æŸå¤±é¡¹ã€‚ advantage è§’åº¦æ¥çœ‹ï¼ŒPPO çš„ KL æƒ©ç½šæ˜¯ token-level çš„ GRPO çš„ KL æƒ©ç½šæ˜¯ sentence-levelï¼ˆä½†æ˜¯ä¹Ÿæ˜¯é€ä¸ª token ç®— kl å†å– meanï¼‰çš„ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:3","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"REINFORECE++ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:4","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"RLOOï¼ˆREINFORCE leave-one-outï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:5","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"ReMAXï¼ˆREINFORCE argmaxï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:6","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"DPO aå˜å¤§ï¼Œbå˜å°ï¼Œç†æƒ³æƒ…å†µï¼Œchosen responseæ¦‚ç‡æå‡ï¼Œrejected responseæ¦‚ç‡ä¸‹é™ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:22:7","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"é’ˆå¯¹GRPOçš„æ”¹è¿› DAPOï¼ˆå‚è€ƒ https://www.zhihu.com/question/1895273986537014226/answer/1899582779408245950ï¼‰ DAPO æ˜¯å¯¹ GRPO çš„æ”¹è¿›ã€‚DAPOï¼ˆDecoupled Clip and Dynamic sAmpling Policy Optimizationï¼Œå³è§£è€¦è£å‰ªå’ŒåŠ¨æ€é‡‡æ ·ç­–ç•¥ä¼˜åŒ–ï¼‰çš„ä¼˜åŒ–ç‚¹æœ‰å››ä¸ªï¼ˆå…¶ä¸­å‰ 2 ä¸ªæ˜¯ä¸»è¦äº®ç‚¹ï¼Œæ˜¯å‘½åçš„æ¥æºï¼‰ï¼š æ›´é«˜è£å‰ª åŠ¨æ€é‡‡æ ·ï¼ˆDynamic Samplingï¼‰ Token çº§ç­–ç•¥æ¢¯åº¦æŸå¤±ï¼ˆToken-Level Policy Gradient Lossï¼‰ è¶…é•¿å¥–åŠ±å¡‘é€ ï¼ˆOverlong Reward Shapingï¼‰ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:23:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"DR.GRPO ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:23:1","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"GPG GPGå½»åº•ä½¿ç”¨policy-basedçš„æ–¹æ³•ï¼Œå»é™¤äº†å…¶ä»–çš„PPOå°trick ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:23:2","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"FP16 å’Œ BF16 çš„åŒºåˆ« ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:24:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"Tokenize ç›¸å…³ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:25:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","é¢ç»"],"content":"é¢ç» å¤§æ¨¡å‹å¾®è°ƒç»éªŒ ai å…«è‚¡ ","date":"2025-07-02","objectID":"/%E9%9D%A2%E7%BB%8F2025/:26:0","tags":["é¢ç»"],"title":"é¢ç»2025","uri":"/%E9%9D%A2%E7%BB%8F2025/"},{"categories":["","NLP","agent","world-model"],"content":"æˆ‘ç†è§£çš„agentä¸­çš„world modelå³å¯ä»¥é¢„æµ‹é‡‡å–æŸä¸ªactionä¹‹åstateçš„å˜åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥é™ä½è¯•é”™å¸¦æ¥çš„æ—¶é—´æˆæœ¬æˆ–è€…æ˜¯å…¶å®ƒæ½œåœ¨çš„æˆæœ¬ã€é£é™©ã€‚ ç›®å‰agentä¸­å¸¸ç”¨çš„æ¨¡å—ä¸ºreflexionï¼Œå³åæ€æ¨¡å—ã€‚ä½œç”¨æ˜¯è¯„ä»·è¡ŒåŠ¨è½¨è¿¹çš„ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¦‚æœè¯„ä¼°ä¸ºå¤±è´¥ï¼Œåˆ™æ¥å—å¤±è´¥çš„è½¨è¿¹å’Œè¯„ä¼°ç»“æœï¼Œç”Ÿæˆä¸€æ®µå¤±è´¥æ€»ç»“æ–‡æœ¬ã€‚ è¿™å½“ç„¶æ˜¯å¯è¡Œçš„ï¼Œä½†é—®é¢˜æ˜¯è¿™éœ€è¦ä¸æ–­è¯•é”™æ‰æœ‰å¯èƒ½çº é”™ä»è€Œæ‰§è¡Œæ­£ç¡®çš„actionï¼Œè¿™å°±ä¼šé€ æˆæ—¶é—´æˆæœ¬ï¼Œç”šè‡³å¦‚æœagentè´Ÿè´£çš„æ˜¯ä¸€ä¸ªè´­ç‰©ä»»åŠ¡ï¼Œé”™è¯¯çš„actionç”šè‡³æœ‰å¯èƒ½æ˜¯ä¸‹å•é”™è¯¯çš„å•†å“ã€‚ æ‰€ä»¥æˆ‘è®¤ä¸ºworld modelçš„ä½œç”¨å°±æ˜¯é¢„æµ‹actionä¹‹åstateä¼šå¦‚ä½•å˜åŒ–ï¼Œè¿™ç›¸å½“äºèµ°ä¸€æ­¥ï¼Œçœ‹ä¸€æ­¥ï¼Œæ¥é¿å…å‡ºé”™ã€‚ reflexionæ˜¯å¿…è¦çš„ï¼Œè¿™æ˜¯å¯¹æ•´ä¸ªè½¨è¿¹çš„è¯„ä¼°ï¼Œå¦‚æœè¯„ä¼°ç»“æœä¸ºå¤±è´¥çš„è¯ï¼Œè¿˜æ˜¯è¦è¿›è¡Œåæ€ï¼Œä¸world modelç»“åˆçš„ä½œç”¨æ˜¯é™ä½è¯„ä¼°å¤±è´¥çš„æ¦‚ç‡ï¼Œä½¿è¯•é”™çš„æ¬¡æ•°é™ä½ã€‚æˆ‘è®¤ä¸ºè¿™åœ¨å®é™…åº”ç”¨å½“ä¸­æ˜¯æœ‰å¿…è¦çš„ï¼Œè¯•é”™çš„æ—¶é—´æˆæœ¬è¦è¿œè¿œå¤§äºæ¯ä¸€æ­¥è°ƒç”¨world modelæ‰€å¸¦æ¥çš„å¼€é”€ã€‚ ","date":"2025-06-30","objectID":"/world_model/:0:0","tags":["NLP","agent","world-model"],"title":"world_model","uri":"/world_model/"},{"categories":["","coding","verl"],"content":"å‰ç½®çŸ¥è¯†ï¼Œrayå‰ç½®çŸ¥è¯† æˆ‘å°†ç”¨æ­¤æ–‡æ¥è¯¦ç»†ä»‹ç»veRLä¸­æœ‰å…³single_controllerå’ŒSPMDçš„ç›¸å…³å†…å®¹ã€‚æœ¬æ–‡ä¸æ¶‰åŠppoè®­ç»ƒç›¸å…³ï¼Œåªæ˜¯è®°å½•ä¸€ä¸‹ç†è§£veRLæ¶æ„å®ç°çš„æ ¸å¿ƒã€‚ å®ç°single_controlleræ–¹æ³•çš„æ ¸å¿ƒæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š Worker RayResourcePool RayWorkerGroup RayClassWithInitArgs å®ç°SPMDçš„æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š register dispatch_fnå’Œcollect_fn execute_fn func_generator æ¨èé˜…è¯»ï¼šverl è§£è¯» - æºç é˜…è¯»(part3) ","date":"2025-06-26","objectID":"/init_workers%E8%AF%A6%E8%A7%A3/:0:0","tags":["coding","verl"],"title":"init_workersè¯¦è§£","uri":"/init_workers%E8%AF%A6%E8%A7%A3/"},{"categories":["","coding","verl"],"content":"åŸç”ŸRay ä»£ç æ”¹ç¼–è‡ª# verl è§£è¯» - ray ç›¸å…³å‰ç½®çŸ¥è¯† (part1) rayåˆ†é…èµ„æºçš„å•ä½æ˜¯bundleï¼Œä¸€ä¸ªbundleä¸€èˆ¬ç”±1ä¸ªcpuå’Œ1ä¸ªgpuæ„æˆã€‚ è€Œä¸€ä¸ªplacement_groupç”±å¤šä¸ªbundleç»„æˆï¼Œå½“å‚æ•°è®¾ç½®ä¸ºpacké€šå¸¸ä¸ºåŒ1ä¸ªnodeä¸Šçš„bundleæ„æˆçš„ã€‚å‚æ•°è®¾ç½®ä¸ºspreadä¸ºä¸åŒnodeçš„bundleç»„æˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨pythonä¸­ï¼Œå®šä¹‰placement_groupå¦‚ä¸‹ï¼š pg = placement_group([ {\"CPU\": 1, \"GPU\": 1} for _ in range(total_devices) ], strategy=\"STRICT_PACK\", name=\"ray_multi_group_comm\") ray.get(pg.ready()) print(f\"=\u003e Placement group is ready, total_devices: {total_devices}\") rayä¸­çš„åŸºæœ¬å•ä½æœ‰taskå’Œactorï¼Œä¸€ä¸ªæ— çŠ¶æ€ï¼Œä¸€ä¸ªæœ‰çŠ¶æ€ï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯é¢å‘å¯¹è±¡çš„ç±»ï¼‰ã€‚éƒ½éœ€è¦ç”¨workeræ¥ä»£æ›¿è¿è¡Œã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªworkeræ¥å®Œæˆå„ç§ä»»åŠ¡ã€‚è¿™ä¸ªworkeréƒ½æ˜¯ä¸Šè¿°èµ„æºçš„åˆ†é…å•ä½ï¼Œå®ƒåªä¼šçœ‹åˆ°rayåˆ†é…ç»™å®ƒçš„èµ„æºï¼Œè€Œçœ‹ä¸åˆ°å…¶å®ƒçš„èµ„æºï¼Œå¯¹äºåˆ†å¸ƒå¼è®­ç»ƒè€Œè¨€ï¼Œå¯ä»¥åœ¨è¿™ä¸ªworkerä¸­å®šä¹‰åˆ†å¸ƒå¼è®­ç»ƒçš„å„ç§ä¸œè¥¿ã€åŠ è½½æ¨¡å‹ã€å‰å‘è®­ç»ƒç­‰ã€‚ä¸€ä¸ªworkerå®šä¹‰å¦‚ä¸‹ï¼š class WorkerBase: \"\"\" é€šç”¨çš„ Worker åŸºç±»ã€‚ æ¯ä¸ª Worker å®ä¾‹æ˜¯ä¸€ä¸ª Ray Actorï¼Œå®ƒä¼šåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¹¶æŒæœ‰ä¸€ä¸ªæ¨¡å‹å‰¯æœ¬ã€‚ \"\"\" def __init__(self, model_cls, temp_init: bool = False): # è·å–å½“å‰ Ray Actor æ‰€åœ¨çš„èŠ‚ç‚¹ ID å’Œ Actor ID self._node_id = ray.get_runtime_context().get_node_id() self._actor_id = ray.get_runtime_context().get_actor_id() # è·å–å½“å‰ä¸»æœºçš„ IP åœ°å€ self._ip_address = socket.gethostbyname(socket.gethostname()) if temp_init: # å¦‚æœæ˜¯ä¸´æ—¶åˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œæ¨¡å‹å’Œåˆ†å¸ƒå¼ç¯å¢ƒçš„è®¾ç½® return # è®¾ç½®éšæœºç§å­ self._set_seed(42) # åˆå§‹åŒ– PyTorch åˆ†å¸ƒå¼ç¯å¢ƒ if not dist.is_initialized(): # æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ– dist.init_process_group( backend=\"nccl\", # ä½¿ç”¨ NCCL ä½œä¸ºåç«¯ï¼Œé€‚ç”¨äº NVIDIA GPU world_size=int(os.getenv(\"WORLD_SIZE\", \"1\")), # ä»ç¯å¢ƒå˜é‡è·å– world_size rank=int(os.getenv(\"RANK\", \"0\")), # ä»ç¯å¢ƒå˜é‡è·å–å½“å‰è¿›ç¨‹çš„ rank # ä»ç¯å¢ƒå˜é‡è·å–ä¸»èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œç”¨äºå»ºç«‹è¿æ¥ init_method=f\"tcp://{os.getenv('MASTER_ADDR')}:{os.getenv('MASTER_PORT')}\" ) self._rank = dist.get_rank() # è·å–å½“å‰è¿›ç¨‹çš„æ’å self._world_size = dist.get_world_size() # è·å–åˆ†å¸ƒå¼ç»„çš„å¤§å° self.model = model_cls() # å®ä¾‹åŒ–ä¼ å…¥çš„æ¨¡å‹ç±» self.model.to(\"cuda\") # å°†æ¨¡å‹ç§»åŠ¨åˆ° GPU # æ‰“å°åˆå§‹åŒ–ä¿¡æ¯ print(f\"=\u003e Rank {self._rank}/{self._world_size} in group '{os.getenv('GROUP_NAME')}' initialized model: {self.model.__class__.__name__}\") def get_actor_info(self): \"\"\"è¿”å›è¯¥ actor çš„ç½‘ç»œä¿¡æ¯ã€‚\"\"\" return { \"ip_address\": self._ip_address } def _set_seed(self, seed: int = 42): \"\"\"è®¾ç½®éšæœºç§å­ã€‚\"\"\" set_random_seed(seed) def train_step(self, data): \"\"\"æ‰§è¡Œä¸€ä¸ªè®­ç»ƒæ­¥éª¤ã€‚\"\"\" x = data.to(\"cuda\") # å°†è¾“å…¥æ•°æ®ç§»åŠ¨åˆ° GPU y = self.model(x) # æ¨¡å‹å‰å‘ä¼ æ’­ loss = y.sum() # è®¡ç®—ä¸€ä¸ªç®€å•çš„æŸå¤±ï¼ˆæ‰€æœ‰è¾“å‡ºçš„å’Œï¼‰ loss.backward() # åå‘ä¼ æ’­ï¼Œè®¡ç®—æ¢¯åº¦ return loss.cpu() # è¿”å›åœ¨ CPU ä¸Šçš„ loss å€¼ def sample_grads(self): \"\"\"é‡‡æ ·ä¸€ä¸ªå‚æ•°çš„æ¢¯åº¦ç”¨äºéªŒè¯ã€‚\"\"\" for name, p in self.model.named_parameters(): # éå†æ‰€æœ‰å¸¦åå­—çš„å‚æ•° if p.requires_grad is True: # æ‰¾åˆ°ç¬¬ä¸€ä¸ªéœ€è¦æ¢¯åº¦çš„å‚æ•° return name, p.grad.cpu() # è¿”å›å‚æ•°åå’Œå®ƒåœ¨ CPU ä¸Šçš„æ¢¯åº¦ å…¶ä¸­model_clså°±æ˜¯å®šä¹‰çš„å„ç§æ¨¡å‹ã€‚ ç„¶åå°±å¯ä»¥ç»™å„ç§workerç»‘å®šèµ„æºã€‚è¿™é‡Œæˆ‘å®šä¹‰äº†ä¸¤ç§æ¨¡å‹ï¼Œnodeä¸Šæœ‰4å¼ gpuï¼Œæˆ‘å®ç°çš„æ˜¯ä¸¤ç§æ¨¡å‹åˆ†åˆ«å 2å¼ ä¸åŒçš„å¡ï¼š def setup_and_create_workers(pg, model_cls, group_name, start_bundle_index, num_workers_in_group): \"\"\" ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºè®¾ç½®ä¸€ä¸ªåˆ†å¸ƒå¼ç»„å¹¶ä¸ºå…¶åˆ›å»º workersã€‚ \"\"\" print(f\"\\\\n========== æ­£åœ¨è®¾ç½®ç»„: {group_name} ==========\") # å°† WorkerBase ç±»åŒ…è£…æˆ Ray Remote Actor Worker = ray.remote(WorkerBase) # åˆ›å»ºä¸€ä¸ªä¸´æ—¶ worker æ¥è·å–è¯¥ç»„çš„ç½‘ç»œä¿¡æ¯ # è¿™ä¸ª worker ä¼šè¢«æ”¾ç½®åœ¨æŒ‡å®šçš„ placement group bundle ä¸Š temp_worker = Worker.options( scheduling_strategy=PlacementGroupSchedulingStrategy( placement_group=pg, placement_group_bundle_index=start_bundle_index, ), num_gpus=1, ).remote(model_cls=model_cls, temp_init=True) # ä½¿ç”¨ temp_init=Trueï¼Œé¿å…å®Œå…¨åˆå§‹åŒ– # è·å–ä¸´æ—¶ worker çš„ç½‘ç»œä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ IP åœ°å€ï¼Œç”¨ä½œè¯¥ç»„çš„ master åœ°å€ network_info = ray.get(temp_worker.get_actor_info.remote()) master_addr = network_info[\"ip_address\"] master_port = str(find_free_port()) # ä¸ºè¯¥ç»„æ‰¾åˆ°ä¸€ä¸ªç©ºé—²ç«¯å£ ray.kill(temp_worker) # é”€æ¯ä¸´æ—¶ worker print(f\"ä¸ºç»„ {group_name} ä½¿ç”¨çš„ä¸»èŠ‚ç‚¹åœ°å€: {master_addr}:{master_port}\") workers = [] # å­˜å‚¨åˆ›å»ºçš„ worker # å¾ªç¯åˆ›å»ºæŒ‡å®šæ•°é‡çš„ worker for i in range(num_workers_in_group): rank = i # å½“å‰ worker åœ¨å…¶ç»„å†…çš„ rank bundle_index = start_bundle_index + i # è¯¥ worker åœ¨ placement group ä¸­çš„ bundle ç´¢å¼• # è®¾ç½®åˆ†å¸ƒå¼ç¯å¢ƒæ‰€éœ€çš„ç¯å¢ƒå˜é‡ env_vars = { \"WORLD_SIZE\": str(num_workers_in_group), \"RANK\": str(rank), \"MASTER_ADDR\": master_addr, \"MASTER_PORT\": master_port, \"GROUP_NAME\": group_name } # åˆ›å»ºä¸€ä¸ªæ­£å¼çš„ worker actor workers.append( Worker.options( name=f\"{group_name}_rank_{rank}\", # ä¸º actor å‘½åï¼Œæ–¹ä¾¿è°ƒè¯• scheduling_strategy=PlacementGroupSchedulingStrategy( placement_group=pg, placement_group_bundle_index=bundle_index, ), runtime_env={\"env_vars\": env_vars}, # å°†ç¯å¢ƒå˜é‡ä¼ é€’ç»™ actor num_gpus=1, # ä¸ºæ¯ä¸ª actor åˆ†é…ä¸€ä¸ª GPU ).remote(model_cls=model_cls)","date":"2025-06-26","objectID":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:1:0","tags":["coding","verl"],"title":"rayå‰ç½®çŸ¥è¯†","uri":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["","coding","verl"],"content":"veRLä¸­çš„Ray ä½¿ç”¨# ã€AI Infraã€‘ã€RLHFæ¡†æ¶ã€‘äºŒã€VeRLä¸­colocateå®ç°æºç è§£æä¸­çš„ä»£ç ï¼š import ray from verl.single_controller.base import Worker from verl.single_controller.base.decorator import register, Dispatch from verl.single_controller.ray.base import RayResourcePool, RayClassWithInitArgs, RayWorkerGroup, create_colocated_worker_cls from verl import DataProto @ray.remote class Actor(Worker): def __init__(self) -\u003e None: super().__init__() @register(dispatch_mode=Dispatch.DP_COMPUTE_PROTO) def add(self, data: DataProto): data.batch['a'] = data.batch['a'].to(\"cuda\") data.batch['a'] += self.rank return data @ray.remote class Critic(Worker): def __init__(self, config) -\u003e None: super().__init__() self.config = config @register(dispatch_mode=Dispatch.DP_COMPUTE_PROTO) def sub(self, data: DataProto): data.batch['a'] = data.batch['a'].to(\"cuda\") data.batch['a'] -= self.config['b'] return data def test_colocated_workers(): ray.init() import torch # æ„å»ºä¸€ä¸ªDataProtoï¼Œå…¶ä¸­å±æ€§aæ˜¯ç»´åº¦ä¸º10çš„é›¶å‘é‡ã€‚ data = DataProto.from_dict({'a': torch.zeros(10)}) print(data.batch[\"a\"]) # åˆ©ç”¨RayClassWithInitArgså°†è‡ªå®šä¹‰çš„workerå’Œå‚æ•°å°è£…èµ·æ¥ actor_cls = RayClassWithInitArgs(cls=Actor) critic_cls = RayClassWithInitArgs(cls=Critic, config={'b': 10}) # å®šä¹‰èµ„æºæ± ï¼Œä»…åŒ…å«ä¸€ä¸ª2GPUçš„èŠ‚ç‚¹ resource_pool = RayResourcePool(process_on_nodes=[2]) # åˆ©ç”¨create_colocated_worker_clså°†è‡ªå®šä¹‰çš„ä¸¤ä¸ªworkerç»‘å®šåˆ°WorkerDictä¸Š cls_dict = {'actor': actor_cls, 'critic': critic_cls} ray_cls_with_init = create_colocated_worker_cls(cls_dict) # å¯åŠ¨WorkerDict wg_dict = RayWorkerGroup(resource_pool=resource_pool, ray_cls_with_init=ray_cls_with_init) # åˆ†åˆ«è·å–actorå’Œcriticçš„workergroup spawn_wg = wg_dict.spawn(prefix_set=cls_dict.keys()) colocated_actor_wg = spawn_wg['actor'] colocated_critic_wg = spawn_wg['critic'] # actoræ‰§è¡Œaddã€criticæ‰§è¡Œsub actor_output = colocated_actor_wg.add(data) critic_output = colocated_critic_wg.sub(data) # actor_output.batch[\"a\"]==[0, 0, 0, 0, 0, 1, 1, 1, 1, 1] # critic_output.batch[\"a\"]==[-10, -10, -10, -10, -10, -10, -10, -10, -10, -10] print(actor_output.batch[\"a\"]) print(critic_output.batch[\"a\"]) ray.shutdown() if __name__ == '__main__': test_colocated_workers() å…·ä½“çš„æ“ä½œæˆ‘ä¼šåœ¨init_workersç« èŠ‚è¿›è¡Œè®²è§£ï¼Œè¿™é‡Œæ˜¯å¯¹veRLä¸­çš„single_controllerçš„ä¸€ä¸ªåˆæ¢ã€‚ ","date":"2025-06-26","objectID":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:2:0","tags":["coding","verl"],"title":"rayå‰ç½®çŸ¥è¯†","uri":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["","coding","verl"],"content":"é—®é¢˜ æœ‰ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆåœ¨placement_groupä¸­åˆ†é…äº†ä¸€ä¸ªbundleä¸º1ä¸ªgpuï¼Œä¸ºä»€ä¹ˆè¿˜è¦æŒ‡å®šnum_gpus=1ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä»€ä¹ˆå«ä¹‰å—? ç®€å•æ¥è¯´ï¼Œä¸¤è€…éƒ½éœ€è¦ï¼Œå› ä¸ºå®ƒä»¬åœ¨ Ray çš„è°ƒåº¦ç³»ç»Ÿä¸­æ‰®æ¼”ç€ä¸åŒä½†äº’è¡¥çš„è§’è‰²ï¼š placement_group ä¸­çš„ {\"GPU\": 1}ï¼šè¿™æ˜¯åœ¨åšèµ„æºâ€œé¢„ç•™â€ (Reservation)ã€‚ å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ Ray é›†ç¾¤ï¼šâ€œæˆ‘éœ€è¦ä½ ä¸ºæˆ‘å‡†å¤‡å¥½ä¸€ä¸ªèµ„æºåŒ…ï¼ˆbundleï¼‰ï¼Œè¿™ä¸ªåŒ…é‡Œå¿…é¡»åŒ…å« 1 ä¸ª CPU å’Œ 1 ä¸ª GPUã€‚â€ placement_group çš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿ä¸€ç»„ç›¸å…³çš„èµ„æºèƒ½å¤Ÿè¢«åŸå­æ€§åœ°ã€ååŒåœ°è°ƒåº¦ã€‚æ¯”å¦‚ï¼Œstrategy=\"STRICT_PACK\" ç¡®ä¿äº†æ‰€æœ‰è¿™äº› bundles éƒ½ä¼šè¢«æ”¾ç½®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™å¯¹äºéœ€è¦ä½å»¶è¿Ÿé€šä¿¡çš„åˆ†å¸ƒå¼è®­ç»ƒè‡³å…³é‡è¦ã€‚ è¿™å°±åƒæ˜¯ä¸ºä¸€åœºå®´ä¼šé¢„è®¢äº†ä¸€ä¸ªèƒ½å®¹çº³4ä½å®¢äººçš„åŒ…é—´ï¼Œå¹¶ç¡®ä¿è¿™4ä¸ªåº§ä½éƒ½åœ¨åŒä¸€å¼ æ¡Œå­ä¸Šã€‚å®ƒåªæ˜¯åœˆå äº†èµ„æºï¼Œä½†è¿˜æ²¡æœ‰æŒ‡å®šè°æ¥ä½¿ç”¨è¿™äº›èµ„æºã€‚ Worker.options(num_gpus=1)ï¼šè¿™æ˜¯åœ¨ä¸º Actor æå‡ºå…·ä½“çš„â€œèµ„æºè¯·æ±‚â€ (Request)ã€‚ å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ Rayï¼šâ€œæˆ‘å³å°†åˆ›å»ºçš„è¿™ä¸ª Worker Actorï¼Œå®ƒæœ¬èº«åœ¨è¿è¡Œæ—¶éœ€è¦æ¶ˆè€— 1 ä¸ª GPUã€‚â€ Ray çš„è°ƒåº¦å™¨éœ€è¦æ ¹æ®è¿™ä¸ªæ˜ç¡®çš„è¯·æ±‚æ¥ä¸º Actor åˆ†é…å…·ä½“çš„ç‰©ç†è®¾å¤‡ã€‚æ²¡æœ‰è¿™ä¸ªå£°æ˜ï¼ŒRay è°ƒåº¦å™¨ä¼šè®¤ä¸ºè¯¥ Actor ä¸éœ€è¦ GPUã€‚ è¿™å°±åƒæ˜¯å‘Šè¯‰å®´ä¼šçš„ä¸»ç®¡ï¼šâ€œè¿™ä½å®¢äººéœ€è¦ä¸€ä¸ªåº§ä½ã€‚â€ ä¸ºä»€ä¹ˆç¼ºä¸€ä¸å¯ï¼Ÿ PlacementGroupSchedulingStrategy å°†è¿™ä¸¤è€…è”ç³»èµ·æ¥ã€‚å®ƒå‘Šè¯‰ Rayï¼šâ€œè¯·å°†è¿™ä¸ªéœ€è¦1ä¸ªGPUçš„Actor (num_gpus=1)ï¼Œå®‰æ’åˆ°æˆ‘ä»¬ä¹‹å‰é¢„ç•™çš„é‚£ä¸ªåŒ…å«GPUçš„bundle ({\"GPU\": 1}) ä¸Šå»ã€‚â€ å¦‚æœåªæœ‰ placement_group çš„é¢„ç•™è€Œæ²¡æœ‰ Actor çš„ num_gpus=1 è¯·æ±‚ï¼ŒRay çš„è°ƒåº¦å™¨ä¼šçœ‹åˆ°ä¸€ä¸ªçŸ›ç›¾ï¼šä½ è¯•å›¾å°†ä¸€ä¸ªå£°ç§°ä¸éœ€è¦ GPU çš„ Actor å®‰æ’åœ¨ä¸€ä¸ªä¸º GPU ä½¿ç”¨è€…ä¿ç•™çš„â€œå¸­ä½â€ä¸Šã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´è°ƒåº¦å¤±è´¥æˆ–èµ„æºåˆ†é…æ··ä¹±ã€‚ åä¹‹ï¼Œå¦‚æœåªæœ‰ Actor çš„ num_gpus=1 è¯·æ±‚è€Œæ²¡æœ‰ placement_groupï¼ŒRay ä¼šåœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¯»æ‰¾ä»»ä½•ä¸€ä¸ªå¯ç”¨çš„ GPU æ¥æ»¡è¶³è¿™ä¸ª Actorï¼Œä½†æ— æ³•ä¿è¯å®ƒä¼šå’Œå…¶ä»–ç›¸å…³çš„ Actor è¿è¡Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä»è€Œå¤±å»äº†åˆ†å¸ƒå¼è®­ç»ƒçš„æ€§èƒ½ä¼˜åŠ¿ã€‚ æ€»ç»“ï¼š placement_group æ˜¯ä¸€ä¸ªå®è§‚çš„ã€ç”¨äºèµ„æºé¢„ç•™å’ŒååŒå®šä½çš„æœºåˆ¶ï¼Œè€Œ num_gpus=1 æ˜¯ä¸€ä¸ªå¾®è§‚çš„ã€ç”¨äºå£°æ˜å•ä¸ª Actor å®é™…èµ„æºæ¶ˆè€—çš„æœºåˆ¶ã€‚ä¸¤è€…å¿…é¡»åŒæ—¶ä½¿ç”¨å¹¶ä¿æŒä¸€è‡´ï¼Œæ‰èƒ½ç¡®ä¿ Ray èƒ½å¤Ÿç²¾ç¡®ã€é«˜æ•ˆåœ°å°†éœ€è¦ç‰¹å®šèµ„æºçš„ Actor è°ƒåº¦åˆ°ä½ ä¸ºå®ƒä»¬é¢„ç•™çš„ã€å…·æœ‰ç‰¹å®šæ‹“æ‰‘ç»“æ„çš„èµ„æºåŒ…ä¸­ã€‚è¿™ç§æ˜¾å¼çš„è®¾è®¡è®©å¤æ‚çš„åˆ†å¸ƒå¼èµ„æºç®¡ç†å˜å¾—æ›´åŠ æ¸…æ™°å’Œå¯æ§ã€‚ ","date":"2025-06-26","objectID":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:3:0","tags":["coding","verl"],"title":"rayå‰ç½®çŸ¥è¯†","uri":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["","coding","verl"],"content":"å‚è€ƒ ","date":"2025-06-26","objectID":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:4:0","tags":["coding","verl"],"title":"rayå‰ç½®çŸ¥è¯†","uri":"/ray%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["","NLP","agent"],"content":"æ ¹æ®Anthropicçš„å®šä¹‰ï¼Œagentå®šä¹‰å¦‚ä¸‹ï¼š At Anthropic, we categorize all these variations asÂ agentic systems, but draw an important architectural distinction betweenÂ workflowsÂ andÂ agents: WorkflowsÂ are systems where LLMs and tools are orchestrated through predefined code paths. Agents, on the other hand, are systems where LLMs dynamically direct their own processes and tool usage, maintaining control over how they accomplish tasks. ç®€å•æ¥è¯´å°±æ˜¯Workflowsæ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ä¸€ä¸ªè·¯å¾„ï¼Œè€ŒAgentsæ˜¯è®©å…¶è‡ªä¸»å®Œæˆå„ç§æµç¨‹ï¼Œè€Œæ— éœ€é¢„å…ˆå®šä¹‰ã€‚ ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:0:0","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"workflows ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:0","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"Prompt chaining image.png ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:1","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"Routing image.png ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:2","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"Parallelization image.png ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:3","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"Orchestrator-workers image.png ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:4","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"Evaluator-optimizer image.png æœ€è¿‘çƒ­é—¨çš„Gemini 2.5 Pro Capable of Winning Gold at IMO 2025è®ºæ–‡å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªå·¥ä½œæµã€‚ ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:1:5","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"agents image.png ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:2:0","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","NLP","agent"],"content":"å‚è€ƒ Agents Zero to One: Learning Agentic Patterns Building Effective AI Agents \\ Anthropic How we built our multi-agent research system \\ Anthropic ","date":"2025-06-14","objectID":"/agent%E6%A6%82%E8%A7%88/:3:0","tags":["NLP","agent"],"title":"agentæ¦‚è§ˆ","uri":"/agent%E6%A6%82%E8%A7%88/"},{"categories":["","coding","verl"],"content":"Hybrid Engine åœ¨ RLHF æµç¨‹ä¸­ï¼Œactor modelÂ çš„ generation å’Œ rollout å æ®äº†ç»å¤§å¤šæ•°è¿è¡Œæ—¶é—´ï¼ˆåœ¨ veRL æ˜¯ 58.9%ï¼‰ã€‚å¹¶ä¸”ï¼Œç”±äº PPO æ˜¯ online ç®—æ³•ï¼Œç»éªŒï¼ˆexperiencesï¼‰å¿…é¡»æ¥è‡ªäºè¢« train çš„æ¨¡å‹æœ¬èº«ï¼Œå› æ­¤ï¼Œrollout å’Œ training æ˜¯å¿…é¡»ä¸²è¡Œçš„ã€‚å¦‚æœè¿™ä¸¤è€…ä½¿ç”¨ä¸åŒçš„èµ„æºç»„ï¼Œæ¯”å¦‚ rollout ç”¨ 2 å¼ å¡ï¼Œè€Œ training ç”¨ 4 å¼ å¡ï¼Œrollout çš„æ—¶å€™ training çš„èµ„æºé—²ç½®ï¼Œtraining çš„æ—¶å€™ rollout çš„èµ„æºé—²ç½®ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šæµªè´¹å¤§é‡çš„è®¡ç®—èµ„æºã€‚ç”±æ­¤ï¼ŒveRL å°† training å’Œ rollout engine æ”¾ç½®åœ¨åŒä¸€ä¸ªèµ„æºç»„ä¸­ä¸²è¡Œæ‰§è¡Œã€‚training æ—¶ï¼Œå°† rollout engine çš„æ˜¾å­˜å›æ”¶ï¼ˆoffload åˆ° CPU ä¸Š æˆ–è€…ç›´æ¥ææ„æ‰ï¼‰ï¼Œrollout æ—¶ï¼Œå†å°† training engine çš„æ˜¾å­˜é‡Šæ”¾æ‰ã€‚è¿™ç§å°† actor model çš„ä¸åŒ engine æ”¾ç½®åœ¨åŒä¸€ä¸ªèµ„æºç»„ä¸Šçš„æ–¹æ¡ˆï¼Œå°±ç§°ä¸º hybrid engineã€‚ image.png ","date":"2025-06-05","objectID":"/verl%E6%80%BB%E4%BD%93%E6%A6%82%E8%A7%88/:1:0","tags":["coding","verl"],"title":"verlæ€»ä½“æ¦‚è§ˆ","uri":"/verl%E6%80%BB%E4%BD%93%E6%A6%82%E8%A7%88/"},{"categories":["","coding","verl"],"content":"æœ€åŸç”Ÿçš„reward_mananger: class NaiveRewardManager: \"\"\"The reward manager.\"\"\" def __init__(self, tokenizer, num_examine, compute_score=None, reward_fn_key=\"data_source\") -\u003e None: self.tokenizer = tokenizer self.num_examine = num_examine # the number of batches of decoded responses to print to the console self.compute_score = compute_score or default_compute_score self.reward_fn_key = reward_fn_key def __call__(self, data: DataProto, return_dict=False): \"\"\"We will expand this function gradually based on the available datasets\"\"\" # If there is rm score, we directly return rm score. Otherwise, we compute via rm_score_fn if \"rm_scores\" in data.batch.keys(): if return_dict: return {\"reward_tensor\": data.batch[\"rm_scores\"]} else: return data.batch[\"rm_scores\"] reward_tensor = torch.zeros_like(data.batch[\"responses\"], dtype=torch.float32) reward_extra_info = defaultdict(list) already_print_data_sources = {} for i in range(len(data)): data_item = data[i] # DataProtoItem prompt_ids = data_item.batch[\"prompts\"] prompt_length = prompt_ids.shape[-1] valid_prompt_length = data_item.batch[\"attention_mask\"][:prompt_length].sum() valid_prompt_ids = prompt_ids[-valid_prompt_length:] response_ids = data_item.batch[\"responses\"] valid_response_length = data_item.batch[\"attention_mask\"][prompt_length:].sum() valid_response_ids = response_ids[:valid_response_length] # decode prompt_str = self.tokenizer.decode(valid_prompt_ids, skip_special_tokens=True) response_str = self.tokenizer.decode(valid_response_ids, skip_special_tokens=True) ground_truth = data_item.non_tensor_batch[\"reward_model\"][\"ground_truth\"] data_source = data_item.non_tensor_batch[self.reward_fn_key] extra_info = data_item.non_tensor_batch.get(\"extra_info\", None) score = self.compute_score( data_source=data_source, solution_str=response_str, ground_truth=ground_truth, extra_info=extra_info, ) if isinstance(score, dict): reward = score[\"score\"] # Store the information including original reward for key, value in score.items(): reward_extra_info[key].append(value) else: reward = score reward_tensor[i, valid_response_length - 1] = reward if data_source not in already_print_data_sources: already_print_data_sources[data_source] = 0 if already_print_data_sources[data_source] \u003c self.num_examine: already_print_data_sources[data_source] += 1 print(\"[prompt]\", prompt_str) print(\"[response]\", response_str) print(\"[ground_truth]\", ground_truth) if isinstance(score, dict): for key, value in score.items(): print(f\"[{key}]\", value) else: print(\"[score]\", score) if return_dict: return { \"reward_tensor\": reward_tensor, \"reward_extra_info\": reward_extra_info, } else: return reward_tensor é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡compute_scoreå‡½æ•°æ¥è®¡ç®—scoreã€‚ ","date":"2025-06-02","objectID":"/reward_mananger/:0:0","tags":["coding","verl"],"title":"reward_mananger","uri":"/reward_mananger/"},{"categories":["LLM","NLP","reasoning"],"content":"æ ¸å¿ƒæ€»ç»“ PRMå’ŒMCTSå®é™…ä¸Šæ˜¯ä¸¤ç§å¯ä»¥ç‹¬ç«‹ä½¿ç”¨çš„æŠ€æœ¯ï¼Œåªä¸è¿‡ï¼Œå¾€å¾€å®ƒä»¬ç»„åˆä½¿ç”¨æ—¶å¾€å¾€èƒ½äº§ç”Ÿ1+1\u003e2çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œ å•ç‹¬ä½¿ç”¨PRMï¼šæˆ‘ä»¬å¯ä»¥è®©æ¨¡å‹å¯¹åŒä¸€ä¸ªprompté‡‡æ ·å¤šä¸ªä¸åŒsolutionï¼Œæ— éœ€MCTSï¼Œåªéœ€åˆ©ç”¨æ¨¡å‹çš„temperatureç­‰éšæœºå‚æ•°è®©æ¯æ¬¡ç”Ÿæˆç»“æœä¸åŒï¼Œç„¶åç”¨PRMå¯¹æ¯ä¸ªsolutionçš„æ¯ä¸€æ­¥æ‰“åˆ†ï¼Œæœ€ç»ˆé€‰æ‹©åˆ†æ•°æœ€é«˜çš„è·¯å¾„è¿”å›ã€‚ å•ç‹¬ä½¿ç”¨MCTSï¼šä½¿ç”¨MCTSç”Ÿæˆå¤šä¸ªè§£é¢˜è·¯å¾„æ—¶ï¼Œä¸ä¸€å®šè¦ç”¨PRMæ¥å†³å®šå“ªä¸ªèŠ‚ç‚¹å€¼å¾—æ‰©å±•ï¼Œå¯ä»¥ç”¨å¤–éƒ¨å¤§æ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰æ¥é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥ç”¨æ¨¡å‹è‡ªèº«çš„perplexityæ¥åˆ¤æ–­ã€‚æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æ‰¾åˆ°æœ€å€¼å¾—æ‰©å±•çš„èŠ‚ç‚¹ï¼ŒPRMåªæ˜¯æŒ‘é€‰çš„ä¼—å¤šæ–¹æ³•ä¹‹ä¸€ã€‚ PRM å’Œ MCTS æ—¢å¯ä»¥åº”ç”¨äºä¼˜åŒ–è®­ç»ƒæ•°æ®ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥é¢„æµ‹ç”¨ ç”¨äºå¾—åˆ°é«˜è´¨é‡è®­ç»ƒæ•°æ®ï¼šå¦‚rStarè®ºæ–‡ä¸­ï¼Œå¯ä»¥ç”¨PRMå’ŒMCTSçš„æ–¹å¼æ¥è¿­ä»£åœ°ç­›é€‰å¾—åˆ°è´¨é‡æ›´å¥½çš„æ€ç»´é“¾SFTæ•°æ®æˆ–è€…RLHFæ•°æ®ï¼Œè¿˜å¯ä»¥ç”Ÿæˆæ›´ç²¾ç¡®çš„reward modelè®­ç»ƒæ•°æ®ã€‚ ç”¨äºæ¨ç†ï¼šå¾ˆç®€å•ï¼Œæ¨ç†ç”¨MCTSçš„æ–¹å¼æŠŠ test-scaling åšä¸Šæ¥ï¼Œå†ç»“åˆPRMçš„æ–¹å¼ä»ä¼—å¤šè·¯å¾„ä¸­æŒ‘é€‰æœ€ä½³ç­”æ¡ˆã€‚ PRMå’ŒMCTSçš„ç¼ºç‚¹ è¿™æ–¹é¢ DeepSeek-R1å’Œ kimi1.5çš„è®ºæ–‡å·²ç»è¯´å¾—å¾ˆæƒ…å†µäº†ã€‚ Process Reward Model(PRM) åœ¨å®é™…åº”ç”¨ä¸­æœ‰ä¸‰å¤§å±€é™ï¼š ç¬¬ä¸€ï¼Œéš¾ä»¥æ¸…æ™°ç•Œå®šä¸€èˆ¬æ¨ç†ä¸­çš„ç»†ç²’åº¦æ­¥éª¤ï¼Œè¯´ç™½äº†ï¼Œæ€ä¹ˆå®šä¹‰ä»€ä¹ˆä¸ºä¸€ä¸ªæ­¥éª¤ã€‚ ç¬¬äºŒï¼Œåˆ¤æ–­å½“å‰æ­¥éª¤çš„æ­£è¯¯éš¾åº¦å¤§ï¼Œæ¨¡å‹è‡ªåŠ¨åŒ–æ ‡æ³¨ä¸å¦‚äººæ„ï¼Œäººå·¥æ ‡æ³¨åˆéš¾ä»¥æ‹“å±•ã€‚ ç¬¬ä¸‰ï¼Œå¼•å…¥åŸºäºæ¨¡å‹çš„PRMæ˜“è‡´reward hackingï¼Œæœ‰æ—¶ä¸ºäº†è®­ç»ƒ policy modelï¼Œä½†åè€Œæ›´å¤šæ—¶é—´å»ä¼˜åŒ– reward model å»äº†ã€‚ å¯¹MCTSçš„çœ‹æ³•ï¼š æ–‡æœ¬çš„ç”Ÿæˆæœç´¢ç©ºé—´æŒ‡æ•°çº§å¢é•¿ï¼Œä¸ºåº”å¯¹ï¼Œç»™èŠ‚ç‚¹è®¾æ‰©å±•ä¸Šé™ï¼Œå´å®¹æ˜“è®©æ¨¡å‹é™·å…¥å±€éƒ¨æœ€ä¼˜è§£å›°å¢ƒã€‚ MCTSå¾€å¾€è¦ç»“åˆä¸€ä¸ªç²¾ç¡®çš„PRMæ¥ç”¨æ‰èƒ½å‘æŒ¥æœ€å¤§æ•ˆæœï¼Œä½†PRMåˆæœ‰ä¸Šè¿°çš„é—®é¢˜ï¼Œé™·å…¥ä¸€ä¸ªæ­»å¾ªç¯ã€‚ ","date":"2025-04-04","objectID":"/mcts%E5%92%8Cprm/:1:0","tags":["LLM","NLP","reasoning"],"title":"MCTSå’ŒPRM","uri":"/mcts%E5%92%8Cprm/"},{"categories":["LLM","NLP","reasoning"],"content":"å‚è€ƒ https://zhuanlan.zhihu.com/p/27278317894 rStar-Math: Small LLMs Can Master Math Reasoning with Self-Evolved Deep Thinking ","date":"2025-04-04","objectID":"/mcts%E5%92%8Cprm/:2:0","tags":["LLM","NLP","reasoning"],"title":"MCTSå’ŒPRM","uri":"/mcts%E5%92%8Cprm/"},{"categories":["","python","coding"],"content":"a = 'global' def outer(): # def len(in_var): # print('called my len() function: ', end=\"\") # l = 0 # for i in in_var: # l += 1 # return l a = 'local' def inner(): nonlocal a a += ' variable' inner() print('a is', a) # print(len(a)) outer() # print(len(a)) print('a is', a) æ­¤æ—¶ä¸ºnonlocal aï¼Œä¼šæŒ‰ç…§local-é—­åŒ…-globalçš„é¡ºåºæ‰¾åˆ°é—­åŒ…å˜é‡aã€‚açš„å€¼ä¸ºlocal variable a = 'global' def outer(): # def len(in_var): # print('called my len() function: ', end=\"\") # l = 0 # for i in in_var: # l += 1 # return l a = 'local' def inner(): global a a += ' variable' inner() print('a is', a) # print(len(a)) outer() # print(len(a)) print('a is', a) æ­¤æ—¶ä¸ºglobalï¼Œä¼šä»å…¨å±€å˜é‡ä¸­å¯»æ‰¾aï¼Œaçš„å€¼ä¸ºglobal variable ","date":"2025-03-24","objectID":"/legb/:0:0","tags":["python","coding","LEGB"],"title":"LEGB","uri":"/legb/"},{"categories":["","coding","python"],"content":"pythonè°ƒè¯•å·¥å…·ï¼Œç±»ä¼¼äºvscodeçš„è°ƒè¯•å·¥å…·ï¼Œä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œè°ƒè¯•ã€‚ ","date":"2025-03-23","objectID":"/debugger/:0:0","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"ä½¿ç”¨æ–¹æ³• ","date":"2025-03-23","objectID":"/debugger/:1:0","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"æ’å…¥å¼ import pdb; pdb.set_trace() æˆ–è€… breakpoint() ","date":"2025-03-23","objectID":"/debugger/:1:1","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"éæ’å…¥å¼ python -m pdb [-c command] (-m module | pyfile) [args ...] ","date":"2025-03-23","objectID":"/debugger/:1:2","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"å¸¸ç”¨å‘½ä»¤ ","date":"2025-03-23","objectID":"/debugger/:2:0","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"h å³helpï¼Œå¯ç”¨å‘½ä»¤å¦‚ä¸‹ ","date":"2025-03-23","objectID":"/debugger/:2:1","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"p p x å³print(x)ï¼Œç”¨äºæ‰“å°å˜é‡ã€‚ pp xï¼Œä½¿ç”¨pprintæ‰“å° ","date":"2025-03-23","objectID":"/debugger/:2:2","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"w å³whereï¼ŒæŸ¥çœ‹å½“å‰è°ƒç”¨æ ˆã€‚ ","date":"2025-03-23","objectID":"/debugger/:2:3","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"uå’Œd uå³upï¼Œå›åˆ°ä¸Šä¸€ä¸ªframe då³downï¼Œåˆ°ä¸‹ä¸€ä¸ªframe ","date":"2025-03-23","objectID":"/debugger/:2:4","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"l å³lst l æŸ¥çœ‹å‰å12è¡Œä»£ç  llæŸ¥çœ‹å½“å‰å‡½æ•°å…¨éƒ¨ä»£ç  ","date":"2025-03-23","objectID":"/debugger/:2:5","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"b å³breakï¼Œè¿›è¡Œæ‰“æ–­ç‚¹ b xï¼Œåœ¨ç¬¬xè¡Œæ‰“æ–­ç‚¹ã€‚ b æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹ã€‚ ç›¸åŒçš„æœ‰tbreakï¼Œä¸breakçš„åŒºåˆ«æ˜¯ç¬¬ä¸€æ¬¡åˆ°è¯¥æ–­ç‚¹åä¼šè‡ªåŠ¨ç§»é™¤æ–­ç‚¹ã€‚å³temporary breakpoint ","date":"2025-03-23","objectID":"/debugger/:2:6","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"n å³nextï¼Œæ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ï¼Œä½†å¿½è§†å‡½æ•°è°ƒç”¨å†…éƒ¨ç»†èŠ‚ ","date":"2025-03-23","objectID":"/debugger/:2:7","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"s å³stepï¼Œæ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ï¼Œå¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œåˆ™è°ƒç”¨æ–°frameï¼Œè¿›å…¥å‡½æ•°å†…éƒ¨ã€‚ ","date":"2025-03-23","objectID":"/debugger/:2:8","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"c å³continueï¼Œç»§ç»­ç¨‹åºçš„æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ image.png ","date":"2025-03-23","objectID":"/debugger/:2:9","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"r å³returnï¼Œç›´æ¥è·³è½¬åˆ°å½“å‰å‡½æ•°returnè¯­å¥ ","date":"2025-03-23","objectID":"/debugger/:2:10","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"until until nï¼Œä½¿ç¨‹åºç»§ç»­æ‰§è¡Œç›´åˆ°æ‰§è¡Œåˆ°è¡Œæ•°ä¸ºnçš„è¯­å¥ã€‚ ","date":"2025-03-23","objectID":"/debugger/:2:11","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"cl å³clear clear nï¼Œæ¸…é™¤ç¼–å·ä¸ºnçš„æ–­ç‚¹ clearï¼Œæ¸…é™¤æ‰€æœ‰æ–­ç‚¹ã€‚ ### j å³jumpï¼Œå‘å‰æˆ–å‘åè·³è½¬ï¼Œä¸untilåŒºåˆ«æ˜¯ï¼Œjumpä¸ä¼šæ‰§è¡Œä¸­é—´çš„è¯­å¥ï¼Œè€Œæ˜¯å¿½ç•¥ä»–ä»¬ã€‚ ","date":"2025-03-23","objectID":"/debugger/:2:12","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["","coding","python"],"content":"display ç›¸å½“äºä¸€ä¸ªç›‘è§†å™¨ï¼Œç”¨äºç›‘è§†å˜é‡çš„å˜åŒ– ### retval æ‰“å°å½“å‰å‡½æ•°æœ€åä¸€æ¬¡è¿”å›çš„è¿”å›å€¼ ### q å³quitï¼Œé€€å‡ºpdbè°ƒè¯•ã€‚ ","date":"2025-03-23","objectID":"/debugger/:2:13","tags":["coding","python"],"title":"debugger","uri":"/debugger/"},{"categories":["coding","LLM","generate"],"content":"ç†è®ºéƒ¨åˆ†åœ¨è¿™ï¼šgenerateç›¸å…³ ## generateå‚æ•° def generate( self, inputs: Optional[torch.Tensor] = None, generation_config: Optional[GenerationConfig] = None, logits_processor: Optional[LogitsProcessorList] = None, stopping_criteria: Optional[StoppingCriteriaList] = None, prefix_allowed_tokens_fn: Optional[Callable[[int, torch.Tensor], List[int]]] = None, synced_gpus: Optional[bool] = None, assistant_model: Optional[\"PreTrainedModel\"] = None, streamer: Optional[\"BaseStreamer\"] = None, negative_prompt_ids: Optional[torch.Tensor] = None, negative_prompt_attention_mask: Optional[torch.Tensor] = None, **kwargs, ) -\u003e Union[GenerateOutput, torch.LongTensor]: åœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°åœ¨å‡½æ•°å…¥å£æ˜¾å¼çš„å®šä¹‰äº†å¾ˆå¤šå‚æ•°ã€‚ä»–ä»¬çš„å…·ä½“å«ä¹‰å¦‚ä¸‹ inputsï¼štensor å½¢å¼çš„ token_idï¼Œé€šå¸¸å…ˆå‡†å¤‡æ–‡æœ¬å½¢å¼çš„æç¤ºè¯å’Œè¾“å…¥ï¼Œä½¿ç”¨tokenizerè½¬åŒ–ä¸ºå¯¹åº” idï¼Œè¿™é‡Œç»´åº¦é€šå¸¸ä¸º [batch_size, seq_len] generation_configï¼šä¸€ä¸ªç”¨ GenerationConfig ç±»åˆ›å»ºçš„å¯¹è±¡ï¼Œå­˜å‚¨ç€æ¨¡å‹ç”Ÿæˆçš„è¶…å‚æ•°ï¼Œå¯ä»¥æå‰åˆ›å»ºè¯¥å¯¹è±¡å¹¶ä¼ å…¥ .generate() logits_processorï¼šé«˜çº§åŠŸèƒ½ï¼Œlogits_processor å¯ä»¥åœ¨æ¯ä¸ª step çš„è¾“å‡ºæ¦‚ç‡è®¡ç®—å®Œæˆåï¼Œå¯¹åˆ†æ•°è¿›è¡Œè¿›ä¸€æ­¥çš„å¹²é¢„ï¼Œæ”¹å˜è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä»è€Œå½±å“ç”Ÿæˆçš„ç»“æœï¼Œä¾‹å¦‚æœ€å¸¸è§çš„ï¼Œé‡å¤æƒ©ç½šï¼Œå°±æ˜¯ä½¿ç”¨ logits_processor å®Œæˆçš„ã€‚ stopping_criteriaï¼šé«˜çº§åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ stopping_criteria è‡ªå®šä¹‰ç”Ÿæˆåœæ­¢æ¡ä»¶ prefix_allowed_tokens_fnï¼šè§£ç ç­–ç•¥çš„ä¸€ä¸ªè¶…å‚æ•°ï¼Œç”¨äºå‰ç¼€ token çº¦æŸ synced_gpusï¼š DeepSpeed ZeRO Stage-3 å¤šGPUæ—¶ä½¿ç”¨ï¼ˆZeRO-3åŒ…æ‹¬ä¼˜åŒ–å™¨çŠ¶æ€+æ¢¯åº¦+æƒé‡å¹¶è¡Œä¼˜åŒ–ï¼Œè€Œæ¨ç†é˜¶æ®µåªä½¿ç”¨æƒé‡å¹¶è¡Œï¼‰ï¼Œæ­¤æ—¶éœ€è¦å°† synced_gpus è®¾ç½®æˆ Tureã€‚. å¦åˆ™ï¼Œå¦‚æœä¸€ä¸ª GPU åœ¨å¦ä¸€ä¸ª GPU ä¹‹å‰å®Œæˆç”Ÿæˆï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šæŒ‚èµ·ï¼Œå› ä¸ºå…¶ä½™ GPU å°šæœªä»æœ€å…ˆå®Œæˆçš„ GPU æ¥æ”¶åˆ°æƒé‡åˆ†ç‰‡ã€‚ transformers\u003e=4.28 åœ¨ç”Ÿæˆæ—¶æ£€æµ‹åˆ°å¤šä¸ª GPU ä¼šè‡ªåŠ¨è®¾ç½® synced_gpus=Trueï¼Œtransformers\u003c4.28 éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼Œæœ¬æ–‡ä»£ç ç¯å¢ƒtransformers=4.41.1 assistant_modelï¼šé«˜çº§åŠŸèƒ½ï¼Œè¾…åŠ©ç”Ÿæˆæ¨¡å‹ï¼Œå¦ä¸€ä¸ªè¯è¡¨å®Œå…¨ç›¸åŒçš„å°æ¨¡å‹ï¼Œæœ‰äº›tokenä½¿ç”¨è¾…åŠ©æ¨¡å‹ç”Ÿæˆæ›´å¿« streamerï¼šæµå¼è¾“å‡ºæ§åˆ¶å™¨ï¼Œç°åœ¨çš„å¤§æ¨¡å‹å¹³å°éƒ½æ˜¯ä¸€ä¸ªå­—ä¸€ä¸ªå­—æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œè¿™å°±æ˜¯æµå¼è¾“å‡ºï¼Œå¦åˆ™çš„è¯ä¼šç­‰æ‰€æœ‰ç”Ÿæˆå®Œæˆå†æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰æµå¼è¾“å‡ºçš„æ–¹å¼ negative_prompt_idsï¼šè´Ÿé¢æç¤ºï¼Œä¸€äº›å‰æ²¿ç ”ç©¶ä¼šç”¨åˆ°ï¼Œä¸ç”¨ç®¡ negative_prompt_attention_maskï¼šè´Ÿé¢æç¤ºçš„ attention_mask **kwargs è¿™é‡Œç»å¸¸ä¼ å…¥ temperature=0.7, top_k=20, max_new_tokens=512ç­‰å‚æ•°ï¼Œéƒ½æ˜¯é€šè¿‡**kwargsä¼ å…¥è¿›æ¥çš„ å…¶å®ä¼ å…¥çš„è¿™äº›éƒ½æ˜¯è¾“å…¥å‚æ•° generation_config çš„å±æ€§ï¼ˆå¯ä»¥è¿›å…¥å¯¹åº”ç±»ä¸­çœ‹ä¸€ä¸‹æœ‰å“ªäº›å±æ€§ï¼Œfrom transformers.generation.configuration_utils import GenerationConfigï¼‰ï¼Œä½ å¯ä»¥åˆ›å»ºè¯¥å¯¹è±¡å¹¶è¦†ç›–æŸäº›å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°å½¢å¼åœ¨è°ƒç”¨.generate()æ—¶ä¼ è¿›æ¥ åœ¨åé¢ä¼šå°†ä¼ å…¥çš„è¿™äº›å‚æ•°è¦†ç›–æ‰generation_configä¸­å¯¹åº”çš„å±æ€§ ä¸‹é¢åªè¯´æ˜ä¸€äº›å…³é”®çš„åœ°æ–¹ ## kwargs -\u003e generation_config å°±æ˜¯å°†kwargsä¸­ä¼ å…¥çš„kwargsçš„å‚æ•°å˜æˆconfigã€‚ generation_config, model_kwargs = self._prepare_generation_config(generation_config, **kwargs) ","date":"2025-03-09","objectID":"/generate/:0:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["coding","LLM","generate"],"content":"å‡†å¤‡logitå¤„ç†å™¨ prepared_logits_processor = self._get_logits_processor( generation_config=generation_config, input_ids_seq_length=input_ids_length, encoder_input_ids=inputs_tensor, prefix_allowed_tokens_fn=prefix_allowed_tokens_fn, logits_processor=logits_processor, device=inputs_tensor.device, model_kwargs=model_kwargs, negative_prompt_ids=negative_prompt_ids, negative_prompt_attention_mask=negative_prompt_attention_mask, ) å°±æ˜¯å°†generation_configä¸­çš„é‡‡æ ·å‚æ•°å°è£…æˆlogit-processorï¼Œè¿˜æœ‰è‡ªå·±å®šä¹‰çš„processor ","date":"2025-03-09","objectID":"/generate/:1:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["coding","LLM","generate"],"content":"å‡†å¤‡stoppingå¤„ç†å™¨ prepared_stopping_criteria = self._get_stopping_criteria( generation_config=generation_config, stopping_criteria=stopping_criteria, tokenizer=tokenizer, **kwargs ) åŒç†ã€‚å°†ä¸€äº›ä¸åœæ­¢æœ‰å…³çš„å‚æ•°å°è£…æˆstoppingå¤„ç†å™¨ã€‚ ","date":"2025-03-09","objectID":"/generate/:2:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["coding","LLM","generate"],"content":"logits warper logits warperÂ é‡Œé¢æ˜¯é‡‡æ ·æ—¶æ‰éœ€è¦è¿è¡Œçš„å¤„ç†å™¨ logits processorÂ æ˜¯é€šç”¨çš„å¤„ç†å™¨ï¼Œæ¯ç§ç”Ÿæˆæ¨¡å¼éƒ½éœ€è¦ç”¨åˆ°çš„ prepared_logits_warper = ( self._get_logits_warper(generation_config) if generation_config.do_sample else None ) ","date":"2025-03-09","objectID":"/generate/:3:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["coding","LLM","generate"],"content":"æ­£å¼ç”Ÿæˆ # è¿›å…¥æ¨¡å‹å†…éƒ¨ç”Ÿæˆä¸‹ä¸€ä¸ªtoken outputs = self( **model_inputs, return_dict=True, output_attentions=output_attentions, output_hidden_states=output_hidden_states, ) if synced_gpus and this_peer_finished: continue # don't waste resources running the code we don't need # å–å‡ºæœ€åä¸€ä¸ªtokenï¼Œ.logitsç»´åº¦ä¸ºï¼ˆbatch_size, seq_len, vocab_sizeï¼‰ next_token_logits = outputs.logits[:, -1, :] # ç»è¿‡å‰é¢çš„å¤„ç†å™¨è¿›è¡Œåˆ†æ•°è°ƒæ•´ next_token_scores = logits_processor(input_ids, next_token_logits) if do_sample: next_token_scores = logits_warper(input_ids, next_token_scores) æŒ‰ç…§æ˜¯å¦é‡‡æ ·æ¥ç”Ÿæˆä¸‹ä¸€ä¸ªtokenï¼š if do_sample: probs = nn.functional.softmax(next_token_scores, dim=-1) # torch.multinomialï¼šæŒ‰ç…§è¾“å…¥probsçš„æ¯ä¸€è¡Œï¼ˆæ¯ä¸ªbatchï¼‰ä½œä¸ºé‡‡æ ·çš„æ¦‚ç‡ï¼Œ # æ¯è¡Œä¸æ”¾å›çš„å–å‡ºnum_samplesä¸ªï¼Œéšæœºé‡‡æ ·æ¯ä¸ªbatchæŒ‰è¾“å…¥æ¦‚ç‡å–å‡ºä¸€ä¸ª next_tokens = torch.multinomial(probs, num_samples=1).squeeze(1) else: # torch.argmaxå–å‡ºè¾“å…¥next_token_scoresä¸­å€¼æœ€å¤§çš„ç´¢å¼• next_tokens = torch.argmax(next_token_scores, dim=-1) æœ€ååˆ¤æ–­æ˜¯å¦å¯ä»¥åœæ­¢ï¼š unfinished_sequences = unfinished_sequences \u0026 ~stopping_criteria(input_ids, scores) this_peer_finished = unfinished_sequences.max() == 0 ","date":"2025-03-09","objectID":"/generate/:4:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["coding","LLM","generate"],"content":"å‚è€ƒ https://blog.csdn.net/qq_41496421/article/details/142346738?spm=1001.2014.3001.5502 https://blog.csdn.net/qq_41496421/article/details/142580960?spm=1001.2014.3001.5501 ","date":"2025-03-09","objectID":"/generate/:5:0","tags":["coding","LLM"],"title":"generate","uri":"/generate/"},{"categories":["","einops"],"content":" einops.einsum calls einsum operations with einops-style named axes indexing, computing tensor products with an arbitrary number of tensors. Unlike typical einsum syntax, here you must pass tensors first, and then the pattern. Also, note that rearrange operations such asÂ \"(batch chan) out\", or singleton axesÂ (), are not currently supported. çˆ±å› æ–¯å¦æ±‚å’Œ ","date":"2025-01-11","objectID":"/einsum/:0:0","tags":["einops"],"title":"einsum","uri":"/einsum/"},{"categories":["einops"],"content":"pack Packs several tensors into one. See einops tutorial for introduction into packing (and how it replaces stack and concatenation). ## unpack \u003eUnpacks a single tensor into several by splitting over a selected axes. See einops tutorial for introduction into packing (and how it replaces stack and concatenation). image.png ","date":"2025-01-11","objectID":"/pack-and-unpack/:1:0","tags":["einops"],"title":"pack and unpack","uri":"/pack-and-unpack/"},{"categories":["","einops"],"content":" einops.rearrange is a reader-friendly smart element reordering for multidimensional tensors. This operation includes functionality of transpose (axes permutation), reshape (view), squeeze, unsqueeze, stack, concatenate and other operations. ä»£æ›¿reshapeï¼Œç»™ç»´åº¦å‘½åã€‚å¯ä»¥ç”¨â€¦ä»£è¡¨ä¸æƒ³åŠ¨çš„ç»´åº¦ã€‚ ","date":"2025-01-11","objectID":"/rearrange/:0:0","tags":["einops"],"title":"rearrange","uri":"/rearrange/"},{"categories":["","einops"],"content":" einops.reduce combines rearrangement and reduction using reader-friendly notation. reduceä¼šä½¿ç»´åº¦å‡å°‘ã€‚ ","date":"2025-01-11","objectID":"/reduce/:0:0","tags":["einops"],"title":"reduce","uri":"/reduce/"},{"categories":["","einops"],"content":" einops.repeat allows reordering elements and repeating them in arbitrary combinations. This operation includes functionality of repeat, tile, and broadcast functions. repeatæ˜¯ä½¿ç»´åº¦å¢åŠ ï¼Œä¸reduceç›¸åã€‚ ## åº”ç”¨ æ¯”å¦‚è¯´repeat_kvå‡½æ•°å°±å¯ä»¥ç”¨einops.repeatå¾ˆæ–¹ä¾¿çš„å®ç° def repeat_kv(x: torch.Tensor, n_rep: int) -\u003e torch.Tensor: \"\"\"torch.repeat_interleave(x, dim=2, repeats=n_rep)\"\"\" bs, slen, n_kv_heads, head_dim = x.shape if n_rep == 1: return x return ( x[:, :, :, None, :] .expand(bs, slen, n_kv_heads, n_rep, head_dim) .reshape(bs, slen, n_kv_heads * n_rep, head_dim) ) ç­‰ä»·äº def repeat_kv(x: torch.Tensor, n_rep: int) -\u003e torch.Tensor: einops.repeat(x, 'bs slen kvheads dim-\u003e bs slen (kvheads n_rep) dim', n_rep=n_rep).shape ","date":"2025-01-11","objectID":"/repeat/:0:0","tags":["einops"],"title":"repeat","uri":"/repeat/"},{"categories":["","einops"],"content":" Convert a tensor of an imperative framework (i.e.Â numpy/cupy/torch/jax/etc.) toÂ numpy.ndarray image.png ","date":"2025-01-08","objectID":"/asnumpy/:0:0","tags":["einops"],"title":"asnumpy","uri":"/asnumpy/"},{"categories":["einops"],"content":" Parse a tensor shape to dictionary mapping axes names to their lengths. # Use underscore to skip the dimension in parsing. \u003e\u003e\u003e x = np.zeros([2, 3, 5, 7]) \u003e\u003e\u003e parse_shape(x, 'batch _ h w') {'batch': 2, 'h': 5, 'w': 7} # `parse_shape` output can be used to specify axes_lengths for other operations: \u003e\u003e\u003e y = np.zeros([700]) \u003e\u003e\u003e rearrange(y, '(b c h w) -\u003e b c h w', **parse_shape(x, 'b _ h w')).shape (2, 10, 5, 7) ä¹Ÿå°±æ˜¯æŠŠç»´åº¦çš„ç»´æ•°æ˜ å°„åˆ°å¯¹åº”çš„å‘½åã€‚ä¸æ•°æ®æ— å…³ï¼Œåªçœ‹å¾—åˆ°ç»´åº¦ã€‚ ","date":"2025-01-08","objectID":"/parse_shape/:0:0","tags":["einops"],"title":"parse_shape","uri":"/parse_shape/"},{"categories":["","coding","torch"],"content":"gather å‚æ•°ï¼š inputÂ (Tensor) â€“ the source tensor dimÂ (int) â€“ the axis along which to index indexÂ (LongTensor) â€“ the indices of elements to gather outÂ (Tensor_,__optional_) â€“ the destination tensor sparse_gradÂ (bool,optional) â€“ IfÂ True, gradient w.r.t.Â inputÂ will be a sparse tensor. \u003e gatheræ“ä½œæ˜¯scatteræ“ä½œçš„é€†æ“ä½œï¼Œå¦‚æœè¯´scatteræ˜¯æ ¹æ®indexå’Œsrcæ±‚self(input)ï¼Œé‚£ä¹ˆgatheræ“ä½œæ˜¯æ ¹æ®self(input)å’Œindexæ±‚srcã€‚å…·ä½“æ¥è¯´gatheræ“ä½œæ˜¯æ ¹æ®indexæŒ‡å‡ºçš„ç´¢å¼•ï¼Œæ²¿dimæŒ‡å®šçš„è½´æ”¶é›†inputçš„å€¼ã€‚ out[i][j][k] = input[index[i][j][k]][j][k] # if dim == 0 out[i][j][k] = input[i][index[i][j][k]][k] # if dim == 1 out[i][j][k] = input[i][j][index[i][j][k]] # if dim == 2 å¯¹äºgatheræ“ä½œæ¥è¯´ï¼Œæœ‰ä¸‰ä¸ªçº¦æŸéœ€è¦æ»¡è¶³ï¼š ï¼ˆ1ï¼‰å¯¹äºæ‰€æœ‰çš„ç»´åº¦d != dimï¼Œæœ‰input.size(d) == index.size(d)ï¼Œå¯¹äºç»´åº¦dimæ¥è¯´ï¼Œæœ‰index.size(d) \u003e= 1ï¼› ï¼ˆ2ï¼‰å¼ é‡outçš„ç»´åº¦å¤§å°å¿…é¡»å’Œindexç›¸åŒï¼› ï¼ˆ3ï¼‰å’Œscatterä¸€æ ·ï¼Œindexä¸­çš„ç´¢å¼•å€¼å¿…é¡»åœ¨input.size(dim)èŒƒå›´å†…ã€‚ ### example ### code example import torch t = torch.Tensor([[1, 2], [3, 4]]) # t = 1 2 # 3 4 index = torch.LongTensor([[0, 0], [1, 0]]) # index = 0 0 # 1 0 # dim = 0 : [[1,2],[3,2]] # dim = 1 : [[1,1],[4,3]] # index = 0 # 1 # dim = 0 : [[1],[3]] # dim = 1 : [[1],[4]] # index = 0 1 # dim = 0 : [[1, 4]] # dim = 1 : [[1, 2]] ","date":"2024-12-20","objectID":"/gather%E5%92%8Cscatter/:1:0","tags":["coding","gather","scatter"],"title":"gatherå’Œscatter","uri":"/gather%E5%92%8Cscatter/"},{"categories":["","coding","torch"],"content":"scatter Writes all values from the tensorÂ intoÂ at the indices specified in theÂ tensor. For each value inÂ , its output index is specified by its index inÂ forÂ and by the corresponding value inÂ forÂ .`src``self``index``src``src``dimensionÂ !=Â dim``index``dimensionÂ =Â dim` For a 3-D tensor,Â is updated as:`self` å‚æ•°ï¼š - dimÂ (int) â€“ the axis along which to index - indexÂ (LongTensor) â€“ the indices of elements to scatter, can be either empty or the same size of src. When empty, the operation returns identity - srcÂ (Tensor) â€“ the source element(s) to scatter, incase value is not specified - valueÂ (float) â€“ the source element(s) to scatter, incase src is not specified self[index[i][j][k]][j][k] = src[i][j][k] # if dim == 0 self[i][index[i][j][k]][k] = src[i][j][k] # if dim == 1 self[i][j][index[i][j][k]] = src[i][j][k] # if dim == 2 çœ‹äº†ä¸Šé¢è¿™ä¸ªæ“ä½œå°±ç†è§£äº†ã€‚ ç”±æ­¤å¯ä»¥å¾—å‡ºä»¥ä¸‹çº¦æŸï¼š 1. å¼ é‡selfï¼Œå¼ é‡indexå’Œå¼ é‡srcçš„ç»´åº¦æ•°é‡å¿…é¡»ç›¸åŒï¼ˆå³ä¸‰è€…çš„.dim()å¿…é¡»ç›¸ç­‰ï¼Œæ³¨æ„ä¸æ˜¯ç»´åº¦å¤§å°ï¼‰ï¼› 2. å¯¹äºæ¯ä¸€ä¸ªç»´åº¦dï¼Œæœ‰index.size(d)\u003c=src.size(d)ï¼› 3. å¯¹äºæ¯ä¸€ä¸ªç»´åº¦dï¼Œå¦‚æœd!=dimï¼Œæœ‰index.size(d)\u003c=self.size(d)ï¼› å¯¹äºindexä¹Ÿæœ‰ä¸€äº›çº¦æŸï¼š 1. å¼ é‡indexä¸­çš„æ¯ä¸€ä¸ªå€¼å¤§å°å¿…é¡»åœ¨[0, self.size(dim)-1]ä¹‹é—´ï¼› 2. å¼ é‡indexæ²¿dimç»´çš„é‚£ä¸€è¡Œä¸­æ‰€æœ‰å€¼éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆå¼±çº¦æŸï¼Œè¿åä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¼šé€ æˆæ²¡æœ‰æ„ä¹‰çš„æ“ä½œï¼‰ã€‚ ","date":"2024-12-20","objectID":"/gather%E5%92%8Cscatter/:2:0","tags":["coding","gather","scatter"],"title":"gatherå’Œscatter","uri":"/gather%E5%92%8Cscatter/"},{"categories":["","coding","torch"],"content":"example ### code example import torch a = torch.arange(10).reshape(2,5).float() print(f\"a: \\n{a}\") b = torch.zeros(3, 5) print(f\"b: \\n{b}\") b_= b.scatter(dim=0, index=torch.LongTensor([[1, 2, 1, 1, 2], [2, 0, 2, 1, 0]]), src=a) print(f\"b_: \\n{b_}\") # tensor([[0, 6, 0, 0, 9], # [0, 0, 2, 8, 0], # [5, 1, 7, 0, 4]]) ","date":"2024-12-20","objectID":"/gather%E5%92%8Cscatter/:2:1","tags":["coding","gather","scatter"],"title":"gatherå’Œscatter","uri":"/gather%E5%92%8Cscatter/"},{"categories":["","coding","torch"],"content":"scatter_add_ è¿™ä¸ªå‡½æ•°å’ŒscatteråŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼ŒåŒºåˆ«åœ¨äºä¸Šå›¾ä¸­çš„å¯¹äºselfä¸­åŒä¸€ä½ç½®çš„å¡«å…¥æ˜¯éšæœºçš„ï¼Œself[3,0]ä¸ç¡®å®šæ˜¯7è¿˜æ˜¯9ï¼Œself[0,1]ä¸ç¡®å®šæ˜¯8è¿˜æ˜¯10ï¼Œä½†æ˜¯ä½¿ç”¨scatter_addå°±å°†æ‰€æœ‰å³å°†å¡«å…¥åŒä¸€ä½ç½®çš„æ•°ç›¸åŠ ï¼Œä¾‹å­å¦‚ä¸‹ï¼š ### example ","date":"2024-12-20","objectID":"/gather%E5%92%8Cscatter/:3:0","tags":["coding","gather","scatter"],"title":"gatherå’Œscatter","uri":"/gather%E5%92%8Cscatter/"},{"categories":["","coding","torch"],"content":"å‚è€ƒ https://zhuanlan.zhihu.com/p/158993858 ","date":"2024-12-20","objectID":"/gather%E5%92%8Cscatter/:4:0","tags":["coding","gather","scatter"],"title":"gatherå’Œscatter","uri":"/gather%E5%92%8Cscatter/"},{"categories":["","LLM","NLP"],"content":"LLaMAä»‹ç» LLaMA æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œæ•ˆæœæœ€å¥½çš„å¼€æº LLM ä¹‹ä¸€ã€‚ è®ºæ–‡çš„æ ¸å¿ƒæ€æƒ³ï¼šç›¸æ¯”äºGPTï¼Œæ›´å°çš„æ¨¡å‹+æ›´å¤šçš„è®­ç»ƒæ•°æ®**ä¹Ÿå¯ä»¥è·å¾—å¯æ¯”çš„æ•ˆæœ åŸºäºæ›´å¤š tokens çš„è®­ç»ƒé›†ï¼Œåœ¨å„ç§æ¨ç†é¢„ç®—ä¸‹ï¼Œè®­ç»ƒå‡ºæ€§èƒ½æœ€ä½³çš„ä¸€ç³»åˆ—è¯­è¨€æ¨¡å‹ï¼Œç§°ä¸º LLaMAï¼Œå‚æ•°èŒƒå›´ä» 7B åˆ° 65B ä¸ç­‰ï¼Œä¸ç°æœ‰æœ€ä½³ LLM ç›¸æ¯”ï¼Œå…¶æ€§èƒ½æ˜¯æœ‰ç«äº‰åŠ›çš„ã€‚æ¯”å¦‚ï¼ŒLLaMA-13B åœ¨å¤§å¤šæ•°åŸºå‡†æµ‹è¯•ä¸­ä¼˜äº GPT-3ï¼Œå°½ç®¡å…¶å°ºå¯¸åªæœ‰ GPT-3 çš„ååˆ†ä¹‹ä¸€ã€‚ä½œè€…ç›¸ä¿¡ï¼ŒLLaMA å°†æœ‰åŠ©äºä½¿ LLM çš„ä½¿ç”¨å’Œç ”ç©¶å¹³æ°‘åŒ–ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨å•ä¸ª GPU ä¸Šè¿è¡Œï¼åœ¨è§„æ¨¡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒLLaMA-65B ä¹Ÿå…·æœ‰ä¸æœ€ä½³å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ Chinchilla æˆ– PaLM-540Bï¼‰ç›¸ç«äº‰çš„èƒ½åŠ›ã€‚ LLaMA1ã€2çš„ä¸»è¦å·®åˆ«åœ¨è®­ç»ƒä¸Šä¸‹æ–‡é•¿åº¦ã€è®­ç»ƒtokenæ•°ã€æ³¨æ„åŠ›æœºåˆ¶ä»¥åŠå¯¹é½æ–¹æ³•ä¸Šã€‚ æ¨¡å‹ è®­ç»ƒé•¿åº¦ åˆ†è¯å™¨ è¯è¡¨å¤§å° ä½ç½®ç¼–ç  æ¿€æ´»å±‚ æ ‡å‡†åŒ– è®­ç»ƒtokenæ•° é“¾æ¥ ç²¾åº¦ æ³¨æ„åŠ›æœºåˆ¶ æœ‰æ— chatç‰ˆæœ¬ Alignment LLaMA 2,048 BPEï¼ˆSentence-Pieceï¼‰ 32k ROPE SwiGLU åŸºäº RMSNorm çš„ Pre-Norm 1ä¸‡äº¿(6.7B,13B) 1.4ä¸‡äº¿ï¼ˆ32.5B,65.2Bï¼‰ http://arxiv.org/abs/2302.13971 fp16 MHA 0 LLaMA2 4,096 åŒä¸Š 32k ROPE åŒä¸Š åŒä¸Š 2ä¸‡äº¿ https://arxiv.org/abs/2307.09288 bf16 34B,70B GQA, å…¶ä»–MHA 1 SFT+RLHF(æ‹’ç»é‡‡æ ·+PPO) ï¼ˆè¡¨æ¥è‡ªLLaMAå®¶æ—ï¼‰ LLaMA1 ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:0:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"è®­ç»ƒæ•°æ® image.png ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:1:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"è®­ç»ƒå‚æ•° image.png ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:2:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"RMSnorm ä¸ Layer Norm ç›¸æ¯”ï¼ŒRMS Normçš„ä¸»è¦åŒºåˆ«åœ¨äºå»æ‰äº†å‡å»å‡å€¼çš„éƒ¨åˆ†ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š \\[\\overline{a}_{i}=\\frac{a_{i}}{RMS(a)}\\] å…¶ä¸­ \\[RMS(a)=\\sqrt{\\frac{1}{n}\\Sigma_{i=1}^{n}a_{i}^{2}} \\\\ \\] æ­¤å¤–RMSNorm è¿˜å¯ä»¥å¼•å…¥å¯å­¦ä¹ çš„ç¼©æ”¾å› å­gï¼Œä»è€Œå¾—åˆ° \\[\\overline{a}_i=\\frac{a_i}{RMS(\\boldsymbol{a})}g_i\\] ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:3:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"Pre-normå’ŒPost-norm æ³¨æ„å…¶ä½¿ç”¨çš„æ˜¯Pre-normç»“æ„ï¼Œä¸Post-normç»“æ„å·®å¼‚å¦‚ä¸‹ï¼š å…³äºPre Normçš„æ•ˆæœå’ŒPost Normæ•ˆæœå·®å¼‚ï¼Œç›¸å…³åˆ†æåœ¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ï¼š æ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ ä¸ºä»€ä¹ˆPre Normçš„æ•ˆæœä¸å¦‚Post Normï¼Ÿ æ€»ç»“æ¥è¯´å°±æ˜¯Pre-normåŠ æ·±çš„æ˜¯æ¨¡å‹çš„å®½åº¦ï¼Œè€Œä¸æ˜¯æ·±åº¦ï¼Œä»è€Œå¯¼è‡´è®­ç»ƒæ•ˆæœä¸å¦‚Post-normï¼Œä½†å¯ä»¥ç¼“è§£Post-normçš„æ¢¯åº¦æ¶ˆå¤±ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:3:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä»£ç  class LlamaRMSNorm(nn.Module): def __init__(self, hidden_size, eps=1e-6): \"\"\" LlamaRMSNorm is equivalent to T5LayerNorm \"\"\" super().__init__() self.weight = nn.Parameter(torch.ones(hidden_size)) self.variance_epsilon = eps # eps é˜²æ­¢å–å€’æ•°ä¹‹ååˆ†æ¯ä¸º0 def forward(self, hidden_states): input_dtype = hidden_states.dtype variance = hidden_states.to(torch.float32).pow(2).mean(-1, keepdim=True) hidden_states = hidden_states * torch.rsqrt(variance + self.variance_epsilon) # rsqrt å³sqrtåå–å€’æ•° # weight æ˜¯æœ«å°¾ä¹˜çš„å¯è®­ç»ƒå‚æ•°, å³g_i return (self.weight * hidden_states).to(input_dtype) ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:3:2","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"RoPE RoPE çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œé€šè¿‡ç»å¯¹ä½ç½®ç¼–ç çš„æ–¹å¼å®ç°ç›¸å¯¹ä½ç½®ç¼–ç â€ï¼Œå¯ä»¥è¯´æ˜¯å…·å¤‡äº†ç»å¯¹ä½ç½®ç¼–ç çš„æ–¹ä¾¿æ€§ï¼ŒåŒæ—¶å¯ä»¥è¡¨ç¤ºä¸åŒ token ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚RoPE æ˜¯å°†ä½ç½®ç¼–ç å’Œ queryæˆ–è€…keyè¿›è¡Œç›¸ä¹˜ã€‚ \\[\\begin{bmatrix}\\cos m\\theta_0\u0026-\\sin m\\theta_0\u00260\u00260\u0026\\cdots\u00260\u00260\\\\\\sin m\\theta_0\u0026\\cos m\\theta_0\u00260\u00260\u0026\\cdots\u00260\u00260\\\\0\u00260\u0026\\cos m\\theta_1\u0026-\\sin m\\theta_1\u0026\\cdots\u00260\u00260\\\\0\u00260\u0026\\sin m\\theta_1\u0026\\cos m\\theta_1\u0026\\cdots\u00260\u00260\\\\\\vdots\u0026\\vdots\u0026\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\u0026\\vdots\\\\0\u00260\u00260\u00260\u0026\\cdots\u0026\\cos m\\theta_{d/2-1}\u0026-\\sin m\\theta_{d/2-1}\\\\0\u00260\u00260\u00260\u0026\\cdots\u0026\\sin m\\theta_{d/2-1}\u0026\\cos m\\theta_{d/2-1}\\end{bmatrix}\\begin{bmatrix}q_0\\\\q_1\\\\q_2\\\\q_3\\\\\\vdots\\\\q_{d-2}\\\\q_{d-1}\\end{bmatrix}\\] ç”±äºçŸ©é˜µå¤ªç¨€ç–ï¼Œä¼šé€ æˆæµªè´¹ï¼Œå› æ­¤è®¡ç®—æ—¶æ˜¯è¿™ä¹ˆåšçš„ï¼š \\[\\begin{bmatrix}q_0\\\\q_1\\\\q_2\\\\q_3\\\\\\vdots\\\\q_{d-2}\\\\q_{d-1}\\end{bmatrix}\\otimes\\begin{bmatrix}\\cos m\\theta_0\\\\\\cos m\\theta_0\\\\\\cos m\\theta_1\\\\\\cos m\\theta_1\\\\\\vdots\\\\\\cos m\\theta_{d/2-1}\\\\\\cos m\\theta_{d/2-1}\\end{bmatrix}+\\begin{bmatrix}-q_1\\\\q_0\\\\-q_3\\\\q_2\\\\\\vdots\\\\-q_{d-1}\\\\q_{d-2}\\end{bmatrix}\\otimes\\begin{bmatrix}\\sin m\\theta_0\\\\\\sin m\\theta_0\\\\\\sin m\\theta_1\\\\\\sin m\\theta_1\\\\\\vdots\\\\\\sin m\\theta_{d/2-1}\\\\\\sin m\\theta_{d/2-1}\\end{bmatrix}\\] æ­¤å¤–ï¼Œè§’åº¦çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š \\[\\theta_j=10000^{-2j/d},j\\in[1,2,\\dots,d/2]\\] ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:4:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä»£ç  class LlamaRotaryEmbedding(torch.nn.Module): def __init__(self, dim, max_position_embeddings=2048, base=10000, device=None): super().__init__() inv_freq = 1.0 / (base ** (torch.arange(0, dim, 2).float().to(device) / dim)) self.register_buffer(\"inv_freq\", inv_freq) # Build here to make `torch.jit.trace` work. self.max_seq_len_cached = max_position_embeddings t = torch.arange(self.max_seq_len_cached, device=self.inv_freq.device, dtype=self.inv_freq.dtype) freqs = torch.einsum(\"i,j-\u003eij\", t, self.inv_freq) # Different from paper, but it uses a different permutation # in order to obtain the same calculation emb = torch.cat((freqs, freqs), dim=-1) dtype = torch.get_default_dtype() self.register_buffer(\"cos_cached\", emb.cos()[None, None, :, :].to(dtype), persistent=False) self.register_buffer(\"sin_cached\", emb.sin()[None, None, :, :].to(dtype), persistent=False) def forward(self, x, seq_len=None): # x: [bs, num_attention_heads, seq_len, head_size] # This `if` block is unlikely to be run after we build sin/cos in `__init__`. # Keep the logic here just in case. if seq_len \u003e self.max_seq_len_cached: self.max_seq_len_cached = seq_len t = torch.arange(self.max_seq_len_cached, device=x.device, dtype=self.inv_freq.dtype) freqs = torch.einsum(\"i,j-\u003eij\", t, self.inv_freq) # Different from paper, but it uses a different permutation # in order to obtain the same calculation emb = torch.cat((freqs, freqs), dim=-1).to(x.device) self.register_buffer(\"cos_cached\", emb.cos()[None, None, :, :].to(x.dtype), persistent=False) self.register_buffer(\"sin_cached\", emb.sin()[None, None, :, :].to(x.dtype), persistent=False) return ( self.cos_cached[:, :, :seq_len, ...].to(dtype=x.dtype), self.sin_cached[:, :, :seq_len, ...].to(dtype=x.dtype), ) def rotate_half(x): \"\"\"Rotates half the hidden dims of the input.\"\"\" x1 = x[..., : x.shape[-1] // 2] x2 = x[..., x.shape[-1] // 2 :] return torch.cat((-x2, x1), dim=-1) def apply_rotary_pos_emb(q, k, cos, sin, position_ids): # The first two dimensions of cos and sin are always 1, so we can `squeeze` them. cos = cos.squeeze(1).squeeze(0) # [seq_len, dim] sin = sin.squeeze(1).squeeze(0) # [seq_len, dim] cos = cos[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] sin = sin[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] q_embed = (q * cos) + (rotate_half(q) * sin) k_embed = (k * cos) + (rotate_half(k) * sin) return q_embed, k_embed ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:4:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"SwiGLU \\[\\begin{aligned} \\mathrm{FFN}_{\\mathrm{SwiGLU}}(x,W,V,W_{2})\u0026=\\mathrm{SwiGLU}(x,W,V)W_{2}\\\\\\mathrm{SwiGLU}(x,W,V)\u0026=\\mathrm{Swish}_{\\beta}(xW)\\otimes xV\\\\\\mathrm{Swish}_{\\beta}(x)\u0026=x\\sigma(\\beta x) \\end{aligned}\\] ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:5:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä»£ç  class LlamaMLP(nn.Module): def __init__( self, hidden_size: int, intermediate_size: int, hidden_act: str, ): super().__init__() self.gate_proj = nn.Linear(hidden_size, intermediate_size, bias=False) self.down_proj = nn.Linear(intermediate_size, hidden_size, bias=False) self.up_proj = nn.Linear(hidden_size, intermediate_size, bias=False) # config ä¸­ hidden_act = 'silu' # 'silu' å’Œ 'swish' å¯¹åº”çš„æ¿€æ´»å‡½æ•°å‡ä¸ºï¼šSiLUActivation # https://github.com/huggingface/transformers/blob/717dadc6f36be9f50abc66adfd918f9b0e6e3502/src/transformers/activations.py#L229 self.act_fn = ACT2FN[hidden_act] def forward(self, x): # å¯¹åº”ä¸Šè¿°å…¬å¼çš„ SwiGLU return self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x)) ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:5:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"å®éªŒç»“æœ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:6:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"å¸¸è¯†æ¨ç†ä»»åŠ¡ image.png LLaMA - 13Bæ¨¡å‹è™½ç„¶æ¯”GPT - 3å°10å€ï¼Œä½†åœ¨å¤§å¤šæ•°åŸºå‡†ä¸Šä¹Ÿä¼˜äºGPT - 3ã€‚ é™¤BoolQå¤–ï¼ŒLLaMA - 65Båœ¨æ‰€æœ‰æŠ¥å‘Šçš„åŸºå‡†ä¸Šéƒ½ä¼˜äºChinchilla-70Bã€‚ é™¤äº†åœ¨BoolQå’ŒWinoGrandeä¸Šï¼ŒLLaMA-65Båœ¨æ‰€æœ‰åœ°æ–¹éƒ½è¶…è¿‡äº†PaLM540Bã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:6:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"é˜…è¯»ç†è§£ä»»åŠ¡ image.png å¯ä»¥çœ‹åˆ°ï¼ŒLLaMA-13Bæ¯”GPT-3é«˜å‡ºäº†å‡ ä¸ªç™¾åˆ†ç‚¹ã€‚ LLaMA-65Bçš„è¡¨ç°å·²ç»æ¥è¿‘ç”šè‡³è¶…è¶ŠPaLM-540Bçš„è¡¨ç°ã€‚ LLaMA2 Llama1åªåšäº†é¢„è®­ç»ƒï¼ŒLlama2åšäº†é¢„è®­ç»ƒ+SFT+RLHF ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:6:2","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"KV Cache image.png LLMæ¨ç†è¿‡ç¨‹åˆ†ä¸ºPrefillå’ŒDecodeä¸¤ä¸ªé˜¶æ®µã€‚ Prefillé˜¶æ®µä¼šå¯¹Promptä¸­æ‰€æœ‰çš„tokenåšå¹¶è¡Œè®¡ç®—ï¼Œå¾—åˆ°Promptä¸­æ‰€æœ‰Tokensçš„KV Cacheä»¥åŠè®¡ç®—å¾—åˆ°ç”Ÿæˆçš„ç¬¬ä¸€ä¸ªTokenã€‚Prompté˜¶æ®µTokenè®¡ç®—å¾—åˆ°çš„KV Cacheä¼šä¿å­˜ä¸‹æ¥ï¼Œç•™ç»™Decodeé˜¶æ®µå¤ç”¨ã€‚ Decodeé˜¶æ®µæ˜¯ä¸€ä¸ªè‡ªå›å½’è¿‡ç¨‹ï¼Œæ¯decodeä¸€ä¸ªæ–°çš„Tokenï¼Œéƒ½éœ€è¦ç”¨åˆ°æ‰€æœ‰ä¹‹å‰è®¡ç®—å¾—åˆ°çš„KV Cacheæ¥è®¡ç®—å½“å‰query tokençš„Attentionã€‚å› æ­¤ï¼Œå½“è¾“å‡ºé•¿åº¦è¶Šæ¥è¶Šå¤§æˆ–è€…contextå¾ˆé•¿æ—¶ï¼ŒKV Cacheå°†ä¼šå ç”¨å¤§é‡çš„æ˜¾å­˜ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:7:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä½¿ç”¨KV cacheæ—¶ä½ç½®ä¿¡æ¯æ€ä¹ˆæ³¨å…¥ï¼Ÿ åˆæ¬¡å­¦ä¹ KV cacheæ—¶ï¼Œè™½ç„¶åŸç†æ¯”è¾ƒç®€å•æ˜“æ‡‚ï¼Œä½†æ˜¯å¯¹äºåç»­çš„è¾“å…¥åªæœ‰ä¸€ä¸ªtokenè¿™é‡Œäº§ç”Ÿäº†äº›è®¸å›°æƒ‘ï¼Œåç»­åªè¾“å…¥ä¸€ä¸ªtokençš„è¯ï¼Œä½ç½®ç¼–ç è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿäºæ˜¯æˆ‘æ¯”è¾ƒç®€å•ç²—æš´åœ°çŒœæµ‹ä½ç½®indexéšç€æ¨ç†ä¸æ–­æ›´æ–°ï¼Œå½“æ—¶ç¿»äº†å„ç§èµ„æ–™ä¹Ÿæ²¡æœ‰å¾—åˆ°è§£é‡Šï¼Œåé¢ç¿»äº†ç¿»llamaçš„æºç ï¼Œå‘ç°æˆ‘çš„çŒœæµ‹è¿˜çœŸæ˜¯æ­£ç¡®çš„ã€‚ def forward(self, tokens: torch.Tensor, start_pos: int): \"\"\" Perform a forward pass through the Transformer model. Args: tokens (torch.Tensor): Input token indices. start_pos (int): Starting position for attention caching. Returns: torch.Tensor: Output logits after applying the Transformer model. \"\"\" _bsz, seqlen = tokens.shape h = self.tok_embeddings(tokens) self.freqs_cis = self.freqs_cis.to(h.device) freqs_cis = self.freqs_cis[start_pos : start_pos + seqlen] mask = None if seqlen \u003e 1: mask = torch.full( (seqlen, seqlen), float(\"-inf\"), device=tokens.device ) mask = torch.triu(mask, diagonal=1) # When performing key-value caching, we compute the attention scores # only for the new sequence. Thus, the matrix of scores is of size # (seqlen, cache_len + seqlen), and the only masked entries are (i, j) for # j \u003e cache_len + i, since row i corresponds to token cache_len + i. mask = torch.hstack([ torch.zeros((seqlen, start_pos), device=tokens.device), mask ]).type_as(h) for layer in self.layers: h = layer(h, start_pos, freqs_cis, mask) h = self.norm(h) output = self.output(h).float() return output å¯ä»¥çœ‹åˆ°forwardå‡½æ•°ä¸­çš„start_poså‚æ•°ä»£è¡¨ç€ä½ç½®ä¿¡æ¯ï¼Œfreqs_cisæ˜¯å®ç°RoPEä½ç½®ç¼–ç éœ€è¦ç”¨åˆ°çš„ã€‚ æ³¨æ„ freqs_cis = self.freqs_cis[start_pos : start_pos + seqlen]è¿™ä¸€è¡Œï¼Œå³æ˜¯å®ç°äº†ropeç›¸å¯¹ä½ç½®ç¼–ç çš„kv cacheçš„æ ¸å¿ƒã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:7:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä»£ç  class Attention(nn.Module): # ... self.cache_k = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() self.cache_v = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() def forward( self, x: torch.Tensor, start_pos: int, freqs_cis: torch.Tensor, mask: Optional[torch.Tensor], ): # å‡è®¾å½“å‰xä¸º(1, 1, dim)ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªé¢„æµ‹çš„token # self-attentionçš„è¾“å…¥ï¼Œæ ‡å‡†çš„(bs, seqlen, hidden_dim) bsz, seqlen, _ = x.shape # è®¡ç®—å½“å‰tokençš„qkv # q k våˆ†åˆ«è¿›è¡Œæ˜ å°„ï¼Œæ³¨æ„è¿™é‡Œkey, valueä¹Ÿéœ€è¦å…ˆç”±è¾“å…¥è¿›è¡Œæ˜ å°„å†å’Œkv_cacheé‡Œé¢çš„key, valueè¿›è¡Œæ‹¼æ¥ xq, xk, xv = self.wq(x), self.wk(x), self.wv(x) xq = xq.view(bsz, seqlen, self.n_local_heads, self.head_dim) xk = xk.view(bsz, seqlen, self.n_local_kv_heads, self.head_dim) xv = xv.view(bsz, seqlen, self.n_local_kv_heads, self.head_dim) # å¯¹å½“å‰è¾“å…¥çš„queryå’Œkeyè¿›è¡ŒRoPEï¼Œæ³¨æ„kv_cacheé‡Œé¢çš„keyå·²ç»åšè¿‡äº†RoPE xq, xk = apply_rotary_emb(xq, xk, freqs_cis=freqs_cis) # ç¼“å­˜å½“å‰tokençš„kv self.cache_k = self.cache_k.to(xq) self.cache_v = self.cache_v.to(xq) self.cache_k[:bsz, start_pos: start_pos + seqlen] = xk self.cache_v[:bsz, start_pos: start_pos + seqlen] = xv # å–å‡ºå‰seqlenä¸ªtokençš„kvç¼“å­˜ # å–å‡ºå…¨éƒ¨ç¼“å­˜çš„keyå’Œvalueï¼ˆåŒ…æ‹¬ä¹‹å‰åœ¨cacheé‡Œé¢çš„å’Œæœ¬æ¬¡è¾“å…¥çš„ï¼‰ï¼Œä½œä¸ºæœ€ç»ˆçš„keyå’Œvalue keys = self.cache_k[:bsz, : start_pos + seqlen] values = self.cache_v[:bsz, : start_pos + seqlen] # å°†kvé‡å¤å¡«å……ï¼Œä½¿kvå’Œqçš„å¤´æ•°ä¸ªæ•°ç›¸åŒ # repeat k/v heads if n_kv_heads \u003c n_headsï¼Œå¯¹é½å¤´çš„æ•°é‡ keys = repeat_kv(keys, self.n_rep) # (bs, cache_len + seqlen, n_local_heads, head_dim) values = repeat_kv(values, self.n_rep) # (bs, cache_len + seqlen, n_local_heads, head_dim) # è®¡ç®—å½“å‰tokençš„attention scoreï¼Œï¼Œæ³¨æ„maskéœ€è¦åŠ ä¸Šï¼Œå¦å¤–ç»´åº¦è¦å¯¹åº”ä¸Š xq = xq.transpose(1, 2) # (bs, n_local_heads, seqlen, head_dim) keys = keys.transpose(1, 2) # (bs, n_local_heads, cache_len + seqlen, head_dim) values = values.transpose(1, 2) # (bs, n_local_heads, cache_len + seqlen, head_dim) scores = torch.matmul(xq, keys.transpose(2, 3)) / math.sqrt(self.head_dim) if mask is not None: scores = scores + mask # (bs, n_local_heads, seqlen, cache_len + seqlen) scores = F.softmax(scores.float(), dim=-1).type_as(xq) output = torch.matmul(scores, values) # (bs, n_local_heads, seqlen, head_dim) output = output.transpose(1, 2).contiguous().view(bsz, seqlen, -1) return self.wo(output) ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:7:2","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"MQA\u0026GQA image.png ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:8:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä¸ºä»€ä¹ˆä¸ç»§ç»­ä½¿ç”¨MHAï¼Ÿ æ ‡å‡†çš„mhaä¸­ï¼ŒKV headsçš„æ•°é‡å’ŒQuery headsçš„æ•°é‡ç›¸åŒï¼Œæ¯ä¸€ä¸ªq headå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„kv headï¼Œä½†è¿™æ ·çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:8:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"MQA æ ‡å‡†çš„MHAä¸­ï¼ŒKV headsçš„æ•°é‡å’ŒQuery headsçš„æ•°é‡ç›¸åŒï¼Œæ¯ä¸€ä¸ªq headå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„kv headï¼Œä½†è¿™æ ·çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ MQAæ¯”è¾ƒæç«¯ï¼Œåªä¿ç•™ä¸€ä¸ªKV Headï¼Œå¤šä¸ªQuery Headså…±äº«ç›¸åŒçš„KV Headã€‚è¿™ç›¸å½“äºä¸åŒHeadçš„Attentionå·®å¼‚ï¼Œå…¨éƒ¨éƒ½æ”¾åœ¨äº†Queryä¸Šï¼Œéœ€è¦æ¨¡å‹ä»…ä»ä¸åŒçš„Query Headsä¸Šå°±èƒ½å¤Ÿå…³æ³¨åˆ°è¾“å…¥hidden statesä¸åŒæ–¹é¢çš„ä¿¡æ¯ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæå¤§åœ°é™ä½äº†KV Cacheçš„éœ€æ±‚ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ¨¡å‹æ•ˆæœæœ‰æ‰€ä¸‹é™ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:8:2","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"GQA GQAå°±æ˜¯åœ¨MHAå’ŒMQAä¹‹é—´åšäº†ä¸€ä¸ªå¹³è¡¡ã€‚å¯¹query headsè¿›è¡Œåˆ†ç»„ï¼Œåˆ†æˆå‡ ç»„å°±å¯¹åº”å¤šå°‘ä¸ªkv headsï¼Œç„¶åæ¯ä¸€ç»„å†…çš„query Headså…±äº«ç›¸åŒçš„KV headã€‚ GQAå¯ä»¥åœ¨å‡å°‘è®¡ç®—é‡å’ŒKV CacheåŒæ—¶ç¡®ä¿æ¨¡å‹æ•ˆæœä¸å—åˆ°å¤§çš„å½±å“ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:8:3","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"SFT ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuning, SFTï¼‰æ˜¯å¯¹å·²ç»é¢„è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œç‰¹å®šä»»åŠ¡çš„è®­ç»ƒï¼Œä»¥æé«˜å…¶åœ¨è¯¥ä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚é¢„è®­ç»ƒæ¨¡å‹é€šå¸¸åœ¨å¤§é‡é€šç”¨æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå­¦åˆ°å¹¿æ³›çš„è¯­è¨€çŸ¥è¯†å’Œç‰¹å¾ã€‚åœ¨SFTè¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨ç‰¹å®šä»»åŠ¡çš„æ•°æ®ï¼Œå¯¹æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥è°ƒæ•´ï¼Œä½¿å…¶æ›´é€‚åˆè¯¥ä»»åŠ¡ã€‚ SFTæ•°æ®ä¸€èˆ¬å°±æ˜¯\u003cprompt, response\u003eæ•°æ®å¯¹ã€‚åœ¨è®­ç»ƒæ–¹å¼ä¸Šå’Œpretrainæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œå³å¾—åˆ°å½“å‰tokenå¯¹åº”çš„logitï¼Œä»¥next tokenä½œä¸ºæ ‡ç­¾è®¡ç®—äº¤å‰ç†µæŸå¤±ã€‚ pretrain æ˜¯åœ¨èƒŒä¹¦ï¼Œçº¯ç²¹çš„å­¦ä¹ çŸ¥è¯†ï¼›sft åˆ™æ˜¯åœ¨åšé¢˜ï¼Œå­¦ä¹ çš„æ˜¯æŒ‡ä»¤ follow èƒ½åŠ›ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:9:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"ä¸€äº›è¦ç‚¹ å°‘é‡é«˜è´¨é‡æ•°æ®é›†è®­ç»ƒæ¨¡å‹çš„æ•ˆæœï¼Œè¦å¥½äºå¤§é‡ä½è´¨é‡æ•°æ®é›†çš„è®­ç»ƒæ•ˆæœã€‚åˆ†ææ•°æ®å’Œæ¸…æ´—æ•°æ®å°±æ˜¯ sft é˜¶æ®µ 90% çš„å·¥ä½œé‡ã€‚ sft ä¼šè®©æ¨¡å‹è§åˆ°æœ€é‡è¦çš„ eos_tokenï¼Œpretrain æ¨¡å‹å› ä¸ºæ²¡è§è¿‡è¯¥ token è€Œæ— æ³•åœæ­¢ç”Ÿæˆã€‚ sft çš„ prompt ä¸åš lossï¼Œä½†è¿™å¹¶ä¸æ˜¯è¯´å®ƒä¸èƒ½åš lossã€‚ä¸»è¦åŸå› æ˜¯ prompt çš„åŒè´¨åŒ–æ¯”è¾ƒä¸¥é‡ï¼Œä¸åš loss_mask çš„è¯ï¼ŒåŒæ ·çš„ä¸€å¥è¯ä¼šè¢«ç¿»æ¥è¦†å»çš„å­¦ï¼Œä½†å¦‚æœä½ èƒ½ä¿è¯ä½ çš„æ¯æ¡ prompt éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå°±å®Œå…¨å¯ä»¥çœå» prompt çš„ loss_mask ç¯èŠ‚ã€‚ ä¸ºäº†æé«˜æ¨¡å‹è®­ç»ƒæ•ˆç‡ï¼Œå°†å¤šç»„æ•°æ®è¿›è¡Œæ‹¼æ¥ï¼Œå°½é‡å¡«æ»¡4096ã€‚ä½†å¯¹äºåˆ†ç±»ä»»åŠ¡ä¼šå‡ºç°é—®é¢˜ï¼Œè¯¦è§https://zhuanlan.zhihu.com/p/809229182ã€‚ ç»è¿‡ä¸€é€šåˆ†æåï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ–°çš„è®­ç»ƒæ–¹å¼æ”¹å˜äº†çŸ­ answer æ•°æ®çš„ loss å æ¯”ï¼Œæ¯•ç«Ÿæ¨¡å‹åœ¨è®¡ç®— loss çš„æ—¶å€™ï¼Œæ˜¯å…ˆç®—ä¸€ä¸ªå¥å­å†…æ¯ä¸ª token çš„ å¹³å‡ lossï¼Œå†ç®—ä¸€ä¸ª batch_size å†…çš„å¹³å‡ lossã€‚ åˆ†ç±»ä»»åŠ¡çš„ answer é€šå¸¸åªæœ‰ 1 ä¸ª tokenï¼šä¸ concat çš„æ—¶å€™ï¼Œå®ƒçš„ loss è´¡çŒ®å°±æ˜¯ 1 / batch_sizeï¼›concat çš„æ—¶å€™ï¼Œå®ƒå°±éœ€è¦å…ˆå’Œåˆ«çš„ answer çš„ token ç®—å¹³å‡ lossï¼Œå†è´¡çŒ® 1 / batch_sizeã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨ llama2 æåˆ°çš„ å…ˆ concat è¯­æ–™å†åš sft è®­ç»ƒï¼Œä¼šå¯¹çŸ­ answer æ•°æ®å¾ˆä¸å…¬å¹³ï¼Œä¹Ÿå°±æ›´å®¹æ˜“é€ æˆçŸ­ answer æ•°æ®çš„æ¬ æ‹Ÿåˆï¼Œpretrain ç”±äºæ‰€æœ‰ token éƒ½ç®— loss åˆ™æ²¡æœ‰è¿™ä¸ªç°è±¡ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé‡‡æ ·çŸ­ answer æ•°æ®ï¼ŒæˆåŠŸçš„é¿å…äº†åˆ†ç±»ä»»åŠ¡çš„æ•ˆæœä¸‹æ»‘ã€‚ ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:9:1","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","NLP"],"content":"å®éªŒç»“æœ - Llama 2æ¨¡å‹ä¼˜äºLlama 1æ¨¡å‹ã€‚ - Llama 2-70Bæ¯”Llama 1-65Båœ¨MMLUå’ŒBBHä¸Šçš„ç»“æœåˆ†åˆ«æé«˜äº†â‰ˆ5å’Œâ‰ˆ8ä¸ªç‚¹ã€‚ - Llama 2-7Bå’Œ30Bæ¨¡å‹åœ¨é™¤ä»£ç åŸºå‡†ä»¥å¤–çš„æ‰€æœ‰ç±»åˆ«ä¸Šéƒ½ä¼˜äºç›¸åº”å¤§å°çš„MPTæ¨¡å‹ã€‚ - Llama 2-7Bå’Œ34Båœ¨æ‰€æœ‰ç±»åˆ«çš„åŸºå‡†æµ‹è¯•é›†ä¸Šéƒ½ä¼˜äºFalcon-7Bå’Œ40Bæ¨¡å‹ã€‚ å‚è€ƒ [KV Cacheä¼˜åŒ–]ğŸ”¥MQA/GQA/YOCO/CLA/MLKVç¬”è®°: å±‚å†…å’Œå±‚é—´KV Cacheå…±äº« - çŸ¥ä¹ (zhihu.com) Transformers KV Caching Explained | by JoÃ£o Lages | Medium https://zhuanlan.zhihu.com/p/679640407 LLaMAå®¶æ— https://zhuanlan.zhihu.com/p/809229182 ","date":"2024-09-26","objectID":"/llama%E7%B3%BB%E5%88%97/:10:0","tags":["LLM","NLP","llama"],"title":"llamaç³»åˆ—","uri":"/llama%E7%B3%BB%E5%88%97/"},{"categories":["","LLM","generate"],"content":" image.png LLMè§£ç æ—¶é‡‡ç”¨çš„è‡ªå›å½’é‡‡æ ·ï¼Œå…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š å°æ¨¡å‹ä½¿ç”¨å‰ç¼€ä½œä¸ºè¾“å…¥ï¼Œå°†è¾“å‡ºç»“æœå¤„ç†+å½’ä¸€åŒ–æˆæ¦‚ç‡åˆ†å¸ƒåï¼Œé‡‡æ ·ç”Ÿæˆä¸‹ä¸€ä¸ªtokenã€‚ å°†ç”Ÿæˆçš„tokenå’Œå‰ç¼€æ‹¼æ¥æˆæ–°çš„å‰ç¼€ï¼Œé‡å¤æ‰§è¡Œ1ï¼Œç›´åˆ°ç”ŸæˆEOSæˆ–è€…è¾¾åˆ°æœ€å¤§tokenæ•°ç›®ã€‚ å°†æ¨¡å‹è¾“å‡ºlogitsçš„è½¬æ¢æˆæ¦‚ç‡ï¼Œæœ‰å‡ ç§å¸¸ç”¨çš„é‡‡æ ·æ–¹æ³•ï¼ŒåŒ…æ‹¬argmaxã€top-kå’Œtop-nç­‰ # è´ªå¿ƒæœç´¢ ç›´æ¥é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„å•è¯ã€‚è¿™ç§æ–¹æ³•ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆçš„æ–‡æœ¬è¿‡äºå•è°ƒå’Œé‡å¤ # éšæœºé‡‡æ · æŒ‰ç…§æ¦‚ç‡åˆ†å¸ƒéšæœºé€‰æ‹©ä¸€ä¸ªå•è¯ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¢åŠ ç”Ÿæˆçš„å¤šæ ·æ€§ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆçš„æ–‡æœ¬ä¸è¿è´¯å’Œæ— æ„ä¹‰ã€‚ # beam search ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º k çš„å€™é€‰åºåˆ—é›†åˆï¼Œæ¯ä¸€æ­¥ä»æ¯ä¸ªå€™é€‰åºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ k ä¸ªå•è¯ï¼Œç„¶åä¿ç•™æ€»æ¦‚ç‡æœ€é«˜çš„ k ä¸ªå€™é€‰åºåˆ—ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¹³è¡¡ç”Ÿæˆçš„è´¨é‡å’Œå¤šæ ·æ€§ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆçš„æ–‡æœ¬è¿‡äºä¿å®ˆå’Œä¸è‡ªç„¶ã€‚ # top-k é€‰å–å‰kä¸ªtokenï¼Œç„¶åå†é‡æ–°ç”Ÿæˆæ¦‚ç‡åˆ†å¸ƒï¼Œå†è¿›è¡ŒæŠ½æ · å®ƒå¯ä»¥ä¸å…¶ä»–è§£ç ç­–ç•¥ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚æ¸©åº¦è°ƒèŠ‚ï¼ˆTemperature Scalingï¼‰ã€é‡å¤æƒ©ç½šï¼ˆRepetition Penaltyï¼‰ã€é•¿åº¦æƒ©ç½šï¼ˆLength Penaltyï¼‰ç­‰ï¼Œæ¥è¿›ä¸€æ­¥ä¼˜åŒ–ç”Ÿæˆçš„æ•ˆæœã€‚ ä»£ç : import torch from labml_nn.sampling import Sampler # Top-k Sampler class TopKSampler(Sampler): # k is the number of tokens to pick # sampler is the sampler to use for the top-k tokens # sampler can be any sampler that takes a logits tensor as input and returns a token tensor; e.g. `TemperatureSampler`. def __init__(self, k: int, sampler: Sampler): self.k = k self.sampler = sampler # Sample from logits def __call__(self, logits: torch.Tensor): # New logits filled with âˆ’âˆ; i.e. zero probability zeros = logits.new_ones(logits.shape) * float('-inf') # Pick the largest k logits and their indices values, indices = torch.topk(logits, self.k, dim=-1) # Set the values of the top-k selected indices to actual logits. # Logits of other tokens remain âˆ’âˆ zeros.scatter_(-1, indices, values) # Sample from the top-k logits with the specified sampler. return self.sampler(zeros) top-p top-k æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œé‚£å°±æ˜¯â€œk å€¼å–å¤šå°‘æ˜¯æœ€ä¼˜çš„ï¼Ÿâ€éå¸¸éš¾ç¡®å®šã€‚äºæ˜¯å‡ºç°äº†åŠ¨æ€è®¾ç½® token å€™é€‰åˆ—è¡¨å¤§å°ç­–ç•¥â€”â€”å³æ ¸é‡‡æ ·ï¼ˆNucleus Samplingï¼‰ã€‚ top-p é‡‡æ ·çš„æ€è·¯æ˜¯ï¼Œåœ¨æ¯ä¸€æ­¥ï¼Œåªä»ç´¯ç§¯æ¦‚ç‡è¶…è¿‡æŸä¸ªé˜ˆå€¼ p çš„æœ€å°å•è¯é›†åˆä¸­è¿›è¡Œéšæœºé‡‡æ ·ï¼Œè€Œä¸è€ƒè™‘å…¶ä»–ä½æ¦‚ç‡çš„å•è¯ã€‚è¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºæ ¸é‡‡æ ·ï¼ˆnucleus samplingï¼‰ï¼Œå› ä¸ºå®ƒåªå…³æ³¨æ¦‚ç‡åˆ†å¸ƒçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè€Œå¿½ç•¥äº†å°¾éƒ¨éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ p=0.9ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªä»ç´¯ç§¯æ¦‚ç‡è¾¾åˆ° 0.9 çš„æœ€å°å•è¯é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªå•è¯ï¼Œè€Œä¸è€ƒè™‘å…¶ä»–ç´¯ç§¯æ¦‚ç‡å°äº 0.9 çš„å•è¯ã€‚è¿™æ ·å¯ä»¥é¿å…é‡‡æ ·åˆ°ä¸€äº›ä¸åˆé€‚æˆ–ä¸ç›¸å…³çš„å•è¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿ç•™ä¸€äº›æœ‰è¶£æˆ–æœ‰åˆ›æ„çš„å•è¯ã€‚ import torch from torch import nn from labml_nn.sampling import Sampler class NucleusSampler(Sampler): \"\"\" ## Nucleus Sampler \"\"\" def __init__(self, p: float, sampler: Sampler): \"\"\" :param p: is the sum of probabilities of tokens to pick $p$ :param sampler: is the sampler to use for the selected tokens \"\"\" self.p = p self.sampler = sampler # Softmax to compute $P(x_i | x_{1:i-1})$ from the logits self.softmax = nn.Softmax(dim=-1) def __call__(self, logits: torch.Tensor): \"\"\" Sample from logits with Nucleus Sampling \"\"\" # Get probabilities $P(x_i | x_{1:i-1})$ probs = self.softmax(logits) # Sort probabilities in descending order sorted_probs, indices = torch.sort(probs, dim=-1, descending=True) # Get the cumulative sum of probabilities in the sorted order cum_sum_probs = torch.cumsum(sorted_probs, dim=-1) # Find the cumulative sums less than $p$. nucleus = cum_sum_probs \u003c self.p # Prepend ones so that we add one token after the minimum number # of tokens with cumulative probability less that $p$. nucleus = torch.cat([nucleus.new_ones(nucleus.shape[:-1] + (1,)), nucleus[..., :-1]], dim=-1) # Get log probabilities and mask out the non-nucleus sorted_log_probs = torch.log(sorted_probs) sorted_log_probs[~nucleus] = float('-inf') # Sample from the sampler sampled_sorted_indexes = self.sampler(sorted_log_probs) # Get the actual indexes res = indices.gather(-1, sampled_sorted_indexes.unsqueeze(-1)) # return res.squeeze(-1) Temperatureé‡‡æ · è¯¦è§æ¸©åº¦è¶…å‚æ•° speculative decoding å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ¨ç†é€šå¸¸éœ€è¦ä½¿ç”¨è‡ªå›å½’é‡‡æ ·ã€‚å®ƒä»¬çš„æ¨ç†è¿‡ç¨‹ç›¸å½“ç¼“æ…¢ï¼Œéœ€è¦é€ä¸ªtokenåœ°è¿›è¡Œä¸²è¡Œè§£ç ã€‚å› æ­¤ï¼Œå¤§å‹æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹å¾€å¾€å—åˆ¶äºè®¿å­˜é€Ÿåº¦ï¼Œç”Ÿæˆæ¯ä¸ªæ ‡è®°éƒ½éœ€è¦å°†æ‰€æœ‰å‚æ•°ä»å­˜å‚¨å•å…ƒä¼ è¾“åˆ°è®¡ç®—å•å…ƒï¼Œå› æ­¤å†…å­˜è®¿é—®å¸¦å®½æˆä¸ºä¸¥é‡çš„ç“¶é¢ˆã€‚ ä¸ºäº†è§£å†³æ¨ç†é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œå·²ç»è¿›è¡Œäº†è®¸å¤šé’ˆå¯¹æ¨ç†çš„å·¥ç¨‹ä¼˜åŒ–ï¼Œä¾‹å¦‚æ”¹è¿›çš„è®¡ç®—æ ¸å¿ƒå®ç°ã€å¤šå¡å¹¶è¡Œè®¡ç®—ã€æ‰¹å¤„ç†ç­–ç•¥ç­‰ç­‰ã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•å¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³LLMè§£ç è¿‡ç¨‹æ˜¯å—åˆ¶äºè®¿å­˜å¸¦å®½çš„é—®é¢˜ã€‚ æŠ•æœºé‡‡æ ·æ˜¯ä¸€ç§å¯ä»¥ä»æ ¹æœ¬ä¸Šè§£ç è®¡ç®—è®¿å­˜æ¯”çš„æ–¹æ³•ï¼Œä¿è¯å’Œä½¿ç”¨åŸå§‹æ¨¡å‹çš„é‡‡æ ·åˆ†å¸ƒå®Œå…¨ç›¸åŒã€‚å®ƒä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹ï¼šä¸€ä¸ªæ˜¯åŸå§‹ç›®æ ‡æ¨¡å‹ï¼Œå¦ä¸€ä¸ªæ˜¯æ¯”åŸå§‹æ¨¡å‹å°å¾—å¤šçš„è¿‘ä¼¼æ¨¡å‹ã€‚è¿‘ä¼¼æ¨¡å‹ç”¨äºè¿›è¡Œè‡ªå›å½’ä¸²è¡Œé‡‡æ ·ï¼Œè€Œå¤§å‹æ¨¡å‹åˆ™ç”¨äºè¯„ä¼°é‡‡æ ·ç»“æœã€‚è§£ç è¿‡ç¨‹ä¸­ï¼ŒæŸäº›tokençš„è§£ç ç›¸å¯¹å®¹æ˜“ï¼ŒæŸäº›tokençš„è§£ç åˆ™å¾ˆå›°éš¾ã€‚å› æ­¤ï¼Œç®€å•çš„tokenç”Ÿæˆå¯ä»¥äº¤ç»™å°å‹æ¨¡å‹å¤„ç†ï¼Œè€Œå›°éš¾çš„tokenåˆ™äº¤ç»™å¤§å‹æ¨¡å‹å¤„ç†ã€‚è¿™é‡Œçš„å°å‹æ¨¡å‹å¯ä»¥é‡‡ç”¨ä¸åŸå§‹æ¨¡å‹ç›¸åŒçš„ç»“æ„ï¼Œä½†å‚æ•°æ›´å°‘ï¼Œæˆ–è€…å¹²è„†ä½¿ç”¨n-gramæ¨¡å‹ã€‚å°å‹æ¨¡å‹ä¸ä»…è®¡ç®—é‡è¾ƒå°ï¼Œæ›´é‡è¦çš„æ˜¯å‡å°‘äº†å†…å­˜è®¿é—®çš„éœ€æ±‚ã€‚ ## é‡‡æ ·è¿‡ç¨‹ æŠ•æœºé‡‡æ ·è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨å°æ¨¡å‹Mqåšè‡ªå›å½’é‡‡æ ·è¿ç»­ç”ŸæˆÂ Î³Â ä¸ªtokensã€‚ æŠŠç”Ÿæˆçš„Î³ä¸ªtokenså’Œå‰ç¼€æ‹¼æ¥ä¸€èµ·é€è¿›å¤§æ¨¡Mpæ‰§è¡Œä¸€æ¬¡forwardsã€‚ ä½¿ç”¨å¤§ã€å°æ¨¡å‹logitsç»“æœåšæ¯”å¯¹ï¼Œå¦‚æœå‘ç°æŸä¸ªtokenå°æ¨¡å‹ç”Ÿæˆçš„ä¸å¥½ï¼Œé‡æ–°é‡‡æ ·è¿™ä¸ªtokenã€‚é‡å¤æ­¥éª¤1ã€‚ å¦‚æœå°æ¨¡å‹ç”Ÿæˆç»“æœéƒ½æ»¡æ„ï¼Œåˆ™ç”¨å¤§æ¨¡å‹é‡‡æ ·ä¸‹ä¸€ä¸ªtokenã€‚é‡å¤æ­¥éª¤1ã€‚ ç¬¬2æ­¥ï¼Œå°†Î³ä¸ªtokenså’Œå‰ç¼€æ‹¼æˆä¸€èµ·ä½œä¸ºå¤§æ¨¡å‹è¾“å…¥ï¼Œå’Œè‡ªå›å½’ç›¸æ¯”ï¼Œå°½ç®¡è®¡ç®—é‡ä¸€æ ·ï¼Œä½†æ˜¯Î³ä¸ªtokenså¯ä»¥åŒæ—¶å‚ä¸è®¡ç®—ï¼Œè®¡ç®—è®¿å­˜æ¯”æ˜¾è‘—æå‡ã€‚ ç¬¬3æ­¥ï¼Œå¦‚ä½•è¯„ä»·ä¸€ä¸ªtokenç”Ÿæˆçš„ä¸å¥½ï¼Ÿå¦‚æœq(x) \u003e p(x)ï¼ˆpï¼Œqè¡¨ç¤ºåœ¨å¤§å°æ¨¡å‹é‡‡æ ·æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯logit","date":"2024-09-05","objectID":"/generate%E7%9B%B8%E5%85%B3/:0:0","tags":["LLM","generate"],"title":"frequency_penalty\u0026presence_penalty","uri":"/generate%E7%9B%B8%E5%85%B3/"},{"categories":["","LLM"],"content":"çº¿æ€§Transformer \\[V_i'=\\frac{\\sum_{j=1}^N sim(Q_i,K_j)V_j}{\\sum_{j=1}^N sim(Q_i,K_j)}\\] æ³¨æ„ä¸‹æ ‡iã€‚ å…¶ä¸­ \\[sim(Q_{i},K_{j})=\\phi(Q_{i},K_{j})\\] æ­¤æ—¶æœ‰ï¼š \\[V_{i}^{\\prime}=\\frac{\\phi(Q_{i})\\sum_{j=1}^{i}\\phi(K_{j})^{T}V_{j}}{\\phi(Q_{i})\\sum_{j=1}^{i}\\phi(K_{j})^{T}}\\] æ³¨æ„å¯ä»¥å°†\\(\\phi(Q_{i})\\)æå‡ºæ¥ã€‚ åŸå§‹Transformerçš„è®¡ç®—å¤æ‚åº¦éšåºåˆ—é•¿Nå‘ˆäºŒæ¬¡æ–¹å¢é•¿ï¼Œè¿™æ˜¯å› ä¸ºattentionçš„è®¡ç®—åŒ…å«ä¸¤å±‚forå¾ªç¯ï¼Œå¤–å±‚æ˜¯å¯¹äºæ¯ä¸€ä¸ªQueryï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å®ƒå¯¹åº”tokençš„æ–°è¡¨å¾ï¼›å†…å±‚forå¾ªç¯æ˜¯ä¸ºäº†è®¡ç®—æ¯ä¸€ä¸ªQueryå¯¹åº”çš„æ–°è¡¨å¾ï¼Œéœ€è¦è®©è¯¥Queryä¸æ¯ä¸€ä¸ªKeyè¿›è¡Œè®¡ç®—ã€‚ æ‰€ä»¥å¤–å±‚æ˜¯ for q in Queriesï¼Œå†…å±‚æ˜¯ for k in Keysã€‚Queriesæ•°é‡å’ŒKeysæ•°é‡éƒ½æ˜¯Nï¼Œæ‰€ä»¥å¤æ‚åº¦æ˜¯ O(N^2) ã€‚è€ŒLinear Transformerï¼Œå®ƒåªæœ‰å¤–å±‚for q in Queriesè¿™ä¸ªå¾ªç¯äº†ã€‚å› ä¸ºæ±‚å’Œé¡¹çš„è®¡ç®—ä¸iæ— å…³ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ Qi å¯ä»¥å…±äº«æ±‚å’Œé¡¹çš„å€¼ã€‚æ¢è¨€ä¹‹ï¼Œæ±‚å’Œé¡¹çš„å€¼å¯ä»¥åªè®¡ç®—ä¸€æ¬¡ï¼Œç„¶åå­˜åœ¨å†…å­˜ä¸­ä¾›æ‰€æœ‰ Qi å»ä½¿ç”¨ã€‚æ‰€ä»¥Linear Transformerçš„è®¡ç®—å¤æ‚åº¦æ˜¯O(N) ã€‚ Attention Free Transformer \\[V_i'=\\sigma(Q_i)\\odot\\frac{\\sum_{j-1}^iexp(K_j+w_{i,j})\\odot V_j}{\\sum_{j=1}^iexp(K_j+w_{i,j})}\\] å…¶ä¸­Ïƒæ˜¯sigmoidå‡½æ•°\\(^{+};\\odot\\)æ˜¯é€å…ƒç´ ç›¸ä¹˜ (element-wise product); wi,jæ˜¯å¾…è®­ç»ƒçš„å‚æ•°ã€‚ AFTé‡‡ç”¨çš„å½¢å¼å’Œä¸Šé¢çš„Linear Transformerä¸ä¸€æ ·ã€‚é¦–å…ˆæ˜¯attention score, Linear Transformerä»ç„¶æ˜¯åŒTransformerä¸€æ ·ï¼Œä¸ºæ¯ä¸€ä¸ªValueèµ‹äºˆä¸€ä¸ªweightã€‚è€ŒAFTä¼šä¸ºæ¯ä¸ª dimension\\(^{+}\\)èµ‹äºˆweightã€‚æ¢è¨€ä¹‹ï¼Œåœ¨Linear Transformerä¸­ï¼ŒåŒä¸€ä¸ªValueä¸­ä¸åŒdimensionçš„weightæ˜¯ä¸€è‡´çš„ï¼›è€ŒAFTåŒä¸€Valueä¸­ä¸åŒdimensionçš„weightä¸åŒ(\\(w_{i,j}\\))ã€‚æ­¤å¤–ï¼Œattention scoreçš„è®¡ç®—ä¹Ÿå˜å¾—æ ¼å¤–ç®€å•ï¼Œç”¨Kå»åŠ ä¸€ä¸ªå¯è®­ç»ƒçš„bias\\(^{+}\\)ã€‚Qçš„ç”¨æ³•å¾ˆåƒä¸€ä¸ªgateã€‚ å¯ä»¥å¾ˆå®¹æ˜“ä»¿ç…§å…¬å¼(5)æŠŠAFTä¹Ÿå†™æˆé€’å½’å½¢å¼ï¼Œè¿™æ ·å®¹æ˜“çœ‹å‡ºï¼ŒAFTä¹Ÿå¯ä»¥åƒLinear Transformer,åœ¨inferenceé˜¶æ®µå¤ç”¨å‰é¢æ—¶åˆ»çš„è®¡ç®—ç»“æœï¼Œè¡¨ç°å¦‚RNNå½¢å¼ï¼Œä»è€Œç›¸æ¯”äº Transformerå˜å¾—æ›´åŠ é«˜æ•ˆã€‚ RWKV RWKVçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ”¹é€ AFTï¼Œé€šè¿‡Liner Transformerå˜æ¢å°†self-attentionå¤æ‚åº¦ç”±O(N^2)é™ä¸º O(N) ã€‚ ä¿ç•™AFTç®€å•çš„â€œattentionâ€å½¢å¼å’ŒSequential Decodingï¼Œå…·æœ‰RNNè¡¨ç°å½¢å¼ã€‚ ","date":"2024-09-04","objectID":"/rwkv/:0:0","tags":["LLM","rwkv"],"title":"rwkv","uri":"/rwkv/"},{"categories":["","LLM"],"content":"Time-Mixing image.png def time_mixing(x, last_x, last_num, last_den, decay, bonus, mix_k, mix_v, mix_r, Wk, Wv, Wr, Wout): k = Wk @ ( x * mix_k + last_x * (1 - mix_k) ) v = Wv @ ( x * mix_v + last_x * (1 - mix_v) ) r = Wr @ ( x * mix_r + last_x * (1 - mix_r) ) wkv = (last_num + exp(bonus + k) * v) / \\ (last_den + exp(bonus + k)) rwkv = sigmoid(r) * wkv num = exp(-exp(decay)) * last_num + exp(k) * v den = exp(-exp(decay)) * last_den + exp(k) return Wout @ rwkv, (x,num,den) ","date":"2024-09-04","objectID":"/rwkv/:1:0","tags":["LLM","rwkv"],"title":"rwkv","uri":"/rwkv/"},{"categories":["","LLM"],"content":"Channel-Mixing image.png def channel_mixing(x, last_x, mix_k, mix_r, Wk, Wr, Wv): k = Wk @ ( x * mix_k + last_x * (1 - mix_k) ) r = Wr @ ( x * mix_r + last_x * (1 - mix_r) ) vk = Wv @ np.maximum(k, 0)**2 return sigmoid(r) * vk, x å‚è€ƒ How the RWKV language model works | The Good Minima (johanwind.github.io) ","date":"2024-09-04","objectID":"/rwkv/:2:0","tags":["LLM","rwkv"],"title":"rwkv","uri":"/rwkv/"},{"categories":["","LLM"],"content":"è¯æ˜ æ ¸å¿ƒæ€æƒ³å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªè½¬æ¢ï¼Œå¯ä»¥é€šè¿‡ç‚¹ç§¯æ“ä½œå°†ä½ç½®ä¿¡æ¯æ³¨å…¥ï¼Œå³ï¼š \\[\u003cf_q\\left(x_m,m\\right),f_k\\left(x_n,n\\right)\u003e=g\\left(x_m,x_n,m-n\\right)\\] è€Œé€šè¿‡å¤æ•°çš„ä¸€äº›æ€§è´¨ï¼Œæ‰¾åˆ°äº†æ»¡è¶³ä¸Šè¿°æ“ä½œçš„è½¬æ¢ï¼š \\[\\begin{aligned} \u0026f_{q}\\left(\\boldsymbol{x}_{m},m\\right)=\\left(\\boldsymbol{W}_{q}\\boldsymbol{x}_{m}\\right)e^{im\\theta} \\\\ \u0026f_{k}\\left(\\boldsymbol{x}_{n},n\\right)=\\left(\\boldsymbol{W}_{k}\\boldsymbol{x}_{n}\\right)e^{in\\theta} \\\\ \u0026g\\left(\\boldsymbol{x}_{m},\\boldsymbol{x}_{n},m-n\\right)=\\mathrm{Re}\\left[\\left(\\boldsymbol{W}_{q}\\boldsymbol{x}_{m}\\right)\\left(\\boldsymbol{W}_{k}\\boldsymbol{x}_{n}\\right)^{*}e^{i(m-n)\\theta}\\right] \\end{aligned}\\] å¯ä»¥å‘ç°gå‡½æ•°ä¸­å­˜åœ¨ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚ æ¬§æ‹‰å…¬å¼ï¼š\\(e^{ix}=\\cos x+i\\sin x\\) \\[\\begin{aligned}\u0026\\text{åŸºäºä¸Šé¢é¢1ç‚¹ç»“è®º,å¯çŸ¥}\\\\\u0026f_{q}\\left(x_{m},m\\right)=\\left(W_{q}x_{m}\\right)e^{im\\theta}=q_{m}e^{im\\theta}\\\\\u0026\\text{ç„¶åå°†}q_{m\\text{è¡¨ç¤ºæˆå¤æ•°å½¢å¼ï¼ˆtorch.view\\_as\\_complexï¼‰,å¯å¾—}}\\\\\u0026q_{m}=\\left[q_{m}^{(1)},q_{m}^{(2)}\\right]=\\left[q_{m}^{(1)}+iq_{m}^{(2)}\\right]\\\\\u0026\\text{ä»è€Œæœ‰}\\\\\u0026f_{q}\\left(x_{m},m\\right)=q_{m}e^{im\\theta}=\\left[q_{m}^{(1)}+iq_{m}^{(2)}\\right]e^{im\\theta}\\\\\u0026\\text{åŸºäºæ¬§æ‹‰å…¬å¼,å¯çŸ¥}f_{q}\\left(x_{m},m\\right)_{\\text{å³æ˜¯ä¸¤ä¸ªå¤æ•°ç›¸ä¹˜}}\\\\\u0026f_{q}\\left(x_{m},m\\right)=q_{m}e^{im\\theta}=\\left(q_{m}^{(1)}+iq_{m}^{(2)}\\right)*\\left(\\cos(m\\theta)+i\\sin(m\\theta)\\right)\\end{aligned}\\] æ ¹æ®å¤æ•°çš„è®¡ç®—ï¼Œå¯å¾—ï¼š \\[\\begin{aligned}q_{m}e^{im\\theta}=\\left(q_{m}^{(1)}+iq_{m}^{(2)}\\right)*(\\cos(m\\theta)+i\\sin(m\\theta))\\\\=\\left(q_{m}^{(1)}\\cos(m\\theta) -q_{m}^{(2)}\\sin(m\\theta)\\right)+i\\left(q_{m}^{(2)}\\cos(m\\theta)+q_{m}^{(1)}\\sin(m\\theta)\\right)\\end{aligned}\\] å†å°†ç»“æœå†™æˆå‘é‡çš„å½¢å¼ï¼Œå³ï¼š \\[q_{m}e^{im\\theta}=\\left[q_{m}^{(1)}\\cos(m\\theta)-q_{m}^{(2)}\\sin(m\\theta),q_{m}^{(2)}\\cos(m\\theta)+q_{m}^{(1)}\\sin(m\\theta)\\right]\\] å³æ˜¯queryå‘é‡ä¹˜äº†ä¸€ä¸ªæ—‹è½¬çŸ©é˜µï¼š \\[\\begin{gathered} f_{q}\\left(x_{m},m\\right)=\\left(W_{q}x_{m}\\right)e^{im\\theta}=q_{m}e^{im\\theta} \\\\ =\\left|q_{m}^{(1)}\\cos(m\\theta)-q_{m}^{(2)}\\sin(m\\theta),q_{m}^{(2)}\\cos(m\\theta)+q_{m}^{(1)}\\sin(m\\theta)\\right| \\\\ =\\left(\\begin{array}{cc}{\\cos(m\\theta)}\u0026{-\\sin(m\\theta)}\\\\{\\sin(m\\theta)}\u0026{\\cos(m\\theta)}\\end{array}\\right)\\left(\\begin{array}{c}{q_{m}^{(1)}}\\\\{q_{m}^{(2)}}\\end{array}\\right) \\end{gathered}\\] åç»­çš„è¯æ˜çœ‹ä¸€æ–‡é€šé€ä½ç½®ç¼–ç ï¼šä»æ ‡å‡†ä½ç½®ç¼–ç ã€æ—‹è½¬ä½ç½®ç¼–ç RoPEåˆ°ALiBiã€LLaMA 2 Long(å«NTK-awareç®€ä»‹)-CSDNåšå®¢ å°†äºŒç»´æ¨å¹¿ï¼Œæœ‰ï¼š \\[\\boldsymbol{R}_{\\Theta,m}^{d}=\\underbrace{\\left(\\begin{array}{ccccccc}{\\cos m\\theta_{0}}\u0026{-\\sin m\\theta_{0}}\u0026{0}\u0026{0}\u0026{\\cdots}\u0026{0}\u0026{0}\\\\{\\sin m\\theta_{0}}\u0026{\\cos m\\theta_{0}}\u0026{0}\u0026{0}\u0026{\\cdots}\u0026{0}\u0026{0}\\\\{0}\u0026{0}\u0026{\\cos m\\theta_{1}}\u0026{-\\sin m\\theta_{1}}\u0026{\\cdots}\u0026{0}\u0026{0}\\\\{0}\u0026{0}\u0026{\\sin m\\theta_{1}}\u0026{\\cos m\\theta_{1}}\u0026{\\cdots}\u0026{0}\u0026{0}\\\\{\\vdots}\u0026{\\vdots}\u0026{\\vdots}\u0026{\\vdots}\u0026{\\ddots}\u0026{\\vdots}\u0026{\\vdots}\\\\{0}\u0026{0}\u0026{0}\u0026{0}\u0026{\\cdots}\u0026{\\cos m\\theta_{d/2-1}}\u0026{-\\sin m\\theta_{d/2-1}}\\\\{0}\u0026{0}\u0026{0}\u0026{0}\u0026{0}\u0026{\\cdots}\u0026{\\sin m\\theta_{d/2-1}}\u0026{\\cos m\\theta_{d/2-1}}\\end{array}\\right)}\\] åˆ™è®¡ç®—æ—‹è½¬ç¼–ç ï¼Œå³æœ‰ï¼š \\[\\begin{bmatrix}\\cos m\\theta_0\u0026-\\sin m\\theta_0\u00260\u00260\u0026\\cdots\u00260\u00260\\\\\\sin m\\theta_0\u0026\\cos m\\theta_0\u00260\u00260\u0026\\cdots\u00260\u00260\\\\0\u00260\u0026\\cos m\\theta_1\u0026-\\sin m\\theta_1\u0026\\cdots\u00260\u00260\\\\0\u00260\u0026\\sin m\\theta_1\u0026\\cos m\\theta_1\u0026\\cdots\u00260\u00260\\\\\\vdots\u0026\\vdots\u0026\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\u0026\\vdots\\\\0\u00260\u00260\u00260\u0026\\cdots\u0026\\cos m\\theta_{d/2-1}\u0026-\\sin m\\theta_{d/2-1}\\\\0\u00260\u00260\u00260\u0026\\cdots\u0026\\sin m\\theta_{d/2-1}\u0026\\cos m\\theta_{d/2-1}\\end{bmatrix}\\begin{bmatrix}q_0\\\\q_1\\\\q_2\\\\q_3\\\\\\vdots\\\\q_{d-2}\\\\q_{d-1}\\end{bmatrix}\\] ç”±äºçŸ©é˜µå¤ªç¨€ç–ï¼Œä¼šé€ æˆæµªè´¹ï¼Œå› æ­¤è®¡ç®—æ—¶æ˜¯è¿™ä¹ˆåšçš„ï¼š \\[\\begin{bmatrix}q_0\\\\q_1\\\\q_2\\\\q_3\\\\\\vdots\\\\q_{d-2}\\\\q_{d-1}\\end{bmatrix}\\otimes\\begin{bmatrix}\\cos m\\theta_0\\\\\\cos m\\theta_0\\\\\\cos m\\theta_1\\\\\\cos m\\theta_1\\\\\\vdots\\\\\\cos m\\theta_{d/2-1}\\\\\\cos m\\theta_{d/2-1}\\end{bmatrix}+\\begin{bmatrix}-q_1\\\\q_0\\\\-q_3\\\\q_2\\\\\\vdots\\\\-q_{d-1}\\\\q_{d-2}\\end{bmatrix}\\otimes\\begin{bmatrix}\\sin m\\theta_0\\\\\\sin m\\theta_0\\\\\\sin m\\theta_1\\\\\\sin m\\theta_1\\\\\\vdots\\\\\\sin m\\theta_{d/2-1}\\\\\\sin m\\theta_{d/2-1}\\end{bmatrix}\\] æ­¤å¤–ï¼Œè§’åº¦çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š \\[\\theta_j=10000^{-2j/d},j\\in[1,2,\\dots,d/2]\\] ä»£ç  ","date":"2024-08-31","objectID":"/rope/:0:0","tags":["LLM"],"title":"rope","uri":"/rope/"},{"categories":["","LLM"],"content":"llamaå®ç° llamaå®ç°æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¸€å¼€å§‹å¾ˆä¸å®¹æ˜“ç†è§£ï¼Œå®ç°å¦‚ä¸‹ï¼š def precompute_freqs_cis(dim: int, end: int, theta: float = 10000.0): \"\"\" Precompute the frequency tensor for complex exponentials (cis) with given dimensions. This function calculates a frequency tensor with complex exponentials using the given dimension 'dim' and the end index 'end'. The 'theta' parameter scales the frequencies. The returned tensor contains complex values in complex64 data type. Args: dim (int): Dimension of the frequency tensor. end (int): End index for precomputing frequencies. theta (float, optional): Scaling factor for frequency computation. Defaults to 10000.0. Returns: torch.Tensor: Precomputed frequency tensor with complex exponentials. \"\"\" # dim = 128 # end = 4096 # torch.arange(0, dim, 2) [0, 2, 4, 6, 8, 10,..., 124, 126] å…±64ä¸ª # torch.arange(0, dim, 2)[: (dim // 2)] ä¿è¯æ˜¯64ä¸ª freqs = 1.0 / (theta ** (torch.arange(0, dim, 2)[: (dim // 2)].float() / dim)) # ropeä¸­çš„è§’åº¦ # freqs = [1/10000.0^(0/128), 1/10000.0^(2/128), 1/10000.0^(4/128), ..., 1/10000.0^(126/128)] t = torch.arange(end, device=freqs.device) # postition idx # t = [0, 1, 2, ..., 4095] freqs = torch.outer(t, freqs).float() # type: ignore # freqs å¾—åˆ° freqså’Œtçš„ç¬›å¡å°”ç§¯ï¼Œç»´åº¦ä¸ºï¼ˆ4096ï¼Œ64ï¼‰ # freqs = [[0, 0, 0,..., 0], # [1/10000.0^(0/128), 1/10000.0^(2/128), 1/10000.0^(4/128), ..., 1/10000.0^(126/128)], # [2/10000.0^(0/128), 2/10000.0^(2/128), 2/10000.0^(4/128), ..., 2/10000.0^(126/128)], # ..., # [4095/10000.0^(0/128), 4095/10000.0^(2/128), 4095/10000.0^(4/128), ..., 4095/10000.0^(126/128)]] freqs_cis = torch.polar(torch.ones_like(freqs), freqs) # complex64 # freqs_cisçš„ç»´åº¦ä¸º(4096,64)ï¼Œç›¸å½“äºåŠå¾„ä¸º1ï¼Œè§’åº¦ä¸ºfreqsçš„æåæ ‡çš„å¤æ•°è¡¨ç¤ºï¼Œå¦‚å…¬å¼6æ‰€ç¤ºã€‚ return freqs_cis def reshape_for_broadcast(freqs_cis: torch.Tensor, x: torch.Tensor): # å°†é™¤äº†positionå’Œdimå…¶ä»–çš„ç»´åº¦å˜ä¸º1 \"\"\" Reshape frequency tensor for broadcasting it with another tensor. This function reshapes the frequency tensor to have the same shape as the target tensor 'x' for the purpose of broadcasting the frequency tensor during element-wise operations. Args: freqs_cis (torch.Tensor): Frequency tensor to be reshaped. x (torch.Tensor): Target tensor for broadcasting compatibility. Returns: torch.Tensor: Reshaped frequency tensor. Raises: AssertionError: If the frequency tensor doesn't match the expected shape. AssertionError: If the target tensor 'x' doesn't have the expected number of dimensions. \"\"\" # freqs_cis.shape = [1024, 64] # x.shape = [2, 1024, 32, 64] ndim = x.ndim assert 0 \u003c= 1 \u003c ndim assert freqs_cis.shape == (x.shape[1], x.shape[-1]) # å°†freqs_cis.shapeå˜ä¸º[1, 1024, 1, 64] shape = [d if i == 1 or i == ndim - 1 else 1 for i, d in enumerate(x.shape)] return freqs_cis.view(*shape) def apply_rotary_emb( xq: torch.Tensor, xk: torch.Tensor, freqs_cis: torch.Tensor, ): \"\"\" Apply rotary embeddings to input tensors using the given frequency tensor. This function applies rotary embeddings to the given query 'xq' and key 'xk' tensors using the provided frequency tensor 'freqs_cis'. The input tensors are reshaped as complex numbers, and the frequency tensor is reshaped for broadcasting compatibility. The resulting tensors contain rotary embeddings and are returned as real tensors. Args: xq (torch.Tensor): Query tensor to apply rotary embeddings. xk (torch.Tensor): Key tensor to apply rotary embeddings. freqs_cis (torch.Tensor): Precomputed frequency tensor for complex exponentials. Returns: Tuple[torch.Tensor, torch.Tensor]: Tuple of modified query tensor and key tensor with rotary embeddings. \"\"\" # å°†xqå’Œxkçš„æœ€åä¸€ä¸ªç»´åº¦è¿›è¡Œå¤æ•°è¿ç®—ï¼Œå¾—åˆ°æ–°çš„xqå’Œxk # ä¸ºäº†è¿›è¡Œå¤æ•°è¿ç®—ï¼Œéœ€è¦å°†xqå’Œxkçš„æœ€åä¸€ä¸ªç»´åº¦å±•å¼€ä¸º2ç»´ # ä¾‹å¦‚ï¼Œxqçš„å½¢çŠ¶ä¸º[2, seq_len, 32, 128], reshapeåä¸º[2, seq_len, 32 , 64, 2] # view_as_complexå‡½æ•°å¯ä»¥å°†å¼ é‡ä¸­çš„æœ€åä¸€ç»´çš„ä¸¤ä¸ªå…ƒç´ ä½œä¸ºå®éƒ¨å’Œè™šéƒ¨åˆæˆä¸€ä¸ªå¤æ•°xqçš„å½¢çŠ¶å˜ä¸º[2, seq_len, 32, 64] xq_ = torch.view_as_complex(xq.float().reshape(*xq.shape[:-1], -1, 2)) xk_ = torch.view_as_complex(xk.float().reshape(*xk.shape[:-1], -1, 2)) # å°†freqs_ciså¹¿æ’­åˆ°xqå’Œxkçš„æœ€åä¸€ä¸ªç»´åº¦ freqs_cis = reshape_for_broadcast(freqs_cis, xq_) # freqs_cis.shape = [1, 1024, 1, 64] # view_as_realå’Œview_as_complexç›¸åï¼Œå¯ä»¥å°†å¼ é‡ä¸­æœ€åä¸€ç»´çš„å¤æ•°æ‹†å‡ºå®éƒ¨å’Œè™šéƒ¨ # (xq_ ","date":"2024-08-31","objectID":"/rope/:1:0","tags":["LLM"],"title":"rope","uri":"/rope/"},{"categories":["","LLM"],"content":"å¦ä¸€ç§å®ç° å¦ä¸€ç§å®ç°(transformers)åˆ©ç”¨äº†ä¸‹é¢è¿™ä¸ªå¼å­ï¼š \\[ \\begin{bmatrix}q_0\\\\q_1\\\\q_2\\\\q_3\\\\\\vdots\\\\q_{d-2}\\\\q_{d-1}\\end{bmatrix}\\otimes\\begin{bmatrix}\\cos m\\theta_0\\\\\\cos m\\theta_0\\\\\\cos m\\theta_1\\\\\\cos m\\theta_1\\\\\\vdots\\\\\\cos m\\theta_{d/2-1}\\\\\\cos m\\theta_{d/2-1}\\end{bmatrix}+\\begin{bmatrix}-q_1\\\\q_0\\\\-q_3\\\\q_2\\\\\\vdots\\\\-q_{d-1}\\\\q_{d-2}\\end{bmatrix}\\otimes\\begin{bmatrix}\\sin m\\theta_0\\\\\\sin m\\theta_0\\\\\\sin m\\theta_1\\\\\\sin m\\theta_1\\\\\\vdots\\\\\\sin m\\theta_{d/2-1}\\\\\\sin m\\theta_{d/2-1}\\end{bmatrix} \\] class LlamaRotaryEmbedding(torch.nn.Module): def __init__(self, dim, max_position_embeddings=2048, base=10000, device=None): super().__init__() inv_freq = 1.0 / (base ** (torch.arange(0, dim, 2).float().to(device) / dim)) self.register_buffer(\"inv_freq\", inv_freq) # Build here to make `torch.jit.trace` work. self.max_seq_len_cached = max_position_embeddings t = torch.arange(self.max_seq_len_cached, device=self.inv_freq.device, dtype=self.inv_freq.dtype) freqs = torch.einsum(\"i,j-\u003eij\", t, self.inv_freq) # Different from paper, but it uses a different permutation # in order to obtain the same calculation emb = torch.cat((freqs, freqs), dim=-1) dtype = torch.get_default_dtype() self.register_buffer(\"cos_cached\", emb.cos()[None, None, :, :].to(dtype), persistent=False) self.register_buffer(\"sin_cached\", emb.sin()[None, None, :, :].to(dtype), persistent=False) def forward(self, x, seq_len=None): # x: [bs, num_attention_heads, seq_len, head_size] # This `if` block is unlikely to be run after we build sin/cos in `__init__`. # Keep the logic here just in case. if seq_len \u003e self.max_seq_len_cached: self.max_seq_len_cached = seq_len t = torch.arange(self.max_seq_len_cached, device=x.device, dtype=self.inv_freq.dtype) freqs = torch.einsum(\"i,j-\u003eij\", t, self.inv_freq) # Different from paper, but it uses a different permutation # in order to obtain the same calculation emb = torch.cat((freqs, freqs), dim=-1).to(x.device) self.register_buffer(\"cos_cached\", emb.cos()[None, None, :, :].to(x.dtype), persistent=False) self.register_buffer(\"sin_cached\", emb.sin()[None, None, :, :].to(x.dtype), persistent=False) return ( self.cos_cached[:, :, :seq_len, ...].to(dtype=x.dtype), self.sin_cached[:, :, :seq_len, ...].to(dtype=x.dtype), ) def rotate_half(x): \"\"\"Rotates half the hidden dims of the input.\"\"\" x1 = x[..., : x.shape[-1] // 2] x2 = x[..., x.shape[-1] // 2 :] return torch.cat((-x2, x1), dim=-1) def apply_rotary_pos_emb(q, k, cos, sin, position_ids): # The first two dimensions of cos and sin are always 1, so we can `squeeze` them. cos = cos.squeeze(1).squeeze(0) # [seq_len, dim] sin = sin.squeeze(1).squeeze(0) # [seq_len, dim] cos = cos[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] sin = sin[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] q_embed = (q * cos) + (rotate_half(q) * sin) k_embed = (k * cos) + (rotate_half(k) * sin) return q_embed, k_embed ç›¸å¯¹äºllamaçš„ç‰ˆæœ¬æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ Long-term decay of RoPE å…¬å¼ä¸çœ‹äº†ï¼Œç»“è®ºå°±æ˜¯RoPEæœ‰é•¿è·ç¦»è¡°å‡çš„ç‰¹æ€§ï¼Œç›¸å¯¹è·ç¦»è¶Šè¿œçš„tokenä¹‹é—´çš„å…³æ³¨åº¦ä¹Ÿä¼šé™ä½ï¼Œè¡¨ç°ä¸ºattention scoreå‡å°ï¼Œè¿™æ˜¯ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ã€‚â€This property coincides with the intuition that a pair of tokens with a long relative distance should have less connection.â€œ # å‚è€ƒ ä¸€æ–‡é€šé€ä½ç½®ç¼–ç ï¼šä»æ ‡å‡†ä½ç½®ç¼–ç ã€æ—‹è½¬ä½ç½®ç¼–ç RoPEåˆ°ALiBiã€LLaMA 2 Long(å«NTK-awareç®€ä»‹)-CSDNåšå®¢ LLMâ€”llama2ç»“æ„å’Œæºç è§£è¯» - çŸ¥ä¹ (zhihu.com) ","date":"2024-08-31","objectID":"/rope/:2:0","tags":["LLM"],"title":"rope","uri":"/rope/"},{"categories":[""],"content":"KV cache LLMæ¨ç†è¿‡ç¨‹åˆ†ä¸ºPrefillå’ŒDecodeä¸¤ä¸ªé˜¶æ®µï¼Œå…¶ä¸­Prefillé˜¶æ®µä¼šå¯¹Promptä¸­æ‰€æœ‰çš„tokenåšå¹¶è¡Œè®¡ç®—ï¼Œå¾—åˆ°Promptä¸­æ‰€æœ‰Tokensçš„KV Cacheä»¥åŠè®¡ç®—å¾—åˆ°é¦–Tokenã€‚Prompté˜¶æ®µTokenè®¡ç®—å¾—åˆ°çš„KV Cacheä¼šä¿å­˜ä¸‹æ¥ï¼Œç•™ç»™Decodeé˜¶æ®µå¤ç”¨ï¼ŒDecodeé˜¶æ®µæ˜¯ä¸€ä¸ªè‡ªå›å½’è¿‡ç¨‹ï¼Œæ¯decodeä¸€ä¸ªæ–°çš„Tokenï¼Œéƒ½éœ€è¦ç”¨åˆ°æ‰€æœ‰ä¹‹å‰è®¡ç®—å¾—åˆ°çš„KV Cacheæ¥è®¡ç®—å½“å‰query tokençš„Attentionã€‚å› æ­¤ï¼Œå½“è¾“å‡ºé•¿åº¦è¶Šæ¥è¶Šå¤§æˆ–è€…contextå¾ˆé•¿æ—¶ï¼ŒKV Cacheå°†ä¼šå ç”¨å¤§é‡çš„æ˜¾å­˜ã€‚å¦‚ä½•ä¼˜åŒ–KV Cacheçš„æ˜¾å­˜å ç”¨ï¼Œä¸€ç›´éƒ½æ˜¯LLMæ¨ç†çš„æ ¸å¿ƒä¸»é¢˜ä¹‹ä¸€ã€‚ ä¹‹å‰ä¸€ç›´ç–‘æƒ‘kv cacheæ—¢ç„¶æ¯æ¬¡åªè¾“å…¥ç”Ÿæˆtokenå°±å¯ä»¥ï¼Œé‚£ä¹ˆä½ç½®ä¿¡æ¯è¯¥æ€ä¹ˆæ³¨å…¥å‘¢ï¼Ÿç¿»äº†ç¿»llamaçš„æºç ï¼Œæ‰¾åˆ°äº†ç­”æ¡ˆï¼š def forward(self, tokens: torch.Tensor, start_pos: int): \"\"\" Perform a forward pass through the Transformer model. Args: tokens (torch.Tensor): Input token indices. start_pos (int): Starting position for attention caching. Returns: torch.Tensor: Output logits after applying the Transformer model. \"\"\" _bsz, seqlen = tokens.shape h = self.tok_embeddings(tokens) self.freqs_cis = self.freqs_cis.to(h.device) freqs_cis = self.freqs_cis[start_pos : start_pos + seqlen] mask = None if seqlen \u003e 1: mask = torch.full( (seqlen, seqlen), float(\"-inf\"), device=tokens.device ) mask = torch.triu(mask, diagonal=1) # When performing key-value caching, we compute the attention scores # only for the new sequence. Thus, the matrix of scores is of size # (seqlen, cache_len + seqlen), and the only masked entries are (i, j) for # j \u003e cache_len + i, since row i corresponds to token cache_len + i. mask = torch.hstack([ torch.zeros((seqlen, start_pos), device=tokens.device), mask ]).type_as(h) for layer in self.layers: h = layer(h, start_pos, freqs_cis, mask) h = self.norm(h) output = self.output(h).float() return output æ³¨æ„freqs_cis = self.freqs_cis[start_pos : start_pos + seqlen]è¿™ä¸€è¡Œï¼Œå³æ˜¯å®ç°äº†ropeç›¸å¯¹ä½ç½®ç¼–ç çš„kv cacheçš„æ ¸å¿ƒã€‚ kv cacheä»£ç  def repeat_kv(x: torch.Tensor, n_rep: int) -\u003e torch.Tensor: \"\"\"torch.repeat_interleave(x, dim=2, repeats=n_rep)\"\"\" bs, slen, n_kv_heads, head_dim = x.shape if n_rep == 1: return x return ( x[:, :, :, None, :] .expand(bs, slen, n_kv_heads, n_rep, head_dim) .reshape(bs, slen, n_kv_heads * n_rep, head_dim) ) class Attention(nn.Module): \"\"\"Multi-head attention module.\"\"\" def __init__(self, args: ModelArgs): \"\"\" Initialize the Attention module. Args: args (ModelArgs): Model configuration parameters. Attributes: n_kv_heads (int): Number of key and value heads. n_local_heads (int): Number of local query heads. n_local_kv_heads (int): Number of local key and value heads. n_rep (int): Number of repetitions for local heads. head_dim (int): Dimension size of each attention head. wq (ColumnParallelLinear): Linear transformation for queries. wk (ColumnParallelLinear): Linear transformation for keys. wv (ColumnParallelLinear): Linear transformation for values. wo (RowParallelLinear): Linear transformation for output. cache_k (torch.Tensor): Cached keys for attention. cache_v (torch.Tensor): Cached values for attention. \"\"\" super().__init__() self.n_kv_heads = args.n_heads if args.n_kv_heads is None else args.n_kv_heads model_parallel_size = fs_init.get_model_parallel_world_size() self.n_local_heads = args.n_heads // model_parallel_size self.n_local_kv_heads = self.n_kv_heads // model_parallel_size self.n_rep = self.n_local_heads // self.n_local_kv_heads self.head_dim = args.dim // args.n_heads self.wq = ColumnParallelLinear( args.dim, args.n_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wk = ColumnParallelLinear( args.dim, self.n_kv_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wv = ColumnParallelLinear( args.dim, self.n_kv_heads * self.head_dim, bias=False, gather_output=False, init_method=lambda x: x, ) self.wo = RowParallelLinear( args.n_heads * self.head_dim, args.dim, bias=False, input_is_parallel=True, init_method=lambda x: x, ) # kv_cacheæ˜¯ç¼“å­˜é”®å€¼å¯¹ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªä¿å­˜æœ€è¿‘nä¸ªé”®å€¼å¯¹ self.cache_k = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() self.cache_v = torch.zeros( ( args.max_batch_size, args.max_seq_len, self.n_local_kv_heads, self.head_dim, ) ).cuda() def forward( self, x: torch.Tensor, start_pos: int, freqs_cis: torch.Tensor, mask: Optional[","date":"2024-08-07","objectID":"/kv-cache/:0:0","tags":null,"title":"KV cache","uri":"/kv-cache/"},{"categories":[""],"content":"prefillå’Œdecodeåˆ†ç¦» åœ¨ä¼ ç»Ÿçš„ LLM æ¨ç†æ¡†æ¶ä¸­ï¼ŒPrefillÂ å’ŒÂ DecodeÂ é˜¶æ®µé€šå¸¸ç”±åŒä¸€å— GPU æ‰§è¡Œã€‚æ¨ç†å¼•æ“çš„è°ƒåº¦å™¨ä¼šæ ¹æ®æ˜¾å­˜ä½¿ç”¨æƒ…å†µåŠè¯·æ±‚é˜Ÿåˆ—çŠ¶æ€ï¼Œåœ¨ Prefill å’Œ Decode ä¹‹é—´åˆ‡æ¢ï¼Œå®Œæˆæ•´ä¸ªæ¨ç†è¿‡ç¨‹ã€‚ è€Œåœ¨Â Prefill-Decode åˆ†ç¦»å¼æ¶æ„ï¼ˆä»¥ä¸‹ç®€ç§° PD åˆ†ç¦»å¼æ¶æ„ï¼‰ä¸­ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µè¢«æ‹†åˆ†åˆ°ä¸åŒçš„ GPU å®ä¾‹ä¸Šç‹¬ç«‹è¿è¡Œã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ˜¯ DistServe æä¾›çš„ä¸€å¼ æ¶æ„å›¾ï¼š åœ¨å¤§æ¨¡å‹æ¨ç†ä¸­ï¼Œå¸¸ç”¨ä»¥ä¸‹ä¸¤é¡¹æŒ‡æ ‡è¯„ä¼°æ€§èƒ½ï¼š TTFTï¼ˆTime-To-First-Tokenï¼‰ï¼šé¦– token çš„ç”Ÿæˆæ—¶é—´ï¼Œä¸»è¦è¡¡é‡ Prefill é˜¶æ®µæ€§èƒ½ã€‚ TPOTï¼ˆTime-Per-Output-Tokenï¼‰ï¼šç”Ÿæˆæ¯ä¸ª token çš„æ—¶é—´ï¼Œä¸»è¦è¡¡é‡ Decode é˜¶æ®µæ€§èƒ½ã€‚ å½“ Prefill å’Œ Decode åœ¨åŒä¸€å— GPU ä¸Šè¿è¡Œæ—¶ï¼Œç”±äºä¸¤é˜¶æ®µçš„è®¡ç®—ç‰¹æ€§å·®å¼‚ï¼ˆPrefill æ˜¯è®¡ç®—å¯†é›†å‹ï¼Œè€Œ Decode æ˜¯å­˜å‚¨å¯†é›†å‹ï¼‰ï¼Œèµ„æºäº‰æŠ¢ä¼šå¯¼è‡´Â TTFTÂ å’ŒÂ TPOTÂ ä¹‹é—´çš„æƒè¡¡ã€‚ä¾‹å¦‚ï¼š è‹¥ä¼˜å…ˆå¤„ç† Prefill é˜¶æ®µä»¥é™ä½ TTFTï¼ŒDecode é˜¶æ®µçš„æ€§èƒ½ï¼ˆTPOTï¼‰å¯èƒ½ä¸‹é™ã€‚ è‹¥å°½é‡æå‡ TPOTï¼Œåˆ™ä¼šå¢åŠ  Prefill è¯·æ±‚çš„ç­‰å¾…æ—¶é—´ï¼Œå¯¼è‡´ TTFT ä¸Šå‡ã€‚ PD åˆ†ç¦»å¼æ¶æ„çš„æå‡ºæ­£æ˜¯ä¸ºäº†æ‰“ç ´è¿™ä¸€çŸ›ç›¾ã€‚é€šè¿‡å°† Prefill å’Œ Decode åˆ†ç¦»è¿è¡Œï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒé˜¶æ®µçš„ç‰¹æ€§ç‹¬ç«‹ä¼˜åŒ–èµ„æºåˆ†é…ï¼Œä»è€Œåœ¨é™ä½é¦– token å»¶è¿Ÿçš„åŒæ—¶æé«˜æ•´ä½“ååé‡ã€‚ åœ¨ PD åˆ†ç¦»æ¶æ„ä¸­ï¼ŒPrefill å’Œ Decode é˜¶æ®µçš„èµ„æºéœ€æ±‚ä¸åŒï¼Œåˆ†åˆ«ä½“ç°ä¸ºï¼š Prefill é˜¶æ®µï¼šè®¡ç®—å¯†é›†å‹ï¼ˆcompute-boundï¼‰ã€‚åœ¨æµé‡è¾ƒå¤§æˆ–ç”¨æˆ·æç¤ºé•¿åº¦è¾ƒé•¿æ—¶ï¼ŒPrefill çš„è®¡ç®—å‹åŠ›æ›´å¤§ã€‚å®Œæˆ KV Cache çš„ç”Ÿæˆåï¼ŒPrefill é˜¶æ®µæœ¬èº«æ— éœ€ç»§ç»­ä¿ç•™è¿™äº›ç¼“å­˜ã€‚ Decode é˜¶æ®µï¼šå­˜å‚¨å¯†é›†å‹ï¼ˆmemory-boundï¼‰ã€‚ç”±äºé€ token ç”Ÿæˆçš„ç‰¹æ€§ï¼ŒDecode é˜¶æ®µéœ€é¢‘ç¹è®¿é—® KV Cacheï¼Œå› æ­¤éœ€è¦å°½å¯èƒ½å¤šåœ°ä¿ç•™ç¼“å­˜æ•°æ®ä»¥ä¿éšœæ¨ç†æ•ˆç‡ã€‚ Batching ç­–ç•¥å¯¹ä¸¤é˜¶æ®µçš„æ€§èƒ½å½±å“æ˜¾è‘—ï¼Œä½†è¶‹åŠ¿ç›¸åï¼š Prefill é˜¶æ®µï¼šååé‡éš batch size å¢åŠ é€æ¸è¶‹äºå¹³ç¨³ã€‚è¿™æ˜¯å› ä¸º Prefill çš„è®¡ç®—å—é™ç‰¹æ€§ï¼ˆcompute-boundï¼‰ï¼Œå½“ batch ä¸­çš„æ€» token æ•°è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œè®¡ç®—èµ„æºæˆä¸ºç“¶é¢ˆã€‚ Decode é˜¶æ®µï¼šååé‡éš batch size å¢åŠ æ˜¾è‘—æå‡ã€‚ç”±äº Decode é˜¶æ®µçš„å­˜å‚¨å—é™ç‰¹æ€§ï¼ˆmemory-boundï¼‰ï¼Œå¢å¤§ batch size å¯æé«˜è®¡ç®—æ•ˆç‡ï¼Œä»è€Œæ˜¾è‘—å¢åŠ ååé‡ã€‚ ","date":"2024-08-07","objectID":"/kv-cache/:1:0","tags":null,"title":"KV cache","uri":"/kv-cache/"},{"categories":[""],"content":"Chunked prefills image.png å¸¸è§é—®é¢˜ ","date":"2024-08-07","objectID":"/kv-cache/:2:0","tags":null,"title":"KV cache","uri":"/kv-cache/"},{"categories":[""],"content":"128k tokenè¾“å…¥éœ€è¦å¤šå°‘æ˜¾å­˜å­˜kv cache? image.png è¶…å‚æ•°å¦‚ä¸Šï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨int8ç²¾åº¦ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå‚æ•°å æ®ä¸€ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªtokenå æ®çš„kv cacheå¤§å°å°±æ˜¯ 2 * K * H * L = 2 (k å’Œ v) * 8 (n kv heads) * 128 (d_qkv) * 80 (n layers) * 1 (byte)= 160kB ï¼ˆè¿™é‡Œçš„ 2 æ˜¯å› ä¸ºæ¯ä¸ª token éœ€è¦å­˜å‚¨kå’Œvï¼‰ é‚£ä¹ˆ128kçš„kv cacheå°±æ˜¯ï¼š 162e3 * 128 * 1024 = 21.2GB éœ€è¦æ³¨æ„çš„æ˜¯ llama 3 ä½¿ç”¨çš„æ˜¯ gqaï¼Œæ‰€ä»¥ N ä¸º 64ï¼ŒK ä¸º 8. å¥—å…¬å¼å°±æ˜¯ ï¼ˆä½¿ç”¨ bf 16 å³ 2 bytesï¼‰ï¼š \\[ b(s+n)h*l*2*2 \\] å…¶ä¸­ b ä¸º batch_sizeï¼Œs ä¸ºè¾“å…¥åºåˆ—é•¿åº¦ï¼Œn ä¸ºè¾“å‡ºåºåˆ—é•¿åº¦ï¼Œh ä¸º k æˆ–è€… v çš„æ€»ç»´åº¦ï¼Œä¸åŒçš„ attention æ”¹å˜çš„æ˜¯è¿™ä¸ªä¸œè¥¿æ¥é™ä½æ˜¾å­˜ã€‚ å‚è€ƒ LLMâ€”llama2ç»“æ„å’Œæºç è§£è¯» - çŸ¥ä¹ (zhihu.com) # LLMæ¨ç†ä¼˜åŒ– - Chunked prefills # å›¾è§£å¤§æ¨¡å‹è®¡ç®—åŠ é€Ÿç³»åˆ—ï¼šåˆ†ç¦»å¼æ¨ç†æ¶æ„1ï¼Œä»DistServeè°ˆèµ· ","date":"2024-08-07","objectID":"/kv-cache/:3:0","tags":null,"title":"KV cache","uri":"/kv-cache/"},{"categories":[""],"content":"Low-Rank Adaption (LoRA)ï¼Œå³â€œä½ç§©é€‚é…â€ï¼Œå®ç°äº†é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œä¸”ä¸ä¼šå¢åŠ æ¨¡å‹çš„æ¨ç†å»¶è¿Ÿã€‚ ## å†…åœ¨ç»´åº¦ 2020å¹´ï¼ŒA. Aghajanyanç­‰äººç ”ç©¶äº†è¿™ä¸€ç°è±¡ï¼Œå‘ç°é¢„è®­ç»ƒæ¨¡å‹å­˜åœ¨ä¸€ä¸ªè¾ƒä½çš„â€å†…åœ¨ç»´åº¦â€,ä½¿ç”¨å°‘é‡æ ·æœ¬å¾®è°ƒæ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ›´æ–°ä½ç»´ç©ºé—´ä¸­çš„å‚æ•°ã€‚æŠŠé¢„è®­ç»ƒæ¨¡å‹çš„å…¨éƒ¨å‚æ•°çœ‹æˆä¸€ä¸ªDç»´å‚æ•°å‘é‡ï¼Œè®°ä¸º\\(\\Theta^\\mathrm{(D)}\\),æ¨¡å‹çš„åŸå§‹å‚æ•°ä¸º\\(\\Theta_0^\\mathrm{(D)}\\),è®¾\\(\\Theta^{(d)}\\)æ˜¯dç»´å­ç©ºé—´ä¸­çš„ä¸€ä¸ªå‘é‡ï¼Œd\u003cD,åˆ©ç”¨ä¸€ä¸ªå›ºå®šçš„D*dæ˜ å°„çŸ©é˜µP æŠŠdç»´ç©ºé—´ä¸­çš„å‘é‡æ˜ å°„åˆ°Dç»´ç©ºé—´ï¼Œ\\(\\Theta^{(\\mathrm{D})}\\)å¯å†™ä¸ºï¼š \\[\\mathrm{\\theta^{(D)}=\\theta_0^{(D)}+P\\theta^{(d)}}\\] ä¸‹å›¾ä¸­ï¼Œä»¥D=3,d=2ä¸ºä¾‹ï¼š å·¦å›¾ç›´æ¥åœ¨3ç»´ç©ºé—´ä¸­è®­ç»ƒæ¨¡å‹ï¼Œç›´æ¥ä¼˜åŒ–åŸå§‹æ¨¡å‹å‚æ•°\\(\\Theta_{0}^{(\\mathrm{D})}\\),æŠŠå®ƒæ›´æ–°ä¸º\\(\\Theta^{(\\mathrm{D})}\\)ã€‚å³å›¾å†»ç»“\\(\\Theta_{0}^{(\\mathrm{D})}\\),è½¬è€Œåœ¨2ç»´ç©ºé—´ä¸­å¯»æ‰¾ä¸€ä¸ª\\(\\Theta^{(\\mathrm{d})}\\),å†ç”¨çŸ©é˜µPæŠŠ\\(\\Theta^{(\\mathrm{d})}\\)æ˜ å°„åˆ°3ç»´ç©ºé—´ã€‚å¦‚æœç”¨å³å›¾çš„æ–¹å¼å¯ä»¥æŠŠæ¨¡å‹ä¼˜åŒ–åˆ°è‰¯å¥½çš„æ•ˆæœï¼Œä¾‹å¦‚ï¼Œè¾¾åˆ°äº†å…¨é‡å‚æ•°å¾®è°ƒæ•ˆæœçš„90%,åˆ™è¯¥æ¨¡å‹çš„å†…åœ¨ç»´åº¦\\(\\mathrm{d}_{90}=2\\)ã€‚ å®éªŒè¡¨æ˜ï¼Œä»…è®­ç»ƒ200ä¸ªå‚æ•°ï¼Œå°±å¯ä»¥ä½¿RoBERTa-largeåœ¨MRPCæ•°æ®é›†ä¸Šçš„æ•ˆæœè¾¾åˆ°å…¨é‡å‚æ•°å¾®è°ƒæ•ˆæœçš„90%ã€‚ ## ä½ç§©é€‚é… é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡çŸ©é˜µé€šå¸¸å…·æœ‰æ»¡ç§©ï¼Œè¿™æ„å‘³ç€æƒé‡çŸ©é˜µçš„å„ä¸ªåˆ—å‘é‡ä¹‹é—´çº¿æ€§æ— å…³ï¼Œè¿™æ ·çš„çŸ©é˜µæ²¡æœ‰å†—ä½™ä¿¡æ¯ï¼Œæ˜¯æ— æ³•è¢«å‹ç¼©çš„ã€‚ä½†æ˜¯ï¼Œâ€œå†…åœ¨ç»´åº¦â€ç°è±¡è¡¨æ˜ï¼Œå¾®è°ƒæ¨¡å‹æ—¶åªéœ€æ›´æ–°å°‘é‡å‚æ•°ï¼Œè¿™å¯å‘æˆ‘ä»¬å¾®è°ƒæ—¶äº§ç”Ÿçš„æƒé‡å¢é‡çŸ©é˜µ\\(\\Delta\\)Wå¯èƒ½åŒ…å«å¤§é‡å†—ä½™å‚æ•°ï¼Œ\\(\\Delta\\)Wå¾ˆå¯èƒ½ä¸æ˜¯æ»¡ç§©çš„ã€‚å¯¹ä½ç§©çŸ©é˜µåšåˆ†è§£ï¼Œå¯ä»¥åˆ©ç”¨è¾ƒå°‘çš„å‚æ•°é‡å»ºæˆ–è¿‘ä¼¼åŸçŸ©é˜µã€‚è¿™å°±æ˜¯LoRAçš„æ ¸å¿ƒæ€æƒ³ã€‚ è®¾è¾“å…¥ä¸ºxï¼Œå¾®è°ƒæ—¶å¾—åˆ°å¢é‡\\(\\Delta W\\),ä¸åŸå§‹æƒé‡\\(\\mathcal{W}_{0}\\)ç›¸åŠ å¾—åˆ°æ›´æ–°åçš„æƒé‡ï¼Œè¾“å‡ºh= ( \\(W_0\\)+ \\(\\Delta\\)W) xã€‚æ ¹æ®çŸ©é˜µçš„ä¹˜æ³•åˆ†é…å¾‹ï¼Œæœ‰h= \\(W_0\\)x+ \\(\\Delta\\)Wx,è¿™æ„å‘³ç€å¾®è°ƒæ—¶å¯ä»¥ä¿æŒ\\(W_0\\)ä¸å˜ï¼Œåˆ†åˆ«å°†\\(W_0\\)ã€\\(\\Delta\\)Wä¸xç›¸ä¹˜ï¼Œæœ€åæŠŠä¸¤ä¸ªä¹˜ç§¯ç›¸åŠ å³å¯å¾—åˆ°è¾“å‡ºhã€‚ è®¾\\(\\mathcal{W}_0\\in\\mathbb{R}^{\\mathrm{dxk}}\\),\\(\\Delta \\mathcal{W} _{\\mathrm{f} }\\)çš„ç§©ä¸ºrã€‚\\(\\Delta \\mathcal{W}= \\mathcal{B} \\mathcal{A}\\)æ˜¯\\(\\Delta\\mathcal{W}\\)çš„ä¸€ä¸ªæ»¡ç§©åˆ†è§£ï¼Œå…¶ä¸­ \\(\\mathcal{B} \\in \\mathbb{R} ^{\\mathrm{dxr}}, \\mathcal{A} \\in \\mathbb{R} ^{\\mathrm{rxk}}, \\mathcal{r} \\ll \\min ( \\mathcal{d} , \\mathcal{k} )\\)ã€‚è®­ç»ƒæ—¶ï¼Œåˆ†åˆ«ç”¨éšæœºé«˜æ–¯å’Œé›¶çŸ©é˜µåˆå§‹åŒ–Aå’ŒBï¼Œç¡®ä¿åˆå§‹åŒ–æ—¶ BAæ˜¯é›¶çŸ©é˜µï¼Œå¯¹æ¨¡å‹æ•ˆæœæ²¡æœ‰å½±å“ã€‚è®­ç»ƒè¿‡ç¨‹ä¸­å†»ç»“\\(\\mathcal{W}_0\\),åªæ›´æ–°çŸ©é˜µBå’ŒAï¼Œå…±r(d+k)ä¸ªå‚æ•°ï¼Œä»è€Œå® ç°â€œå‚æ•°é«˜æ•ˆâ€å¾®è°ƒã€‚æ¨ç†æ—¶ï¼Œåˆ†åˆ«è®¡ç®—\\(\\mathbf{W_{\\mathrm{n} }x}\\)å’Œ BAxå¹¶ç›¸åŠ ï¼Œå¾—åˆ°è¾“å‡ºhï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®é™…ä¸Šï¼Œræ˜¯ä¸€ä¸ªè¶…å‚ï¼Œè®­ç»ƒæ—¶å¯ä»»æ„è®¾å®šï¼Œ\\(\\Delta\\)WçœŸæ­£çš„ç§©æœªå¿…ç­‰äºrã€‚å¦‚æœræ°å¥½ç­‰äº\\(\\Delta\\)Wçš„ç§©ï¼Œç”šè‡³å¤§äº\\(\\Delta\\)çš„ç§©(ä¾‹å¦‚ç­‰äºé¢„è®­ç»ƒæƒé‡çŸ©é˜µ\\(W_{0}\\)çš„ç§©),åˆ©ç”¨å­¦åˆ°çš„Bå’ŒAå¯ä»¥å®Œå…¨é‡å»º\\(\\Delta\\)W,è¿™æ—¶ï¼ŒLoRAçš„æ•ˆæœè¿‘ä¼¼äºå…¨é‡å¾®è°ƒã€‚å¦‚æœrå°äº\\(\\Delta\\)Wçš„ç§©ï¼ŒBAå°±æ˜¯\\(\\Delta\\)Wçš„ä¸€ä¸ªä½ç§©è¿‘ä¼¼ï¼Œåˆ©ç”¨çŸ©é˜µBå’ŒAå¯ä»¥æ¢å¤çŸ©é˜µ\\(\\Delta W\\)ä¸­çš„éƒ¨åˆ†ä¿¡æ¯ã€‚ è¿˜æœ‰ä¸€ä¸ªè¶…å‚æ•°ä¸ºlora_alpha: image.png ","date":"2024-08-07","objectID":"/lora%E5%BE%AE%E8%B0%83/:0:0","tags":null,"title":"Loraå¾®è°ƒ","uri":"/lora%E5%BE%AE%E8%B0%83/"},{"categories":[""],"content":"é™ä½äº†å“ªéƒ¨åˆ†æ˜¾å­˜éœ€æ±‚ image.png image.png ","date":"2024-08-07","objectID":"/lora%E5%BE%AE%E8%B0%83/:1:0","tags":null,"title":"Loraå¾®è°ƒ","uri":"/lora%E5%BE%AE%E8%B0%83/"},{"categories":[""],"content":"ä»£ç  class LoraModel(torch.nn.Module): \"\"\" Creates Low Rank Adapter (Lora) model from a pretrained transformers model. Args: model ([`transformers.PreTrainedModel`]): The model to be adapted. config ([`LoraConfig`]): The configuration of the Lora model. Returns: `torch.nn.Module`: The Lora model. Example:: \u003e\u003e\u003e from transformers import AutoModelForSeq2SeqLM, LoraConfig \u003e\u003e\u003e from peft import LoraModel, LoraConfig \u003e\u003e\u003e config = LoraConfig( peft_type=\"LORA\", task_type=\"SEQ_2_SEQ_LM\", r=8, lora_alpha=32, target_modules=[\"q\", \"v\"], lora_dropout=0.01, ) \u003e\u003e\u003e model = AutoModelForSeq2SeqLM.from_pretrained(\"t5-base\") \u003e\u003e\u003e lora_model = LoraModel(config, model) **Attributes**: - **model** ([`transformers.PreTrainedModel`]) -- The model to be adapted. - **peft_config** ([`LoraConfig`]): The configuration of the Lora model. \"\"\" def __init__(self, config, model): super().__init__() self.peft_config = config self.model = model self._find_and_replace() mark_only_lora_as_trainable(self.model, self.peft_config.bias) def _find_and_replace(self): kwargs = { \"r\": self.peft_config.r, \"lora_alpha\": self.peft_config.lora_alpha, \"lora_dropout\": self.peft_config.lora_dropout, \"fan_in_fan_out\": self.peft_config.fan_in_fan_out, \"merge_weights\": self.peft_config.merge_weights, } key_list = [key for key, _ in self.model.named_modules()] for key in key_list: if any(key.endswith(target_key) for target_key in self.peft_config.target_modules): # å¯¹ç‰¹å®šçš„å±‚æ’å…¥loraå±‚ parent, target, target_name = self._get_submodules(key) bias = target.bias is not None if isinstance(target, torch.nn.Linear) and self.peft_config.enable_lora is None: new_module = Linear(target.in_features, target.out_features, bias=bias, **kwargs) elif self.peft_config.enable_lora is not None: kwargs.update({\"enable_lora\": self.peft_config.enable_lora}) if isinstance(target, Conv1D): in_features, out_features = target.weight.shape else: in_features, out_features = target.in_features, target.out_features if kwargs[\"fan_in_fan_out\"]: warnings.warn( \"fan_in_fan_out is set to True but the target module is not a Conv1D. \" \"Setting fan_in_fan_out to False.\" ) kwargs[\"fan_in_fan_out\"] = False new_module = MergedLinear(in_features, out_features, bias=bias, **kwargs) self._replace_module(parent, target_name, new_module, target) def _get_submodules(self, key): parent = self.model.get_submodule(\".\".join(key.split(\".\")[:-1])) target_name = key.split(\".\")[-1] target = self.model.get_submodule(key) return parent, target, target_name def _replace_module(self, parent_module, child_name, new_module, old_module): setattr(parent_module, child_name, new_module) new_module.weight = old_module.weight if old_module.bias is not None: new_module.bias = old_module.bias def forward(self, *args, **kwargs): return self.model(*args, **kwargs) def __getattr__(self, name: str): \"\"\"Forward missing attributes to the wrapped module.\"\"\" try: return super().__getattr__(name) # defer to nn.Module's logic except AttributeError: return getattr(self.model, name) @property def modules_to_save(self): return None def get_peft_config_as_dict(self, inference: bool = False): config = {k: v.value if isinstance(v, Enum) else v for k, v in asdict(self.peft_config).items()} if inference: config[\"inference_mode\"] = True return config æ’å…¥loraå±‚çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š class LoraLayer: def __init__( self, r: int, lora_alpha: int, lora_dropout: float, merge_weights: bool, ): self.r = r self.lora_alpha = lora_alpha # Optional dropout if lora_dropout \u003e 0.0: self.lora_dropout = nn.Dropout(p=lora_dropout) else: self.lora_dropout = lambda x: x # Mark the weight as unmerged self.merged = False self.merge_weights = merge_weights class Linear(nn.Linear, LoraLayer): # Lora implemented in a dense layer def __init__( self, in_features: int, out_features: int, r: int = 0, lora_alpha: int = 1, lora_dropout: float = 0.0, fan_in_fan_out: bool = False, # Set this to True if the layer to replace stores weight like (fan_in, fan_out) merge_weights: bool = True, **kwargs, ): nn.Linear.__init__(self, in","date":"2024-08-07","objectID":"/lora%E5%BE%AE%E8%B0%83/:2:0","tags":null,"title":"Loraå¾®è°ƒ","uri":"/lora%E5%BE%AE%E8%B0%83/"},{"categories":[""],"content":"å‚è€ƒ https://snailcoder.github.io/2023/08/06/parameter-efficient-llm-fine-tuning-lora.html # å½“çº¢ç‚¸å­é¸¡ LoRAï¼Œæ˜¯å½“ä»£å¾®è°ƒ LLMs çš„æ­£ç¡®å§¿åŠ¿ï¼Ÿ ","date":"2024-08-07","objectID":"/lora%E5%BE%AE%E8%B0%83/:3:0","tags":null,"title":"Loraå¾®è°ƒ","uri":"/lora%E5%BE%AE%E8%B0%83/"},{"categories":["","NLP","LLM","MoE"],"content":"MoE çš„æ€æƒ³ç±»ä¼¼äºé›†æˆå­¦ä¹ ä¸­çš„ Ensemble Learningã€‚MoE ä½œç”¨äºåŸæœ¬ transformer æ¨¡å‹çš„ MLP å±‚ï¼Œå³ï¼š å›¾ç‰‡æ¥è‡ªäºSwitch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity è®ºæ–‡ã€‚ æ€»ç»“æ¥è¯´ï¼Œåœ¨æ··åˆä¸“å®¶æ¨¡å‹ (MoE) ä¸­ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿ Transformer æ¨¡å‹ä¸­çš„æ¯ä¸ªå‰é¦ˆç½‘ç»œ (FFN) å±‚æ›¿æ¢ä¸º MoE å±‚ï¼Œå…¶ä¸­ MoE å±‚ç”±ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆ:Â ä¸€ä¸ªè·¯ç”±å™¨ï¼ˆæˆ–è€…å«é—¨æ§ç½‘ç»œï¼‰å’Œè‹¥å¹²æ•°é‡çš„ä¸“å®¶ã€‚ ç”¨å¤šä¸ª FeedForward å—æ›¿æ¢å•ä¸ª FeedForward å—Â ï¼ˆå¦‚åœ¨ MoE è®¾ç½®ä¸­æ‰€åšçš„é‚£æ ·ï¼‰ä¼šå¤§å¤§å¢åŠ æ¨¡å‹çš„æ€»å‚æ•°æ•°ã€‚ç„¶è€Œï¼Œå…³é”®çš„è¯€çªæ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šå¯¹æ¯ä¸ªtokenä½¿ç”¨ï¼ˆâ€œæ¿€æ´»â€ï¼‰æ‰€æœ‰ä¸“å®¶ã€‚ç›¸åï¼Œè·¯ç”±å™¨ä»…ä¸ºæ¯ä¸ªtokené€‰æ‹©ä¸€å°éƒ¨åˆ†ä¸“å®¶ã€‚ image.png ","date":"2024-08-07","objectID":"/moe/:0:0","tags":["NLP","LLM","MoE"],"title":"MoE","uri":"/moe/"},{"categories":["","NLP","LLM","MoE"],"content":"æŠ€æœ¯é€‰æ‹© Expert Choice è·¯ç”±ï¼ˆå®¹é‡ä¸º 2ï¼Œå³æ¯ä¸ªä¸“å®¶é€‰ä¸¤ä¸ª tokenï¼‰åœ¨ NLP æ¨¡å‹æ•ˆæœå¥½ï¼ŒTop-K è·¯ç”±åˆ™åœ¨è§†è§‰æ¨¡å‹æ•ˆæœå¥½ã€‚ åœ¨ NLP ä»»åŠ¡ä¸­ï¼Œä¸“å®¶è¶Šå¤šè¶Šå¥½ï¼Œè€Œè§†è§‰ä»»åŠ¡ä¸­å­˜åœ¨é¥±å’Œç‚¹ã€‚ å¢åŠ  MoE å±‚æ•°ä¹Ÿå¯ä»¥å¢åŠ æ¨¡å‹å®¹é‡ï¼Œä½†è§†è§‰ä»»åŠ¡ä¸­åŒæ ·å­˜åœ¨é¥±å’Œç‚¹ã€‚ æ¢å¤ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆä¸€äº›ç»Ÿè®¡é‡ï¼‰å’Œè·¯ç”±æƒé‡å½’ä¸€åŒ–å¯ä»¥æé«˜è§†è§‰ MoE æ¨¡å‹çš„æ€§èƒ½ï¼Œå¯¹ NLP ä»»åŠ¡æ— æ•ˆã€‚ ","date":"2024-08-07","objectID":"/moe/:1:0","tags":["NLP","LLM","MoE"],"title":"MoE","uri":"/moe/"},{"categories":["","NLP","LLM","MoE"],"content":"å…«è‚¡ image.png ","date":"2024-08-07","objectID":"/moe/:2:0","tags":["NLP","LLM","MoE"],"title":"MoE","uri":"/moe/"},{"categories":["","ç®—æ³•é¢˜"],"content":" Problem: ","date":"2024-03-29","objectID":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/:0:0","tags":["ç®—æ³•é¢˜"],"title":"è¯¾ç¨‹è¡¨ï¼ˆæ‹“æ‰‘æ’åºï¼‰","uri":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"},{"categories":["","ç®—æ³•é¢˜"],"content":"æ€è·¯ æ³¨æ„æ‹“æ‰‘æ’åºæœ€å¥½æ˜¯é‚»æ¥è¡¨ï¼ˆå“ˆç³»è¡¨å®ç°ï¼‰ï¼Œå¹¶ç”¨é˜Ÿåˆ—å¤„ç†åç»­å…¥åº¦ä¸º0çš„ç‚¹ ","date":"2024-03-29","objectID":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/:1:0","tags":["ç®—æ³•é¢˜"],"title":"è¯¾ç¨‹è¡¨ï¼ˆæ‹“æ‰‘æ’åºï¼‰","uri":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"},{"categories":["","ç®—æ³•é¢˜"],"content":"è§£é¢˜æ–¹æ³• æè¿°ä½ çš„è§£é¢˜æ–¹æ³• ","date":"2024-03-29","objectID":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/:2:0","tags":["ç®—æ³•é¢˜"],"title":"è¯¾ç¨‹è¡¨ï¼ˆæ‹“æ‰‘æ’åºï¼‰","uri":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"},{"categories":["","ç®—æ³•é¢˜"],"content":"å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦: æ·»åŠ æ—¶é—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ç©ºé—´å¤æ‚åº¦: æ·»åŠ ç©ºé—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ","date":"2024-03-29","objectID":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/:3:0","tags":["ç®—æ³•é¢˜"],"title":"è¯¾ç¨‹è¡¨ï¼ˆæ‹“æ‰‘æ’åºï¼‰","uri":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"},{"categories":["","ç®—æ³•é¢˜"],"content":"Code class Solution: def canFinish(self, numCourses: int, prerequisites: List[List[int]]) -\u003e bool: if not prerequisites: return True def get_zero(numCourses, prerequisites, temp): queue = [] for prerequisite in prerequisites: temp[prerequisite[0]] += 1 for i in range(len(temp)): if temp[i] == 0: queue.append(i) return queue temp = [0 for _ in range(numCourses)] queue = get_zero(numCourses, prerequisites, temp) if queue == []: return False from collections import defaultdict d = defaultdict(list) for prerequisite in prerequisites: d[prerequisite[1]].append(prerequisite[0]) while queue: idx = queue.pop(0) nexs = d[idx] if nexs: for nex in nexs: temp[nex] -= 1 if temp[nex] == 0: queue.append(nex) numCourses -= 1 return numCourses == 0 ","date":"2024-03-29","objectID":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/:4:0","tags":["ç®—æ³•é¢˜"],"title":"è¯¾ç¨‹è¡¨ï¼ˆæ‹“æ‰‘æ’åºï¼‰","uri":"/%E8%AF%BE%E7%A8%8B%E8%A1%A8%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"},{"categories":[""],"content":" Problem: ","date":"2024-03-18","objectID":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/:0:0","tags":null,"title":"ä¹˜ç§¯æœ€å¤§çš„æ•°ç»„","uri":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/"},{"categories":[""],"content":"æ€è·¯ è®²è¿°çœ‹åˆ°è¿™ä¸€é¢˜çš„æ€è·¯ ","date":"2024-03-18","objectID":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/:1:0","tags":null,"title":"ä¹˜ç§¯æœ€å¤§çš„æ•°ç»„","uri":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/"},{"categories":[""],"content":"è§£é¢˜æ–¹æ³• æè¿°ä½ çš„è§£é¢˜æ–¹æ³• ","date":"2024-03-18","objectID":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/:2:0","tags":null,"title":"ä¹˜ç§¯æœ€å¤§çš„æ•°ç»„","uri":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/"},{"categories":[""],"content":"å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦: æ·»åŠ æ—¶é—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ç©ºé—´å¤æ‚åº¦: æ·»åŠ ç©ºé—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ","date":"2024-03-18","objectID":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/:3:0","tags":null,"title":"ä¹˜ç§¯æœ€å¤§çš„æ•°ç»„","uri":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/"},{"categories":[""],"content":"Code ","date":"2024-03-18","objectID":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/:4:0","tags":null,"title":"ä¹˜ç§¯æœ€å¤§çš„æ•°ç»„","uri":"/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E7%9A%84%E6%95%B0%E7%BB%84/"},{"categories":["","è´ªå¿ƒ","ç®—æ³•é¢˜"],"content":"è·³è·ƒæ¸¸æˆ Problem: ","date":"2024-03-18","objectID":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/:0:0","tags":["ç®—æ³•é¢˜","è´ªå¿ƒ"],"title":"è·³è·ƒæ¸¸æˆ","uri":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/"},{"categories":["","è´ªå¿ƒ","ç®—æ³•é¢˜"],"content":"æ€è·¯ è®²è¿°çœ‹åˆ°è¿™ä¸€é¢˜çš„æ€è·¯ ","date":"2024-03-18","objectID":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/:1:0","tags":["ç®—æ³•é¢˜","è´ªå¿ƒ"],"title":"è·³è·ƒæ¸¸æˆ","uri":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/"},{"categories":["","è´ªå¿ƒ","ç®—æ³•é¢˜"],"content":"è§£é¢˜æ–¹æ³• æè¿°ä½ çš„è§£é¢˜æ–¹æ³• ","date":"2024-03-18","objectID":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/:2:0","tags":["ç®—æ³•é¢˜","è´ªå¿ƒ"],"title":"è·³è·ƒæ¸¸æˆ","uri":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/"},{"categories":["","è´ªå¿ƒ","ç®—æ³•é¢˜"],"content":"å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦: æ·»åŠ æ—¶é—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ç©ºé—´å¤æ‚åº¦: æ·»åŠ ç©ºé—´å¤æ‚åº¦, ç¤ºä¾‹ï¼š \\(O(n)\\) ","date":"2024-03-18","objectID":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/:3:0","tags":["ç®—æ³•é¢˜","è´ªå¿ƒ"],"title":"è·³è·ƒæ¸¸æˆ","uri":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/"},{"categories":["","è´ªå¿ƒ","ç®—æ³•é¢˜"],"content":"Code ```Python3 [] # è·³è·ƒæ¸¸æˆii # åˆ’åˆ†å­—æ¯åŒºé—´ [763. åˆ’åˆ†å­—æ¯åŒºé—´ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/partition-labels/description/?envType=study-plan-v2\u0026envId=top-100-liked) æœ¬é¢˜é¢„å¤„ç†å®Œæ¯•åæ€è·¯å’Œè·³è·ƒæ¸¸æˆ2ç±»ä¼¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨åˆå¹¶åŒºé—´çš„æ€è·¯æ¥ï¼Œéƒ½æ˜¯è´ªå¿ƒç®—æ³•ã€‚ ## Code ```python class Solution: def partitionLabels(self, s: str) -\u003e List[int]: from collections import defaultdict d = defaultdict(list) for i, char in enumerate(s): d[char].append(i) # ä¹Ÿå¯ä»¥è€ƒè™‘åˆå¹¶åŒºé—´åšäº†ï¼Œä¸‹é¢çš„è§£æ³•ç±»ä¼¼è·³è·ƒæ¸¸æˆ2 res = [] start = 0 max_jump = 0 for i, char in enumerate(s): max_jump = max(max_jump, d[char][-1]) if i == max_jump: res.append(i - start + 1) start = i + 1 max_jump = 0 return res ","date":"2024-03-18","objectID":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/:4:0","tags":["ç®—æ³•é¢˜","è´ªå¿ƒ"],"title":"è·³è·ƒæ¸¸æˆ","uri":"/%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/"},{"categories":["","ç®—æ³•é¢˜"],"content":"41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ ç©ºé—´å¤æ‚åº¦o(n)å¾ˆå¥½æƒ³ï¼Œä½†o(1)ä¸å¥½æƒ³ï¼Œè¿˜æ˜¯ä¸ª408è€ƒç ”çœŸé¢˜ æ³¨æ„O(n) == O(2n)ï¼Œå³ç›¸è¾ƒäºè¾¹éå†è¾¹åˆ¤æ–­ï¼Œè¿˜æ˜¯éå†ä¸¤æ¬¡æ›´åŠ æ–¹ä¾¿ä¸”ä¸ä¼šæœ‰å¤ªå¤šæŸå¤±ã€‚ç±»ä¼¼æ€æƒ³ï¼š73. çŸ©é˜µç½®é›¶ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ class Solution: def firstMissingPositive(self, nums: List[int]) -\u003e int: # å°†åŸæ•°ç»„å½“ä½œå“ˆå¸Œè¡¨ä½¿ç”¨ã€‚ for i, num in enumerate(nums): if num \u003c= 0: # å…ˆæŠŠå°äº0çš„å…ˆä¸€æ­¥å¤„ç†ï¼Œä»¥ä¾¿äºä½¿ç”¨æ ‡è®° nums[i] = len(nums) + 1 for i, num in enumerate(nums): num = abs(num) if num \u003e= 1 and num \u003c= len(nums): if nums[num-1] \u003e 0: # ä¸é‡å¤æ·»åŠ  nums[num-1] = -nums[num-1] res = len(nums) + 1 for i, num in enumerate(nums): if num \u003e 0: res = i + 1 break return res ","date":"2024-03-16","objectID":"/%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%AD%A3%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜"],"title":"ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°","uri":"/%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%AD%A3%E6%95%B0/"},{"categories":["","ç®—æ³•é¢˜"],"content":"é¢˜ç›®åœ°å€ # æ€è·¯ é€šè¿‡å‰ç¼€å’Œ+å“ˆå¸Œè¡¨ï¼Œå¹¶æœ‰ç®€å•çš„æ•°å­¦å˜æ¢ã€‚å‰ç¼€å’Œå³ \\(y[i]=y[i-1]+x[i]\\) ç±»æ¯”äºaccumlateå‡½æ•°ï¼Œæ³¨æ„å‰ç¼€å’Œæ€æƒ³ä¹Ÿå¯ä»¥åº”ç”¨ä¸ºâ€œå‰ç¼€ç§¯ã€åç¼€å’Œã€åç¼€ç§¯â€ç­‰æ€æƒ³ã€‚238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ \u003eÂ ä½¿ç”¨å‰ç¼€å’Œçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å’Œä¸ºkçš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ã€‚é€šè¿‡è®¡ç®—å‰ç¼€å’Œï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜è½¬åŒ–ä¸ºæ±‚è§£ä¸¤ä¸ªå‰ç¼€å’Œä¹‹å·®ç­‰äºkçš„æƒ…å†µã€‚ \u003eå‡è®¾æ•°ç»„çš„å‰ç¼€å’Œæ•°ç»„ä¸ºprefixSumï¼Œå…¶ä¸­prefixSum[i]è¡¨ç¤ºä»æ•°ç»„èµ·å§‹ä½ç½®åˆ°ç¬¬iä¸ªä½ç½®çš„å…ƒç´ ä¹‹å’Œã€‚é‚£ä¹ˆå¯¹äºä»»æ„çš„ä¸¤ä¸ªä¸‹æ ‡iå’Œjï¼ˆi \u003c jï¼‰ï¼Œå¦‚æœprefixSum[j] - prefixSum[i] = kï¼Œå³ä»ç¬¬iä¸ªä½ç½®åˆ°ç¬¬jä¸ªä½ç½®çš„å…ƒç´ ä¹‹å’Œç­‰äºkï¼Œé‚£ä¹ˆè¯´æ˜ä»ç¬¬i+1ä¸ªä½ç½®åˆ°ç¬¬jä¸ªä½ç½®çš„è¿ç»­å­æ•°ç»„çš„å’Œä¸ºkã€‚ é€šè¿‡éå†æ•°ç»„ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®çš„å‰ç¼€å’Œï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å­˜å‚¨æ¯ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ã€‚åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å­˜åœ¨prefixSum[j] - kçš„å‰ç¼€å’Œï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜ä»æŸä¸ªä½ç½®åˆ°å½“å‰ä½ç½®çš„è¿ç»­å­æ•°ç»„çš„å’Œä¸ºkï¼Œæˆ‘ä»¬å°†å¯¹åº”çš„æ¬¡æ•°ç´¯åŠ åˆ°ç»“æœä¸­ã€‚ è¿™æ ·ï¼Œé€šè¿‡éå†ä¸€æ¬¡æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡å‡ºå’Œä¸ºkçš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå…¶ä¸­nä¸ºæ•°ç»„çš„é•¿åº¦ã€‚ # ä»£ç  class Solution: def subarraySum(self, nums: List[int], k: int) -\u003e int: from collections import defaultdict d = defaultdict(int) d[0] = 1 prefix = 0 res = 0 for num in nums: prefix += num temp = prefix - k if temp in d: res += d[temp] d[prefix] += 1 return res ","date":"2024-03-14","objectID":"/%E5%92%8C%E4%B8%BAk%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/:0:0","tags":["ç®—æ³•é¢˜"],"title":"å’Œä¸ºKçš„å­æ•°ç»„","uri":"/%E5%92%8C%E4%B8%BAk%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/"},{"categories":["","ç®—æ³•é¢˜"],"content":"é¢˜ç›®åœ°å€ # æ€è·¯ é€šè¿‡å‰ç¼€å’Œ+å“ˆå¸Œè¡¨ï¼Œå¹¶æœ‰ç®€å•çš„æ•°å­¦å˜æ¢ã€‚å‰ç¼€å’Œå³ \\(y[i]=y[i-1]+x[i]\\) ç±»æ¯”äºaccumlateå‡½æ•°ï¼Œæ³¨æ„å‰ç¼€å’Œæ€æƒ³ä¹Ÿå¯ä»¥åº”ç”¨ä¸ºâ€œå‰ç¼€ç§¯ã€åç¼€å’Œã€åç¼€ç§¯â€ç­‰æ€æƒ³ã€‚238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ \u003eÂ ä½¿ç”¨å‰ç¼€å’Œçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å’Œä¸ºkçš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ã€‚é€šè¿‡è®¡ç®—å‰ç¼€å’Œï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜è½¬åŒ–ä¸ºæ±‚è§£ä¸¤ä¸ªå‰ç¼€å’Œä¹‹å·®ç­‰äºkçš„æƒ…å†µã€‚ \u003eå‡è®¾æ•°ç»„çš„å‰ç¼€å’Œæ•°ç»„ä¸ºprefixSumï¼Œå…¶ä¸­prefixSum[i]è¡¨ç¤ºä»æ•°ç»„èµ·å§‹ä½ç½®åˆ°ç¬¬iä¸ªä½ç½®çš„å…ƒç´ ä¹‹å’Œã€‚é‚£ä¹ˆå¯¹äºä»»æ„çš„ä¸¤ä¸ªä¸‹æ ‡iå’Œjï¼ˆi \u003c jï¼‰ï¼Œå¦‚æœprefixSum[j] - prefixSum[i] = kï¼Œå³ä»ç¬¬iä¸ªä½ç½®åˆ°ç¬¬jä¸ªä½ç½®çš„å…ƒç´ ä¹‹å’Œç­‰äºkï¼Œé‚£ä¹ˆè¯´æ˜ä»ç¬¬i+1ä¸ªä½ç½®åˆ°ç¬¬jä¸ªä½ç½®çš„è¿ç»­å­æ•°ç»„çš„å’Œä¸ºkã€‚ é€šè¿‡éå†æ•°ç»„ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®çš„å‰ç¼€å’Œï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å­˜å‚¨æ¯ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ã€‚åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å­˜åœ¨prefixSum[j] - kçš„å‰ç¼€å’Œï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜ä»æŸä¸ªä½ç½®åˆ°å½“å‰ä½ç½®çš„è¿ç»­å­æ•°ç»„çš„å’Œä¸ºkï¼Œæˆ‘ä»¬å°†å¯¹åº”çš„æ¬¡æ•°ç´¯åŠ åˆ°ç»“æœä¸­ã€‚ è¿™æ ·ï¼Œé€šè¿‡éå†ä¸€æ¬¡æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡å‡ºå’Œä¸ºkçš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå…¶ä¸­nä¸ºæ•°ç»„çš„é•¿åº¦ã€‚ # ä»£ç  class Solution: def subarraySum(self, nums: List[int], k: int) -\u003e int: from collections import defaultdict d = defaultdict(int) d[0] = 1 prefix = 0 res = 0 for num in nums: prefix += num temp = prefix - k if temp in d: res += d[temp] d[prefix] += 1 return res ","date":"2024-03-14","objectID":"/%E5%92%8C%E4%B8%BAk%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84-1/:0:0","tags":["ç®—æ³•é¢˜"],"title":"å’Œä¸ºKçš„å­æ•°ç»„","uri":"/%E5%92%8C%E4%B8%BAk%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84-1/"},{"categories":["","ç®—æ³•é¢˜"],"content":"def find(x): if (p[x] != x): p[x] = find(p[x]) return p[x] ä¸Šé¢æ˜¯yæ€»çš„æ¨¡æ¿ï¼Œå®ç°äº†è·¯å¾„å‹ç¼©ã€‚ ","date":"2024-03-13","objectID":"/%E5%B9%B6%E6%9F%A5%E9%9B%86/:0:0","tags":["ç®—æ³•é¢˜"],"title":"å¹¶æŸ¥é›†","uri":"/%E5%B9%B6%E6%9F%A5%E9%9B%86/"},{"categories":["è®­ç»ƒtrick"],"content":"æ¸©åº¦è¶…å‚æ•°tï¼Œä¸€èˆ¬ä¸ºsoftmaxç»“æœé™¤ä»¥è¯¥å‚æ•°ï¼Œæˆ–è€…åœ¨å¯¹æ¯”å­¦ä¹ ä¸­ï¼Œç›¸ä¼¼åº¦é™¤ä»¥å‚æ•°tã€‚ å¦‚å›¾ï¼š ä¸Šå›¾ä¸ºæ— ç›‘ç£simcseä¸­çš„æŸå¤±å‡½æ•°ã€‚ tè¶Šå¤§ï¼Œç»“æœè¶Šå¹³æ»‘ï¼Œtè¶Šå°ï¼Œå¾—åˆ°çš„æ¦‚ç‡åˆ†å¸ƒæ›´â€œå°–é”â€ã€‚ å½“tè¶‹äº0æ—¶ï¼š æ­¤æ—¶åªå…³æ³¨æœ€å›°éš¾çš„è´Ÿæ ·æœ¬ï¼ˆsmaxï¼‰ã€‚ å½“tè¶‹äºâˆæ—¶ï¼š æ­¤æ—¶å¯¹æ¯”æŸå¤±å¯¹æ‰€æœ‰è´Ÿæ ·æœ¬çš„æƒé‡éƒ½ç›¸åŒã€‚ å› æ­¤tè¶Šå¤§ï¼Œå¯ä»¥é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ã€‚(å±€éƒ¨æœ€ä¼˜æ˜¯è¿‡æ—©åœ°ç¡®å®šäº†ä¼˜åŒ–çš„æ¢¯åº¦æ–¹å‘ï¼Œå¤±å»äº†åœ¨å…¶ä»–æ–¹å‘ä¸Šæ¢ç´¢çš„æœºä¼šã€‚è¾ƒå¤§çš„æ¸©åº¦ä½¿å¾—å„ä¸ªæ–¹å‘ä¸Šçš„æ¢¯åº¦å·®å¼‚æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ï¼Œä»è€Œè·å¾—äº†åœ¨æ—©æœŸæ›´å¤šçš„æ¢ç´¢æœºä¼šã€‚) [!note] æ¸©åº¦ç³»æ•°çš„ä½œç”¨æ˜¯è°ƒèŠ‚å¯¹å›°éš¾æ ·æœ¬çš„å…³æ³¨ç¨‹åº¦ï¼šè¶Šå°çš„æ¸©åº¦ç³»æ•°è¶Šå…³æ³¨äºå°†æœ¬æ ·æœ¬å’Œæœ€ç›¸ä¼¼çš„å›°éš¾æ ·æœ¬åˆ†å¼€ï¼Œå»å¾—åˆ°æ›´å‡åŒ€çš„è¡¨ç¤ºã€‚ç„¶è€Œå›°éš¾æ ·æœ¬å¾€å¾€æ˜¯ä¸æœ¬æ ·æœ¬ç›¸ä¼¼ç¨‹åº¦è¾ƒé«˜çš„ï¼Œå¾ˆå¤šå›°éš¾è´Ÿæ ·æœ¬å…¶å®æ˜¯æ½œåœ¨çš„æ­£æ ·æœ¬ï¼Œè¿‡åˆ†å¼ºè¿«ä¸å›°éš¾æ ·æœ¬åˆ†å¼€ä¼šç ´åå­¦åˆ°çš„æ½œåœ¨è¯­ä¹‰ç»“æ„ï¼Œå› æ­¤ï¼Œæ¸©åº¦ç³»æ•°ä¸èƒ½è¿‡å° è€ƒè™‘ä¸¤ä¸ªæç«¯æƒ…å†µï¼Œæ¸©åº¦ç³»æ•°è¶‹å‘äº0æ—¶ï¼Œå¯¹æ¯”æŸå¤±é€€åŒ–ä¸ºåªå…³æ³¨æœ€å›°éš¾çš„è´Ÿæ ·æœ¬çš„æŸå¤±å‡½æ•°ï¼›å½“æ¸©åº¦ç³»æ•°è¶‹å‘äºæ— ç©·å¤§æ—¶ï¼Œå¯¹æ¯”æŸå¤±å¯¹æ‰€æœ‰è´Ÿæ ·æœ¬éƒ½ä¸€è§†åŒä»ï¼Œå¤±å»äº†å›°éš¾æ ·æœ¬å…³æ³¨çš„ç‰¹æ€§ã€‚ å¯ä»¥æŠŠä¸åŒçš„è´Ÿæ ·æœ¬æƒ³åƒæˆåŒæç‚¹ç”µè·åœ¨ä¸åŒè·ç¦»å¤„çš„å—åŠ›æƒ…å†µï¼Œè·ç¦»è¶Šè¿‘çš„ç‚¹ç”µè·å—åˆ°çš„åº“ä¼¦æ–¥åŠ›æ›´å¤§ï¼Œè€Œè·ç¦»è¶Šè¿œçš„ç‚¹ç”µè·å—åˆ°çš„æ–¥åŠ›è¶Šå°ã€‚å¯¹æ¯”æŸå¤±ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚è¿™ç§æ€§è´¨æ›´æœ‰åˆ©äºå½¢æˆåœ¨è¶…çƒé¢å‡åŒ€åˆ†å¸ƒçš„ç‰¹å¾ã€‚ è¯­è¨€å»ºæ¨¡ (lena-voita.github.io)ä¸­æœ‰ä¸ªå°æ¸¸æˆå¯ä»¥çœ‹åˆ°éšç€æ¸©åº¦çš„å˜åŒ–å¯¼è‡´æ¦‚ç‡åˆ†å¸ƒçš„å˜åŒ– å‚è€ƒ CVPR2021è‡ªç›‘ç£å­¦ä¹ è®ºæ–‡: ç†è§£å¯¹æ¯”æŸå¤±çš„æ€§è´¨ä»¥åŠæ¸©åº¦ç³»æ•°çš„ä½œç”¨ - çŸ¥ä¹ (zhihu.com) ","date":"2024-01-14","objectID":"/%E6%B8%A9%E5%BA%A6%E8%B6%85%E5%8F%82%E6%95%B0/:0:0","tags":["è®­ç»ƒtrick","æ¸©åº¦è¶…å‚æ•°"],"title":"æ¸©åº¦è¶…å‚æ•°","uri":"/%E6%B8%A9%E5%BA%A6%E8%B6%85%E5%8F%82%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"leetcodeåœ°å€ï¼š953. éªŒè¯å¤–æ˜Ÿè¯­è¯å…¸ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ ","date":"2024-01-08","objectID":"/%E9%AA%8C%E8%AF%81%E5%A4%96%E6%98%9F%E8%AF%AD%E8%AF%8D%E5%85%B8/:0:0","tags":["ç®—æ³•é¢˜","éªŒè¯å¤–æ˜Ÿè¯­è¯å…¸"],"title":"éªŒè¯å¤–æ˜Ÿè¯­è¯å…¸","uri":"/%E9%AA%8C%E8%AF%81%E5%A4%96%E6%98%9F%E8%AF%AD%E8%AF%8D%E5%85%B8/"},{"categories":["ç®—æ³•é¢˜"],"content":"ç®€å•æ–¹æ³• pythonåˆ—è¡¨ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡Œæ¯”è¾ƒï¼ˆå¤ªçµæ´»äº†ï¼‰ï¼Œæ¯”å¦‚[1, 2, 3] \u003c [2, 2, 3]æˆç«‹ï¼Œå³æŒ‰ç…§å­—å…¸åºè¿›è¡Œæ¯”è¾ƒï¼Œä¸å…¶æ˜¯ä¸€æ ·çš„æ¯”è¾ƒè§„åˆ™ã€‚å› æ­¤å¯¹äºæœ¬é¢˜å¯ä»¥åˆ©ç”¨pythonçš„ç‰¹æ€§è½»æ¾è§£å†³ã€‚ å¥½ä¹…æ²¡å†™pythonäº†ï¼Œå˜å¾—å¾ˆç”Ÿç–ï¼Œä¸€å¼€å§‹å†™çš„å¾ˆè ¢ï¼š class Solution: def isAlienSorted(self, words: List[str], order: str) -\u003e bool: d = dict(zip(order, range(len(order)))) words = list(map(lambda s: [d[i] for i in s], words)) print([1, 2, 3] \u003c [2, 2, 3]) return words == sorted(words) åæ¥æƒ³èµ·æ¥äº†sortedä¸­è¿˜æœ‰ä¸ªkeyå‚æ•°ï¼Œå¹¶ä¸”åˆ—è¡¨è¿˜æœ‰ä¸ªindexæ–¹æ³•ï¼ˆæˆ‘åŸºæœ¬ä¸Šæ²¡ç”¨è¿‡ï¼‰ï¼Œäºæ˜¯æ”¹æˆäº†ä¸€è¡Œ class Solution: def isAlienSorted(self, words: List[str], order: str) -\u003e bool: return words == sorted(words, key=lambda w:[order.index(x) for x in w]) ","date":"2024-01-08","objectID":"/%E9%AA%8C%E8%AF%81%E5%A4%96%E6%98%9F%E8%AF%AD%E8%AF%8D%E5%85%B8/:1:0","tags":["ç®—æ³•é¢˜","éªŒè¯å¤–æ˜Ÿè¯­è¯å…¸"],"title":"éªŒè¯å¤–æ˜Ÿè¯­è¯å…¸","uri":"/%E9%AA%8C%E8%AF%81%E5%A4%96%E6%98%9F%E8%AF%AD%E8%AF%8D%E5%85%B8/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"L1æ­£åˆ™åŒ– L2æ­£åˆ™åŒ– æƒé‡è¡°å‡ L2æ­£åˆ™åŒ–å’Œæƒé‡è¡°å‡çš„åŒºåˆ« L2æ­£åˆ™åŒ–æ˜¯åœ¨æŸå¤±å‡½æ•°ä¸Šåšæ–‡ç« ã€‚ æƒé‡è¡°å‡æ˜¯åœ¨æ¢¯åº¦æ›´æ–°æ—¶å¢åŠ ä¸€é¡¹ã€‚ ","date":"2023-03-22","objectID":"/l1-l2%E6%AD%A3%E5%88%99%E5%8C%96%E5%92%8C%E6%9D%83%E9%87%8D%E8%A1%B0%E5%87%8F/:0:0","tags":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–","L1 L2æ­£åˆ™åŒ–"],"title":"L1 L2æ­£åˆ™åŒ–","uri":"/l1-l2%E6%AD%A3%E5%88%99%E5%8C%96%E5%92%8C%E6%9D%83%E9%87%8D%E8%A1%B0%E5%87%8F/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"pre-norm Pre-norm:\\(X_t+1=X_{t}+F_{t}(Norm(X_{t}))\\) \\(å…ˆæ¥çœ‹Pre-norm^{+},é€’å½’å±•å¼€ï¼š\\) \\[X_{t+1}=X_t+F_t(Norm(X_t))\\] \\(=X_{0}+F_{1}(Norm(X_{1}))+\\ldots+F_{t-1}(Norm(X_{t-1}))+F_{t}(Norm(X_{t}))\\) å…¶ä¸­ï¼Œå±•å¼€\\(^{+}\\)åçš„æ¯ä¸€é¡¹( \\(F_{1}( Norm( X_{1}) ) , \\ldots\\), \\(F_{t- 1}( Norm( X_{t- 1}) )\\), \\(F_{t}( Norm( X_{t}) )\\))ä¹‹é—´éƒ½æ˜¯åŒä¸€é‡çº§çš„ï¼Œ æ‰€ä»¥\\(F_1(Norm(X_1))+\\ldots F_{t-1}(Norm(X_{t-1}))+F_t(Norm(X_t))\\)å’Œ \\(F_1(Norm(X_1))+\\ldots F_{t-1}(Norm(X_{t-1}))\\)ä¹‹é—´çš„åŒºåˆ«å°±åƒtå’Œt-1çš„åŒºåˆ«ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°† å…¶è®°ä¸º\\(X_t+ 1= \\mathscr{O} ( t+ 1)\\) . è¿™ç§ç‰¹æ€§å°±å¯¼è‡´å½“tè¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œ\\(X_{t+1}\\)å’Œ\\(X_t\\)ä¹‹é—´åŒºåˆ«å¯ä»¥å¿½ç•¥ä¸è®¡ï¼ˆç›´è§‰ä¸Šï¼‰ï¼Œé‚£ä¹ˆå°±æœ‰ï¼š \\[F_t(X_t)+F_{t+1}(X_{t+1})\\approx F_t(X_t)+F_{t+1}(X_t)=(F_t\\bigoplus F_{t+1})(X_t)\\] è¿™å°±æ˜¯æ‰€è°“çš„å¢åŠ å®½åº¦ï¼Œè€Œæ²¡æœ‰å¢åŠ æ·±åº¦ã€‚ä»è€Œå¯¼è‡´pre-normçš„ç²¾åº¦ä¸é«˜ã€‚ ## post-norm Post-norm:\\(X_{t+1}=Norm(X_{t}+F_{t}(x_{t}))\\) æœ¬æ¥layernormæ˜¯ä¸ºäº†ç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†æ˜¯åœ¨post-normè¿™é‡Œå´æˆä¸ºäº†æ¢¯åº¦æ¶ˆå¤±çš„ç½ªé­ç¥¸é¦–ã€‚ä¹Ÿå¯¼è‡´äº†æ”¶æ•›è¾ƒéš¾ã€éœ€è¦å¤§é‡è°ƒå‚ã€‚ \\[X_{t+1}=Norm(X_t+F_t(X_t))=\\frac{X_t+F_t(X_t)}{\\sqrt{2}}\\] \\[=\\frac{X_0}{\\sqrt{2}^{t+1}}+\\frac{F_0(X_0)}{\\sqrt{2}^{t+1}}+\\ldots+\\frac{F_{t-1}(X_{t-1})}{\\sqrt{2}^2}+\\frac{F_t(X_t)}{\\sqrt{2}}\\:(\\] è¿™ä¸ªç»“æ„è·Ÿpre-normæ¯”èµ·æ¥å……åˆ†è€ƒè™‘äº†æ‰€æœ‰åˆ†æ”¯ (æ®‹å·®\\(^{+})\\) çš„è¾“å‡ºï¼Œåšåˆ°äº†çœŸæ­£å¢åŠ æ·±åº¦ï¼Œè‡ªç„¶ç²¾åº¦ä¼šç›¸å¯¹å¥½ä¸€äº›ã€‚ ä¸è¿‡å®ƒä¹Ÿæœ‰å®ƒå¾ˆæ˜¾ç„¶çš„é—®é¢˜ï¼Œå½“tè¶³å¤Ÿå¤§ã€ä¹Ÿå°±æ˜¯å åŠ çš„attentionå±‚è¶³å¤Ÿå¤šä»¥åï¼Œåº•å±‚é‚£äº›åˆ†æ”¯(æ®‹å·®)çš„å½±å“åŠ›è¢«è¡°å‡æ‰äº†ï¼Œæ®‹å·®æœ‰åˆ©äºè§£å†³æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†æ˜¯åœ¨Post Normä¸­ï¼Œæ®‹å·®è¿™æ¡é€šé“è¢«ä¸¥é‡å‰Šå¼±äº†ï¼Œè¶Šé è¿‘è¾“å…¥ï¼Œå‰Šå¼±å¾—è¶Šä¸¥é‡ï¼Œæ®‹å·®â€œåå­˜å®äº¡â€ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šæœ‰æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œè¿™ä¹Ÿå°±æ˜¯æ–‡ç« å¼€å¤´æ‰€è¯´çš„postnorméš¾æ”¶æ•›ã€å‚æ•°éš¾è°ƒçš„åŸå› ã€‚æœ¬æ¥æˆ‘ä»¬åšNormä¹Ÿæ˜¯ä¸ºäº†å¤„ç†æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†ä»åˆ†æçœ‹æ¥ï¼Œtransformerç»“æ„ä¸­çš„layernorm\\(^{+}\\)å¹¶æ²¡æœ‰å®Œå…¨å®ç°å®ƒçš„ä½œç”¨ã€‚é‚£è¿™å°±æ„å‘³ç€transformeråŸå§‹ç»“æ„çš„å¤±è´¥å—ï¼Ÿå¹¶ä¸æ˜¯çš„ï¼Œå› ä¸ºè¿™ç§æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜åœ¨æ•´ä¸ªç»“æ„ä¸Šæ¥çœ‹(é…åˆä¸Šadamç³»ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡warmupï¼Œwarmupå¯¹äºpost-normæä¸ºé‡è¦) æ˜¯å¹¶ä¸æ˜æ˜¾çš„ã€‚ ç¦»è¾“å…¥å±‚çš„æ®‹å·®å½±å“åŠ›å¼±è¿™ä¸€ç‰¹æ€§ï¼Œä¹Ÿæœ‰å®ƒçš„ç”¨æ­¦ä¹‹åœ°ï¼Œæ¯”å¦‚åœ¨finetuneçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¸Œæœ›ä¸è¦è¿‡å¤šè°ƒæ•´é è¿‘è¾“å…¥å±‚çš„å‚æ•°ã€ä»¥å…ç ´åé¢„è®­ç»ƒçš„æ•ˆæœã€‚ ","date":"2023-03-22","objectID":"/layer-norm/:1:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"warmupçš„é‡è¦æ€§ Post-LN Transformeråœ¨è®­ç»ƒçš„åˆå§‹é˜¶æ®µï¼Œè¾“å‡ºå±‚é™„è¿‘çš„æœŸæœ›æ¢¯åº¦éå¸¸å¤§ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰warm-upï¼Œæ¨¡å‹ä¼˜åŒ–è¿‡ç¨‹å°±ä¼šç‚¸è£‚ï¼Œéå¸¸ä¸ç¨³å®šã€‚ æ¨¡å‹å¯¹è¶Šé åçš„å±‚è¶Šæ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¶Šé åçš„å±‚å­¦ä¹ å¾—è¶Šå¿«ï¼Œç„¶ååé¢çš„å±‚æ˜¯ä»¥å‰é¢çš„å±‚çš„è¾“å‡ºä¸ºè¾“å…¥çš„ï¼Œå‰é¢çš„å±‚æ ¹æœ¬å°±æ²¡å­¦å¥½ï¼Œæ‰€ä»¥åé¢çš„å±‚è™½ç„¶å­¦å¾—å¿«ï¼Œä½†å´æ˜¯å»ºç«‹åœ¨ç³Ÿç³•çš„è¾“å…¥åŸºç¡€ä¸Šçš„ã€‚ å¾ˆå¿«åœ°ï¼Œåé¢çš„å±‚ä»¥ç³Ÿç³•çš„è¾“å…¥ä¸ºåŸºç¡€åˆ°è¾¾äº†ä¸€ä¸ªç³Ÿç³•çš„å±€éƒ¨æœ€ä¼˜ç‚¹ï¼Œæ­¤æ—¶å®ƒçš„å­¦ä¹ å¼€å§‹æ”¾ç¼“ï¼ˆå› ä¸ºå·²ç»åˆ°è¾¾äº†å®ƒè®¤ä¸ºçš„æœ€ä¼˜ç‚¹é™„è¿‘ï¼‰ï¼ŒåŒæ—¶åå‘ä¼ æ’­ç»™å‰é¢å±‚çš„æ¢¯åº¦ä¿¡å·è¿›ä¸€æ­¥å˜å¼±ï¼Œè¿™å°±å¯¼è‡´äº†å‰é¢çš„å±‚çš„æ¢¯åº¦å˜å¾—ä¸å‡†ã€‚ä½† Adam çš„æ›´æ–°é‡æ˜¯å¸¸æ•°é‡çº§çš„ï¼Œæ¢¯åº¦ä¸å‡†ï¼Œä½†æ›´æ–°é‡ä¾ç„¶æ˜¯å¸¸æ•°é‡çº§ï¼Œæ„å‘³ç€å¯èƒ½å°±æ˜¯ä¸€ä¸ªå¸¸æ•°é‡çº§çš„éšæœºå™ªå£°äº†ï¼Œäºæ˜¯å­¦ä¹ æ–¹å‘å¼€å§‹ä¸åˆç†ï¼Œå‰é¢çš„è¾“å‡ºå¼€å§‹å´©ç›˜ï¼Œå¯¼è‡´åé¢çš„å±‚ä¹Ÿä¸€å¹¶å´©ç›˜ã€‚ ä»ä¸Šå›¾ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œpost-lnåœ¨å¼€å§‹é˜¶æ®µå±‚æ•°è¶Šé«˜æ¢¯åº¦è¶Šå¤§ï¼Œæ­¤æ—¶éœ€è¦å°å­¦ä¹ ç‡ï¼Œè€Œå½“warmupå®Œåï¼Œæ¢¯åº¦å˜å¾—å¾ˆå°ï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨å¤§å­¦ä¹ ç‡ã€‚ ","date":"2023-03-22","objectID":"/layer-norm/:2:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"å¾ˆå¥½çš„æ€»ç»“å›ç­” ","date":"2023-03-22","objectID":"/layer-norm/:3:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"ä¸ºä»€ä¹ˆ layer norm ä¼šä½¿æ–¹å·®ç´¯ç§¯å’Œè®­ç»ƒä¸ç¨³å®š è®©æˆ‘ä»¬æ¥è¿½è¸ªä¸€ä¸‹ Pre-Norm ç»“æ„ä¸­æ•°æ®Â xÂ çš„æ–¹å·®å˜åŒ–ï¼š å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¾“å…¥Â \\(x_l\\)ï¼Œå®ƒè¿›å…¥ç¬¬Â lÂ ä¸ªæ®‹å·®å—ã€‚ åœ¨Â SublayerÂ åˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹Â \\(x_l\\)Â è¿›è¡ŒÂ LayerNormã€‚\\(LayerNorm(x_l)\\)Â çš„è¾“å‡ºå…·æœ‰ä¸¥æ ¼çš„å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1Â çš„ç‰¹æ€§ã€‚ è¿™ä¸ªå½’ä¸€åŒ–åçš„ç»“æœè¢«é€å…¥Â Sublayerï¼ˆä¾‹å¦‚ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œæˆ–æ³¨æ„åŠ›å±‚ï¼‰ã€‚ç»è¿‡è®¡ç®—åï¼Œè¾“å‡ºÂ \\(Sublayer(LayerNorm(x_l))\\)Â çš„æ–¹å·®é€šå¸¸ä¸å†æ˜¯1ï¼Œæˆ‘ä»¬å‡è®¾å®ƒçš„æ–¹å·®æ˜¯Â Var(S)ã€‚ æœ€åï¼Œè¿™ä¸ªÂ SublayerÂ çš„è¾“å‡ºè¢«åŠ å›åˆ°åŸå§‹çš„ã€æœªå½’ä¸€åŒ–çš„è¾“å…¥Â \\(x_l\\)Â ä¸Šï¼Œå¾—åˆ°è¯¥å±‚çš„æœ€ç»ˆè¾“å‡ºÂ \\(x_{l+1}\\)ï¼š \\(x_{l+1} = x_l + Sublayer(LayerNorm(x_l))\\) ç°åœ¨æˆ‘ä»¬æ¥è®¡ç®—Â x_{l+1}Â çš„æ–¹å·®ã€‚åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œå¦‚æœä¸¤ä¸ªå˜é‡ï¼ˆè¿™é‡Œæ˜¯Â x_lÂ å’ŒÂ Sublayer(â€¦)ï¼‰å¤§è‡´ä¸ç›¸å…³ï¼Œé‚£ä¹ˆå®ƒä»¬å’Œçš„æ–¹å·®çº¦ç­‰äºå®ƒä»¬å„è‡ªæ–¹å·®çš„å’Œï¼š \\(Var(x_{l+1}) â‰ˆ Var(x_l) + Var(Sublayer(LayerNorm(x_l)))\\) \\(Var(x_{l+1}) â‰ˆ Var(x_l) + Var(S)\\) è¿™ä¸ªå…¬å¼æ¸…æ™°åœ°æ­ç¤ºäº†é—®é¢˜æ‰€åœ¨ï¼šæ¯ä¸€å±‚çš„è¾“å‡ºæ–¹å·®Â \\(Var(x_{l+1})\\) éƒ½æ˜¯åœ¨å‰ä¸€å±‚æ–¹å·®Â \\(Var(x_l)\\)Â çš„åŸºç¡€ä¸Šï¼Œåˆå¢åŠ äº†ä¸€ä¸ªæ­£æ•°Â \\(Var(S)\\)ã€‚ å› æ­¤ï¼Œéšç€ç½‘ç»œå±‚æ•°çš„åŠ æ·±ï¼ˆlÂ å˜å¤§ï¼‰ï¼Œ\\(x_l\\)Â çš„æ–¹å·®ä¼šåƒæ»šé›ªçƒä¸€æ ·ä¸æ–­ç´¯åŠ ï¼Œå¯¼è‡´ä¸»å¹²åˆ†æ”¯ä¸Šçš„æ•°å€¼è¶Šæ¥è¶Šå¤§ã€‚è¿™å¯èƒ½ä¼šåœ¨è®­ç»ƒåæœŸå¯¼è‡´æ•°å€¼ä¸ç¨³å®šã€‚ å¯¹æ¯” Post-Normï¼š åœ¨ Post-Norm ä¸­ï¼Œ\\(x_{l+1} = LayerNorm(...)\\)ã€‚æ— è®ºæ‹¬å·é‡Œçš„å€¼ \\((x_l + Sublayer(x_l))\\) æ–¹å·®å¤šå¤§ï¼Œç»è¿‡æœ€åçš„Â LayerNormÂ åï¼Œè¾“å‡ºÂ \\(x_{l+1}\\)Â çš„æ–¹å·®éƒ½ä¼šè¢«å¼ºåˆ¶é‡ç½®ä¸ºÂ 1ã€‚å› æ­¤ï¼ŒPost-Norm ä¸å­˜åœ¨æ–¹å·®ç´¯ç§¯å¢å¤§çš„é—®é¢˜ï¼Œä½†å®ƒä¹Ÿå› æ­¤å¸¦æ¥äº†è®­ç»ƒåˆæœŸä¸ç¨³å®šã€éœ€è¦ç‰¹æ®Šå­¦ä¹ ç‡çƒ­èº«ï¼ˆwarm-upï¼‰ç­‰å…¶ä»–é—®é¢˜ã€‚ Prenormå…¬å¼è¿˜æ„å‘³ç€ï¼Œæµç»ç½‘ç»œä¸»å¹²é“ï¼ˆå³Â x_0, x_1, x_2, â€¦ï¼‰çš„ä¿¡å·ï¼Œå…¶â€œèƒ½é‡â€ï¼ˆæ–¹å·®ï¼‰åœ¨ä¸€å±‚å±‚åœ°å•è°ƒé€’å¢ã€‚ç»è¿‡å‡ åä¸Šç™¾å±‚ç½‘ç»œåï¼Œx_lÂ çš„æ•°å€¼å¤§å°ï¼ˆå³æ¿€æ´»å€¼ï¼‰å°±ä¼šå˜å¾—éå¸¸å·¨å¤§ã€‚è¿™å°±æ˜¯â€œå·¨é‡æ¿€æ´»å€¼â€ï¼ˆmassive activationsï¼‰çš„ç›´æ¥æ¥æºã€‚ ç°åœ¨æˆ‘ä»¬æœ‰äº†â€œå·¨é‡æ¿€æ´»å€¼â€ï¼Œä¸ºä»€ä¹ˆè¿™ä¼šå¯¼è‡´è®­ç»ƒä¸ç¨³å®šå‘¢ï¼Ÿè¿™ä¸åå‘ä¼ æ’­å’Œå‚æ•°æ›´æ–°çš„æœºåˆ¶æœ‰å…³ã€‚ äº§ç”Ÿå·¨é‡æ¢¯åº¦Â (Massive Gradients)ï¼šåœ¨åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦æ—¶ï¼Œå¾ˆå¤šå±‚çš„æ¢¯åº¦éƒ½ä¸å…¶å‰å‘ä¼ æ’­æ—¶çš„æ¿€æ´»å€¼æˆæ­£æ¯”ã€‚ä¸¾ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œå¯¹äºä¸€ä¸ªæƒé‡Â Wï¼Œå®ƒçš„æ¢¯åº¦Â âˆ‚L/âˆ‚WÂ é€šå¸¸ä¼šåŒ…å«ä¸€ä¸ªä¸è¾“å…¥æ¿€æ´»å€¼Â xÂ ç›¸ä¹˜çš„é¡¹ã€‚å¦‚æœÂ xÂ æ˜¯ä¸€ä¸ªâ€œå·¨é‡æ¿€æ´»å€¼â€ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºçš„æ¢¯åº¦Â âˆ‚L/âˆ‚WÂ ä¹Ÿä¼šæ˜¯ä¸€ä¸ªâ€œå·¨é‡æ¢¯åº¦â€ã€‚ ç ´åä¼˜åŒ–å™¨çŠ¶æ€ (Corrupting Optimizer State)ï¼šåƒ Adam è¿™æ ·çš„ç°ä»£ä¼˜åŒ–å™¨ï¼Œä¼šç»´æŠ¤æ¢¯åº¦çš„å†å²ä¿¡æ¯ï¼ˆå¦‚ä¸€é˜¶çŸ©å’ŒäºŒé˜¶çŸ©çš„ç§»åŠ¨å¹³å‡ï¼‰ã€‚ä¸€ä¸ªçªç„¶å‡ºç°çš„å·¨é‡æ¢¯åº¦ä¼šä¸¥é‡â€œæ±¡æŸ“â€è¿™äº›å†å²å¹³å‡å€¼ï¼Œä½¿å¾—ä¼˜åŒ–å™¨å¯¹å­¦ä¹ ç‡çš„è‡ªé€‚åº”è°ƒæ•´äº§ç”Ÿå‰§çƒˆæ‘†åŠ¨ã€‚ ç¾éš¾æ€§çš„å‚æ•°æ›´æ–° (Catastrophic Weight Updates)ï¼šä¼˜åŒ–å™¨ä½¿ç”¨è¿™ä¸ªè¢«æ±¡æŸ“çš„å·¨é‡æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹æƒé‡ï¼šW_newÂ = W_old - lr * massive_gradientã€‚è¿™ä¸ªæ›´æ–°æ­¥é•¿ä¼šå¼‚å¸¸å·¨å¤§ï¼Œç›¸å½“äºåœ¨å¤æ‚çš„æŸå¤±åœ°å½¢ä¸Šè¿›è¡Œäº†ä¸€æ¬¡â€œç›²ç›®çš„ã€å¤§è·¨æ­¥çš„è·³è·ƒâ€ã€‚ æŸå¤±å°–å³°Â (Loss Spikes)ï¼šè¿™æ¬¡â€œå¤§è·³è·ƒâ€å¾ˆå¯èƒ½ä¼šè®©æ¨¡å‹å‚æ•°è·³åˆ°ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„ä½ç½®ï¼Œå¯¼è‡´æ¨¡å‹çš„é¢„æµ‹æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œè®­ç»ƒæŸå¤±ï¼ˆLossï¼‰ç¬é—´é£™å‡ï¼Œåœ¨è®­ç»ƒæ›²çº¿ä¸Šå°±å½¢æˆäº†ä¸€ä¸ªâ€œå°–å³°â€ã€‚ è®­ç»ƒå‘æ•£ (Training Divergence)ï¼šå¦‚æœè¿™ä¸ªâ€œå°–å³°â€è¿‡äºæç«¯ï¼Œå‚æ•°æ›´æ–°å¯èƒ½ä¼šå¯¼è‡´æ•°å€¼æº¢å‡ºï¼ˆinfï¼‰æˆ–éæ³•æ“ä½œï¼ˆNaNï¼‰ï¼Œæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å°±æ­¤å´©æºƒï¼Œå³â€œè®­ç»ƒå‘æ•£â€ã€‚ ","date":"2023-03-22","objectID":"/layer-norm/:4:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"Adamå¦‚ä½•ç¼“è§£æ¢¯åº¦æ¶ˆå¤± å…¶å®ã€‚æœ€å…³é”®çš„åŸå› æ˜¯ï¼Œåœ¨å½“å‰çš„å„ç§è‡ªé€‚åº”ä¼˜åŒ–æŠ€æœ¯â€œä¸‹ï¼Œæˆ‘ä»¬å·²ç»ä¸å¤§æ‹…å¿ƒæ¢¯åº¦æ¶ˆå¤±é—®é¢˜äº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œå½“å‰ NLP ä¸­ä¸»æµçš„ä¼˜åŒ–å™¨æ˜¯ Adam åŠå…¶å˜ç§ã€‚å¯¹äº Adam æ¥è¯´ï¼Œç”±äºåŒ…å«äº†åŠ¨é‡å’ŒäºŒé˜¶çŸ©æ ¡æ­£ï¼Œæ‰€ä»¥è¿‘ä¼¼æ¥çœ‹ï¼Œå®ƒçš„æ›´æ–°é‡å¤§è‡´ä¸Šä¸º \\[\\Delta\\theta=-\\eta\\frac{\\mathbb{E}_{t}[g_{t}]}{\\sqrt{\\mathbb{E}_{t}[g_{t}^{2}]}}\\] å¯ä»¥çœ‹åˆ°ï¼Œåˆ†å­åˆ†æ¯æ˜¯éƒ½æ˜¯åŒé‡çº²çš„ï¼Œå› æ­¤åˆ†å¼ç»“æœå…¶å®å°±æ˜¯ (1)çš„é‡çº§ï¼Œè€Œæ›´æ–°é‡å°±æ˜¯ (n)é‡çº§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç†è®ºä¸Šåªè¦æ¢¯åº¦çš„ç»å¯¹å€¼å¤§äºéšæœºè¯¯å·®ï¼Œé‚£ä¹ˆå¯¹åº”çš„å‚æ•°éƒ½ä¼šæœ‰å¸¸æ•°é‡çº§çš„æ›´æ–°é‡ï¼ˆæ„æ€å°±æ˜¯å‚æ•°çš„æ›´æ–°é‡ä¸æ¢¯åº¦çš„å…³ç³»ä¸æ˜¯å¾ˆå¤§ï¼Œå› æ­¤å—æ¢¯åº¦æ¶ˆå¤±å½±å“è¾ƒå°ï¼‰ï¼›è¿™è·Ÿ SGD ä¸ä¸€æ ·ï¼ŒSGD çš„æ›´æ–°é‡æ˜¯æ­£æ¯”äºæ¢¯åº¦çš„ï¼Œåªè¦æ¢¯åº¦å°ï¼Œæ›´æ–°é‡ä¹Ÿä¼šå¾ˆå°ï¼Œå¦‚æœæ¢¯åº¦ è¿‡å°ï¼Œé‚£ä¹ˆå‚æ•°å‡ ä¹ä¼šæ²¡è¢«æ›´æ–°ã€‚ æ‰€ä»¥ï¼ŒPost Norm çš„æ®‹å·®è™½ç„¶è¢«ä¸¥é‡å‰Šå¼±ï¼Œä½†æ˜¯åœ¨ baseã€large çº§åˆ«çš„æ¨¡å‹ä¸­ï¼Œå®ƒè¿˜ä¸è‡³äºå‰Šå¼±åˆ°å°äºéšæœºè¯¯å·®çš„åœ°æ­¥ï¼Œå› æ­¤é…åˆ Adam ç­‰ä¼˜åŒ–å™¨ï¼Œå®ƒè¿˜æ˜¯å¯ä»¥å¾—åˆ°æœ‰æ•ˆæ›´æ–°çš„ï¼Œä¹Ÿå°±æœ‰å¯èƒ½æˆåŠŸè®­ç»ƒäº†ã€‚å½“ç„¶ï¼Œåªæ˜¯æœ‰å¯èƒ½ï¼Œäº‹å®ä¸Šè¶Šæ·±çš„ Post Norm æ¨¡å‹ç¡®å®è¶Šéš¾è®­ç»ƒï¼Œæ¯”å¦‚è¦ä»”ç»†è°ƒèŠ‚å­¦ä¹ ç‡å’Œ Warmup ç­‰ ","date":"2023-03-22","objectID":"/layer-norm/:5:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"Deep-norm \\(æœ€åå†æä¸€ä¸‹DeepNetä¸­ç»“åˆPost-LN^+çš„è‰¯å¥½æ€§èƒ½ä»¥åŠPre-LNçš„è®­ç»ƒç¨³å®šæ€§åšå‡ºçš„æ”¹è‰¯\\)ã€‚ \\[X_{t+1}=Norm(\\alpha X_t+F_t(X_t))\\text{(6)}\\] \\(å®ƒåœ¨add normä¹‹å‰ç»™è¾“å…¥ä¹˜äº†ä¸€ä¸ªup-scale^+çš„å¸¸æ•°ç³»æ•° Î±\u003e1\\)ã€‚ ç°åœ¨ (5) çš„å±•å¼€ä¸ºï¼š \\[X_{t+1}=\\frac{\\alpha^{t+1}X_{0}}{\\sqrt{2}^{t+1}}+\\frac{\\alpha^{t}F_{0}(X_{0})}{\\sqrt{2}^{t+1}}+\\ldots+\\frac{\\alpha F_{t-1}(X_{t-1})}{\\sqrt{2}^{2}}+\\frac{F_{t}(X_{t})}{\\sqrt{2}}\\] å› ä¸º\\(\\alpha\u003e1\\) ,æ‰€ä»¥å®ƒèƒ½å¤Ÿåœ¨ä¿ç•™post-normçœŸæ­£å¢åŠ äº†æ·±åº¦è¿™ä¼˜ç‚¹çš„åŒæ—¶ï¼Œä¸€å®šç¨‹åº¦é¿å…äº†æ¢¯åº¦æ¶ˆå¤±ã€‚ï¼ˆæœ¬è´¨è¿˜æ˜¯post-normï¼‰ ","date":"2023-03-22","objectID":"/layer-norm/:6:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"å‚è€ƒ Transformeræ¢³ç†ï¼ˆä¸€ï¼‰ï¼šPost-Norm VS Pre-Norm - çŸ¥ä¹ (zhihu.com) æ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ - ç§‘å­¦ç©ºé—´|Scientific Spaces (kexue.fm) ä¸ºä»€ä¹ˆPre Normçš„æ•ˆæœä¸å¦‚Post Normï¼Ÿ - ç§‘å­¦ç©ºé—´|Scientific Spaces (kexue.fm) é¦™ä¾¬è¯» | Transformerä¸­warm-upå’ŒLayerNormçš„é‡è¦æ€§æ¢ç©¶ - çŸ¥ä¹ (zhihu.com) Bert/Transformer è¢«å¿½è§†çš„ç»†èŠ‚ï¼ˆæˆ–è®¸å¯ä»¥ç”¨æ¥åšé¢è¯•é¢˜ï¼‰ - çŸ¥ä¹ (zhihu.com) ","date":"2023-03-22","objectID":"/layer-norm/:7:0","tags":["Deep","Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"title":"Layer Norm","uri":"/layer-norm/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œhinge lossæ˜¯ä¸€ç§æŸå¤±å‡½æ•°ï¼Œå®ƒé€šå¸¸ç”¨äºâ€maximum-marginâ€çš„åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œå¦‚æ”¯æŒå‘é‡æœºã€‚æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š å…¶ä¸­Â \\(\\hat{y}\\)Â è¡¨ç¤ºé¢„æµ‹è¾“å‡ºï¼Œé€šå¸¸éƒ½æ˜¯è½¯ç»“æœï¼ˆå°±æ˜¯è¯´è¾“å‡ºä¸æ˜¯0ï¼Œ1è¿™ç§ï¼Œå¯èƒ½æ˜¯0.87ã€‚ï¼‰ï¼ŒÂ \\(y\\)Â è¡¨ç¤ºæ­£ç¡®çš„ç±»åˆ«ã€‚ - å¦‚æœÂ \\(\\hat{y}y\u003c1\\)Â ï¼Œåˆ™æŸå¤±ä¸ºï¼šÂ \\(1-\\hat{y}y\\) - å¦‚æœ\\(\\hat{y}y\u003e1\\)Â ï¼Œåˆ™æŸå¤±ä¸ºï¼š0 ","date":"2023-03-13","objectID":"/hinge-loss/:0:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","hinge loss"],"title":"hinge loss","uri":"/hinge-loss/"},{"categories":["é¢ç»"],"content":"å‰å‡ å¤©è¯•ç€æŠ•äº†ç®€å†ï¼Œæ²¡æƒ³åˆ°æœ‰ä¸¤å®¶çº¦äº†é¢è¯•ï¼Œä¸€ä¸ªæ˜¯å¾—ç‰©ä¸€ä¸ªæ˜¯åŒ—äº¬ç™¾åˆ†ç‚¹ï¼Œå¾—ç‰©é¢è¯•æ²¡æœ‰æ€ä¹ˆå‡†å¤‡ï¼Œå¤ªä»“ä¿ƒäº†ï¼ŒäºŒé¢æŒ‚äº†ï¼Œç™¾åˆ†ç‚¹æ‹¿åˆ°äº†offerï¼Œä½†å†³å®šè€ƒç ”äº†å°±æ²¡å»ï¼Œè®°å½•ä¸€ä¸‹é¢è¯•çš„é—®é¢˜ã€‚å²—ä½æ˜¯nlpç®—æ³•å²—ã€‚ ","date":"2023-03-10","objectID":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/:0:0","tags":["é¢ç»"],"title":"åŒ—äº¬ç™¾åˆ†ç‚¹é¢ç»","uri":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/"},{"categories":["é¢ç»"],"content":"ä¸€é¢ï¼šæŠ€æœ¯é¢ å…ˆè‡ªæˆ‘ä»‹ç»ï¼Œç„¶åä»‹ç»äº†ä¸€ä¸‹é¡¹ç›®ã€‚æ ¹æ®å°è±¡æé—®æœ‰ä»¥ä¸‹å†…å®¹ï¼š æœ‰æ²¡æœ‰æ•°æ®ä¸å¹³è¡¡é—®é¢˜ï¼Œæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿæ¬ é‡‡æ ·ï¼Œè¿‡é‡‡æ ·ï¼Œfocal lossï¼Œç€é‡ä»‹ç»äº†ä¸€ä¸‹focal lossçš„å‚æ•°å«ä¹‰ã€‚ å¯¹åˆ†ç±»é—®é¢˜æœ€åä¸€å±‚è¦æ€ä¹ˆåšï¼šmaxã€meanï¼Œå…¨è¿æ¥ æœ‰æ²¡æœ‰å°è¯•è¿‡åˆ«çš„æ¨¡å‹ï¼šæ²¡æœ‰ï¼Œç„¶åé¢è¯•å®˜è¯´å…¶å®textcnnå’Œfasttextæ•ˆæœä¸ä¸€å®šæ¯”bertæ•ˆæœå·®ã€‚ å¯¹ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œäº†è§£å—ï¼Ÿäº†è§£ã€‚ä»‹ç»ä¸€ä¸‹lstmã€‚æŒ‰ç…§ä¸‰ä¸ªé—¨åˆ†æå°±è¡Œï¼Œå“ªä¸ªé—¨æ˜¯ä»€ä¹ˆä½œç”¨ï¼Œæ³¨æ„ä¸€ä¸‹æ¿€æ´»å‡½æ•°çš„ä¸åŒã€‚ ä»‹ç»ä¸€ä¸‹bertï¼Œä»è¾“å…¥å¼€å§‹ä»‹ç»å°±è¡Œï¼ŒæŠŠä¸¤ä¸ªä»»åŠ¡ä¹Ÿå±•å¼€è¯´ä¸€ä¸‹ã€‚ ä»‹ç»ä¸€ä¸‹tfidfï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œè¯´ä¸€ä¸‹tfå’Œidfçš„å«ä¹‰å’Œå…¬å¼å°±è¡Œã€‚ æ•°æ®å¢å¼ºæ€ä¹ˆåšçš„ï¼ŸåŒä¹‰è¯æ›¿æ¢ã€å›è¯‘ã€‚ ä»‹ç»ä¸€ä¸‹æç¤ºå­¦ä¹ ã€‚è¯´ä¸€ä¸‹ä¸»è¦æ€æƒ³ï¼Œè¿˜æœ‰ç¦»æ•£promptså’Œè¿ç»­promptsã€‚ å¤§ä½“å°±è®°å¾—é—®äº†è¿™äº›ï¼Œæ€»ä½“æ¥è¯´ä¸æ˜¯å¾ˆéš¾ï¼Œè€Œä¸”å¤§å¤šæ•°éƒ½æ˜¯ç¥ç»ç½‘ç»œç›¸å…³çš„ï¼Œå‡†å¤‡äº†ä¸€äº›ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ–¹æ³•ä¹Ÿæ²¡æœ‰ç”¨ä¸Šã€‚ ç„¶åæ˜¯ä¸¤é“ç®—æ³•é¢˜ï¼š ç¬¬ä¸€é¢˜ï¼šå·²çŸ¥ä¸€éšæœºå‘ç”Ÿå™¨ï¼Œäº§ç”Ÿ0çš„æ¦‚ç‡æ˜¯pï¼Œäº§ç”Ÿ1çš„æ¦‚ç‡æ˜¯1-pï¼Œ ç°åœ¨è¦ä½ æ„é€ ä¸€ä¸ªå‘ç”Ÿå™¨ï¼Œ ä½¿å¾—å®ƒæ„é€ 0å’Œ1çš„æ¦‚ç‡å‡ä¸º 1/2ï¼› def res(): a = random() b = random() if a == 0 and b == 1: return 0 if a == 1 and b == 0: return 1 else: return res() ç”±äºéœ€è¦äº§ç”Ÿ1/2ï¼Œè€Œç”¨1ä½0ï¼Œæˆ–1ä½1æ— æ³•äº§ç”Ÿç­‰æ¦‚ç‡ï¼Œ å› æ­¤ï¼Œè€ƒè™‘å°†éšæœºæ•°æ‰©å±•æˆ2ä½ï¼š 00 pp 01 p(1-p) 10 (1-p)p 11 (1-p)(1-p) æœ‰ä¸Šè¿°åˆ†æçŸ¥é“ï¼Œ01å’Œ10æ˜¯ç­‰æ¦‚ç‡çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦äº§ç”Ÿ01å’Œ10å°±è¡Œäº†ã€‚ äºæ˜¯å¯ä»¥ï¼Œé‡åˆ°00å’Œ11å°±ä¸¢å¼ƒï¼Œåªè®°å½•01å’Œ10ã€‚å¯ä»¥ä»¤ï¼Œ01è¡¨ç¤º0,10è¡¨ç¤º1ï¼Œåˆ™ç­‰æ¦‚ç‡1/2äº§ç”Ÿ0å’Œ1äº†ã€‚ å½“æ—¶é¢è¯•å®˜é—®äº†è¿™ä¸ªé—®é¢˜çš„æ—¶å€™æœ‰ç‚¹æ‡µï¼Œå› ä¸ºä¹‹å‰ä»æ¥æ²¡æœ‰åšè¿‡ï¼Œä½†æ˜¯ç»è¿‡é¢è¯•å®˜çš„æç¤ºä¹Ÿæ˜¯å†™å‡ºæ¥äº†ã€‚ ç¬¬äºŒé¢˜æ˜¯LCSé—®é¢˜ï¼Œå°±æ˜¯æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜ï¼Œå½“æ—¶æƒ³åˆ°äº†ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä½†æ˜¯æ‡’å¾—åœ¨çº¸ä¸Šæ¨è½¬ç§»æ–¹ç¨‹äº†ï¼Œå°±ç›´æ¥æš´åŠ›è§£å†³äº†ã€‚ def LCS(s1, s2): dp = [[0 for _ in range(len(s1))] for _ in range(len(s2))] res = 0 for i in range(len(s1)): for j in range(i, len(s2)): if s1[i:j+1] in s2: res = max(res, j+1-i) return res print(LCS(\"baced\", \"acefg\")) ","date":"2023-03-10","objectID":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/:1:0","tags":["é¢ç»"],"title":"åŒ—äº¬ç™¾åˆ†ç‚¹é¢ç»","uri":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/"},{"categories":["é¢ç»"],"content":"äºŒé¢ç»¼åˆé¢ ä¸Šæ¥ä¹Ÿæ˜¯è‡ªæˆ‘ä»‹ç»åŠ é¡¹ç›®ä»‹ç»ï¼Œæœ‰äº›é—®é¢˜å’Œä¸€é¢é‡å¤äº†ï¼Œå°±ä¸èµ˜è¿°ã€‚ ä»‹ç»å‡ ç§bertçš„å˜ä½“ï¼Œalbertã€robertaï¼Œå°±ä»‹ç»äº†è¿™ä¸¤ç§ã€‚ bertçš„maskç­–ç•¥ã€‚ å…·ä½“çš„ä¹Ÿå¿˜äº†ï¼Œå½“æ—¶ä¹Ÿæ²¡æœ‰æƒ³ç›´æ¥è®°å½•ä¸‹æ¥ï¼Œåé¢å°±ç­‰åˆ°äº†å£å¤´offerï¼Œè¿‡å‡ å¤©ä¹Ÿå‘äº†æ­£å¼offerï¼Œä½†æ˜¯å› ä¸ºè¦è€ƒç ”ç­‰ä¸€äº›åŸå› å°±æ‹’äº†ï¼Œç­‰è€ƒå®Œç ”å†æ‰¾å§ã€‚è¿™æ¬¡åªåœ¨è½¯ä»¶ä¸ŠæŠ•äº†æŠ•ç®€å†ï¼Œæ²¡æœ‰å†…æ¨ç­‰ï¼Œè¿˜æ˜¯æŒºæœ‰æ”¶è·çš„ã€‚ ","date":"2023-03-10","objectID":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/:2:0","tags":["é¢ç»"],"title":"åŒ—äº¬ç™¾åˆ†ç‚¹é¢ç»","uri":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/"},{"categories":["é¢ç»"],"content":"æ€»ç»“ è¿™å‡ è½®é¢è¯•è¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„ï¼Œä¹Ÿç®—æ˜¯æ¨¡æ‹Ÿäº†ä»¥åçš„è€ƒç ”å¤è¯•ï¼Œè™½ç„¶ä»¥åå¤§æ¦‚ç‡æ˜¯çº¿ä¸‹å¤è¯•äº†ã€‚è¿˜æœ‰å°±æ˜¯ç®€å†ä¸Šæœ€æœ€é‡è¦çš„å°±æ˜¯å®ä¹ ç»å†ï¼Œæˆ‘ä¹‹å‰ä¹Ÿæ²¡æœ‰å®ä¹ ç»å†ï¼Œå› æ­¤æ²¡æœ‰å®ä¹ ç»å†çš„æƒ…å†µä¸‹æœ€é‡è¦çš„å°±æ˜¯é¡¹ç›®ï¼Œåˆ«çš„åŸºæœ¬ä¸Šéƒ½æ²¡æœ‰é—®ï¼Œä¸è¿‡è¿˜æ˜¯è¦ä¿è¯ä½ å†™ä¸Šå»çš„éƒ½æ˜¯çœŸçš„ä¼šçš„ã€‚å› æ­¤é‡è¦çš„å°±æ˜¯å®ä¹ å’Œé¡¹ç›®ï¼Œè·å¥–ç»å†å¯èƒ½åªæ˜¯ç»™é¢è¯•çš„æœºä¼šæ›´å¤§ä¸€äº›ã€‚è¿™æ¬¡æ‹’ç»offerå°‘äº†ä¸€æ¬¡å®ä¹ ç»å†è¿˜ç®—æœ‰ç‚¹å¯æƒœï¼Œä¸è¿‡ç›¸å¯¹è€Œè¨€è¿˜æ˜¯è€ƒç ”é‡è¦ä¸€äº›ã€‚ ","date":"2023-03-10","objectID":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/:3:0","tags":["é¢ç»"],"title":"åŒ—äº¬ç™¾åˆ†ç‚¹é¢ç»","uri":"/%E5%8C%97%E4%BA%AC%E7%99%BE%E5%88%86%E7%82%B9%E9%9D%A2%E7%BB%8F/"},{"categories":["ç®—æ³•é¢˜","ä¸²"],"content":"KMPæ˜¯å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜çš„ç®—æ³•ã€‚â€œå­—ç¬¦ä¸²Aæ˜¯å¦ä¸ºå­—ç¬¦ä¸²Bçš„å­ä¸²?å¦‚æœæ˜¯çš„è¯å‡ºç°åœ¨Bçš„å“ªäº›ä½ç½®?â€è¯¥é—®é¢˜å°±æ˜¯å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ï¼Œå­—ç¬¦ä¸²Aç§°ä¸ºæ¨¡å¼ä¸²ï¼Œå­—ç¬¦ä¸²Bç§°ä¸ºä¸»ä¸²ã€‚ ## BFç®—æ³• BFç®—æ³•å°±æ˜¯æš´åŠ›åŒ¹é…ï¼Œå³å¯¹ä¸»ä¸²ä»å¤´å¼€å§‹æ…¢æ…¢ç§»åŠ¨æ¨¡å¼ä¸²ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åŒ¹é…çš„ä½ç½®ã€‚ ä»£ç å¾ˆç®€å•æš´åŠ›ï¼š å‡è®¾nä¸ºä¸»ä¸²é•¿åº¦ï¼Œmä¸ºæ¨¡å¼ä¸²é•¿åº¦ã€‚ æ¯ä¸€è½®å­—ç¬¦ä¸²æ¯”è¾ƒï¼šæœ€å·®çš„æƒ…å†µä¸ºæ¨¡å¼ä¸²æœ€åä¸€ä¸ªå­—ä¸ä¸»ä¸²ä¸åŒå…¶ä»–éƒ½ç›¸åŒï¼ˆå¦‚æ¨¡å¼ä¸²ä¸ºAABï¼Œä¸»ä¸²å¯¹åº”éƒ¨åˆ†ä¸ºAACï¼‰ï¼Œå¿…é¡»èµ°å®Œæ•´ä¸ªå­—ç¬¦ä¸²æ‰èƒ½å¾—å‡ºç»“æœï¼Œå› æ­¤å¤æ‚åº¦ä¸ºO(m)ã€‚ æ‰€æœ‰è½®å­—ç¬¦ä¸²æ¯”è¾ƒï¼šæœ€å·®çš„æƒ…å†µæ˜¯ç§»åŠ¨åˆ°æœ€åä¸€æ¬¡æ¯”è¾ƒæ‰å¯»æ‰¾å¾—åˆ°ï¼Œæ€»å…±éœ€è¦n-m+1æ¬¡ï¼Œä¸»ä¸²é€šå¸¸æ¯”æ¨¡å¼ä¸²é•¿å¾ˆå¤šï¼Œæ•…Brute-Forceæ—¶é—´å¤æ‚åº¦ä¸ºO(nm) åœ¨åŒ¹é…ä¸Šæ²¡æœ‰åŠæ³•è¿›è¡Œä¼˜åŒ–ï¼Œå› æ­¤å¯ä»¥ä»æ¨¡å¼ä¸²çš„ç§»åŠ¨ä¸Šå…¥æ‰‹ï¼Œç”±æ­¤å¼•å…¥äº†Kmpç®—æ³•ã€‚ ","date":"2023-03-08","objectID":"/kmp/:0:0","tags":["ç®—æ³•é¢˜","ä¸²"],"title":"KMP","uri":"/kmp/"},{"categories":["ç®—æ³•é¢˜","ä¸²"],"content":"KMP KMP ç®—æ³•çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šèŠ±è´¹ç©ºé—´æ¥è®°å½•ä¸€äº›ä¿¡æ¯ã€‚ç›®çš„å°±æ˜¯ä¸ºäº†å‡å°‘åŒ¹é…çš„è¶Ÿæ•°ï¼Œç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æ¯æ¬¡åŒ¹é…è¿‡ç¨‹ä¸­æ¨æ–­å‡ºåç»­å®Œå…¨ä¸å¯èƒ½åŒ¹é…æˆåŠŸçš„åŒ¹é…è¿‡ç¨‹ï¼Œä»è€Œå‡å°‘æ¯”è¾ƒçš„è¶Ÿæ•°ã€‚ ","date":"2023-03-08","objectID":"/kmp/:1:0","tags":["ç®—æ³•é¢˜","ä¸²"],"title":"KMP","uri":"/kmp/"},{"categories":["ç®—æ³•é¢˜","ä¸²"],"content":"Nextæ•°ç»„ nextæ•°ç»„å®è´¨ä¸Šå°±æ˜¯æ‰¾å‡ºæ¨¡å¼ä¸²ä¸­å‰åå­—ç¬¦é‡å¤å‡ºç°çš„ä¸ªæ•°ï¼Œä¸ºäº†èƒ½å¤Ÿè·³è·ƒä¸å¯èƒ½åŒ¹é…çš„æ­¥éª¤ã€‚ nextæ•°ç»„çš„å®šä¹‰ä¸ºï¼šnext[i]è¡¨ç¤ºæ¨¡å¼ä¸²A[0]è‡³A[i]è¿™ä¸ªå­—ä¸²ï¼Œä½¿å¾—å‰kä¸ªå­—ç¬¦ç­‰äºåkä¸ªå­—ç¬¦çš„æœ€å¤§å€¼ï¼Œç‰¹åˆ«çš„kä¸èƒ½å–i+i,å› ä¸ºå­—ä¸²ä¸€å…±æ‰i+1ä¸ªå­—ç¬¦ï¼Œè‡ªå·±è·Ÿè‡ªå·±ç›¸ç­‰æ¯«æ— æ„ä¹‰ã€‚ å¦‚ä½•ç¡®å®šåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­éœ€è¦è·³è¿‡å¤šå°‘æ­¥å‘¢ï¼Ÿä¸‹å›¾æ›´ç›´è§‚çš„ä½“ç°äº†è·³è·ƒçš„è¿‡ç¨‹ï¼š ä¹Ÿå°±æ˜¯è·³åˆ°æ¨¡å¼ä¸²ä¸­çš„åç¼€ç›¸åŒå­—ç¬¦ä¸²å¼€å§‹ã€‚å› ä¸ºè¿™æ—¶å¯ä»¥ç¡®å®šå‰é¢çš„å­—ç¬¦ä¸²è‚¯å®šæ— æ³•åŒ¹é…äº†ï¼Œè¿‡çš„è¶Ÿæ•°=åŒ¹é…ä¸Šå­—ç¬¦ä¸²ä¸­é—´å­—ç¬¦é•¿åº¦-é‡å¤å­—ç¬¦ä¸²é•¿åº¦ åœ¨å®é™…ä»£ç ç¼–å†™ä¸­ï¼Œç§»åŠ¨çš„å®é™…ä¸Šæ˜¯æ¨¡å¼ä¸²çš„åŒ¹é…ä½ç½®ã€‚å‰é¢å±•ç¤ºçš„åªæ˜¯ç†è§£å‡å°åŒ¹é…æ¬¡æ•°è¿™ä¸€è¿‡ç¨‹ã€‚å®é™…ä¸Šè·³åŠ¨å°±æ˜¯æ¨¡å¼ä¸²æ¯”è¾ƒæŒ‡é’ˆçš„ç§»åŠ¨ã€‚æ¨¡å¼ä¸²å‘å³ç§»åŠ¨ä¹Ÿå°±æ˜¯æ¯”è¾ƒæŒ‡é’ˆå‘å·¦ç§»åŠ¨ï¼Œç§»åŠ¨çš„è·ç¦»å°±æ˜¯è·³è¿‡çš„è¶Ÿæ•° ç§»åŠ¨åçš„æŒ‡é’ˆä¸ºï¼š\\(j=j-(j-next[j-1]) =next[j-1]\\) å…¶ä¸­åŸæ¥çš„jä¸ºåŒ¹é…æˆåŠŸçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å¤±è´¥çš„æŒ‡é’ˆä½ç½®ã€‚next[j-1]å°±æ˜¯åŒ¹é…æˆåŠŸçš„å­—ç¬¦ä¸²çš„æœ€é•¿ç›¸åŒå‰åç¼€æ•°ï¼Œä¹Ÿå°±æ˜¯è¦è·³è½¬åˆ°çš„æŒ‡é’ˆçš„ä¸‹æ ‡ã€‚ï¼ˆä¸‹æ ‡ä»0å¼€å§‹çš„ï¼Œå¦‚æœä¸‹æ ‡ä»1å¼€å§‹åˆ™åœ¨åŸæ¥åŸºç¡€ä¸Š+1å°±æ˜¯è¦è·³è½¬åˆ°çš„ä½ç½®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¹¦ä¸Šè¦+1ï¼‰ã€‚ å³ä¸‹å›¾æ‰€ç¤ºã€‚ ç„¶åå†ç”¨ç§»åŠ¨åçš„æŒ‡é’ˆå’Œä¸»ä¸²çš„ä¸Šä¸€è½®åŒ¹é…é”™è¯¯çš„ä½ç½®ç›¸æ¯”ï¼Œè¿™æ—¶å·²ç»ä¿è¯äº†å‰é¢çš„å­—ç¬¦å·²ç»åŒ¹é…äº†ï¼Œå³å½“å‰æŒ‡é’ˆå‰é¢çš„å­ä¸²å·²ç»å’Œä¸Šä¸€è½®åŒ¹é…æˆåŠŸçš„å­ä¸²çš„æœ€é•¿åç¼€ç›¸åŒäº†ã€‚ å› æ­¤å¯ä»¥çœ‹åˆ°ï¼ŒKmpç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æ„é€ Nextæ•°ç»„ã€‚ æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ ¹æ®å®šä¹‰æš´åŠ›æ„é€ æ—¶é—´å¤æ‚åº¦ä¸ºO(m2æ³•)ï¼šï¼š ç¬¬äºŒç§æ„å»ºæ–¹æ¡ˆï¼Œæ˜¯ä¸€ç§é€’æ¨çš„æ–¹å¼è¿›è¡Œæ„å»ºï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n+m): è€ƒè™‘ï¼šå¦‚æœnext[0], next[1], â€¦ next[x-1]å‡å·²çŸ¥ï¼Œé‚£ä¹ˆå¦‚ä½•æ±‚å‡º next[x] ï¼Ÿæˆ‘ä»¬å·²ç»çŸ¥é“next[x-1],æ ‡è®°next[x-1]=temp,åˆ™å¯ä»¥è®¨è®ºA[temp]å’ŒA[x]çš„å€¼ï¼Œåˆ†2ç§æƒ…å†µè®¨è®ºï¼š ç¬¬ä¸€ç§æƒ…å†µï¼šA[temp]ç­‰äºA[x]ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å‰ä¸€ä¸ªnextç»“æœä¸Šåˆå¤šäº†ä¸€ä¸ªå­—ç¬¦ä¸²ç›¸åŒçš„é•¿åº¦ï¼Œå› æ­¤next[x]ä¸ºnext[x-1]+1 è¿™ç§æƒ…å†µè¯´æ˜äº†x-1æ—¶æœ€é•¿å‰ç¼€çš„åä¸€ä½å’Œxä½ç½®çš„å­—ç¬¦ç›¸åŒï¼Œåˆ™è¯´æ˜äº†å‰ç¼€å’Œåç¼€éƒ½å¢åŠ äº†ç›¸åŒçš„1ä½ï¼Œnext[x] = next[x-1] + 1ã€‚ ï¼ˆè¿™é‡Œç»™ä¸€ä¸‹æˆ‘è‡ªå·±çš„ç†è§£ï¼Œå› ä¸ºnextä¸­ä¿å­˜çš„æ˜¯å‰åç¼€æœ€å¤§ç›¸åŒçš„é•¿åº¦ï¼Œå› æ­¤é€šå¸¸ä»£è¡¨ç€æœ€å¤§ç›¸åŒå‰ç¼€çš„åä¸€ä½ï¼‰ ç¬¬äºŒç§æƒ…å†µï¼šå½“A[temp]å’ŒA[x]ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç¼©å°temp,æŠŠtempå˜æˆnext[temp-1]ï¼Œç›´åˆ°A[temp]=A[x]ä¸ºæ­¢ã€‚A[now]=A[x]æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥å‘å³æ‰©å±•äº†ã€‚ å¦‚ä½•ç†è§£è¿™å¼ å›¾ï¼Œå½“å‘ç°A[temp] != A[x]çš„æ—¶å€™ï¼Œå°±ä¸€ç›´ç¼©å°tempï¼Œä¹Ÿå°±æ˜¯temp = next[temp-1]ï¼Œä¹Ÿå°±æ˜¯æ‰¾åŸæ¥çš„æœ€é•¿å‰ç¼€ä¸­å¯¹åº”çš„next[temp-1]ï¼Œå› ä¸ºå‰ç¼€ä¸­çš„ç›¸åŒå‰åç¼€æœ€å¤§é•¿åº¦ï¼ˆå›¾ä¸­ä¸º2ï¼‰è‚¯å®šä¹Ÿä¸åç¼€ä¸­çš„ç›¸åŒå‰åç¼€æœ€å¤§é•¿åº¦ï¼ˆå›¾ä¸­ä¸º2ï¼‰ç›¸åŒï¼Œä¹Ÿè¯´æ˜äº†å‰ç¼€ä¸­çš„å‰ç¼€ï¼ˆå›¾ä¸­ä¸º0å’Œ1ä¸Šçš„Aå’ŒBï¼‰ç­‰äºåç¼€ä¸­çš„åç¼€ï¼ˆå›¾ä¸­ä¸º10å’Œ11ä¸Šçš„Aå’ŒBï¼‰ï¼Œæ­¤æ—¶è¿˜æ˜¯åŸæ¥çš„æ€è·¯tempä¸ºå‰ç¼€ä¸­çš„å‰ç¼€çš„ä¸‹ä¸€ä½ï¼Œåˆ¤æ–­æ˜¯å¦ä¸åç¼€ä¸­çš„åç¼€çš„ä¸‹ä¸€ä½ç›¸åŒï¼ˆå°±æ˜¯å½“å‰çš„A[x]ï¼‰ï¼Œå¦‚æœç›¸åŒå°±æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œnext[x] = temp + 1ï¼Œå¦‚æœä¸€ç›´æ²¡æ‰¾åˆ°åˆ™è®¾ä¸º0ï¼Œè¯´æ˜æ²¡æœ‰ã€‚ å­¦åˆ°è¿™ä¸å¾—ä¸æ„Ÿå¹kmpä¸‰ä½å¤§ä½¬çš„ææ€–ã€‚ã€‚ å¤§ä½“çš„æ€æƒ³å°±æ˜¯è¿™æ ·ï¼Œä¸è¿‡å¦‚æœå¯¹äºåšé¢˜æ¥è¯´çš„è¯ï¼Œæœ‰å¾ˆå¤šä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç‹é“ä¹¦ä¸Šçš„nextæ•°ç»„æ˜¯ä»ä¸‹æ ‡1å¼€å§‹çš„ï¼Œå¯¹äºæœ¬æ–‡çš„å†…å®¹ï¼Œéœ€è¦å¾—åˆ°åŒ¹é…å¤±è´¥ä½ç½®-1çš„nextæ•°ç»„å€¼ï¼Œå› æ­¤ä¹¦ä¸Šå°†æ•´ä½“å³ç§»äº†ä¸€ä½ï¼Œå¼€å¤´è¡¥ä¸Šäº†-1ï¼Œè¿™æ ·åŒ¹é…å¤±è´¥çš„ä½ç½®å°±æ˜¯å¯¹åº”çš„nextæ•°ç»„å€¼ã€‚åˆä¸‹ä¸€æ¬¡åŒ¹é…è¦ä»æœ€é•¿å‰ç¼€çš„ä¸‹ä¸€ä½å¼€å§‹ï¼Œè€Œå¯¹äºä¸‹æ ‡ä»0å¼€å§‹ï¼Œnextæ•°ç»„å€¼å°±æ˜¯ä¸‹ä¸€ä½ï¼ˆå‰é¢è§£é‡Šäº†ï¼‰ï¼Œè€Œå¯¹äºä¸‹æ ‡ä»1å¼€å§‹ï¼Œéœ€è¦å†+1æ‰æ˜¯å¯¹åº”ä¸‹æ ‡ï¼Œå› æ­¤ä¹Ÿå¯¹nextæ•°ç»„æœ€åè¿›è¡Œäº†+1æ“ä½œã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œnextçš„å«ä¹‰éƒ½æ˜¯æœ€é•¿å‰ç¼€çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚ä¸»è¦æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéšæœºåº”å˜å³å¯ã€‚ ","date":"2023-03-08","objectID":"/kmp/:1:1","tags":["ç®—æ³•é¢˜","ä¸²"],"title":"KMP","uri":"/kmp/"},{"categories":["ç®—æ³•é¢˜","ä¸²"],"content":"ä»£ç ï¼š class KMP: def __init__(self, text, pattern) -\u003e None: self.text = text self.pattern = pattern self.next = [] def init_next(self): self.next.append(0) # first for i, s in enumerate(self.pattern[1:], 1): tmp = self.next[i-1] if s == self.pattern[tmp]: self.next.append(tmp + 1) else: while self.pattern[tmp] != s and tmp != 0: tmp = self.next[tmp-1] if tmp == 0 and self.pattern[tmp] != s: self.next.append(0) continue self.next.append(tmp + 1) def search(self): i = 0 # text index j = 0 # partten index while i \u003c len(self.text): if self.text[i] == self.pattern[j]: i += 1 j += 1 elif j: j = self.next[j-1] else: i += 1 if j == len(self.pattern): return i - j return -1 kmp = KMP(\"hello\", \"ll\") kmp.init_next() print(kmp.search()) print(kmp.next) ","date":"2023-03-08","objectID":"/kmp/:1:2","tags":["ç®—æ³•é¢˜","ä¸²"],"title":"KMP","uri":"/kmp/"},{"categories":["ç®—æ³•é¢˜","ä¸²"],"content":"nextval è¿˜æœ‰ä¸€ç§æ”¹è¿›çš„nextï¼Œå› ä¸ºåŒ¹é…é”™è¯¯çš„ä½ç½®é‡æ–°ç§»åŠ¨æŒ‡é’ˆåçš„ä½ç½®çš„å€¼å¯èƒ½ä¸åŸæ¥çš„å€¼ç›¸åŒï¼Œå› æ­¤åœ¨æ„å»ºnextæ•°ç»„çš„æ—¶å€™å¯ä»¥ç›´æ¥è·³è½¬åˆ°ä¸ç›¸åŒçš„ä½ç½®ï¼Œè¿™æ ·å°±å‡å°äº†é‡å¤çš„æ¯”è¾ƒã€‚ æ¯”å¦‚aaabaaaabå’Œaaaabï¼Œå½“åœ¨ä¸»ä¸²ä¸­ç¬¬ä¸€ä¸ªbä½ç½®å‡ºé”™æ—¶ï¼Œæ­¤æ—¶æ¨¡å¼ä¸²ä¸ºaï¼Œä¼šæ¯”è¾ƒstr[next[2]]ä¸bï¼Œä½†æ­¤æ—¶str[next[2]]ä¹Ÿæ˜¯aï¼Œå†æ¬¡æ¯”è¾ƒä¹Ÿä¼šé”™è¯¯ï¼Œä½†å†ç§»åŠ¨åå‘ç°è¿˜æ˜¯aè¿˜æ˜¯é”™è¯¯ï¼Œè¿™äº›æ¯”è¾ƒéƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæœ€åè¦ç§»åŠ¨åˆ°æ¨¡å¼ä¸²å¼€å¤´ï¼Œç„¶åå°†ä¸»ä¸²æŒ‡é’ˆ+1å†æ¯”è¾ƒï¼Œæ‰€ä»¥æ„å»ºnextvalå‡å°‘äº†è¿™äº›æ¯”è¾ƒã€‚ æˆ‘æ˜¯æ ¹æ®å·²ç»æ„å»ºå¥½çš„nextæ•°ç»„æ¨ç†æ¥çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š def create_nextval(self): length = len(self.pattern) self.nextval = [0] * length for i in range(1, len(self.next)): tmp = self.next[i-1] if self.pattern[tmp] != self.pattern[i]: self.nextval[i-1] = tmp else: while tmp and self.pattern[tmp] == self.pattern[i]: tmp = self.next[tmp-1] self.nextval[i-1] = tmp å› ä¸ºç”¨ä¸åˆ°æœ€åä¸€ä½çš„æ•°å€¼ï¼Œæ‰€ä»¥è€ƒç ”ä¹¦ä¸Šå°±ç›´æ¥å…¨éƒ¨å³ç§»ä¸€ä½ï¼Œç†è®ºä¸Šéƒ½æ˜¯ç›¸åŒçš„ã€‚åŸç†å°±æ˜¯åŒ¹é…é”™è¯¯çš„ä½ç½®çš„å­—ç¬¦å’Œè¦è·³è½¬åˆ°çš„ä½ç½®çš„å­—ç¬¦ç›¸åŒçš„è¯å°±è¦ç»§ç»­è·³è½¬ç›´åˆ°ç­‰äº0æˆ–è€…ä¸ç›¸åŒä¸ºæ­¢ã€‚ ","date":"2023-03-08","objectID":"/kmp/:1:3","tags":["ç®—æ³•é¢˜","ä¸²"],"title":"KMP","uri":"/kmp/"},{"categories":["Machine Learning"],"content":"ç‰¹å¾é€‰æ‹©æ˜¯ç‰¹å¾å·¥ç¨‹é‡Œçš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå…¶ç›®æ ‡æ˜¯å¯»æ‰¾æœ€ä¼˜ç‰¹å¾å­é›†ã€‚ç‰¹å¾é€‰æ‹©èƒ½å‰”é™¤ä¸ç›¸å…³(irrelevant)æˆ–å†—ä½™(redundant )çš„ç‰¹å¾ï¼Œä»è€Œè¾¾åˆ°å‡å°‘ç‰¹å¾ä¸ªæ•°ï¼Œæé«˜æ¨¡å‹ç²¾ç¡®åº¦ï¼Œå‡å°‘è¿è¡Œæ—¶é—´çš„ç›®çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œé€‰å–å‡ºçœŸæ­£ç›¸å…³çš„ç‰¹å¾ç®€åŒ–æ¨¡å‹ï¼ŒååŠ©ç†è§£æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹ã€‚å¹¶ä¸”å¸¸èƒ½å¬åˆ°â€œæ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²â€ï¼Œç”±æ­¤å¯è§å…¶é‡è¦æ€§ã€‚ä½†æ˜¯å®ƒå‡ ä¹å¾ˆå°‘å‡ºç°äºæœºå™¨å­¦ä¹ ä¹¦æœ¬é‡Œé¢çš„æŸä¸€ç« ã€‚ç„¶è€Œåœ¨æœºå™¨å­¦ä¹ æ–¹é¢çš„æˆåŠŸå¾ˆå¤§ç¨‹åº¦ä¸Šåœ¨äºå¦‚æœä½¿ç”¨ç‰¹å¾å·¥ç¨‹ã€‚ æ ¹æ®ç‰¹å¾é€‰æ‹©çš„å½¢å¼ï¼Œå¯åˆ†ä¸ºä¸‰å¤§ç±»ï¼š - Filter(è¿‡æ»¤æ³•)ï¼šæŒ‰ç…§å‘æ•£æ€§æˆ–ç›¸å…³æ€§å¯¹å„ä¸ªç‰¹å¾è¿›è¡Œè¯„åˆ†ï¼Œè®¾å®šé˜ˆå€¼æˆ–è€…å¾…é€‰æ‹©ç‰¹å¾çš„ä¸ªæ•°è¿›è¡Œç­›é€‰ - Wrapper(åŒ…è£…æ³•)ï¼šæ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆå¾€å¾€æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ï¼Œæˆ–è€…æ’é™¤è‹¥å¹²ç‰¹å¾ - Embedded(åµŒå…¥æ³•)ï¼šå…ˆä½¿ç”¨æŸäº›æœºå™¨å­¦ä¹ çš„æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°å„ä¸ªç‰¹å¾çš„æƒå€¼ç³»æ•°ï¼Œæ ¹æ®ç³»æ•°ä»å¤§åˆ°å°é€‰æ‹©ç‰¹å¾ï¼ˆç±»ä¼¼äºFilterï¼Œåªä¸è¿‡ç³»æ•°æ˜¯é€šè¿‡è®­ç»ƒå¾—æ¥çš„ï¼‰ ## è¿‡æ»¤å¼ åŸºæœ¬æƒ³æ³•æ˜¯ï¼šåˆ†åˆ«å¯¹æ¯ä¸ªç‰¹å¾ \\(x_i\\) ï¼Œè®¡ç®— \\(x_i\\) ç›¸å¯¹äºç±»åˆ«æ ‡ç­¾ y çš„ä¿¡æ¯é‡ S(i) ï¼Œå¾—åˆ° n ä¸ªç»“æœã€‚ç„¶åå°† n ä¸ª S(i) æŒ‰ç…§ä»å¤§åˆ°å°æ’åºï¼Œè¾“å‡ºå‰ k ä¸ªç‰¹å¾ã€‚æ˜¾ç„¶ï¼Œè¿™æ ·å¤æ‚åº¦å¤§å¤§é™ä½ã€‚é‚£ä¹ˆå…³é”®çš„é—®é¢˜å°±æ˜¯ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ–¹æ³•æ¥åº¦é‡ S(i) ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é€‰å–ä¸ y å…³è”æœ€å¯†åˆ‡çš„ä¸€äº› ç‰¹å¾\\(x_i\\) ã€‚ - Pearsonç›¸å…³ç³»æ•° - å¡æ–¹éªŒè¯ - äº’ä¿¡æ¯å’Œæœ€å¤§ä¿¡æ¯ç³»æ•° - è·ç¦»ç›¸å…³ç³»æ•° - æ–¹å·®é€‰æ‹©æ³• ### ","date":"2023-03-08","objectID":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/:0:0","tags":["Machine Learning","ç‰¹å¾é€‰æ‹©"],"title":"ç‰¹å¾é€‰æ‹©","uri":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/"},{"categories":["Machine Learning"],"content":"åŒ…è£¹å¼ ","date":"2023-03-08","objectID":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/:1:0","tags":["Machine Learning","ç‰¹å¾é€‰æ‹©"],"title":"ç‰¹å¾é€‰æ‹©","uri":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/"},{"categories":["Machine Learning"],"content":"åµŒå…¥å¼ ","date":"2023-03-08","objectID":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/:2:0","tags":["Machine Learning","ç‰¹å¾é€‰æ‹©"],"title":"ç‰¹å¾é€‰æ‹©","uri":"/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"ä»‹ç» æ—©åœæ­¢ï¼ˆEarly Stoppingï¼‰æ˜¯Â å½“è¾¾åˆ°æŸç§æˆ–æŸäº›æ¡ä»¶æ—¶ï¼Œè®¤ä¸ºæ¨¡å‹å·²ç»æ”¶æ•›ï¼Œç»“æŸæ¨¡å‹è®­ç»ƒï¼Œä¿å­˜ç°æœ‰æ¨¡å‹çš„ä¸€ç§æ‰‹æ®µã€‚ å¦‚ä½•åˆ¤æ–­å·²ç»æ”¶æ•›ï¼Ÿä¸»è¦çœ‹ä»¥ä¸‹å‡ ç‚¹ï¼š - éªŒè¯é›†ä¸Šçš„Lossåœ¨æ¨¡å‹å¤šæ¬¡è¿­ä»£åï¼Œæ²¡æœ‰ä¸‹é™ - éªŒè¯é›†ä¸Šçš„Losså¼€å§‹ä¸Šå‡ã€‚ è¿™æ—¶å°±å¯ä»¥è®¤ä¸ºæ¨¡å‹æ²¡æœ‰å¿…è¦è®­ç»ƒäº†ï¼Œå¯ä»¥åœæ­¢äº†ï¼Œå› ä¸ºè®­ç»ƒä¸‹å»å¯èƒ½å°±ä¼šå‘ç”Ÿè¿‡æ‹Ÿåˆï¼Œæ‰€ä»¥æ—©åœæ³•æ˜¯ä¸€ç§é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆçš„æ–¹æ³•ã€‚ ","date":"2023-03-06","objectID":"/early-stopping/:1:0","tags":["Deep Learning","è®­ç»ƒtrick","early-stopping"],"title":"early-stopping","uri":"/early-stopping/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"ä»£ç  import numpy as np import torch import os class EarlyStopping: \"\"\"Early stops the training if validation loss doesn't improve after a given patience.\"\"\" def __init__(self, save_path, patience=7, verbose=False, delta=0): \"\"\" Args: save_path : æ¨¡å‹ä¿å­˜æ–‡ä»¶å¤¹ patience (int): How long to wait after last time validation loss improved. Default: 7 verbose (bool): If True, prints a message for each validation loss improvement. Default: False delta (float): Minimum change in the monitored quantity to qualify as an improvement. Default: 0 \"\"\" self.save_path = save_path self.patience = patience self.verbose = verbose self.counter = 0 self.best_score = None self.early_stop = False self.val_loss_min = np.Inf self.delta = delta def __call__(self, val_loss, model): score = -val_loss if self.best_score is None: self.best_score = score self.save_checkpoint(val_loss, model) elif score \u003c self.best_score + self.delta: self.counter += 1 print(f'EarlyStopping counter: {self.counter} out of {self.patience}') if self.counter \u003e= self.patience: self.early_stop = True else: self.best_score = score self.save_checkpoint(val_loss, model) self.counter = 0 def save_checkpoint(self, val_loss, model): '''Saves model when validation loss decrease.''' if self.verbose: print(f'Validation loss decreased ({self.val_loss_min:.6f} --\u003e {val_loss:.6f}). Saving model ...') path = os.path.join(self.save_path, 'best_network.pth') torch.save(model.state_dict(), path) # è¿™é‡Œä¼šå­˜å‚¨è¿„ä»Šæœ€ä¼˜æ¨¡å‹çš„å‚æ•° self.val_loss_min = val_loss ","date":"2023-03-06","objectID":"/early-stopping/:2:0","tags":["Deep Learning","è®­ç»ƒtrick","early-stopping"],"title":"early-stopping","uri":"/early-stopping/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"Focal Loss Focal Lossä¸»è¦æ˜¯ä¸ºäº†è§£å†³ç±»åˆ«ä¸å¹³è¡¡çš„é—®é¢˜ï¼ŒFocal Losså¯ä»¥è¿ç”¨äºäºŒåˆ†ç±»ï¼Œä¹Ÿå¯ä»¥è¿ç”¨äºå¤šåˆ†ç±»ã€‚ä¸‹é¢ä»¥äºŒåˆ†ç±»ä¸ºä¾‹ï¼š ","date":"2023-03-06","objectID":"/focal-loss/:0:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"åŸå§‹Loss åŸå§‹çš„äºŒåˆ†ç±»ï¼š å…¶ä¸­ æ‰€ä»¥ï¼š å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºCEå°±æ˜¯softmaxåœ¨äºŒåˆ†ç±»çš„å½¢å¼ï¼Œå®é™…è¿ç®—ä¸­åªå…³æ³¨å¯¹åº”æ ‡ç­¾çš„æ¦‚ç‡ï¼Œå¯¹äºäºŒåˆ†ç±»ï¼Œå¦‚æœæ˜¯è´Ÿæ ·æœ¬çš„è¯ï¼Œé¢„æµ‹æ¦‚ç‡å°äº0.5åˆ™è¯´æ˜é¢„æµ‹æ­£ç¡®ï¼Œåˆ™å¯¹åº”çš„å®é™…çš„æ¦‚ç‡åº”è¯¥ä¸º1-pã€‚æœ€å¤§åŒ–æ¦‚ç‡ï¼Œå°±æ˜¯æœ€å¤§åŒ–Logæ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯æœ€å°åŒ–-logæ¦‚ç‡ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:0:1","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"ä»€ä¹ˆæ˜¯æ˜“åˆ†ç±»æ ·æœ¬ å¯¹äºæ­£æ ·æœ¬ï¼Œå¦‚æœé¢„æµ‹çš„ç»“æœæ€»æ˜¯åœ¨0.5ä»¥ä¸Šï¼Œå°±æ˜¯æ˜“åˆ†ç±»æ ·æœ¬ï¼Œå¦‚æœæ€»æ˜¯åœ¨0.5ä»¥ä¸‹ï¼Œåˆ™è¯´æ˜æ˜¯éš¾åˆ†ç±»æ ·æœ¬ã€‚ å¯¹äºè´Ÿæ ·æœ¬ï¼Œå¦‚æœé¢„æµ‹çš„ç»“æœæ€»æ˜¯åœ¨0.5ä»¥ä¸‹ï¼Œå°±æ˜¯æ˜“åˆ†ç±»æ ·æœ¬ï¼Œå¦‚æœæ€»æ˜¯åœ¨0.5ä»¥ä¸Šï¼Œåˆ™è¯´æ˜æ˜¯éš¾åˆ†ç±»æ ·æœ¬ã€‚ å¯¹åº”\\(p_t\\)æ¥è¯´ï¼Œå°±æ˜¯\\(p_t\u003e0.5\\)ä¸ºæ˜“åˆ†ç±»ï¼Œ\\(p_t\u003c0.5\\)ä¸ºéš¾åˆ†ç±»ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:0:2","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"gammaå‚æ•° åœ¨æ¨¡å‹è®­ç»ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›å…³æ³¨éš¾åˆ†ç±»çš„æ ·æœ¬ï¼Œå› æ­¤focal lossåœ¨åŸå§‹lossä¸Šå¢åŠ äº†ä¸€é¡¹ï¼Œå¯¹æ•´ä½“è¿›è¡Œäº†è¡°å‡ï¼š å¯¹äºå…¬å¼ä¸­çš„å‚æ•°\\(\\gamma\\)ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©2ï¼Œå¯¹äºæ˜“åˆ†ç±»çš„æ ·æœ¬ï¼Œå³\\(p_t\u003e0.5\\)çš„æ ·æœ¬ï¼Œ\\(1-p_t\\)åˆ™ä¼šå°äº0.5ï¼Œåˆ™lossä¼šè¡°å‡çš„æ›´å¤šï¼Œæœ€ç»ˆçš„æŸå¤±å°±å˜çš„å¾ˆå°ã€‚è€Œå¯¹äºéš¾åˆ†ç±»çš„æ ·æœ¬ï¼Œlossä¼šè¡°å‡çš„æ¯”è¾ƒå°ï¼Œé€šè¿‡è¿™ç§è¡°å‡çš„å¯¹æ¯”ï¼Œåˆ™å˜ç›¸å¢åŠ äº†æ¨¡å‹å¯¹äºéš¾åˆ†ç±»æ ·æœ¬çš„æƒé‡ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:0:3","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"alphaå‚æ•° å¯¹äºäºŒåˆ†ç±»ä»»åŠ¡ï¼Œè´Ÿæ ·æœ¬çš„æ•°é‡è¿œè¿œå¤šäºæ­£æ ·æœ¬ï¼Œå¯¼è‡´æ¨¡å‹æ›´å¤šå…³æ³¨åœ¨è´Ÿæ ·æœ¬ä¸Šï¼Œå¿½ç•¥æ­£æ ·æœ¬ã€‚å› æ­¤åœ¨ä½¿ç”¨äº¤å‰ç†µæŸå¤±çš„æ—¶å€™é€šå¸¸ä¼šå¢åŠ ä¸€ä¸ªå¹³è¡¡å‚æ•°ç”¨æ¥è°ƒèŠ‚æ­£è´Ÿæ ·æœ¬çš„æ¯”é‡ã€‚ æ‰€ä»¥ä¼šå¢åŠ ä¸€ä¸ªå¹³è¡¡å‚æ•°æ¥è°ƒèŠ‚æ­£è´Ÿæ ·æœ¬çš„æ¯”é‡ã€‚ å…¶å®è¿™å°±æ˜¯balanced cross entropyï¼Œå¯ä»¥å°†å®ƒå¼•å…¥focal loss åœ¨å¼å­ä¸­ï¼Œ\\(\\gamma\\)å æ®äº†ä¸»å¯¼åœ°ä½ï¼Œå› æ­¤å…¶å®ä¸ç”¨å¤ªåœ¨æ„\\(\\alpha\\)çš„æ•°å€¼ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:0:4","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"å¯¹äºå¤šåˆ†ç±» å¯¹äºå¤šåˆ†ç±»ä»»åŠ¡ï¼Œå…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªç±»åˆ«çš„æ ·æœ¬é¢„æµ‹ç»“æœæ€»æ˜¯å¤§äº0.5ï¼Œä¹Ÿè¯´æ˜å®ƒæ˜¯æ˜“åˆ†ç±»çš„ï¼Œå¯¹äºå¹³è¡¡å› å­ï¼Œåœ¨å®ç°çš„æ—¶å€™ï¼Œå¯ä»¥æå‰è®¾ç½®å¥½å„ç±»åˆ«çš„å¹³è¡¡å› å­ï¼Œå¯¹äºæ¯ä¸€ä¸ªç±»åˆ«éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:1:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"ä¸ºä»€ä¹ˆæœ‰æ•ˆ focal lossä»æ ·æœ¬éš¾æ˜“åˆ†ç±»è§’åº¦å‡ºå‘ï¼Œè§£å†³æ ·æœ¬éå¹³è¡¡å¸¦æ¥çš„æ¨¡å‹è®­ç»ƒé—®é¢˜ã€‚ ç›´è§‰ä¸Šæ¥è®²æ ·æœ¬éå¹³è¡¡é€ æˆçš„é—®é¢˜å°±æ˜¯æ ·æœ¬æ•°å°‘çš„ç±»åˆ«åˆ†ç±»éš¾åº¦è¾ƒé«˜ã€‚å› æ­¤ä»æ ·æœ¬éš¾æ˜“åˆ†ç±»è§’åº¦å‡ºå‘ï¼Œä½¿å¾—lossèšç„¦äºéš¾åˆ†æ ·æœ¬ï¼Œè§£å†³äº†æ ·æœ¬å°‘çš„ç±»åˆ«åˆ†ç±»å‡†ç¡®ç‡ä¸é«˜çš„é—®é¢˜ï¼Œå½“ç„¶éš¾åˆ†æ ·æœ¬ä¸é™äºæ ·æœ¬å°‘çš„ç±»åˆ«ï¼Œä¹Ÿå°±æ˜¯focal lossä¸ä»…ä»…è§£å†³äº†æ ·æœ¬éå¹³è¡¡çš„é—®é¢˜ï¼ŒåŒæ ·æœ‰åŠ©äºæ¨¡å‹çš„æ•´ä½“æ€§èƒ½æé«˜ã€‚ ","date":"2023-03-06","objectID":"/focal-loss/:2:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"æ€è€ƒ éš¾åˆ†ç±»æ ·æœ¬ä¸æ˜“åˆ†ç±»æ ·æœ¬å…¶å®æ˜¯ä¸€ä¸ªåŠ¨æ€æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´Â pÂ ä¼šéšç€è®­ç»ƒè¿‡ç¨‹è€Œå˜åŒ–ã€‚åŸå…ˆæ˜“åˆ†ç±»æ ·æœ¬å³Â på¤§çš„æ ·æœ¬ï¼Œå¯èƒ½éšç€è®­ç»ƒè¿‡ç¨‹å˜åŒ–ä¸ºéš¾è®­ç»ƒæ ·æœ¬å³på°çš„æ ·æœ¬ã€‚ ä¸Šé¢è®²åˆ°ï¼Œç”±äºLossæ¢¯åº¦ä¸­ï¼Œéš¾è®­ç»ƒæ ·æœ¬èµ·ä¸»å¯¼ä½œç”¨ï¼Œå³å‚æ•°çš„å˜åŒ–ä¸»è¦æ˜¯æœç€ä¼˜åŒ–éš¾è®­ç»ƒæ ·æœ¬çš„æ–¹å‘æ”¹å˜ã€‚å½“å‚æ•°å˜åŒ–åï¼Œå¯èƒ½ä¼šä½¿åŸå…ˆæ˜“è®­ç»ƒçš„æ ·æœ¬Â pÂ å‘ç”Ÿå˜åŒ–ï¼Œå³å¯èƒ½å˜ä¸ºéš¾è®­ç»ƒæ ·æœ¬ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¯èƒ½ä¼šé€ æˆæ¨¡å‹æ”¶æ•›é€Ÿåº¦æ…¢ï¼Œæ­£å¦‚è‹å‰‘æ—åœ¨ä»–çš„æ–‡ç« ä¸­æåˆ°çš„é‚£æ ·ã€‚ ä¸ºäº†é˜²æ­¢éš¾æ˜“æ ·æœ¬çš„é¢‘ç¹å˜åŒ–ï¼Œåº”å½“é€‰å–å°çš„å­¦ä¹ ç‡ã€‚ ## ä»£ç  ### äºŒåˆ†ç±» class Focal_Loss(): \"\"\" äºŒåˆ†ç±»Focal Loss \"\"\" def __init__(self,alpha=0.25,gamma=2): super(Focal_Loss,self).__init__() self.alpha=alpha self.gamma=gamma def forward(self,preds,labels): \"\"\" preds:sigmoidçš„è¾“å‡ºç»“æœ labelsï¼šæ ‡ç­¾ \"\"\" eps=1e-7 loss_1=-1*self.alpha*torch.pow((1-preds),self.gamma)*torch.log(preds+eps)*labels loss_0=-1*(1-self.alpha)*torch.pow(preds,self.gamma)*torch.log(1-preds+eps)*(1-labels) loss=loss_0+loss_1 return torch.mean(loss) ","date":"2023-03-06","objectID":"/focal-loss/:3:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"å¤šåˆ†ç±» class Focal_Loss(): def __init__(self,weight,gamma=2): super(Focal_Loss,self).__init__() self.gamma=gamma self.weight=weight def forward(self,preds,labels): \"\"\" preds:softmaxè¾“å‡ºç»“æœ labels:çœŸå®å€¼ \"\"\" eps=1e-7 y_pred =preds.view((preds.size()[0],preds.size()[1],-1)) #B*C*H*W-\u003eB*C*(H*W) target=labels.view(y_pred.size()) #B*C*H*W-\u003eB*C*(H*W) ce=-1*torch.log(y_pred+eps)*target floss=torch.pow((1-y_pred),self.gamma)*ce floss=torch.mul(floss,self.weight) floss=torch.sum(floss,dim=1) return torch.mean(floss) ","date":"2023-03-06","objectID":"/focal-loss/:3:1","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"å‚è€ƒ https://zhuanlan.zhihu.com/p/266023273 ","date":"2023-03-06","objectID":"/focal-loss/:4:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","focal loss"],"title":"focal loss","uri":"/focal-loss/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"åœ¨è®­ç»ƒå¼€å§‹çš„æ—¶å€™ï¼Œå¦‚æœå­¦ä¹ ç‡å¤ªé«˜çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´lossæ¥å›è·³åŠ¨ï¼Œä¼šå¯¼è‡´æ— æ³•æ”¶æ•›ï¼Œå› æ­¤åœ¨è®­ç»ƒå¼€å§‹çš„æ—¶å€™å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªå¾ˆå°çš„learning rateï¼Œç„¶åéšç€è®­ç»ƒçš„æ‰¹æ¬¡å¢åŠ ï¼Œé€æ¸å¢å¤§å­¦ä¹ ç‡ï¼Œç›´åˆ°è¾¾åˆ°åŸæœ¬æƒ³è¦è®¾ç½®çš„å­¦ä¹ ç‡ã€‚ å…³äºwarmupçš„å¥½å¤„ï¼Œæœ‰ï¼š - æœ‰åŠ©äºå‡ç¼“æ¨¡å‹åœ¨åˆå§‹é˜¶æ®µå¯¹mini-batchçš„æå‰è¿‡æ‹Ÿåˆç°è±¡ï¼Œä¿æŒåˆ†å¸ƒçš„å¹³ç¨³ - æœ‰åŠ©äºä¿æŒæ¨¡å‹æ·±å±‚çš„ç¨³å®šæ€§ã€‚ warmupæœ‰åŠ©äºç½‘ç»œçš„æ”¶æ•›ï¼Œå½“è¾¾åˆ°é¢„æœŸçš„å­¦ä¹ ç‡æ—¶ï¼Œä¹‹åçš„æ­¥éª¤å°±å¯ä»¥æ¯å›ºå®šæ‰¹æ¬¡è¿›è¡Œå­¦ä¹ ç‡è¡°å‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä»¥æ…¢æ…¢è¾¾åˆ°æ”¶æ•›ã€‚ ","date":"2023-03-05","objectID":"/warmup/:0:0","tags":["Deep Learning","è®­ç»ƒtrick","warmup"],"title":"warmup","uri":"/warmup/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"ç¥ç»ç½‘ç»œä¼šä¿ƒä½¿è‡ªèº«å¾€æ­£ç¡®æ ‡ç­¾å’Œé”™è¯¯æ ‡ç­¾å·®å€¼æœ€å¤§çš„æ–¹å‘å­¦ä¹ ï¼Œåœ¨è®­ç»ƒæ•°æ®è¾ƒå°‘ï¼Œä¸è¶³ä»¥è¡¨å¾æ‰€æœ‰çš„æ ·æœ¬ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ç½‘ç»œè¿‡æ‹Ÿåˆã€‚å› ä¸ºonehotæœ¬èº«å°±æ˜¯ä¸€ä¸ªç¨€ç–çš„å‘é‡ï¼Œå¦‚æœæ‰€æœ‰æ— å…³ç±»åˆ«éƒ½ä¸º0çš„è¯ï¼Œå°±å¯èƒ½ä¼šç–å¿½æŸäº›ç±»åˆ«ä¹‹é—´çš„è”ç³»ã€‚ å…·ä½“çš„ç¼ºç‚¹æœ‰ï¼š - çœŸæ˜¯æ ‡ç­¾ä¸å…¶å®ƒæ ‡ç­¾ä¹‹é—´çš„å…³ç³»è¢«å¿½ç•¥äº†ï¼Œå¾ˆå¤šæœ‰ç”¨çš„çŸ¥è¯†å­¦ä¸åˆ°äº†ã€‚ - å€¾å‘äºè®©æ¨¡å‹æ›´åŠ æ­¦æ–­ï¼Œå¯¼è‡´æ³›åŒ–æ€§èƒ½å·® - é¢å¯¹æœ‰å™ªå£°çš„æ•°æ®æ›´å®¹æ˜“æ”¶åˆ°å½±å“ã€‚ label smoothingå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿™æ˜¯ä¸€ç§æ­£åˆ™åŒ–ç­–ç•¥ï¼Œä¸»è¦æ˜¯é€šè¿‡soft one-hotæ¥åŠ å…¥å™ªå£°ï¼Œå‡å°‘äº†çœŸå®æ ·æœ¬æ ‡ç­¾çš„ç±»åˆ«åœ¨è®¡ç®—æŸå¤±å‡½æ•°æ—¶çš„æƒé‡ï¼Œæœ€ç»ˆèµ·åˆ°æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚ å¢åŠ label smoothingåçœŸå®çš„æ¦‚ç‡åˆ†å¸ƒæœ‰å¦‚ä¸‹æ”¹å˜ï¼š ","date":"2023-03-05","objectID":"/%E6%A0%87%E7%AD%BE%E5%B9%B3%E6%BB%91/:0:0","tags":["Deep Learning","è®­ç»ƒtrick","æ ‡ç­¾å¹³æ»‘"],"title":"æ ‡ç­¾å¹³æ»‘","uri":"/%E6%A0%87%E7%AD%BE%E5%B9%B3%E6%BB%91/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":" åŸºæœ¬åŸåˆ™ï¼šå¿«é€Ÿè¯•é”™ã€‚ å°æ­¥è¯•é”™ï¼Œå¿«é€Ÿè¿­ä»£ å¯ä»¥è¯•è¯•æ— è„‘çš„é…ç½® å®æ—¶æ‰“å°ä¸€äº›ç»“æœ è‡ªåŠ¨è°ƒå‚ï¼šç½‘æ ¼æœç´¢ã€random searchã€è´å¶æ–¯ä¼˜åŒ–ã€ å‚æ•°åˆå§‹åŒ– å­¦ä¹ ç‡warmupï¼Œæ…¢æ…¢å¢åŠ ï¼Œç„¶åå­¦ä¹ ç‡è¡°å‡ã€‚ batch_sizeå’Œlr å¤§çš„batchsizeæ”¶æ•›åˆ°sharp minimumï¼Œè€Œå°çš„batchsizeæ”¶æ•›åˆ°flat minimumï¼Œåè€…å…·æœ‰æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºå˜åŒ–çš„è¶‹åŠ¿ï¼Œä¸€ä¸ªå¿«ä¸€ä¸ªæ…¢ï¼Œå¦‚ä¸‹å›¾ï¼Œé€ æˆè¿™ä¸ªç°è±¡çš„ä¸»è¦åŸå› æ˜¯å°çš„batchsizeå¸¦æ¥çš„å™ªå£°æœ‰åŠ©äºé€ƒç¦»sharp minimumã€‚ å¤§çš„batchsizeæ€§èƒ½ä¸‹é™æ˜¯å› ä¸ºè®­ç»ƒæ—¶é—´ä¸å¤Ÿé•¿ï¼Œæœ¬è´¨ä¸Šå¹¶ä¸å°‘batchsizeçš„é—®é¢˜ï¼Œåœ¨åŒæ ·çš„epochsä¸‹çš„å‚æ•°æ›´æ–°å˜å°‘äº†ï¼Œå› æ­¤éœ€è¦æ›´é•¿çš„è¿­ä»£æ¬¡æ•°ã€‚ å¦‚æœå¢åŠ äº†å­¦ä¹ ç‡ï¼Œé‚£ä¹ˆbatch sizeæœ€å¥½ä¹Ÿè·Ÿç€å¢åŠ ï¼Œè¿™æ ·æ”¶æ•›æ›´ç¨³å®šã€‚ å°½é‡ä½¿ç”¨å¤§çš„å­¦ä¹ ç‡ï¼Œå› ä¸ºå¾ˆå¤šç ”ç©¶éƒ½è¡¨æ˜æ›´å¤§çš„å­¦ä¹ ç‡æœ‰åˆ©äºæé«˜æ³›åŒ–èƒ½åŠ›ã€‚å¦‚æœçœŸçš„è¦è¡°å‡ï¼Œå¯ä»¥å°è¯•å…¶ä»–åŠæ³•ï¼Œæ¯”å¦‚å¢åŠ batch sizeï¼Œå­¦ä¹ ç‡å¯¹æ¨¡å‹çš„æ”¶æ•›å½±å“çœŸçš„å¾ˆå¤§ï¼Œæ…é‡è°ƒæ•´ã€‚ ","date":"2023-03-02","objectID":"/%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7/:0:0","tags":["Deep Learning","è®­ç»ƒtrick","è°ƒå‚æŠ€å·§"],"title":"è°ƒå‚æŠ€å·§","uri":"/%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"æ€»ç»“ å­¦ä¹ ç‡ç›´æ¥å½±å“æ¨¡å‹çš„æ”¶æ•›çŠ¶æ€ï¼Œbatchsizeåˆ™å½±å“æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½ ","date":"2023-03-02","objectID":"/%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7/:1:0","tags":["Deep Learning","è®­ç»ƒtrick","è°ƒå‚æŠ€å·§"],"title":"è°ƒå‚æŠ€å·§","uri":"/%E8%B0%83%E5%8F%82%E6%8A%80%E5%B7%A7/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"Min-Maxå…¬å¼ $$ {} {(x,y) }U[{r{adv}}L(,x+r_{adv},y)] $$ å†…éƒ¨maxæ˜¯ä¸ºäº†æ‰¾åˆ°worst-caseçš„æ‰°åŠ¨ï¼Œä¹Ÿå°±æ˜¯æ”»å‡»ï¼Œå…¶ä¸­ï¼ŒÂ \\(L\\)ä¸ºæŸå¤±å‡½æ•°ï¼ŒÂ \\(\\mathbb{S}\\)Â ä¸ºæ‰°åŠ¨çš„èŒƒå›´ç©ºé—´ã€‚ å¤–éƒ¨minæ˜¯ä¸ºäº†åŸºäºè¯¥æ”»å‡»æ–¹å¼ï¼Œæ‰¾åˆ°æœ€é²æ£’çš„æ¨¡å‹å‚æ•°ï¼Œä¹Ÿå°±æ˜¯é˜²å¾¡ï¼Œå…¶ä¸­Â \\(\\mathbb{D}\\)Â æ˜¯è¾“å…¥æ ·æœ¬çš„åˆ†å¸ƒã€‚ ç®€å•ç†è§£å°±æ˜¯åœ¨è¾“å…¥ä¸Šè¿›è¡Œæ¢¯åº¦ä¸Šå‡(å¢å¤§loss)ï¼Œåœ¨å‚æ•°ä¸Šè¿›è¡Œæ¢¯åº¦ä¸‹é™(å‡å°loss) åŠ å…¥æ‰°åŠ¨åçš„æŸå¤±å‡½æ•° $$ {} -P(y |x+r{adv};) \\[ é‚£æ‰°åŠ¨è¦å¦‚ä½•è®¡ç®—å‘¢ï¼ŸGoodfellowè®¤ä¸ºï¼Œ**ç¥ç»ç½‘ç»œç”±äºå…¶çº¿æ€§çš„ç‰¹ç‚¹ï¼Œå¾ˆå®¹æ˜“å—åˆ°çº¿æ€§æ‰°åŠ¨çš„æ”»å‡»ã€‚** # Fast Gradient Sign Method (FGSM) \\] r_{adv} = sgn(_{x}L(,x,y)) $$ # FGM ## ä»£ç  ä»£ç æ¥è‡ª[1]ï¼Œæ³¨æ„çš„æ˜¯ä¸€èˆ¬æ‰°åŠ¨åŠ åœ¨äº†embeddingçŸ©é˜µä¸Šï¼Œç›¸å½“äºx+rã€‚ import torch class FGM(): def __init__(self, model): self.model = model self.backup = {} def attack(self, epsilon=1., emb_name='emb.'): # emb_nameä¸ºembeddingçŸ©é˜µå‚æ•°å¯¹åº”å for name, param in self.model.named_parameters(): if param.requires_grad and emb_name in name: self.backup[name] = param.data.clone() norm = torch.norm(param.grad) if norm != 0 and not torch.isnan(norm): r_at = epsilon * param.grad / norm param.data.add_(r_at) def restore(self, emb_name='emb.'): for name, param in self.model.named_parameters(): if param.requires_grad and emb_name in name: assert name in self.backup param.data = self.backup[name] self.backup = {} ä½¿ç”¨æ—¶ï¼š # åˆå§‹åŒ– fgm = FGM(model) for batch_input, batch_label in data: # æ­£å¸¸è®­ç»ƒ loss = model(batch_input, batch_label) loss.backward() # åå‘ä¼ æ’­ï¼Œå¾—åˆ°æ­£å¸¸çš„grad # å¯¹æŠ—è®­ç»ƒ fgm.attack() # åœ¨embeddingä¸Šæ·»åŠ å¯¹æŠ—æ‰°åŠ¨ loss_adv = model(batch_input, batch_label) loss_adv.backward() # åå‘ä¼ æ’­ï¼Œå¹¶åœ¨æ­£å¸¸çš„gradåŸºç¡€ä¸Šï¼Œç´¯åŠ å¯¹æŠ—è®­ç»ƒçš„æ¢¯åº¦ fgm.restore() # æ¢å¤embeddingå‚æ•° # æ¢¯åº¦ä¸‹é™ï¼Œæ›´æ–°å‚æ•° optimizer.step() model.zero_grad() å‚è€ƒæ–‡çŒ® ã€ç‚¼ä¸¹æŠ€å·§ã€‘åŠŸå®ˆé“ï¼šNLPä¸­çš„å¯¹æŠ—è®­ç»ƒ + PyTorchå®ç° - çŸ¥ä¹ (zhihu.com) ","date":"2023-03-02","objectID":"/%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83/:0:0","tags":["Deep","Learning","è®­ç»ƒtrick","å¯¹æŠ—è®­ç»ƒ"],"title":"å¯¹æŠ—è®­ç»ƒ","uri":"/%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"æ•°æ®ä¸å‡è¡¡ æ‰€è°“çš„ä¸å¹³è¡¡æŒ‡çš„æ˜¯ä¸åŒç±»åˆ«çš„æ ·æœ¬é‡å·®å¼‚éå¸¸å¤§ï¼Œæˆ–è€…å°‘æ•°æ ·æœ¬ä»£è¡¨äº†ä¸šåŠ¡çš„å…³é”®æ•°æ®ï¼ˆå°‘é‡æ ·æœ¬æ›´é‡è¦ï¼‰ï¼Œéœ€è¦å¯¹å°‘é‡æ ·æœ¬çš„æ¨¡å¼æœ‰å¾ˆå¥½çš„å­¦ä¹ ã€‚æ ·æœ¬ç±»åˆ«åˆ†å¸ƒä¸å¹³è¡¡ä¸»è¦å‡ºç°åœ¨åˆ†ç±»ç›¸å…³çš„å»ºæ¨¡é—®é¢˜ä¸Šã€‚æ ·æœ¬ç±»åˆ«åˆ†å¸ƒä¸å¹³è¡¡ä»æ•°æ®è§„æ¨¡ä¸Šå¯ä»¥åˆ†ä¸ºå¤§æ•°æ®åˆ†å¸ƒä¸å¹³è¡¡å’Œå°æ•°æ®åˆ†å¸ƒä¸å¹³è¡¡ä¸¤ç§ã€‚ å¤§æ•°æ®åˆ†å¸ƒä¸å‡è¡¡ã€‚è¿™ç§æƒ…å†µä¸‹æ•´ä½“æ•°æ®è§„æ¨¡å¤§ï¼Œåªæ˜¯å…¶ä¸­çš„å°‘æ ·æœ¬ç±»çš„å æ¯”è¾ƒå°‘ã€‚ä½†æ˜¯ä»æ¯ä¸ªç‰¹å¾çš„åˆ†å¸ƒæ¥çœ‹ï¼Œå°æ ·æœ¬ä¹Ÿè¦†ç›–äº†å¤§éƒ¨åˆ†æˆ–å…¨éƒ¨çš„ç‰¹å¾ã€‚ä¾‹å¦‚æ‹¥æœ‰1000ä¸‡æ¡è®°å½•çš„æ•°æ®é›†ä¸­ï¼Œå…¶ä¸­å æ¯”50ä¸‡æ¡çš„å°‘æ•°åˆ†ç±»æ ·æœ¬ä¾¿äºå±äºè¿™ç§æƒ…å†µã€‚ å°æ•°æ®åˆ†å¸ƒä¸å‡è¡¡ã€‚è¿™ç§æƒ…å†µä¸‹æ•´ä½“æ•°æ®è§„æ¨¡å°ï¼Œå¹¶ä¸”å æ®å°‘é‡æ ·æœ¬æ¯”ä¾‹çš„åˆ†ç±»æ•°é‡ä¹Ÿå°‘ï¼Œè¿™ä¼šå¯¼è‡´ç‰¹å¾åˆ†å¸ƒçš„ä¸¥é‡ä¸å¹³è¡¡ã€‚ä¾‹å¦‚æ‹¥æœ‰1000æ¡æ•°æ®æ ·æœ¬çš„æ•°æ®é›†ä¸­ï¼Œå…¶ä¸­å æœ‰10æ¡æ ·æœ¬çš„åˆ†ç±»ï¼Œå…¶ç‰¹å¾æ— è®ºå¦‚ä½•æ‹Ÿåˆä¹Ÿæ— æ³•å®ç°å®Œæ•´ç‰¹å¾å€¼çš„è¦†ç›–ï¼Œæ­¤æ—¶å±äºä¸¥é‡çš„æ•°æ®æ ·æœ¬åˆ†å¸ƒä¸å‡è¡¡ã€‚ å¦‚æœä¸åŒåˆ†ç±»é—´çš„æ ·æœ¬é‡å·®å¼‚è¾¾åˆ°è¶…è¿‡10å€å°±éœ€è¦å¼•èµ·è­¦è§‰å¹¶è€ƒè™‘å¤„ç†è¯¥é—®é¢˜ï¼Œè¶…è¿‡20å€å°±è¦ä¸€å®šè¦è§£å†³è¯¥é—®é¢˜ã€‚ ä¸»è¦æœ‰ä¸‰ç§è§£å†³æ–¹æ³•ï¼š - æ¬ é‡‡æ ·ï¼šåœ¨å°‘é‡æ ·æœ¬æ•°é‡ä¸å½±å“æ¨¡å‹è®­ç»ƒçš„æƒ…å†µä¸‹ï¼Œå¯é€šè¿‡å¯¹å¤šæ•°ç±»æ ·æœ¬æ¬ é‡‡æ ·ï¼Œå®ç°å°‘æ•°æ ·æœ¬å’Œå¤šæ•°æ ·æœ¬å‡è¡¡ã€‚ - è¿‡é‡‡æ ·ï¼šåœ¨å°‘é‡æ ·æœ¬æ•°é‡ä¸æ”¯æŒæ¨¡å‹è®­ç»ƒçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å¯¹å°‘æ•°ç±»æ ·æœ¬è¿‡é‡‡æ ·ï¼Œå®ç°å°‘æ•°æ ·æœ¬å’Œå¤šæ•°æ ·æœ¬çš„å‡è¡¡ã€‚ - æ¨¡å‹ç®—æ³•ï¼šé€šè¿‡å¼•å…¥æœ‰æƒé‡çš„æ¨¡å‹ç®—æ³•ï¼Œé’ˆå¯¹å°‘é‡æ ·æœ¬ç€é‡æ‹Ÿåˆï¼Œä»¥æå‡å¯¹å°‘é‡æ ·æœ¬ç‰¹å¾çš„å­¦ä¹ ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:1:0","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"æ¬ é‡‡æ · é€šè¿‡å‡å°‘åˆ†ç±»ä¸­å¤šæ•°ç±»æ ·æœ¬çš„æ ·æœ¬æ•°é‡æ¥å®ç°æ ·æœ¬å‡è¡¡ã€‚é€šè¿‡æ¬ é‡‡æ ·ï¼Œåœ¨ä¿ç•™å°‘æ•°ç±»æ ·æœ¬çš„åŒæ—¶ï¼Œä¼šä¸¢å¤±å¤šæ•°æ ·æœ¬ä¸­çš„ä¸€äº›ä¿¡æ¯ã€‚ç»è¿‡æ¬ é‡‡æ ·ï¼Œæ ·æœ¬æ•°é‡åœ¨å˜å°‘ã€‚å› æ­¤æˆ‘ä¸ªäººå¹¶ä¸å€¾å‘äºè¿™ç§æ–¹æ³•ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:2:0","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"éšæœºæ³• éšæœºçš„åˆ é™¤ä¸€äº›å¤šæ•°ç±»æ ·æœ¬ï¼Œä½¿å°‘æ•°ç±»æ ·æœ¬å’Œå¤šæ•°ç±»æ ·æœ¬æ•°é‡è¾¾åˆ°å‡è¡¡ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:2:1","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"åŸå‹ç”Ÿæˆ PG ç®—æ³•ä¸»è¦æ˜¯åœ¨åŸæœ‰æ ·æœ¬çš„åŸºç¡€ä¸Šç”Ÿæˆæ–°çš„æ ·æœ¬æ¥å®ç°æ ·æœ¬å‡è¡¡ï¼Œå¯¹å¤šæ•°ç±»æ ·æœ¬ç”Ÿæˆæ–°çš„æ ·æœ¬å»æ›¿ä»£åŸæ ·æœ¬ï¼Œä½¿å¾—æ ·æœ¬æ•°ç›®å‡å°‘, å…·ä½“åšæ³•å¦‚ä¸‹ï¼š ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:2:2","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"åŸå‹é€‰æ‹© åŸç†ï¼šä»å¤šæ•°ç±»æ ·æœ¬ä¸­é€‰å–æœ€å…·ä»£è¡¨æ€§çš„æ ·æœ¬ç”¨äºè®­ç»ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†ç¼“è§£éšæœºæ¬ é‡‡æ ·ä¸­çš„ä¿¡æ¯ä¸¢å¤±é—®é¢˜ã€‚ NearMiss é‡‡ç”¨ä¸€äº›å¯å‘å¼çš„è§„åˆ™æ¥é€‰æ‹©æ ·æœ¬ï¼Œæ ¹æ®è§„åˆ™çš„ä¸åŒå¯åˆ†ä¸º 3 ç±»,é€šè¿‡è®¾å®š version å‚æ•°æ¥ç¡®å®šï¼š - NearMiss-1ï¼šé€‰æ‹©åˆ°æœ€è¿‘çš„ K ä¸ªå°‘æ•°ç±»æ ·æœ¬å¹³å‡è·ç¦»æœ€è¿‘çš„å¤šæ•°ç±»æ ·æœ¬ - NearMiss-2ï¼šé€‰æ‹©åˆ°æœ€è¿œçš„ K ä¸ªå°‘æ•°ç±»æ ·æœ¬å¹³å‡è·ç¦»æœ€è¿‘çš„å¤šæ•°ç±»æ ·æœ¬ - 3: å¯¹äºæ¯ä¸ªå°‘æ•°ç±»æ ·æœ¬é€‰æ‹© K ä¸ªæœ€è¿‘çš„å¤šæ•°ç±»æ ·æœ¬ï¼Œç›®çš„æ˜¯ä¿è¯æ¯ä¸ªå°‘æ•°ç±»æ ·æœ¬éƒ½è¢«å¤šæ•°ç±»æ ·æœ¬åŒ…å›´ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:2:3","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"è¿‡é‡‡æ · è¿‡é‡‡æ ·ï¼ˆover-samplingï¼‰æ–¹æ³•é€šè¿‡å¢åŠ åˆ†ç±»ä¸­å°‘æ•°çš„æ•°é‡æ¥å®ç°æ ·æœ¬å‡è¡¡ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ç®€å•çš„å¤åˆ¶å°‘æ•°ç±»æ ·æœ¬å½¢æˆå¤šæ¡è®°å½•ï¼Œè¿™ç§æ–¹å¼å¯èƒ½å¯¼è‡´æ ·æœ¬ç‰¹å¾å°‘è€Œå¯èƒ½å‡ºç°è¿‡æ‹Ÿåˆçš„é—®é¢˜ã€‚ç»è¿‡æ”¹è¿›çš„è¿‡æŠ½æ ·æ–¹æ³•é€šè¿‡åœ¨å°‘æ•°ç±»ä¸­åŠ å…¥éšæœºå™ªå£°ã€å¹²æ‰°æ•°æ®æˆ–è€…é€šè¿‡ä¸€å®šè§„åˆ™äº§ç”Ÿæ–°çš„åˆæˆæ ·æœ¬ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:3:0","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"éšæœºå¤åˆ¶ å°±æ˜¯éšæœºé€‰æ‹©å°‘é‡æ ·æœ¬è¿›è¡Œå¤åˆ¶ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:3:1","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"SMOTE åœ¨éšæœºè¿‡é‡‡æ ·çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æ ·æœ¬æ„é€ ä¸€æ–¹é¢é™ä½äº†ç›´æ¥å¤åˆ¶æ ·æœ¬ä»£ç†çš„è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œå¦ä¸€æ–¹æ³•å®ç°äº†æ ·æœ¬çš„å‡è¡¡ã€‚æ¯”å¦‚æ ·æœ¬æ„é€ æ–¹æ³• SMOTEï¼ˆSynthetic minority over-sampling techniqueï¼‰åŠå…¶è¡ç”Ÿç®—æ³•ã€‚ ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:3:2","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"æ¨¡å‹ç®—æ³• ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:4:0","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"cost sensitiveç®—æ³• ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:4:1","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","è®­ç»ƒtrick"],"content":"focal loss å¯ä»¥æŸ¥çœ‹æœ¬åšå®¢focal losså†…å®¹Focal Loss ","date":"2023-03-02","objectID":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/:4:2","tags":["Deep Learning","è®­ç»ƒtrick","æ•°æ®ä¸å¹³è¡¡"],"title":"æ•°æ®ä¸å¹³è¡¡","uri":"/%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%B9%B3%E8%A1%A1/"},{"categories":["Deep Learning","GANç³»åˆ—"],"content":"ç®€ä»‹ ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGenerative Adversarial Networkï¼Œç®€ç§°GANï¼‰æ˜¯æ— ç›‘ç£å­¦ä¹ çš„ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡è®©ä¸¤ä¸ªç¥ç»ç½‘ç»œç›¸äº’åšå¼ˆçš„æ–¹å¼è¿›è¡Œå­¦ä¹ ã€‚ å¤§ç™½è¯ï¼š è¯´å°±æ˜¯ç”Ÿæˆå¯¹æŠ—ç½‘ç»œæœ‰ä¸€ä¸ªç”Ÿæˆç½‘ç»œå’Œä¸€ä¸ªåˆ¤åˆ«ç½‘ç»œï¼Œå‡è®¾æœ‰ä¸€ä¸ªçœŸå®æ•°æ®å’Œä¸€ä¸ªç”Ÿæˆç½‘ç»œç”Ÿæˆçš„å‡æ•°æ®ï¼Œé‚£ä¹ˆåˆ¤åˆ«ç½‘ç»œå°±æ˜¯è¯†åˆ«å‡ºè¿™ä¸¤ç§æ•°æ®ï¼Œåˆ¤åˆ«ç½‘ç»œåŠªåŠ›åˆ†ç±»æˆåŠŸï¼Œç”Ÿæˆç½‘ç»œåŠªåŠ›ç”Ÿæˆå’ŒçœŸå®æ•°æ®ç›¸ä¼¼çš„æ•°æ®ä½¿åˆ¤åˆ«ç½‘ç»œåˆ†ç±»ä¸å‡ºæ¥ã€‚è¿™å°±æ˜¯æ‰€è¯´çš„ç›¸äº’åšå¼ˆçš„æ–¹å¼ã€‚ ä¸“ä¸šçš„è¯ï¼š ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œç”±ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨æ„æˆã€‚ç”Ÿæˆå¯¹æŠ—ç½‘ç»œçš„æ ¸å¿ƒç›®çš„æ˜¯è®­ç»ƒç”Ÿæˆå™¨ã€‚ç”Ÿæˆå™¨çš„ç›®çš„æ˜¯ç”Ÿæˆä¸çœŸå®æ ·æœ¬å°½å¯èƒ½ç›¸ä¼¼çš„â€œå‡æ ·æœ¬â€ï¼Œåˆ¤åˆ«å™¨çš„ç›®çš„æ˜¯å°½å¯èƒ½åŒºåˆ†å‡ºç»™å®šæ ·æœ¬æ˜¯çœŸå®æ ·æœ¬è¿˜æ˜¯ç”Ÿæˆçš„â€œå‡æ ·æœ¬â€ã€‚äºŒè€…ç›®çš„ç›¸æ‚–ï¼Œåœ¨ä¸æ–­åšå¼ˆçš„è¿‡ç¨‹ä¸­ç›¸äº’æé«˜ï¼Œæœ€ç»ˆåœ¨åˆ¤åˆ«å™¨åˆ¤åˆ«èƒ½åŠ›è¶³å¤Ÿå¯é çš„å‰æä¸‹ä»æ— æ³•åŒºåˆ†ç»™å®šæ ·æœ¬æ˜¯çœŸå®æ ·æœ¬è¿˜æ˜¯ç”Ÿæˆæ ·æœ¬ï¼Œä»è€Œæˆ‘ä»¬è¯´ç”Ÿæˆå™¨èƒ½å¤Ÿç”Ÿæˆâ€œä»¥å‡ä¹±çœŸâ€çš„æ ·æœ¬ã€‚ ","date":"2022-12-22","objectID":"/gan/:1:0","tags":["Deep Learning","GANç³»åˆ—","GAN"],"title":"GAN","uri":"/gan/"},{"categories":["Deep Learning","GANç³»åˆ—"],"content":"ä¼˜åŒ– ä¼˜åŒ–ç›®æ ‡ - ä»·å€¼å‡½æ•° (Value Function) \\(\\min_G \\max_D V(D, G)=\\mathbb{E}_{\\boldsymbol{x} \\sim p_{\\text {data }}(\\boldsymbol{x})}[\\log D(\\boldsymbol{x})]+\\mathbb{E}_{\\boldsymbol{z} \\sim p_{\\boldsymbol{z}}(\\boldsymbol{z})}[\\log (1-D(G(\\boldsymbol{z})))]\\) - ä¼˜åŒ–æ–¹å¼ - ç”Ÿæˆå™¨ä¼˜åŒ–æ–¹å‘: æœ€å°åŒ–ä»·å€¼å‡½æ•° - åˆ¤åˆ«å™¨ä¼˜åŒ–æ–¹å‘: æœ€å¤§åŒ–ä»·å€¼å‡½æ•° ç®€å•ç†è§£ï¼Œåˆ¤åˆ«å™¨å°±æ˜¯è¦ä½¿æ­£ç¡®çš„æ ·æœ¬åˆ†ä¸º1ï¼Œç”Ÿæˆçš„æ ·æœ¬åˆ†ä¸º0ï¼Œé‚£ä¹ˆå°±æ˜¯æœ€å¤§åŒ–ä»·å€¼å‡½æ•°ã€‚ ç”Ÿæˆå™¨å°±æ˜¯è¦ä»¥å‡ä¹±çœŸï¼Œä½¿åˆ¤åˆ«å™¨åˆ¤ç”Ÿæˆçš„æ ·æœ¬ä¸º1ï¼Œå³æœ€å¤§åŒ–\\(D(G(z))\\)ï¼Œå°±æ˜¯æœ€å°åŒ–ä»·å€¼å‡½æ•°ã€‚ è¿™é‡Œçš„ä»·å€¼å‡½æ•°ä¸äº¤å‰ç†µç±»ä¼¼ã€‚çœŸå®æ ·æœ¬ä¸ºæ­£ä¾‹ï¼Œç”Ÿæˆæ ·æœ¬ä¸ºè´Ÿä¾‹ï¼Œä¸€èˆ¬éƒ½æ˜¯æœ€å°åŒ–æŸå¤±å‡½æ•°ï¼Œå› æ­¤éœ€è¦åšä¸€ä¸‹å˜å½¢ï¼š è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¸äº¤å‰ç†µä¸€æ ·ã€‚ ä¸Šé¢æ˜¯åˆ¤åˆ«å™¨çš„ä¼˜åŒ–ï¼Œä¸‹é¢æ˜¯ç”Ÿæˆå™¨çš„ä¼˜åŒ–ï¼š æ€»çš„æ¥è¯´ï¼Œç”Ÿæˆå™¨å¾—æŸå¤±å‡½æ•°å°±æ˜¯ \\[ J^{(G)} = -\\frac{1}{2}E_z\\log D(G(z)) \\] å³â€œä»¥å‡ä¹±çœŸâ€ã€‚ ","date":"2022-12-22","objectID":"/gan/:2:0","tags":["Deep Learning","GANç³»åˆ—","GAN"],"title":"GAN","uri":"/gan/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"çº¿æ€§åˆ¤åˆ«åˆ†æLDA(Linear Discriminant Analysis) çº¿æ€§åˆ¤åˆ«åˆ†æï¼Œä¹Ÿå°±æ˜¯LDAï¼ˆä¸ä¸»é¢˜æ¨¡å‹ä¸­çš„LDAåŒºåˆ†å¼€ï¼‰ï¼Œç°åœ¨å¸¸å¸¸ç”¨äºæ•°æ®çš„é™ç»´ä¸­ï¼Œä½†ä»å®ƒçš„åå­—ä¸­å¯ä»¥çœ‹å‡ºæ¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»çš„ç®—æ³•ï¼Œè€Œä¸”å±äºç¡¬åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯ç»“æœä¸æ˜¯æ¦‚ç‡ï¼Œæ˜¯å…·ä½“çš„ç±»åˆ«ï¼Œä¸€èµ·å­¦ä¹ ä¸€ä¸‹å§ã€‚ ","date":"2022-12-21","objectID":"/lda/:0:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"ä¸»è¦æ€æƒ³ ç±»å†…æ–¹å·®å° ç±»é—´æ–¹å·®å¤§ ","date":"2022-12-21","objectID":"/lda/:1:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"æ¨å¯¼ è¿™é‡Œä»¥äºŒç±»ä¸ºä¾‹ï¼Œå³åªæœ‰ä¸¤ä¸ªç±»åˆ«ã€‚ é¦–å…ˆæ˜¯æŠ•å½±ï¼Œæˆ‘ä»¬å‡å®šåŸæ¥çš„æ•°æ®æ˜¯å‘é‡ \\(x\\)ï¼Œé‚£ä¹ˆé¡ºç€ $Â w$ æ–¹å‘çš„æŠ•å½±å°±æ˜¯æ ‡é‡ï¼š \\[ z=w^T\\cdot x(=|w|\\cdot|x|\\cos\\theta) \\] å¯¹ç¬¬ä¸€ç‚¹ï¼Œç›¸åŒç±»å†…éƒ¨çš„æ ·æœ¬æ›´ä¸ºæ¥è¿‘ï¼Œæˆ‘ä»¬å‡è®¾å±äºä¸¤ç±»çš„è¯•éªŒæ ·æœ¬æ•°é‡åˆ†åˆ«æ˜¯ \\(N_1\\)å’Œ \\(N_2\\)ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨æ–¹å·®çŸ©é˜µæ¥è¡¨å¾æ¯ä¸€ä¸ªç±»å†…çš„æ€»ä½“åˆ†å¸ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†åæ–¹å·®çš„å®šä¹‰ï¼Œç”¨ \\(S\\) è¡¨ç¤ºåŸæ•°æ®çš„åæ–¹å·®ï¼š \\[ \\begin{aligned} C_1:Var_z[C_1]\u0026=\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(z_i-\\bar{z_{c1}})(z_i-\\bar{z_{c1}})^T\\nonumber\\\\\\\\\\\\\\\\ \u0026=\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(w^Tx_i-\\frac{1}{N_1}\\sum\\limits_{j=1}^{N_1}w^Tx_j)(w^Tx_i-\\frac{1}{N_1}\\sum\\limits_{j=1}^{N_1}w^Tx_j)^T\\nonumber\\\\\\\\\\\\\\\\ \u0026=w^T\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(x_i-\\bar{x_{c1}})(x_i-\\bar{x_{c1}})^Tw\\nonumber\\\\\\\\ =w^TS_1w\\\\\\\\\\\\\\\\ C_2:Var_z[C_2]\u0026=\\frac{1}{N_2}\\sum\\limits_{i=1}^{N_2}(z_i-\\bar{z_{c2}})(z_i-\\bar{z_{c2}})^T\\nonumber\\\\\\\\ =w^TS_2w \\end{aligned} \\] æ‰€ä»¥ç±»å†…è·ç¦»ä¸ºï¼š \\[ \\begin{align} Var_z[C_1]+Var_z[C_2]=w^T(S_1+S_2)w \\end{align} \\] å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç±»çš„å‡å€¼è¡¨ç¤ºè¿™ä¸ªè·ç¦»ï¼š \\[ \\begin{align} (\\bar{z_{c1}}-\\bar{z_{c2}})^2\u0026=(\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}w^Tx_i-\\frac{1}{N_2}\\sum\\limits_{i=1}^{N_2}w^Tx_i)^2\\nonumber\\\\\\\\ \u0026=(w^T(\\bar{x_{c1}}-\\bar{x_{c2}}))^2\\nonumber\\\\\\\\ \u0026=w^T(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw \\end{align} \\] åˆè¿™ä¸¤ç‚¹ï¼Œç”±äºåæ–¹å·®æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œäºæ˜¯æˆ‘ä»¬ç”¨å°†è¿™ä¸¤ä¸ªå€¼ç›¸é™¤æ¥å¾—åˆ°æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ï¼Œå¹¶æœ€å¤§åŒ–è¿™ä¸ªå€¼ï¼š \\[ \\begin{align} \\hat{w}=\\mathop{argmax}\\limits_wJ(w)\u0026=\\mathop{argmax}\\limits_w\\frac{(\\bar{z_{c1}}-\\bar{z_{c2}})^2}{Var_z[C_1]+Var_z[C_2]}\\nonumber\\\\\\\\ \u0026=\\mathop{argmax}\\limits_w\\frac{w^T(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw}{w^T(S_1+S_2)w}\\nonumber\\\\\\\\\\\\\\\\ \u0026=\\mathop{argmax}\\limits_w\\frac{w^TS_bw}{w^TS_ww} \\end{align} \\] è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠæŸå¤±å‡½æ•°å’ŒåŸæ•°æ®é›†ä»¥åŠå‚æ•°ç»“åˆèµ·æ¥äº†ã€‚ä¸‹é¢å¯¹è¿™ä¸ªæŸå¤±å‡½æ•°æ±‚åå¯¼ï¼Œæ³¨æ„æˆ‘ä»¬å…¶å®å¯¹wçš„ç»å¯¹å€¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œåªå¯¹æ–¹å‘æœ‰è¦æ±‚ï¼Œå› æ­¤åªè¦ä¸€ä¸ªæ–¹ç¨‹å°±å¯ä»¥æ±‚è§£äº†ï¼š \\[ \\begin{aligned} \u0026\\frac{\\partial}{\\partial w}J(w)=2S_bw(w^TS_ww)^{-1}-2w^TS_bw(w^TS_ww)^{-2}S_ww=0\\nonumber\\\\\\\\\\\\\\\\ \u0026\\Longrightarrow S_bw(w^TS_ww)=(w^TS_bw)S_ww\\nonumber\\\\\\\\\\\\\\\\ \u0026\\Longrightarrow w\\propto S_w^{-1}S_bw=S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw\\propto S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}}) \\end{aligned} \\] ä¹Ÿå°±æ˜¯è¯´æœ€åæˆ‘ä»¬çš„ç»“æœå°±æ˜¯\\(w=S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}})\\) å¯ä»¥å½’ä¸€åŒ–æ±‚å¾—å•ä½çš„wå€¼ã€‚ ","date":"2022-12-21","objectID":"/lda/:2:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"å¤šç±»æƒ…å†µ å‰é¢çš„å¾ˆå®¹æ˜“ç±»æ¯”äºŒç±»çš„æƒ…å†µï¼Œç°åœ¨çš„ç›®æ ‡å‡½æ•°å˜æˆäº†ï¼š \\[ \\frac{W^TS_bW}{W^TS_wW} \\] ç°åœ¨çš„é—®é¢˜å°±æ˜¯è¿™äº›éƒ½æ˜¯çŸ©é˜µï¼Œä¸èƒ½åƒä¸Šé¢é‚£æ ·ç›´æ¥ä¼˜åŒ–ï¼Œéœ€è¦æ›¿æ¢ä¼˜åŒ–ç›®æ ‡ã€‚ \\[ \\underbrace{arg\\;max}_W\\;\\;J(W) = \\frac{\\prod\\limits_{diag}W^TS_bW}{\\prod\\limits_{diag}W^TS_wW} \\] å…¶ä¸­ \\(\\prod_{diag}A\\)ä¸ºAçš„ä¸»å¯¹è§’çº¿å…ƒç´ çš„ä¹˜ç§¯,Wä¸º\\(n \\times d\\)çš„çŸ©é˜µï¼Œnä¸ºåŸæ¥çš„ç»´åº¦ï¼Œdä¸ºæ˜ å°„åˆ°è¶…å¹³é¢çš„ç»´åº¦ï¼Œåˆ™æœ€ç»ˆçš„ç›®æ ‡å°±å˜æˆäº†ï¼š \\[ J(W) =Â \\frac{\\prod\\limits_{i=1}^dw_i^TS_bw_i}{\\prod\\limits_{i=1}^dw_i^TS_ww_i} = \\prod\\limits_{i=1}^d\\frac{w_i^TS_bw_i}{w_i^TS_ww_i} \\] æ ¹æ®å¹¿å¼ç‘åˆ©å•†ï¼Œæœ€å¤§å€¼æ˜¯çŸ©é˜µ\\(S_w^{-1}S_b\\)çš„æœ€å¤§ç‰¹å¾å€¼,æœ€å¤§çš„dä¸ªå€¼çš„ä¹˜ç§¯å°±æ˜¯çŸ©é˜µçš„\\(S_w^{-1}S_b\\)æœ€å¤§çš„dä¸ªç‰¹å¾å€¼çš„ä¹˜ç§¯,æ­¤æ—¶å¯¹åº”çš„çŸ©é˜µ\\(W\\)ä¸ºè¿™æœ€å¤§çš„dä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å¼ æˆçš„çŸ©é˜µã€‚ ","date":"2022-12-21","objectID":"/lda/:3:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"æ€»ç»“ LDAæ˜¯ä¸€ç§ç›‘ç£å­¦ä¹ çš„é™ç»´æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„æ•°æ®é›†çš„æ¯ä¸ªæ ·æœ¬æ˜¯æœ‰ç±»åˆ«è¾“å‡ºçš„ã€‚è¿™ç‚¹å’ŒPCAä¸åŒã€‚PCAæ˜¯ä¸è€ƒè™‘æ ·æœ¬ç±»åˆ«è¾“å‡ºçš„æ— ç›‘ç£é™ç»´æŠ€æœ¯ã€‚LDAçš„æ€æƒ³å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼Œå°±æ˜¯â€œæŠ•å½±åç±»å†…æ–¹å·®æœ€å°ï¼Œç±»é—´æ–¹å·®æœ€å¤§â€ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æˆ‘ä»¬è¦å°†æ•°æ®åœ¨ä½ç»´åº¦ä¸Šè¿›è¡ŒæŠ•å½±ï¼ŒæŠ•å½±åå¸Œæœ›æ¯ä¸€ç§ç±»åˆ«æ•°æ®çš„æŠ•å½±ç‚¹å°½å¯èƒ½çš„æ¥è¿‘ï¼Œè€Œä¸åŒç±»åˆ«çš„æ•°æ®çš„ç±»åˆ«ä¸­å¿ƒä¹‹é—´çš„è·ç¦»å°½å¯èƒ½çš„å¤§ã€‚ å®é™…ä¸ŠLDAé™¤äº†å¯ä»¥ç”¨äºé™ç»´ä»¥å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ†ç±»ã€‚ä¸€ä¸ªå¸¸è§çš„LDAåˆ†ç±»åŸºæœ¬æ€æƒ³æ˜¯å‡è®¾å„ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°æ®ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œè¿™æ ·åˆ©ç”¨LDAè¿›è¡ŒæŠ•å½±åï¼Œå¯ä»¥åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡è®¡ç®—å„ä¸ªç±»åˆ«æŠ•å½±æ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼Œè¿›è€Œå¾—åˆ°è¯¥ç±»åˆ«é«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚å½“ä¸€ä¸ªæ–°çš„æ ·æœ¬åˆ°æ¥åï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæŠ•å½±ï¼Œç„¶åå°†æŠ•å½±åçš„æ ·æœ¬ç‰¹å¾åˆ†åˆ«å¸¦å…¥å„ä¸ªç±»åˆ«çš„é«˜æ–¯åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œè®¡ç®—å®ƒå±äºè¿™ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œæœ€å¤§çš„æ¦‚ç‡å¯¹åº”çš„ç±»åˆ«å³ä¸ºé¢„æµ‹ç±»åˆ«ã€‚ LDAç”¨äºé™ç»´ï¼Œå’ŒPCAæœ‰å¾ˆå¤šç›¸åŒï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„åœ°æ–¹ï¼Œå› æ­¤å€¼å¾—å¥½å¥½çš„æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…çš„é™ç»´å¼‚åŒç‚¹ã€‚ é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹ç›¸åŒç‚¹ï¼š 1ï¼‰ä¸¤è€…å‡å¯ä»¥å¯¹æ•°æ®è¿›è¡Œé™ç»´ã€‚ 2ï¼‰ä¸¤è€…åœ¨é™ç»´æ—¶å‡ä½¿ç”¨äº†çŸ©é˜µç‰¹å¾åˆ†è§£çš„æ€æƒ³ã€‚ 3ï¼‰ä¸¤è€…éƒ½å‡è®¾æ•°æ®ç¬¦åˆé«˜æ–¯åˆ†å¸ƒã€‚ æˆ‘ä»¬æ¥ç€çœ‹çœ‹ä¸åŒç‚¹ï¼š 1ï¼‰LDAæ˜¯æœ‰ç›‘ç£çš„é™ç»´æ–¹æ³•ï¼Œè€ŒPCAæ˜¯æ— ç›‘ç£çš„é™ç»´æ–¹æ³• 2ï¼‰LDAé™ç»´æœ€å¤šé™åˆ°ç±»åˆ«æ•°k-1çš„ç»´æ•°ï¼Œè€ŒPCAæ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ 3ï¼‰LDAé™¤äº†å¯ä»¥ç”¨äºé™ç»´ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ†ç±»ã€‚ 4ï¼‰LDAé€‰æ‹©åˆ†ç±»æ€§èƒ½æœ€å¥½çš„æŠ•å½±æ–¹å‘ï¼Œè€ŒPCAé€‰æ‹©æ ·æœ¬ç‚¹æŠ•å½±å…·æœ‰æœ€å¤§æ–¹å·®çš„æ–¹å‘ã€‚ ","date":"2022-12-21","objectID":"/lda/:4:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"ä»£ç  mean_list = [] for i in range(2): mean_list.append(np.mean(X_train[y_train==i], axis=0)) mean_list = np.array(mean_list) S_W = np.zeros((X_train.shape[1], X_train.shape[1])) # ç±»å†…æ•£åº¦çŸ©é˜µ for c, mv in zip(range(2), mean_list): class_scatter = np.zeros((X_train.shape[1], X_train.shape[1])) for row in X_train[y_train==c]: row, mv = row.reshape(X_train.shape[1], -1), mv.reshape(X_train.shape[1], -1) class_scatter += (row-mv).dot((row-mv).T) S_W += class_scatter over_all_mean = np.mean(X_train, axis=0) S_B = np.zeros((X_train.shape[1], X_train.shape[1])) # ç±»é—´æ•£åº¦çŸ©é˜µ for i, mean_vec in enumerate(mean_list): n = X_train[y_train==i, :].shape[0] mean_list_temp = mean_list[i, :].reshape(1, -1) over_all_mean = over_all_mean.reshape(X_train.shape[1], 1) S_B += n*(mean_vec-over_all_mean).dot((mean_vec-over_all_mean).T) eig_vals, eig_vecs = np.linalg.eig(np.linalg.inv(S_W).dot(S_B)) eig_pairs = [(np.abs(eig_vals[i]), eig_vecs[:, i]) for i in range(len(eig_vals))] eig_pairs = sorted(eig_pairs, key=lambda k: k[0], reverse=True) # eigv_sum = sum(eig_vals) # for i, j in enumerate(eig_pairs): # print('eigenvalue {0:}: {1:.2%}'.format(i + 1, (j[0] / eigv_sum).real)) # æ ¹æ®ç™¾åˆ†æ¯”æ˜¾ç¤ºç‰¹å¾å€¼ï¼Œä»è€Œé€‰å–æœ€å¤§çš„nä¸ªç‰¹å¾å€¼ W = np.hstack((eig_pairs[0][1].reshape(X_train.shape[1], 1), eig_pairs[1][1].reshape(X_train.shape[1], 1))) ","date":"2022-12-21","objectID":"/lda/:5:0","tags":["Machine Learning","é™ç»´ç®—æ³•","LDA"],"title":"LDA","uri":"/lda/"},{"categories":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—"],"content":" image.png å…¶ä¸­\\(r_{t}\\)ä¸ºreseté—¨ï¼Œç”¨äºé‡ç½®ä¸Šä¸€stepçš„çŠ¶æ€ã€‚\\(z_{t}\\)ä¸ºupdateé—¨ï¼Œç”¨äºå¾—åˆ°å½“å‰stepçš„çŠ¶æ€ã€‚ ","date":"2022-12-04","objectID":"/gru/:0:0","tags":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—","GRU"],"title":"GRU","uri":"/gru/"},{"categories":["pandas","api"],"content":" å¾ˆç®€å•ï¼Œå°±æ˜¯ç»Ÿè®¡xä¸­çš„æ•°å‡ºç°æ¬¡æ•°ï¼Œè¿”å›ç»“æœçš„æœ€å¤§é•¿åº¦å°±æ˜¯xä¸­çš„æœ€å¤§å€¼+1ï¼Œidxä¸ºå¯¹åº”çš„æ•°ï¼Œå€¼ä¸ºå‡ºç°çš„æ¬¡æ•°ï¼Œæ²¡æœ‰å‡ºç°çš„ä¸º0ã€‚ x = np.array([7, 6, 2, 1, 4]) # ç´¢å¼•0å‡ºç°äº†0æ¬¡ï¼Œç´¢å¼•1å‡ºç°äº†1æ¬¡......ç´¢å¼•5å‡ºç°äº†0æ¬¡...... np.bincount(x) #è¾“å‡ºç»“æœä¸ºï¼šarray([0, 1, 1, 0, 1, 0, 1, 1]) weightè¿™ä¸ªå‚æ•°ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œxä¼šè¢«å®ƒåŠ æƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå€¼nå‘ç°åœ¨ä½ç½®iï¼Œé‚£ä¹ˆout[n] += weight[i]è€Œä¸æ˜¯out[n] += 1ã€‚æ‰€ä»¥weightå¿…é¡»å’Œxç­‰é•¿ã€‚ w = np.array([0.3, 0.5, 0.2, 0.7, 1., -0.6]) # æˆ‘ä»¬å¯ä»¥çœ‹åˆ°xä¸­æœ€å¤§çš„æ•°ä¸º4ï¼Œå› æ­¤binçš„æ•°é‡ä¸º5ï¼Œé‚£ä¹ˆå®ƒçš„ç´¢å¼•å€¼ä¸º0-\u003e4 x = np.array([2, 1, 3, 4, 4, 3]) # ç´¢å¼•0 -\u003e 0 # ç´¢å¼•1 -\u003e w[1] = 0.5 # ç´¢å¼•2 -\u003e w[0] = 0.3 # ç´¢å¼•3 -\u003e w[2] + w[5] = 0.2 - 0.6 = -0.4 # ç´¢å¼•4 -\u003e w[3] + w[4] = 0.7 + 1 = 1.7 np.bincount(x, weights=w) # å› æ­¤ï¼Œè¾“å‡ºç»“æœä¸ºï¼šarray([ 0. , 0.5, 0.3, -0.4, 1.7]) æ²¡å‡ºç°çš„è¿˜æ˜¯0ï¼Œå‡ºç°çš„è¦æŒ‰ç…§å‡ºç°çš„åœ°æ–¹çš„weightè®¡ç®—ã€‚ ","date":"2022-11-29","objectID":"/bincount/:0:0","tags":["pandas","api","bincount"],"title":"bincount","uri":"/bincount/"},{"categories":["ç®—æ³•é¢˜"],"content":"æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸² ","date":"2022-11-17","objectID":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/:0:0","tags":["ç®—æ³•é¢˜","æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"],"title":"æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","uri":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/ba-shu-zi-fan-yi-cheng-zi-fu-chuan-lcof/ ","date":"2022-11-17","objectID":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/:1:0","tags":["ç®—æ³•é¢˜","æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"],"title":"æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","uri":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š dpæ€æƒ³ï¼Œä¸ç”¨ç®¡æ˜¯ä»€ä¹ˆå­—ç¬¦ï¼Œå®šä¹‰dp[i]ä¸ºé•¿åº¦ä¸ºiæ—¶ æœ‰å¤šå°‘ä¸ªæ–¹æ³• ","date":"2022-11-17","objectID":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/:2:0","tags":["ç®—æ³•é¢˜","æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"],"title":"æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","uri":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç : class Solution: def translateNum(self, num: int) -\u003e int: s = str(num) if len(s) \u003c 2: return 1 dp = [0] * len(s) dp[0] = 1 dp[1] = 2 if int(s[0] + s[1]) \u003c 26 else 1 for i in range(2,len(s)): dp[i] = dp[i-1] + dp[i-2] if int(s[i-1] + s[i]) \u003c 26 and s[i-1] != '0' else dp[i-1] return dp[-1] æ³¨æ„å¦‚æœé•¿åº¦å°äºç­‰äº1 åˆ™ç›´æ¥è¿”å›1 å¦‚æœä¸æ˜¯26ä¸ªè‹±æ–‡å­—æ¯é‡Œé¢çš„ åˆ™dp[i] = dp[i-1] è¯´æ˜æ–¹æ³•æ¬¡æ•°å¹¶ä¸æ”¹å˜ æ³¨æ„æœ‰é¦–ä½ä¸º0çš„æƒ…å†µ æ‰€ä»¥è¦intä¸€ä¸‹ ","date":"2022-11-17","objectID":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/:3:0","tags":["ç®—æ³•é¢˜","æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"],"title":"æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²","uri":"/%E6%8A%8A%E6%95%B0%E5%AD%97%E7%BF%BB%E8%AF%91%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"categories":["NLP"],"content":"Seq2Seq ï¼ˆæœ¬æ–‡åªä»‹ç»æœ€åŸå§‹çš„seq2seqï¼Œå¸¦æœ‰æ³¨æ„åŠ›åœ¨attentionæ–‡ç« ä¸­ï¼‰ ","date":"2022-11-09","objectID":"/seq2seq/:0:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"RNN æœ‰å…³RNN Seq2Seqæ˜¯å…¸å‹çš„Encoder-decoderæ¡†æ¶çš„æ¨¡å‹ï¼Œå…¶ä¸­ç¼–ç å™¨å’Œè§£ç å™¨éƒ½é‡‡ç”¨çš„RNNæ¨¡å‹æˆ–è€…RNNæ¨¡å‹çš„å˜ä½“ï¼šGRUã€LSTMç­‰ã€‚ ä¸€èˆ¬çš„RNNæ¨¡å‹æœ‰å‡ ç§å½¢å¼ï¼Œåˆ†åˆ«ä¸ºä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šã€‚ ä¸€å¯¹ä¸€ï¼š å°±æ˜¯ä¸€èˆ¬çš„MLPï¼Œå¹¶ä¸èƒ½ç§°ä¹‹ä¸ºRNNæ¨¡å‹ ä¸€å¯¹å¤š: å…¸å‹çš„ä¾‹å­å°±æ˜¯è¯­éŸ³ç”Ÿæˆï¼Œæ¯”å¦‚è¾“å…¥æŸä¸ªå€¼å¯ä»¥ç”±ç¨‹åºç”Ÿæˆä¸€æ®µéŸ³ä¹ã€‚ å¤šå¯¹ä¸€ï¼š æœ€å¸¸è§çš„æ–‡æœ¬åˆ†ç±»æˆ–è€…æƒ…æ„Ÿåˆ†æå°±æ˜¯è¿™ä¸ªæ¨¡å‹æ¶æ„ å¤šå¯¹å¤šï¼š åºåˆ—æ ‡æ³¨ã€NERã€åˆ†è¯ï¼Œå¤§å¤šæ•°æ ‡æ³¨ä»»åŠ¡å°±æ˜¯ç”¨çš„è¿™ä¸ªæ¨¡å‹æ¶æ„ã€‚è€ŒSeq2Seqä¹Ÿå±äºå¤šå¯¹å¤šçš„ä»»åŠ¡ï¼Œä¸è¿‡ç”±äºè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› æ­¤é‡‡ç”¨encoder-decoderçš„æ¡†æ¶ï¼Œä¸»è¦æ€æƒ³å°±æ˜¯é€šè¿‡encoderå°†è¾“å…¥çš„ä¿¡æ¯ç¼–ç ï¼Œç„¶åä¼ å…¥decoderå†è¿›è¡Œè§£ç å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚è¿™å¸¸ç”¨äºç”Ÿæˆå¼çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´æœºå™¨ç¿»è¯‘ã€å¯¹è¯ç³»ç»Ÿã€æ–‡æœ¬æ‘˜è¦ç­‰ç­‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¡†æ¶è¿›è¡Œå®ç°ã€‚è‘—åçš„Transformer å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªæ¡†æ¶ã€‚ ","date":"2022-11-09","objectID":"/seq2seq/:1:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"encoder-decoder æ¡†æ¶ encoder-decoderæ¡†æ¶å¯ä»¥çœ‹ä½œä¸€ç§æ·±åº¦å­¦ä¹ é¢†åŸŸçš„ç ”ç©¶æ¨¡å¼ï¼Œåº”ç”¨åœºæ™¯ååˆ†å¹¿æ³›ï¼Œ æ–‡æœ¬å¤„ç†é¢†åŸŸçš„Encoder-Decoderæ¡†æ¶å¯ä»¥è¿™ä¹ˆç›´è§‚åœ°å»ç†è§£ï¼šå¯ä»¥æŠŠå®ƒçœ‹ä½œé€‚åˆå¤„ç†ç”±ä¸€ä¸ªå¥å­ï¼ˆæˆ–ç¯‡ç« ï¼‰ç”Ÿæˆå¦å¤–ä¸€ä¸ªå¥å­ï¼ˆæˆ–ç¯‡ç« ï¼‰çš„é€šç”¨å¤„ç†æ¨¡å‹ã€‚å¯¹äºå¥å­å¯¹\u003cSource,Target\u003eï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç»™å®šè¾“å…¥å¥å­Sourceï¼ŒæœŸå¾…é€šè¿‡Encoder-Decoderæ¡†æ¶æ¥ç”Ÿæˆç›®æ ‡å¥å­Targetã€‚Sourceå’ŒTargetå¯ä»¥æ˜¯åŒä¸€ç§è¯­è¨€ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸¤ç§ä¸åŒçš„è¯­è¨€ã€‚è€ŒSourceå’ŒTargetåˆ†åˆ«ç”±å„è‡ªçš„å•è¯åºåˆ—æ„æˆã€‚ \\[ Source = \u003cx_1, x_2, \\dots, x_m\u003e \\\\\\\\ Target = \u003cy_1, y_2, \\dots, y_n\u003e \\] Encoderé¡¾åæ€ä¹‰å°±æ˜¯å¯¹è¾“å…¥å¥å­Sourceè¿›è¡Œç¼–ç ï¼Œå°†è¾“å…¥å¥å­é€šè¿‡éçº¿æ€§å˜æ¢è½¬åŒ–ä¸ºä¸­é—´è¯­ä¹‰è¡¨ç¤ºCï¼š \\[ C = F(x_1, x_2, \\dots, x_m) \\] å¯¹äºè§£ç å™¨Decoderæ¥è¯´ï¼Œå…¶ä»»åŠ¡æ˜¯æ ¹æ®å¥å­Sourceçš„ä¸­é—´è¯­ä¹‰è¡¨ç¤ºCå’Œä¹‹å‰å·²ç»ç”Ÿæˆçš„å†å²ä¿¡æ¯\\(y_1,y_2,\\dots, y_{i-1}\\)æ¥ç”Ÿæˆiæ—¶åˆ»è¦ç”Ÿæˆçš„å•è¯\\(y_i\\)ï¼š \\[ y_i = G(C, y_1,y_2,\\dots,y_{i-1}) \\] æ¯ä¸ªyiéƒ½ä¾æ¬¡è¿™ä¹ˆäº§ç”Ÿï¼Œé‚£ä¹ˆçœ‹èµ·æ¥å°±æ˜¯æ•´ä¸ªç³»ç»Ÿæ ¹æ®è¾“å…¥å¥å­Sourceç”Ÿæˆäº†ç›®æ ‡å¥å­Targetã€‚å¦‚æœSourceæ˜¯ä¸­æ–‡å¥å­ï¼ŒTargetæ˜¯è‹±æ–‡å¥å­ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯è§£å†³æœºå™¨ç¿»è¯‘é—®é¢˜çš„Encoder-Decoderæ¡†æ¶ï¼›å¦‚æœSourceæ˜¯ä¸€ç¯‡æ–‡ç« ï¼ŒTargetæ˜¯æ¦‚æ‹¬æ€§çš„å‡ å¥æè¿°è¯­å¥ï¼Œé‚£ä¹ˆè¿™æ˜¯æ–‡æœ¬æ‘˜è¦çš„Encoder-Decoderæ¡†æ¶ï¼›å¦‚æœSourceæ˜¯ä¸€å¥é—®å¥ï¼ŒTargetæ˜¯ä¸€å¥å›ç­”ï¼Œé‚£ä¹ˆè¿™æ˜¯é—®ç­”ç³»ç»Ÿæˆ–è€…å¯¹è¯æœºå™¨äººçš„Encoder-Decoderæ¡†æ¶ã€‚ç”±æ­¤å¯è§ï¼Œåœ¨æ–‡æœ¬å¤„ç†é¢†åŸŸï¼ŒEncoder-Decoderçš„åº”ç”¨é¢†åŸŸç›¸å½“å¹¿æ³›ã€‚ Encoder-Decoderæ¡†æ¶ä¸ä»…ä»…åœ¨æ–‡æœ¬é¢†åŸŸå¹¿æ³›ä½¿ç”¨ï¼Œåœ¨è¯­éŸ³è¯†åˆ«ã€å›¾åƒå¤„ç†ç­‰é¢†åŸŸä¹Ÿç»å¸¸ä½¿ç”¨ã€‚å¯¹äºâ€œå›¾åƒæè¿°â€ä»»åŠ¡æ¥è¯´ï¼ŒEncoderéƒ¨åˆ†çš„è¾“å…¥æ˜¯ä¸€å‰¯å›¾ç‰‡ï¼ŒDecoderçš„è¾“å‡ºæ˜¯èƒ½å¤Ÿæè¿°å›¾ç‰‡è¯­ä¹‰å†…å®¹çš„ä¸€å¥æè¿°è¯­ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ–‡æœ¬å¤„ç†å’Œè¯­éŸ³è¯†åˆ«çš„Encoderéƒ¨åˆ†é€šå¸¸é‡‡ç”¨RNNæ¨¡å‹ï¼Œå›¾åƒå¤„ç†çš„Encoderä¸€èˆ¬é‡‡ç”¨CNNæ¨¡å‹ã€‚ ","date":"2022-11-09","objectID":"/seq2seq/:2:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"Seq2Seqæ¨¡å‹ Seq2Seqæ¨¡å‹æ˜¯è¾“å‡ºçš„é•¿åº¦ä¸ç¡®å®šæ—¶é‡‡ç”¨çš„æ¨¡å‹ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯åœ¨æœºå™¨ç¿»è¯‘çš„ä»»åŠ¡ä¸­å‡ºç°ï¼Œå°†ä¸€å¥ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œé‚£ä¹ˆè¿™å¥è‹±æ–‡çš„é•¿åº¦æœ‰å¯èƒ½ä¼šæ¯”ä¸­æ–‡çŸ­ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šæ¯”ä¸­æ–‡é•¿ï¼Œæ‰€ä»¥è¾“å‡ºçš„é•¿åº¦å°±ä¸ç¡®å®šäº†ã€‚ ","date":"2022-11-09","objectID":"/seq2seq/:3:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"ç»“æ„ seq2seqå±äºencoder-decoderç»“æ„çš„ä¸€ç§ï¼Œè¿™é‡Œçœ‹çœ‹å¸¸è§çš„encoder-decoderç»“æ„ï¼ŒåŸºæœ¬æ€æƒ³å°±æ˜¯åˆ©ç”¨ä¸¤ä¸ªRNNï¼Œä¸€ä¸ªRNNä½œä¸ºencoderï¼Œå¦ä¸€ä¸ªRNNä½œä¸ºdecoderã€‚encoderè´Ÿè´£å°†è¾“å…¥åºåˆ—å‹ç¼©æˆæŒ‡å®šé•¿åº¦çš„å‘é‡ï¼Œè¿™ä¸ªå‘é‡å°±å¯ä»¥çœ‹æˆæ˜¯è¿™ä¸ªåºåˆ—çš„è¯­ä¹‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç¼–ç ï¼Œè·å–è¯­ä¹‰å‘é‡æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´æ¥å°†æœ€åä¸€ä¸ªè¾“å…¥çš„éšçŠ¶æ€ä½œä¸ºè¯­ä¹‰å‘é‡Cã€‚ä¹Ÿå¯ä»¥å¯¹æœ€åä¸€ä¸ªéšå«çŠ¶æ€åšä¸€ä¸ªå˜æ¢å¾—åˆ°è¯­ä¹‰å‘é‡ï¼Œè¿˜å¯ä»¥å°†è¾“å…¥åºåˆ—çš„æ‰€æœ‰éšå«çŠ¶æ€åšä¸€ä¸ªå˜æ¢å¾—åˆ°è¯­ä¹‰å˜é‡ã€‚ è€Œdecoderåˆ™è´Ÿè´£æ ¹æ®è¯­ä¹‰å‘é‡ç”ŸæˆæŒ‡å®šçš„åºåˆ—ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºè§£ç ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯å°†encoderå¾—åˆ°çš„è¯­ä¹‰å˜é‡ä½œä¸ºåˆå§‹çŠ¶æ€è¾“å…¥åˆ°decoderçš„RNNä¸­ï¼Œå¾—åˆ°è¾“å‡ºåºåˆ—ã€‚å¯ä»¥çœ‹åˆ°ä¸Šä¸€æ—¶åˆ»çš„è¾“å‡ºä¼šä½œä¸ºå½“å‰æ—¶åˆ»çš„è¾“å…¥ï¼Œè€Œä¸”å…¶ä¸­è¯­ä¹‰å‘é‡Cåªä½œä¸ºåˆå§‹çŠ¶æ€å‚ä¸è¿ç®—ï¼Œåé¢çš„è¿ç®—éƒ½ä¸è¯­ä¹‰å‘é‡Cæ— å…³ã€‚ decoderå¤„ç†æ–¹å¼è¿˜æœ‰å¦å¤–ä¸€ç§ï¼Œå°±æ˜¯è¯­ä¹‰å‘é‡Cå‚ä¸äº†åºåˆ—æ‰€æœ‰æ—¶åˆ»çš„è¿ç®—ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸Šä¸€æ—¶åˆ»çš„è¾“å‡ºä»ç„¶ä½œä¸ºå½“å‰æ—¶åˆ»çš„è¾“å…¥ï¼Œä½†è¯­ä¹‰å‘é‡Cä¼šå‚ä¸æ‰€æœ‰æ—¶åˆ»çš„è¿ç®—ã€‚ ä¸Šé¢çš„è¿™ä¸¤ç§ç»“æ„æ˜¯æˆ‘åˆšå­¦çš„æ—¶å€™ç–‘æƒ‘çš„ä¸€ä¸ªåœ°æ–¹ï¼Œå› ä¸ºæˆ‘åœ¨æœ‰çš„åœ°æ–¹çœ‹åˆ°çš„ä»£ç æ˜¯ç¬¬ä¸€ç§ç»“æ„çš„ï¼Œè€Œæ²ç¥çš„æ•™ç¨‹ä¸­çš„ç»“æ„ç”¨çš„æ˜¯ç¬¬äºŒç§ç»“æ„ï¼Œå…¶å®è¿™ä¸¤ç§éƒ½æ˜¯å¯ä»¥çš„ã€‚ ### è®­ç»ƒ æœ€ä¸»è¦çš„æ€è·¯å°±æ˜¯è¯­è¨€æ¨¡å‹ï¼Œå› ä¸ºåœ¨RNNä¸­ï¼Œæ¯ä¸€ä¸ªstepçš„è¾“å‡ºå±‚çš„å¤§å°å°±æ˜¯å•è¯è¡¨çš„å¤§å°ï¼Œè¦é¢„æµ‹æœ€å¤§æ¦‚ç‡å‡ºç°çš„é‚£ä¸ªè¯æ±‡ï¼Œå³æœ€å¤§åŒ–æœ€æœ‰å¯èƒ½æ˜¯å½“å‰è¾“å‡ºçš„å•è¯æ‰€åœ¨ç¥ç»å…ƒçš„æ¦‚ç‡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šåˆ†ç±»é—®é¢˜ï¼Œä½¿ç”¨softmaxå½’ä¸€åŒ–è¡¨ç¤ºæ¦‚ç‡ã€‚ encoderå°±æ˜¯ç®€å•çš„RNNç³»åˆ—æ¨¡å‹ï¼Œå‰æ–‡è¯´çš„å¯ä»¥æœ‰å¤šç§æ–¹å¼è®¡ç®—è¯­ä¹‰å‘é‡cï¼Œå¹¶ä¸”cå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼å‚ä¸åˆ°decoderçš„è®¡ç®—ä¸­ã€‚ decoderçš„ä¸»è¦è®­ç»ƒæ–¹å¼å°±æ˜¯å°†å‰ä¸€æ—¶åˆ»çš„ç»“æœä½œä¸ºåä¸€æ—¶åˆ»çš„è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è‡ªå›å½’ã€‚åœ¨è®­ç»ƒä¸­çš„ä½“ç°æ˜¯å°†è¯­æ–™è¿›è¡Œé”™ä½è®­ç»ƒï¼Œæ¯”å¦‚[â€œä½ å¥½â€œ ä¸–ç•Œâ€]ï¼Œåœ¨è®­ç»ƒä¸­decoderä¸­å°±æ˜¯è¾“å…¥ä¸º[â€œSâ€ â€ä½ å¥½â€œ â€œä¸–ç•Œâ€]ï¼Œè€Œæ ‡ç­¾ä¹Ÿå°±æ˜¯å®é™…å€¼ä¸º[â€œä½ å¥½â€ â€œä¸–ç•Œâ€ â€Eâ€œ] ï¼ŒæŒ‰ç…§è¿™æ ·çš„æ–¹å¼è¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒè¿‡åï¼Œå†è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•çš„è¿‡ç¨‹å°±æ˜¯ä¸¥æ ¼æŒ‰ç…§å‰ä¸€æ—¶åˆ»çš„è¾“å‡ºä½œä¸ºåä¸€æ—¶åˆ»çš„è¾“å…¥ï¼Œå› ä¸ºè¿™æ—¶ä½ ä¹Ÿæ²¡æœ‰è¦è¾“å…¥çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´è®­ç»ƒæ—¶å’Œæµ‹è¯•æ—¶çš„decoderæ˜¯ä¸ä¸€æ ·çš„ã€‚è®­ç»ƒçš„æ—¶å€™æˆ‘ä»¬æœ‰çœŸå®çš„æ•°æ®ï¼Œè€Œé¢„æµ‹çš„æ—¶å€™æ²¡æœ‰ï¼Œåªèƒ½è‡ªäº§è‡ªé”€ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªè¯­è¨€æ¨¡å‹ï¼Œå«åšæ¡ä»¶è¯­è¨€æ¨¡å‹ã€‚è¿™é‡Œå¼•ç”¨ä¸¤å¼ å›¾ æ—¢ç„¶æ˜¯è¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æœ€å¤§åŒ–è¾“å‡ºåºåˆ—çš„æ¦‚ç‡ï¼š \\[ \\begin{aligned} P(y_1,\\dots,y_{T} | x_1, \\dots x_T) = \\prod_{t=1}^TP(y_t|y_1 , \\dots y_{t-1}; c) \\end{aligned} \\] åœ¨è®¡ç®—æŸå¤±çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾å‡ºè¿™ä¸ªVç»´å‘é‡ä¸­ï¼Œæ­£ç¡®é¢„æµ‹å¯¹åº”çš„è¯çš„é‚£ä¸€ç»´çš„æ¦‚ç‡å¤§å°\\(\\hat{p}\\)ï¼Œåˆ™è¿™ä¸€æ­¥çš„æŸå¤±å°±æ˜¯å®ƒçš„è´Ÿå¯¼æ•°\\(-log(\\hat{p})\\)ï¼Œå°†æ¯ä¸€æ­¥çš„æŸå¤±æ±‚å’Œï¼Œå³å¾—åˆ°æ€»ä½“çš„æŸå¤±å‡½æ•°ï¼š \\[ \\begin{aligned} J = -\\frac{1}{T}\\sum_{i}^Tlog(p(\\hat{y_i})) \\end{aligned} \\] å…¶ä¸­çš„\\(p(\\hat{y_i})\\)ä¸ºæ—¶é—´t=iä¸Šçš„æ­£ç¡®è¾“å‡ºèŠ‚ç‚¹çš„æ¦‚ç‡å€¼ï¼Œå³softmaxå€¼ã€‚ å…¶ä¸­æœ‰ä¸‰ä¸ªç‰¹æ®Šçš„æ ‡è®°ï¼Œä¸€ä¸ªæ˜¯Sä»£è¡¨å¥å­çš„å¼€å¤´ï¼ŒEä»£è¡¨å¥å­çš„ç»“å°¾ï¼ŒPä»£è¡¨Paddingã€‚ ## æŸæœç´¢(beam search) ä¸€èˆ¬æ¥è¯´ï¼Œç”¨å‰ä¸€æ­¥çš„ç»“æœä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å‡ºï¼Œè¿™ç§æ–¹å¼å°±æ˜¯è´ªå¿ƒç­–ç•¥ï¼Œä½†ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ­¥æœ€ä¼˜å¹¶ä¸æ˜¯å…¨å±€æœ€ä¼˜ï¼Œæ”¹è¿›çš„åŠæ³•å°±æ˜¯æŸæœç´¢ã€‚æ€æƒ³å¾ˆç®€å•ï¼Œæ¯ä¸€æ­¥å°±æ˜¯å¤šé€‰å‡ ä¸ªä½œä¸ºå€™é€‰ï¼Œæœ€åç»¼åˆè€ƒè™‘ï¼Œé€‰å‡ºæœ€ä¼˜çš„ç»„åˆã€‚æ˜¯ä¸æ˜¯å’ŒHMMä¸­çš„ç»´ç‰¹æ¯”ç®—æ³•å¾ˆåƒå‘¢ï¼Ÿ ä»¥ä¸‹ä¸ºæŸæœç´¢çš„æ­¥éª¤ï¼š - é¦–å…ˆéœ€è¦è®¾å®šä¸€ä¸ªå€™é€‰é›†çš„å¤§å°beam size=kã€‚ - æ¯ä¸€æ­¥çš„å¼€å§‹ï¼Œæˆ‘ä»¬ä»æ¯ä¸ªå½“å‰è¾“å…¥å¯¹åº”çš„æ‰€æœ‰å¯èƒ½è¾“å‡ºï¼Œè®¡ç®—æ¯ä¸€æ¡è·¯çš„åºåˆ—å¾—åˆ† - ä¿ç•™åºåˆ—å¾—åˆ†æœ€å¤§çš„kä¸ªä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ - ä¸æ–­é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´è‡³ç»“æŸï¼Œé€‰æ‹©åºåˆ—å¾—åˆ†æœ€å¤§çš„é‚£ä¸ªåºåˆ—ä½œä¸ºæœ€ç»ˆç»“æœã€‚ å…¶ä¸­åºåˆ—å¾—åˆ†ä¸ºï¼š \\[ score(y_1,y_2, \\dots y_t) = \\sum_{i=1}^t \\log P(y_i|y_1,y_2,\\dots y_{i-1};x) \\] è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š ","date":"2022-11-09","objectID":"/seq2seq/:3:1","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"è¯„ä»·æ ‡å‡† ","date":"2022-11-09","objectID":"/seq2seq/:4:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"BLUEæŒ‡æ ‡ BLEUï¼Œå…¨ç§°æ˜¯Bilingual Evaluation Understudyï¼Œå®ƒçš„ä¸»è¦æ€æƒ³æ˜¯åŸºäºN-gramç­‰ç‰¹å¾æ¥æ¯”è¾ƒäººå·¥ç¿»è¯‘å’Œæœºå™¨ç¿»è¯‘ç»“æœçš„ç›¸ä¼¼ç¨‹åº¦ã€‚ æˆ‘ä»¬å°†BLEUå®šä¹‰ä¸ºï¼š \\[ \\exp \\left(\\min\\left(0,1-\\frac{len_{\\text {label }}}{len_{\\text {pred }}}\\right)\\right) \\prod_{n=1}^{k} p_{n}^{1 / 2^{n}} \\] é•¿çš„ \\(n\\) å…ƒè¯­æ³•ã€‚å¦å¤–, ç”¨ \\(p_{n}\\) è¡¨ç¤º \\(n\\) å…ƒè¯­æ³•çš„ç²¾ç¡®åº¦, å®ƒæ˜¯ä¸¤ä¸ªæ•°é‡çš„æ¯”å€¼ï¼šç¬¬ä¸€ä¸ªæ˜¯é¢„æµ‹åº åˆ—ä¸æ ‡ç­¾åºåˆ—ä¸­åŒ¹é…çš„ \\(n\\) å…ƒè¯­æ³•çš„æ•°é‡, ç¬¬äºŒä¸ªæ˜¯é¢„æµ‹åºåˆ—ä¸­ \\(n\\) å…ƒè¯­æ³•çš„æ•°é‡çš„æ¯”ç‡ã€‚å…·ä½“ åœ°è¯´, ç»™å®šæ ‡ç­¾åºåˆ— \\(A ã€ B ã€ C ã€ D ã€ E ã€ F\\) å’Œé¢„æµ‹åºåˆ— \\(A ã€ B ã€ B ã€ C ã€ D\\), æˆ‘ä»¬æœ‰ \\(p_{1}=4 / 5 ã€ p_{2}=3 / 4 ã€ p_{3}=1 / 3\\) å’Œ \\(p_{4}=0\\) ã€‚ æ ¹æ® (9.7.4)ä¸­BLEUçš„å®šä¹‰ï¼Œå½“é¢„æµ‹åºåˆ—ä¸æ ‡ç­¾åºåˆ—å®Œå…¨ç›¸åŒæ—¶, BLEUä¸º 1 ã€‚ æ­¤å¤–, ç”±äº \\(n\\) å…ƒè¯­æ³•è¶Šé•¿åˆ™åŒ¹é…éš¾åº¦è¶Šå¤§, æ‰€ä»¥BLEUä¸ºæ›´é•¿çš„ \\(n\\) å…ƒè¯­æ³•çš„ç²¾ç¡®åº¦åˆ†é…æ›´å¤§çš„æƒé‡ã€‚å…·ä½“ æ¥è¯´, å½“ \\(p_{n}\\) å›ºå®šæ—¶, \\(p_{n}^{1 / 2^{n}}\\) ä¼šéšç€ \\(n\\) çš„å¢é•¿è€Œå¢åŠ ï¼ˆåŸå§‹è®ºæ–‡ä½¿ç”¨ \\(p_{n}^{1 / n}\\) )ã€‚è€Œä¸”, ç”±äºé¢„æµ‹ çš„åºåˆ—è¶ŠçŸ­è·å¾—çš„ \\(p_{n}\\) å€¼è¶Šé«˜, æ‰€ä»¥ (9.7.4)ä¸­ä¹˜æ³•é¡¹ä¹‹å‰çš„ç³»æ•°ç”¨äºæƒ©ç½šè¾ƒçŸ­çš„é¢„æµ‹åºåˆ—ã€‚ ä¾‹å¦‚, å½“ \\(k=2\\) æ—¶ï¼Œç»™å®šæ ‡ç­¾åºåˆ— \\(A ã€ B ã€ C ã€ D ã€ E ã€ F\\) å’Œé¢„æµ‹åºåˆ— \\(A ã€ B\\) ï¼Œå°½ç®¡ \\(p_{1}=p_{2}=1\\) ï¼Œ æƒ©ç½šå› å­ \\(\\exp (1-6 / 2) \\approx 0.14\\) ä¼šé™ä½BLEUã€‚ ","date":"2022-11-09","objectID":"/seq2seq/:4:1","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["NLP"],"content":"ä»£ç  # code by Tae Hwan Jung @graykode import numpy as np import torch import torch.nn as nn # S: Symbol that shows starting of decoding input # E: Symbol that shows starting of decoding output # P: Symbol that will fill in blank sequence if current batch data size is short than time steps def make_batch(): input_batch, output_batch, target_batch = [], [], [] for seq in seq_data: for i in range(2): seq[i] = seq[i] + 'P' * (n_step - len(seq[i])) input = [num_dic[n] for n in seq[0]] output = [num_dic[n] for n in ('S' + seq[1])] target = [num_dic[n] for n in (seq[1] + 'E')] input_batch.append(np.eye(n_class)[input]) output_batch.append(np.eye(n_class)[output]) target_batch.append(target) # not one-hot # make tensor return torch.FloatTensor(input_batch), torch.FloatTensor(output_batch), torch.LongTensor(target_batch) # make test batch def make_testbatch(input_word): input_batch, output_batch = [], [] input_w = input_word + 'P' * (n_step - len(input_word)) input = [num_dic[n] for n in input_w] output = [num_dic[n] for n in 'S' + 'P' * n_step] input_batch = np.eye(n_class)[input] output_batch = np.eye(n_class)[output] return torch.FloatTensor(input_batch).unsqueeze(0), torch.FloatTensor(output_batch).unsqueeze(0) # Model class Seq2Seq(nn.Module): def __init__(self): super(Seq2Seq, self).__init__() self.enc_cell = nn.RNN(input_size=n_class, hidden_size=n_hidden, dropout=0.5) self.dec_cell = nn.RNN(input_size=n_class, hidden_size=n_hidden, dropout=0.5) self.fc = nn.Linear(n_hidden, n_class) def forward(self, enc_input, enc_hidden, dec_input): enc_input = enc_input.transpose(0, 1) # enc_input: [max_len(=n_step, time step), batch_size, n_class] dec_input = dec_input.transpose(0, 1) # dec_input: [max_len(=n_step, time step), batch_size, n_class] # enc_states : [num_layers(=1) * num_directions(=1), batch_size, n_hidden] _, enc_states = self.enc_cell(enc_input, enc_hidden) # outputs : [max_len+1(=6), batch_size, num_directions(=1) * n_hidden(=128)] outputs, _ = self.dec_cell(dec_input, enc_states) model = self.fc(outputs) # model : [max_len+1(=6), batch_size, n_class] return model if __name__ == '__main__': n_step = 5 n_hidden = 128 char_arr = [c for c in 'SEPabcdefghijklmnopqrstuvwxyz'] num_dic = {n: i for i, n in enumerate(char_arr)} seq_data = [['man', 'women'], ['black', 'white'], ['king', 'queen'], ['girl', 'boy'], ['up', 'down'], ['high', 'low']] n_class = len(num_dic) batch_size = len(seq_data) model = Seq2Seq() criterion = nn.CrossEntropyLoss() optimizer = torch.optim.Adam(model.parameters(), lr=0.001) input_batch, output_batch, target_batch = make_batch() for epoch in range(5000): # make hidden shape [num_layers * num_directions, batch_size, n_hidden] hidden = torch.zeros(1, batch_size, n_hidden) optimizer.zero_grad() # input_batch : [batch_size, max_len(=n_step, time step), n_class] # output_batch : [batch_size, max_len+1(=n_step, time step) (becase of 'S' or 'E'), n_class] # target_batch : [batch_size, max_len+1(=n_step, time step)], not one-hot output = model(input_batch, hidden, output_batch) # output : [max_len+1, batch_size, n_class] output = output.transpose(0, 1) # [batch_size, max_len+1(=6), n_class] loss = 0 for i in range(0, len(target_batch)): # output[i] : [max_len+1, n_class, target_batch[i] : max_len+1] loss += criterion(output[i], target_batch[i]) if (epoch + 1) % 1000 == 0: print('Epoch:', '%04d' % (epoch + 1), 'cost =', '{:.6f}'.format(loss)) loss.backward() optimizer.step() # Test def translate(word): input_batch, output_batch = make_testbatch(word) # make hidden shape [num_layers * num_directions, batch_size, n_hidden] hidden = torch.zeros(1, 1, n_hidden) output = model(input_batch, hidden, output_batch) # output : [max_len+1(=6), batch_size(=1), n_class] predict = output.data.max(2, keepdim=True)[1] # select n_class dimension decoded = [char_arr[i] for i in predict] end = decoded.index('E') translated = ''.join(decoded[:end]) return translated.replace('P', '') print('test') print('man -\u003e', translate('man')) prin","date":"2022-11-09","objectID":"/seq2seq/:5:0","tags":["NLP","seq2seq"],"title":"seq2seq","uri":"/seq2seq/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"DBSCANå±äºå¯†åº¦èšç±»çš„ä¸€ç§ã€‚é€šå¸¸æƒ…å½¢ä¸‹ï¼Œå¯†åº¦èšç±»ç®—æ³•ä»æ · æœ¬å¯†åº¦çš„è§’åº¦æ¥è€ƒå¯Ÿæ ·æœ¬ä¹‹é—´çš„å¯è¿æ¥æ€§ï¼Œå¹¶åŸºäºå¯è¿æ¥æ ·æœ¬ä¸æ–­æ‰©å±•èšç±»ç°‡ ä»¥è·å¾—æœ€ç»ˆçš„èšç±»ç»“æœã€‚ DBSCANåŸºäºä¸€ç»„â€œé‚»åŸŸâ€å‚æ•°\\((\\epsilon, Minpts)\\)æ¥åˆ»ç”»æ ·æœ¬åˆ†å¸ƒçš„ç´§å¯†ç¨‹åº¦ï¼Œç»™å®šæ•°æ®é›†\\(D=\\\\{x_1,x_2, \\dots,x_m \\\\}\\)ï¼Œå®šä¹‰å‡ ä¸ªæ¦‚å¿µï¼š \\(\\epsilon\\)-é‚»åŸŸï¼šå¯¹\\(x_j\\in D\\)ï¼Œå…¶\\(\\epsilon\\)-é‚»åŸŸåŒ…å«æ ·æœ¬é›†Dä¸­ä¸\\(x_j\\)çš„è·ç¦»ä¸å¤§äº\\(\\epsilon\\)çš„æ ·æœ¬ï¼Œå³\\(N_{\\epsilon}(x_j) = \\\\{dist(x_i, x_j) \\leq \\epsilon\\\\}\\)ã€‚ æ ¸å¿ƒå¯¹è±¡ (core object): è‹¥ \\(x_j\\) çš„ \\(\\epsilon\\)-é‚»åŸŸè‡³å°‘åŒ…å« MinPts ä¸ªæ ·æœ¬, å³ \\(\\left|N_\\epsilon\\left(\\boldsymbol{x}_j\\right)\\right| \\geqslant \\operatorname{MinPts}\\), åˆ™ \\(\\boldsymbol{x}_j\\) æ˜¯ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡; å¯†åº¦ç›´è¾¾(directly density-reachable): è‹¥ \\(\\boldsymbol{x}_j\\) ä½äº \\(\\boldsymbol{x}_i\\) çš„ \\(\\epsilon\\)-é‚»åŸŸä¸­, ä¸” \\(\\boldsymbol{x}_i\\) æ˜¯ æ ¸å¿ƒå¯¹è±¡, åˆ™ç§° \\(\\boldsymbol{x}_j\\) ç”± \\(\\boldsymbol{x}_i\\) å¯†åº¦ç›´è¾¾; å¯†åº¦å¯è¾¾(density-reachable): å¯¹ \\(\\boldsymbol{x}_i\\) ä¸ \\(\\boldsymbol{x}_j\\), è‹¥å­˜åœ¨æ ·æœ¬åºåˆ— \\(\\boldsymbol{p}_1, \\boldsymbol{p}_2, \\ldots, \\boldsymbol{p}_n\\), å…¶ä¸­ \\(\\boldsymbol{p}_1=\\boldsymbol{x}_i, \\boldsymbol{p}_n=\\boldsymbol{x}_j\\) ä¸” \\(\\boldsymbol{p}_{i+1}\\) ç”± \\(\\boldsymbol{p}_i\\) å¯†åº¦ç›´è¾¾, åˆ™ç§° \\(\\boldsymbol{x}_j\\) ç”± \\(\\boldsymbol{x}_i\\) å¯†åº¦å¯è¾¾; å¯†åº¦ç›¸è¿ (density-connected): å¯¹ \\(\\boldsymbol{x}_i\\) ä¸ \\(\\boldsymbol{x}_j\\), è‹¥å­˜åœ¨ \\(\\boldsymbol{x}_k\\) ä½¿å¾— \\(\\boldsymbol{x}_i\\) ä¸ \\(\\boldsymbol{x}_j\\) å‡ç”± \\(\\boldsymbol{x}_k\\) å¯†åº¦å¯è¾¾, åˆ™ç§° \\(\\boldsymbol{x}_i\\) ä¸ \\(\\boldsymbol{x}_j\\) å¯†åº¦ç›¸è¿. æ—¢ç„¶æ˜¯èšç±»ï¼Œé‚£å°±è¦å®šä¹‰ç°‡çš„æ¦‚å¿µ ","date":"2022-11-03","objectID":"/dbscan/:0:0","tags":["Machine Learning","èšç±»ç®—æ³•","DBSCAN"],"title":"DBSCAN","uri":"/dbscan/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"å‚è€ƒï¼šhttps://www.cnblogs.com/bill-h/p/14863262.html å¤§å®¶å¯èƒ½å¬è¯´è¿‡ç”¨äºå®£ä¼ æ•°æ®æŒ–æ˜çš„ä¸€ä¸ªæ¡ˆä¾‹:å•¤é…’å’Œå°¿å¸ƒï¼›æ®è¯´æ˜¯æ²ƒå°”ç›è¶…å¸‚åœ¨åˆ†æé¡¾å®¢çš„è´­ä¹°è®°å½•æ—¶ï¼Œå‘ç°è®¸å¤šå®¢æˆ·è´­ä¹°å•¤é…’çš„åŒæ—¶ä¹Ÿä¼šè´­ä¹°å©´å„¿å°¿å¸ƒï¼Œäºæ˜¯è¶…å¸‚è°ƒæ•´äº†å•¤é…’å’Œå°¿å¸ƒçš„è´§æ¶æ‘†æ”¾ï¼Œè®©è¿™ä¸¤ä¸ªå“ç±»æ‘†æ”¾åœ¨ä¸€èµ·ï¼›ç»“æœè¿™ä¸¤ä¸ªå“ç±»çš„é”€é‡éƒ½æœ‰æ˜æ˜¾çš„å¢é•¿ï¼›åˆ†æåŸå› æ˜¯å¾ˆå¤šåˆšç”Ÿå°å­©çš„ç”·å£«åœ¨è´­ä¹°çš„å•¤é…’æ—¶ï¼Œä¼šé¡ºæ‰‹å¸¦ä¸€äº›å©´å¹¼å„¿ç”¨å“ã€‚ ä¸è®ºè¿™ä¸ªæ¡ˆä¾‹æ˜¯å¦æ˜¯çœŸå®çš„ï¼Œæ¡ˆä¾‹ä¸­åˆ†æé¡¾å®¢è´­ä¹°è®°å½•çš„æ–¹å¼å°±æ˜¯å…³è”è§„åˆ™åˆ†ææ³•Association Rulesã€‚ å…³è”è§„åˆ™åˆ†æä¹Ÿè¢«ç§°ä¸ºè´­ç‰©ç¯®åˆ†æï¼Œç”¨äºåˆ†ææ•°æ®é›†å„é¡¹ä¹‹é—´çš„å…³è”å…³ç³»ã€‚ ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:0:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"é¡¹é›† itemçš„é›†åˆï¼Œå¦‚é›†åˆ{ç‰›å¥¶ã€éº¦ç‰‡ã€ç³–}æ˜¯ä¸€ä¸ª3é¡¹é›†ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è´­ä¹°è®°å½•é‡Œç‰©å“çš„é›†åˆã€‚ ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:1:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"é¢‘ç¹é¡¹é›† é¡¾åæ€ä¹‰å°±æ˜¯é¢‘ç¹å‡ºç°çš„itemé¡¹çš„é›†åˆã€‚å¦‚ä½•å®šä¹‰é¢‘ç¹å‘¢ï¼Ÿç”¨æ¯”ä¾‹æ¥åˆ¤å®šï¼Œå…³è”è§„åˆ™ä¸­é‡‡ç”¨æ”¯æŒåº¦å’Œç½®ä¿¡åº¦ä¸¤ä¸ªæ¦‚å¿µæ¥è®¡ç®—æ¯”ä¾‹å€¼ ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:2:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"æ”¯æŒåº¦ï¼ˆsupport) å…±åŒå‡ºç°çš„é¡¹åœ¨æ•´ä½“é¡¹ä¸­çš„æ¯”ä¾‹ã€‚ä»¥è´­ä¹°è®°å½•ä¸ºä¾‹å­ï¼Œè´­ä¹°è®°å½•100æ¡ï¼Œå¦‚æœå•†å“Aå’ŒBåŒæ—¶å‡ºç°50æ¡è´­ä¹°è®°å½•ï¼ˆå³åŒæ—¶è´­ä¹°Aå’ŒBçš„è®°å½•æœ‰50ï¼‰ï¼Œé‚£è¾¹Aå’ŒBè¿™ä¸ª2é¡¹é›†çš„æ”¯æŒåº¦ä¸º50% \\[ Support(A\\cap B) = \\frac{Freq(A\\cap B)}{N} \\] ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:3:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"ç½®ä¿¡åº¦ï¼ˆConfidenceï¼‰ è´­ä¹°Aåå†è´­ä¹°Bçš„æ¡ä»¶æ¦‚ç‡ï¼Œæ ¹æ®è´å¶æ–¯å…¬å¼ï¼Œå¯å¦‚ä¸‹è¡¨ç¤ºï¼š \\[ Confidence = \\frac{Freq(A\\cap B)}{Freq(A)} \\] ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:4:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•"],"content":"æå‡åº¦ ä¸ºäº†åˆ¤æ–­äº§ç”Ÿè§„åˆ™çš„å®é™…ä»·å€¼ï¼Œå³ä½¿ç”¨è§„åˆ™åå•†å“å‡ºç°çš„æ¬¡æ•°æ˜¯å¦é«˜äºå•†å“å•ç‹¬å‡ºç°çš„è¯„ç‡ï¼Œæå‡åº¦å’Œè¡¡é‡è´­ä¹°Xå¯¹è´­ä¹°Yçš„æ¦‚ç‡çš„æå‡ä½œç”¨ã€‚å¦‚ä¸‹å…¬å¼å¯è§ï¼Œå¦‚æœXå’ŒYç›¸äº’ç‹¬ç«‹é‚£ä¹ˆæå‡åº¦ä¸º1ï¼Œæå‡åº¦è¶Šå¤§ï¼Œè¯´æ˜X-\u003eYçš„å…³è”æ€§è¶Šå¼º ","date":"2022-11-02","objectID":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/:5:0","tags":["Machine Learning","å…³è”è§„åˆ™ç®—æ³•","å…³è”è§„åˆ™æ¦‚å¿µ"],"title":"å…³è”è§„åˆ™æ¦‚å¿µ","uri":"/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E6%A6%82%E5%BF%B5/"},{"categories":["ç®—æ³•é¢˜"],"content":"å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi) https://leetcode-cn.com/problems/string-to-integer-atoi/ #é‡ç‚¹æ˜¯æ­£åˆ™è¡¨è¾¾å¼ class Solution: def myAtoi(s: str): import re ss = re.findall(\"^[\\+\\-]?\\d+\",s.strip()) res = int(*ss) if res \u003e (231-1): res = (231-1) if res \u003c -231: res = -231 return res WAäº†å››æ¬¡æ‰æ•´å‡ºæ¥ï¼Œå¤ªèœäº†ï¼Œä»¥ä¸ºå¾ˆç®€å•ï¼Œæ²¡æœ‰è®¤çœŸè¯»é¢˜ï¼Œè¦å¸å–æ•™è®­ã€‚ ","date":"2022-10-26","objectID":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%95%B4%E6%95%B0-atoi/:0:0","tags":["ç®—æ³•é¢˜","å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)"],"title":"å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)","uri":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E6%95%B4%E6%95%B0-atoi/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"åŸºç¡€å°±æ˜¯é«˜æ–¯æ··åˆæ¨¡å‹ï¼Œå‡è®¾æˆ‘ä»¬ç†ŸçŸ¥çš„é«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸º\\(p(x\\mid \\mu, \\Sigma)\\)ã€‚åˆ™é«˜æ–¯æ··åˆåˆ†å¸ƒä¸ºï¼š \\[ p_{\\mathcal{M}}(\\boldsymbol{x})=\\sum_{i=1}^k \\alpha_i \\cdot p\\left(\\boldsymbol{x} \\mid \\boldsymbol{\\mu}_i, \\boldsymbol{\\Sigma}_i\\right) \\] åˆ†å¸ƒå…±ç”± \\(k\\) ä¸ªæ··åˆæˆåˆ†ç»„æˆ, æ¯ä¸ªæ··åˆæˆåˆ†å¯¹åº”ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒ. å…¶ä¸­ \\(\\mu_i\\) ä¸ \\(\\Sigma_i\\) æ˜¯ç¬¬ \\(i\\) ä¸ªé«˜æ–¯æ··åˆæˆåˆ†çš„å‚æ•°, è€Œ \\(\\alpha_i\u003e0\\) ä¸ºç›¸åº”çš„ â€œæ··åˆç³»æ•°â€ (mixture coefficient), \\(\\sum_{i=1}^k \\alpha_i=1\\)ã€‚ å‡è®¾æ ·æœ¬çš„ç”Ÿæˆè¿‡ç¨‹ç”±é«˜æ–¯æ··åˆåˆ†å¸ƒç»™å‡º: é¦–å…ˆ, æ ¹æ® \\(\\alpha_1, \\alpha_2, \\ldots, \\alpha_k\\) å®šä¹‰ çš„å…ˆéªŒåˆ†å¸ƒé€‰æ‹©é«˜æ–¯æ··åˆæˆåˆ†, å…¶ä¸­ \\(\\alpha_i\\) ä¸ºé€‰æ‹©ç¬¬ \\(i\\) ä¸ªæ··åˆæˆåˆ†çš„æ¦‚ç‡; ç„¶å, æ ¹ æ®è¢«é€‰æ‹©çš„æ··åˆæˆåˆ†çš„æ¦‚ç‡å¯†åº¦å‡½æ•°è¿›è¡Œé‡‡æ ·, ä»è€Œç”Ÿæˆç›¸åº”çš„æ ·æœ¬ã€‚ ","date":"2022-10-25","objectID":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/:0:0","tags":["Machine Learning","èšç±»ç®—æ³•","é«˜æ–¯æ··åˆèšç±»"],"title":"é«˜æ–¯æ··åˆèšç±»","uri":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"èšç±»åŸç† å¦‚ä½•åˆ©ç”¨é«˜æ–¯æ··åˆåˆ†å¸ƒè¿›è¡Œèšç±»ï¼Ÿè§‚å¯Ÿè¿™ä¸ªæ··åˆç³»æ•°ï¼Œæ€è·¯å°±æ˜¯æœ‰å¤šå°‘ä¸ªæ··åˆçš„æ¨¡å‹ï¼Œå°±ä»£è¡¨è¦èšå¤šå°‘ç±»ï¼Œå¯¹äºç»™å®šæ•°æ®é›†ï¼Œå¯ä»¥å®šä¹‰ \\[ \\gamma_{j k}= \\begin{cases}1, \u0026 \\text { ç¬¬ } j \\text { ä¸ªè§‚æµ‹æ¥è‡ªç¬¬ } k \\text { ä¸ªåˆ†æ¨¡å‹ } \\\\\\\\ 0, \u0026 \\text { å¦åˆ™ }\\end{cases} \\] åˆ™æ ·æœ¬jçš„ç°‡æ ‡è®°\\(\\lambda_j= \\underbrace{\\arg \\max}_{i\\in {1,2, \\dots ,k}} \\gamma_{jk}\\) ","date":"2022-10-25","objectID":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/:1:0","tags":["Machine Learning","èšç±»ç®—æ³•","é«˜æ–¯æ··åˆèšç±»"],"title":"é«˜æ–¯æ··åˆèšç±»","uri":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"EMç®—æ³• å¦‚ä½•è®¡ç®—\\(\\gamma_{jk}\\)å‘¢ï¼Œå¦‚ä¸‹å¼æ‰€ç¤ºï¼Œå…¶ä¸­\\(\\alpha_k\\)ä¸ºæ··åˆç³»æ•°ï¼Œ\\(\\theta_k\\)ä¸ºç¬¬kä¸ªé«˜æ–¯åˆ†å¸ƒçš„å‚æ•° \\[ \\begin{aligned} \\hat{\\gamma}_{j k} \u0026=E\\left(\\gamma_{j k} \\mid y, \\theta\\right)=P\\left(\\gamma_{j k}=1 \\mid y, \\theta\\right) \\\\\\\\ \u0026=\\frac{P\\left(\\gamma_{j k}=1, y_j \\mid \\theta\\right)}{\\sum_{k=1}^K P\\left(\\gamma_{j k}=1, y_j \\mid \\theta\\right)} \\\\\\\\ \u0026=\\frac{P\\left(y_j \\mid \\gamma_{j k}=1, \\theta\\right) P\\left(\\gamma_{j k}=1 \\mid \\theta\\right)}{\\sum_{k=1}^K P\\left(y_j \\mid \\gamma_{j k}=1, \\theta\\right) P\\left(\\gamma_{j k}=1 \\mid \\theta\\right)} \\\\\\\\ \u0026=\\frac{\\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}{\\sum_{k=1}^K \\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}, \\quad j=1,2, \\cdots, N ; \\quad k=1,2, \\cdots, K \\end{aligned} \\] å¼å­é‡Œçš„yå…¶å®å°±æ˜¯è§‚æµ‹æ ·æœ¬ã€‚ é‚£ä¹ˆæ¨¡å‹çš„å‚æ•°è¦æ€ä¹ˆä¼°è®¡å‘¢ï¼Œå¾ˆæ˜¾ç„¶å¯ä»¥ä½¿ç”¨EMç®—æ³•ï¼Œ\\(\\gamma\\)ä¸ºéšå˜é‡ï¼Œå…¶å®æˆ‘è¿™é‡Œçš„å™è¿°é¡ºåºæ˜¯æœ‰é—®é¢˜çš„ï¼Œå…¶å®æ˜¯EMç®—æ³•ä¸­æ±‚Qå‡½æ•°çš„è¿‡ç¨‹ä¸­éœ€è¦è®¡ç®—çš„ä¸€ä¸ªå€¼ï¼Œè¯¦ç»†çš„è¿‡ç¨‹åœ¨æœ¬åšå®¢çš„EMç®—æ³•é‡Œé¢ã€‚æ€»ä¹‹å¾—åˆ°äº†\\(\\gamma_{jk}\\)åï¼Œå°±å¾—åˆ°äº†Qå‡½æ•°: \\[ Q\\left(\\theta, \\theta^{(i)}\\right)=\\sum_{k=1}^K\\{n_k \\log \\alpha_k+\\sum_{j=1}^N \\hat{\\gamma}_{j k}\\left[\\log \\left(\\frac{1}{\\sqrt{2 \\pi}}\\right)-\\log \\sigma_k-\\frac{1}{2 \\sigma_k^2}\\left(y_j-\\mu_k\\right)^2\\right]\\} \\] æå¤§ä¼¼ç„¶ä¼°è®¡Qå‡½æ•°å°±å¯ä»¥å¾—åˆ°å‚æ•°çš„ä¸‹ä¸€è½®ä¼°è®¡å€¼ï¼š \\[ \\theta^{(i+1)}=\\arg \\max_\\theta Q\\left(\\theta, \\theta^{(i)}\\right) \\] ç”¨ \\(\\hat{\\mu}_k, \\hat{\\sigma}_k^2\\) åŠ \\(\\hat{\\alpha}_k, k=1,2, \\cdots, K\\), è¡¨ç¤º \\(\\theta^{(i+1)}\\) çš„å„å‚æ•°ã€‚æ±‚ \\(\\hat{\\mu}_k, \\hat{\\sigma}_k^2\\) åªéœ€åˆ†åˆ«å¯¹ \\(\\mu_k, \\sigma_k^2\\) æ±‚åå¯¼æ•°å¹¶ä»¤å…¶ä¸º 0 , å³å¯å¾—åˆ°; æ±‚ \\(\\hat{\\alpha}_k\\) æ˜¯åœ¨ \\(\\sum_{k=1}^K \\alpha_k=1\\) æ¡ä»¶ ä¸‹æ±‚åå¯¼æ•°å¹¶ä»¤å…¶ä¸º 0 å¾—åˆ°çš„ã€‚ç»“æœå¦‚ä¸‹: \\[ \\begin{gathered} \\hat{\\mu}_k=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k} y_j}{\\sum_{j=1}^N \\hat{\\gamma}_{j k}}, \\quad k=1,2, \\cdots, K \\\\\\\\ \\hat{\\sigma}_k^2=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k}\\left(y_j-\\mu_k\\right)^2}{\\sum_{j=1}^N \\hat{\\gamma}_{j k}}, \\quad k=1,2, \\cdots, K \\\\\\\\ \\hat{\\alpha}_k=\\frac{n_k}{N}=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k}}{N}, \\quad k=1,2, \\cdots, K \\end{gathered} \\] å¾—åˆ°å‚æ•°åï¼Œå†è¿›è¡Œæ–°çš„ä¸€è½®è¿­ä»£ï¼Œè®¡ç®—\\(\\gamma\\)å€¼ï¼Œå¦‚æ­¤åå¤ã€‚ ç®—æ³•æ”¶æ•›åï¼Œå°±å¯ä»¥å¯¹æ ·æœ¬è¿›è¡Œèšç±»ï¼Œæ ¹æ®\\(\\lambda_j= \\underbrace{\\arg \\max}_{i\\in {1,2, \\dots ,k}} \\gamma_{jk}\\)å¯ä»¥å¾—åˆ°æ¯ä¸ªæ ·æœ¬çš„ç°‡æ ‡è®°ã€‚å…·ä½“çš„æµç¨‹å¦‚ä¸‹ï¼š ","date":"2022-10-25","objectID":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/:2:0","tags":["Machine Learning","èšç±»ç®—æ³•","é«˜æ–¯æ··åˆèšç±»"],"title":"é«˜æ–¯æ··åˆèšç±»","uri":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"æ€»ç»“ é«˜æ–¯æ··åˆåˆ†å¸ƒçš„å½¢å¼å°±æ³¨å®šäº†å®ƒå¯ä»¥ç”¨æ¥è¿›è¡Œèšç±»ï¼Œå¹¶ä¸”è¿˜æœ‰EMç®—æ³•å¦‚æ­¤å¼ºå¤§çš„æ•°å­¦å·¥å…·è¿›è¡Œæ¨¡å‹å‚æ•°çš„å­¦ä¹ ï¼Œé«˜æ–¯æ··åˆèšç±»ä¸Kmeanséƒ½å±äºåŸå‹èšç±»ã€‚ ","date":"2022-10-25","objectID":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/:3:0","tags":["Machine Learning","èšç±»ç®—æ³•","é«˜æ–¯æ··åˆèšç±»"],"title":"é«˜æ–¯æ··åˆèšç±»","uri":"/%E9%AB%98%E6%96%AF%E6%B7%B7%E5%90%88%E8%81%9A%E7%B1%BB/"},{"categories":["NLP"],"content":"TokenizationæŠ€æœ¯ æœ¬æ–‡ç« ä¸»è¦è¯´è¯´NLPé¢†åŸŸä¸­çš„TokenizationæŠ€æœ¯ï¼Œè¿™æ˜¯å¾ˆåŸºç¡€çš„ä½†ä¹Ÿæ˜¯å¾ˆå®¹æ˜“è¢«å¿½è§†çš„ä¸€ä¸ªæ­¥éª¤ã€‚åœ¨æˆ‘æ¥çš„å•å­ä¸­ç»å¸¸ä¼šæœ‰æ­¤ç±»é—®é¢˜ï¼Œå¹¶ä¸”éƒ½æ˜¯å¤–å›½å­¦æ ¡çš„ï¼Œè¯´æ˜å¤–å›½å­¦æ ¡è¿˜æ˜¯æ¯”è¾ƒæ³¨é‡è¿™ä¸€å—çš„åŸºç¡€çš„ã€‚ é¦–å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼štokenå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç¬¦å·ï¼Œå°±ä»£è¡¨ä¸€ä¸ªè¯­è¨€å•ä½ï¼Œtokenizeçš„æ„æ€å°±æ˜¯æŠŠä¸€ä¸ªå¥å­æˆ–è¯­æ–™åˆ†æˆtoken. ","date":"2022-10-17","objectID":"/tokenization/:0:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"word ","date":"2022-10-17","objectID":"/tokenization/:1:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"char ","date":"2022-10-17","objectID":"/tokenization/:2:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"å­è¯(subword) ","date":"2022-10-17","objectID":"/tokenization/:3:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"BPE BPE æ˜¯ä¸€ç§ç®€å•çš„æ•°æ®å‹ç¼©ç®—æ³•ï¼Œå®ƒåœ¨ 1994 å¹´å‘è¡¨çš„æ–‡ç« â€œA New Algorithm for Data Compressionâ€ä¸­è¢«é¦–æ¬¡æå‡ºã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†è§£é‡Š BPEã€‚è€è§„çŸ©ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼š BPEæ¯ä¸€æ­¥éƒ½å°†æœ€å¸¸è§çš„ä¸€å¯¹ç›¸é‚»æ•°æ®å•ä½æ›¿æ¢ä¸ºè¯¥æ•°æ®ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„ä¸€ä¸ªæ–°å•ä½ï¼Œåå¤è¿­ä»£ç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ã€‚ BPE ç¡®ä¿æœ€å¸¸è§çš„è¯åœ¨tokenåˆ—è¡¨ä¸­è¡¨ç¤ºä¸ºå•ä¸ªtokenï¼Œè€Œç½•è§çš„è¯è¢«åˆ†è§£ä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªsubword tokensï¼Œå› æ­¤BPEä¹Ÿæ˜¯å…¸å‹çš„åŸºäºsubwordçš„tokenizationç®—æ³•ã€‚ åˆå¹¶å­—ç¬¦å¯ä»¥è®©ä½ ç”¨æœ€å°‘çš„tokenæ¥è¡¨ç¤ºè¯­æ–™åº“ï¼Œè¿™ä¹Ÿæ˜¯ BPE ç®—æ³•çš„ä¸»è¦ç›®æ ‡ï¼Œå³æ•°æ®çš„å‹ç¼©ã€‚ä¸ºäº†åˆå¹¶ï¼ŒBPE å¯»æ‰¾æœ€å¸¸å‡ºç°çš„å­—èŠ‚å¯¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å­—ç¬¦è§†ä¸ºä¸å­—èŠ‚ç­‰ä»·ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯è‹±è¯­çš„ç”¨æ³•ï¼Œå…¶ä»–è¯­è¨€å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ç°åœ¨æˆ‘ä»¬å°†æœ€å¸¸è§çš„å­—èŠ‚å¯¹åˆå¹¶æˆä¸€ä¸ªtokenï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°tokenåˆ—è¡¨ä¸­ï¼Œå¹¶é‡æ–°è®¡ç®—æ¯ä¸ªtokenå‡ºç°çš„é¢‘ç‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„é¢‘ç‡è®¡æ•°å°†åœ¨æ¯ä¸ªåˆå¹¶æ­¥éª¤åå‘ç”Ÿå˜åŒ–ã€‚æˆ‘ä»¬å°†ç»§ç»­æ‰§è¡Œæ­¤åˆå¹¶æ­¥éª¤ï¼Œç›´åˆ°è¾¾åˆ°æˆ‘ä»¬é¢„å…ˆè®¾ç½®çš„tokenæ•°é™åˆ¶æˆ–è¿­ä»£é™åˆ¶ã€‚ ","date":"2022-10-17","objectID":"/tokenization/:4:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"ç®—æ³•è¿‡ç¨‹ å‡†å¤‡è¯­æ–™åº“ï¼Œç¡®å®šæœŸæœ›çš„ subword è¯è¡¨å¤§å°ç­‰å‚æ•° é€šå¸¸åœ¨æ¯ä¸ªå•è¯æœ«å°¾æ·»åŠ åç¼€ ï¼Œç»Ÿè®¡æ¯ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡ï¼Œä¾‹å¦‚ï¼Œlow çš„é¢‘ç‡ä¸º 5ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶æ”¹å†™ä¸º â€œl o w â€ï¼š5 å°†è¯­æ–™åº“ä¸­æ‰€æœ‰å•è¯æ‹†åˆ†ä¸ºå•ä¸ªå­—ç¬¦ï¼Œç”¨æ‰€æœ‰å•ä¸ªå­—ç¬¦å»ºç«‹æœ€åˆçš„è¯å…¸ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦çš„é¢‘ç‡ï¼Œæœ¬é˜¶æ®µçš„ subword çš„ç²’åº¦æ˜¯å­—ç¬¦ æŒ‘å‡ºé¢‘æ¬¡æœ€é«˜çš„ç¬¦å·å¯¹Â ï¼Œæ¯”å¦‚è¯´Â tÂ å’ŒÂ hÂ ç»„æˆçš„Â thï¼Œå°†æ–°å­—ç¬¦åŠ å…¥è¯è¡¨ï¼Œç„¶åå°†è¯­æ–™ä¸­æ‰€æœ‰è¯¥å­—ç¬¦å¯¹èåˆï¼ˆmergeï¼‰ï¼Œå³æ‰€æœ‰Â tÂ å’ŒÂ hÂ éƒ½å˜ä¸ºÂ thã€‚ é‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°è¯è¡¨ä¸­å•è¯æ•°è¾¾åˆ°è®¾å®šé‡Â æˆ–ä¸‹ä¸€ä¸ªæœ€é«˜é¢‘æ•°ä¸º 1Â ï¼Œå¦‚æœå·²ç»æ‰“åˆ°è®¾å®šé‡ï¼Œå…¶ä½™çš„è¯æ±‡ç›´æ¥ä¸¢å¼ƒ ","date":"2022-10-17","objectID":"/tokenization/:4:1","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"ä¾‹å­ è·å–è¯­æ–™åº“ï¼Œè¿™æ ·ä¸€æ®µè¯ä¸ºä¾‹ï¼šâ€œ FloydHub is the fastest way to build, train and deploy deep learning models. Build deep learning models in the cloud. Train deep learning models. â€ æ‹†åˆ†ï¼ŒåŠ åç¼€\u003c/w\u003e ï¼Œç»Ÿè®¡è¯é¢‘ å»ºç«‹è¯è¡¨ï¼Œç»Ÿè®¡å­—ç¬¦é¢‘ç‡ï¼ˆé¡ºä¾¿æ’ä¸ªåºï¼‰ï¼š ä»¥ç¬¬ä¸€æ¬¡è¿­ä»£ä¸ºä¾‹ï¼Œå°†å­—ç¬¦é¢‘ç‡æœ€é«˜çš„Â dÂ å’ŒÂ eÂ æ›¿æ¢ä¸ºÂ deï¼Œåé¢ä¾æ¬¡è¿­ä»£ï¼š æ›´æ–°è¯è¡¨ ç»§ç»­è¿­ä»£ç›´åˆ°è¾¾åˆ°é¢„è®¾çš„ subwords è¯è¡¨å¤§å°æˆ–ä¸‹ä¸€ä¸ªæœ€é«˜é¢‘çš„å­—èŠ‚å¯¹å‡ºç°é¢‘ç‡ä¸º 1ã€‚ ### ä¼˜ç‚¹ BPE çš„ä¼˜ç‚¹å°±åœ¨äºï¼Œå¯ä»¥å¾ˆæœ‰æ•ˆåœ°å¹³è¡¡è¯å…¸å¤§å°å’Œç¼–ç æ­¥éª¤æ•°ï¼ˆå°†è¯­æ–™ç¼–ç æ‰€éœ€è¦çš„ token æ•°é‡ï¼‰ã€‚ éšç€åˆå¹¶çš„æ¬¡æ•°å¢åŠ ï¼Œè¯è¡¨å¤§å°é€šå¸¸å…ˆå¢åŠ åå‡å°ã€‚è¿­ä»£æ¬¡æ•°å¤ªå°ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å­—æ¯ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ï¼›è¿­ä»£æ¬¡æ•°å¤šï¼Œåˆé‡æ–°å˜å›äº†åŸæ¥é‚£å‡ ä¸ªè¯ã€‚æ‰€ä»¥è¯è¡¨å¤§å°è¦å–ä¸€ä¸ªä¸­é—´å€¼ã€‚ ","date":"2022-10-17","objectID":"/tokenization/:4:2","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"é€‚ç”¨èŒƒå›´ BPE ä¸€èˆ¬é€‚ç”¨åœ¨æ¬§ç¾è¯­è¨€æ‹‰ä¸è¯­ç³»ä¸­ï¼Œå› ä¸ºæ¬§ç¾è¯­è¨€å¤§å¤šæ˜¯å­—ç¬¦å½¢å¼ï¼Œæ¶‰åŠå‰ç¼€ã€åç¼€çš„å•è¯æ¯”è¾ƒå¤šã€‚è€Œä¸­æ–‡çš„æ±‰å­—ä¸€èˆ¬ä¸ç”¨ BPE è¿›è¡Œç¼–ç ï¼Œå› ä¸ºä¸­æ–‡æ˜¯å­—æ— æ³•è¿›è¡Œæ‹†åˆ†ã€‚å¯¹ä¸­æ–‡çš„å¤„ç†é€šå¸¸åªæœ‰åˆ†è¯å’Œåˆ†å­—ä¸¤ç§ã€‚ç†è®ºä¸Šåˆ†è¯æ•ˆæœæ›´å¥½ï¼Œæ›´å¥½çš„åŒºåˆ«è¯­ä¹‰ã€‚åˆ†å­—æ•ˆç‡é«˜ã€ç®€æ´ï¼Œå› ä¸ºå¸¸ç”¨çš„å­—ä¸è¿‡ 3000 å­—ï¼Œè¯è¡¨æ›´åŠ ç®€çŸ­ã€‚ ","date":"2022-10-17","objectID":"/tokenization/:4:3","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"ç¼–ç è¿‡ç¨‹ BPEçš„æ€»ä½“æ€æƒ³å°±æ˜¯åˆ©ç”¨æ›¿æ¢å­—èŠ‚å¯¹æ¥é€æ­¥æ„é€ è¯æ±‡è¡¨ã€‚åœ¨ä½¿ç”¨çš„è¿‡ç¨‹æœ‰ç¼–ç å’Œè§£ç ä¸¤ç§ã€‚ åœ¨ä¹‹å‰çš„ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†subwordçš„è¯è¡¨ï¼Œå¯¹è¯¥è¯è¡¨æŒ‰ç…§å­è¯é•¿åº¦ç”±å¤§åˆ°å°æ’åºã€‚ç¼–ç æ—¶ï¼Œå¯¹äºæ¯ä¸ªå•è¯ï¼Œéå†æ’å¥½åºçš„å­è¯è¯è¡¨å¯»æ‰¾æ˜¯å¦æœ‰tokenæ˜¯å½“å‰å•è¯çš„å­å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¯¥tokenæ˜¯è¡¨ç¤ºå•è¯çš„tokensä¹‹ä¸€ã€‚ æˆ‘ä»¬ä»æœ€é•¿çš„tokenè¿­ä»£åˆ°æœ€çŸ­çš„tokenï¼Œå°è¯•å°†æ¯ä¸ªå•è¯ä¸­çš„å­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºtokenã€‚ æœ€ç»ˆï¼Œæˆ‘ä»¬å°†è¿­ä»£æ‰€æœ‰tokensï¼Œå¹¶å°†æ‰€æœ‰å­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºtokensã€‚ å¦‚æœä»ç„¶æœ‰å­å­—ç¬¦ä¸²æ²¡è¢«æ›¿æ¢ä½†æ‰€æœ‰tokenéƒ½å·²è¿­ä»£å®Œæ¯•ï¼Œåˆ™å°†å‰©ä½™çš„å­è¯æ›¿æ¢ä¸ºç‰¹æ®Štokenï¼Œå¦‚ ç¼–ç çš„è®¡ç®—é‡å¾ˆå¤§ã€‚ åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥pre-tokenizeæ‰€æœ‰å•è¯ï¼Œå¹¶åœ¨è¯å…¸ä¸­ä¿å­˜å•è¯tokenizeçš„ç»“æœã€‚ å¦‚æœæˆ‘ä»¬çœ‹åˆ°å­—å…¸ä¸­ä¸å­˜åœ¨çš„æœªçŸ¥å•è¯ã€‚ æˆ‘ä»¬åº”ç”¨ä¸Šè¿°ç¼–ç æ–¹æ³•å¯¹å•è¯è¿›è¡Œtokenizeï¼Œç„¶åå°†æ–°å•è¯çš„tokenizationæ·»åŠ åˆ°å­—å…¸ä¸­å¤‡ç”¨ã€‚ ","date":"2022-10-17","objectID":"/tokenization/:4:4","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"ä»£ç  import re, collections def get_vocab(filename): vocab = collections.defaultdict(int) with open(filename, 'r', encoding='utf-8') as fhand: for line in fhand: words = line.strip().split() for word in words: vocab[' '.join(list(word)) + ' \u003c/w\u003e'] += 1 return vocab def get_stats(vocab): # æ„å»ºå­—ç¬¦å¯¹é¢‘æ•°å­—å…¸ pairs = collections.defaultdict(int) for word, freq in vocab.items(): symbols = word.split() for i in range(len(symbols)-1): pairs[symbols[i],symbols[i+1]] += freq return pairs def merge_vocab(pair, v_in): # å°†é¢‘ç‡æœ€å¤§çš„å­—ç¬¦å¯¹æ›¿æ¢ v_out = {} bigram = re.escape(' '.join(pair)) # ä¸è½¬ä¹‰ p = re.compile(r'(?\u003c!\\S)' + bigram + r'(?!\\S)') # æ„æ€æ˜¯bigramå‰é¢æ²¡æœ‰éç©ºæ ¼å­—ç¬¦ï¼Œåé¢ä¹Ÿæ²¡æœ‰éç©ºæ ¼å­—ç¬¦ for word in v_in: w_out = p.sub(''.join(pair), word) v_out[w_out] = v_in[word] return v_out def get_tokens(vocab): tokens = collections.defaultdict(int) for word, freq in vocab.items(): word_tokens = word.split() for token in word_tokens: tokens[token] += freq return tokens vocab = {'l o w \u003c/w\u003e': 5, 'l o w e r \u003c/w\u003e': 2, 'n e w e s t \u003c/w\u003e': 6, 'w i d e s t \u003c/w\u003e': 3} print('==========') print('Tokens Before BPE') tokens = get_tokens(vocab) print('Tokens: {}'.format(tokens)) print('Number of tokens: {}'.format(len(tokens))) print('==========') num_merges = 5 for i in range(num_merges): pairs = get_stats(vocab) if not pairs: break best = max(pairs, key=pairs.get) vocab = merge_vocab(best, vocab) print('Iter: {}'.format(i)) print('Best pair: {}'.format(best)) print(vocab) # tokens = get_tokens(vocab) # print('Tokens: {}'.format(tokens)) ","date":"2022-10-17","objectID":"/tokenization/:4:5","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"wordpiece ","date":"2022-10-17","objectID":"/tokenization/:5:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"æ„é€  wordpiece è¯è¡¨çš„æ„é€ ä¸BPEå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯é€‰æ‹©ä¸¤ä¸ªå­è¯åˆå¹¶æˆæ–°çš„å­è¯ã€‚ æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼ŒBPEæ˜¯é€‰æ‹©é¢‘æ•°æœ€é«˜çš„ç›¸é‚»å­è¯åˆå¹¶ï¼Œè€Œwordpieceé€‰æ‹©èƒ½å¤Ÿæå‡è¯­è¨€æ¨¡å‹æ¦‚ç‡æœ€å¤§çš„ç›¸é‚»å­è¯åŠ å…¥è¯è¡¨ã€‚ å¦‚ä½•ç†è§£ï¼Ÿ å‡è®¾å„ä¸ªå­è¯ä¹‹é—´æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œåˆ™å¥å­Sçš„è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼ç­‰ä»·äºæ‰€æœ‰å­è¯æ¦‚ç‡çš„ä¹˜ç§¯ å‡è®¾æŠŠç›¸é‚»ä½ç½®çš„xå’Œyä¸¤ä¸ªå­è¯è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶åäº§ç”Ÿçš„å­è¯è®°ä¸ºzï¼Œæ­¤æ—¶å¥å­Sä¼¼ç„¶å€¼çš„å˜åŒ–å¯è¡¨ç¤ºä¸ºï¼š ä»ä¸Šé¢çš„å…¬å¼ï¼Œå¾ˆå®¹æ˜“å‘ç°ï¼Œä¼¼ç„¶å€¼çš„å˜åŒ–å°±æ˜¯ä¸¤ä¸ªå­è¯ä¹‹é—´çš„äº’ä¿¡æ¯ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒWordPieceæ¯æ¬¡é€‰æ‹©åˆå¹¶çš„ä¸¤ä¸ªå­è¯ï¼Œä»–ä»¬å…·æœ‰æœ€å¤§çš„äº’ä¿¡æ¯å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸¤å­è¯åœ¨è¯­è¨€æ¨¡å‹ä¸Šå…·æœ‰è¾ƒå¼ºçš„å…³è”æ€§ï¼Œå®ƒä»¬ç»å¸¸åœ¨è¯­æ–™ä¸­ä»¥ç›¸é‚»æ–¹å¼åŒæ—¶å‡ºç°ã€‚ ä¸BPEç›¸ä¼¼ï¼Œé€šè¿‡ä»¥ä¸Šæ–¹å¼æ„å»ºè¯è¡¨ã€‚ ### ç¼–ç  1. ä»ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œç”±äºæ˜¯æœ€é•¿åŒ¹é…ï¼Œç»“æŸä½ç½®éœ€è¦ä»æœ€å³ç«¯ä¾æ¬¡é€’å‡ï¼Œæ‰€ä»¥éå†çš„ç¬¬ä¸€ä¸ªå­è¯ æ˜¯å…¶æœ¬èº« unaffableï¼Œè¯¥å­è¯ä¸åœ¨è¯æ±‡è¡¨ä¸­ 2. ç»“æŸä½ç½®å·¦ç§»ä¸€ä½å¾—åˆ°å­è¯ unaffablï¼ŒåŒæ ·ä¸åœ¨è¯æ±‡è¡¨ä¸­ 3. é‡å¤è¿™ä¸ªæ“ä½œï¼Œç›´åˆ° unï¼Œè¯¥å­è¯åœ¨è¯æ±‡è¡¨ä¸­ï¼Œå°†å…¶åŠ å…¥ output_tokensï¼Œä»¥ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ çš„éå†ç»“æŸ 4. è·³è¿‡ unï¼Œä»å…¶åçš„ a å¼€å§‹æ–°ä¸€è½®éå†ï¼Œç»“æŸä½ç½®ä¾ç„¶æ˜¯ä»æœ€å³ç«¯ä¾æ¬¡é€’å‡ï¼Œä½†æ­¤æ—¶éœ€è¦åœ¨å‰ é¢åŠ ä¸Š ## æ ‡è®°ï¼Œå¾—åˆ° ##affable ä¸åœ¨è¯æ±‡è¡¨ä¸­ 5. ç»“æŸä½ç½®å·¦ç§»ä¸€ä½å¾—åˆ°å­è¯ ##affablï¼ŒåŒæ ·ä¸åœ¨è¯æ±‡è¡¨ä¸­ 6. é‡å¤è¿™ä¸ªæ“ä½œï¼Œç›´åˆ° ##affï¼Œè¯¥å­—è¯åœ¨è¯æ±‡è¡¨ä¸­ï¼Œ å°†å…¶åŠ å…¥ output_tokensï¼Œæ­¤è½®éå†ç»“æŸ 7. è·³è¿‡ affï¼Œä»å…¶åçš„ a å¼€å§‹æ–°ä¸€è½®éå†ï¼Œç»“æŸä½ç½®ä¾ç„¶æ˜¯ä»æœ€å³ç«¯ä¾æ¬¡é€’å‡ã€‚##able åœ¨è¯æ±‡ è¡¨ä¸­ï¼Œå°†å…¶åŠ å…¥ output_tokens 8. able åæ²¡æœ‰å­—ç¬¦äº†ï¼Œæ•´ä¸ªéå†ç»“æŸ ","date":"2022-10-17","objectID":"/tokenization/:5:1","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"ä»£ç  (æ¥è‡ªhttps://github.com/google-research/bert/blob/master/tokenization.py) class WordpieceTokenizer(object): \"\"\"Runs WordPiece tokenziation.\"\"\" def __init__(self, vocab, unk_token=\"[UNK]\", max_input_chars_per_word=200): self.vocab = vocab self.unk_token = unk_token self.max_input_chars_per_word = max_input_chars_per_word def tokenize(self, text): \"\"\"Tokenizes a piece of text into its word pieces. This uses a greedy longest-match-first algorithm to perform tokenization using the given vocabulary. For example: input = \"unaffable\" output = [\"un\", \"##aff\", \"##able\"] Args: text: A single token or whitespace separated tokens. This should have already been passed through `BasicTokenizer. Returns: A list of wordpiece tokens. \"\"\" text = convert_to_unicode(text) output_tokens = [] for token in whitespace_tokenize(text): chars = list(token) if len(chars) \u003e self.max_input_chars_per_word: output_tokens.append(self.unk_token) continue is_bad = False start = 0 sub_tokens = [] while start \u003c len(chars): end = len(chars) cur_substr = None while start \u003c end: substr = \"\".join(chars[start:end]) if start \u003e 0: substr = \"##\" + substr if substr in self.vocab: cur_substr = substr break end -= 1 if cur_substr is None: is_bad = True break sub_tokens.append(cur_substr) start = end if is_bad: output_tokens.append(self.unk_token) else: output_tokens.extend(sub_tokens) return output_tokens ","date":"2022-10-17","objectID":"/tokenization/:5:2","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"Unigram Language Model ä¸WordPieceä¸€æ ·ï¼ŒUnigram Language Model(ULM)åŒæ ·ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥æŒ‘é€‰å­è¯ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒBPEå’ŒWordPieceç®—æ³•çš„è¯è¡¨å¤§å°éƒ½æ˜¯ä»å°åˆ°å¤§å˜åŒ–ï¼Œå±äºå¢é‡æ³•ã€‚è€ŒUnigram Language Modelåˆ™æ˜¯å‡é‡æ³•,å³å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤§è¯è¡¨ï¼Œæ ¹æ®è¯„ä¼°å‡†åˆ™ä¸æ–­ä¸¢å¼ƒè¯è¡¨ï¼Œç›´åˆ°æ»¡è¶³é™å®šæ¡ä»¶ã€‚ULMç®—æ³•è€ƒè™‘äº†å¥å­çš„ä¸åŒåˆ†è¯å¯èƒ½ï¼Œå› è€Œèƒ½å¤Ÿè¾“å‡ºå¸¦æ¦‚ç‡çš„å¤šä¸ªå­è¯åˆ†æ®µã€‚ åˆå§‹æ—¶ï¼Œå»ºç«‹ä¸€ä¸ªè¶³å¤Ÿå¤§çš„è¯è¡¨(ä½¿ç”¨ä¸€äº›ç®—æ³•)ã€‚ä¸€èˆ¬ï¼Œå¯ç”¨è¯­æ–™ä¸­çš„æ‰€æœ‰å­—ç¬¦åŠ ä¸Šå¸¸è§çš„å­å­—ç¬¦ä¸²åˆå§‹åŒ–è¯è¡¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡BPEç®—æ³•åˆå§‹åŒ–ã€‚ é’ˆå¯¹å½“å‰è¯è¡¨ï¼Œç”¨EMç®—æ³•æ±‚è§£æ¯ä¸ªå­è¯åœ¨è¯­æ–™ä¸Šçš„æ¦‚ç‡ã€‚ å¯¹äºæ¯ä¸ªå­è¯ï¼Œè®¡ç®—å½“è¯¥å­è¯è¢«ä»è¯è¡¨ä¸­ç§»é™¤æ—¶ï¼Œæ€»çš„lossé™ä½äº†å¤šå°‘ï¼Œè®°ä¸ºè¯¥å­è¯çš„lossã€‚ å°†å­è¯æŒ‰ç…§losså¤§å°è¿›è¡Œæ’åºï¼Œä¸¢å¼ƒä¸€å®šæ¯”ä¾‹lossæœ€å°çš„å­è¯(æ¯”å¦‚20%)ï¼Œä¿ç•™ä¸‹æ¥çš„å­è¯ç”Ÿæˆæ–°çš„è¯è¡¨ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå•å­—ç¬¦ä¸èƒ½è¢«ä¸¢å¼ƒï¼Œè¿™æ˜¯ä¸ºäº†é¿å…OOVæƒ…å†µã€‚ é‡å¤æ­¥éª¤2åˆ°4ï¼Œç›´åˆ°è¯è¡¨å¤§å°å‡å°‘åˆ°è®¾å®šèŒƒå›´ã€‚ å¯ä»¥çœ‹å‡ºï¼ŒULMä¼šä¿ç•™é‚£äº›ä»¥è¾ƒé«˜é¢‘ç‡å‡ºç°åœ¨å¾ˆå¤šå¥å­çš„åˆ†è¯ç»“æœä¸­çš„å­è¯ï¼Œå› ä¸ºè¿™äº›å­è¯å¦‚æœè¢«ä¸¢å¼ƒï¼Œå…¶æŸå¤±ä¼šå¾ˆå¤§ã€‚ ### ä»£ç  encodeä»£ç  def encode_word(word, model): # wordåˆæ­¥åˆ†è¯ï¼Œmodelä¸­ä¸º-logå€¼ best_segmentations = [{\"start\": 0, \"score\": 1}] + [ {\"start\": None, \"score\": None} for _ in range(len(word)) ] for start_idx in range(len(word)): # This should be properly filled by the previous steps of the loop best_score_at_start = best_segmentations[start_idx][\"score\"] for end_idx in range(start_idx + 1, len(word) + 1): token = word[start_idx:end_idx] if token in model and best_score_at_start is not None: score = model[token] + best_score_at_start # åŠ ä¸Šstartï¼Œå³å‰ç¼€å¯¹åº”çš„æŸå¤±ï¼Œlogä¸­ç›¸åŠ ç­‰äºåŸæ¥æ¦‚ç‡ç›¸ä¹˜ # If we have found a better segmentation ending at end_idx, we update if ( best_segmentations[end_idx][\"score\"] is None or best_segmentations[end_idx][\"score\"] \u003e score # scoreå³lossã€‚è¶Šå°è¶Šå¥½ ): best_segmentations[end_idx] = {\"start\": start_idx, \"score\": score} print(token) print(best_segmentations[end_idx][\"score\"], score) print(best_segmentations) segmentation = best_segmentations[-1] if segmentation[\"score\"] is None: # We did not find a tokenization of the word -\u003e unknown return [\"\u003cunk\u003e\"], None # ä»åå‘å‰çš„æœ€ä½³è·¯å¾„ï¼Œå³ç»´ç‰¹æ¯”ç®—æ³• score = segmentation[\"score\"] start = segmentation[\"start\"] end = len(word) tokens = [] while start != 0: tokens.insert(0, word[start:end]) next_start = best_segmentations[start][\"start\"] end = start start = next_start tokens.insert(0, word[start:end]) return tokens, score è®¡ç®—Loss def compute_loss(model): loss = 0 for word, freq in word_freqs.items(): _, word_loss = encode_word(word, model) loss += freq * word_loss return loss è®¡ç®—score(ç”¨äºåˆ é™¤token) import copy def compute_scores(model): scores = {} model_loss = compute_loss(model) for token, score in model.items(): # We always keep tokens of length 1 if len(token) == 1: continue model_without_token = copy.deepcopy(model) _ = model_without_token.pop(token) scores[token] = compute_loss(model_without_token) - model_loss return scores ","date":"2022-10-17","objectID":"/tokenization/:6:0","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"å‚è€ƒ Unigram tokenization - Hugging Face NLP è¯¾ç¨‹ ","date":"2022-10-17","objectID":"/tokenization/:6:1","tags":["NLP","tokenization"],"title":"tokenization","uri":"/tokenization/"},{"categories":["NLP"],"content":"CoVe Coveä»£è¡¨ä¸Šä¸‹æ–‡å‘é‡ï¼Œå®ƒæ˜¯ä¸€ç§æœ‰ç›‘ç£çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå…¶ä¸»è¦æ€æƒ³å°±æ˜¯è®­ç»ƒäº†ä¸€ä¸ªNMTç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨å®ƒçš„ç¼–ç å™¨ï¼Œ ","date":"2022-10-09","objectID":"/cove/:0:0","tags":["NLP","CoVe"],"title":"CoVe","uri":"/cove/"},{"categories":["NLP"],"content":"æ¨¡å‹è®­ç»ƒ ä¸»è¦å‡è®¾æ˜¯ï¼Œä¸ºäº†ç¿»è¯‘ä¸€ä¸ªå¥å­ï¼ŒNMTç¼–ç å™¨å­¦ä¼šç†è§£å¥å­ã€‚ å› æ­¤æ¥è‡ªç¼–ç å™¨çš„å‘é‡åŒ…å«æœ‰å…³å•è¯ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ã€‚ å½¢å¼ä¸Šï¼Œä½œè€…è®­ç»ƒäº†ä¸€ä¸ªå¸¦æ³¨æ„åŠ›çš„LSTMæ¨¡å‹ï¼Œæ¯”å¦‚Bahdanau Modelï¼Œç”±äºæœ€ç»ˆæˆ‘ä»¬æƒ³ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„ç¼–ç å™¨æ¥å¤„ç†è‹±æ–‡å¥å­ï¼ˆä¸æ˜¯å› ä¸ºæˆ‘ä»¬åªå…³å¿ƒè‹±æ–‡ï¼Œè€Œæ˜¯å› ä¸ºä¸‹æ¸¸ä»»åŠ¡çš„å¤§å¤šæ•°æ•°æ®é›†éƒ½æ˜¯è‹±æ–‡çš„ï¼‰ï¼Œæ‰€ä»¥ NMT ç³»ç»Ÿå¿…é¡»ä»è‹±æ–‡ç¿»è¯‘æˆå…¶ä»–çš„è¯­è¨€ï¼ˆä¾‹å¦‚ï¼Œå¾·è¯­ï¼‰ã€‚ ","date":"2022-10-09","objectID":"/cove/:1:0","tags":["NLP","CoVe"],"title":"CoVe","uri":"/cove/"},{"categories":["NLP"],"content":"åŒå‘ç¼–ç å™¨ è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ª NMT æ¨¡å‹ä¸­ï¼Œç¼–ç å™¨æ˜¯åŒå‘çš„ï¼šå®ƒè¿æ¥å‰å‘å’Œåå‘ LSTM çš„è¾“å‡ºã€‚å› æ­¤ï¼Œç¼–ç å™¨è¾“å‡ºåŒ…å«æœ‰å…³ä»¤ç‰Œå·¦å³ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ã€‚ ","date":"2022-10-09","objectID":"/cove/:2:0","tags":["NLP","CoVe"],"title":"CoVe","uri":"/cove/"},{"categories":["NLP"],"content":"è·å–è¡¨ç¤º(è¿æ¥ GloVe å’Œ Cove å‘é‡) è®­ç»ƒ NTM æ¨¡å‹åï¼Œæˆ‘ä»¬åªéœ€è¦å®ƒçš„ç¼–ç å™¨ã€‚å¯¹äºç»™å®šçš„æ–‡æœ¬ï¼ŒCoVe å‘é‡æ˜¯ç¼–ç å™¨çš„è¾“å‡ºã€‚å¯¹äºä¸‹æ¸¸ä»»åŠ¡ï¼Œä½œè€…å»ºè®®ä½¿ç”¨ Gloveï¼ˆä»£è¡¨å•ä¸ªä»¤ç‰Œï¼‰å’Œ CoVeï¼ˆåœ¨ä¸Šä¸‹æ–‡ä¸­ç¼–ç çš„ä»¤ç‰Œï¼‰å‘é‡çš„ä¸²è”ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯è¿™äº›å‘é‡ç¼–ç ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒä»¬çš„ç»„åˆå¯èƒ½å¾ˆæœ‰ç”¨ã€‚ ","date":"2022-10-09","objectID":"/cove/:3:0","tags":["NLP","CoVe"],"title":"CoVe","uri":"/cove/"},{"categories":["NLP"],"content":"æ€»ç»“ å…¶å®æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯å°†å·²ç»è®­ç»ƒå¥½çš„æœºå™¨ç¿»è¯‘æ¨¡å‹çš„ç¼–ç å™¨ä½œä¸ºç¼–ç ï¼Œæœ€åå†ä¸GloVeè¿›è¡Œæ‹¼æ¥ï¼Œå¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯æœºå™¨ç¿»è¯‘æ¨¡å‹ï¼Œå› æ­¤å¯ä»¥è§†ä¸ºæœ‰ç›‘ç£å­¦ä¹ ï¼Œæœ‰ç›‘ç£çš„é¢„è®­ç»ƒæ¨¡å‹æ˜¯å¾ˆå°‘çš„ï¼ŒCoVeå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå…¶ä¸­æ›´å…·ä½“çš„åˆ†ç±»å¯ä»¥çœ‹æœ¬åšå®¢çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚ ","date":"2022-10-09","objectID":"/cove/:4:0","tags":["NLP","CoVe"],"title":"CoVe","uri":"/cove/"},{"categories":["Machine Learning"],"content":"EMç®—æ³• ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:0:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"å¼•å…¥ æˆ‘ä»¬ç»å¸¸ä¼šä»æ ·æœ¬è§‚å¯Ÿæ•°æ®ä¸­ï¼Œæ‰¾å‡ºæ ·æœ¬çš„æ¨¡å‹å‚æ•°ã€‚ æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯æå¤§åŒ–æ¨¡å‹åˆ†å¸ƒçš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°ã€‚ï¼ˆæœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼šåˆ©ç”¨å·²çŸ¥çš„æ ·æœ¬ç»“æœï¼Œåæ¨æœ€æœ‰å¯èƒ½å¯¼è‡´è¿™æ ·ç»“æœçš„ä¸€ç»„å‚æ•°ï¼‰ä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾—åˆ°çš„è§‚å¯Ÿæ•°æ®æœ‰æœªè§‚å¯Ÿåˆ°çš„éšå«æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœªçŸ¥çš„æœ‰éšå«æ•°æ®å’Œæ¨¡å‹å‚æ•°ï¼Œå› è€Œæ— æ³•ç›´æ¥ç”¨æå¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°å¾—åˆ°æ¨¡å‹åˆ†å¸ƒçš„å‚æ•°ã€‚ç”¨EMç®—æ³•å¯ä»¥è§£å†³ã€‚ EMç®—æ³•æ˜¯ä¸€ç§è¿­ä»£ç®—æ³•ï¼Œç”¨äºå«æœ‰éšå˜é‡çš„æ¦‚ç‡æ¨¡å‹å‚æ•°çš„æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œæˆ–æå¤§åéªŒæ¦‚ç‡ä¼°è®¡ã€‚ EMç®—æ³•çš„æ¯æ¬¡è¿­ä»£ç”±ä¸¤æ­¥ç»„æˆï¼šEæ­¥ï¼Œæ±‚æœŸæœ›ï¼›Mæ­¥ï¼Œæ±‚æå¤§ã€‚æ‰€ä»¥è¢«ç§°ä¸ºæœŸæœ›æå¤§ç®—æ³•ã€‚ EMç®—æ³•è§£å†³è¿™ä¸ªçš„æ€è·¯æ˜¯ä½¿ç”¨å¯å‘å¼çš„è¿­ä»£æ–¹æ³•ï¼Œæ—¢ç„¶æˆ‘ä»¬æ— æ³•ç›´æ¥æ±‚å‡ºæ¨¡å‹åˆ†å¸ƒå‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆçŒœæƒ³éšå«æ•°æ®ï¼ˆEMç®—æ³•çš„Eæ­¥ï¼‰ï¼Œæ¥ç€åŸºäºè§‚å¯Ÿæ•°æ®å’ŒçŒœæµ‹çš„éšå«æ•°æ®ä¸€èµ·æ¥æå¤§åŒ–å¯¹æ•°ä¼¼ç„¶ï¼Œæ±‚è§£æˆ‘ä»¬çš„æ¨¡å‹å‚æ•°ï¼ˆEMç®—æ³•çš„Mæ­¥)ã€‚ç”±äºæˆ‘ä»¬ä¹‹å‰çš„éšè—æ•°æ®æ˜¯çŒœæµ‹çš„ï¼Œæ‰€ä»¥æ­¤æ—¶å¾—åˆ°çš„æ¨¡å‹å‚æ•°ä¸€èˆ¬è¿˜ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åŸºäºå½“å‰å¾—åˆ°çš„æ¨¡å‹å‚æ•°ï¼Œç»§ç»­çŒœæµ‹éšå«æ•°æ®ï¼ˆEMç®—æ³•çš„Eæ­¥ï¼‰ï¼Œç„¶åç»§ç»­æå¤§åŒ–å¯¹æ•°ä¼¼ç„¶ï¼Œæ±‚è§£æˆ‘ä»¬çš„æ¨¡å‹å‚æ•°ï¼ˆEMç®—æ³•çš„Mæ­¥)ã€‚ä»¥æ­¤ç±»æ¨ï¼Œä¸æ–­çš„è¿­ä»£ä¸‹å»ï¼Œç›´åˆ°æ¨¡å‹åˆ†å¸ƒå‚æ•°åŸºæœ¬æ— å˜åŒ–ï¼Œç®—æ³•æ”¶æ•›ï¼Œæ‰¾åˆ°åˆé€‚çš„æ¨¡å‹å‚æ•°ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:1:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"ä¸‰ç¡¬å¸æ¨¡å‹ é¦–å…ˆä»‹ç»ä¸€ä¸ªä½¿ç”¨ EMç®—æ³•çš„ä¾‹å­ã€‚ (ä¸‰ç¡¬å¸æ¨¡å‹) å‡è®¾æœ‰ 3 æšç¡¬å¸, åˆ†åˆ«è®°ä½œ A, B, Cã€‚è¿™äº›ç¡¬å¸æ­£é¢å‡ºç° çš„æ¦‚ç‡åˆ†åˆ«æ˜¯ \\(\\pi, p\\) å’Œ \\(q\\) ã€‚è¿›è¡Œå¦‚ä¸‹éƒ‘ç¡¬å¸è¯•éªŒ: å…ˆæ·ç¡¬å¸ \\(\\mathrm{A}\\), æ ¹æ®å…¶ç»“æœé€‰å‡ºç¡¬å¸ \\(\\mathrm{B}\\) æˆ–ç¡¬å¸ \\(\\mathrm{C}\\), æ­£é¢é€‰ç¡¬å¸ \\(\\mathrm{B}\\), åé¢é€‰ç¡¬å¸ \\(\\mathrm{C}\\); ç„¶åéƒ‘é€‰å‡ºçš„ç¡¬å¸, æ·ç¡¬å¸çš„ç»“æœ, å‡ºç°æ­£ é¢è®°ä½œ 1 , å‡ºç°åé¢è®°ä½œ 0 ; ç‹¬ç«‹åœ°é‡å¤ \\(n\\) æ¬¡è¯•éªŒ (è¿™é‡Œ, \\(n=10\\) ), è§‚æµ‹ç»“æœå¦‚ä¸‹: \\[ 1,1,0,1,0,0,1,0,1,1 \\] å‡è®¾åªèƒ½è§‚æµ‹åˆ°éƒ‘ç¡¬å¸çš„ç»“æœ, ä¸èƒ½è§‚æµ‹éƒ‘ç¡¬å¸çš„è¿‡ç¨‹ã€‚é—®å¦‚ä½•ä¼°è®¡ä¸‰ç¡¬å¸æ­£é¢å‡ºç° çš„æ¦‚ç‡, å³ä¸‰ç¡¬å¸æ¨¡å‹çš„å‚æ•°ã€‚ è§£ ä¸‰ç¡¬å¸æ¨¡å‹å¯ä»¥å†™ä½œ \\[ \\begin{aligned} P(y \\mid \\theta) \u0026=\\sum_z P(y, z \\mid \\theta)=\\sum_z P(z \\mid \\theta) P(y \\mid z, \\theta) \\\\\\\\ \u0026=\\pi p^y(1-p)^{1-y}+(1-\\pi) q^y(1-q)^{1-y} \\end{aligned} \\] è¿™é‡Œ, éšæœºå˜é‡ \\(y\\) æ˜¯è§‚æµ‹å˜é‡, è¡¨ç¤ºä¸€æ¬¡è¯•éªŒè§‚æµ‹çš„ç»“æœæ˜¯ 1 æˆ– 0 ; éšæœºå˜é‡ \\(z\\) æ˜¯éš å˜é‡, è¡¨ç¤ºæœ«è§‚æµ‹åˆ°çš„æ·ç¡¬å¸ \\(\\mathrm{A}\\) çš„ç»“æœ; \\(\\theta=(\\pi, p, q)\\) æ˜¯æ¨¡å‹å‚æ•°ã€‚è¿™ä¸€æ¨¡å‹æ˜¯ä»¥ä¸Šæ•° æ®çš„ç”Ÿæˆæ¨¡å‹ã€‚æ³¨æ„, éšæœºå˜é‡ \\(y\\) çš„æ•°æ®å¯ä»¥è§‚æµ‹, éšæœºå˜é‡ \\(z\\) çš„æ•°æ®ä¸å¯è§‚æµ‹ã€‚ å°†è§‚æµ‹æ•°æ®è¡¨ç¤ºä¸º \\(Y=\\left(Y_1, Y_2, \\cdots, Y_n\\right)^{\\mathrm{T}}\\), æœ«è§‚æµ‹æ•°æ®è¡¨ç¤ºä¸º \\(Z=\\left(Z_1, Z_2, \\cdots, Z_n\\right)^{\\mathrm{T}}\\) åˆ™è§‚æµ‹æ•°æ®çš„ä¼¼ç„¶å‡½æ•°ä¸º \\[ P(Y \\mid \\theta)=\\sum_Z P(Z \\mid \\theta) P(Y \\mid Z, \\theta) \\] å³ \\[ P(Y \\mid \\theta)=\\prod_{j=1}^n\\left[\\pi p^{y_j}(1-p)^{1-y_j}+(1-\\pi) q^{y_j}(1-q)^{1-y_j}\\right] \\] è€ƒè™‘æ±‚æ¨¡å‹å‚æ•° \\(\\theta=(\\pi, p, q)\\) çš„æå¤§ä¼¼ç„¶ä¼°è®¡, å³ \\[ \\hat{\\theta}=\\arg \\max_\\theta \\log P(Y \\mid \\theta) \\] è¿™ä¸ªé—®é¢˜æ²¡æœ‰è§£æè§£, åªæœ‰é€šè¿‡è¿­ä»£çš„æ–¹æ³•æ±‚è§£ã€‚EMç®—æ³•å°±æ˜¯å¯ä»¥ç”¨äºæ±‚è§£è¿™ ä¸ªé—®é¢˜çš„ä¸€ç§è¿­ä»£ç®—æ³•ã€‚ä¸‹é¢ç»™å‡ºé’ˆå¯¹ä»¥ä¸Šé—®é¢˜çš„ EMç®—æ³•, å…¶æ¨å¯¼è¿‡ç¨‹çœç•¥ã€‚ EMç®—æ³•é¦–å…ˆé€‰å–å‚æ•°çš„åˆå€¼, è®°ä½œ \\(\\theta^{(0)}=\\left(\\pi^{(0)}, p^{(0)}, q^{(0)}\\right)\\), ç„¶åé€šè¿‡ä¸‹é¢çš„ æ­¥éª¤è¿­ä»£è®¡ç®—å‚æ•°çš„ä¼°è®¡å€¼, ç›´è‡³æ”¶æ•›ä¸ºæ­¢ã€‚ç¬¬ \\(i\\) æ¬¡è¿­ä»£å‚æ•°çš„ä¼°è®¡å€¼ä¸º \\(\\theta^{(i)}=\\) \\(\\left(\\pi^{(i)}, p^{(i)}, q^{(i)}\\right)\\) ã€‚EMç®—æ³•çš„ç¬¬ \\(i+1\\) æ¬¡è¿­ä»£å¦‚ä¸‹ã€‚ \\(\\mathrm{E}\\) æ­¥ï¼šè®¡ç®—åœ¨æ¨¡å‹å‚æ•° \\(\\pi^{(i)}, p^{(i)}, q^{(i)}\\) ä¸‹è§‚æµ‹æ•°æ® \\(y_j\\) æ¥è‡ªéƒ‘ç¡¬å¸ \\(\\mathrm{B}\\) çš„æ¦‚ç‡ã€‚è¿™é‡Œå°±æ˜¯ä½¿ç”¨çš„è´å¶æ–¯å®šç†ã€‚ \\[ \\mu_j^{(i+1)}=\\frac{\\pi^{(i)}\\left(p^{(i)}\\right)^{y_j}\\left(1-p^{(i)}\\right)^{1-y_j}}{\\pi^{(i)}\\left(p^{(i)}\\right)^{y_j}\\left(1-p^{(i)}\\right)^{1-y_j}+\\left(1-\\pi^{(i)}\\right)\\left(q^{(i)}\\right)^{y_j}\\left(1-q^{(i)}\\right)^{1-y_j}} \\] \\(\\mathrm{M}\\) æ­¥ï¼šè®¡ç®—æ¨¡å‹å‚æ•°çš„æ–°ä¼°è®¡å€¼ \\[ \\pi^{(i+1)}=\\frac{1}{n} \\sum_{j=1}^n \\mu_j^{(i+1)} \\] \\[ \\begin{gathered} p^{(i+1)}=\\frac{\\sum_{j=1}^n \\mu_j^{(i+1)} y_j}{\\sum_{j=1}^n \\mu_j^{(i+1)}} \\\\\\\\ q^{(i+1)}=\\frac{\\sum_{j=1}^n\\left(1-\\mu_j^{(i+1)}\\right) y_j}{\\sum_{j=1}^n\\left(1-\\mu_j^{(i+1)}\\right)} \\end{gathered} \\] è¿›è¡Œæ•°å€¼è®¡ç®—ã€‚å‡è®¾æ¨¡å‹å‚æ•°çš„åˆå€¼å–ä¸º \\[ \\pi^{(0)}=0.5, \\quad p^{(0)}=0.5, \\quad q^{(0)}=0.5 \\] å¯¹ \\(y_j=1\\) ä¸ \\(y_j=0\\) å‡æœ‰ \\(\\mu_j^{(1)}=0.5\\) ã€‚ åˆ©ç”¨è¿­ä»£å…¬å¼, å¾—åˆ° \\[ \\pi^{(1)}=0.5, \\quad p^{(1)}=0.6, \\quad q^{(1)}=0.6 \\] \\[ \\mu_j^{(2)}=0.5, \\quad j=1,2, \\cdots, 10 \\] ç»§ç»­è¿­ä»£, å¾— \\[ \\pi^{(2)}=0.5, \\quad p^{(2)}=0.6, \\quad q^{(2)}=0.6 \\] äºæ˜¯å¾—åˆ°æ¨¡å‹å‚æ•° \\(\\theta\\) çš„æå¤§ä¼¼ç„¶ä¼°è®¡: \\[ \\hat{\\pi}=0.5, \\quad \\hat{p}=0.6, \\quad \\hat{q}=0.6 \\] \\(\\pi=0.5\\) è¡¨ç¤ºç¡¬å¸ A æ˜¯å‡åŒ€çš„, è¿™ä¸€ç»“æœå®¹æ˜“ç†è§£ã€‚ å¦‚æœå–åˆå€¼ \\(\\pi^{(0)}=0.4, p^{(0)}=0.6, q^{(0)}=0.7\\), é‚£ä¹ˆå¾—åˆ°çš„æ¨¡å‹å‚æ•°çš„æå¤§ä¼¼ç„¶ ä¼°è®¡æ˜¯ \\(\\hat{\\pi}=0.4064, \\hat{p}=0.5368, \\hat{q}=0.6432\\) ã€‚è¿™å°±æ˜¯è¯´, EMç®—æ³•ä¸åˆå€¼çš„é€‰æ‹©æœ‰å…³, é€‰æ‹©ä¸åŒçš„åˆå€¼å¯èƒ½å¾—åˆ°ä¸åŒçš„å‚æ•°ä¼°è®¡å€¼ã€‚ ä¸€èˆ¬åœ°, ç”¨ \\(Y\\) è¡¨ç¤ºè§‚æµ‹éšæœºå˜é‡çš„æ•°æ®, \\(Z\\) è¡¨ç¤ºéšéšæœºå˜é‡çš„æ•°æ®ã€‚ \\(Y\\) å’Œ \\(Z\\) è¿ åœ¨ä¸€èµ·ç§°ä¸ºå®Œå…¨æ•°æ® (complete-data), è§‚æµ‹æ•°æ® \\(Y\\) åˆç§°ä¸ºä¸å®Œå…¨æ•°æ® (incompletedataï¼‰ã€‚å‡è®¾ç»™å®šè§‚æµ‹æ•°æ® \\(Y\\), å…¶æ¦‚ç‡åˆ†å¸ƒæ˜¯ \\(P(Y \\mid \\theta)\\), å…¶ä¸­ \\(\\theta\\) æ˜¯éœ€è¦ä¼°è®¡çš„æ¨¡å‹å‚æ•°, é‚£ä¹ˆä¸å®Œå…¨æ•°æ® \\(Y\\) çš„ä¼¼ç„¶å‡½æ•°æ˜¯ \\(P(Y \\mid \\theta)\\), å¯¹æ•°ä¼¼ç„¶å‡½æ•° \\(L(\\theta)=\\log P(Y \\mid \\theta)\\); å‡è®¾ \\(Y\\) å’Œ \\(Z\\) çš„è”åˆæ¦‚ç‡åˆ†å¸ƒæ˜¯ \\(P(Y, Z \\mid \\theta)\\), é‚£ä¹ˆå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ˜¯ \\(\\log P(Y, Z \\mid \\theta)\\) ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:2:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"ç®—æ³•æ­¥éª¤ è¾“å…¥: è§‚æµ‹å˜é‡æ•°æ® \\(Y\\), éšå˜é‡æ•°æ® \\(Z\\), è”åˆåˆ†å¸ƒ \\(P(Y, Z \\mid \\theta)\\), æ¡ä»¶åˆ†å¸ƒ \\(P(Z \\mid Y, \\theta)\\); è¾“å‡ºï¼šæ¨¡å‹å‚æ•° \\(\\theta\\) ã€‚ ï¼ˆ1ï¼‰é€‰æ‹©å‚æ•°çš„åˆå€¼ \\(\\theta^{(0)}\\), å¼€å§‹è¿­ä»£; (2) \\(\\mathrm{E}\\) æ­¥: è®° \\(\\theta^{(i)}\\) ä¸ºç¬¬ \\(i\\) æ¬¡è¿­ä»£å‚æ•° \\(\\theta\\) çš„ä¼°è®¡å€¼, åœ¨ç¬¬ \\(i+1\\) æ¬¡è¿­ä»£çš„ \\(\\mathrm{E}\\) æ­¥, è®¡ç®— \\[ \\begin{aligned} Q\\left(\\theta, \\theta^{(i)}\\right) \u0026=E_Z\\left[\\log P(Y, Z \\mid \\theta) \\mid Y, \\theta^{(i)}\\right] \\\\\\\\ \u0026=\\sum_Z \\log P(Y, Z \\mid \\theta) P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\end{aligned} \\] è¿™é‡Œ, \\(P\\left(Z \\mid Y, \\theta^{(i)}\\right)\\) æ˜¯åœ¨ç»™å®šè§‚æµ‹æ•°æ® \\(Y\\) å’Œå½“å‰çš„å‚æ•°ä¼°è®¡ \\(\\theta^{(i)}\\) ä¸‹éšå˜é‡æ•°æ® \\(Z\\) çš„æ¡ ä»¶æ¦‚ç‡åˆ†å¸ƒ; (3) \\(\\mathrm{M}\\) æ­¥ï¼šæ±‚ä½¿ \\(Q\\left(\\theta, \\theta^{(i)}\\right)\\) æå¤§åŒ–çš„ \\(\\theta\\), ç¡®å®šç¬¬ \\(i+1\\) æ¬¡è¿­ä»£çš„å‚æ•°çš„ä¼°è®¡å€¼ \\(\\theta^{(i+1)}\\) \\[ \\theta^{(i+1)}=\\arg \\max_\\theta Q\\left(\\theta, \\theta^{(i)}\\right) \\] é‡å¤ç¬¬ (2) æ­¥å’Œç¬¬ (3) æ­¥, ç›´åˆ°æ”¶æ•›ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:3:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"Qå‡½æ•° å‡½æ•° \\(Q\\left(\\theta, \\theta^{(i)}\\right)\\) æ˜¯ EMç®—æ³•çš„æ ¸å¿ƒ, ç§°ä¸º \\(Q\\) å‡½æ•° ( \\(Q\\) function)ã€‚ \\({Q}\\) å‡½æ•° : å®Œå…¨æ•°æ® çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•° \\(\\log P(Y, Z \\mid \\theta)\\) å…³äºåœ¨ç»™å®šè§‚æµ‹æ•° æ® \\(Y\\) å’Œå½“å‰å‚æ•° \\(\\theta^{(i)}\\) ä¸‹å¯¹æœªè§‚æµ‹æ•°æ® \\(Z\\) çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P\\left(Z \\mid Y, \\theta^{(i)}\\right)\\) çš„æœŸæœ›ç§°ä¸º \\(Q\\) å‡½æ•°, å³ \\[ Q\\left(\\theta, \\theta^{(i)}\\right)=E_Z\\left[\\log P(Y, Z \\mid \\theta) \\mid Y, \\theta^{(i)}\\right] = \\sum_Z \\log P(Y,Z\\mid \\theta) P\\left (Z\\mid Y, \\theta^{(i)}\\right) \\] ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:4:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"Jensenä¸ç­‰å¼ å¦‚æœfæ˜¯å‡¸å‡½æ•°ï¼ŒXæ˜¯éšæœºå˜é‡ï¼Œé‚£ä¹ˆæœ‰ \\[ E[f(X)] \\geq f[E(X)] \\] å¦‚æœfæ˜¯å‡¹å‡½æ•°åˆ™ç›¸å è¿™ä¸ªå›¾å¯ä»¥æ¯”è¾ƒæ¸…æ™°çš„çœ‹å‡ºè¿™ä¸ªç»“è®ºã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:5:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"EMç®—æ³•çš„å¯¼å‡º ä¸ºä»€ä¹ˆ EMç®—æ³•èƒ½è¿‘ä¼¼å®ç°å¯¹è§‚æµ‹æ•°æ®çš„æå¤§ä¼¼ç„¶ä¼°è®¡ å‘¢? ä¸‹é¢é€šè¿‡è¿‘ä¼¼æ±‚è§£è§‚æµ‹æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æå¤§åŒ–é—®é¢˜æ¥å¯¼å‡º EMç®—æ³•, ç”±æ­¤ å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡º EMç®—æ³•çš„ä½œç”¨ã€‚ æˆ‘ä»¬é¢å¯¹ä¸€ä¸ªå«æœ‰éšå˜é‡çš„æ¦‚ç‡æ¨¡å‹, ç›®æ ‡æ˜¯æå¤§åŒ–è§‚æµ‹æ•°æ® (ä¸å®Œå…¨æ•°æ®) \\(Y\\) å…³äºå‚æ•° \\(\\theta\\) çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°, å³æå¤§åŒ– \\[ \\begin{aligned} L(\\theta) \u0026=\\log P(Y \\mid \\theta)=\\log \\sum_Z P(Y, Z \\mid \\theta) \\\\\\\\ \u0026=\\log \\left(\\sum_Z P(Y \\mid Z, \\theta) P(Z \\mid \\theta)\\right) \\end{aligned} \\] æ³¨æ„åˆ°è¿™ä¸€æå¤§åŒ–çš„ä¸»è¦å›°éš¾æ˜¯å¼ä¸­æœ‰æœ«è§‚æµ‹æ•°æ®å¹¶æœ‰åŒ…å«å’Œ (æˆ–ç§¯åˆ†) çš„ å¯¹æ•°ã€‚ äº‹å®ä¸Š, EMç®—æ³•æ˜¯é€šè¿‡è¿­ä»£é€æ­¥è¿‘ä¼¼æå¤§åŒ– \\(L(\\theta)\\) çš„ã€‚å‡è®¾åœ¨ç¬¬ \\(i\\) æ¬¡è¿­ä»£å \\(\\theta\\) çš„ ä¼°è®¡å€¼æ˜¯ \\(\\theta^{(i)}\\) ã€‚æˆ‘ä»¬å¸Œæœ›æ–°ä¼°è®¡å€¼ \\(\\theta\\) èƒ½ä½¿ \\(L(\\theta)\\) å¢åŠ , å³ \\(L(\\theta)\u003eL\\left(\\theta^{(i)}\\right)\\), å¹¶é€æ­¥è¾¾åˆ°æ å¤§å€¼ã€‚ä¸ºæ­¤, è€ƒè™‘ä¸¤è€…çš„å·®: \\[ L(\\theta)-L\\left(\\theta^{(i)}\\right)=\\log \\left(\\sum_Z P(Y \\mid Z, \\theta) P(Z \\mid \\theta)\\right)-\\log P\\left(Y \\mid \\theta^{(i)}\\right) \\] åˆ©ç”¨ Jensen ä¸ç­‰å¼ (Jensen inequality)å¾—åˆ°å…¶ä¸‹ç•Œï¼Œè¿™é‡Œçš„få³ä¸ºlogå‡½æ•°ï¼Œæ˜¯å‡¹å‡½æ•°ï¼Œåˆ™ç»“è®ºä¸å‡¸å‡½æ•°æ—¶çš„ç»“è®ºæ˜¯ç›¸åçš„ã€‚: \\[ \\begin{aligned} L(\\theta)-L\\left(\\theta^{(i)}\\right) \u0026=\\log \\left(\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\frac{P(Y \\mid Z, \\theta) P(Z \\mid \\theta)}{P\\left(Z \\mid Y, \\theta^{(i)}\\right)}\\right)-\\log P\\left(Y \\mid \\theta^{(i)}\\right) \\\\\\\\ \u0026 \\geqslant \\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log \\frac{P(Y \\mid Z, \\theta) P(Z \\mid \\theta)}{P\\left(Z \\mid Y, \\theta^{(i)}\\right)}-\\log P\\left(Y \\mid \\theta^{(i)}\\right) \\\\\\\\ \u0026=\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log \\frac{P(Y \\mid Z, \\theta) P(Z \\mid \\theta)}{P\\left(Z \\mid Y, \\theta^{(i)}\\right) P\\left(Y \\mid \\theta^{(i)}\\right)} \\end{aligned} \\] ä»¤ \\[ B\\left(\\theta, \\theta^{(i)}\\right) \\hat{=} L\\left(\\theta^{(i)}\\right)+\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log \\frac{P(Y \\mid Z, \\theta) P(Z \\mid \\theta)}{P\\left(Z \\mid Y, \\theta^{(i)}\\right) P\\left(Y \\mid \\theta^{(i)}\\right)} \\] åˆ™è¦æ±‚ï¼š \\[ L(\\theta) \\geqslant B\\left(\\theta, \\theta^{(i)}\\right) \\] å³å‡½æ•° \\(B\\left(\\theta, \\theta^{(i)}\\right)\\) æ˜¯ \\(L(\\theta)\\) çš„ä¸€ä¸ªä¸‹ç•Œ, å¯çŸ¥, \\[ L\\left(\\theta^{(i)}\\right)=B\\left(\\theta^{(i)}, \\theta^{(i)}\\right) \\] å› æ­¤, ä»»ä½•å¯ä»¥ä½¿ \\(B\\left(\\theta, \\theta^{(i)}\\right)\\) å¢å¤§çš„ \\(\\theta\\), ä¹Ÿå¯ä»¥ä½¿ \\(L(\\theta)\\) å¢å¤§ã€‚è¿™é‡Œå›é¡¾ä¸€ä¸‹æˆ‘ä»¬æœ€åŸå§‹çš„ç›®æ ‡ï¼Œå°±æ˜¯ä¸ºäº†æœ€å¤§åŒ–\\(L(\\theta)\\)ï¼Œä¸ºäº†ä½¿ \\(L(\\theta)\\) æœ‰å°½å¯èƒ½å¤§ çš„å¢é•¿, é€‰æ‹© \\(\\theta^{(i+1)}\\) ä½¿ \\(B\\left(\\theta, \\theta^{(i)}\\right)\\) è¾¾åˆ°æå¤§, å³ \\[ \\theta^{(i+1)}=\\arg \\max_\\theta B\\left(\\theta, \\theta^{(i)}\\right) \\] ç°åœ¨æ±‚ \\(\\theta^{(i+1)}\\) çš„è¡¨è¾¾å¼ã€‚çœå»å¯¹ \\(\\theta\\) çš„æå¤§åŒ–è€Œè¨€æ˜¯å¸¸æ•°çš„é¡¹ \\[ \\begin{aligned} \\theta^{(i+1)} \u0026=\\arg \\max_\\theta\\left(L\\left(\\theta^{(i)}\\right)+\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log \\frac{P(Y \\mid Z, \\theta) P(Z \\mid \\theta)}{P\\left(Z \\mid Y, \\theta^{(i)}\\right) P\\left(Y \\mid \\theta^{(i)}\\right)}\\right) \\\\\\\\ \u0026=\\arg \\max_\\theta\\left(\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log (P(Y \\mid Z, \\theta) P(Z \\mid \\theta))\\right) \\\\\\\\ \u0026=\\arg \\max_\\theta\\left(\\sum_Z P\\left(Z \\mid Y, \\theta^{(i)}\\right) \\log P(Y, Z \\mid \\theta)\\right) \\\\\\\\ \u0026=\\arg \\max_\\theta Q\\left(\\theta, \\theta^{(i)}\\right) \\end{aligned} \\] è¿™ç­‰ä»·äº EMç®—æ³•çš„ä¸€æ¬¡è¿­ä»£, å³æ±‚ \\(Q\\) å‡½æ•°åŠå…¶æå¤§åŒ–ã€‚EMç®—æ³•æ˜¯é€šè¿‡ ä¸æ–­æ±‚è§£ä¸‹ç•Œçš„æå¤§åŒ–é€¼è¿‘æ±‚è§£å¯¹æ•°ä¼¼ç„¶å‡½æ•°æå¤§åŒ–çš„ç®—æ³•ã€‚ ä¸‹å›¾ç»™å‡º EMç®—æ³•çš„ç›´è§‚è§£é‡Šã€‚æ³¨æ„ä¸¤ä¸ªæ›²çº¿çš„äº¤ç‚¹å°±æ˜¯åœ¨\\(\\theta^{(i)}\\) è¿™é‡Œå…¶å®å°±æ˜¯ç›¸å½“äºæ¨å¯¼ä¸ºä»€ä¹ˆæœ€å¤§åŒ–Qå‡½æ•°å¯¹åº”çš„å‚æ•°å°±æ˜¯å½“å‰è¿­ä»£çš„æœ€ä½³å‚æ•°ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:6:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"é«˜æ–¯æ··åˆæ¨¡å‹ é«˜æ–¯æ··åˆæ¨¡å‹æ˜¯æŒ‡æœ‰å¦‚ä¸‹å½¢å¼çš„æ¦‚ç‡åˆ†å¸ƒæ¨¡å‹ï¼š \\[ P(y\\mid \\theta ) = \\sum_{k=1}^K\\alpha_k \\Phi(y\\mid \\theta_k) \\] å…¶ä¸­\\(\\alpha_k\\)ä¸ºç³»æ•°ï¼Œ\\(\\alpha_k \\geq 0, \\sum_{k=1}^K\\alpha_k=1\\); \\(\\Phi(y\\mid \\theta_k)\\)ä¸ºé«˜æ–¯å¯†åº¦å‡½æ•°ï¼Œ\\(\\theta_k=(\\mu_k,\\sigma_k^2)\\) \\[ \\Phi(y\\mid \\theta_k) = \\frac{1}{\\sqrt{2\\pi}\\sigma_k}\\exp \\left(-\\frac{(y-\\mu_k)^2}{2\\sigma_k^2} \\right) \\] ä¸ºç¬¬kä¸ªæ¨¡å‹ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:7:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"EMç®—æ³•çš„åº”ç”¨ æ˜ç¡®éšå˜é‡, å†™å‡ºå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•° å¯ä»¥è®¾æƒ³è§‚æµ‹æ•°æ® \\(y_j, j=1,2, \\cdots, N\\), æ˜¯è¿™æ ·äº§ç”Ÿçš„: é¦–å…ˆä¾æ¦‚ç‡ \\(\\alpha_k\\) é€‰æ‹©ç¬¬ \\(k\\) ä¸ªé«˜æ–¯åˆ†å¸ƒåˆ†æ¨¡å‹ \\(\\phi\\left(y \\mid \\theta_k\\right)\\), ç„¶åä¾ç¬¬ \\(k\\) ä¸ªåˆ†æ¨¡å‹çš„æ¦‚ç‡åˆ†å¸ƒ \\(\\phi\\left(y \\mid \\theta_k\\right)\\) ç”Ÿæˆè§‚æµ‹æ•°æ® \\(y_j\\) ã€‚è¿™æ—¶è§‚æµ‹æ•°æ® \\(y_j, j=1,2, \\cdots, N\\), æ˜¯å·²çŸ¥çš„; åæ˜ è§‚æµ‹æ•°æ® \\(y_j\\) æ¥è‡ªç¬¬ \\(k\\) ä¸ªåˆ†æ¨¡ å‹çš„æ•°æ®æ˜¯æœ«çŸ¥çš„, \\(k=1,2, \\cdots, K\\), ä»¥éšå˜é‡ \\(\\gamma_{j k}\\) è¡¨ç¤º, å…¶å®šä¹‰å¦‚ä¸‹: \\[ \\gamma_{j k}= \\begin{cases}1, \u0026 \\text { ç¬¬ } j \\text { ä¸ªè§‚æµ‹æ¥è‡ªç¬¬ } k \\text { ä¸ªåˆ†æ¨¡å‹ } \\\\\\\\ 0, \u0026 \\text { å¦åˆ™ }\\end{cases} \\] \\[ j=1,2, \\cdots, N ; \\quad k=1,2, \\cdots, K \\] \\(\\gamma_{j k}\\) æ˜¯ 0-1 éšæœºå˜é‡ã€‚ æœ‰äº†è§‚æµ‹æ•°æ® \\(y_j\\) åŠæœ«è§‚æµ‹æ•°æ® \\(\\gamma_{j k}\\), é‚£ä¹ˆå®Œå…¨æ•°æ®æ˜¯ \\[ \\left(y_j, \\gamma_{j 1}, \\gamma_{j 2}, \\cdots, \\gamma_{j K}\\right), \\quad j=1,2, \\cdots, N \\] äºæ˜¯, å¯ä»¥å†™å‡ºå®Œå…¨æ•°æ®çš„ä¼¼ç„¶å‡½æ•°: \\[ \\begin{aligned} P(y, \\gamma \\mid \\theta) \u0026=\\prod_{j=1}^N P\\left(y_j, \\gamma_{j 1}, \\gamma_{j 2}, \\cdots, \\gamma_{j K} \\mid \\theta\\right) \\\\\\\\ \u0026=\\prod_{k=1}^K \\prod_{j=1}^N\\left[\\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)\\right]^{\\gamma_{j k}} \\\\\\\\ \u0026=\\prod_{k=1}^K \\alpha_k^{n_k} \\prod_{j=1}^N\\left[\\phi\\left(y_j \\mid \\theta_k\\right)\\right]^{\\gamma_{j k}} \\\\\\\\ \u0026=\\prod_{k=1}^K \\alpha_k^{n_k} \\prod_{j=1}^N\\left[\\frac{1}{\\sqrt{2 \\pi} \\sigma_k} \\exp \\left(-\\frac{\\left(y_j-\\mu_k\\right)^2}{2 \\sigma_k^2}\\right)\\right]^{\\gamma_{j k}} \\end{aligned} \\] å¼ä¸­, \\(n_k=\\sum_{j=1}^N \\gamma_{j k}, \\sum_{k=1}^K n_k=N\\) ã€‚ é‚£ä¹ˆ, å®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸º \\[ \\log P(y, \\gamma \\mid \\theta)=\\sum_{k=1}^K\\left\\\\{n_k \\log \\alpha_k+\\sum_{j=1}^N \\gamma_{j k}\\left[\\log \\left(\\frac{1}{\\sqrt{2 \\pi}}\\right)-\\log \\sigma_k-\\frac{1}{2 \\sigma_k^2}\\left(y_j-\\mu_k\\right)^2\\right]\\right\\} \\] EM ç®—æ³•çš„ \\(\\mathrm{E}\\) æ­¥: ç¡®å®š \\(Q\\) å‡½æ•° \\[ \\begin{aligned} Q\\left(\\theta, \\theta^{(i)}\\right) \u0026=E\\left[\\log P(y, \\gamma \\mid \\theta) \\mid y, \\theta^{(i)}\\right] \\\\\\\\ \u0026=E\\left{\\sum_{k=1}^K\\left{n_k \\log \\alpha_k+\\sum_{j=1}^N \\gamma_{j k}\\left[\\log \\left(\\frac{1}{\\sqrt{2 \\pi}}\\right)-\\log \\sigma_k-\\frac{1}{2 \\sigma_k^2}\\left(y_j-\\mu_k\\right)^2\\right]\\right}\\right} \\\\\\\\ \u0026=\\sum_{k=1}^K\\left\\\\{\\sum_{j=1}^N\\left(E \\gamma_{j k}\\right) \\log \\alpha_k+\\sum_{j=1}^N\\left(E \\gamma_{j k}\\right)\\left[\\log \\left(\\frac{1}{\\sqrt{2 \\pi}}\\right)-\\log \\sigma_k-\\frac{1}{2 \\sigma_k^2}\\left(y_j-\\mu_k\\right)^2\\right]\\right} \\end{aligned} \\] è¿™é‡Œéœ€è¦è®¡ç®— \\(E\\left(\\gamma_{j k} \\mid y, \\theta\\right)\\), è®°ä¸º \\(\\hat{\\gamma}_{j k}\\) ã€‚ \\[ \\begin{aligned} \\hat{\\gamma}_{j k} \u0026=E\\left(\\gamma_{j k} \\mid y, \\theta\\right)=P\\left(\\gamma_{j k}=1 \\mid y, \\theta\\right) \\\\\\\\ \u0026=\\frac{P\\left(\\gamma_{j k}=1, y_j \\mid \\theta\\right)}{\\sum_{k=1}^K P\\left(\\gamma_{j k}=1, y_j \\mid \\theta\\right)} \\\\\\\\ \u0026=\\frac{P\\left(y_j \\mid \\gamma_{j k}=1, \\theta\\right) P\\left(\\gamma_{j k}=1 \\mid \\theta\\right)}{\\sum_{k=1}^K P\\left(y_j \\mid \\gamma_{j k}=1, \\theta\\right) P\\left(\\gamma_{j k}=1 \\mid \\theta\\right)} \\\\\\\\ \u0026=\\frac{\\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}{\\sum_{k=1}^K \\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}, \\quad j=1,2, \\cdots, N ; \\quad k=1,2, \\cdots, K \\end{aligned} \\] \\(\\hat{\\gamma}_{j k}\\) æ˜¯åœ¨å½“å‰æ¨¡å‹å‚æ•°ä¸‹ç¬¬ \\(j\\) ä¸ªè§‚æµ‹æ•°æ®æ¥è‡ªç¬¬ \\(k\\) ä¸ªåˆ†æ¨¡å‹çš„æ¦‚ç‡, ç§°ä¸ºåˆ†æ¨¡å‹ \\(k\\) å¯¹ è§‚æµ‹æ•°æ® \\(y_j\\) çš„å“åº”åº¦ã€‚ å°† \\(\\hat{\\gamma}_{j k}=E \\gamma_{j k}\\) åŠ \\(n_k=\\sum_{j=1}^N E \\gamma_{j k}\\) ä»£å…¥, å³å¾— \\[ Q\\left(\\theta, \\theta^{(i)}\\right)=\\sum_{k=1}^K\\left\\\\{n_k \\log \\alpha_k+\\sum_{j=1}^N \\hat{\\gamma}_{j k}\\left[\\log \\left(\\frac{1}{\\sqrt{2 \\pi}}\\right)-\\log \\sigma_k-\\frac{1}{2 \\sigma_k^2}\\left(y_j-\\mu_k\\right)^2\\right]\\right\\\\\\} \\] ç¡®å®š EM ç®—æ³•çš„ \\(M\\) æ­¥ è¿­ä»£çš„ \\(\\mathrm{M}\\) æ­¥æ˜¯æ±‚å‡½æ•° \\(Q\\left(\\theta, \\theta^{(i)}\\right)\\) å¯¹ \\(\\theta\\) çš„æå¤§å€¼, å³æ±‚æ–°ä¸€è½®è¿­ä»£çš„æ¨¡å‹å‚æ•°: \\[ \\theta^{(i+1)}=\\arg \\max_\\theta Q\\left(\\theta, \\theta^{(i)}\\right) \\] ç”¨ \\(\\hat{\\mu}_k, \\hat{\\sigma}_k^2\\) åŠ \\(\\hat{\\alpha}_k, k=1,2, \\cdots, K\\), è¡¨ç¤º \\(\\theta^{(i+1)}\\) çš„å„å‚æ•°ã€‚æ±‚ \\(\\hat{\\mu}_k, \\hat{\\sigma}_k^2\\) åªéœ€åˆ†åˆ«å¯¹ \\(\\mu_k, \\sigma_k^2\\) æ±‚åå¯¼æ•°å¹¶ä»¤å…¶ä¸º 0 , å³å¯å¾—åˆ°; æ±‚ \\(\\hat{\\alpha}_k\\) æ˜¯åœ¨ \\(\\sum_{k=1}^K \\alpha_k=1\\) æ¡ä»¶ ä¸‹æ±‚åå¯¼æ•°å¹¶ä»¤å…¶ä¸º 0 å¾—åˆ°çš„ã€‚ç»“æœå¦‚ä¸‹: \\[ \\begin{gathered} \\hat{\\mu}_k=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k} y_j}{\\sum_{j=1}^N \\hat{\\gamma}_{j k}}, \\quad k=1,2, \\cdots, K \\\\\\\\ \\hat{\\sigma}_k^2=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k}\\left(y_j-\\mu_k\\right)^2}{\\sum_{j=1}^N \\ha","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:7:1","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"ç®—æ³•åº”ç”¨æ€»ç»“ (é«˜æ–¯æ··åˆæ¨¡å‹å‚æ•°ä¼°è®¡çš„EMç®—æ³•) è¾“å…¥: è§‚æµ‹æ•°æ® \\(y_1, y_2, \\cdots, y_N\\), é«˜æ–¯æ··åˆæ¨¡å‹; è¾“å‡ºï¼šé«˜æ–¯æ··åˆæ¨¡å‹å‚æ•°ã€‚ ï¼ˆ1ï¼‰å–å‚æ•°çš„åˆå§‹å€¼å¼€å§‹è¿­ä»£; (2) \\(\\mathrm{E}\\) æ­¥: ä¾æ®å½“å‰æ¨¡å‹å‚æ•°, è®¡ç®—åˆ†æ¨¡å‹ \\(k\\) å¯¹è§‚æµ‹æ•°æ® \\(y_j\\) çš„å“åº”åº¦ \\[ \\hat{\\gamma}_{j k}=\\frac{\\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}{\\sum_{k=1}^K \\alpha_k \\phi\\left(y_j \\mid \\theta_k\\right)}, \\quad j=1,2, \\cdots, N ; \\quad k=1,2, \\cdots, K \\] \\(\\mathrm{M}\\) æ­¥ï¼šè®¡ç®—æ–°ä¸€è½®è¿­ä»£çš„æ¨¡å‹å‚æ•° \\[ \\hat{\\mu}_k=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{j k} y_j}{\\sum_{j=1}^N \\hat{\\gamma}_{j k}}, \\quad k=1,2, \\cdots, K \\] \\[ \\hat{\\sigma}_k^2=\\frac{\\sum_{j=1}^N \\hat{\\gamma}_{jk}(y_j-\\mu_k)^2}{\\sum_{j=1}^N \\hat{\\gamma}_{jk}}, \\quad k= 1,2,\\dots, K \\] \\[ \\hat{\\alpha}_k = \\frac{\\sum_{j=1}^N \\hat{\\gamma}_{jk}}{N} ,\\quad k=1,2,\\dots, K \\] é‡å¤ç›´åˆ°æ”¶æ•›ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:7:2","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning"],"content":"æ€»ç»“ æ€»ä¹‹æ¥è¯´emç®—æ³•ä½œä¸ºæ•°æ®æŒ–æ˜åå¤§ç®—æ³•ä¹‹ä¸€ï¼Œåº”ç”¨èŒƒå›´ååˆ†å¹¿æ³›ï¼Œå®ƒä¸èƒ½çœ‹ä½œæ˜¯ä¸€ä¸ªå…·ä½“çš„æ¨¡å‹ï¼Œå¸¸å¸¸ç”¨äºæ¨¡å‹çš„æ±‚è§£ï¼Œæ¯”å¦‚HMMçš„å­¦ä¹ å‚æ•°é—®é¢˜ç­‰ç­‰ï¼Œæ˜¯å¿…é¡»è¦å­¦ä¼šçš„ç®—æ³•ä¹‹ä¸€ã€‚ ","date":"2022-10-03","objectID":"/em%E7%AE%97%E6%B3%95/:8:0","tags":["Machine Learning","EMç®—æ³•"],"title":"EMç®—æ³•","uri":"/em%E7%AE%97%E6%B3%95/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆ†å‘é¥¼å¹² https://leetcode-cn.com/problems/assign-cookies/ class Solution: def findContentChildren(g, s) -\u003e int: g = sorted(g) s = sorted(s) n = 0 for i in range(len(s)): if g[n] \u003c= s[i]: n += 1 if n == len(g): return n return n è´ªå¿ƒç®—æ³•çš„é¢˜ç›®ï¼Œè€ƒè™‘å±€éƒ¨æœ€ä¼˜ ","date":"2022-10-03","objectID":"/%E5%88%86%E5%8F%91%E9%A5%BC%E5%B9%B2/:0:0","tags":["ç®—æ³•é¢˜","åˆ†å‘é¥¼å¹²"],"title":"åˆ†å‘é¥¼å¹²","uri":"/%E5%88%86%E5%8F%91%E9%A5%BC%E5%B9%B2/"},{"categories":["å·¥å…·"],"content":"æ­£åˆ™è¡¨è¾¾å¼ [abcd]åŒ¹é…ä¸­æ‹¬å·é‡Œçš„æ‰€æœ‰å­—ç¬¦ [^abcd]åŒ¹é…é™¤äº†æ‹¬å·é‡Œçš„æ‰€æœ‰å­—ç¬¦ [A-Za-z]åŒ¹é…æ‰€æœ‰å­—æ¯ [\\s\\S]æ˜¯åŒ¹é…æ‰€æœ‰ç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œï¼Œéç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œ [\\w] åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº [A-Za-z0-9_] åŒ¹é…æœ‰ç‰¹æ®Šå«ä¹‰çš„ï¼Œæ¯”å¦‚* ^ ç­‰ è®°å¾—è¦åŠ ä¸Šåæ–œæ è¿›è¡Œè½¬ä¹‰ ï¼ŸåŒ¹é…å‰é¢çš„è¡¨è¾¾å¼0æ¬¡æˆ–1æ¬¡ **.åŒ¹é…é™¤* +åŒ¹é…å‰é¢çš„è¡¨è¾¾å¼1æ¬¡æˆ–å¤šæ¬¡ *åŒ¹é…å‰é¢çš„è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ {n}åŒ¹é…næ¬¡ï¼Œ{n,m}æœ€å°‘åŒ¹é…næ¬¡ï¼Œæœ€å¤šmæ¬¡ï¼Œ{n,}è‡³å°‘åŒ¹é…næ¬¡ å®šä½ç¬¦ï¼š^ $ å³é™å®šåœ¨å“ªé‡ŒåŒ¹é… ï¼ˆï¼‰çµæ´»åº”ç”¨ [.]ç­‰ä»·äº\\. ","date":"2022-09-28","objectID":"/regex/:0:0","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["å·¥å…·"],"content":"è¿ç®—ä¼˜å…ˆçº§ image.png ","date":"2022-09-28","objectID":"/regex/:1:0","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["å·¥å…·"],"content":"é›¶å®½åº¦æ–­è¨€ï¼ˆå‰åé¢„æŸ¥ï¼‰ ","date":"2022-09-28","objectID":"/regex/:2:0","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["å·¥å…·"],"content":"?=â€¦æ­£å…ˆè¡Œæ–­è¨€ ?=...è¡¨ç¤ºæ­£å…ˆè¡Œæ–­è¨€ï¼Œè¡¨ç¤ºç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼ä¹‹åå¿…é¡»è·Ÿç€?=...å®šä¹‰çš„è¡¨è¾¾å¼ã€‚ è¿”å›ç»“æœåªåŒ…å«æ»¡è¶³åŒ¹é…æ¡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†è¡¨è¾¾å¼ã€‚ å®šä¹‰ä¸€ä¸ªæ­£å…ˆè¡Œæ–­è¨€è¦ä½¿ç”¨Â ()ã€‚åœ¨æ‹¬å·å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªé—®å·å’Œç­‰å·ï¼šÂ (?=...)ã€‚ æ­£å…ˆè¡Œæ–­è¨€çš„å†…å®¹å†™åœ¨æ‹¬å·ä¸­çš„ç­‰å·åé¢ã€‚ ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼Â (T|t)he(?=\\sfat)Â åŒ¹é…Â TheÂ å’ŒÂ theï¼Œåœ¨æ‹¬å·ä¸­æˆ‘ä»¬åˆå®šä¹‰äº†æ­£å…ˆè¡Œæ–­è¨€Â (?=\\sfat)Â ï¼Œå³Â TheÂ å’ŒÂ theÂ åé¢ç´§è·Ÿç€Â (ç©ºæ ¼)fatã€‚ ","date":"2022-09-28","objectID":"/regex/:2:1","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["å·¥å…·"],"content":"?!â€¦ è´Ÿå…ˆè¡Œæ–­è¨€ è´Ÿå…ˆè¡Œæ–­è¨€Â ?!Â ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶åä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚Â æ­£å…ˆè¡Œæ–­è¨€Â å®šä¹‰å’ŒÂ è´Ÿå…ˆè¡Œæ–­è¨€Â æ­£å¥½ç›¸åã€‚ è¡¨è¾¾å¼Â (T|t)he(?!\\sfat)Â åŒ¹é…Â TheÂ å’ŒÂ theï¼Œä¸”å…¶åä¸è·Ÿç€Â (ç©ºæ ¼)fatã€‚ ### ?\u003c=â€¦ æ­£åå‘æ–­è¨€ æ­£åå‘æ–­è¨€ è®°ä½œ(?\u003c=...)Â ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶å‰è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚ ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼Â (?\u003c=(T|t)he\\s)(fat|mat)Â åŒ¹é…Â fatÂ å’ŒÂ matï¼Œä¸”å…¶å‰è·Ÿç€Â TheÂ æˆ–Â theã€‚ ### ?\u003c!â€¦ è´Ÿåå‘æ–­è¨€ è´Ÿåå‘æ–­è¨€ è®°ä½œÂ (?\u003c!...)Â ç”¨äºç­›é€‰æ‰€æœ‰åŒ¹é…ç»“æœï¼Œç­›é€‰æ¡ä»¶ä¸º å…¶å‰ä¸è·Ÿéšç€æ–­è¨€ä¸­å®šä¹‰çš„æ ¼å¼ã€‚ ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼Â (?\u003c!(T|t)he\\s)(cat)Â åŒ¹é…Â catï¼Œä¸”å…¶å‰ä¸è·Ÿç€Â TheÂ æˆ–Â theã€‚ æ­¤å¤–è¿˜æœ‰ä¸€ç§æ˜¯?:ï¼Œç”¨äºæ‹¬å·åŒ¹é…ä¸­ï¼Œå³non-capturing groupï¼Œ # å®æˆ˜ ","date":"2022-09-28","objectID":"/regex/:2:2","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["å·¥å…·"],"content":"Matching a decimal numbers æ¥æº:https://regexone.com/problem/matching_decimal_numbers æ„æ€å°±æ˜¯è¦åŒ¹é…Matchçš„è¿˜è¦é¿å¼€Skipçš„ å…·ä½“å®ç°ï¼š ^-?\\d+(,\\d+)*(\\.\\d+(e\\d+)?)?$ è§£é‡Šï¼š â€‹ å¼€å¤´åŒ¹é…è´Ÿå·ï¼Œå…¶å®è¿™é‡Œå¯ä»¥å˜æˆ[\\\\-\\\\+]? ä»¥é˜²å‡ºç°æ­£å· â€‹ ç„¶ååŒ¹é…å¸¦é€—å·çš„æ•°å­—ï¼ŒåŒ¹é…0æ¬¡æˆ–å¤šæ¬¡ â€‹ ç„¶ååŒ¹é…å¸¦å°æ•°ç‚¹çš„æ•°å­—ï¼ŒåŒ¹é…0æ¬¡æˆ–1æ¬¡ï¼Œå› ä¸ºå°æ•°ç‚¹æœ€å¤šå‡ºç°ä¸€æ¬¡ â€‹ æ˜¾ç„¶åé¢è·Ÿç€åŒ¹é…æŒ‡æ•°ï¼Œæ˜¾ç„¶æŒ‡æ•°ä¹Ÿæœ€å¤šå‡ºç°ä¸€æ¬¡ã€‚ ","date":"2022-09-28","objectID":"/regex/:3:0","tags":["å·¥å…·","regex"],"title":"regex","uri":"/regex/"},{"categories":["pandas"],"content":"pandaså®è·µ1 åœ¨è¯»å–æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä¿®æ”¹äº†è¡¨æ ¼é‡Œé¢çš„è¡¨å¤´ï¼Œä»¥ä¾¿ç¨‹åºçš„ç¼–å†™ã€‚ å…ˆä» excel è¯»å–æ•°æ®,ç„¶åçœ‹çœ‹ shape äº†è§£è¡Œæ•°åˆ—æ•°,ç„¶åè°ƒç”¨ info æ–¹æ³•ï¼Œ çœ‹çœ‹æœ‰æ²¡æœ‰ç¼ºå¤±å€¼ï¼Œå‘ç°å¹¶æ²¡æœ‰ç¼ºå¤±å€¼ï¼Œä½†é¢˜ç›®é‡Œè¯´äº†å¯èƒ½æœ‰é‡å¤æˆ–è€…æ ¼å¼ ä¸å¯¹çš„æ•°æ®ï¼Œå› ä¸ºæœ€ä¸»è¦çš„æ˜¯å­¦å·,ä¸€èˆ¬å­¦å·çš„é•¿åº¦éƒ½æ˜¯ 12 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥ç­› é€‰å‡ºä¸æ˜¯ 12 ä½æ•°çš„ data[data['studentid'].apply(lambda x:len(x)!=12)] è€ƒè™‘åˆ°å¯èƒ½å‡ºç°ä¸­æ–‡çš„æƒ…å†µï¼Œå…ˆå°è¯•è½¬åŒ–ä¸ºæ•´æ•°è¯•è¯• data[â€˜studentidâ€™] = data[â€˜studentidâ€™].astype(â€œint64â€) å‘ç°æŠ¥é”™äº†ï¼Œç„¶åå°±çœ‹è§äº†é‚£ä¸ªå­¦å·æ˜¯â€™å¿˜è®°äº†â€™çš„ æœ€åä¿®æ”¹æˆäº† data[data['studentid'].apply(lambda x:len(x)!=12 or x=='å¿˜è®°äº†')] å°†è¿™äº›æ•°æ®åˆ é™¤ data = data.drop(data[data['studentid'].apply(lambda x:len(x)!=12 or x=='å¿˜è®°äº†')].index) è€ƒè™‘åˆ°æœ‰é‡å¤ï¼Œé‡å¤çš„ä¸¤ä¸ªå› ç´ å°±æ˜¯å§“åå’Œå­¦å·ï¼Œå› æ­¤è¿›è¡Œå»é‡å¤„ç† data.drop_duplicates(subset=['name','studentid'],keep='first',inplace=Tru e) æ­¤å¤–ï¼Œå¯¹ä¸“ä¸šçš„å¤„ç†ï¼Œå°†æ— ç”¨çš„ xx-x å»æ‰å³å¯ï¼Œè¿™é‡Œè€ƒè™‘åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼ data['class'] = data['class'].apply(lambda s:re.sub(r\"[\\s*\\d*\\-*\\â€”*\\ ï¼ *\\â€“*\\/*]?\",'',s)) å› ä¸ºå„ç§å„æ ·çš„-è´Ÿå·åƒå¥‡ç™¾æ€ªï¼Œæˆ‘åªèƒ½ä¸€æ¬¡æ¬¡ä¿®æ”¹åç„¶åç»Ÿè®¡ä¸€ä¸‹å³è°ƒç”¨ data[â€˜classâ€™].value_counts() æœ‰æ²¡æœ‰æ²¡æœ‰å¤„ç†åˆ°çš„ï¼Œç„¶åæŠŠé‚£ä¸ª-ç¬¦å·åŠ è¿›å» è¿˜å‘ç°äº†æœ‰/å·ã€‚ æœ€åå°±æˆäº†é‚£æ ·ï¼Œå†™åˆ°è¿™é‡Œæˆ‘æœ‰äº†æ›´å¥½çš„æƒ³æ³•ï¼Œå’Œä¸‹é¢çš„ æŸä¸¤ä¸ªä¸ªä¾‹æœ‰å…³ç³»ã€‚ ç„¶åå°±æ˜¯é‚£ä¸ª maps è¡¨ï¼Œéƒ½ç®€åŒ–ä¸ºç®€ç§°ï¼Œå¯¹ç§°å‘¼è¿›è¡Œç»Ÿä¸€ï¼Œç”¨äº† apply æ–¹ æ³• å†ç»Ÿè®¡ä¸€ä¸‹ï¼Œå‘ç°äº†ä¸¤ä¸ªä¸“ä¸šåé¢å¸¦åå­—çš„å­¦é•¿å­¦å§ï¼Œå› ä¸ºå°±ä¸¤ä¸ªï¼Œå°±æŠŠä»– ä»¬åŠ åˆ° maps é‡Œé¢äº†ï¼Œå…¶å®ä¹Ÿå¯ä»¥åˆ¤æ–­åå­—æ˜¯å¦åœ¨ä¸“ä¸šé‡Œé¢ï¼Œå¦‚æœåœ¨å°±æ›¿æ¢ ä¸ºç©ºå§ã€‚ ä¹‹åå°±å·®ä¸å¤šå¯ä»¥äº†ï¼Œæ•°æ®é¢„å¤„ç†å®Œæ¯•ï¼ŒæŒ‰ç…§è¦æ±‚ä¿å­˜å³å¯ã€‚ #æ•°æ®é¢„å¤„ç†æ–‡ä»¶ import pandas as pd import re data = pd.read_excel(\"é™„ä»¶1.xlsx\") #å»é™¤é”™è¯¯æ•°æ® data = data.drop(data[data['studentid'].apply(lambda x:len(x)!=12 or x=='å¿˜è®°äº†')].index) #å»é‡ data.drop_duplicates(subset=['name','studentid'], keep='first', inplace=True) data['class'] = data['class'].apply(lambda s:re.sub(r\"[\\s*\\d*\\-*\\â€”*\\ï¼*\\â€“*\\/*]?\", '', s)) maps = { 'æ™ºèƒ½ç§‘å­¦':'æ™ºç§‘', 'äº‘è®¡ç®—':'äº‘è®¡', 'åº”ç”¨ç»Ÿè®¡å­¦':'ç»Ÿè®¡', 'ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦':'ä¿¡è®¡', 'æ™ºèƒ½ç§‘å­¦ä¸æŠ€æœ¯':'æ™ºç§‘', 'åº”ç”¨ç»Ÿè®¡':'ç»Ÿè®¡', 'è½¯ä»¶å·¥ç¨‹':'è½¯å·¥', 'ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦ï¼ˆäº‘è®¡ç®—ï¼‰':'ä¿¡è®¡', 'å…‰ç”µä¿¡æ¯ä¸ç§‘å­¦':'å…‰ç”µ', 'ä¿¡è®¡ï¼ˆäº‘è®¡ç®—ï¼‰':'ä¿¡è®¡', 'å…‰ç”µä¿¡æ¯ç§‘å­¦ä¸å·¥ç¨‹':'å…‰ç”µ', 'æ•°æ®ç§‘å­¦':'å¤§æ•°æ®', 'æ™ºç§‘ç§‘å­¦':'æ™ºç§‘', 'ä¿¡è®¡å­¦é•¿':'ä¿¡è®¡', 'ä¿¡è®¡å­¦å§':'ä¿¡è®¡', 'ç»Ÿè®¡å­¦':'ç»Ÿè®¡', 'ä¿¡æ¯è®¡ç®—ä¸ç§‘å­¦':'ä¿¡è®¡', 'ä¿¡è®¡ä¸è®¡ç®—ç§‘å­¦':'ä¿¡è®¡' } def replaces(clas): if clas in maps.keys(): return maps[clas] else: return clas data['class'] = data['class'].apply(replaces) res = pd.DataFrame() res['è´¦å·'] = '21aidc' + data['studentid'] res['å§“å'] = data['name'] res['å¯†ç '] = res['è´¦å·'] res['ä¸“ä¸š'] = data['class'] res.to_excel(\"result.xlsx\", index=False,encoding='utf-8') ","date":"2022-09-20","objectID":"/aidc%E6%B5%8B%E8%AF%95/:0:0","tags":["pandas","task1"],"title":"aidcæµ‹è¯•","uri":"/aidc%E6%B5%8B%E8%AF%95/"},{"categories":["Deep Learning","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨"],"content":"moment(çŸ©) çŸ©åœ¨æ•°å­¦ä¸­çš„å®šä¹‰ï¼Œä¸€é˜¶çŸ©(first moment)å°±æ˜¯æ ·æœ¬çš„å‡å€¼(mean), äºŒé˜¶çŸ©å°±æ˜¯æ–¹å·®ï¼ˆvarianceï¼‰ã€‚ ## æ»‘åŠ¨å¹³å‡ æ»‘åŠ¨å¹³å‡(exponential moving average)ï¼Œæˆ–è€…å«åšæŒ‡æ•°åŠ æƒå¹³å‡(exponentially weighted moving average)ï¼Œå¯ä»¥ç”¨æ¥ä¼°è®¡å˜é‡çš„å±€éƒ¨å‡å€¼ï¼Œä½¿å¾—å˜é‡çš„æ›´æ–°ä¸ä¸€æ®µæ—¶é—´å†…çš„å†å²å–å€¼æœ‰å…³ã€‚åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä¸­ä¹Ÿå¸¸ç”¨ã€‚ å˜é‡ \\(v\\) åœ¨ \\(t\\) æ—¶åˆ»è®°ä¸º \\(v_{t} ï¼Œ\\text{å¯ä»¥ç†è§£ä¸º0åˆ°tæ—¶åˆ»çš„å¹³å‡å€¼} ã€‚\\quad \\theta_{t}\\) ä¸ºå˜é‡ \\(v\\) åœ¨ \\(t\\) æ—¶åˆ»çš„å–å€¼ï¼Œå³åœ¨ä¸ä½¿ç”¨æ»‘åŠ¨å¹³å‡æ¨¡å‹æ—¶ \\(v_{t}=\\theta_{t}\\) ï¼Œåœ¨ä½¿ç”¨æ»‘åŠ¨å¹³å‡æ¨¡å‹åï¼Œ \\(v_{t}\\) çš„æ›´æ–°å…¬å¼å¦‚ä¸‹: \\[ v_{t}=\\beta \\cdot v_{t-1}+(1-\\beta) \\cdot \\theta_{t} \\] ä¸Šå¼ä¸­ï¼Œ \\(\\beta \\in[0,1) ï¼Œ \\beta=0\\) ç›¸å½“äºæ²¡æœ‰ä½¿ç”¨æ»‘åŠ¨å¹³å‡ã€‚ è¿™ä¹Ÿæ˜¯RMSPropå’ŒAdamç­‰ç®—æ³•é‡Œä½¿ç”¨çš„æœ€é‡è¦çš„æ€æƒ³ã€‚é€šè¿‡æ»‘åŠ¨å¹³å‡æ¥é™ä½æ¢¯åº¦çš„æ³¢åŠ¨å€¼ã€‚ ## Adam ä¸‹é¢çœ‹æœ€ç»å…¸çš„ä¼ªä»£ç ï¼š adamç®—æ³•æ¯”èµ·adagradå’ŒRMSPropï¼Œä¸ä»…åŠ å…¥äº†ä¸€é˜¶å’ŒäºŒé˜¶momentçš„è®¡ç®—ã€‚è€Œä¸”åŠ å…¥äº†bias-correction termã€‚ä»¥ä¸‹å°†å±•å¼€åˆ†æï¼š ","date":"2022-09-11","objectID":"/adam/:1:0","tags":["Deep","Learning","ä¼˜åŒ–ç®—æ³•","Adamç®—æ³•","ä¼˜åŒ–å™¨"],"title":"Adamç®—æ³•","uri":"/adam/"},{"categories":["Deep Learning","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨"],"content":"adamçš„æ›´æ–°ç‡ï¼ˆstepsize) adamç®—æ³•ä¸­æœ€é‡è¦çš„å°±æ˜¯æ¯æ¬¡è¿­ä»£çš„è¿­ä»£ç‡ï¼ˆstep sizeï¼‰ï¼Œä»–å†³å®šäº†adamç®—æ³•çš„æ•ˆç‡ã€‚æ ¹æ®ä¸Š æ–‡çš„ç®—æ³•ï¼Œ step sizeç­‰äº: \\(\\Delta_{t}=\\alpha \\cdot \\widehat{m}_{t} / \\sqrt{\\hat{v}_{t}}\\) 1) å½“ \\(\\left(1-\\beta_{1}\\right)\u003e\\sqrt{1-\\beta_{2}}\\) çš„æ—¶å€™ï¼Œå®ƒçš„ä¸Šç•Œæ»¡è¶³ä¸ç­‰å¼: \\(\\left|\\Delta_{t}\\right| \\leq \\alpha \\cdot\\left(1-\\beta_{1}\\right) / \\sqrt{1-\\beta_{2}}\\) 2) å¦åˆ™ \\(\\left|\\Delta_{t}\\right| \\leq \\alpha\\) 1ï¼‰é€šå¸¸å‘ç”Ÿåœ¨æ•°æ®å¾ˆç¨€ç–çš„æ—¶å€™ã€‚å½“æ•°æ®å¯†é›†çš„æ—¶å€™ï¼Œ stepsizeä¼šæ›´å°ã€‚ 3) å½“ \\(\\left(1-\\beta_{1}\\right)=\\sqrt{1-\\beta_{2}}\\) çš„æ—¶å€™ï¼Œå› ä¸º \\(\\left|\\widehat{m}_{t} / \\sqrt{\\hat{v}_{t}}\\right|\u003c1\\) æ‰€ä»¥ï¼Œä¹Ÿæ»¡è¶³æ¡ä»¶ 2 çš„ \\(\\left|\\Delta_{t}\\right| \\leq \\alpha\\) æ€»ç»“ä»¥ä¸Š3ä¸ªæ¡ä»¶ï¼Œå¯ä»¥è¿‘ä¼¼å¾—å‡ºstepsize æ»¡è¶³ \\(\\left|\\Delta_{t}\\right| \\cong \\alpha\\) è¿™é‡Œçš„ \\(\\widehat{m}_{t} / \\sqrt{\\hat{v}_{t}}\\) é€šå¸¸ä¹Ÿæˆä¸ºä¿¡å™ªæ¯”ï¼ˆSignal-to-noise ratio SNR)ï¼Œå¹¶ä¸”æ»¡è¶³SNDè¶Šå°ï¼Œ stepsizeä¹Ÿè¶Šå°ã€‚ ","date":"2022-09-11","objectID":"/adam/:1:1","tags":["Deep","Learning","ä¼˜åŒ–ç®—æ³•","Adamç®—æ³•","ä¼˜åŒ–å™¨"],"title":"Adamç®—æ³•","uri":"/adam/"},{"categories":["Deep Learning","ä¼˜åŒ–ç®—æ³•","ä¼˜åŒ–å™¨"],"content":"åˆå§‹åŒ–åå·®çŸ«æ­£é¡¹ åŸç®—æ³•ä¸­çš„è¿™ä¸¤è¡Œ \\[ \\begin{aligned} \u0026\\widehat{m}_{t} \\leftarrow m_{t} /\\left(1-\\beta_{1}^{t}\\right) \\\\\\\\ \u0026\\hat{v}_{t} \\leftarrow v_{t} /\\left(1-\\beta_{2}^{t}\\right) \\end{aligned} \\] ç§°ä¸ºåå·®æ ¡æ­£é¡¹(bias-correction term),ä»–ä½¿ç”¨äº†æ»‘åŠ¨å¹³å‡å€¼(EMA: exponential moving average)çš„æ€æƒ³ï¼Œä¾‹å¦‚è®¡ç®—äºŒæ¬¡momentçš„ \\(v_{t}=\\beta_{2} \\cdot v_{t-1}+\\left(1-\\beta_{2}\\right) \\cdot g_{t}^{2}\\) å¯ä»¥å†™æˆå¦‚ä¸‹çš„å½¢ å¼ï¼š \\[ v_{t}=\\left(1-\\beta_{2}\\right) \\sum_{i=1}^{t} \\beta_{2}^{t-i} \\cdot g_{i}^{2} \\] æˆ‘ä»¬çš„ç›®çš„æ˜¯æ±‚å¾— \\(\\mathbb{E}\\left[v_{t}\\right]\\) (EMA) å’ŒäºŒé˜¶moment \\(\\mathbb{E}\\left[g_{t}^{2}\\right]\\) ä¹‹é—´çš„å…³ç³»ï¼Œæ¨å¯¼å¦‚ä¸‹: \\[ \\begin{aligned} \\mathbb{E}\\left[v_{t}\\right] \u0026=\\mathbb{E}\\left[\\left(1-\\beta_{2}\\right) \\sum_{i=1}^{t} \\beta_{2}^{t-i} \\cdot g_{i}^{2}\\right] \\\\\\\\ \u0026=\\mathbb{E}\\left[g_{t}^{2}\\right] \\cdot\\left(1-\\beta_{2}\\right) \\sum_{i=1}^{t} \\beta_{2}^{t-i}+\\zeta \\\\\\\\ \u0026=\\mathbb{E}\\left[g_{t}^{2}\\right] \\cdot\\left(1-\\beta_{2}^{t}\\right)+\\zeta \\end{aligned} \\] æœ€åå¾—å‡º \\(\\mathbb{E}\\left[g_{t}^{2}\\right]=\\frac{\\mathbb{E}\\left[v_{t}\\right]-\\zeta}{\\left(1-\\beta_{2}^{t}\\right)}\\) é€šå¸¸å¯ä»¥å¿½ç•¥å¸¸æ•° \\(\\zeta\\) ã€‚å¾—å‡º \\[ \\bar{v_t} = \\frac{v_t}{1-\\beta_2^t} \\] ç»¼ä¸Šæ‰€è¿°ï¼ŒAdam ä¼˜åŒ–å™¨å¯ä»¥æ ¹æ®å†å²æ¢¯åº¦çš„éœ‡è¡æƒ…å†µå’Œè¿‡æ»¤éœ‡è¡åçš„çœŸå®å†å²æ¢¯åº¦å¯¹å˜é‡è¿›è¡Œæ›´æ–° ","date":"2022-09-11","objectID":"/adam/:1:2","tags":["Deep","Learning","ä¼˜åŒ–ç®—æ³•","Adamç®—æ³•","ä¼˜åŒ–å™¨"],"title":"Adamç®—æ³•","uri":"/adam/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"ç²¾ç¡®ç‡å’Œå¬å›ç‡ ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:1:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"æ··æ·†çŸ©é˜µ True Positive(çœŸæ­£, TP)ï¼šå°†æ­£ç±»é¢„æµ‹ä¸ºæ­£ç±»æ•°. True Negative(çœŸè´Ÿ , TN)ï¼šå°†è´Ÿç±»é¢„æµ‹ä¸ºè´Ÿç±»æ•°. False Positive(å‡æ­£, FP)ï¼šå°†è´Ÿç±»é¢„æµ‹ä¸ºæ­£ç±»æ•° False Negative(å‡è´Ÿ , FN)ï¼šå°†æ­£ç±»é¢„æµ‹ä¸ºè´Ÿç±»æ•° ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:1:1","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"ç²¾ç¡®ç‡ \\[ P = \\frac{TP}{TP+FP} \\] ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:1:2","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"å‡†ç¡®ç‡ \\[ ACC = \\frac{TP+TN}{TP+TN+FP+FN} \\] ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:2:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"å¬å›ç‡ \\[ R = \\frac{TP}{TP+FN} \\] ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:3:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"F1 \\[ \\frac{2}{F_1} = \\frac{1}{P} + \\frac{1}{R} \\] ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:4:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"åŒºåˆ« ç²¾ç¡®ç‡ï¼ˆæŸ¥å‡†ç‡ï¼‰ï¼šåœ¨æ‰€æœ‰é¢„æµ‹ä¸ºæ­£çš„æ ·æœ¬ä¸­ï¼ˆåˆ†æ¯ï¼‰ï¼ŒçœŸæ­£ä¸ºæ­£çš„æœ‰å¤šå°‘ï¼ˆåˆ†å­ï¼‰ã€‚ å¬å›ç‡ï¼ˆæŸ¥å…¨ç‡ï¼‰ï¼šåœ¨æ‰€æœ‰å®é™…ä¸ºæ­£çš„æ ·æœ¬ä¸­ï¼ˆåˆ†æ¯ï¼‰ï¼ŒæˆåŠŸé¢„æµ‹å‡ºæ¥çš„æœ‰å¤šå°‘ï¼ˆåˆ†å­ï¼‰ img img ","date":"2022-08-21","objectID":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/:5:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ç²¾ç¡®ç‡å’Œå¬å›ç‡"],"title":"ç²¾ç¡®ç‡å’Œå¬å›ç‡","uri":"/%E7%B2%BE%E7%A1%AE%E7%8E%87%E5%92%8C%E5%8F%AC%E5%9B%9E%E7%8E%87/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å‚è€ƒï¼šhttps://cuijiahua.com/blog/2017/11/ml_2_decision_tree_1.html ã€Šæœºå™¨å­¦ä¹ ã€‹å‘¨å¿—å å†³ç­–æ ‘ å†³ç­–æ ‘æ˜¯ä»€ä¹ˆï¼Ÿå†³ç­–æ ‘(decision tree)æ˜¯ä¸€ç§åŸºæœ¬çš„åˆ†ç±»ä¸å›å½’æ–¹æ³•ã€‚ä¸¾ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æµç¨‹å›¾å°±æ˜¯ä¸€ä¸ªå†³ç­–æ ‘ï¼Œé•¿æ–¹å½¢ä»£è¡¨åˆ¤æ–­æ¨¡å—(decision block)ï¼Œæ¤­åœ†å½¢æˆä»£è¡¨ç»ˆæ­¢æ¨¡å—(terminating block)ï¼Œè¡¨ç¤ºå·²ç»å¾—å‡ºç»“è®ºï¼Œå¯ä»¥ç»ˆæ­¢è¿è¡Œã€‚ä»åˆ¤æ–­æ¨¡å—å¼•å‡ºçš„å·¦å³ç®­å¤´ç§°ä½œä¸ºåˆ†æ”¯(branch)ï¼Œå®ƒå¯ä»¥è¾¾åˆ°å¦ä¸€ä¸ªåˆ¤æ–­æ¨¡å—æˆ–è€…ç»ˆæ­¢æ¨¡å—ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·ç†è§£ï¼Œåˆ†ç±»å†³ç­–æ ‘æ¨¡å‹æ˜¯ä¸€ç§æè¿°å¯¹å®ä¾‹è¿›è¡Œåˆ†ç±»çš„æ ‘å½¢ç»“æ„ã€‚å†³ç­–æ ‘ç”±ç»“ç‚¹(node)å’Œæœ‰å‘è¾¹(directed edge)ç»„æˆã€‚ç»“ç‚¹æœ‰ä¸¤ç§ç±»å‹ï¼šå†…éƒ¨ç»“ç‚¹(internal node)å’Œå¶ç»“ç‚¹(leaf node)ã€‚å†…éƒ¨ç»“ç‚¹è¡¨ç¤ºä¸€ä¸ªç‰¹å¾æˆ–å±æ€§ï¼Œå¶ç»“ç‚¹è¡¨ç¤ºä¸€ä¸ªç±»ã€‚è’™åœˆæ²¡ï¼Ÿï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºçš„å†³ç­–æ ‘ï¼Œé•¿æ–¹å½¢å’Œæ¤­åœ†å½¢éƒ½æ˜¯ç»“ç‚¹ã€‚é•¿æ–¹å½¢çš„ç»“ç‚¹å±äºå†…éƒ¨ç»“ç‚¹ï¼Œæ¤­åœ†å½¢çš„ç»“ç‚¹å±äºå¶ç»“ç‚¹ï¼Œä»ç»“ç‚¹å¼•å‡ºçš„å·¦å³ç®­å¤´å°±æ˜¯æœ‰å‘è¾¹ã€‚è€Œæœ€ä¸Šé¢çš„ç»“ç‚¹å°±æ˜¯å†³ç­–æ ‘çš„æ ¹ç»“ç‚¹(root node)ã€‚è¿™æ ·ï¼Œç»“ç‚¹è¯´æ³•å°±ä¸æ¨¡å—è¯´æ³•å¯¹åº”ä¸Šäº†ï¼Œç†è§£å°±å¥½ã€‚ ","date":"2022-08-21","objectID":"/%E5%86%B3%E7%AD%96%E6%A0%91/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","å†³ç­–æ ‘"],"title":"å†³ç­–æ ‘","uri":"/%E5%86%B3%E7%AD%96%E6%A0%91/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ­¥éª¤ 1.ç‰¹å¾é€‰æ‹© ç‰¹å¾é€‰æ‹©åœ¨äºé€‰å–å¯¹è®­ç»ƒæ•°æ®å…·æœ‰åˆ†ç±»èƒ½åŠ›çš„ç‰¹å¾ã€‚è¿™æ ·å¯ä»¥æé«˜å†³ç­–æ ‘å­¦ä¹ çš„æ•ˆç‡ï¼Œå¦‚æœåˆ©ç”¨ä¸€ä¸ªç‰¹å¾è¿›è¡Œåˆ†ç±»çš„ç»“æœä¸éšæœºåˆ†ç±»çš„ç»“æœæ²¡æœ‰å¾ˆå¤§å·®åˆ«ï¼Œåˆ™ç§°è¿™ä¸ªç‰¹å¾æ˜¯æ²¡æœ‰åˆ†ç±»èƒ½åŠ›çš„ã€‚ç»éªŒä¸Šæ‰”æ‰è¿™æ ·çš„ç‰¹å¾å¯¹å†³ç­–æ ‘å­¦ä¹ çš„ç²¾åº¦å½±å“ä¸å¤§ã€‚é€šå¸¸ç‰¹å¾é€‰æ‹©çš„æ ‡å‡†æ˜¯ä¿¡æ¯å¢ç›Š(information gain)æˆ–ä¿¡æ¯å¢ç›Šæ¯”ï¼Œä¸ºäº†ç®€å•ï¼Œæœ¬æ–‡ä½¿ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºé€‰æ‹©ç‰¹å¾çš„æ ‡å‡†ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ä¿¡æ¯å¢ç›Šï¼Ÿåœ¨è®²è§£ä¿¡æ¯å¢ç›Šä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ç»„å®ä¾‹ï¼Œè´·æ¬¾ç”³è¯·æ ·æœ¬æ•°æ®è¡¨ã€‚ æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šå†³ç­–æ ‘åŸºç¡€ç¯‡ä¹‹è®©æˆ‘ä»¬ä»ç›¸äº²è¯´èµ· å¸Œæœ›é€šè¿‡æ‰€ç»™çš„è®­ç»ƒæ•°æ®å­¦ä¹ ä¸€ä¸ªè´·æ¬¾ç”³è¯·çš„å†³ç­–æ ‘ï¼Œç”¨äºå¯¹æœªæ¥çš„è´·æ¬¾ç”³è¯·è¿›è¡Œåˆ†ç±»ï¼Œå³å½“æ–°çš„å®¢æˆ·æå‡ºè´·æ¬¾ç”³è¯·æ—¶ï¼Œæ ¹æ®ç”³è¯·äººçš„ç‰¹å¾åˆ©ç”¨å†³ç­–æ ‘å†³å®šæ˜¯å¦æ‰¹å‡†è´·æ¬¾ç”³è¯·ã€‚ ç‰¹å¾é€‰æ‹©å°±æ˜¯å†³å®šç”¨å“ªä¸ªç‰¹å¾æ¥åˆ’åˆ†ç‰¹å¾ç©ºé—´ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šè¿°æ•°æ®è¡¨å¾—åˆ°ä¸¤ä¸ªå¯èƒ½çš„å†³ç­–æ ‘ï¼Œåˆ†åˆ«ç”±ä¸¤ä¸ªä¸åŒç‰¹å¾çš„æ ¹ç»“ç‚¹æ„æˆã€‚ (1).é¦™å†œç†µ åœ¨å¯ä»¥è¯„æµ‹å“ªä¸ªæ•°æ®åˆ’åˆ†æ–¹å¼æ˜¯æœ€å¥½çš„æ•°æ®åˆ’åˆ†ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å­¦ä¹ å¦‚ä½•è®¡ç®—ä¿¡æ¯å¢ç›Šã€‚é›†åˆä¿¡æ¯çš„åº¦é‡æ–¹å¼ç§°ä¸ºé¦™å†œç†µæˆ–è€…ç®€ç§°ä¸ºç†µ(entropy)ï¼Œè¿™ä¸ªåå­—æ¥æºäºä¿¡æ¯è®ºä¹‹çˆ¶å…‹åŠ³å¾·Â·é¦™å†œã€‚ å¦‚æœçœ‹ä¸æ˜ç™½ä»€ä¹ˆæ˜¯ä¿¡æ¯å¢ç›Šå’Œç†µï¼Œè¯·ä¸è¦ç€æ€¥ï¼Œå› ä¸ºä»–ä»¬è‡ªè¯ç”Ÿçš„é‚£ä¸€å¤©èµ·ï¼Œå°±æ³¨å®šä¼šä»¤ä¸–äººååˆ†è´¹è§£ã€‚å…‹åŠ³å¾·Â·é¦™å†œå†™å®Œä¿¡æ¯è®ºä¹‹åï¼Œçº¦ç¿°Â·å†¯Â·è¯ºä¾æ›¼å»ºè®®ä½¿ç”¨â€ç†µâ€è¿™ä¸ªæœ¯è¯­ï¼Œå› ä¸ºå¤§å®¶éƒ½ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆæ„æ€ã€‚ ç†µå®šä¹‰ä¸ºä¿¡æ¯çš„æœŸæœ›å€¼ã€‚åœ¨ä¿¡æ¯è®ºä¸æ¦‚ç‡ç»Ÿè®¡ä¸­ï¼Œç†µæ˜¯è¡¨ç¤ºéšæœºå˜é‡ä¸ç¡®å®šæ€§çš„åº¦é‡ã€‚å¦‚æœå¾…åˆ†ç±»çš„äº‹ç‰©å¯èƒ½åˆ’åˆ†åœ¨å¤šä¸ªåˆ†ç±»ä¹‹ä¸­ï¼Œåˆ™ç¬¦å·xiçš„ä¿¡æ¯å®šä¹‰ä¸º ï¼š \\[ l(x_i) = -log_{2}p(x_i) \\] å…¶ä¸­p(xi)æ˜¯é€‰æ‹©è¯¥åˆ†ç±»çš„æ¦‚ç‡ã€‚æœ‰äººå¯èƒ½ä¼šé—®ï¼Œä¿¡æ¯ä¸ºå•¥è¿™æ ·å®šä¹‰å•Šï¼Ÿç­”æ›°ï¼šå‰è¾ˆå¾—å‡ºçš„ç»“è®ºã€‚è¿™å°±è·Ÿ1+1ç­‰äº2ä¸€æ ·ï¼Œè®°ä½å¹¶ä¸”ä¼šç”¨å³å¯ã€‚ä¸Šè¿°å¼ä¸­çš„å¯¹æ•°ä»¥2ä¸ºåº•ï¼Œä¹Ÿå¯ä»¥eä¸ºåº•(è‡ªç„¶å¯¹æ•°)ã€‚ é€šè¿‡ä¸Šå¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰ç±»åˆ«çš„ä¿¡æ¯ã€‚ä¸ºäº†è®¡ç®—ç†µï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ‰€æœ‰ç±»åˆ«æ‰€æœ‰å¯èƒ½å€¼åŒ…å«çš„ä¿¡æ¯æœŸæœ›å€¼(æ•°å­¦æœŸæœ›)ï¼Œé€šè¿‡ä¸‹é¢çš„å…¬å¼å¾—åˆ°ï¼š \\[ H = -\\sum_{i=1}^np(x_i)log_2p(x_i) \\] æœŸä¸­næ˜¯åˆ†ç±»çš„æ•°ç›®ã€‚ç†µè¶Šå¤§ï¼Œéšæœºå˜é‡çš„ä¸ç¡®å®šæ€§å°±è¶Šå¤§ã€‚ å½“ç†µä¸­çš„æ¦‚ç‡ç”±æ•°æ®ä¼°è®¡(ç‰¹åˆ«æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡)å¾—åˆ°æ—¶ï¼Œæ‰€å¯¹åº”çš„ç†µç§°ä¸ºç»éªŒç†µ(empirical entropy)ã€‚ä»€ä¹ˆå«ç”±æ•°æ®ä¼°è®¡ï¼Ÿæ¯”å¦‚æœ‰10ä¸ªæ•°æ®ï¼Œä¸€å…±æœ‰ä¸¤ä¸ªç±»åˆ«ï¼ŒAç±»å’ŒBç±»ã€‚å…¶ä¸­æœ‰7ä¸ªæ•°æ®å±äºAç±»ï¼Œåˆ™è¯¥Aç±»çš„æ¦‚ç‡å³ä¸ºååˆ†ä¹‹ä¸ƒã€‚å…¶ä¸­æœ‰3ä¸ªæ•°æ®å±äºBç±»ï¼Œåˆ™è¯¥Bç±»çš„æ¦‚ç‡å³ä¸ºååˆ†ä¹‹ä¸‰ã€‚æµ…æ˜¾çš„è§£é‡Šå°±æ˜¯ï¼Œè¿™æ¦‚ç‡æ˜¯æˆ‘ä»¬æ ¹æ®æ•°æ®æ•°å‡ºæ¥çš„ã€‚æˆ‘ä»¬å®šä¹‰è´·æ¬¾ç”³è¯·æ ·æœ¬æ•°æ®è¡¨ä¸­çš„æ•°æ®ä¸ºè®­ç»ƒæ•°æ®é›†Dï¼Œåˆ™è®­ç»ƒæ•°æ®é›†Dçš„ç»éªŒç†µä¸ºH(D)ï¼Œ|D|è¡¨ç¤ºå…¶æ ·æœ¬å®¹é‡ï¼ŒåŠæ ·æœ¬ä¸ªæ•°ã€‚è®¾æœ‰Kä¸ªç±»Ck, = 1,2,3,.. .,K,|Ck|ä¸ºå±äºç±»Ckçš„æ ·æœ¬ä¸ªæ•°ï¼Œå› æ­¤ç»éªŒç†µå…¬å¼å°±å¯ä»¥å†™ä¸º ï¼š \\[ H(D) = -\\sum_{k=1}^K \\frac{|c_k|}{|D|}log_2\\frac{|c_k|}{|D|} \\] æ ¹æ®æ­¤å…¬å¼è®¡ç®—ç»éªŒç†µH(D)ï¼Œåˆ†æè´·æ¬¾ç”³è¯·æ ·æœ¬æ•°æ®è¡¨ä¸­çš„æ•°æ®ã€‚æœ€ç»ˆåˆ†ç±»ç»“æœåªæœ‰ä¸¤ç±»ï¼Œå³æ”¾è´·å’Œä¸æ”¾è´·ã€‚æ ¹æ®è¡¨ä¸­çš„æ•°æ®ç»Ÿè®¡å¯çŸ¥ï¼Œåœ¨15ä¸ªæ•°æ®ä¸­ï¼Œ9ä¸ªæ•°æ®çš„ç»“æœä¸ºæ”¾è´·ï¼Œ6ä¸ªæ•°æ®çš„ç»“æœä¸ºä¸æ”¾è´·ã€‚æ‰€ä»¥æ•°æ®é›†Dçš„ç»éªŒç†µH(D)ä¸ºï¼š \\[ H(D) = -\\frac{9}{15}log_2\\frac{9}{15} - \\frac{6}{15}log_2\\frac{6}{15} = 0.971 \\] (2)ä¿¡æ¯å¢ç›Š åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»è¯´è¿‡ï¼Œå¦‚ä½•é€‰æ‹©ç‰¹å¾ï¼Œéœ€è¦çœ‹ä¿¡æ¯å¢ç›Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿¡æ¯å¢ç›Šæ˜¯ç›¸å¯¹äºç‰¹å¾è€Œè¨€çš„ï¼Œä¿¡æ¯å¢ç›Šè¶Šå¤§ï¼Œç‰¹å¾å¯¹æœ€ç»ˆçš„åˆ†ç±»ç»“æœå½±å“ä¹Ÿå°±è¶Šå¤§ï¼Œæˆ‘ä»¬å°±åº”è¯¥é€‰æ‹©å¯¹æœ€ç»ˆåˆ†ç±»ç»“æœå½±å“æœ€å¤§çš„é‚£ä¸ªç‰¹å¾ä½œä¸ºæˆ‘ä»¬çš„åˆ†ç±»ç‰¹å¾ã€‚ åœ¨è®²è§£ä¿¡æ¯å¢ç›Šå®šä¹‰ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼Œæ¡ä»¶ç†µã€‚ ç†µæˆ‘ä»¬çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œæ¡ä»¶ç†µåˆæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿæ¡ä»¶ç†µH(Y|X)è¡¨ç¤ºåœ¨å·²çŸ¥éšæœºå˜é‡Xçš„æ¡ä»¶ä¸‹éšæœºå˜é‡Yçš„ä¸ç¡®å®šæ€§ï¼Œéšæœºå˜é‡Xç»™å®šçš„æ¡ä»¶ä¸‹éšæœºå˜é‡Yçš„æ¡ä»¶ç†µ(conditional entropy)H(Y|X)ï¼Œå®šä¹‰ä¸ºXç»™å®šæ¡ä»¶ä¸‹Yçš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒçš„ç†µå¯¹Xçš„æ•°å­¦æœŸæœ›ï¼š \\[ H(Y|X) = \\sum_{i=1}^np_iH(Y|X = x_i), \\\\\\\\ p_i = P(X = x_i) \\] æ˜ç¡®äº†æ¡ä»¶ç†µå’Œç»éªŒæ¡ä»¶ç†µçš„æ¦‚å¿µã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è¯´è¯´ä¿¡æ¯å¢ç›Šã€‚å‰é¢ä¹Ÿæåˆ°äº†ï¼Œä¿¡æ¯å¢ç›Šæ˜¯ç›¸å¯¹äºç‰¹å¾è€Œè¨€çš„ã€‚æ‰€ä»¥ï¼Œç‰¹å¾Aå¯¹è®­ç»ƒæ•°æ®é›†Dçš„ä¿¡æ¯å¢ç›Šg(D,A)ï¼Œå®šä¹‰ä¸ºé›†åˆDçš„ç»éªŒç†µH(D)ä¸ç‰¹å¾Aç»™å®šæ¡ä»¶ä¸‹Dçš„ç»éªŒæ¡ä»¶ç†µH(D|A)ä¹‹å·®ï¼Œå³ï¼š \\[ g(D,A) = H(D) - H(D|A) \\] ä¸€èˆ¬åœ°ï¼Œç†µH(D)ä¸æ¡ä»¶ç†µH(D|A)ä¹‹å·®ç§°ä¸ºäº’ä¿¡æ¯(mutual information)ã€‚å†³ç­–æ ‘å­¦ä¹ ä¸­çš„ä¿¡æ¯å¢ç›Šç­‰ä»·äºè®­ç»ƒæ•°æ®é›†ä¸­ç±»ä¸ç‰¹å¾çš„äº’ä¿¡æ¯ã€‚ è®¾ç‰¹å¾Aæœ‰nä¸ªä¸åŒçš„å–å€¼{a1,a2,Â·Â·Â·,an}ï¼Œæ ¹æ®ç‰¹å¾Açš„å–å€¼å°†Dåˆ’åˆ†ä¸ºnä¸ªå­é›†{D1,D2ï¼ŒÂ·Â·Â·,Dn}ï¼Œ|Di|ä¸ºDiçš„æ ·æœ¬ä¸ªæ•°ã€‚è®°å­é›†Diä¸­å±äºCkçš„æ ·æœ¬çš„é›†åˆä¸ºDikï¼Œå³Dik = Di âˆ© Ckï¼Œ|Dik|ä¸ºDikçš„æ ·æœ¬ä¸ªæ•°ã€‚äºæ˜¯ç»éªŒæ¡ä»¶ç†µçš„å…¬å¼å¯ä»¥äº›ä¸º \\[ H(D|A) = \\sum_{i=1}^n\\frac{|D_i|}{|D|}H(D_i) = -\\sum_{i=1}^n\\frac{|D_i|}{|D|}\\sum_{k=1}^K\\frac{|D_{ik}|}{|D_i|}log_2\\frac{|D_{ik}|}{|D_i|} \\] è¯´äº†è¿™ä¹ˆå¤šæ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œæ²¡æœ‰å¬æ‡‚ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä¸¾å‡ ä¸ªä¾‹å­ï¼Œå†å›æ¥çœ‹ä¸€ä¸‹æ¦‚å¿µï¼Œå°±æ‡‚äº†ã€‚ ä»¥è´·æ¬¾ç”³è¯·æ ·æœ¬æ•°æ®è¡¨ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚çœ‹ä¸‹å¹´é¾„è¿™ä¸€åˆ—çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç‰¹å¾A1ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼šé’å¹´ã€ä¸­å¹´å’Œè€å¹´ã€‚æˆ‘ä»¬åªçœ‹å¹´é¾„æ˜¯é’å¹´çš„æ•°æ®ï¼Œå¹´é¾„æ˜¯é’å¹´çš„æ•°æ®ä¸€å…±æœ‰5ä¸ªï¼Œæ‰€ä»¥å¹´é¾„æ˜¯é’å¹´çš„æ•°æ®åœ¨è®­ç»ƒæ•°æ®é›†å‡ºç°çš„æ¦‚ç‡æ˜¯åäº”åˆ†ä¹‹äº”ï¼Œä¹Ÿå°±æ˜¯ä¸‰åˆ†ä¹‹ä¸€ã€‚åŒç†ï¼Œå¹´é¾„æ˜¯ä¸­å¹´å’Œè€å¹´çš„æ•°æ®åœ¨è®­ç»ƒæ•°æ®é›†å‡ºç°çš„æ¦‚ç‡ä¹Ÿéƒ½æ˜¯ä¸‰åˆ†ä¹‹ä¸€ã€‚ç°åœ¨æˆ‘ä»¬åªçœ‹å¹´é¾„æ˜¯é’å¹´çš„æ•°æ®çš„æœ€ç»ˆå¾—åˆ°è´·æ¬¾çš„æ¦‚ç‡ä¸ºäº”åˆ†ä¹‹äºŒï¼Œå› ä¸ºåœ¨äº”ä¸ªæ•°æ®ä¸­ï¼Œåªæœ‰ä¸¤ä¸ªæ•°æ®æ˜¾ç¤ºæ‹¿åˆ°äº†æœ€ç»ˆçš„è´·æ¬¾ï¼ŒåŒç†ï¼Œå¹´é¾„æ˜¯ä¸­å¹´å’Œè€å¹´çš„æ•°æ®æœ€ç»ˆå¾—åˆ°è´·æ¬¾çš„æ¦‚ç‡åˆ†åˆ«ä¸ºäº”åˆ†ä¹‹ä¸‰ã€äº”åˆ†ä¹‹å››ã€‚æ‰€ä»¥è®¡ç®—å¹´é¾„çš„ä¿¡æ¯å¢ç›Šï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šå†³ç­–æ ‘åŸºç¡€ç¯‡ä¹‹è®©æˆ‘ä»¬ä»ç›¸äº²è¯´èµ· åŒç†ï¼Œè®¡ç®—å…¶ä½™ç‰¹å¾çš„ä¿¡æ¯å¢ç›Šg(D,A2)ã€g(D,A3)å’Œg(D,A4)ã€‚åˆ†åˆ«ä¸ºï¼š æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šå†³ç­–æ ‘åŸºç¡€ç¯‡ä¹‹è®©æˆ‘ä»¬ä»ç›¸äº²è¯´èµ· æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šå†³ç­–æ ‘åŸºç¡€ç¯‡ä¹‹è®©æˆ‘ä»¬ä»ç›¸äº²è¯´èµ· æœ€åï¼Œæ¯”è¾ƒç‰¹å¾çš„ä¿¡æ¯å¢ç›Šï¼Œç”±äºç‰¹å¾A3(æœ‰è‡ªå·±çš„æˆ¿å­)çš„ä¿¡æ¯å¢ç›Šå€¼æœ€å¤§ï¼Œæ‰€ä»¥é€‰æ‹©A3ä½œä¸ºæœ€ä¼˜ç‰¹å¾ã€‚ ç”±äºç‰¹å¾A3(æœ‰è‡ªå·±çš„æˆ¿å­)çš„ä¿¡æ¯å¢ç›Šå€¼æœ€å¤§ï¼Œæ‰€ä»¥é€‰æ‹©ç‰¹å¾A3ä½œä¸ºæ ¹ç»“ç‚¹çš„ç‰¹å¾ã€‚å®ƒå°†è®­ç»ƒé›†Dåˆ’åˆ†ä¸ºä¸¤ä¸ªå­é›†D1(A3å–å€¼ä¸ºâ€æ˜¯â€)å’ŒD2(A3å–å€¼ä¸ºâ€å¦â€)ã€‚ç”±äºD1åªæœ‰åŒä¸€ç±»çš„æ ·æœ¬ç‚¹ï¼Œæ‰€ä»¥å®ƒæˆä¸ºä¸€ä¸ªå¶ç»“ç‚¹ï¼Œç»“ç‚¹çš„ç±»æ ‡è®°ä¸ºâ€œæ˜¯â€ã€‚ å¯¹D2åˆ™éœ€è¦ä»ç‰¹å¾A1(å¹´é¾„)ï¼ŒA2(æœ‰å·¥ä½œ)å’ŒA4(ä¿¡è´·æƒ…å†µ)ä¸­é€‰æ‹©æ–°çš„ç‰¹å¾ï¼Œè®¡ç®—å„ä¸ªç‰¹å¾çš„ä¿¡æ¯å¢ç›Šï¼š æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šå†³ç­–æ ‘å®æˆ˜ç¯‡ä¹‹ä¸ºè‡ªå·±é…ä¸ªéšå½¢çœ¼é•œ æ ¹æ®è®¡ç®—ï¼Œé€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„ç‰¹å¾A2(æœ‰å·¥ä½œ)ä½œä¸ºç»“ç‚¹çš„ç‰¹å¾ã€‚ç”±äºA2æœ‰ä¸¤ä¸ªå¯èƒ½å–å€¼ï¼Œä»è¿™ä¸€ç»“ç‚¹å¼•å‡ºä¸¤ä¸ªå­ç»“ç‚¹ï¼šä¸€ä¸ªå¯¹åº”â€æ˜¯â€(æœ‰å·¥ä½œ)çš„å­ç»“ç‚¹ï¼ŒåŒ…å«3ä¸ªæ ·æœ¬ï¼Œå®ƒä»¬å±äºåŒä¸€ç±»ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¶ç»“ç‚¹ï¼Œç±»æ ‡è®°ä¸ºâ€æ˜¯â€ï¼›å¦ä¸€ä¸ªæ˜¯å¯¹åº”â€å¦â€(æ— å·¥ä½œ)çš„å­ç»“ç‚¹ï¼ŒåŒ…å«6ä¸ªæ ·æœ¬ï¼Œå®ƒä»¬ä¹Ÿå±äºåŒä¸€ç±»ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¶ç»“ç‚¹ï¼Œç±»æ ‡è®°ä¸ºâ€å¦â€ã€‚ è¿™æ ·å°±ç”Ÿæˆäº†ä¸€ä¸ªå†³ç­–æ ‘ï¼Œè¯¥å†³ç­–æ ‘åªç”¨äº†ä¸¤ä¸ªç‰¹å¾(æœ‰ä¸¤ä¸ªå†…éƒ¨ç»“ç‚¹)ï¼Œç”Ÿæˆçš„å†³ç­–æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šå†³ç­–æ ‘å®æˆ˜ç¯‡ä¹‹ä¸ºè‡ªå·±é…ä¸ªéšå½¢çœ¼é•œ ","date":"2022-08-21","objectID":"/%E5%86%B3%E7%AD%96%E6%A0%91/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","å†³ç­–æ ‘"],"title":"å†³ç­–æ ‘","uri":"/%E5%86%B3%E7%AD%96%E6%A0%91/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ€»ç»“ æˆ‘ä»¬å·²ç»å­¦ä¹ äº†ä»æ•°æ®é›†æ„é€ å†³ç­–æ ‘ç®—æ³•æ‰€éœ€è¦çš„å­åŠŸèƒ½æ¨¡å—ï¼ŒåŒ…æ‹¬ç»éªŒç†µçš„è®¡ç®—å’Œæœ€ä¼˜ç‰¹å¾çš„é€‰æ‹©ï¼Œå…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼šå¾—åˆ°åŸå§‹æ•°æ®é›†ï¼Œç„¶ååŸºäºæœ€å¥½çš„å±æ€§å€¼åˆ’åˆ†æ•°æ®é›†ï¼Œç”±äºç‰¹å¾å€¼å¯èƒ½å¤šäºä¸¤ä¸ªï¼Œå› æ­¤å¯èƒ½å­˜åœ¨å¤§äºä¸¤ä¸ªåˆ†æ”¯çš„æ•°æ®é›†åˆ’åˆ†ã€‚ç¬¬ä¸€æ¬¡åˆ’åˆ†ä¹‹åï¼Œæ•°æ®é›†è¢«å‘ä¸‹ä¼ é€’åˆ°æ ‘çš„åˆ†æ”¯çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚åœ¨è¿™ä¸ªç»“ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡åˆ’åˆ†æ•°æ®ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€’å½’çš„åŸåˆ™å¤„ç†æ•°æ®é›†ã€‚ æ„å»ºå†³ç­–æ ‘çš„ç®—æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚C4.5ã€ID3å’ŒCARTï¼Œè¿™äº›ç®—æ³•åœ¨è¿è¡Œæ—¶å¹¶ä¸æ€»æ˜¯åœ¨æ¯æ¬¡åˆ’åˆ†æ•°æ®åˆ†ç»„æ—¶éƒ½ä¼šæ¶ˆè€—ç‰¹å¾ã€‚ç”±äºç‰¹å¾æ•°ç›®å¹¶ä¸æ˜¯æ¯æ¬¡åˆ’åˆ†æ•°æ®åˆ†ç»„æ—¶éƒ½å‡å°‘ï¼Œå› æ­¤è¿™äº›ç®—æ³•åœ¨å®é™…ä½¿ç”¨æ—¶å¯èƒ½å¼•èµ·ä¸€å®šçš„é—®é¢˜ã€‚ç›®å‰æˆ‘ä»¬å¹¶ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦åœ¨ç®—æ³•å¼€å§‹è¿è¡Œå‰è®¡ç®—åˆ—çš„æ•°ç›®ï¼ŒæŸ¥çœ‹ç®—æ³•æ˜¯å¦ä½¿ç”¨äº†æ‰€æœ‰å±æ€§å³å¯ã€‚ å†³ç­–æ ‘ç”Ÿæˆç®—æ³•é€’å½’åœ°äº§ç”Ÿå†³ç­–æ ‘ï¼Œç›´åˆ°ä¸èƒ½ç»§ç»­ä¸‹å»æœªä¸ºæ­¢ã€‚è¿™æ ·äº§ç”Ÿçš„æ ‘å¾€å¾€å¯¹è®­ç»ƒæ•°æ®çš„åˆ†ç±»å¾ˆå‡†ç¡®ï¼Œä½†å¯¹æœªçŸ¥çš„æµ‹è¯•æ•°æ®çš„åˆ†ç±»å´æ²¡æœ‰é‚£ä¹ˆå‡†ç¡®ï¼Œå³å‡ºç°è¿‡æ‹Ÿåˆç°è±¡ã€‚è¿‡æ‹Ÿåˆçš„åŸå› åœ¨äºå­¦ä¹ æ—¶è¿‡å¤šåœ°è€ƒè™‘å¦‚ä½•æé«˜å¯¹è®­ç»ƒæ•°æ®çš„æ­£ç¡®åˆ†ç±»ï¼Œä»è€Œæ„å»ºå‡ºè¿‡äºå¤æ‚çš„å†³ç­–æ ‘ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯è€ƒè™‘å†³ç­–æ ‘çš„å¤æ‚åº¦ï¼Œå¯¹å·²ç”Ÿæˆçš„å†³ç­–æ ‘è¿›è¡Œç®€åŒ–ã€‚ å†³ç­–æ ‘çš„ä¸€äº›ä¼˜ç‚¹ï¼š æ˜“äºç†è§£å’Œè§£é‡Šã€‚å†³ç­–æ ‘å¯ä»¥å¯è§†åŒ–ã€‚ å‡ ä¹ä¸éœ€è¦æ•°æ®é¢„å¤„ç†ã€‚å…¶ä»–æ–¹æ³•ç»å¸¸éœ€è¦æ•°æ®æ ‡å‡†åŒ–ï¼Œåˆ›å»ºè™šæ‹Ÿå˜é‡å’Œåˆ é™¤ç¼ºå¤±å€¼ã€‚å†³ç­–æ ‘è¿˜ä¸æ”¯æŒç¼ºå¤±å€¼ã€‚ ä½¿ç”¨æ ‘çš„èŠ±è´¹ï¼ˆä¾‹å¦‚é¢„æµ‹æ•°æ®ï¼‰æ˜¯è®­ç»ƒæ•°æ®ç‚¹(data points)æ•°é‡çš„å¯¹æ•°ã€‚ å¯ä»¥åŒæ—¶å¤„ç†æ•°å€¼å˜é‡å’Œåˆ†ç±»å˜é‡ã€‚å…¶ä»–æ–¹æ³•å¤§éƒ½é€‚ç”¨äºåˆ†æä¸€ç§å˜é‡çš„é›†åˆã€‚ å¯ä»¥å¤„ç†å¤šå€¼è¾“å‡ºå˜é‡é—®é¢˜ã€‚ ä½¿ç”¨ç™½ç›’æ¨¡å‹ã€‚å¦‚æœä¸€ä¸ªæƒ…å†µè¢«è§‚å¯Ÿåˆ°ï¼Œä½¿ç”¨é€»è¾‘åˆ¤æ–­å®¹æ˜“è¡¨ç¤ºè¿™ç§è§„åˆ™ã€‚ç›¸åï¼Œå¦‚æœæ˜¯é»‘ç›’æ¨¡å‹ï¼ˆä¾‹å¦‚äººå·¥ç¥ç»ç½‘ç»œï¼‰ï¼Œç»“æœä¼šéå¸¸éš¾è§£é‡Šã€‚ å³ä½¿å¯¹çœŸå®æ¨¡å‹æ¥è¯´ï¼Œå‡è®¾æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¾ƒå¥½çš„é€‚ç”¨ã€‚ å†³ç­–æ ‘çš„ä¸€äº›ç¼ºç‚¹ï¼š å†³ç­–æ ‘å­¦ä¹ å¯èƒ½åˆ›å»ºä¸€ä¸ªè¿‡äºå¤æ‚çš„æ ‘ï¼Œå¹¶ä¸èƒ½å¾ˆå¥½çš„é¢„æµ‹æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¿‡æ‹Ÿåˆã€‚ä¿®å‰ªæœºåˆ¶ï¼ˆç°åœ¨ä¸æ”¯æŒï¼‰ï¼Œè®¾ç½®ä¸€ä¸ªå¶å­èŠ‚ç‚¹éœ€è¦çš„æœ€å°æ ·æœ¬æ•°é‡ï¼Œæˆ–è€…æ•°çš„æœ€å¤§æ·±åº¦ï¼Œå¯ä»¥é¿å…è¿‡æ‹Ÿåˆã€‚ å†³ç­–æ ‘å¯èƒ½æ˜¯ä¸ç¨³å®šçš„ï¼Œå› ä¸ºå³ä½¿éå¸¸å°çš„å˜å¼‚ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€é¢—å®Œå…¨ä¸åŒçš„æ ‘ã€‚è¿™ä¸ªé—®é¢˜é€šè¿‡decision trees with an ensembleæ¥ç¼“è§£ã€‚ æ¦‚å¿µéš¾ä»¥å­¦ä¹ ï¼Œå› ä¸ºå†³ç­–æ ‘æ²¡æœ‰å¾ˆå¥½çš„è§£é‡Šä»–ä»¬ï¼Œä¾‹å¦‚ï¼ŒXOR, parity or multiplexer problemsã€‚ å¦‚æœæŸäº›åˆ†ç±»å ä¼˜åŠ¿ï¼Œå†³ç­–æ ‘å°†ä¼šåˆ›å»ºä¸€æ£µæœ‰åå·®çš„æ ‘ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨è®­ç»ƒä¹‹å‰ï¼Œå…ˆæŠ½æ ·ä½¿æ ·æœ¬å‡è¡¡ã€‚ ","date":"2022-08-21","objectID":"/%E5%86%B3%E7%AD%96%E6%A0%91/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","å†³ç­–æ ‘"],"title":"å†³ç­–æ ‘","uri":"/%E5%86%B3%E7%AD%96%E6%A0%91/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä»£ç  import numpy as np import math def equalNums(label_list, label): \"\"\" å‡½æ•°è¯´æ˜ï¼š è®¡ç®—æ ‡è®°é›†ä¸­æŸä¸ªæ ‡è®°çš„æ•°é‡ Parametersï¼š label_list - æ ‡è®°é›† label - æŸä¸ªæ ‡è®° Returnsï¼š num - æŸä¸ªæ ‡è®°çš„æ•°é‡ \"\"\" return np.sum(label_list == label) def calcShannonEnt(label_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š è®¡ç®—ä¿¡æ¯ç†µ å¯¹åº”å…¬å¼ Ent(D) = -âˆ‘ Pk*log2(Pk) k=1..len(label_set) Parametersï¼š label_list - æ ‡è®°é›† Returnsï¼š shannonEnt - å½“å‰æ ‡è®°é›†çš„ä¿¡æ¯ç†µ \"\"\" label_set = set(label_list) len_label_list = label_list.size shannonEnt = 0.0 for label in label_set: prob = equalNums(label_list, label)/len_label_list shannonEnt -= prob * math.log2(prob) return shannonEnt def conditionnalEntropy(feature_list, label_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š è®¡ç®—æ¡ä»¶ä¿¡æ¯ç†µï¼Œå¯¹åº”ä¿¡æ¯å¢ç›Šå…¬å¼ä¸­çš„è¢«å‡é¡¹ Parametersï¼š feature_list - sample_listä¸­æŸä¸€åˆ—ï¼Œè¡¨ç¤ºå½“å‰å±æ€§çš„æ‰€æœ‰å€¼ label_list - æ ‡è®°é›† Returnsï¼š entropy - æ¡ä»¶ä¿¡æ¯ç†µ \"\"\" feature_list = np.asarray(feature_list) label_list = np.asarray(label_list) feature_set = set(feature_list) entropy = 0.0 for feat in feature_set: pro = equalNums(feature_list, feat)/feature_list.size entropy += pro * calcShannonEnt(label_list[feature_list == feat]) return entropy def calcInfoGain(feature_list, label_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š è®¡ç®—ä¿¡æ¯å¢ç›Š Parametersï¼š feature_list - sample_listä¸­æŸä¸€åˆ—ï¼Œè¡¨ç¤ºå½“å‰å±æ€§çš„æ‰€æœ‰å€¼ label_list - æ ‡è®°é›† Returnsï¼š å½“å‰å±æ€§çš„ä¿¡æ¯å¢ç›Š \"\"\" return calcShannonEnt(label_list) - conditionnalEntropy(feature_list, label_list) def splitDataSet(sample_list, label_list, axis, value): \"\"\" å‡½æ•°è¯´æ˜ï¼š å†³ç­–æ ‘åœ¨é€‰å¥½å½“å‰æœ€ä¼˜åˆ’åˆ†å±æ€§ä¹‹ååˆ’åˆ†æ ·æœ¬é›† ä¾æ®valueé€‰æ‹©å¯¹åº”æ ·ä¾‹ï¼Œå¹¶å»é™¤ç¬¬axisç»´å±æ€§ Parametersï¼š feature_list - sample_listä¸­æŸä¸€åˆ—ï¼Œè¡¨ç¤ºå½“å‰å±æ€§çš„æ‰€æœ‰å€¼ label_list - æ ‡è®°é›† Returnsï¼š return_sample_list, return_label_list \"\"\" # sample_list[sample_list[...,axis] == value] åˆ©ç”¨äº†numpyæ•°ç»„çš„å¸ƒå°”ç´¢å¼• filtered_sample_list = sample_list[sample_list[...,axis] == value] return_label_list = label_list[sample_list[...,axis] == value] # np.hstack å°†æ•°ç»„æ¨ªå‘æ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯å»é™¤ç¬¬axisç»´å±æ€§ return_sample_list = np.hstack((filtered_sample_list[...,:axis], filtered_sample_list[...,axis+1:])) return return_sample_list, return_label_list def chooseBestFeatureToSplit(sample_list, label_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š é€‰å–æœ€ä¼˜åˆ’åˆ†å±æ€§ Parametersï¼š sample_list - æ ·æœ¬é›† label_list - æ ‡è®°é›† Returnsï¼š bestFeat_index - æœ€ä¼˜åˆ’åˆ†å±æ€§çš„ç´¢å¼•å€¼ \"\"\" numFeatures = sample_list.shape[1] bestInfoGain = 0 bestFeat_index = -1 for i in range(numFeatures): infoGain = calcInfoGain(sample_list[..., i], label_list) if infoGain \u003e bestInfoGain: bestInfoGain = infoGain bestFeat_index = i return bestFeat_index def createTree(sample_list, label_list, attr_list_copy): \"\"\" å‡½æ•°è¯´æ˜ï¼š ç”Ÿæˆå†³ç­–æ ‘ Parametersï¼š sample_list - æ ·æœ¬é›† label_list - æ ‡è®°é›† attr_list_copy - å±æ€§é›†ï¼ˆä¹‹æ‰€ä»¥åŠ copyæ˜¯ä¸ºäº†åˆ å±æ€§çš„æ—¶å€™æ˜¯åœ¨å‰¯æœ¬ä¸Šï¼Œé˜²æ­¢é€’å½’å‡ºé”™ï¼‰ Returnsï¼š myTree - æœ€ç»ˆçš„å†³ç­–æ ‘ \"\"\" # attr_list æœ‰delæ“ä½œï¼Œä¸ç”¨å‰¯æœ¬çš„è¯é€’å½’ä¼šå‡ºé”™ attr_list = attr_list_copy.copy() if len(set(label_list)) == 1: # å¦‚æœåªæœ‰ä¸€ç§æ ‡è®°ï¼Œç›´æ¥è¿”å›æ ‡è®° return label_list[0] elif sample_list.size == 0: # å¦‚æœæ‰€æœ‰å±æ€§éƒ½è¢«éå†ï¼Œè¿”å›æœ€å¤šçš„æ ‡è®° return voteLabel(label_list) # bestFeat_index æœ€ä¼˜åˆ’åˆ†å±æ€§çš„ç´¢å¼•å€¼ # bestAttr æœ€ä¼˜åˆ’åˆ†å±æ€§å¯¹åº”çš„åå­— bestFeat_index = chooseBestFeatureToSplit(sample_list, label_list) bestAttr = attr_list[bestFeat_index] myTree = {bestAttr: {}} del(attr_list[bestFeat_index]) feat_set = set(sample_list[..., bestFeat_index]) # ä¾æ®æœ€ä¼˜åˆ’åˆ†å±æ€§è¿›è¡Œåˆ’åˆ†ï¼Œå¹¶å‘ä¸‹é€’å½’ for feat in feat_set: return_sample_list, return_label_list = splitDataSet(sample_list, label_list, bestFeat_index, feat) myTree[bestAttr][feat] = createTree(return_sample_list, return_label_list, attr_list) return myTree def voteLabel(label_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š è¿™ä¸ªå‡½æ•°æ˜¯ç”¨åœ¨éå†å®Œæ‰€æœ‰ç‰¹å¾æ—¶ï¼Œè¿”å›æœ€å¤šçš„ç±»åˆ« Parametersï¼š label_list: æ ‡è®°åˆ—è¡¨ Returnsï¼š æ•°é‡æœ€å¤šçš„æ ‡è®° \"\"\" # unique_label_list æ˜¯label_listä¸­æ ‡è®°ç§ç±»åˆ—è¡¨ # label_num æ˜¯unique_label_listå¯¹åº”çš„æ•°é‡åˆ—è¡¨ unique_label_list = list(set(label_list)) label_num_list = [] for label in unique_label_list: label_num_list.append(equalNums(label_list, label)) # label_num.index(max(label_num))æ˜¯label_numæ•°ç»„ä¸­æœ€å¤§å€¼çš„ä¸‹æ ‡ return unique_label_list[label_num_list.index(max(label_num_list))] def classify(decisionTree, testVec, attr_list): \"\"\" å‡½æ•°è¯´æ˜ï¼š å¯¹tesVecè¿›è¡Œåˆ†ç±» Parametersï¼š decisionTree - å†³ç­–æ ‘ attr_list - å±æ€§ååˆ—è¡¨ testVec - æµ‹è¯•å‘é‡ Returnsï¼š label - é¢„æµ‹çš„æ ‡è®° \"\"\" feature = list(decisionTree.keys())[0] # featureä¸ºå†³ç­–æ ‘çš„æ ¹èŠ‚ç‚¹ feature_dict = decisionTree[feature] # feature_dictä¸ºæ ¹èŠ‚ç‚¹ä¸‹çš„å­æ ‘ feature_index = attr_list.index(feature) # feature_indexä¸ºfeatur","date":"2022-08-21","objectID":"/%E5%86%B3%E7%AD%96%E6%A0%91/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","å†³ç­–æ ‘"],"title":"å†³ç­–æ ‘","uri":"/%E5%86%B3%E7%AD%96%E6%A0%91/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"åˆ†ç±»ç®—æ³• ä¸»è¦åŒºåˆ†ä¸€ä¸‹ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹ï¼Œé¦–å…ˆè¦çŸ¥é“ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹éƒ½å±äºç›‘ç£å­¦ä¹ ï¼Œå³æ ·æœ¬æœ‰å…¶å¯¹åº”çš„æ ‡ç­¾çš„ã€‚è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ç¡¬åˆ†ç±»å’Œè½¯åˆ†ç±»ï¼Œç®€å•ç†è§£å°±æ˜¯ç¡¬åˆ†ç±»æ˜¯ç›´æ¥åˆ†å‡ºç±»åˆ«ï¼Œæ¯”å¦‚çº¿æ€§åˆ¤åˆ«åˆ†æã€æ„ŸçŸ¥æœºã€‚è€Œè½¯åˆ†ç±»æ˜¯è®¡ç®—å‡ºæ¦‚ç‡ï¼Œæ ¹æ®æ¦‚ç‡æ¥å¾—åˆ°ç±»åˆ«ï¼Œç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹éƒ½æ˜¯è½¯åˆ†ç±»ã€‚ ","date":"2022-08-12","objectID":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","åˆ†ç±»ç®—æ³•æ¦‚è¿°"],"title":"åˆ†ç±»ç®—æ³•æ¦‚è¿°","uri":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ç”Ÿæˆæ¨¡å‹ å­¦ä¹ å¾—åˆ°è”åˆæ¦‚ç‡åˆ†å¸ƒ\\(P(x,y)\\)ï¼Œå³ç‰¹å¾xä¸æ ‡ç­¾yå…±åŒå‡ºç°çš„æ¦‚ç‡ï¼Œç„¶åæ±‚æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚èƒ½å¤Ÿå­¦ä¹ åˆ°æ•°æ®ç”Ÿæˆçš„æœºåˆ¶ã€‚é€šä¿—çš„è¯´å°±æ˜¯å¦‚æœæœ‰kç±»ï¼Œå°±å­¦ä¹ kä¸ªæ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼Œå¯¹äºæ ·æœ¬ï¼Œç®—å‡ºåœ¨æ¯ä¸ªæ¦‚ç‡å¯†åº¦åˆ†å¸ƒä¸‹çš„æ¦‚ç‡ï¼Œå“ªä¸ªæ¦‚ç‡å¤§å°±å±äºå“ªä¸€ç±»ã€‚ ç”Ÿæˆæ¨¡å‹è¦æ±‚çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ä¼°è®¡æ¦‚ç‡å¯†åº¦ã€‚ ## åˆ¤åˆ«æ¨¡å‹ å­¦ä¹ å¾—åˆ°æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ\\(P(y|x)\\)ï¼Œå³åœ¨ç‰¹å¾xå‡ºç°çš„æƒ…å†µä¸‹æ ‡è®°yå‡ºç°çš„æ¦‚ç‡ã€‚ åˆ¤åˆ«æ¨¡å‹å¯¹æ ·æœ¬çš„è¦æ±‚æ²¡æœ‰é‚£ä¹ˆå¤šã€‚ ","date":"2022-08-12","objectID":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","åˆ†ç±»ç®—æ³•æ¦‚è¿°"],"title":"åˆ†ç±»ç®—æ³•æ¦‚è¿°","uri":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ç†è§£ æ— è®ºæ˜¯ç”Ÿæˆè¿˜æ˜¯åˆ¤åˆ«æ¨¡å‹éƒ½æ˜¯æ¥æ±‚æœ‰ç›‘ç£æ¨¡å‹çš„ï¼Œç›®çš„æ˜¯é€šè¿‡åˆ†ç±»å‡½æ•°æˆ–è€…æ¡ä»¶æ¦‚ç‡å‡½æ•°è¿›è¡Œæ•°æ®åˆ†ç±»ã€‚ ç®—å‡ºå±äºæ­£è´Ÿæ ·æœ¬çš„æ¦‚ç‡å†äº’ç›¸å¯¹æ¯”çš„å°±æ˜¯ç”Ÿæˆæ¨¡å‹ï¼Œç›´æ¥å¾—åˆ°ç»“æœæ¦‚ç‡çš„å°±æ˜¯åˆ¤åˆ«æ¨¡å‹ï¼Œç”Ÿæˆæ¨¡å‹å¾—åˆ°åˆ†å¸ƒï¼Œåˆ¤åˆ«æ¨¡å‹å¾—åˆ°æœ€ä¼˜åˆ’åˆ†ã€‚ ç”Ÿæˆæ¨¡å‹å¯ä»¥å¾—åˆ°åˆ¤åˆ«æ¨¡å‹ï¼Œåä¹‹ä¸æˆç«‹ã€‚ ç”Ÿæˆæ¨¡å‹æ˜¯æ±‚è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œåˆ¤åˆ«æ¨¡å‹æ˜¯æ±‚æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚ ç”Ÿæˆæ–¹æ³•çš„å­¦ä¹ æ”¶æ•›é€Ÿåº¦æ›´å¿«ï¼Œå½“æ ·æœ¬å®¹é‡å¢åŠ çš„æ—¶å€™ï¼Œå­¦åˆ°çš„æ¨¡å‹å¯ä»¥æ›´å¿«çš„æ”¶æ•›äºçœŸå®æ¨¡å‹ã€‚ åˆ¤åˆ«å­¦ä¹ ä¸èƒ½åæ˜ è®­ç»ƒæ•°æ®æœ¬èº«çš„ç‰¹æ€§ï¼Œä½†å®ƒå¯»æ‰¾ä¸åŒç±»åˆ«ä¹‹é—´çš„æœ€ä¼˜åˆ†ç±»é¢ï¼Œåæ˜ çš„æ˜¯å¼‚ç±»æ•°æ®ä¹‹é—´çš„å·®å¼‚ï¼Œç›´æ¥é¢å¯¹é¢„æµ‹ï¼Œå¾€å¾€å­¦ä¹ çš„å‡†ç¡®ç‡é«˜äºç”Ÿæˆæ¨¡å‹ã€‚ ç®€å•çš„è¯´ï¼Œç”Ÿæˆæ¨¡å‹æ˜¯ä»å¤§é‡çš„æ•°æ®ä¸­æ‰¾è§„å¾‹ï¼Œå±äºç»Ÿè®¡å­¦ä¹ ï¼›è€Œåˆ¤åˆ«æ¨¡å‹åªå…³å¿ƒä¸åŒç±»å‹çš„æ•°æ®çš„å·®åˆ«ï¼Œåˆ©ç”¨å·®åˆ«æ¥åˆ†ç±»ã€‚ ","date":"2022-08-12","objectID":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","åˆ†ç±»ç®—æ³•æ¦‚è¿°"],"title":"åˆ†ç±»ç®—æ³•æ¦‚è¿°","uri":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ç”Ÿæˆå¼æ¨¡å‹ï¼š æœ´ç´ è´å¶æ–¯ æ··åˆé«˜æ–¯æ¨¡å‹ éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM) è´å¶æ–¯ç½‘ç»œ Sigmoid Belief Networks é©¬å°”ç§‘å¤«éšæœºåœº(Markov Random Fields) æ·±åº¦ä¿¡å¿µç½‘ç»œ(DBN) ","date":"2022-08-12","objectID":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/:2:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","åˆ†ç±»ç®—æ³•æ¦‚è¿°"],"title":"åˆ†ç±»ç®—æ³•æ¦‚è¿°","uri":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"åˆ¤åˆ«å¼æ¨¡å‹ Kè¿‘é‚»(KNN) çº¿æ€§å›å½’(Linear Regression) é€»è¾‘å›å½’(Logistic Regression) ç¥ç»ç½‘ç»œ(NN) æ”¯æŒå‘é‡æœº(SVM) é«˜æ–¯è¿‡ç¨‹(Gaussian Process) æ¡ä»¶éšæœºåœº(CRF) CART(Classification and Regression Tree) ","date":"2022-08-12","objectID":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/:2:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","åˆ†ç±»ç®—æ³•æ¦‚è¿°"],"title":"åˆ†ç±»ç®—æ³•æ¦‚è¿°","uri":"/%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0/"},{"categories":["NLP"],"content":"BM25ç®—æ³• BM25ç®—æ³•ï¼Œé€šå¸¸ç”¨æ¥ä½œæœç´¢ç›¸å…³æ€§å¹³åˆ†ã€‚ä¸€å¥è¯æ¦‚å†µå…¶ä¸»è¦æ€æƒ³ï¼šå¯¹Queryè¿›è¡Œè¯­ç´ è§£æï¼Œç”Ÿæˆè¯­ç´ qiï¼›ç„¶åï¼Œå¯¹äºæ¯ä¸ªæœç´¢ç»“æœDï¼Œè®¡ç®—æ¯ä¸ªè¯­ç´ qiä¸Dçš„ç›¸å…³æ€§å¾—åˆ†ï¼Œæœ€åï¼Œå°†qiç›¸å¯¹äºDçš„ç›¸å…³æ€§å¾—åˆ†è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œä»è€Œå¾—åˆ°Queryä¸Dçš„ç›¸å…³æ€§å¾—åˆ†ã€‚ ","date":"2022-08-07","objectID":"/bm25/:0:0","tags":["NLP","BM25"],"title":"BM25","uri":"/bm25/"},{"categories":["NLP"],"content":"åŸç† BM25ä¸€èˆ¬å…¬å¼å¦‚ä¸‹ï¼š \\[ score(Q,d) = \\sum_{i}^nW_iR(q_i, d) \\] å…¶ä¸­Qè¡¨ç¤ºä¸ºQueryï¼Œ\\(q_i\\)è¡¨ç¤ºQè§£æåçš„ä¸€ä¸ªè¯­ç´ (å¯¹ä¸­æ–‡è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¯¹Queryçš„åˆ†è¯ä½œä¸ºè¯­ç´ åˆ†æï¼Œæ¯ä¸ªè¯çœ‹æˆè¯­ç´ )ã€‚dè¡¨ç¤ºä¸€ä¸ªæœç´¢ç»“æœæ–‡æ¡£ï¼Œ\\(W_i\\)è¡¨ç¤ºè¯­ç´ \\(q_i\\)çš„æƒé‡ï¼Œ\\(R(q_i, d)\\)è¡¨ç¤ºè¯­ç´ \\(q_i\\)ä¸æ–‡æ¡£dçš„ç›¸å…³æ€§å¾—åˆ†ã€‚ ","date":"2022-08-07","objectID":"/bm25/:1:0","tags":["NLP","BM25"],"title":"BM25","uri":"/bm25/"},{"categories":["NLP"],"content":"æƒé‡ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹å¦‚ä½•å®šä¹‰Wiã€‚åˆ¤æ–­ä¸€ä¸ªè¯ä¸ä¸€ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§çš„æƒé‡ï¼Œæ–¹æ³•æœ‰å¤šç§ï¼Œè¾ƒå¸¸ç”¨çš„æ˜¯IDFã€‚è¿™é‡Œä»¥IDFä¸ºä¾‹ï¼Œå…¬å¼å¦‚ä¸‹ï¼š \\[ IDF(q_i) = \\log \\frac{N-n(q_i)+0.5}{n(q_i)+0.5} \\] å…¶ä¸­ï¼ŒNä¸ºç´¢å¼•ä¸­çš„å…¨éƒ¨æ–‡æ¡£æ•°ï¼Œn(qi)ä¸ºåŒ…å«äº†qiçš„æ–‡æ¡£æ•°ã€‚ æ ¹æ®IDFçš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºç»™å®šçš„æ–‡æ¡£é›†åˆï¼ŒåŒ…å«äº†qiçš„æ–‡æ¡£æ•°è¶Šå¤šï¼Œqiçš„æƒé‡åˆ™è¶Šä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¾ˆå¤šæ–‡æ¡£éƒ½åŒ…å«äº†qiæ—¶ï¼Œqiçš„åŒºåˆ†åº¦å°±ä¸é«˜ï¼Œå› æ­¤ä½¿ç”¨qiæ¥åˆ¤æ–­ç›¸å…³æ€§æ—¶çš„é‡è¦åº¦å°±è¾ƒä½ã€‚ ","date":"2022-08-07","objectID":"/bm25/:2:0","tags":["NLP","BM25"],"title":"BM25","uri":"/bm25/"},{"categories":["NLP"],"content":"ç›¸å…³æ€§å¾—åˆ† ä¸‹é¢å®šä¹‰ç›¸å…³æ€§å¾—åˆ†\\(R(q_i,d)\\) é¦–å…ˆæ¥çœ‹BM25ä¸­ç›¸å…³æ€§å¾—åˆ†çš„ä¸€èˆ¬å½¢å¼ï¼š å…¶ä¸­\\(k_1, k_2, b\\)ä¸ºè°ƒèŠ‚å› å­ï¼Œæ ¹æ®ç»éªŒè®¾ç½®ï¼Œä¸€èˆ¬\\(k_1=2,b=0.75\\) ï¼Œ\\(f_i\\)ä¸º\\(q_i\\)åœ¨æ–‡æ¡£dä¸­å‡ºç°çš„é¢‘ç‡ï¼Œ\\(qf_i\\)ä¸º\\(q_i\\)åœ¨Queryä¸­å‡ºç°çš„é¢‘ç‡ï¼Œdlä¸ºæ–‡æ¡£dçš„é•¿åº¦ï¼Œavgdlä¸ºæ‰€æœ‰æ–‡æ¡£çš„å¹³å‡é•¿åº¦ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹\\(q_i\\)åœ¨Queryä¸­åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œå› æ­¤ \\(qf_i=1\\)ï¼Œæ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºï¼š ä»Kçš„å®šä¹‰ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°bçš„ä½œç”¨æ˜¯è°ƒæ•´æ–‡æ¡£é•¿åº¦å¯¹ç›¸å…³æ€§å½±å“çš„å¤§å°ã€‚bè¶Šå¤§ï¼Œæ–‡æ¡£é•¿åº¦çš„å¯¹ç›¸å…³æ€§å¾—åˆ†çš„å½±å“è¶Šå¤§ï¼Œåä¹‹è¶Šå°ã€‚è€Œæ–‡æ¡£çš„ç›¸å¯¹é•¿åº¦è¶Šé•¿ï¼ŒKå€¼å°†è¶Šå¤§ï¼Œåˆ™ç›¸å…³æ€§å¾—åˆ†ä¼šè¶Šå°ã€‚è¿™å¯ä»¥ç†è§£ä¸ºï¼Œå½“æ–‡æ¡£è¾ƒé•¿æ—¶ï¼ŒåŒ…å«qiçš„æœºä¼šè¶Šå¤§ï¼Œå› æ­¤ï¼ŒåŒç­‰fiçš„æƒ…å†µä¸‹ï¼Œé•¿æ–‡æ¡£ä¸qiçš„ç›¸å…³æ€§åº”è¯¥æ¯”çŸ­æ–‡æ¡£ä¸qiçš„ç›¸å…³æ€§å¼±ã€‚ ç»¼ä¸Šï¼ŒBM25ç®—æ³•çš„ç›¸å…³æ€§å¾—åˆ†å…¬å¼å¯æ€»ç»“ä¸ºï¼š ä»BM25çš„å…¬å¼å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„è¯­ç´ åˆ†ææ–¹æ³•ã€è¯­ç´ æƒé‡åˆ¤å®šæ–¹æ³•ï¼Œä»¥åŠè¯­ç´ ä¸æ–‡æ¡£çš„ç›¸å…³æ€§åˆ¤å®šæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¡ç”Ÿå‡ºä¸åŒçš„æœç´¢ç›¸å…³æ€§å¾—åˆ†è®¡ç®—æ–¹æ³•ï¼Œè¿™å°±ä¸ºæˆ‘ä»¬è®¾è®¡ç®—æ³•æä¾›äº†è¾ƒå¤§çš„çµæ´»æ€§ã€‚ ","date":"2022-08-07","objectID":"/bm25/:3:0","tags":["NLP","BM25"],"title":"BM25","uri":"/bm25/"},{"categories":["NLP"],"content":"ä»£ç  import math import jieba import re text = ''' è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯è®¡ç®—æœºç§‘å­¦é¢†åŸŸä¸äººå·¥æ™ºèƒ½é¢†åŸŸä¸­çš„ä¸€ä¸ªé‡è¦æ–¹å‘ã€‚ å®ƒç ”ç©¶èƒ½å®ç°äººä¸è®¡ç®—æœºä¹‹é—´ç”¨è‡ªç„¶è¯­è¨€è¿›è¡Œæœ‰æ•ˆé€šä¿¡çš„å„ç§ç†è®ºå’Œæ–¹æ³•ã€‚ è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯ä¸€é—¨èè¯­è¨€å­¦ã€è®¡ç®—æœºç§‘å­¦ã€æ•°å­¦äºä¸€ä½“çš„ç§‘å­¦ã€‚ å› æ­¤ï¼Œè¿™ä¸€é¢†åŸŸçš„ç ”ç©¶å°†æ¶‰åŠè‡ªç„¶è¯­è¨€ï¼Œå³äººä»¬æ—¥å¸¸ä½¿ç”¨çš„è¯­è¨€ï¼Œ æ‰€ä»¥å®ƒä¸è¯­è¨€å­¦çš„ç ”ç©¶æœ‰ç€å¯†åˆ‡çš„è”ç³»ï¼Œä½†åˆæœ‰é‡è¦çš„åŒºåˆ«ã€‚ è‡ªç„¶è¯­è¨€å¤„ç†å¹¶ä¸æ˜¯ä¸€èˆ¬åœ°ç ”ç©¶è‡ªç„¶è¯­è¨€ï¼Œ è€Œåœ¨äºç ”åˆ¶èƒ½æœ‰æ•ˆåœ°å®ç°è‡ªç„¶è¯­è¨€é€šä¿¡çš„è®¡ç®—æœºç³»ç»Ÿï¼Œ ç‰¹åˆ«æ˜¯å…¶ä¸­çš„è½¯ä»¶ç³»ç»Ÿã€‚å› è€Œå®ƒæ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€éƒ¨åˆ†ã€‚ ''' class BM25(object): def __init__(self, docs): self.D = len(docs) # docä¸ªæ•° self.avgdl = sum([len(doc)+0.0 for doc in docs]) / self.D # æ¯ç¯‡å¹³å‡é•¿åº¦ self.docs = docs self.f = [] # åˆ—è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªdictï¼Œdictå­˜å‚¨ç€ä¸€ä¸ªæ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„å‡ºç°æ¬¡æ•° self.df = {} # å­˜å‚¨æ¯ä¸ªè¯åŠå‡ºç°äº†è¯¥è¯çš„æ–‡æ¡£æ•°é‡(count) self.idf = {} # å­˜å‚¨æ¯ä¸ªè¯çš„idfå€¼ï¼Œå½“ä½œæƒé‡ self.k1 = 1.5 self.b = 0.75 self.init() def init(self): for doc in self.docs: tmp = {} for word in doc: tmp[word] = tmp.get(word, 0) + 1 # å­˜å‚¨æ¯ä¸ªæ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„å‡ºç°æ¬¡æ•°ï¼ˆä¹Ÿå¯ä»¥ç”¨defaultdict) self.f.append(tmp) # idxä¸ºç´¢å¼•ï¼Œf[idx]ä¸ºä¸€ä¸ªdictï¼Œdictå­˜å‚¨ç€ç¬¬idx+1ä¸ªæ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„å‡ºç°æ¬¡æ•°,idxä»£è¡¨ç¬¬å‡ ä¸ªæ–‡æ¡£ã€‚ for k in tmp.keys(): # å¦‚æœè¯kå‡ºç°åœ¨äº†å½“å‰æ–‡æ¡£ä¸­ï¼Œåˆ™df[k]å³æ–‡æ¡£æ•°é‡åŠ 1 self.df[k] = self.df.get(k, 0) + 1 for k, v in self.df.items(): self.idf[k] = math.log(self.D-v+0.5)-math.log(v+0.5) # è®¡ç®—idf def sim(self, query, index): # ä¸å•ä¸ªæ–‡æ¡£çš„ç›¸ä¼¼åº¦ score = 0 for word in query: if word not in self.f[index]: continue d = len(self.docs[index]) # å½“å‰æ–‡æ¡£çš„é•¿åº¦ score += (self.idf[word]*(self.f[index][word]/d)*(self.k1+1) / ((self.f[index][word]/d)+self.k1*(1-self.b+self.b*d / self.avgdl))) return score def simall(self, query): scores = [] for index in range(self.D): score = self.sim(query, index) scores.append(score) return scores def get_sentences(doc): line_break = re.compile('[\\r\\n]') # ä»¥æ¢è¡Œç¬¦åˆ†å‰² delimiter = re.compile('[ï¼Œã€‚ï¼Ÿï¼ï¼›]') # ä»¥ä¸­æ–‡æ ‡ç‚¹ç¬¦å·åˆ†å‰² sentences = [] for line in line_break.split(doc): line = line.strip() if not line: continue for sent in delimiter.split(line): sent = sent.strip() if not sent: continue sentences.append(sent) return sentences if __name__ == '__main__': sents = get_sentences(text) print(sents) doc = [] for sent in sents: words = list(jieba.cut(sent)) doc.append(words) # print(doc) s = BM25(doc) # print(s.f) # print(s.df) # print(s.idf) print(s.simall(['è‡ªç„¶è¯­è¨€', 'è®¡ç®—æœºç§‘å­¦', 'é¢†åŸŸ', 'äººå·¥æ™ºèƒ½', 'é¢†åŸŸ'])) ","date":"2022-08-07","objectID":"/bm25/:4:0","tags":["NLP","BM25"],"title":"BM25","uri":"/bm25/"},{"categories":["NLP"],"content":"GPT ","date":"2022-07-27","objectID":"/gpt/:0:0","tags":["NLP","GPT"],"title":"GPT","uri":"/gpt/"},{"categories":["NLP"],"content":"é¢„è®­ç»ƒ(ä»å·¦åˆ°å³çš„ Transformer è¯­è¨€æ¨¡å‹) GPT æ˜¯ä¸€ç§åŸºäº Transformer çš„ä»å·¦åˆ°å³çš„è¯­è¨€æ¨¡å‹ã€‚è¯¥æ¶æ„æ˜¯ä¸€ä¸ª 12 å±‚çš„ Transformer è§£ç å™¨ï¼ˆæ²¡æœ‰è§£ç å™¨-ç¼–ç å™¨ï¼‰ã€‚ ## æ¨¡å‹æ¶æ„ å°±æ˜¯12å±‚çš„transformer-decoderã€‚å…¶ä¸­åªä½¿ç”¨äº†transformeræ¨¡å‹ä¸­çš„decoderéƒ¨åˆ†ï¼Œå¹¶ä¸”æŠŠdecoderé‡Œé¢çš„encoder-decoder attentionéƒ¨åˆ†å»æ‰äº†ï¼Œåªä¿ç•™äº†masked self-attentionï¼Œå†åŠ ä¸Šfeed-forwardéƒ¨åˆ†ã€‚å†æä¸€å¥ï¼Œmasked self-attentionä¿è¯äº†GPTæ¨¡å‹æ˜¯ä¸€ä¸ªå•å‘çš„è¯­è¨€æ¨¡å‹ã€‚ å¦å¤–ï¼Œä½œè€…åœ¨position encodingä¸Šåšäº†è°ƒæ•´ï¼Œä½¿ç”¨äº†å¯å­¦ä¹ çš„ä½ç½®ç¼–ç ï¼Œä¸åŒäºtransformerçš„ä¸‰è§’å‡½æ•°ä½ç½®ç¼–ç ã€‚ ","date":"2022-07-27","objectID":"/gpt/:1:0","tags":["NLP","GPT"],"title":"GPT","uri":"/gpt/"},{"categories":["NLP"],"content":"å¾®è°ƒï¼šå°† GPT ç”¨äºä¸‹æ¸¸ä»»åŠ¡ å¾®è°ƒæŸå¤±åŒ…æ‹¬ç‰¹å®šäºä»»åŠ¡çš„æŸå¤±ä»¥åŠè¯­è¨€å»ºæ¨¡æŸå¤±ï¼š \\[ L = L_{xent} + \\lambda \\cdot L_{task}. \\] ","date":"2022-07-27","objectID":"/gpt/:2:0","tags":["NLP","GPT"],"title":"GPT","uri":"/gpt/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"Dropout åœ¨æ ‡å‡†dropoutæ­£åˆ™åŒ–ä¸­ï¼Œé€šè¿‡æŒ‰ä¿ç•™ï¼ˆæœªä¸¢å¼ƒï¼‰çš„èŠ‚ç‚¹çš„åˆ†æ•°è¿›è¡Œå½’ä¸€åŒ–æ¥æ¶ˆé™¤æ¯ä¸€å±‚çš„åå·®ã€‚æ¢è¨€ä¹‹ï¼Œæ¯ä¸ªä¸­é—´æ¿€æ´»å€¼hä»¥ä¿ç•™æ¦‚ç‡æ¦‚ç‡pç”±éšæœºå˜é‡æ›¿æ¢(å³dropç»è¿‡ç¥ç»å…ƒåçš„å€¼ä»£æ›¿dropç¥ç»å…ƒ) \\[ h^{'}= \\begin{cases} 0, \\quad æ¦‚ç‡ä¸º1-p \\\\\\\\ \\frac{h}{p}, \\quad æ¦‚ç‡ä¸ºp \\end{cases} \\] æ³¨æ„æœŸæœ›ä¸è¦å˜ï¼Œå³ \\[ E[h^{'}] = (1-p)*0 + p *\\frac{h}{p} = h \\] ä¹Ÿå¯ä»¥è®­ç»ƒæ—¶éä¸¢å¼ƒå•å…ƒä¸é™¤ä»¥æ¦‚ç‡pï¼Œè€Œæ˜¯æµ‹è¯•æ—¶æ¨¡å‹å‚æ•°ä¹˜ä»¥pï¼Œè¿™æ ·å¯ä»¥ä¿è¯è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æœŸæœ›ç›¸åŒã€‚å’Œä¸Šé¢çš„æ•ˆæœç›¸åŒã€‚ æ³¨æ„ï¼šæ­£åˆ™é¡¹ï¼ˆDropoutï¼‰åªåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå…¶ä¼šå½±å“æ¨¡å‹å‚æ•°çš„æ›´æ–° æ‰€ä»¥åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œä¸¢å¼ƒæ³•ç›´æ¥è¿”å›è¾“å…¥ã€‚ ","date":"2022-07-21","objectID":"/dropout%E6%AD%A3%E5%88%99%E5%8C%96/:0:0","tags":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–","Dropoutæ­£åˆ™åŒ–"],"title":"Dropoutæ­£åˆ™åŒ–","uri":"/dropout%E6%AD%A3%E5%88%99%E5%8C%96/"},{"categories":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–"],"content":"ä»£ç  import torch from torch import nn from d2l import torch as d2l import torchvision from torchvision import transforms from torch.utils import data def dropout_layer(X,dropout): assert 0\u003c=dropout \u003c= 1 # å¦‚æœkeep_probè®¾ç½®ä¸º1ï¼Œå…¨éƒ¨å…ƒç´ è¢«ä¿ç•™ if dropout == 1: return X # å¦‚æœkeep_probè®¾ç½®ä¸º0ï¼Œå…¨éƒ¨å…ƒç´ è¢«ä¸¢å¼ƒ if dropout == 0: return torch.zeros_like(X) mask = (torch.rand(X.shape) \u003c dropout).float() #ä½¿ç”¨maskè€Œä¸æ˜¯ç›´æ¥ç½®é›¶æ˜¯ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ return mask * X/(dropout) ","date":"2022-07-21","objectID":"/dropout%E6%AD%A3%E5%88%99%E5%8C%96/:1:0","tags":["Deep Learning","ç½‘ç»œæ­£åˆ™åŒ–","Dropoutæ­£åˆ™åŒ–"],"title":"Dropoutæ­£åˆ™åŒ–","uri":"/dropout%E6%AD%A3%E5%88%99%E5%8C%96/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ€é•¿å›æ–‡å­ä¸² ","date":"2022-07-21","objectID":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/:0:0","tags":["ç®—æ³•é¢˜","æœ€é•¿å›æ–‡å­ä¸²"],"title":"æœ€é•¿å›æ–‡å­ä¸²","uri":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š â€‹ https://leetcode-cn.com/problems/longest-palindromic-substring/ ","date":"2022-07-21","objectID":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/:1:0","tags":["ç®—æ³•é¢˜","æœ€é•¿å›æ–‡å­ä¸²"],"title":"æœ€é•¿å›æ–‡å­ä¸²","uri":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ ä¸€å¼€å§‹æš´åŠ›è§£æ³•ï¼Œæ¯”è¾ƒå¥½æƒ³ï¼Œç»“æœè¶…æ—¶äº†å“ï¼Œåæ¥çœ‹è§äº†æ ‡ç­¾æ˜¯åŠ¨æ€è§„åˆ’ï¼Œæ‰çŸ¥é“ä¸èƒ½æš´åŠ› class Solution: def longestPalindrome(self, s: str) -\u003e str: if len(s) \u003c= 1: return s maxs = -float(\"inf\") res = collections.defaultdict(list) left,right = 0,len(s)-1 while left \u003c right: for i in range(left,right+2): if s[left:i] == s[left:i][::-1]: maxs = max(maxs,len(s[left:i])) res[maxs].append(s[left:i]) left += 1 return max(res[max(res.keys())],key=len) ä¹Ÿç”¨åˆ°äº†åŒæŒ‡é’ˆï¼Œè¶…æ—¶åœ¨æƒ…ç†ä¹‹ä¸­ã€‚ åæ¥ç”¨åˆ°äº†åŠ¨æ€è§„åˆ’ class Solution: def longestPalindrome(self, s: str) -\u003e str: if len(s) \u003c= 1: return s length = len(s) dp = [[False for _ in range(length)] for _ in range(length)] for i in range(length): dp[i][i] = True start = 0 max_len = 1 for j in range(1, length): for i in range(0, j): if s[i] == s[j]: if j - i \u003c 3: dp[i][j] = True else: dp[i][j] = dp[i + 1][j - 1] else: dp[i][j] = False if dp[i][j]: cur_len = j - i + 1 if cur_len \u003e max_len: max_len = cur_len start = i return s[start:start + max_len] ","date":"2022-07-21","objectID":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/:2:0","tags":["ç®—æ³•é¢˜","æœ€é•¿å›æ–‡å­ä¸²"],"title":"æœ€é•¿å›æ–‡å­ä¸²","uri":"/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ‰æ•ˆçš„æ•°ç‹¬ https://leetcode-cn.com/problems/valid-sudoku/ #æœ‰æ•ˆçš„æ•°ç‹¬ éš¾ç‚¹åœ¨å°†3*3é‡Œçš„æ•°å–å‡ºæ¥ class Solution: def isValidSudoku(board) -\u003e bool: for line1,line2 in zip(board,zip(*board)): #è¡Œåˆ— for n1,n2 in zip(line1,line2): if (n1 != '.' and line1.count(n1) \u003e 1) or (n2!='.' and line2.count(n2) \u003e1): return False pal = [[board[i+m][j+n] for m in range(3) for n in range(3) if board[i+m][j+n] != '.'] for i in (0, 3, 6) for j in (0, 3, 6)] for line in pal: if len(set(line)) != len(line): return False return True ","date":"2022-07-20","objectID":"/%E6%9C%89%E6%95%88%E7%9A%84%E6%95%B0%E7%8B%AC/:0:0","tags":["ç®—æ³•é¢˜","æœ‰æ•ˆçš„æ•°ç‹¬"],"title":"æœ‰æ•ˆçš„æ•°ç‹¬","uri":"/%E6%9C%89%E6%95%88%E7%9A%84%E6%95%B0%E7%8B%AC/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ  ","date":"2022-07-17","objectID":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/:0:0","tags":["ç®—æ³•é¢˜","ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ "],"title":"ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ ","uri":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/minimum-add-to-make-parentheses-valid/ ","date":"2022-07-17","objectID":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/:1:0","tags":["ç®—æ³•é¢˜","ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ "],"title":"ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ ","uri":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š é€šè¿‡ä¸€ä¸ªå€¼æ¥åˆ¤æ–­æ˜¯å¦åŒ¹é… ","date":"2022-07-17","objectID":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/:2:0","tags":["ç®—æ³•é¢˜","ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ "],"title":"ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ ","uri":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def minAddToMakeValid(self, S: str) -\u003e int: res,temp = 0,0 for i in S: if i == '(': temp += 1 if i == ')': temp -= 1 if temp == -1: temp = 0 res += 1 return res + temp å¦‚æœå³æ‹¬å·è¿‡å¤šçš„è¯ï¼Œå°±åœ¨å·¦è¾¹è¡¥ä¸€ä¸ªå·¦æ‹¬å·ã€‚è¿™æ—¶ç»“æœ+1 å¦‚æœä¸€ç›´æ˜¯å·¦æ‹¬å·çš„è¯ï¼Œres ä¸º0 tempå°±æ˜¯åº”è¯¥è¡¥çš„ä¸ªæ•° å¦‚æœéƒ½ç›¸åŒ¹é…çš„è¯ï¼Œtemp = 0 ç›¸åº” resä¹Ÿä¸º0 ","date":"2022-07-17","objectID":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/:3:0","tags":["ç®—æ³•é¢˜","ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ "],"title":"ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ ","uri":"/%E4%BD%BF%E6%8B%AC%E5%8F%B7%E6%9C%89%E6%95%88%E7%9A%84%E6%9C%80%E5%B0%91%E6%B7%BB%E5%8A%A0/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"é›†æˆå­¦ä¹  åœ¨æœºå™¨å­¦ä¹ çš„æœ‰ç›‘ç£å­¦ä¹ ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ å‡ºä¸€ä¸ªç¨³å®šçš„ä¸”åœ¨å„ä¸ªæ–¹é¢è¡¨ç°éƒ½è¾ƒå¥½çš„æ¨¡å‹ï¼Œä½†å®é™…æƒ…å†µå¾€å¾€ä¸è¿™ä¹ˆç†æƒ³ï¼Œæœ‰æ—¶æˆ‘ä»¬åªèƒ½å¾—åˆ°å¤šä¸ªæœ‰åå¥½çš„æ¨¡å‹ï¼ˆå¼±ç›‘ç£æ¨¡å‹ï¼Œåœ¨æŸäº›æ–¹é¢è¡¨ç°çš„æ¯”è¾ƒå¥½ï¼‰ã€‚é›†æˆå­¦ä¹ å°±æ˜¯ç»„åˆè¿™é‡Œçš„å¤šä¸ªå¼±ç›‘ç£æ¨¡å‹ä»¥æœŸå¾—åˆ°ä¸€ä¸ªæ›´å¥½æ›´å…¨é¢çš„å¼ºç›‘ç£æ¨¡å‹ï¼Œé›†æˆå­¦ä¹ æ½œåœ¨çš„æ€æƒ³æ˜¯å³ä¾¿æŸä¸€ä¸ªå¼±åˆ†ç±»å™¨å¾—åˆ°äº†é”™è¯¯çš„é¢„æµ‹ï¼Œå…¶ä»–çš„å¼±åˆ†ç±»å™¨ä¹Ÿå¯ä»¥å°†é”™è¯¯çº æ­£å›æ¥ã€‚ é›†æˆå­¦ä¹ åœ¨å„ä¸ªè§„æ¨¡çš„æ•°æ®é›†ä¸Šéƒ½æœ‰å¾ˆå¥½çš„ç­–ç•¥ã€‚ æ•°æ®é›†å¤§ï¼šåˆ’åˆ†æˆå¤šä¸ªå°æ•°æ®é›†ï¼Œå­¦ä¹ å¤šä¸ªæ¨¡å‹è¿›è¡Œç»„åˆ æ•°æ®é›†å°ï¼šåˆ©ç”¨Bootstrapæ–¹æ³•è¿›è¡ŒæŠ½æ ·ï¼Œå¾—åˆ°å¤šä¸ªæ•°æ®é›†ï¼Œåˆ†åˆ«è®­ç»ƒå¤šä¸ªæ¨¡å‹å†è¿›è¡Œç»„åˆ é›†æˆå­¦ä¹ ä¸»è¦æœ‰ä¸¤ç±»ï¼š 1. Bagging Boosting Baggingç®—æ³•æ˜¯è¿™æ ·åšçš„ï¼šæ¯ä¸ªåˆ†ç±»å™¨éƒ½éšæœºä»åŸæ ·æœ¬ä¸­åšæœ‰æ”¾å›çš„é‡‡æ ·ï¼Œç„¶ååˆ†åˆ«åœ¨è¿™äº›é‡‡æ ·åçš„æ ·æœ¬ä¸Šè®­ç»ƒåˆ†ç±»å™¨ï¼Œç„¶åå†æŠŠè¿™äº›åˆ†ç±»å™¨ç»„åˆèµ·æ¥ã€‚ç®€å•çš„å¤šæ•°æŠ•ç¥¨ä¸€èˆ¬å°±å¯ä»¥ã€‚å…¶ä»£è¡¨ç®—æ³•æ˜¯éšæœºæ£®æ—ã€‚ Boostingçš„æ„æ€æ˜¯è¿™æ ·ï¼Œä»–é€šè¿‡è¿­ä»£åœ°è®­ç»ƒä¸€ç³»åˆ—çš„åˆ†ç±»å™¨ï¼Œæ¯ä¸ªåˆ†ç±»å™¨é‡‡ç”¨çš„æ ·æœ¬åˆ†å¸ƒéƒ½å’Œä¸Šä¸€è½®çš„å­¦ä¹ ç»“æœæœ‰å…³ã€‚å…¶ä»£è¡¨ç®—æ³•æ˜¯AdaBoost, GBDTã€‚ ","date":"2022-07-09","objectID":"/ensemble-learning/:0:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Ensemble Learning"],"title":"Ensemble Learning","uri":"/ensemble-learning/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"Bagging baggingçš„åç§°æ¥æºäº ï¼ˆ Bootstrap Aggregating ï¼‰ï¼Œæ„æ€æ˜¯è‡ªåŠ©æŠ½æ ·é›†æˆï¼Œè¿™ç§æ–¹æ³•å°†è®­ç»ƒé›†åˆ†æˆmä¸ªæ–°çš„è®­ç»ƒé›†ï¼Œç„¶ååœ¨æ¯ä¸ªæ–°è®­ç»ƒé›†ä¸Šæ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œå„è‡ªä¸ç›¸å¹²ï¼Œæœ€åé¢„æµ‹æ—¶æˆ‘ä»¬å°†è¿™ä¸ªmä¸ªæ¨¡å‹çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œå¾—åˆ°æœ€ç»ˆç»“æœã€‚æ•´åˆæ–¹å¼å°±æ˜¯ï¼šåˆ†ç±»é—®é¢˜ç”¨majority votingï¼Œå›å½’ç”¨å‡å€¼ã€‚ å› æ­¤Baggingä½¿ç”¨çš„æŠ½æ ·æ–¹æ³•æ˜¯Bootstrapæ–¹æ³•ï¼Œå³è‡ªåŠ©æ³•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæœ‰æ”¾å›çš„éšæœºæŠ½æ ·é—®é¢˜ã€‚ æ¯ä¸€ä¸ªæ ·æœ¬åœ¨æ¯ä¸€æ¬¡æŠ½çš„æ—¶å€™æœ‰åŒæ ·çš„æ¦‚ç‡\\(\\frac{1}{N}\\)è¢«æŠ½ä¸­ã€‚æ²¡è¢«æŠ½ä¸­çš„æ¦‚ç‡ä¸º\\(1-\\frac{1}{N}\\)ï¼Œä¸€å…±æŠ½äº†Næ¬¡ï¼Œå³\\(1-(\\frac{1}{N})^N\\)å½“Nè¶‹äºæ— ç©·æ—¶ï¼Œç”±é«˜ç­‰æ•°å­¦å­¦çš„æé™çš„æ±‚è§£å¯ä»¥ç®—å‡ºæ¥æ˜¯\\(\\frac{1}{e}\\)ï¼Œå¤§æ¦‚ä¸º36.8%ï¼Œè¿™äº›ç•™ä¸‹æ¥çš„1/3çš„æ ·æœ¬å¯ä»¥ä½œä¸ºéªŒè¯é›†ï¼Œè¿™æ ·çš„æ–¹å¼å«åšåŒ…å¤–ä¼°è®¡(out of bag estimate) ","date":"2022-07-09","objectID":"/ensemble-learning/:1:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Ensemble Learning"],"title":"Ensemble Learning","uri":"/ensemble-learning/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"Boosting Boostingä¸Baggingçš„åŒºåˆ«å°±æ˜¯å–æ ·æ–¹å¼ä¸åŒï¼ŒBaggingé‡‡ç”¨å‡åŒ€å–æ ·ï¼Œè€ŒBoostingæ ¹æ®é”™è¯¯ç‡æ¥å–æ ·ï¼Œå› æ­¤Boostingçš„åˆ†ç±»ç²¾åº¦è¦ä¼˜äºBaggingã€‚ã€‚Baggingçš„è®­ç»ƒé›†çš„é€‰æ‹©æ˜¯éšæœºçš„ï¼Œå„è½®è®­ç»ƒé›†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œè€ŒBoostlngçš„å„è½®è®­ç»ƒé›†çš„é€‰æ‹©ä¸å‰é¢å„è½®çš„å­¦ä¹ ç»“æœæœ‰å…³ï¼›Baggingçš„å„ä¸ªé¢„æµ‹å‡½æ•°æ²¡æœ‰æƒé‡ï¼Œè€ŒBoostingæ˜¯æœ‰æƒé‡çš„ï¼›Baggingçš„å„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆï¼Œè€ŒBoostingçš„å„ä¸ªé¢„æµ‹å‡½æ•°åªèƒ½é¡ºåºç”Ÿæˆã€‚å¯¹äºè±¡ç¥ç»ç½‘ç»œè¿™æ ·æä¸ºè€—æ—¶çš„å­¦ä¹ æ–¹æ³•ã€‚Baggingå¯é€šè¿‡å¹¶è¡Œè®­ç»ƒèŠ‚çœå¤§é‡æ—¶é—´å¼€é”€ã€‚å¾ˆå¥½ç†è§£å§ã€‚ ","date":"2022-07-09","objectID":"/ensemble-learning/:2:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Ensemble Learning"],"title":"Ensemble Learning","uri":"/ensemble-learning/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"ä¸€ä¸ªæ•…äº‹ ä¸€ä¸ªæ•…äº‹ç”¨äºç†è§£ï¼Œæ¥æºï¼šhttps://www.joinquant.com/view/community/detail/adfb5ce37f0b39e348aae32e8412c68c æœ‰ä¸€ä¸ªåŒ»å­¦ä¸“ï¼ˆç –ï¼‰å®¶ï¼Œä»–çœ‹è¿‡å¾ˆå¤šå¾ˆå¤šç—…äººï¼Œè¿˜è®°äº†å°æœ¬æœ¬æ¥å½’ç±»è¿™äº›ç—…äººçš„ç‰¹å¾å’Œç—…æƒ…æ¥æ–¹ä¾¿ä»¥åè¯Šæ–­ã€‚æœ‰ä¸€å¤©æ¥äº†ä¸ªç—…äººï¼Œè¿™ä¸ªä¸“å®¶å°±é—®ç—…äººäº†ï¼Œâ€œå¤§çˆ·æ‚¨è´µå§“ï¼Ÿå¤šå°‘å²ï¼Œå“ªä¸èˆ’æœï¼Œç—…æƒ…æ€ä¹ˆæ ·ï¼Ÿâ€å¤§çˆ·è¯´ â€œæˆ‘å§“æï¼Œ48ï¼Œæœ€è¿‘è€åç—°ï¼Œè€å’³å—½ï¼Œè¿˜å‘çƒ§â€¦â€ã€‚è¿™ä¸ªä¸“å®¶æ‹¿å‡ºä»–çš„å°æœ¬æœ¬ä¸€æŸ¥â€œâ€å±æ€§ï¼šâ€œå§“æâ€ï¼Œâ€œå¹´é¾„48â€ï¼Œâ€œåç—°â€ï¼Œâ€œå’³å—½â€ï¼Œâ€œå‘çƒ§â€â€¦,æ ¹æ®æˆ‘çš„å°æœ¬æœ¬ä»¥å‰è¿™æ ·çš„ç—…ä¾‹æœ‰80ä¸ªï¼Œæœ‰76ä¸ªæ˜¯æ„Ÿå†’ï¼Œæˆï¼Œå°±è¯Šæ–­ä»–æ˜¯æ„Ÿå†’äº†ï¼â€è¿™ä¸ªä¸“å®¶å°±æ˜¯æ£µå†³ç­–æ ‘ é•œå¤´ä¸€è½¬ï¼Œæ¥åˆ°åŒ»é™¢Aï¼ŒåŒæ ·çš„ç—…äººæ¥åŒ»é™¢Aæ²»ç—…ã€‚åŒ»é™¢æœ‰å¾ˆå¤§çš„ç—…ä¾‹æ•°æ®åº“ï¼Œæœ‰100ä¸ªåŒ»å­¦ä¸“å®¶é€šè¿‡å­¦ä¹ æ•°æ®åº“çš„ä¸€éƒ¨åˆ†çŸ¥è¯†å½¢æˆäº†è‡ªå·±çš„è¯Šæ–­æ–¹æ¡ˆã€‚åŒ»é™¢æƒ³ï¼šâ€œæˆ‘è´¢å¤§æ°”ç²—ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„åŒ»ç–—æœåŠ¡ï¼Œæˆ‘è®©100ä¸ªä¸“å®¶åšè¯Šæ–­ï¼Œç„¶åä»–ä»¬æŠ•ç¥¨å†³å‡ºæœ€åçš„åˆ¤æ–­â€ã€‚ éšæœºæ£®æ— å®Œæˆ åŒ»é™¢Bå°±ä¸çˆ½äº†ï¼Œä½ è¿™æ²»ç–—æ–¹æ¡ˆå¤ªå—æ¬¢è¿ï¼ŒæŠŠå®¢æˆ·éƒ½æŠ¢èµ°äº†ï¼Œæˆ‘è¦ç”¨ç§‘å­¦çš„æ²»ç–—æ–¹æ¡ˆæ¥å‡»è´¥ä½ ã€‚åŒ»é™¢Bæƒ³äº†æƒ³ï¼Œå¤§å®¶æŠ•ç¥¨ä¸ä¸€å®šé’ˆå¯¹åˆ°ç”¨æˆ·æƒ…å†µï¼Œæˆ‘å…ˆä»æˆ‘çš„100ä¸ªä¸“å®¶é‡Œæ‰¾ä¸€ä¸ªæœ€å¥½çš„å…ˆç»™ç—…äººåšä¸€ä¸ªè¯Šç–—æ–¹æ¡ˆï¼Œå†æ ¹æ®ç¬¬ä¸€ä¸ªä¸“å®¶çš„ä¸è¶³æ‰¾ç¬¬äºŒä¸ªï¼Œæ ¹æ®ç¬¬äºŒä¸ªå†æ‰¾ç¬¬ä¸‰ä¸ªâ€¦â€¦ æœ€åä¸åŒä¸“å®¶å†æ ¹æ®ä»–ä»¬è¯Šæ–­çš„è¡¨ç°ä»¥ä¸åŒæƒé‡æŠ•ç¥¨ã€‚è¿™æ ·å²‚ä¸æ˜¯æ›´é’ˆå¯¹ç—…äººç—›ç‚¹ï¼Ÿ Boosting æ–¹æ³•å°±è¢«è¿™ç¾¤äººå»ºç«‹èµ·æ¥äº† åˆ°äº†åŒ»é™¢Cæƒ³æå·®å¼‚åŒ–ï¼Œä½ åŒ»é™¢Bæ ¹æ®ä¸Šä¸€ä¸ªä¸“å®¶çš„å…¨éƒ¨ä¸è¶³æ‰¾æ–°ä¸“å®¶ï¼Œé‚£æˆ‘å°±æ ¹æ®ä¸Šä¸€ä¸ªä¸“å®¶åˆ¤æ–­æœ€åé¢‡çš„æ–¹å‘æ‰¾ä¸“å®¶ï¼Œè™½ç„¶å¬èµ·æ¥å·®ä¸å¤šï¼Œä½†æˆ‘çš„å·®å¼‚åŒ–è¯´ä¸å®šå°±èƒ½æ›´å¥½ã€‚ Gradient Boosting äº§ç”Ÿäº† æ›´åŠ è´¢å¤§æ°”ç²—çš„åŒ»é™¢Dæ¥äº†ï¼Œä»–è§‰å¾—è™½ç„¶æ•´ä¸ªå¸‚åœºçš„å¤§æ ¼è°ƒåŸºæœ¬ç¡®å®šï¼Œä½†æˆ‘å¯ä»¥é€šè¿‡æå‡æ•´ä¸ªè¯Šç–—çš„æµç¨‹å¤§å¤§å°å°çš„ç»†èŠ‚æ¥å–èƒœå•Šï¼äºæ˜¯åŒ»é™¢Dåœ¨Cçš„åŸºç¡€ä¸Šæ”¹è¿›äº†å¾ˆå¤šï¼Œäºæ˜¯æ‰¾åé¢‡çš„æ–¹å‘æ›´å¿«æ›´å‡†ï¼Œçº ç»“ä¸“å®¶ï¼Œè¯Šç–—çš„é€Ÿåº¦ä¹Ÿå¤§å¤§åŠ å¿«ï¼Œæ•´ä¸ªåŒ»é™¢çš„ç¡¬ä»¶è®¾æ–½ä¹Ÿå‰æ‰€æœªæœ‰çš„æé«˜ã€‚è¿™å·®ä¸å¤šå°±æ˜¯ XGBoost äº† çªç„¶æœ‰è‚¡å«å¤§æ•°æ®çš„æ½®æµå¹æ¥ï¼Œæœ¬æ¥åŒ»é™¢Då·²ç»åœ¨åŒ»é™¢Cä¸€åˆ†é’Ÿæ²»ç–—10000äººçš„åŸºç¡€ä¸Šæå‡äº†10å¤šå€é€Ÿåº¦ï¼Œä½†æ–°çš„è¦æ±‚æ˜¯ï¼šä¸€åˆ†é’Ÿä¸è¡Œï¼Œæœ€å¤šç»™ä½ 3ç§’ï¼Œ10ä¸‡äººä¹Ÿä¸è¡Œï¼Œæˆ‘ç°åœ¨æœ‰å…¨ä¸–ç•Œçš„æ•°æ®ï¼Œä½ å¾—åˆ†ç§’å†…å¬é›†å‡ ç™¾å‡ åƒä¸ªä¸“å®¶ï¼Œè¿™äº›ä¸“å®¶æ¯ä¸€ä¸ªçš„çŸ¥è¯†å¾—ç›¸å½“äºä»¥å‰ä¸€ä¸ªåŒ»é™¢é‚£æ²¡å¤šï¼Œè¿˜å¾—åˆ†ç§’å†…æœåŠ¡æ•°10å€çš„ç—…äººï¼Œæœ€åæ²»ç–—çš„ç²¾åº¦ä¸èƒ½ä¸‹é™ã€‚ LightGBM å‡ºåœºäº†ï¼Œè™½ç„¶ç²¾åº¦æé«˜ä¸å¤šï¼Œä½†é€Ÿåº¦å¤§å¤§åŠ å¿«äº†ã€‚ ","date":"2022-07-09","objectID":"/ensemble-learning/:3:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Ensemble Learning"],"title":"Ensemble Learning","uri":"/ensemble-learning/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ—‹è½¬å›¾åƒ https://leetcode-cn.com/problems/rotate-image/ æ²¡éš¾åº¦çš„ä¸­ç­‰é¢˜ï¼Œè¿™æ–¹æ³•å¾ˆpython class Solution: def rotate(self, matrix: List[List[int]]) -\u003e None: \"\"\" Do not return anything, modify matrix in-place instead. \"\"\" n = len(matrix) for i in list(map(list,map(reversed,zip(*matrix)))): matrix.append(i) del matrix[:n] ","date":"2022-07-07","objectID":"/%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/:0:0","tags":["ç®—æ³•é¢˜","æ—‹è½¬å›¾åƒ"],"title":"æ—‹è½¬å›¾åƒ","uri":"/%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"KNN å‚è€ƒï¼šhttps://cuijiahua.com/blog/2017/11/ml_1_knn.html ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹æèˆªï¼ˆkdæ ‘ï¼‰ ","date":"2022-06-25","objectID":"/knn/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","KNN"],"title":"KNN","uri":"/knn/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ç®€ä»‹ kè¿‘é‚»æ³•(k-nearest neighbor, k-NN)æ˜¯1967å¹´ç”±Cover Tå’ŒHart Pæå‡ºçš„ä¸€ç§åŸºæœ¬åˆ†ç±»ä¸å›å½’æ–¹æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šå­˜åœ¨ä¸€ä¸ªæ ·æœ¬æ•°æ®é›†åˆï¼Œä¹Ÿç§°ä½œä¸ºè®­ç»ƒæ ·æœ¬é›†ï¼Œå¹¶ä¸”æ ·æœ¬é›†ä¸­æ¯ä¸ªæ•°æ®éƒ½å­˜åœ¨æ ‡ç­¾ï¼Œå³æˆ‘ä»¬çŸ¥é“æ ·æœ¬é›†ä¸­æ¯ä¸€ä¸ªæ•°æ®ä¸æ‰€å±åˆ†ç±»çš„å¯¹åº”å…³ç³»ã€‚è¾“å…¥æ²¡æœ‰æ ‡ç­¾çš„æ–°æ•°æ®åï¼Œå°†æ–°çš„æ•°æ®çš„æ¯ä¸ªç‰¹å¾ä¸æ ·æœ¬é›†ä¸­æ•°æ®å¯¹åº”çš„ç‰¹å¾è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åç®—æ³•æå–æ ·æœ¬æœ€ç›¸ä¼¼æ•°æ®(æœ€è¿‘é‚»)çš„åˆ†ç±»æ ‡ç­¾ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªé€‰æ‹©æ ·æœ¬æ•°æ®é›†ä¸­å‰kä¸ªæœ€ç›¸ä¼¼çš„æ•°æ®ï¼Œè¿™å°±æ˜¯k-è¿‘é‚»ç®—æ³•ä¸­kçš„å‡ºå¤„ï¼Œé€šå¸¸kæ˜¯ä¸å¤§äº20çš„æ•´æ•°ã€‚æœ€åï¼Œé€‰æ‹©kä¸ªæœ€ç›¸ä¼¼æ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„åˆ†ç±»ï¼Œä½œä¸ºæ–°æ•°æ®çš„åˆ†ç±»ã€‚ ","date":"2022-06-25","objectID":"/knn/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","KNN"],"title":"KNN","uri":"/knn/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ­¥éª¤ k-è¿‘é‚»ç®—æ³•æ­¥éª¤å¦‚ä¸‹ï¼š è®¡ç®—å·²çŸ¥ç±»åˆ«æ•°æ®é›†ä¸­çš„ç‚¹ä¸å½“å‰ç‚¹ä¹‹é—´çš„è·ç¦»ï¼› æŒ‰ç…§è·ç¦»é€’å¢æ¬¡åºæ’åºï¼› é€‰å–ä¸å½“å‰ç‚¹è·ç¦»æœ€å°çš„kä¸ªç‚¹ï¼› ç¡®å®šå‰kä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡ï¼› è¿”å›å‰kä¸ªç‚¹æ‰€å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºå½“å‰ç‚¹çš„é¢„æµ‹åˆ†ç±»ã€‚ ","date":"2022-06-25","objectID":"/knn/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","KNN"],"title":"KNN","uri":"/knn/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ€»ç»“ ä¼˜ç‚¹ ç®€å•å¥½ç”¨ï¼Œå®¹æ˜“ç†è§£ï¼Œç²¾åº¦é«˜ï¼Œç†è®ºæˆç†Ÿï¼Œæ—¢å¯ä»¥ç”¨æ¥åšåˆ†ç±»ä¹Ÿå¯ä»¥ç”¨æ¥åšå›å½’ï¼› å¯ç”¨äºæ•°å€¼å‹æ•°æ®å’Œç¦»æ•£å‹æ•°æ®ï¼› è®­ç»ƒæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›æ— æ•°æ®è¾“å…¥å‡å®šï¼› å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ ç¼ºç‚¹ è®¡ç®—å¤æ‚æ€§é«˜ï¼›ç©ºé—´å¤æ‚æ€§é«˜ï¼› æ ·æœ¬ä¸å¹³è¡¡é—®é¢˜ï¼ˆå³æœ‰äº›ç±»åˆ«çš„æ ·æœ¬æ•°é‡å¾ˆå¤šï¼Œè€Œå…¶å®ƒæ ·æœ¬çš„æ•°é‡å¾ˆå°‘ï¼‰ï¼› ä¸€èˆ¬æ•°å€¼å¾ˆå¤§çš„æ—¶å€™ä¸ç”¨è¿™ä¸ªï¼Œè®¡ç®—é‡å¤ªå¤§ã€‚ä½†æ˜¯å•ä¸ªæ ·æœ¬åˆä¸èƒ½å¤ªå°‘ï¼Œå¦åˆ™å®¹æ˜“å‘ç”Ÿè¯¯åˆ†ã€‚ æœ€å¤§çš„ç¼ºç‚¹æ˜¯æ— æ³•ç»™å‡ºæ•°æ®çš„å†…åœ¨å«ä¹‰ã€‚ å…³äºalgorithmå‚æ•°kd_treeçš„åŸç†ï¼Œå¯ä»¥æŸ¥çœ‹ã€Šç»Ÿè®¡å­¦æ–¹æ³• æèˆªã€‹ä¹¦ä¸­çš„è®²è§£ï¼› å…³äºè·ç¦»åº¦é‡çš„æ–¹æ³•è¿˜æœ‰åˆ‡æ¯”é›ªå¤«è·ç¦»ã€é©¬æ°è·ç¦»ã€å·´æ°è·ç¦»ç­‰ï¼› ","date":"2022-06-25","objectID":"/knn/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","KNN"],"title":"KNN","uri":"/knn/"},{"categories":["NLP"],"content":"ä¸»é¢˜æ¨¡å‹ ä¸»é¢˜æ¨¡å‹ä¹Ÿå¯ä»¥çœ‹æˆä¸€ç§è¯å‘é‡è¡¨è¾¾ï¼Œä¸»è¦æœ‰LSAã€PLSAã€LDAã€‚æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥é€æ¸å‘å±•çš„ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:0:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"è¯è¢‹æ¨¡å‹ å°†æ‰€æœ‰è¯è¯­è£…è¿›ä¸€ä¸ªè¢‹å­é‡Œï¼Œä¸è€ƒè™‘å…¶è¯æ³•å’Œè¯­åºçš„é—®é¢˜ï¼Œå³æ¯ä¸ªè¯è¯­éƒ½æ˜¯ç‹¬ç«‹çš„ ä¾‹å­ï¼š å¥å­1ï¼šæˆ‘ çˆ± åŒ— äº¬ å¤© å®‰ é—¨ è½¬æ¢ä¸º [1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0] å¥å­2ï¼šæˆ‘ å–œ æ¬¢ ä¸Š æµ· è½¬æ¢ä¸º [1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1] from sklearn.feature_extraction.text import CountVectorizer corpus = [ 'This is the first document.', 'This document is the second document.', 'And this is the third one.', 'Is this the first document?', ] vectorizer = CountVectorizer() vectorizer.fit_transform(corpus).toarray() ç»“æœï¼š [[0 1 1 1 0 0 1 0 1] [0 2 0 1 0 1 1 0 1] [1 0 0 1 1 0 1 1 1] [0 1 1 1 0 0 1 0 1]] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:1:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"LSA LSAå°±æ˜¯æ½œåœ¨è¯­ä¹‰åˆ†æã€‚ç‰¹ç‚¹æ˜¯é€šè¿‡çŸ©é˜µåˆ†è§£å‘ç°æ–‡æœ¬ä¸å•è¯ä¹‹é—´åŸºäºä¸»é¢˜ï¼ˆè¯é¢˜ï¼‰çš„è¯­ä¹‰å…³ç³»ã€‚ é¦–å…ˆè¦æ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼š ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:2:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å•è¯-æ–‡æœ¬çŸ©é˜µ \\[ X=\\left[\\begin{array}{cccc} x_{11} \u0026 x_{12} \u0026 \\cdots \u0026 x_{1 n} \\\\\\\\ x_{21} \u0026 x_{22} \u0026 \\cdots \u0026 x_{2 n} \\\\\\\\ \\vdots \u0026 \\vdots \u0026 \u0026 \\vdots \\\\\\\\ x_{m 1} \u0026 x_{m 2} \u0026 \\cdots \u0026 x_{m n} \\end{array}\\right] \\] è¿™æ˜¯ä¸€ä¸ª \\(m \\times n\\) çŸ©é˜µ, å…ƒç´  \\(x_{i j}\\) è¡¨ç¤ºå•è¯ \\(w_i\\) åœ¨æ–‡æœ¬ \\(d_j\\) ä¸­å‡ºç°çš„é¢‘æ•°æˆ–æƒå€¼ã€‚ç”±äºå• è¯çš„ç§ç±»å¾ˆå¤š, è€Œæ¯ä¸ªæ–‡æœ¬ä¸­å‡ºç°å•è¯çš„ç§ç±»é€šå¸¸è¾ƒå°‘, æ‰€ä»¥å•è¯-æ–‡æœ¬çŸ©é˜µæ˜¯ä¸€ä¸ªç¨€ ç–çŸ©é˜µã€‚ æƒå€¼é€šå¸¸ç”¨å•è¯é¢‘ç‡-é€†æ–‡æœ¬é¢‘ç‡ (term frequency-inverse document frequency, TF-IDFï¼‰è¡¨ç¤ºï¼Œå…¶å®šä¹‰æ˜¯ \\[ \\operatorname{TFIDF}_{i j}=\\frac{\\mathrm{tf}_{i j}}{\\mathrm{tf}_{\\bullet j}} \\log \\frac{\\mathrm{df}}{\\mathrm{df}_i}, \\quad i=1,2, \\cdots, m ; \\quad j=1,2, \\cdots, n \\] ç›´è§‚ä¸Šè®²ï¼Œå¯ä»¥ç›´æ¥ç”¨æ¯ä¸€åˆ—ä½œä¸ºæ–‡æœ¬è¯­ä¹‰è¡¨è¾¾ï¼Œ å› æ­¤å¯ä»¥é€šè¿‡ä½™å¼¦ç›¸ä¼¼åº¦ç­‰è®¡ç®—æ–‡æœ¬ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œå¹¶ä¸”çŸ©é˜µç¨€ç–ï¼Œè®¡ç®—é‡è¾ƒå°‘ã€‚ä½†å…¶å¹¶ä¸å…³å¿ƒæ–‡æœ¬ä¸­è¯è¯­å‡ºç°çš„é¡ºåºç­‰ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦æ”¹è¿›ã€‚ ### å•è¯-ä¸»é¢˜çŸ©é˜µ å‡è®¾æ‰€æœ‰æ–‡æœ¬å…±å«æœ‰ \\(k\\) ä¸ªè¯é¢˜ã€‚å‡è®¾æ¯ä¸ªè¯é¢˜ç”±ä¸€ä¸ªå®šä¹‰åœ¨å•è¯é›†åˆ \\(W\\) ä¸Šçš„ \\(m\\) ç»´å‘é‡è¡¨ç¤º, ç§°ä¸ºè¯é¢˜å‘é‡, å³ \\[ t_l=\\left[\\begin{array}{c} t_{1 l} \\\\\\\\ t_{2 l} \\\\\\\\ \\vdots \\\\\\\\ t_{m l} \\end{array}\\right], \\quad l=1,2, \\cdots, k \\] å…¶ä¸­ \\(t_{i l}\\) æ˜¯å•è¯ \\(w_i\\) åœ¨è¯é¢˜ \\(t_l\\) çš„æƒå€¼, \\(i=1,2, \\cdots, m\\), æƒå€¼è¶Šå¤§, è¯¥å•è¯åœ¨è¯¥è¯é¢˜ä¸­ çš„é‡è¦åº¦å°±è¶Šé«˜ã€‚è¿™ \\(k\\) ä¸ªè¯é¢˜å‘é‡ \\(t_1, t_2, \\cdots, t_k\\) å¼ æˆä¸€ä¸ªè¯é¢˜å‘é‡ç©ºé—´ (topic vector è¯é¢˜å‘é‡ç©ºé—´ \\(T\\) ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªçŸ©é˜µ, ç§°ä¸ºå•è¯-ä¸»é¢˜çŸ©é˜µ (word-topic matrixï¼‰, è®°ä½œ \\[ T=\\left[\\begin{array}{cccc} t_{11} \u0026 t_{12} \u0026 \\cdots \u0026 t_{1 k} \\\\\\\\ t_{21} \u0026 t_{22} \u0026 \\cdots \u0026 t_{2 k} \\\\\\\\ \\vdots \u0026 \\vdots \u0026 \u0026 \\vdots \\\\\\\\ t_{m 1} \u0026 t_{m 2} \u0026 \\cdots \u0026 t_{m k} \\end{array}\\right] \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:2:1","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ä¸»é¢˜-æ–‡æœ¬çŸ©é˜µ å°†å•è¯-æ–‡æœ¬çŸ©é˜µä¸­çš„æ–‡æœ¬\\(x_j\\)æŠ•å½±åˆ°ä¸»é¢˜å‘é‡ç©ºé—´\\(J\\)ä¸­ï¼Œå¾—åˆ°åœ¨ä¸»é¢˜ç©ºé—´ä¸­çš„ä¸€ä¸ªå‘é‡\\(y_j\\)ã€‚ \\[ Y=\\left[\\begin{array}{cccc} y_{11} \u0026 y_{12} \u0026 \\cdots \u0026 y_{1 n} \\\\\\\\ y_{21} \u0026 y_{22} \u0026 \\cdots \u0026 y_{2 n} \\\\\\\\ \\vdots \u0026 \\vdots \u0026 \u0026 \\vdots \\\\\\\\ y_{k 1} \u0026 y_{k 2} \u0026 \\cdots \u0026 y_{k n} \\end{array}\\right] \\] ä»å•è¯å‘é‡ç©ºé—´åˆ°ä¸»é¢˜å‘é‡ç©ºé—´çš„çº¿æ€§å˜æ¢ å•è¯-æ–‡æœ¬çŸ©é˜µ\\(X\\)å¯ä»¥è¿‘ä¼¼è¡¨ç¤ºä¸ºå•è¯-ä¸»é¢˜çŸ©é˜µ\\(T\\)ä¸ä¸»é¢˜-æ–‡æœ¬çŸ©é˜µ\\(Y\\)çš„ä¹˜ç§¯ï¼Œè¿™å°±æ˜¯æ½œåœ¨è¯­ä¹‰åˆ†æï¼š \\[ X\\approx TY \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:2:2","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ½œåœ¨è¯­ä¹‰åˆ†æ ç»™å®šå•è¯-æ–‡æœ¬çŸ©é˜µ\\(X\\)ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå•è¯ï¼Œæ¯ä¸€åˆ—ä»£è¡¨ä¸€ä¸ªæ–‡æœ¬ã€‚å…¶ä¸­çš„å…ƒç´ ä»£è¡¨å•è¯åœ¨æ–‡æœ¬ä¸­çš„æƒé‡æˆ–è€…é¢‘æ•°ï¼ˆè¯è¢‹æ¨¡å‹ï¼‰ã€‚ æˆªæ–­å¥‡å¼‚å€¼åˆ†æ \\[ X \\approx U_k \\Sigma_k V_k^{\\mathrm{T}}=\\left[\\begin{array}{llll} u_1 \u0026 u_2 \u0026 \\cdots \u0026 u_k \\end{array}\\right]\\left[\\begin{array}{cccc} \\sigma_1 \u0026 0 \u0026 0 \u0026 0 \\\\\\\\ 0 \u0026 \\sigma_2 \u0026 0 \u0026 0 \\\\\\\\ 0 \u0026 0 \u0026 \\ddots \u0026 0 \\\\\\\\ 0 \u0026 0 \u0026 0 \u0026 \\sigma_k \\end{array}\\right]\\left[\\begin{array}{c} v_1^{\\mathrm{T}} \\\\\\\\ v_2^{\\mathrm{T}} \\\\\\\\ \\vdots \\\\\\\\ v_k^{\\mathrm{T}} \\end{array}\\right] \\] æ¥ä¸‹æ¥è€ƒè™‘æ–‡æœ¬åœ¨ä¸»é¢˜ç©ºé—´ä¸­çš„è¡¨ç¤ºã€‚ \\[ \\begin{aligned} X \u0026=\\left[\\begin{array}{llll} x_1 \u0026 x_2 \u0026 \\cdots \u0026 x_n \\end{array}\\right] \\approx U_k \\Sigma_k V_k^{\\mathrm{T}} \\\\\\\\ \u0026=\\left[\\begin{array}{llll} u_1 \u0026 u_2 \u0026 \\cdots \u0026 u_k \\end{array}\\right]\\left[\\begin{array}{cccc} \\sigma_1 \u0026 \u0026 \u0026 \\\\\\\\ \u0026 \\sigma_2 \u0026 0 \u0026 \\\\\\\\ 0 \u0026 \\ddots \u0026 \\\\\\\\ \u0026 \u0026 \\sigma_k \\end{array}\\right]\\left[\\begin{array}{cccc} v_{11} \u0026 v_{21} \u0026 \\cdots \u0026 v_{n 1} \\\\\\\\ v_{12} \u0026 v_{22} \u0026 \\cdots \u0026 v_{n 2} \\\\\\\\ \\vdots \u0026 \\vdots \u0026 \u0026 \\vdots \\\\\\\\ v_{1 k} \u0026 v_{2 k} \u0026 \\cdots \u0026 v_{n k} \\end{array}\\right] \\\\\\\\ \u0026=\\left[\\begin{array}{llll} u_1 \u0026 u_2 \u0026 \\cdots \u0026 u_k \\end{array}\\right]\\left[\\begin{array}{cccc} \\sigma_1 v_{11} \u0026 \\sigma_1 v_{21} \u0026 \\cdots \u0026 \\sigma_1 v_{n 1} \\\\\\\\ \\sigma_2 v_{12} \u0026 \\sigma_2 v_{22} \u0026 \\cdots \u0026 \\sigma_2 v_{n 2} \\\\\\\\ \\vdots \u0026 \\vdots \u0026 \u0026 \\vdots \\\\\\\\ \\sigma_k v_{1 k} \u0026 \\sigma_k v_{2 k} \u0026 \\cdots \u0026 \\sigma_k v_{n k} \\end{array}\\right] \\end{aligned} \\] å…¶ä¸­: \\[ u_l = \\begin{bmatrix}u_{1l} \\\\\\\\u_{2l} \\\\\\\\ \\vdots \\\\\\\\u_{ml} \\end{bmatrix}, \\quad l= 1, 2, \\dots, k \\] ä»£è¡¨å•è¯å¯¹ä¸»é¢˜çš„æƒé‡ã€‚ ç”±å¼çŸ¥, çŸ©é˜µ \\(X\\) çš„ç¬¬ \\(j\\) åˆ—å‘é‡ \\(x_j\\) æ»¡è¶³ \\[ \\begin{aligned} x_j \u0026 \\approx U_k\\left(\\Sigma_k V_k^{\\mathrm{T}}\\right)\\_j \\\\\\\\ \u0026=\\left[\\begin{array}{llll} u_1 \u0026 u_2 \u0026 \\cdots \u0026 u_k \\end{array}\\right]\\left[\\begin{array}{c} \\sigma_1 v_{j 1} \\\\\\\\ \\sigma_2 v_{j 2} \\\\\\\\ \\vdots \\\\\\\\ \\sigma_k v_{j k} \\end{array}\\right] \\\\\\\\ \u0026=\\sum_{l=1}^k \\sigma_l v_{j l} u_l, \\quad j=1,2, \\cdots, n \\end{aligned} \\] åˆ™\\(\\Sigma_kV_k^T\\)æ¯ä¸€ä¸ªåˆ—å‘é‡æ˜¯ä¸€ä¸ªæ–‡æœ¬åœ¨ä¸»é¢˜å‘é‡ç©ºé—´ä¸­çš„è¡¨ç¤ºã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:2:3","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"PLSA ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ç”Ÿæˆæ¨¡å‹ å‡è®¾æœ‰å•è¯é›†åˆ \\(W={w_1, w_2, \\cdots, w_M}\\), å…¶ä¸­ \\(M\\) æ˜¯å•è¯ä¸ªæ•°; æ–‡æœ¬ (æŒ‡æ ‡) é›† åˆ \\(D={d_1, d_2, \\cdots, d_N}\\), å…¶ä¸­ \\(N\\) æ˜¯æ–‡æœ¬ä¸ªæ•°; è¯é¢˜é›†åˆ \\(Z={z_1, z_2, \\cdots, z_K}\\), å…¶ä¸­ \\(K\\) æ˜¯é¢„å…ˆè®¾å®šçš„è¯é¢˜ä¸ªæ•°ã€‚éšæœºå˜é‡ \\(w\\) å–å€¼äºå•è¯é›†åˆ; éšæœºå˜é‡ \\(d\\) å–å€¼äºæ–‡æœ¬é›† åˆ, éšæœºå˜é‡ \\(z\\) å–å€¼äºè¯é¢˜é›†åˆã€‚æ¦‚ç‡åˆ†å¸ƒ \\(P(d)\\) ã€æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P(z \\mid d)\\) ã€æ¡ä»¶æ¦‚ç‡åˆ† å¸ƒ \\(P(w \\mid z)\\) çš†å±äºå¤šé¡¹åˆ†å¸ƒ, å…¶ä¸­ \\(P(d)\\) è¡¨ç¤ºç”Ÿæˆæ–‡æœ¬ \\(d\\) çš„æ¦‚ç‡, \\(P(z \\mid d)\\) è¡¨ç¤ºæ–‡æœ¬ \\(d\\) ç”Ÿ æˆè¯é¢˜ \\(z\\) çš„æ¦‚ç‡, \\(P(w \\mid z)\\) è¡¨ç¤ºè¯é¢˜ \\(z\\) ç”Ÿæˆå•è¯ \\(w\\) çš„æ¦‚ç‡ã€‚ æ¯ä¸ªæ–‡æœ¬ \\(d\\) æ‹¥æœ‰è‡ªå·±çš„è¯é¢˜æ¦‚ç‡åˆ†å¸ƒ \\(P(z \\mid d)\\), æ¯ä¸ªè¯é¢˜ \\(z\\) æ‹¥æœ‰è‡ªå·±çš„å•è¯æ¦‚ç‡åˆ† å¸ƒ \\(P(w \\mid z)\\); ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ–‡æœ¬çš„å†…å®¹ç”±å…¶ç›¸å…³è¯é¢˜å†³å®š, ä¸€ä¸ªè¯é¢˜çš„å†…å®¹ç”±å…¶ç›¸å…³å•è¯å†³å®šã€‚ ç”Ÿæˆæ¨¡å‹é€šè¿‡ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆæ–‡æœ¬-å•è¯å…±ç°æ•°æ®: (1) ä¾æ®æ¦‚ç‡åˆ†å¸ƒ \\(P(d)\\), ä»æ–‡æœ¬ (æŒ‡æ ‡) é›†åˆä¸­éšæœºé€‰å–ä¸€ä¸ªæ–‡æœ¬ \\(d\\), å…±ç”Ÿæˆ \\(N\\) ä¸ªæ–‡æœ¬; é’ˆå¯¹æ¯ä¸ªæ–‡æœ¬, æ‰§è¡Œä»¥ä¸‹æ“ä½œ; (2) åœ¨æ–‡æœ¬ \\(d\\) ç»™å®šæ¡ä»¶ä¸‹, ä¾æ®æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P(z \\mid d)\\), ä»è¯é¢˜é›†åˆéšæœºé€‰å–ä¸€ä¸ª è¯é¢˜ \\(z\\), å…±ç”Ÿæˆ \\(L\\) ä¸ªè¯é¢˜, è¿™é‡Œ \\(L\\) æ˜¯æ–‡æœ¬é•¿åº¦; (3) åœ¨è¯é¢˜ \\(z\\) ç»™å®šæ¡ä»¶ä¸‹, ä¾æ®æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P(w \\mid z)\\), ä»å•è¯é›†åˆä¸­éšæœºé€‰å–ä¸€ ä¸ªå•è¯ \\(w\\) ã€‚ ç”Ÿæˆæ¨¡å‹ä¸­, å•è¯å˜é‡ \\(w\\) ä¸æ–‡æœ¬å˜é‡ \\(d\\) æ˜¯è§‚æµ‹å˜é‡, è¯é¢˜å˜é‡ \\(z\\) æ˜¯éšå˜é‡ã€‚ä¹Ÿå°± æ˜¯è¯´æ¨¡å‹ç”Ÿæˆçš„æ˜¯å•è¯-è¯é¢˜-æ–‡æœ¬ä¸‰å…ƒç»„ \\((w, z, d)\\) çš„é›†åˆ, ä½†è§‚æµ‹åˆ°çš„æ˜¯å•è¯-æ–‡æœ¬äºŒ å…ƒç»„ \\((w, d)\\) çš„é›†åˆ, è§‚æµ‹æ•°æ®è¡¨ç¤ºä¸ºå•è¯-æ–‡æœ¬çŸ©é˜µ \\(T\\) çš„å½¢å¼, çŸ©é˜µ \\(T\\) çš„è¡Œè¡¨ç¤ºå•è¯, åˆ—è¡¨ç¤ºæ–‡æœ¬, å…ƒç´ è¡¨ç¤ºå•è¯-æ–‡æœ¬å¯¹ \\((w, d)\\) çš„å‡ºç°æ¬¡æ•°ã€‚ ä»æ•°æ®çš„ç”Ÿæˆè¿‡ç¨‹å¯ä»¥æ¨å‡º, æ–‡æœ¬-å•è¯å…±ç°æ•°æ® \\(T\\) çš„ç”Ÿæˆæ¦‚ç‡ä¸ºæ‰€æœ‰å•è¯-æ–‡æœ¬ å¯¹ \\((w, d)\\) çš„ç”Ÿæˆæ¦‚ç‡çš„ä¹˜ç§¯, \\[ P(T)=\\prod_{(w, d)} P(w, d)^{n(w, d)} \\] è¿™é‡Œ \\(n(w, d)\\) è¡¨ç¤º \\((w, d)\\) çš„å‡ºç°æ¬¡æ•°, å•è¯-æ–‡æœ¬å¯¹å‡ºç°çš„æ€»æ¬¡æ•°æ˜¯ \\(N \\times L\\) ã€‚æ¯ä¸ªå• è¯-æ–‡æœ¬å¯¹ \\((w, d)\\) çš„ç”Ÿæˆæ¦‚ç‡ç”±ä»¥ä¸‹å…¬å¼å†³å®š: \\[ \\begin{aligned} P(w, d) \u0026=P(d) P(w \\mid d) \\\\\\\\ \u0026=P(d) \\sum_z P(w, z \\mid d) \\\\\\\\ \u0026=P(d) \\sum_z P(z \\mid d) P(w \\mid z) \\end{aligned} \\] å³ç”Ÿæˆæ¨¡å‹çš„å®šä¹‰ã€‚ ç”Ÿæˆæ¨¡å‹å‡è®¾åœ¨è¯é¢˜ \\(z\\) ç»™å®šæ¡ä»¶ä¸‹, å•è¯ \\(w\\) ä¸æ–‡æœ¬ \\(d\\) æ¡ä»¶ç‹¬ç«‹, å³ \\[ P(w, z \\mid d)=P(z \\mid d) P(w \\mid z) \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:1","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å…±ç°æ¨¡å‹ \\[ P(T)=\\prod_{(w, d)} P(w, d)^{n(w, d)} \\] æ¯ä¸ªå•è¯-æ–‡æœ¬å¯¹ \\((w, d)\\) çš„æ¦‚ç‡ç”±ä»¥ä¸‹å…¬å¼å†³å®š: \\[ P(w, d)=\\sum_{z \\in Z} P(z) P(w \\mid z) P(d \\mid z) \\] å¼ (18.5) å³å…±ç°æ¨¡å‹çš„å®šä¹‰ã€‚å®¹æ˜“éªŒè¯, ç”Ÿæˆæ¨¡å‹ (18.2) å’Œå…±ç°æ¨¡å‹ (18.5) æ˜¯ç­‰ä»·çš„ã€‚ å…±ç°æ¨¡å‹å‡è®¾åœ¨è¯é¢˜ \\(z\\) ç»™å®šæ¡ä»¶ä¸‹, å•è¯ \\(w\\) ä¸æ–‡æœ¬ \\(d\\) æ˜¯æ¡ä»¶ç‹¬ç«‹çš„, å³ \\[ P(w, d \\mid z)=P(w \\mid z) P(d \\mid z) \\] ç›´è§‚è§£é‡Šï¼š ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:2","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ä¸æ½œåœ¨è¯­ä¹‰åˆ†æçš„å…³ç³» å…±ç°æ¨¡å‹ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºä¸‰ä¸ªçŸ©é˜µä¹˜ç§¯çš„å½¢å¼ã€‚è¿™æ ·, æ¦‚ç‡æ½œåœ¨è¯­ä¹‰åˆ†æä¸ æ½œåœ¨è¯­ä¹‰åˆ†æçš„å¯¹åº”å…³ç³»å¯ä»¥ä»ä¸­çœ‹å¾—å¾ˆæ¸…æ¥šã€‚ä¸‹é¢æ˜¯å…±ç°æ¨¡å‹çš„çŸ©é˜µä¹˜ç§¯å½¢å¼: \\[ \\begin{aligned} X^{\\prime} \u0026=U^{\\prime} \\Sigma^{\\prime} V^{\\prime \\mathrm{T}} \\\\\\\\ X^{\\prime} \u0026=[P(w, d)]\\_{M \\times N} \\\\\\\\ U^{\\prime} \u0026=[P(w \\mid z)]\\_{M \\times K} \\\\\\\\ \\Sigma^{\\prime} \u0026=[P(z)]\\_{K \\times K} \\\\\\\\ V^{\\prime} \u0026=[P(d \\mid z)]\\_{N \\times K} \\end{aligned} \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:3","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ¦‚ç‡æ½œåœ¨è¯­ä¹‰åˆ†æçš„ç®—æ³• Plsaæ˜¯å«æœ‰éšå˜é‡çš„æ¨¡å‹ï¼Œå…¶å­¦ä¹ é€šå¸¸ä½¿ç”¨EMç®—æ³•ã€‚ Eæ­¥æ˜¯è®¡ç®—Qå‡½æ•°ï¼ŒMæ­¥æ˜¯æå¤§åŒ–Qå‡½æ•°ã€‚ è®¾å•è¯é›†åˆä¸º \\(W={w_1, w_2, \\cdots, w_M}\\), æ–‡æœ¬é›†åˆä¸º \\(D={d_1, d_2, \\cdots, d_N}\\), è¯ é¢˜é›†åˆä¸º \\(Z={z_1, z_2, \\cdots, z_K}\\) ã€‚ç»™å®šå•è¯-æ–‡æœ¬å…±ç°æ•°æ® \\(T={n\\left(w_i, d_j\\right)}, i=\\) \\(1,2, \\cdots, M, j=1,2, \\cdots, N\\), ç›®æ ‡æ˜¯ä¼°è®¡æ¦‚ç‡æ½œåœ¨è¯­ä¹‰åˆ†ææ¨¡å‹ï¼ˆç”Ÿæˆæ¨¡å‹ï¼‰çš„ å‚æ•°ã€‚å¦‚æœä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡, å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ˜¯ \\[ \\begin{aligned} L \u0026=\\sum_{i=1}^M \\sum_{j=1}^N n\\left(w_i, d_j\\right) \\log P\\left(w_i, d_j\\right) \\\\\\\\ \u0026=\\sum_{i=1}^M \\sum_{j=1}^N n\\left(w_i, d_j\\right) \\log \\left[\\sum_{k=1}^K P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)\\right] \\end{aligned} \\] ä½†æ˜¯æ¨¡å‹å«æœ‰éšå˜é‡, å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„ä¼˜åŒ–æ— æ³•ç”¨è§£ææ–¹æ³•æ±‚è§£, è¿™æ—¶ä½¿ç”¨ EMç®—æ³•ã€‚ åº”ç”¨ EMç®—æ³•çš„æ ¸å¿ƒæ˜¯å®šä¹‰ \\(Q\\) å‡½æ•°ã€‚ \\(\\mathrm{E}\\) æ­¥ï¼šè®¡ç®— \\(Q\\) å‡½æ•° \\(Q\\) å‡½æ•°ä¸ºå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°å¯¹ä¸å®Œå…¨æ•°æ®çš„æ¡ä»¶åˆ†å¸ƒçš„æœŸæœ›ã€‚é’ˆå¯¹æ¦‚ç‡æ½œ åœ¨è¯­ä¹‰åˆ†æçš„ç”Ÿæˆæ¨¡å‹, \\(Q\\) å‡½æ•°æ˜¯ \\[ Q=\\sum_{k=1}^K{\\sum_{j=1}^N n\\left(d_j\\right)\\left[\\log P\\left(d_j\\right)+\\sum_{i=1}^M \\frac{n\\left(w_i, d_j\\right)}{n\\left(d_j\\right)} \\log P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)\\right]} P\\left(z_k \\mid w_i, d_j\\right) \\] å¼ä¸­ \\(n\\left(d_j\\right)=\\sum_{i=1}^M n\\left(w_i, d_j\\right)\\) è¡¨ç¤ºæ–‡æœ¬ \\(d_j\\) ä¸­çš„å•è¯ä¸ªæ•°, \\(n\\left(w_i, d_j\\right)\\) è¡¨ç¤ºå•è¯ \\(w_i\\) åœ¨æ–‡æœ¬ \\(d_j\\) ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P\\left(z_k \\mid w_i, d_j\\right)\\) ä»£è¡¨ä¸å®Œå…¨æ•°æ®, æ˜¯å·²çŸ¥å˜é‡ã€‚æ¡ä»¶æ¦‚ ç‡åˆ†å¸ƒ \\(P\\left(w_i \\mid z_k\\right)\\) å’Œ \\(P\\left(z_k \\mid d_j\\right)\\) çš„ä¹˜ç§¯ä»£è¡¨å®Œå…¨æ•°æ®, æ˜¯æœ«çŸ¥å˜é‡ã€‚ ç”±äºå¯ä»¥ä»æ•°æ®ä¸­ç›´æ¥ç»Ÿè®¡å¾—å‡º \\(P\\left(d_j\\right)\\) çš„ä¼°è®¡, è¿™é‡Œåªè€ƒè™‘ \\(P\\left(w_i \\mid z_k\\right), P\\left(z_k \\mid d_j\\right)\\) çš„ä¼°è®¡, å¯å°† \\(Q\\) å‡½æ•°ç®€åŒ–ä¸ºå‡½æ•° \\(Q^{\\prime}\\) \\[ Q^{\\prime}=\\sum_{i=1}^M \\sum_{j=1}^N n\\left(w_i, d_j\\right) \\sum_{k=1}^K P\\left(z_k \\mid w_i, d_j\\right) \\log \\left[P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)\\right] \\] \\(Q^{\\prime}\\) å‡½æ•°ä¸­çš„ \\(P\\left(z_k \\mid w_i, d_j\\right)\\) å¯ä»¥æ ¹æ®è´å¶æ–¯å…¬å¼è®¡ç®— \\[ P\\left(z_k \\mid w_i, d_j\\right)=\\frac{P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)}{\\sum_{k=1}^K P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)} \\] å…¶ä¸­ \\(P\\left(z_k \\mid d_j\\right)\\) å’Œ \\(P\\left(w_i \\mid z_k\\right)\\) ç”±ä¸Šä¸€æ­¥è¿­ä»£å¾—åˆ°ã€‚ \\(\\mathrm{M}\\) æ­¥: æå¤§åŒ– \\(Q\\) å‡½æ•°ã€‚ é€šè¿‡çº¦æŸæœ€ä¼˜åŒ–æ±‚è§£ \\(Q\\) å‡½æ•°çš„æå¤§å€¼, è¿™æ—¶ \\(P\\left(z_k \\mid d_j\\right)\\) å’Œ \\(P\\left(w_i \\mid z_k\\right)\\) æ˜¯å˜é‡ã€‚å› ä¸º å˜é‡ \\(P\\left(w_i \\mid z_k\\right), P\\left(z_k \\mid d_j\\right)\\) å½¢æˆæ¦‚ç‡åˆ†å¸ƒ, æ»¡è¶³çº¦æŸæ¡ä»¶ \\[ \\begin{aligned} \u0026\\sum_{i=1}^M P\\left(w_i \\mid z_k\\right)=1, \\quad k=1,2, \\cdots, K \\\\\\\\ \u0026\\sum_{k=1}^K P\\left(z_k \\mid d_j\\right)=1, \\quad j=1,2, \\cdots, N \\end{aligned} \\] åº”ç”¨æ‹‰æ ¼æœ—æ—¥æ³•, å¼•å…¥æ‹‰æ ¼æœ—æ—¥ä¹˜å­ \\(\\tau_k\\) å’Œ \\(\\rho_j\\), å®šä¹‰æ‹‰æ ¼æœ—æ—¥å‡½æ•° \\(A\\) \\[ \\Lambda=Q^{\\prime}+\\sum_{k=1}^K \\tau_k\\left(1-\\sum_{i=1}^M P\\left(w_i \\mid z_k\\right)\\right)+\\sum_{j=1}^N \\rho_j\\left(1-\\sum_{k=1}^K P\\left(z_k \\mid d_j\\right)\\right) \\] å°†æ‹‰æ ¼æœ—æ—¥å‡½æ•° \\(\\Lambda\\) åˆ†åˆ«å¯¹ \\(P\\left(w_i \\mid z_k\\right)\\) å’Œ \\(P\\left(z_k \\mid d_j\\right)\\) æ±‚åå¯¼æ•°, å¹¶ä»¤å…¶ç­‰äº 0 , å¾—åˆ°ä¸‹é¢ çš„æ–¹ç¨‹ç»„ \\[ \\begin{aligned} \u0026\\sum_{j=1}^N n\\left(w_i, d_j\\right) P\\left(z_k \\mid w_i, d_j\\right)-\\tau_k P\\left(w_i \\mid z_k\\right)=0, \\quad i=1,2, \\cdots, M ; \\quad k=1,2, \\cdots, K \\\\\\\\ \u0026\\sum_{i=1}^M n\\left(w_i, d_j\\right) P\\left(z_k \\mid w_i, d_j\\right)-\\rho_j P\\left(z_k \\mid d_j\\right)=0, \\quad j=1,2, \\cdots, N ; \\quad k=1,2, \\cdots, K \\end{aligned} \\] è§£æ–¹ç¨‹ç»„å¾—åˆ° \\(M\\) æ­¥çš„å‚æ•°ä¼°è®¡å…¬å¼: \\[ P\\left(w_i \\mid z_k\\right)=\\frac{\\sum_{j=1}^N n\\left(w_i, d_j\\right) P\\left(z_k \\mid w_i, d_j\\right)}{\\sum_{m=1}^M \\sum_{j=1}^N n\\left(w_m, d_j\\right) P\\left(z_k \\mid w_m, d_j\\right)} \\] \\[ P(z_k\\mid d_j) = \\frac{\\sum_{i=1}^Mn(w_i, d_j)P(z_k\\mid w_i,d_j)}{n(d_j)} \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:4","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ€»ç»“ç®—æ³• è¾“å…¥: è®¾å•è¯é›†åˆä¸º \\(W={w_1, w_2, \\cdots, w_M}\\), æ–‡æœ¬é›†åˆä¸º \\(D={d_1, d_2, \\cdots, d_N}\\), è¯é¢˜é›†åˆä¸º \\(Z={z_1, z_2, \\cdots, z_K}\\), å…±ç°æ•°æ® \\({n\\left(w_i, d_j\\right)}, i=1,2, \\cdots, M, j=1\\), \\(2, \\cdots, N\\); è¾“å‡º: \\(P\\left(w_i \\mid z_k\\right)\\) å’Œ \\(P\\left(z_k \\mid d_j\\right)\\) ã€‚ (1) è®¾ç½®å‚æ•° \\(P\\left(w_i \\mid z_k\\right)\\) å’Œ \\(P\\left(z_k \\mid d_j\\right)\\) çš„åˆå§‹å€¼ã€‚ (2) è¿­ä»£æ‰§è¡Œä»¥ä¸‹ \\(\\mathrm{E}\\) æ­¥, \\(\\mathrm{M}\\) æ­¥, ç›´åˆ°æ”¶æ•›ä¸ºæ­¢ã€‚ \\(\\mathrm{E}\\) æ­¥: \\[ P\\left(z_k \\mid w_i, d_j\\right)=\\frac{P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)}{\\sum_{k=1}^K P\\left(w_i \\mid z_k\\right) P\\left(z_k \\mid d_j\\right)} \\] M æ­¥: \\[ \\begin{aligned} P\\left(w_i \\mid z_k\\right) \u0026=\\frac{\\sum_{j=1}^N n\\left(w_i, d_j\\right) P\\left(z_k \\mid w_i, d_j\\right)}{\\sum_{m=1}^M \\sum_{j=1}^N n\\left(w_m, d_j\\right) P\\left(z_k \\mid w_m, d_j\\right)} \\\\\\\\ P\\left(z_k \\mid d_j\\right) \u0026=\\frac{\\sum_{i=1}^M n\\left(w_i, d_j\\right) P\\left(z_k \\mid w_i, d_j\\right)}{n\\left(d_j\\right)} \\end{aligned} \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:5","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ç”¨æ³• ä¸LSAç±»ä¼¼ï¼Œå¯ä»¥æŠŠæ–‡æ¡£å¯¹å„ä¸ªä¸»é¢˜çš„æ¦‚ç‡çœ‹ä½œæ˜¯æ–‡æ¡£çš„è¡¨ç¤ºï¼Œæœ€åç”¨åˆ°çš„å°±æ˜¯\\(P(z_k\\mid d_j)\\)ã€‚ kå°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾å®šçš„ä¸»é¢˜æ•°ï¼Œä¸€èˆ¬æ¥è¯´Kè¿œè¿œå°äºæ–‡æ¡£ä¸ªæ•°å’Œè¯æ±‡è¡¨å¤§å°ï¼Œè¿™æ ·ä¹Ÿè¾¾åˆ°äº†é™ç»´çš„ç›®çš„ã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:6","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ä¼˜ç‚¹ä¸ä¸è¶³ ä¼˜ç‚¹ pLSAæ˜¯åœ¨ä¸€å¥—æ¯”è¾ƒå®Œæ•´çš„æ€æƒ³çš„åŸºç¡€ä¸Šæå‡ºæ¥çš„ï¼Œæ¨¡å‹ä¸­å„é¡¹å‚æ•°æœ‰æ˜ç¡®çš„ç‰©ç†å«ä¹‰ï¼Œå¯è§£é‡Šæ€§æ¯”è¾ƒå¼ºã€‚ç›¸æ¯”LSAï¼ŒpLSAå¯¹äººç±»ç”Ÿæˆæ–‡æœ¬æœºåˆ¶çš„åˆ»ç”»æ›´åŠ ç»†è‡´ã€æ›´åŠ ç¬¦åˆæˆ‘ä»¬çš„å¸¸è¯†ï¼Œæ¯”å¦‚ï¼ŒpLSAåŸºäºæ¡ä»¶æ¦‚ç‡ï¼Œå¼•å…¥äº†ä¸€ä¸ªâ€œéšå«å˜é‡â€ï¼ˆç›¸å¯¹äºå¯ä»¥çœ‹åˆ°çš„æ–‡æ¡£å’Œè¯è¯­ï¼Œæ˜¯ä¸å¯è§‚æµ‹å˜çš„ï¼‰ï¼Œå³ä¸»é¢˜ï¼Œæ¥æè¿°æ–‡æœ¬ç”Ÿæˆçš„è¿‡ç¨‹ã€‚ #### ä¸è¶³ pLSAçš„ç†è®ºä¸æˆ‘ä»¬çš„å®è·µä¸æ˜¯é‚£ä¹ˆçš„ç»Ÿä¸€: (1) æˆ‘ä»¬è¯´è¯çš„æ—¶å€™ï¼Œæ ¹æœ¬ä¸ä¼šè€ƒè™‘â€ æˆ‘è¯´è¿™æ®µè¯çš„æ¦‚ç‡å¤§å°â€ï¼Œå³ \\(p\\left(d_t\\right)\\) (2) pLSAè®¤ä¸ºï¼Œæˆ‘ä»¬è¯´è¯æ—¶é¢å‘çš„ä¸»é¢˜åˆ†å¸ƒï¼Œå–å†³äº â€œæ–‡æ¡£â€ ï¼ˆå®é™…ä¸Šæ˜¯æ–‡æ¡£ID)ã€‚è¿™ä¸ªå‡è®¾æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œå°è¯´å®¶ä¸ä¼šå› ä¸ºè‡ªå·±å†™åˆ°ç¬¬666å›è€Œè°ƒæ•´ ä¸»é¢˜ã€‚ (3) ç±»ä¼¼ (2)ï¼Œéšç€ä¸Šä¸‹æ–‡çš„å˜åŒ–ï¼Œæˆ‘ä»¬å›´ç»•ä¸€ä¸ªä¸»é¢˜è¯´è¯çš„å†…å®¹å’Œæ–¹å¼ä¹Ÿ ä¼šå‘ç”Ÿæ”¹å˜ã€‚åœ¨ä¸»é¢˜æ¨¡å‹ä¸­ï¼Œè¿™ç§æ”¹å˜çš„ä½“ç°ï¼Œå°±æ˜¯ä¸€ä¸ªä¸»é¢˜ä¸‹çš„è¯è¯­æ¦‚ç‡åˆ† å¸ƒä¼šå‘ç”Ÿæ”¹å˜ã€‚è€ŒpLSAå¿½ç•¥äº†è¿™æ ·çš„äº‹å®ã€‚ ä»è®¡ç®—å¤æ‚åº¦çš„è§’åº¦çœ‹pLSAæœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ç¼ºé™·: (1) pLSAä¸­ï¼Œå¯¹æ–‡æ¡£ å‡ºç°çš„æ¦‚ç‡ä¼°è®¡ï¼Œæ¥è‡ªå¯¹è®­ç»ƒè¯­æ–™çš„å­¦ä¹ ã€‚è€Œå¯¹äºä¸€ä¸ª æœ«çŸ¥æ–‡æ¡£ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•ä¼°è®¡å®ƒå‡ºç°çš„æ¦‚ç‡çš„ä¸€ä¸€å› æ­¤pLSAæ— æ³•å¯¹è®­ç»ƒè¯­æ–™ä¹‹ å¤–çš„æ–‡æ¡£è¿›è¡Œå¤„ç†ã€‚pLSAçš„è¿™ä¸ªç‰¹ç‚¹å†³å®šäº†ï¼Œåœ¨åœ¨çº¿(online) åœºæ™¯ä¸­(æ•°æ®æ˜¯ æŒç»­å¢åŠ çš„)ï¼Œé‚£ä¹ˆæ–‡æ¡£å¤„ç†ç³»ç»Ÿå°±éœ€è¦å®šæ—¶ä½¿ç”¨pLSAå¯¹æ•´ä¸ªè¯­æ–™åº“è¿›è¡Œè®¡ ç®—ã€‚å› æ­¤ï¼ŒpLSAæ¯”è¾ƒé€‚åˆå…è®¸ä¸€å®šæ—¶æ»çš„ç¦»çº¿è®¡ç®—ã€‚ (2) pLSAè®¤ä¸ºä¸€ä¸ªæ–‡æ¡£å¯¹å„ä¸ªä¸»é¢˜çš„éš¶å±åº¦æ˜¯ä¸€å®šçš„â€”â€”è€Œä¸€ä¸ªä¸»é¢˜å¯¹å„ä¸ªè¯è¯­çš„éš¶å±åº¦ä¹Ÿæ˜¯ä¸€å®šçš„ï¼Œå› æ­¤pLSAåœ¨ç”Ÿæˆä¸€ä¸ªæ–‡æ¡£çš„å„ä¸ªè¯è¯­æ—¶ã€ä½¿ç”¨äº†ç›¸åŒçš„è¯è¯­æ¦‚ç‡åˆ†å¸ƒã€‚è¿™æ ·ï¼ŒpLSAéœ€è¦ä¸ºæ¯ä¸€ä¸ªæ–‡æ¡£è®°å½•ä¸€ä¸ªä¸“é—¨çš„éšç€è¯­æ–™æ•°æ®é›†è§„æ¨¡çš„å¢åŠ ï¼ŒpLSAçš„å‚æ•°è§„æ¨¡ä¹Ÿä¼šå¢åŠ ï¼Œå¯¼è‡´æ¨¡å‹è®­ç»ƒè¶Šæ¥è¶Šå›°éš¾ã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:3:7","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"LDA LDAæ¨¡å‹æ˜¯æ–‡æœ¬é›†åˆçš„ç”Ÿæˆæ¦‚ç‡æ¨¡å‹ã€‚ LDA çš„æ–‡æœ¬é›†åˆçš„ç”Ÿæˆè¿‡ç¨‹å¦‚ä¸‹: é¦–å…ˆéšæœºç”Ÿæˆä¸€ä¸ªæ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒ, ä¹‹ååœ¨è¯¥ æ–‡æœ¬çš„æ¯ä¸ªä½ç½®, ä¾æ®è¯¥æ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒéšæœºç”Ÿæˆä¸€ä¸ªè¯é¢˜, ç„¶ååœ¨è¯¥ä½ç½®ä¾æ®è¯¥è¯ é¢˜çš„å•è¯åˆ†å¸ƒéšæœºç”Ÿæˆä¸€ä¸ªå•è¯, ç›´è‡³æ–‡æœ¬çš„æœ€åä¸€ä¸ªä½ç½®, ç”Ÿæˆæ•´ä¸ªæ–‡æœ¬ã€‚é‡å¤ä»¥ ä¸Šè¿‡ç¨‹ç”Ÿæˆæ‰€æœ‰æ–‡æœ¬ã€‚ LDA æ¨¡å‹æ˜¯å«æœ‰éšå˜é‡çš„æ¦‚ç‡å›¾æ¨¡å‹ã€‚æ¨¡å‹ä¸­, æ¯ä¸ªè¯é¢˜çš„å•è¯åˆ†å¸ƒ, æ¯ä¸ªæ–‡ æœ¬çš„è¯é¢˜åˆ†å¸ƒ, æ–‡æœ¬çš„æ¯ä¸ªä½ç½®çš„è¯é¢˜æ˜¯éšå˜é‡; æ–‡æœ¬çš„æ¯ä¸ªä½ç½®çš„å•è¯æ˜¯è§‚æµ‹å˜ é‡ã€‚LDA æ¨¡å‹çš„å­¦ä¹ ä¸æ¨ç†æ— æ³•ç›´æ¥æ±‚è§£, é€šå¸¸ä½¿ç”¨å‰å¸ƒæ–¯æŠ½æ · (Gibbs sampling) å’Œ å˜åˆ† EMç®—æ³• (variational EM algorithm), å‰è€…æ˜¯è’™ç‰¹å¡ç½—æ³•, è€Œåè€…æ˜¯è¿‘ä¼¼ç®—æ³•ã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å¤šé¡¹åˆ†å¸ƒ (å¤šé¡¹åˆ†å¸ƒ) è‹¥å¤šå…ƒç¦»æ•£éšæœºå˜é‡ \\(X=\\left(X_1, X_2, \\cdots, X_k\\right)\\) çš„æ¦‚ç‡è´¨ é‡å‡½æ•°ä¸º \\[ \\begin{aligned} P\\left(X_1=n_1, X_2=n_2, \\cdots, X_k=n_k\\right) \u0026=\\frac{n !}{n_{1} ! n_{2} ! \\cdots n_{k} !} p_1^{n_1} p_2^{n_2} \\cdots p_k^{n_k} \\\\\\\\ \u0026=\\frac{n !}{\\prod_{i=1}^k n_{i} !} \\prod_{i=1}^k p_i^{n_i} \\end{aligned} \\] å…¶ä¸­ \\(p=\\left(p_1, p_2, \\cdots, p_k\\right), p_i \\geqslant 0, i=1,2, \\cdots, k, \\sum_{i=1}^k p_i=1, \\sum_{i=1}^k n_i=n\\), åˆ™ç§°éšæœºå˜ é‡ \\(X\\) æœä»å‚æ•°ä¸º \\((n, p)\\) çš„å¤šé¡¹åˆ†å¸ƒ, è®°ä½œ \\(X \\sim \\operatorname{Mult}(n, p)\\) ã€‚ å½“è¯•éªŒçš„æ¬¡æ•° \\(n\\) ä¸º 1 æ—¶, å¤šé¡¹åˆ†å¸ƒå˜æˆç±»åˆ«åˆ†å¸ƒ (categorical distribution)ã€‚ç±» åˆ«åˆ†å¸ƒè¡¨ç¤ºè¯•éªŒå¯èƒ½å‡ºç°çš„ \\(k\\) ç§ç»“æœçš„æ¦‚ç‡ã€‚æ˜¾ç„¶å¤šé¡¹åˆ†å¸ƒåŒ…å«ç±»åˆ«åˆ†å¸ƒã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:1","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ç‹„åˆ©å…‹é›·åˆ†å¸ƒ ç‹„åˆ©å…‹é›·åˆ†å¸ƒ (Dirichlet distribution) æ˜¯ä¸€ç§å¤šå…ƒè¿ç»­éšæœºå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒ, æ˜¯ è´å¡”åˆ†å¸ƒ (beta distribution) çš„æ‰©å±•ã€‚åœ¨è´å¶æ–¯å­¦ä¹ ä¸­, ç‹„åˆ©å…‹é›·åˆ†å¸ƒå¸¸ä½œä¸ºå¤šé¡¹åˆ† å¸ƒçš„å…ˆéªŒåˆ†å¸ƒä½¿ç”¨ã€‚ (ç‹„åˆ©å…‹é›·åˆ†å¸ƒ) è‹¥å¤šå…ƒè¿ç»­éšæœºå˜é‡ \\(\\theta=\\left(\\theta_1, \\theta_2, \\cdots, \\theta_k\\right)\\) çš„æ¦‚ç‡å¯† åº¦å‡½æ•°ä¸º \\[ p(\\theta \\mid \\alpha)=\\frac{\\Gamma\\left(\\sum_{i=1}^k \\alpha_i\\right)}{\\prod_{i=1}^k \\Gamma\\left(\\alpha_i\\right)} \\prod_{i=1}^k \\theta_i^{\\alpha_i-1} \\] å…¶ä¸­ \\(\\sum_{i=1}^k \\theta_i=1, \\theta_i \\geqslant 0, \\alpha=\\left(\\alpha_1, \\alpha_2, \\cdots, \\alpha_k\\right), \\alpha_i\u003e0, i=1,2, \\cdots, k\\), åˆ™ç§°éšæœºå˜é‡ \\(\\theta\\) æœä»å‚æ•°ä¸º \\(\\alpha\\) çš„ç‹„åˆ©å…‹é›·åˆ†å¸ƒ, è®°ä½œ \\(\\theta \\sim \\operatorname{Dir}(\\alpha)\\) ã€‚ å¼ä¸­ \\(\\Gamma(s)\\) æ˜¯ä¼½é©¬å‡½æ•°, å®šä¹‰ä¸º \\[ \\Gamma(s)=\\int_0^{\\infty} x^{s-1} \\mathrm{e}^{-x} \\mathrm{~d} x, \\quad s\u003e0 \\] å…·æœ‰æ€§è´¨ï¼š \\[ \\Gamma(s+1) = s\\Gamma(s) \\] å½“sä¸ºè‡ªç„¶æ•°æ—¶ï¼Œæœ‰ï¼š \\[ \\Gamma(s+1) = s! \\] ä»¤ \\[ \\mathrm{B}(\\alpha)=\\frac{\\prod_{i=1}^k \\Gamma\\left(\\alpha_i\\right)}{\\Gamma\\left(\\sum_{i=1}^k \\alpha_i\\right)} \\] åˆ™ç‹„åˆ©å…‹é›·åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°å¯ä»¥å†™æˆ \\[ p(\\theta \\mid \\alpha)=\\frac{1}{\\mathrm{~B}(\\alpha)} \\prod_{i=1}^k \\theta_i^{\\alpha_i-1} \\] \\(\\mathrm{B}(\\alpha)\\) æ˜¯è§„èŒƒåŒ–å› å­, ç§°ä¸ºå¤šå…ƒè´å¡”å‡½æ•° (æˆ–æ‰©å±•çš„è´å¡”å‡½æ•°)ã€‚ç”±å¯†åº¦å‡½æ•°çš„æ€§è´¨ \\[ \\int \\frac{\\Gamma\\left(\\sum_{i=1}^k \\alpha_i\\right)}{\\prod_{i=1}^k \\Gamma\\left(\\alpha_i\\right)} \\prod_{i=1}^{\\alpha_i-1} \\mathrm{~d} \\theta=\\frac{\\Gamma\\left(\\sum_{i=1}^k \\alpha_i\\right)}{\\prod_{i=1}^k \\Gamma\\left(\\alpha_i\\right)} \\int \\prod_{i=1}^k \\theta_i^{\\alpha_i-1} \\mathrm{~d} \\theta=1 \\] å¾— \\[ \\mathrm{B}(\\alpha)=\\int \\prod_{i=1}^k \\theta_i^{\\alpha_i-1} \\mathrm{~d} \\theta \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:2","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"äºŒé¡¹åˆ†å¸ƒä¸è´å¡”åˆ†å¸ƒ äºŒé¡¹åˆ†å¸ƒæ˜¯å¤šé¡¹åˆ†å¸ƒçš„ç‰¹æ®Šæƒ…å†µ, è´å¡”åˆ†å¸ƒæ˜¯ç‹„åˆ©å…‹é›·åˆ†å¸ƒçš„ç‰¹æ®Šæƒ…å†µã€‚ äºŒé¡¹åˆ†å¸ƒæ˜¯æŒ‡å¦‚ä¸‹æ¦‚ç‡åˆ†å¸ƒã€‚ \\(X\\) ä¸ºç¦»æ•£éšæœºå˜é‡, å–å€¼ä¸º \\(m\\), å…¶æ¦‚ç‡è´¨é‡å‡½æ•°ä¸º \\[ P(X=m)=\\left(\\begin{array}{c} n \\\\\\\\ m \\end{array}\\right) p^m(1-p)^{n-m}, \\quad m=0,1,2, \\cdots, n \\] å…¶ä¸­ \\(n\\) å’Œ \\(p(0 \\leqslant p \\leqslant 1)\\) æ˜¯å‚æ•°ã€‚ è´å¡”åˆ†å¸ƒæ˜¯æŒ‡å¦‚ä¸‹æ¦‚ç‡åˆ†å¸ƒ, \\(X\\) ä¸ºè¿ç»­éšæœºå˜é‡, å–å€¼èŒƒå›´ä¸º \\([0,1]\\), å…¶æ¦‚ç‡å¯†åº¦ å‡½æ•°ä¸º \\[ p(x)= \\begin{cases}\\frac{1}{\\mathrm{~B}(s, t)} x^{s-1}(1-x)^{t-1}, \u0026 0 \\leqslant x \\leqslant 1 \\\\\\\\ 0, \u0026 \\text { å…¶ä»– }\\end{cases} \\] å…¶ä¸­ \\(s\u003e0\\) å’Œ \\(t\u003e0\\) æ˜¯å‚æ•°, \\(\\mathrm{B}(s, t)=\\frac{\\Gamma(s) \\Gamma(t)}{\\Gamma(s+t)}\\) æ˜¯è´å¡”å‡½æ•°, å®šä¹‰ä¸º \\[ \\mathrm{B}(s, t)=\\int_0^1 x^{s-1}(1-x)^{t-1} \\mathrm{~d} x = \\frac{\\Gamma(s)\\Gamma(t)}{\\Gamma(s+t)} \\] å½“ \\(s, t\\) æ˜¯è‡ªç„¶æ•°æ—¶(\\(\\Gamma(s+1) = s!\\)), \\[ \\mathrm{B}(s, t)=\\frac{(s-1) !(t-1) !}{(s+t-1) !} \\] å½“ \\(n\\) ä¸º 1 æ—¶, äºŒé¡¹åˆ†å¸ƒå˜æˆä¼¯åŠªåˆ©åˆ†å¸ƒï¼ˆBernoulli distributionï¼‰æˆ– 0-1 åˆ†å¸ƒã€‚ ä¼¯åŠªåˆ©åˆ†å¸ƒè¡¨ç¤ºè¯•éªŒå¯èƒ½å‡ºç°çš„ 2 ç§ç»“æœçš„æ¦‚ç‡ã€‚æ˜¾ç„¶äºŒé¡¹åˆ†å¸ƒåŒ…å«ä¼¯åŠªåˆ©åˆ†å¸ƒã€‚ç»™å‡ºå‡ ç§æ¦‚ç‡åˆ†å¸ƒçš„å…³ç³»ã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:3","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"åŸºæœ¬æƒ³æ³• åœ¨LDAä¸»é¢˜æ¨¡å‹ä¸‹ï¼Œä¸€ç¯‡æ–‡ç« ç”±è¯è¯­çš„åºåˆ—ç»„æˆã€‚é¦–å…ˆä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼Œå…¶æ¬¡ä»¥ä¸€å®šæ¦‚ç‡åœ¨è¿™ä¸ªä¸»é¢˜ä¸­é€‰æ‹©ä¸€ä¸ªè¯ã€‚å¦‚æœä¸€ç¯‡æ–‡ç« ç”±1000ä¸ªè¯ç»„æˆï¼Œé‚£ä¹ˆå°±æŠŠä¸Šè¿°æ–¹å¼é‡å¤1000éï¼Œå°±èƒ½ç»„æˆè¿™ç¯‡æ–‡ç« ã€‚é‚£ä¹ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©ä¸€ä¸ªä¸»é¢˜æ˜¯æœä»å¤šé¡¹å¼åˆ†å¸ƒçš„ï¼Œè€Œå¤šé¡¹å¼åˆ†å¸ƒçš„å‚æ•°æ˜¯æœä»Dirichletåˆ†å¸ƒçš„ã€‚ä»¥ä¸€å®šæ¦‚ç‡åœ¨ç‰¹å®šä¸»é¢˜ä¸­é€‰æ‹©ä¸€ä¸ªè¯ä¹Ÿæ˜¯æœä»å¤šé¡¹å¼åˆ†å¸ƒçš„ï¼Œå¤šé¡¹å¼åˆ†å¸ƒçš„å‚æ•°æ˜¯æœä»Dirichletåˆ†å¸ƒçš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºDirichletåˆ†å¸ƒæ˜¯å¤šé¡¹å¼åˆ†å¸ƒçš„å…±è½­åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯è¯´ç”±è´å¶æ–¯ä¼°è®¡å¾—åˆ°çš„åéªŒåˆ†å¸ƒä»ç„¶æ˜¯Dirichletåˆ†å¸ƒã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:4","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"LDAä¸PLSAçš„å…³ç³» äºŒè€…éƒ½æ˜¯æ¦‚ç‡æ¨¡å‹ï¼Œéƒ½æ˜¯åˆ©ç”¨æ¦‚ç‡ç”Ÿæˆæ¨¡å‹å¯¹æ–‡æœ¬é›†åˆè¿›è¡Œä¸»é¢˜åˆ†æçš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚ PLSAæ˜¯ç”¨äº†é¢‘ç‡æ´¾çš„æ–¹æ³•ï¼Œåˆ©ç”¨æå¤§ä¼¼ç„¶è¿›è¡Œå­¦ä¹ ï¼Œè€ŒLDAä½¿ç”¨äº†è´å¶æ–¯æ´¾çš„æ–¹æ³•ï¼Œè¿›è¡Œè´å¶æ–¯æ¨æ–­ã€‚ äºŒè€…éƒ½å‡è®¾å­˜åœ¨ä¸¤ä¸ªåˆ†å¸ƒï¼šè¯é¢˜æ˜¯å•è¯çš„å¤šé¡¹åˆ†å¸ƒï¼Œæ–‡æœ¬æ˜¯è¯é¢˜çš„å¤šé¡¹åˆ†å¸ƒï¼Œä¸åŒçš„åœ¨äºLDAè®¤ä¸ºå¤šé¡¹åˆ†å¸ƒçš„å‚æ•°ä¹Ÿæœä»ä¸€ä¸ªåˆ†å¸ƒï¼Œè€Œä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œä½¿ç”¨ç‹„åˆ©å…‹é›·åˆ†å¸ƒä½œä¸ºå¤šé¡¹åˆ†å¸ƒçš„å…ˆéªŒåˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯å¤šé¡¹åˆ†å¸ƒçš„å‚æ•°æœä»ç‹„åˆ©å…‹é›·åˆ†å¸ƒã€‚ å¼•å…¥å…ˆéªŒæ¦‚ç‡çš„ä½œç”¨å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚ä¸ºå•¥é€‰æ‹©ç‹„åˆ©å…‹é›·åˆ†å¸ƒå‘¢ï¼Ÿå› ä¸ºå®ƒæ˜¯å¤šé¡¹åˆ†å¸ƒçš„å…±è½­å…ˆéªŒåˆ†å¸ƒï¼Œå…ˆéªŒåˆ†å¸ƒä¸åéªŒåˆ†å¸ƒå½¢å¼ç›¸åŒï¼Œä¾¿äºç”±å…ˆéªŒåˆ†å¸ƒå¾—åˆ°åéªŒåˆ†å¸ƒã€‚ LDAæ˜¯åœ¨Plsaçš„åŸºç¡€ä¸Šï¼Œä¸ºå•è¯åˆ†å¸ƒå’Œä¸»é¢˜åˆ†å¸ƒå¢åŠ äº†ä¸¤ä¸ªç‹„åˆ©å…‹é›·å…ˆéªŒã€‚ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:5","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ¨¡å‹å®šä¹‰ æ¨¡å‹è¦ç´  æ½œåœ¨ç‹„åˆ©å…‹é›·åˆ†é… (LDA) ä½¿ç”¨ä¸‰ä¸ªé›†åˆ: ä¸€æ˜¯å•è¯é›†åˆ \\(W={w_1, \\cdots, w_v, \\cdots}\\), , å…¶ä¸­ \\(w_v\\) æ˜¯ç¬¬ \\(v\\) ä¸ªå•è¯, \\(v=1,2, \\cdots, V, V\\) æ˜¯å•è¯çš„ä¸ªæ•°ã€‚äºŒæ˜¯æ–‡æœ¬é›†åˆ \\(D={\\mathbf{w}_1, \\cdots, \\mathbf{w}_m, \\cdots, \\mathbf{w}_M}\\), å…¶ä¸­ \\(\\mathbf{w}_m\\) æ˜¯ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬, \\(m=1,2, \\cdots, M, M\\) æ˜¯æ–‡æœ¬ çš„ä¸ªæ•°ã€‚æ–‡æœ¬ \\(\\mathbf{w}_m\\) æ˜¯ä¸€ä¸ªå•è¯åºåˆ— \\(\\mathbf{w}_m=\\left(w_{m 1}, \\cdots, w_{m n}, \\cdots, w_{m N_m}\\right)\\), å…¶ä¸­ \\(w_{m n}\\) æ˜¯ æ–‡æœ¬ \\(\\mathbf{w}_m\\) çš„ç¬¬ \\(n\\) ä¸ªå•è¯, \\(n=1,2, \\cdots, N_m, N_m\\) æ˜¯æ–‡æœ¬ \\(\\mathbf{w}_m\\) ä¸­å•è¯çš„ä¸ªæ•°ã€‚ä¸‰æ˜¯ä¸»é¢˜é›†åˆé›†åˆ \\(Z={z_1, \\cdots, z_k, \\cdots, z_K}\\), å…¶ä¸­ \\(z_k\\) æ˜¯ç¬¬ \\(k\\) ä¸ªè¯é¢˜, \\(k=1,2, \\cdots, K, K\\) æ˜¯è¯é¢˜çš„ä¸ªæ•°ã€‚ æ¯ä¸€ä¸ªè¯é¢˜ \\(z_k\\) ç”±ä¸€ä¸ªå•è¯çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(p\\left(w \\mid z_k\\right)\\) å†³å®š, \\(w \\in W\\) ã€‚åˆ†å¸ƒ \\(p\\left(w \\mid z_k\\right)\\) æœä»å¤šé¡¹åˆ†å¸ƒ (ä¸¥æ ¼æ„ä¹‰ä¸Šç±»åˆ«åˆ†å¸ƒ), å…¶å‚æ•°ä¸º \\(\\varphi_k\\) ã€‚å‚æ•° \\(\\varphi_k\\) æœä»ç‹„åˆ©å…‹é›·åˆ†å¸ƒ (å…ˆéªŒåˆ†å¸ƒ), å…¶è¶…å‚æ•°ä¸º \\(\\beta\\) ã€‚å‚æ•° \\(\\varphi_k\\) æ˜¯ä¸€ä¸ª \\(V\\) ç»´å‘é‡ \\(\\varphi_k=\\left(\\varphi_{k 1}, \\varphi_{k 2}, \\cdots, \\varphi_{k V}\\right)\\), å…¶ä¸­ \\(\\varphi_{k v}\\) è¡¨ç¤ºè¯é¢˜ \\(z_k\\) ç”Ÿæˆå•è¯ \\(w_v\\) çš„æ¦‚ç‡ã€‚æ‰€æœ‰è¯é¢˜çš„å‚æ•°å‘é‡æ„æˆä¸€ä¸ª \\(K \\times V\\) çŸ©é˜µ \\(\\varphi=\\{\\varphi_k\\}_{k=1}^K\\) ã€‚è¶…å‚æ•° \\(\\beta\\) ä¹Ÿæ˜¯ä¸€ä¸ª \\(V\\) ç»´å‘é‡ \\(\\beta=\\left(\\beta_1, \\beta_2, \\cdots, \\beta_V\\right)\\_{\\text {ã€‚ }}\\)(å¯¹äºè¯é¢˜\\(z_k\\)å…¶ç”Ÿæˆå•è¯\\(w_v\\)å…ˆéªŒæœä»ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼Œå› æ­¤æ˜¯ä¸€ä¸ªVç»´å‘é‡) æ¯ä¸€ä¸ªæ–‡æœ¬ \\(\\mathbf{w}_m\\) ç”±ä¸€ä¸ªè¯é¢˜çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(p\\left(z \\mid \\mathbf{w}_m\\right)\\) å†³å®š, \\(z \\in Z_{\\text {ã€‚ }}\\) åˆ†å¸ƒ \\(p\\left(z \\mid \\mathbf{w}_m\\right)\\) æœä»å¤šé¡¹åˆ†å¸ƒ (ä¸¥æ ¼æ„ä¹‰ä¸Šç±»åˆ«åˆ†å¸ƒ), å…¶å‚æ•°ä¸º \\(\\theta_m\\) ã€‚å‚æ•° \\(\\theta_m\\) æœä»ç‹„åˆ©å…‹é›·åˆ†å¸ƒ (å…ˆéªŒåˆ†å¸ƒ), å…¶è¶…å‚æ•°ä¸º \\(\\alpha\\) , å‚æ•° \\(\\theta_m\\) æ˜¯ä¸€ä¸ª \\(K\\) ç»´å‘é‡ \\(\\theta_m=\\left(\\theta_{m 1}, \\theta_{m 2}, \\cdots, \\theta_{m K}\\right)\\), å…¶ä¸­ \\(\\theta_{m k}\\) è¡¨ç¤ºæ–‡æœ¬ \\(\\mathrm{w}_m\\) ç”Ÿæˆè¯é¢˜ \\(z_k\\) çš„æ¦‚ç‡ã€‚æ‰€æœ‰æ–‡æœ¬çš„å‚æ•°å‘é‡æ„æˆä¸€ä¸ª \\(M \\times K\\) çŸ©é˜µ \\(\\theta=\\{\\theta_m\\}_{m=1}^M\\) ã€‚è¶…å‚æ•° \\(\\alpha\\) ä¹Ÿæ˜¯ä¸€ä¸ª \\(K\\) ç»´å‘é‡ \\(\\alpha=\\left(\\alpha_1, \\alpha_2, \\cdots, \\alpha_K\\right)\\) ã€‚ æ¯ä¸€ä¸ªæ–‡æœ¬ \\(\\mathbf{w}_m\\) ä¸­çš„æ¯ä¸€ä¸ªå•è¯ \\(w_{m n}\\) ç”±è¯¥æ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒ \\(p\\left(z \\mid \\mathbf{w}_m\\right)\\) ä»¥åŠæ‰€æœ‰è¯ é¢˜çš„å•è¯åˆ†å¸ƒ \\(p\\left(w \\mid z_k\\right)\\) å†³å®šã€‚ ç”Ÿæˆè¿‡ç¨‹ LDA æ–‡æœ¬é›†åˆçš„ç”Ÿæˆè¿‡ç¨‹å¦‚ä¸‹: ç»™å®šå•è¯é›†åˆ \\(W\\), æ–‡æœ¬é›†åˆ \\(D\\), è¯é¢˜é›†åˆ \\(Z\\), ç‹„åˆ©å…‹é›·åˆ†å¸ƒçš„è¶…å‚æ•° \\(\\alpha\\) å’Œ \\(\\beta\\) ã€‚ 1.ç”Ÿæˆå•è¯åˆ†å¸ƒ éšæœºç”Ÿæˆ \\(K\\) ä¸ªè¯é¢˜çš„å•è¯åˆ†å¸ƒã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹, æŒ‰ç…§ç‹„åˆ©å…‹é›·åˆ†å¸ƒ \\(\\operatorname{Dir}(\\beta)\\) éšæœº ç”Ÿæˆä¸€ä¸ªå‚æ•°å‘é‡ \\(\\varphi_k, \\varphi_k \\sim \\operatorname{Dir}(\\beta)\\), ä½œä¸ºè¯é¢˜ \\(z_k\\) çš„å•è¯åˆ†å¸ƒ \\(p\\left(w \\mid z_k\\right), w \\in W, k=\\) \\(1,2, \\cdots, K\\) ã€‚ 2.ç”Ÿæˆä¸»é¢˜åˆ†å¸ƒ éšæœºç”Ÿæˆ \\(M\\) ä¸ªæ–‡æœ¬çš„ä¸»é¢˜åˆ†å¸ƒã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹: æŒ‰ç…§ç‹„åˆ©å…‹é›·åˆ†å¸ƒ \\(\\operatorname{Dir}(\\alpha)\\) éš æœºç”Ÿæˆä¸€ä¸ªå‚æ•°å‘é‡ \\(\\theta_m, \\theta_m \\sim \\operatorname{Dir}(\\alpha)\\), ä½œä¸ºæ–‡æœ¬ \\(\\mathbf{w}_m\\) çš„ä¸»é¢˜åˆ†å¸ƒ \\(p\\left(z \\mid \\mathbf{w}_m\\right), m=\\) \\(1,2, \\cdots, M_{}\\) ã€‚ 3.ç”Ÿæˆæ–‡æœ¬çš„å•è¯åºåˆ— éšæœºç”Ÿæˆ \\(M\\) ä¸ªæ–‡æœ¬çš„ \\(N_m\\) ä¸ªå•è¯ã€‚æ–‡æœ¬ \\(\\mathbf{w}_m(m=1,2, \\cdots, M)\\) çš„å•è¯ \\(w_{m n}(n=\\) \\(\\left.1,2, \\cdots, N_m\\right)\\) çš„ç”Ÿæˆè¿‡ç¨‹å¦‚ä¸‹: 3.1 é¦–å…ˆæŒ‰ç…§å¤šé¡¹åˆ†å¸ƒ \\(\\operatorname{Mult}\\left(\\theta_m\\right)\\) éšæœºç”Ÿæˆä¸€ä¸ªè¯é¢˜ \\(z_{m n}, z_{m n} \\sim \\operatorname{Mult}\\left(\\theta_m\\right)\\) 3.2 ç„¶åæŒ‰ç…§å¤šé¡¹åˆ†å¸ƒ \\(\\operatorname{Mult}\\left(\\varphi_{z_{m n}}\\right)\\) éšæœºç”Ÿæˆä¸€ä¸ªå•è¯ \\(w_{m n}, w_{m n} \\sim \\operatorname{Mult}\\left(\\varphi_{z_{m n}}\\right)\\_{\\text {ã€‚ }}\\) æ–‡æœ¬ \\(\\mathbf{w}_m\\) æœ¬èº«æ˜¯å•è¯åºåˆ— \\(\\mathbf{w}_m=\\left(w_{m 1}, w_{m 2}, \\cdots, w_{m N_m}\\right)\\), å¯¹åº”ç€éšå¼çš„è¯é¢˜åºåˆ— \\(\\mathbf{z}_m=\\left(z_{m 1}, z_{m 2}, \\cdots, z_{m N_m}\\right) ã€‚\\) å¼•ç”¨ä¸€ä¸‹LDAæ•°å­¦å…«å¦çš„å›¾ï¼š \\(\\vec{\\alpha} \\rightarrow \\vec{\\theta}_m \\rightarrow z_{m, n}\\), è¿™ä¸ªè¿‡ç¨‹è¡¨ç¤ºåœ¨ç”Ÿæˆç¬¬ \\(m\\) ç¯‡æ–‡æ¡£çš„æ—¶å€™ï¼Œå…ˆä»ç¬¬ä¸€ä¸ªå›å­ä¸­æŠ½äº†ä¸€ä¸ªdoc-topic éª°å­ \\(\\vec{\\theta}_m\\),ç„¶åæŠ•è¿™ä¸ªéª°å­ç”Ÿæˆäº†æ–‡æ¡£\\(m\\)ä¸­ç¬¬ \\(n\\) ä¸ªè¯çš„topicç¼–å· \\(z_{m, n}\\) ï¼› \\(\\vec{\\beta} \\rightarrow \\vec{\\varphi}_k \\rightarrow w_{m, n} \\mid k=z_{m, n}\\), è¿™ä¸ªè¿‡ç¨‹è¡¨ç¤ºç”¨å¦‚ä¸‹åŠ¨ä½œç”Ÿæˆè¯­æ–™ä¸­ç¬¬ \\(m\\) ç¯‡æ–‡æ¡£çš„ç¬¬ \\(n\\) ä¸ªè¯: åœ¨ä¸Šå¸æ‰‹å¤´çš„ \\(K\\) ä¸ªtopic-word éª°å­ \\(\\vec{\\varphi}_k\\) ä¸­ï¼ŒæŒ‘é€‰ç¼–å·ä¸º \\(k=z_{m, n}\\) çš„é‚£ä¸ªéª°å­è¿›è¡ŒæŠ•æ·ï¼Œç„¶åç”Ÿæˆ word \\(w_{m, n}\\) ; ç†è§£ LDAæœ€é‡è¦çš„å°±æ˜¯ç†è§£è¿™ä¸¤ä¸ªç‰©ç†è¿‡ç¨‹ã€‚LDA æ¨¡å‹åœ¨åŸºäº \\(K\\) ä¸ª topic ç”Ÿæˆè¯­æ–™ä¸­çš„ \\(M\\) ç¯‡æ–‡æ¡£çš„è¿‡ç¨‹ä¸­ï¼Œ ç”±äºæ˜¯ bag-of-words æ¨¡å‹ï¼Œæœ‰ä¸€äº›ç‰©ç†è¿‡ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹å¯äº¤æ¢çš„ã€‚ç”±æ­¤ï¼ŒLDAç”Ÿæˆæ¨¡å‹ä¸­ï¼Œ \\(M\\) ç¯‡æ–‡æ¡£ä¼šå¯¹åº” äº \\(M\\) ä¸ªç‹¬ç«‹çš„ Dirichlet-Multinomial å…±è½­ç»“æ„ï¼›Kä¸ª ä¸ª topic ä¼šå¯¹åº”äº \\(K\\) ä¸ªç‹¬ç«‹çš„ Dirichlet-Multinomial å…±è½­ç»“ æ„ã€‚æ‰€ä»¥ç†è§£ LDA æ‰€éœ€è¦çš„æ‰€æœ‰æ•°å­¦å°±æ˜¯ç†è§£ Dirichlet-Multiomail å…±è½­ï¼Œå…¶å®ƒéƒ½å°±æ˜¯ç†è§£ç‰©ç†è¿‡ç¨‹ã€‚ æ€»ç»“ å¯¹äºè¯é¢˜ \\(z_k(k=1,2, \\cdots, K)\\) : ç”Ÿæˆå¤šé¡¹åˆ†å¸ƒå‚æ•° \\(\\varphi_k \\sim \\operatorname{Dir}(\\beta)\\), ä½œä¸ºè¯é¢˜çš„å•è¯åˆ†å¸ƒ \\(p\\left(w \\mid z_k\\right)\\); å¯¹äºæ–‡æœ¬ \\(\\mathbf{w}_m(m=1,2, \\cdots, M)\\); ç”Ÿæˆå¤šé¡¹åˆ†å¸ƒå‚æ•° \\(\\theta_m \\sim \\operatorname{Dir}(\\alpha)\\), ä½œä¸ºæ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒ \\(p\\left(z \\mid \\mathb","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:6","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ¦‚ç‡è®¡ç®— LDA æ¨¡å‹æ•´ä½“æ˜¯ç”±è§‚æµ‹å˜é‡å’Œéšå˜é‡ç»„æˆçš„è”åˆæ¦‚ç‡åˆ†å¸ƒ, å¯ä»¥è¡¨ä¸º \\[ p(\\mathbf{w}, \\mathbf{z}, \\theta, \\varphi \\mid \\alpha, \\beta)=\\prod_{k=1}^K p\\left(\\varphi_k \\mid \\beta\\right) \\prod_{m=1}^M p\\left(\\theta_m \\mid \\alpha\\right) \\prod_{n=1}^{N_m} p\\left(z_{m n} \\mid \\theta_m\\right) p\\left(w_{m n} \\mid z_{m n}, \\varphi\\right) \\] (å…¶ä¸­Mä¸ºæ–‡æœ¬æ•°ï¼Œ\\(N_m\\)ä¸ºæ–‡æ¡£mçš„é•¿åº¦ï¼ŒKä¸ºä¸»é¢˜æ•°) å…¶ä¸­è§‚æµ‹å˜é‡ \\(\\mathrm{w}\\) è¡¨ç¤ºæ‰€æœ‰æ–‡æœ¬ä¸­çš„å•è¯åºåˆ—, éšå˜é‡ \\(\\mathrm{z}\\) è¡¨ç¤ºæ‰€æœ‰æ–‡æœ¬ä¸­çš„è¯é¢˜åºåˆ—, éšå˜é‡ \\(\\theta\\) è¡¨ç¤ºæ‰€æœ‰æ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒçš„å‚æ•°, éšå˜é‡ \\(\\varphi\\) è¡¨ç¤ºæ‰€æœ‰è¯é¢˜çš„å•è¯åˆ†å¸ƒçš„å‚ æ•°, \\(\\alpha\\) å’Œ \\(\\beta\\) æ˜¯è¶…å‚æ•°ã€‚ \\(p\\left(\\varphi_k \\mid \\beta\\right)\\) è¡¨ç¤ºè¶…å‚æ•° \\(\\beta\\) ç»™å®šæ¡ä»¶ä¸‹ç¬¬ \\(k\\) ä¸ªè¯é¢˜çš„å•è¯åˆ†å¸ƒçš„å‚æ•° \\(\\varphi_k\\) çš„ç”Ÿæˆæ¦‚ç‡; \\(p\\left(\\theta_m \\mid \\alpha\\right)\\) è¡¨ç¤ºè¶…å‚æ•° \\(\\alpha\\) ç»™å®šæ¡ä»¶ä¸‹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒçš„ å‚æ•° \\(\\theta_m\\) çš„ç”Ÿæˆæ¦‚ç‡; \\(p\\left(z_{m n} \\mid \\theta_m\\right)\\) è¡¨ç¤ºç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„è¯é¢˜åˆ†å¸ƒ \\(\\theta_m\\) ç»™å®šæ¡ä»¶ä¸‹æ–‡æœ¬çš„ ç¬¬ \\(n\\) ä¸ªä½ç½®çš„è¯é¢˜ \\(z_{m n}\\) çš„ç”Ÿæˆæ¦‚ç‡; \\(p\\left(w_{m n} \\mid z_{m n}, \\varphi\\right)\\) è¡¨ç¤ºåœ¨ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„ç¬¬ \\(n\\) ä¸ªä½ ç½®çš„è¯é¢˜ \\(z_{m n}\\) åŠæ‰€æœ‰è¯é¢˜çš„å•è¯åˆ†å¸ƒçš„å‚æ•° \\(\\varphi\\) ç»™å®šæ¡ä»¶ä¸‹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„ç¬¬ \\(n\\) ä¸ªä½ ç½®çš„å•è¯ \\(w_{m n}\\) çš„ç”Ÿæˆæ¦‚ç‡ã€‚ ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„è”åˆæ¦‚ç‡åˆ†å¸ƒå¯ä»¥è¡¨ä¸º \\[ p\\left(\\mathbf{w}_m, \\mathbf{z}_m, \\theta_m, \\varphi \\mid \\alpha, \\beta\\right)=\\prod_{k=1}^K p\\left(\\varphi_k \\mid \\beta\\right) p\\left(\\theta_m \\mid \\alpha\\right) \\prod_{n=1}^{N_m} p\\left(z_{m n} \\mid \\theta_m\\right) p\\left(w_{m n} \\mid z_{m n}, \\varphi\\right) \\] å…¶ä¸­ \\(\\mathbf{w}_m\\) è¡¨ç¤ºè¯¥æ–‡æœ¬ä¸­çš„å•è¯åºåˆ—, \\(\\mathbf{z}_m\\) è¡¨ç¤ºè¯¥æ–‡æœ¬çš„è¯é¢˜åºåˆ—, \\(\\theta_m\\) è¡¨ç¤ºè¯¥æ–‡æœ¬çš„è¯ é¢˜åˆ†å¸ƒå‚æ•°ã€‚ LDA æ¨¡å‹çš„è”åˆåˆ†å¸ƒå«æœ‰éšå˜é‡, å¯¹éšå˜é‡è¿›è¡Œç§¯åˆ†å¾—åˆ°è¾¹ç¼˜åˆ†å¸ƒã€‚ å‚æ•° \\(\\theta_m\\) å’Œ \\(\\varphi\\) ç»™å®šæ¡ä»¶ä¸‹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„ç”Ÿæˆæ¦‚ç‡æ˜¯ \\[ p\\left(\\mathbf{w}_m \\mid \\theta_m, \\varphi\\right)=\\prod_{n=1}^{N_m}\\left[\\sum_{k=1}^K p\\left(z_{m n}=k \\mid \\theta_m\\right) p\\left(w_{m n} \\mid \\varphi_k\\right)\\right] \\] è¶…å‚æ•° \\(\\alpha\\) å’Œ \\(\\beta\\) ç»™å®šæ¡ä»¶ä¸‹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬çš„ç”Ÿæˆæ¦‚ç‡æ˜¯ \\[ p\\left(\\mathbf{w}_m \\mid \\alpha, \\beta\\right)=\\prod_{k=1}^K \\int p\\left(\\varphi_k \\mid \\beta\\right)\\left[\\int p\\left(\\theta_m \\mid \\alpha\\right) \\prod_{n=1}^{N_m}\\left[\\sum_{l=1}^K p\\left(z_{m n}=l \\mid \\theta_m\\right) p\\left(w_{m n} \\mid \\varphi_l\\right)\\right] \\mathrm{d} \\theta_m\\right] \\mathrm{d} \\varphi_k \\] è¶…å‚æ•° \\(\\alpha\\) å’Œ \\(\\beta\\) ç»™å®šæ¡ä»¶ä¸‹æ‰€æœ‰æ–‡æœ¬çš„ç”Ÿæˆæ¦‚ç‡æ˜¯ \\[ p(\\mathbf{w} \\mid \\alpha, \\beta)=\\prod_{k=1}^K \\int p\\left(\\varphi_k \\mid \\beta\\right)\\left[\\prod_{m=1}^M \\int p\\left(\\theta_m \\mid \\alpha\\right) \\prod_{n=1}^{N_m}\\left[\\sum_{l=1}^K p\\left(z_{m n}=l \\mid \\theta_m\\right) p\\left(w_{m n} \\mid \\varphi_l\\right)\\right] \\mathrm{d} \\theta_m\\right] \\mathrm{d} \\varphi_k \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:7","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å‰å¸ƒæ–¯æŠ½æ · åŸºæœ¬æ€æƒ³ æœ‰ä¸‰ä¸ªä¸»è¦ç›®æ ‡ï¼š - è¯é¢˜åºåˆ—çš„é›†åˆ\\(z=(z_1, z_2, \\cdots, z_M)\\)çš„åéªŒæ¦‚ç‡åˆ†å¸ƒï¼Œå…¶ä¸­\\(z_m\\)æ˜¯ç¬¬mä¸ªæ–‡æœ¬çš„ä¸»é¢˜åºåˆ—ï¼Œ\\(z_m=(z_{m1}, \\cdots, z_{mN_{m}})\\); - å‚æ•°\\(\\theta=(\\theta_1, \\cdots, \\theta_{M})\\)ï¼Œå…¶ä¸­\\(\\theta_m\\)æ˜¯ç¬¬mä¸ªæ–‡æœ¬çš„ä¸»é¢˜åˆ†å¸ƒçš„å‚æ•°ï¼› - å‚æ•°\\(\\varphi=(\\varphi_1, \\cdots, \\varphi_K)\\)ï¼Œå…¶ä¸­\\(\\varphi_k\\)æ˜¯ç¬¬kä¸ªä¸»é¢˜çš„å•è¯åˆ†å¸ƒçš„å‚æ•°ã€‚ å¯¹\\(p(\\mathbf{w}, \\mathbf{z}, \\theta, \\varphi \\mid \\alpha, \\beta)\\)è¿›è¡Œä¼°è®¡ å‰å¸ƒæ–¯æŠ½æ ·, è¿™æ˜¯ä¸€ç§å¸¸ç”¨çš„é©¬å°”å¯å¤«é“¾è’™ç‰¹å¡ç½—æ³•ã€‚ä¸ºäº†ä¼°è®¡ å¤šå…ƒéšæœºå˜é‡ \\(x\\) çš„è”åˆåˆ†å¸ƒ \\(p(x)\\), å‰å¸ƒæ–¯æŠ½æ ·æ³•é€‰æ‹© \\(x\\) çš„ä¸€ä¸ªåˆ†é‡, å›ºå®šå…¶ä»–åˆ†é‡, æŒ‰ç…§å…¶æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒè¿›è¡ŒéšæœºæŠ½æ ·, ä¾æ¬¡å¾ªç¯å¯¹æ¯ä¸€ä¸ªåˆ†é‡æ‰§è¡Œè¿™ä¸ªæ“ä½œ, å¾—åˆ°è”åˆ åˆ†å¸ƒ \\(p(x)\\) çš„ä¸€ä¸ªéšæœºæ ·æœ¬, é‡å¤è¿™ä¸ªè¿‡ç¨‹, åœ¨ç‡ƒçƒ§æœŸä¹‹å, å¾—åˆ°è”åˆæ¦‚ç‡åˆ†å¸ƒ \\(p(x)\\) çš„ æ ·æœ¬é›†åˆã€‚ LDA æ¨¡å‹çš„å­¦ä¹ é€šå¸¸é‡‡ç”¨æ”¶ç¼©çš„å‰å¸ƒæ–¯æŠ½æ · (collapsed Gibbs sampling) , åŸºæœ¬æƒ³æ³•æ˜¯, é€šè¿‡å¯¹éšå˜é‡ \\(\\theta\\) å’Œ \\(\\varphi\\) ç§¯åˆ†, å¾—åˆ°è¾¹ç¼˜æ¦‚ç‡åˆ†å¸ƒ \\(p(\\mathbf{w}, \\mathbf{z} \\mid \\alpha, \\beta)\\) (ä¹Ÿæ˜¯è”åˆåˆ† å¸ƒ), å…¶ä¸­å˜é‡ \\(\\mathbf{w}\\) æ˜¯å¯è§‚æµ‹çš„, å˜é‡ \\(\\mathbf{z}\\) æ˜¯ä¸å¯è§‚æµ‹çš„; å¯¹åéªŒæ¦‚ç‡åˆ†å¸ƒ \\(p(\\mathbf{z} \\mid \\mathbf{w}, \\alpha, \\beta)\\) è¿› è¡Œå‰å¸ƒæ–¯æŠ½æ ·, å¾—åˆ°åˆ†å¸ƒ \\(p(\\mathbf{z} \\mid \\mathbf{w}, \\alpha, \\beta)\\) çš„æ ·æœ¬é›†åˆ; å†åˆ©ç”¨è¿™ä¸ªæ ·æœ¬é›†åˆå¯¹å‚æ•° \\(\\theta\\) å’Œ \\(\\varphi\\) è¿›è¡Œä¼°è®¡, æœ€ç»ˆå¾—åˆ° LDA æ¨¡å‹ \\(p(\\mathbf{w}, \\mathbf{z}, \\theta, \\varphi \\mid \\alpha, \\beta)\\) çš„æ‰€æœ‰å‚æ•°ä¼°è®¡ã€‚ #### ç®—æ³•æµç¨‹ è¾“å…¥: æ–‡æœ¬çš„å•è¯åºåˆ— \\(\\mathbf{w}=\\{\\mathbf{w}_1, \\cdots, \\mathbf{w}_m, \\cdots, \\mathbf{w}_M\\}, \\mathbf{w}_m=\\left(w_{m 1}, \\cdots, w_{m n}, \\cdots\\right.\\), \\(\\left.w_{m_{N_m}}\\right)\\); è¾“å‡º: æ–‡æœ¬çš„è¯é¢˜åºåˆ— \\(\\mathrm{z}=\\{\\mathbf{z}_1, \\cdots, \\mathbf{z}_m, \\cdots, \\mathbf{z}_M\\}, \\mathbf{z}_m=\\left(z_{m 1}, \\cdots, z_{m n}, \\cdots, z_{m_{N_m}}\\right)\\) çš„åéªŒæ¦‚ç‡åˆ†å¸ƒ \\(p(\\mathbf{z} \\mid \\mathbf{w}, \\alpha, \\beta)\\) çš„æ ·æœ¬è®¡æ•°, æ¨¡å‹çš„å‚æ•° \\(\\varphi\\) å’Œ \\(\\theta\\) çš„ä¼°è®¡å€¼; å‚æ•°: è¶…å‚æ•° \\(\\alpha\\) å’Œ \\(\\beta\\), è¯é¢˜ä¸ªæ•° \\(K\\) ã€‚ è®¾æ‰€æœ‰è®¡æ•°çŸ©é˜µçš„å…ƒç´  \\(n_{m k}, n_{k v}\\), è®¡æ•°å‘é‡çš„å…ƒç´  \\(n_m, n_k\\) åˆå€¼ä¸º 0 ; å¯¹æ‰€æœ‰æ–‡æœ¬ \\(\\mathbf{w}_m, m=1,2, \\cdots, M\\) å¯¹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬ä¸­çš„æ‰€æœ‰å•è¯ \\(w_{m n}, n=1,2, \\cdots, N_m\\) æŠ½æ ·è¯é¢˜ \\(z_{m n}=z_k \\sim \\operatorname{Mult}\\left(\\frac{1}{K}\\right)\\);(å¯¹äºæ–‡æœ¬mï¼Œå…¶å¤šé¡¹åˆ†å¸ƒçš„å‚æ•°ä¸º\\(\\frac{1}{K}\\)ï¼Œç”±\\(\\alpha\\)ç”Ÿæˆï¼Œå³\\(\\theta_m \\sim Dir(\\alpha)\\)ï¼Œ\\(\\theta_m\\)ä¸ºé•¿åº¦ä¸ºKçš„å‘é‡ã€‚) å¢åŠ æ–‡æœ¬-è¯é¢˜è®¡æ•° \\(n_{m k}=n_{m k}+1\\), å¢åŠ æ–‡æœ¬-è¯é¢˜å’Œè®¡æ•° \\(n_m=n_m+1\\), å¢åŠ è¯é¢˜-å•è¯è®¡æ•° \\(n_{k v}=n_{k v}+1\\), å¢åŠ è¯é¢˜-å•è¯å’Œè®¡æ•° \\(n_k=n_k+1\\); ï¼ˆ3ï¼‰å¾ªç¯æ‰§è¡Œä»¥ä¸‹æ“ä½œ, ç›´åˆ°è¿›å…¥ç‡ƒçƒ§æœŸ å¯¹æ‰€æœ‰æ–‡æœ¬ \\(\\mathbf{w}_m, m=1,2, \\cdots, M\\) å¯¹ç¬¬ \\(m\\) ä¸ªæ–‡æœ¬ä¸­çš„æ‰€æœ‰å•è¯ \\(w_{m n}, n=1,2, \\cdots, N_m\\) å½“å‰çš„å•è¯ \\(w_{m n}\\) æ˜¯ç¬¬ \\(v\\) ä¸ªå•è¯, è¯é¢˜æŒ‡æ´¾ \\(z_{m n}\\) æ˜¯ç¬¬ \\(k\\) ä¸ªè¯é¢˜; å‡å°‘è®¡æ•° \\(n_{m k}=n_{m k}-1, n_m=n_m-1, n_{k v}=n_{k v}-1, n_k=n_k-1\\); æŒ‰ç…§æ»¡æ¡ä»¶åˆ†å¸ƒè¿›è¡ŒæŠ½æ · \\[ p\\left(z_i \\mid \\mathbf{z}_{-i}, \\mathbf{w}, \\alpha, \\beta\\right) \\propto \\frac{n_{k v}+\\beta_v}{\\sum_{v=1}^V\\left(n_{k v}+\\beta_v\\right)} \\cdot \\frac{n_{m k}+\\alpha_k}{\\sum_{k=1}^K\\left(n_{m k}+\\alpha_k\\right)} \\] å¾—åˆ°æ–°çš„ç¬¬ \\(k^{\\prime}\\) ä¸ªè¯é¢˜, åˆ†é…ç»™ \\(z_{m n}\\); å¢åŠ è®¡æ•° \\(n_{m k^{\\prime}}=n_{m k^{\\prime}}+1, n_m=n_m+1, n_{k^{\\prime} v}=n_{k^{\\prime} v}+1, n_{k^{\\prime}}=n_{k^{\\prime}}+1\\); å¾—åˆ°æ›´æ–°çš„ä¸¤ä¸ªè®¡æ•°çŸ©é˜µ \\(N_{K \\times V}=\\left[n_{k v}\\right]\\) å’Œ \\(N_{M \\times K}=\\left[n_{m k}\\right]\\), è¡¨ç¤ºåéªŒ æ¦‚ç‡åˆ†å¸ƒ \\(p(\\mathbf{z} \\mid \\mathbf{w}, \\alpha, \\beta)\\) çš„æ ·æœ¬è®¡æ•°; åˆ©ç”¨å¾—åˆ°çš„æ ·æœ¬è®¡æ•°, è®¡ç®—æ¨¡å‹å‚æ•° \\[ \\begin{aligned} \\theta_{m k} \u0026=\\frac{n_{m k}+\\alpha_k}{\\sum_{k=1}^K\\left(n_{m k}+\\alpha_k\\right)} \\\\\\\\ \\varphi_{k v} \u0026=\\frac{n_{k v}+\\beta_v}{\\sum_{v=1}^V\\left(n_{k v}+\\beta_v\\right)} \\end{aligned} \\] ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:8","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"è®­ç»ƒä¸æ¨æ–­ æœ‰äº†LDAæ¨¡å‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æœ‰ä¸¤ä¸ªï¼š ä¼°è®¡æ¨¡å‹ä¸­çš„å‚æ•°\\(\\varphi_1, \\cdots, \\varphi_K\\)å’Œ\\(\\theta_1, \\cdots, \\theta_M\\); å¯¹äºæ–°æ¥çš„ä¸€ç¯‡docï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—è¿™ç¯‡æ–‡æ¡£çš„topicåˆ†å¸ƒ\\(\\theta_{new}\\)ã€‚ æœ‰äº†å‰å¸ƒæ–¯é‡‡æ ·å…¬å¼å°±å¯ä»¥åŸºäºè¯­æ–™è®­ç»ƒLDAæ¨¡å‹ï¼Œå¹¶åº”ç”¨è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹å¯¹æ–°çš„æ–‡æ¡£è¿›è¡Œtopicè¯­ä¹‰åˆ†æï¼Œè®­ç»ƒçš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡Gibbs Sampingè·å–è¯­æ–™ä¸­çš„ï¼ˆz,wï¼‰æ ·æœ¬ï¼Œè€Œæ¨¡å‹ä¸­çš„æ‰€æœ‰å‚æ•°å¯ä»¥åŸºäºé‡‡æ ·çš„æ ·æœ¬è¿›è¡Œä¼°è®¡ã€‚ è®­ç»ƒæµç¨‹å¦‚ä¸‹ï¼š éšæœºåˆå§‹åŒ–ï¼šå¯¹è¯­æ–™ä¸­çš„æ¯ç¯‡æ–‡æ¡£çš„æ¯ä¸ªè¯wï¼Œéšæœºèµ‹ä¸€ä¸ªtopicç¼–å·zã€‚ é‡æ–°æ‰«æè¯­æ–™åº“ï¼Œå¯¹æ¯ä¸ªè¯æŒ‰ç…§å‰å¸ƒæ–¯é‡‡æ ·å…¬å¼é‡æ–°é‡‡æ ·å®ƒçš„topicï¼Œåœ¨è¯­æ–™ä¸­è¿›è¡Œæ›´æ–°ã€‚ é‡å¤ä»¥ä¸Šè¯­æ–™åº“çš„é‡æ–°é‡‡æ ·è¿‡ç¨‹ç›´åˆ°å‰å¸ƒæ–¯é‡‡æ ·æ”¶æ•›ã€‚ ç»Ÿè®¡è¯­æ–™åº“çš„topic-wordå…±ç°é¢‘ç‡çŸ©é˜µï¼Œå°±æ˜¯LDAçš„æ¨¡å‹ ç”±è¿™ä¸ªçŸ©é˜µæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸€ä¸ª\\(p(word\\mid topic)\\)æ¦‚ç‡ï¼Œä»è€Œè®¡ç®—å‡ºæ¨¡å‹å‚æ•°\\(\\varphi_1, \\cdots, \\varphi_K\\)ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å¦ä¸€ä¸ªå‚æ•°\\(\\theta_1, \\cdots, \\theta_M\\)ï¼Œåªè¦åœ¨å‰å¸ƒæ–¯æŠ½æ ·æ”¶æ•›åç»Ÿè®¡æ¯ç¯‡æ–‡ç« çš„topicé¢‘ç‡åˆ†å¸ƒï¼Œå°±å¯ä»¥è®¡ç®—æ¯ä¸€ä¸ª\\(p(topic\\mid doc)\\)æ¦‚ç‡ï¼Œç”±äºå®ƒæ˜¯å’Œè®­ç»ƒè¯­æ–™çš„æ¯ç¯‡æ–‡ç« ç›¸å…³çš„ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£æ–°çš„æ–‡æ¡£æ¯«æ— ç”¨å¤„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ²¡æœ‰å¿…è¦ä¿ç•™è¿™ä¸ªæ¦‚ç‡ã€‚ å¦‚ä½•å¯¹æ–°çš„æ–‡æ¡£è¿›è¡Œæ¨æ–­å‘¢ï¼Ÿå…¶å®å’Œè®­ç»ƒè¿‡ç¨‹å®Œå…¨ç›¸ä¼¼ï¼Œå¯¹äºæ–°çš„æ–‡æ¡£ï¼Œè®¤ä¸º\\(\\varphi_{kt}\\)æ˜¯ç¨³å®šä¸å˜çš„ï¼Œæ˜¯ç”±è®­ç»ƒè¯­æ–™å¾—åˆ°çš„æ¨¡å‹æä¾›çš„ã€‚é‡‡æ ·è¿‡ç¨‹åªä¼°è®¡è¯¥æ–‡æ¡£çš„topicåˆ†å¸ƒ\\(\\theta_{new}\\)å°±å¥½äº†ã€‚ æ¨æ–­è¿‡ç¨‹å¦‚ä¸‹ï¼š éšæœºåˆå§‹åŒ–ï¼šå¯¹å½“å‰æ–‡æ¡£çš„æ¯ä¸ªè¯wï¼Œéšæœºçš„èµ‹ä¸€ä¸ªtopicç¼–å·zï¼› é‡æ–°æ‰«æå½“å‰æ–‡æ¡£ï¼ŒæŒ‰ç…§å‰å¸ƒæ–¯æŠ½æ ·å…¬å¼ï¼Œå¯¹æ¯ä¸ªè¯wï¼Œé‡æ–°é‡‡æ ·å®ƒçš„topicï¼› é‡å¤ä»¥ä¸Šè¿‡ç¨‹ç›´åˆ°å‰å¸ƒæ–¯é‡‡æ ·æ”¶æ•› ç»Ÿè®¡æ–‡æ¡£ä¸­çš„topicåˆ†å¸ƒï¼Œè¯¥åˆ†å¸ƒå°±æ˜¯\\(\\theta_{new}\\) ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:9","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ä»£ç  å®ç°äº†å‰å¸ƒæ–¯æ¨æ–­çš„pythonä»£ç ï¼š \"\"\" LDA implementation in Python @author: Michael Zhang \"\"\" import matplotlib.pyplot as plt import numpy as np import scipy class LDA(object): def __init__(self, tdm, T, alpha = 1., beta=1., iteration=100): \"\"\" tdm: the copus, of (D, Num_words_in_corpus), the value of each entry is the counts of corresponding words in this the corresponding document. e.g. tdm[d, w] = number of word w appears in document d. T: the number of topics \"\"\" self.tdm = tdm self.D, self.W = self.tdm.shape self.alpha= alpha # count for expected value for hyper parameter alpha of theta, i.e. document-topic distribution. self.beta = beta # count for expected value for hyper parameter beta topic-word distribution. self.T = T self.iteration = iteration # z must take in (d,w,i) as input, corresponding to # topic indicator for i-th obserevation of word w in doc d self.z = {} self.topic_word_matrix = np.zeros((self.T, self.W)) # initialize the topic-word matrix. self.doc_topic_matrix = np.zeros((self.D, self.T)) # initialize the documnet-topic matrix. self.topic_counts = np.zeros(self.T) # initialize the topic counter for after sampling process, should be sum of value in self.topic_word_matrix self.doc_counts = np.zeros(self.D) # initialize the doc counter for after sampling process, should be sum of value in self.doc_topic_matrix self.log_likelihood = np.zeros(self.iteration) # store the value of log likelihood at each iteration self._init_matrix() # @pysnooper.snoop('init.log') def _init_matrix(self): \"\"\" for all words 1. sample a topic randomly from T topics for each word 2. increment topic word count, self.topic_word_matrix 3. increment document topic count, self.doc_topic_matrix 4. update the topic indicator z. \"\"\" for d in range(self.D): doc = scipy.sparse.coo_matrix(self.tdm[d]) word_freq_topic = zip(doc.col, doc.data) for w, frequency in word_freq_topic: # (word, freq) for i in range(frequency): ############ Finish the following initialization steps ############# # 1. sample a topic randomly from T topics for each word topic = np.random.randint(self.T) # 2. increment topic word count, self.topic_word_matrix self.topic_word_matrix[topic, w] += 1 # 3. increment document topic count, self.doc_topic_matrix self.doc_topic_matrix[d, topic] += 1 # 4. update the topic indicator z. self.z[(d, w, i)] = topic # d: document ID; w: word ID: i: instance IDï¼Œå³åœ¨dä¸­ç¬¬å‡ ä¸ªw self.topic_counts = self.topic_word_matrix.sum(axis=1) self.doc_counts = self.doc_topic_matrix.sum(axis=1) # @pysnooper.snoop('fit.log') def fit(self): for it in range(self.iteration): # iterate over all the documents for d in range(self.D): # iterate over all the words in d for w in self.tdm[d].indices: # iterate over number of times observed word w in doc d for i in range(self.tdm[d, w]): # we apply the hidden-varible method of Gibbs sampler, the hidden variable is z[(d,w,i)] self.doc_topic_matrix[d,self.z[(d,w,i)]] -= 1 self.doc_counts[d] -= 1 self.topic_word_matrix[self.z[(d,w,i)],w] -= 1 self.topic_counts[self.z[(d,w,i)]] -= 1 # estimation of phi and theta for the current corpus phi_hat = (self.topic_word_matrix[:,w] + self.beta) / (self.topic_counts + self.beta * self.W) theta_hat = (self.doc_topic_matrix[d,:] + self.alpha) / (self.doc_counts[d] + self.alpha * self.T) # calculate the full conditional distribution full_conditional = phi_hat * theta_hat # normalize full_conditional such that it summation equals to 1. full_conditional = full_conditional / full_conditional.sum() # sample a topic for i-th obserevation of word w in doc d based on full_conditional new_topic = np.random.multinomial(1, full_conditional).argmax() # update z, doc_topic_matrix, doc_counts, topic_word_matrix, topic_counts here. self.z[(d,w,i)] = new_topic self.doc_topic_matrix[d,self.z[(d,w,i)]] += 1 self.topic_word_matrix[self.z[(d,w,i)],w] += 1 self.doc_counts[d] += 1 self.topic_counts[self.z[(d,w,i)]] += 1 ############################################################ # Equation 2 log P(w|z) for each itera","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:10","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æœ¬è´¨ä¸ä½¿ç”¨æ¡ä»¶ æœ¬è´¨ä¸Šè¯´ï¼Œä¸»é¢˜æ¨¡å‹æ ¹æœ¬ä¸Šæ˜¯å®ç°æ–‡æœ¬æ•°æ®çš„ç»“æ„åŒ–ï¼Œç»“æ„åŒ–çš„æ–‡æ¡£å¯ä»¥å½¼æ­¤æ¯”è¾ƒå’ŒæŸ¥è¯¢ï¼Œå®ç°ä¼ ç»Ÿçš„ä»»åŠ¡ã€‚ LDAä¸»é¢˜æ¨¡å‹æœ¬è´¨ä¸Šè§£å†³äº†ä¸¤ç±»é—®é¢˜ï¼š - æ–‡æ¡£èšç±» - è¯æ±‡èšç±» ä¸»è¦ä»·å€¼åœ¨äºï¼š 1ï¼‰æ–‡æ¡£çš„ç»“æ„åŒ–ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„è¯è¢‹æ¨¡å‹è¾¾åˆ°äº†é™ç»´çš„æ•ˆæœ 2ï¼‰å®Œæˆäº†æ–‡æ¡£çš„èšç±»å’Œè¯æ±‡çš„èšç±»ï¼Œå®ç°æ–‡æœ¬ä¿¡æ¯çš„æŠ½è±¡åŒ–åˆ†æï¼Œå¸®åŠ©åˆ†æè€…æ¢ç´¢éšå«çš„è¯­ä¹‰å†…å®¹ã€‚ å®è·µä¸­æ•°æ®è¦æœ‰ä»¥ä¸‹æ€§è´¨æ‰ä¼šæœ‰è¾ƒå¥½çš„ç»“æœï¼š æ–‡æ¡£è¶³å¤Ÿå¤š æ–‡æ¡£è¶³å¤Ÿé•¿ è¯æ±‡ç‰¹å¾å¤Ÿå¤š è¯é¢‘è¶³å¤Ÿå¤§ ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:4:11","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ€»ç»“ å†æ—¶å¥½å‡ å‘¨ï¼Œç»ˆäºå®Œç»“äº†ä¸»é¢˜æ¨¡å‹ï¼Œä¸»è¦æ˜¯æ¦‚ç‡è®ºæ²¡æœ‰å­¦å¥½ï¼Œè·Ÿç€æ¨å¯¼çš„è¿‡ç¨‹è¿‡äºç—›è‹¦ï¼Œä¸è¿‡ä¹Ÿç®—æ˜¯ç¨å¾®ç†è§£äº†ä¸€ç‚¹LDAï¼Œå¤è¿°ä¸€ä¸‹ï¼š LDAç†è§£å¯ä»¥ç±»æ¯”äºPLSAï¼Œå¤§ä½“çš„æ€æƒ³éƒ½æ˜¯æ ¹æ®æ–‡æ¡£ç”Ÿæˆä¸»é¢˜åˆ†å¸ƒï¼Œå†æ ¹æ®ä¸»é¢˜åˆ†å¸ƒå’Œå•è¯åˆ†å¸ƒå¾—åˆ°æ–‡æ¡£ä¸­çš„å„ä¸ªå•è¯ã€‚ä¸åŒçš„æ˜¯LDAæ˜¯è´å¶æ–¯æ´¾çš„æ€æƒ³ï¼Œå¯¹äºä¸¤ç§åˆ†å¸ƒåŠ å…¥äº†ç‹„åˆ©å…‹é›·å…ˆéªŒæ¦‚ç‡ã€‚LDAçš„ç”Ÿæˆè¿‡ç¨‹å¯ä»¥çœ‹æˆä¸Šå¸æ·éª°å­ï¼Œä»Mä¸ªéª°å­ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºæ–‡æœ¬mçš„ä¸»é¢˜åˆ†å¸ƒï¼Œä»Kä¸ªéª°å­ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºä¸»é¢˜kçš„å•è¯åˆ†å¸ƒï¼Œï¼ˆæ³¨æ„è¿™é‡Œçš„å¤šé¡¹åˆ†å¸ƒçš„å‚æ•°å°±æ˜¯å¤šé¡¹åˆ†å¸ƒä¸­çš„æ¦‚ç‡pï¼Œå…¶æœä»ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼Œæ¯”å¦‚å¯¹äº\\(\\theta_m\\)ï¼Œå®ƒå…¶å®å°±æ˜¯æ–‡æœ¬mç”Ÿæˆä¸åŒä¸»é¢˜kçš„æ¦‚ç‡\\(p(z\\mid d_m)\\)ï¼Œæ˜¯ä¸ªKç»´çš„å‘é‡ã€‚å¯¹äº\\(\\varphi_k\\)ï¼Œæ˜¯ç”±ä¸»é¢˜kç”Ÿæˆä¸åŒå•è¯vçš„æ¦‚ç‡\\(p(w\\mid z_k)\\)ï¼Œæ˜¯ä¸ªVç»´çš„å‘é‡ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®ç‹„åˆ©å…‹é›·åˆ†å¸ƒé‡‡æ ·å¾—åˆ°çš„æ˜¯ä¸€äº›æ¦‚ç‡ï¼Œè¿™äº›æ¦‚ç‡ä¹Ÿæ˜¯æˆ‘ä»¬æœ€ç»ˆè¦æ±‚çš„å‚æ•°ï¼Œè¿™äº›æ¦‚ç‡ä½œä¸ºå¤šé¡¹åˆ†å¸ƒçš„å‚æ•°å†é‡‡æ ·ç”Ÿæˆä¸»é¢˜æˆ–è€…å•è¯ï¼Œè¿˜æœ‰å°±æ˜¯\\(p(z_k\\mid d_m)\\)ä¸\\(z_{mn}\\)çš„ç†è§£ï¼Œå‰è€…å°±æ˜¯ç›¸å½“äº\\(\\theta_{mk}\\)ï¼Œåè€…è‚¯å®šæ˜¯ä¸»é¢˜é›†åˆä¸­çš„ä¸€ä¸ªï¼Œä¸è¿‡æ˜¯æ ¹æ®å‚æ•°ä¸º\\(\\theta_m\\)çš„å¤šé¡¹åˆ†å¸ƒåœ¨ä½ç½®né‡‡æ ·å¾—åˆ°çš„ã€‚è¿™å°±æ˜¯LDAçš„æ•´ä¸ªçš„ç†è§£ï¼Œå½“ç„¶æ¨¡å‹çš„æ±‚è§£æ˜¯ä½¿ç”¨å‰å¸ƒæ–¯æŠ½æ ·çš„æ–¹æ³•ï¼Œä¸ä¸Šé¢å†™çš„æ­¥éª¤ä¸åŒã€‚å†™è¿™äº›æ˜¯ä¾¿äºç†è§£ï¼‰ã€‚ ç”±ä¸»é¢˜åˆ†å¸ƒå¯ä»¥å¯¹æ–‡æœ¬çš„æ¯ä¸ªä½ç½®èµ‹å€¼ä¸€ä¸ªä¸»é¢˜ï¼Œå†æ ¹æ®ä¸»é¢˜-å•è¯åˆ†å¸ƒå¯ä»¥ç”Ÿæˆæ•´ä¸ªæ–‡æœ¬ã€‚ä¸€åˆ‡çš„ä¸€åˆ‡éƒ½æ˜¯å’ŒPLSAä¸€æ ·ï¼Œæ±‚ä¸¤ä¸ªåˆ†å¸ƒï¼Œä»¥è‡³äºå¯ä»¥ç”Ÿæˆæˆ‘ä»¬çš„æ–‡æ¡£ã€‚LDAä¹Ÿå¯ä»¥å¾—åˆ°æ–‡æ¡£çš„ä¸»é¢˜åˆ†å¸ƒï¼Œå¾—åˆ°äº†ä¸»é¢˜åˆ†å¸ƒå’Œå•è¯åˆ†å¸ƒå¯ä»¥åº”ç”¨äºå„ç§ä»»åŠ¡å½“ä¸­ã€‚å…·ä½“å¯ä»¥å‚è€ƒã€ŠLDAæ¼«æ¸¸æŒ‡å—ã€‹ã€‚ ç°åœ¨çŸ¥é“äº†LDAæ˜¯æ€ä¹ˆä¸€å›äº‹äº†ï¼Œä½†è¿˜æ˜¯æ„Ÿè§‰æ¨¡æ¨¡ç³Šç³Šçš„ï¼Œæ„Ÿè§‰å¦‚â€œé€šä¿—ç†è§£LDAä¸»é¢˜æ¨¡å‹â€è¿™ç¯‡æ–‡ç« å¼€å¤´æ‰€è¯´çš„é‚£æ ·é™·å…¥äº†LDAçš„ç»†ææœ«èŠ‚ä¸­ï¼Œæ‰€ä»¥å†™äº†ä¸€äº›ä¸»é¢˜ï¼ŒåŠ æ·±è‡ªå·±çš„å°è±¡ä¸ç†è§£ï¼Œç»è¿‡ä»£ç çš„æ´—ç¤¼ï¼Œåˆç†è§£æ·±å…¥äº†ä¸€äº›ï¼Œä½†æ„Ÿè§‰è¿˜æ²¡æœ‰æŒæ¡çš„å¾ˆå¥½ï¼Œå¯èƒ½éœ€è¦æ¶ˆåŒ–æ¶ˆåŒ–ï¼Œé‚£å°±å…ˆå‘Šä¸€æ®µè½äº†ã€‚ä»¥åå¸¸çœ‹çœ‹å°±è¡Œã€‚ ## å‚è€ƒ https://zhuanlan.zhihu.com/p/374924140 https://www.cnblogs.com/gasongjian/p/7631978.html ","date":"2022-06-16","objectID":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/:5:0","tags":["NLP","ä¸»é¢˜æ¨¡å‹"],"title":"ä¸»é¢˜æ¨¡å‹","uri":"/%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"Transformer \\[ -\\log \\frac{\\exp({\\operatorname{sim}\\left(\\mathbf{h}_i, \\mathbf{h}_i^{+}\\right) / \\tau})}{\\sum_{j=1}^N\\left(\\exp({\\operatorname{sim}\\left(\\mathbf{h}_i, \\mathbf{h}_j^{+}\\right) / \\tau})+\\exp({\\operatorname{sim}\\left(\\mathbf{h}_i, \\mathbf{h}_j^{-}\\right) / \\tau}\\right))} \\] ","date":"2022-06-08","objectID":"/transformer/:0:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"èƒŒæ™¯ å…ˆä»word2vecå¼€å§‹è¯´èµ·ï¼Œword2vecå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼Œä½†æ˜¯å®ƒæœ‰ä¸ªé—®é¢˜å°±æ˜¯å®ƒæ²¡æœ‰åŠæ³•è§£å†³ä¸€è¯å¤šä¹‰çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´bankè¿™ä¸ªè¯è¯­ï¼Œæœ‰é“¶è¡Œçš„æ„æ€ï¼Œä½†åœ¨æŸäº›è¯­ä¹‰ä¸‹ï¼Œå®ƒä¹Ÿæœ‰æ²³å²¸çš„æ„æ€ï¼Œä½†å¯¹äºword2vecæ¥è¯´ï¼Œå®ƒåŒºåˆ«ä¸äº†è¿™ä¸¤ç§å«ä¹‰ï¼Œå› ä¸ºå®ƒä»¬å°½ç®¡ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å‡ºç°çš„å•è¯ä¸åŒï¼Œä½†æ˜¯åœ¨ç”¨è¯­è¨€æ¨¡å‹è®­ç»ƒçš„æ—¶å€™ï¼Œä¸è®ºä»€ä¹ˆä¸Šä¸‹æ–‡çš„å¥å­ç»è¿‡word2vecï¼Œéƒ½æ˜¯é¢„æµ‹ç›¸åŒçš„å•è¯bankï¼Œè€ŒåŒä¸€ä¸ªå•è¯å çš„æ˜¯åŒä¸€è¡Œçš„å‚æ•°ç©ºé—´ï¼Œè¿™å¯¼è‡´ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ä¿¡æ¯éƒ½ä¼šç¼–ç åˆ°ç›¸åŒçš„word embeddingç©ºé—´é‡Œå»ã€‚ è€ŒELMoå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä½¿ç”¨äº†åŒå‘çš„LSTMï¼Œå…·ä½“çš„å¯ä»¥çœ‹ELMo,æ€»ä¹‹ä½¿ç”¨RNNä½œä¸ºç‰¹å¾æå–å™¨ï¼Œè§£å†³äº†å¤šä¹‰è¯çš„é—®é¢˜ï¼Œä½†ç°åœ¨æ¥çœ‹ï¼ŒRNNçš„ç‰¹å¾æå–çš„èƒ½åŠ›æ˜¯è¿œä¸å¦‚æœ¬æ–‡çš„Transformerçš„ï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™äº›ä¸œè¥¿å‘¢ï¼Œè¿™å°±æ˜¯åŸå› ï¼ŒTransformerå‡ºç°åï¼Œå–ä»£äº†RNNå’ŒCNNçš„åœ°ä½ï¼Œæˆä¸ºäº†æœ€æµè¡Œçš„ç‰¹å¾æå–å™¨ï¼Œå¤§ç«çš„GPTå’ŒBERTéƒ½ä¸Transformerç¦»ä¸å¼€å…³ç³»ã€‚æ‹¿bankä¸ºä¾‹ï¼ŒRNNåœ¨è¯»å–æ•´ä¸ªå¥å­ä¹‹å‰ä¸ä¼šç†è§£bankçš„å«ä¹‰ï¼Œä¹Ÿå°±æ˜¯RNNçš„å¹¶è¡Œèƒ½åŠ›æ¯”è¾ƒå·®ï¼Œè€Œåœ¨Transformerä¸­ï¼Œtokenä¹‹é—´ä¼šäº’ç›¸äº¤äº’ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œç›´è§‚åœ°è¯´ï¼ŒTransformer çš„ç¼–ç å™¨å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç³»åˆ—æ¨ç†æ­¥éª¤ï¼ˆå±‚ï¼‰ã€‚åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œtokenéƒ½ä¼šäº’ç›¸çœ‹ç€å¯¹æ–¹ï¼ˆè¿™æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„åœ°æ–¹â€”â€”self-attentionï¼‰ï¼Œäº¤æ¢ä¿¡æ¯å¹¶å°è¯•åœ¨æ•´ä¸ªå¥å­çš„ä¸Šä¸‹æ–‡ä¸­æ›´å¥½åœ°ç†è§£å¯¹æ–¹ã€‚è¿™å‘ç”Ÿåœ¨å‡ ä¸ªå±‚ï¼ˆä¾‹å¦‚ï¼Œ6 ä¸ªï¼‰ä¸­ã€‚ åœ¨æ¯ä¸ªè§£ç å™¨å±‚ä¸­ï¼Œå‰ç¼€æ ‡è®°ä¹Ÿé€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ç›¸äº’äº¤äº’ã€‚ ä¸‹é¢å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚ ","date":"2022-06-08","objectID":"/transformer/:1:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"self-attention é¦–å…ˆä»‹ç»ä¸€ä¸‹æœ€ä¸»è¦çš„self-attentionï¼Œå¯ä»¥è¯´æ˜¯self-attentionå®ç°äº†ä¸Šè¿°çš„tokenä¹‹é—´äº¤äº’çš„åŠŸèƒ½ã€‚ è‡ªæ³¨æ„åŠ›æ˜¯æ¨¡å‹çš„å…³é”®ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚æ³¨æ„Â å’Œè‡ªæ³¨æ„ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œè‡ªæ³¨æ„åœ¨ç›¸åŒæ€§è´¨çš„è¡¨ç¤ºä¹‹é—´è¿è¡Œï¼šä¾‹å¦‚ï¼ŒæŸä¸ªå±‚ä¸­çš„æ‰€æœ‰ç¼–ç å™¨çŠ¶æ€ã€‚ å½¢å¼ä¸Šï¼Œè¿™ç§ç›´è§‰æ˜¯é€šè¿‡æŸ¥è¯¢é”®å€¼æ³¨æ„æ¥å®ç°çš„ã€‚self-attention ä¸­çš„æ¯ä¸ªè¾“å…¥æ ‡è®°éƒ½ä¼šæ”¶åˆ°ä¸‰ç§è¡¨ç¤ºï¼Œå¯¹åº”äºå®ƒå¯ä»¥æ‰®æ¼”çš„è§’è‰²ï¼š query key value è¿›å…¥æ­£é¢˜ï¼š ä½œä¸ºæˆ‘ä»¬æƒ³è¦ç¿»è¯‘çš„è¾“å…¥è¯­å¥â€œThe animal didnâ€™t cross the street because it was too tiredâ€ã€‚å¥å­ä¸­â€itâ€æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€œitâ€æŒ‡çš„æ˜¯â€streetâ€ è¿˜æ˜¯â€œanimalâ€ï¼Ÿå¯¹äººæ¥è¯´å¾ˆç®€å•çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹ç®—æ³•è€Œè¨€å¹¶ä¸ç®€å•ã€‚ å½“æ¨¡å‹å¤„ç†å•è¯â€œitâ€æ—¶ï¼Œself-attentionå…è®¸å°†â€œitâ€å’Œâ€œanimalâ€è”ç³»èµ·æ¥ã€‚å½“æ¨¡å‹å¤„ç†æ¯ä¸ªä½ç½®çš„è¯æ—¶ï¼Œself-attentionå…è®¸æ¨¡å‹çœ‹åˆ°å¥å­çš„å…¶ä»–ä½ç½®ä¿¡æ¯ä½œè¾…åŠ©çº¿ç´¢æ¥æ›´å¥½åœ°ç¼–ç å½“å‰è¯ã€‚å¦‚æœä½ å¯¹RNNç†Ÿæ‚‰ï¼Œå°±èƒ½æƒ³åˆ°RNNçš„éšçŠ¶æ€æ˜¯å¦‚ä½•å…è®¸ä¹‹å‰çš„è¯å‘é‡æ¥è§£é‡Šåˆæˆå½“å‰è¯çš„è§£é‡Šå‘é‡ã€‚Transformerä½¿ç”¨self-attentionæ¥å°†ç›¸å…³è¯çš„ç†è§£ç¼–ç åˆ°å½“å‰è¯ä¸­ã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹self-attentionæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼š ","date":"2022-06-08","objectID":"/transformer/:2:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"å‘é‡è®¡ç®— ç¬¬ä¸€æ­¥ï¼Œæ ¹æ®ç¼–ç å™¨çš„è¾“å…¥å‘é‡ï¼Œç”Ÿæˆä¸‰ä¸ªå‘é‡ï¼Œæ¯”å¦‚ï¼Œå¯¹æ¯ä¸ªè¯å‘é‡ï¼Œç”Ÿæˆquery-vec, key-vec, value-vecï¼Œç”Ÿæˆæ–¹æ³•ä¸ºåˆ†åˆ«ä¹˜ä»¥ä¸‰ä¸ªçŸ©é˜µï¼Œè¿™äº›çŸ©é˜µåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦å­¦ä¹ ã€‚ã€æ³¨æ„ï¼šä¸æ˜¯æ¯ä¸ªè¯å‘é‡ç‹¬äº«3ä¸ªmatrixï¼Œè€Œæ˜¯æ‰€æœ‰è¾“å…¥å…±äº«3ä¸ªè½¬æ¢çŸ©é˜µï¼›æƒé‡çŸ©é˜µæ˜¯åŸºäºè¾“å…¥ä½ç½®çš„è½¬æ¢çŸ©é˜µï¼›æœ‰ä¸ªå¯ä»¥å°è¯•çš„ç‚¹ï¼Œå¦‚æœæ¯ä¸ªè¯ç‹¬äº«ä¸€ä¸ªè½¬æ¢çŸ©é˜µï¼Œä¼šä¸ä¼šæ•ˆæœæ›´å‰å®³å‘¢ï¼Ÿã€‘ æ³¨æ„åˆ°è¿™äº›æ–°å‘é‡çš„ç»´åº¦æ¯”è¾“å…¥è¯å‘é‡çš„ç»´åº¦è¦å°ï¼ˆ512â€“\u003e64ï¼‰ï¼Œå¹¶ä¸æ˜¯å¿…é¡»è¦å°çš„ï¼Œæ˜¯ä¸ºäº†è®©å¤šå¤´attentionçš„è®¡ç®—æ›´ç¨³å®šã€‚ ç¬¬äºŒæ­¥ï¼Œè®¡ç®—attentionå°±æ˜¯è®¡ç®—ä¸€ä¸ªåˆ†å€¼ã€‚å¯¹â€œThinking Matchinesâ€è¿™å¥è¯ï¼Œå¯¹â€œThinkingâ€ï¼ˆpos#1ï¼‰è®¡ç®—attention åˆ†å€¼ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªè¯ä¸â€œThinkingâ€çš„è¯„ä¼°åˆ†ï¼Œè¿™ä¸ªåˆ†å†³å®šç€ç¼–ç â€œThinkingâ€æ—¶ï¼ˆæŸä¸ªå›ºå®šä½ç½®æ—¶ï¼‰ï¼Œæ¯ä¸ªè¾“å…¥è¯éœ€è¦é›†ä¸­å¤šå°‘å…³æ³¨åº¦ã€‚ è¿™ä¸ªåˆ†ï¼Œé€šè¿‡â€œThingâ€å¯¹åº”query-vectorä¸æ‰€æœ‰è¯çš„key-vecä¾æ¬¡åšç‚¹ç§¯å¾—åˆ°ã€‚æ‰€ä»¥å½“æˆ‘ä»¬å¤„ç†ä½ç½®#1æ—¶ï¼Œç¬¬ä¸€ä¸ªåˆ†å€¼æ˜¯q1å’Œk1çš„ç‚¹ç§¯ï¼Œç¬¬äºŒä¸ªåˆ†å€¼æ˜¯q1å’Œk2çš„ç‚¹ç§¯ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ³¨æ„åŠ›å¾—åˆ†. ç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥ï¼Œé™¤ä»¥8(\\(=\\sqrt{dim_{key}}\\))ï¼Œè¿™æ ·æ¢¯åº¦ä¼šæ›´ç¨³å®šã€‚ç„¶ååŠ ä¸Šsoftmaxæ“ä½œï¼Œå½’ä¸€åŒ–åˆ†å€¼ä½¿å¾—å…¨ä¸ºæ­£æ•°ä¸”åŠ å’Œä¸º1ã€‚ softmaxåˆ†å€¼å†³å®šç€åœ¨è¿™ä¸ªä½ç½®ï¼Œæ¯ä¸ªè¯çš„è¡¨è¾¾ç¨‹åº¦ï¼ˆå…³æ³¨åº¦ï¼‰ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªä½ç½®çš„è¯åº”è¯¥æœ‰æœ€é«˜çš„å½’ä¸€åŒ–åˆ†æ•°ï¼Œä½†å¤§éƒ¨åˆ†æ—¶å€™æ€»æ˜¯æœ‰åŠ©äºå…³æ³¨è¯¥è¯çš„ç›¸å…³çš„è¯ã€‚ ç¬¬äº”æ­¥ï¼Œå°†softmaxåˆ†å€¼ä¸value-vecæŒ‰ä½ç›¸ä¹˜ã€‚ä¿ç•™å…³æ³¨è¯çš„valueå€¼ï¼Œå‰Šå¼±éç›¸å…³è¯çš„valueå€¼ã€‚ ç¬¬å…­æ­¥ï¼Œå°†æ‰€æœ‰åŠ æƒå‘é‡åŠ å’Œï¼Œäº§ç”Ÿè¯¥ä½ç½®çš„self-attentionçš„è¾“å‡ºç»“æœã€‚ ä¸Šè¿°å°±æ˜¯self-attentionçš„è®¡ç®—è¿‡ç¨‹ï¼Œç”Ÿæˆçš„å‘é‡æµå…¥å‰å‘ç½‘ç»œã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸Šè¿°è®¡ç®—æ˜¯ä»¥é€Ÿåº¦æ›´å¿«çš„çŸ©é˜µå½¢å¼è¿›è¡Œçš„ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹åœ¨å•è¯çº§åˆ«çš„çŸ©é˜µè®¡ç®—ã€‚ ","date":"2022-06-08","objectID":"/transformer/:2:1","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"çŸ©é˜µè®¡ç®— ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—query/key/value matrixï¼Œå°†æ‰€æœ‰è¾“å…¥è¯å‘é‡åˆå¹¶æˆè¾“å…¥çŸ©é˜µ\\(X\\)ï¼Œå¹¶ä¸”å°†å…¶åˆ†åˆ«ä¹˜ä»¥æƒé‡çŸ©é˜µ\\(W^q, W^k,W^v\\) æœ€åï¼Œé‰´äºæˆ‘ä»¬ä½¿ç”¨çŸ©é˜µå¤„ç†ï¼Œå°†æ­¥éª¤2~6åˆå¹¶æˆä¸€ä¸ªè®¡ç®—self-attentionå±‚è¾“å‡ºçš„å…¬å¼ã€‚ ","date":"2022-06-08","objectID":"/transformer/:2:2","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ è®ºæ–‡è¿›ä¸€æ­¥å¢åŠ äº†multi-headedçš„æœºåˆ¶åˆ°self-attentionä¸Šï¼Œåœ¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢æé«˜äº†attentionå±‚çš„æ•ˆæœï¼š å¤šå¤´æœºåˆ¶æ‰©å±•äº†æ¨¡å‹é›†ä¸­äºä¸åŒä½ç½®çš„èƒ½åŠ›ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œz1åªåŒ…å«äº†å…¶ä»–è¯çš„å¾ˆå°‘ä¿¡æ¯ï¼Œä»…ç”±å®é™…è‡ªå·±è¯å†³å®šã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ç¿»è¯‘ â€œThe animal didnâ€™t cross the street because it was too tiredâ€æ—¶ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å•è¯â€itâ€æŒ‡çš„æ˜¯ä»€ä¹ˆã€‚ å¤šå¤´æœºåˆ¶èµ‹äºˆattentionå¤šç§å­è¡¨è¾¾æ–¹å¼ã€‚åƒä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œåœ¨å¤šå¤´ä¸‹æœ‰å¤šç»„query/key/value-matrixï¼Œè€Œéä»…ä»…ä¸€ç»„ï¼ˆè®ºæ–‡ä¸­ä½¿ç”¨8-headsï¼‰ã€‚æ¯ä¸€ç»„éƒ½æ˜¯éšæœºåˆå§‹åŒ–ï¼Œç»è¿‡è®­ç»ƒä¹‹åï¼Œè¾“å…¥å‘é‡å¯ä»¥è¢«æ˜ å°„åˆ°ä¸åŒçš„å­è¡¨è¾¾ç©ºé—´ä¸­ã€‚ å¦‚æœæˆ‘ä»¬è®¡ç®—multi-headed self-attentionçš„ï¼Œåˆ†åˆ«æœ‰å…«ç»„ä¸åŒçš„Q/K/V matrixï¼Œæˆ‘ä»¬å¾—åˆ°å…«ä¸ªä¸åŒçš„çŸ©é˜µã€‚ è¿™ä¼šå¸¦æ¥ç‚¹éº»çƒ¦ï¼Œå‰å‘ç½‘ç»œå¹¶ä¸èƒ½æ¥æ”¶å…«ä¸ªçŸ©é˜µï¼Œè€Œæ˜¯å¸Œæœ›è¾“å…¥æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæ‰€ä»¥è¦æœ‰ç§æ–¹å¼å¤„ç†ä¸‹å…«ä¸ªçŸ©é˜µåˆå¹¶æˆä¸€ä¸ªçŸ©é˜µã€‚ ä¸Šè¿°å°±æ˜¯å¤šå¤´è‡ªæ³¨æ„æœºåˆ¶çš„å†…å®¹ï¼Œæˆ‘è®¤ä¸ºè¿˜ä»…æ˜¯ä¸€éƒ¨åˆ†çŸ©é˜µï¼Œä¸‹é¢å°è¯•ç€å°†å®ƒä»¬æ”¾åˆ°ä¸€ä¸ªå›¾ä¸Šå¯è§†åŒ–å¦‚ä¸‹ã€‚ #### ä»£ç  ä¸‹é¢å®ç°ä¸€ä¸‹å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨åŸè®ºæ–‡ä¸­ï¼Œå®ç°çš„æ–¹æ³•å¦‚ä¸‹ï¼š ä¹Ÿå°±æ˜¯å¯¹æ¯ä¸ªWè¿›è¡Œå¤šå¤´çš„è®¾ç½®ï¼Œå³ä¸ºåŸç»´åº¦/headï¼Œç„¶åæ‹¼æ¥åï¼Œå†ç»è¿‡\\(hd_v\\times d_{model}\\)çš„è½¬æ¢åˆå¾—åˆ°åŸæ¥çš„ç»´åº¦ï¼Œä»£ç çš„å®ç°ä¸å¤ªä¸€æ ·ï¼Œä»£ç æ˜¯Wè¿˜æ˜¯\\(d_{model}\\times d_{model}\\)çš„çŸ©é˜µç„¶åå¾—åˆ°q,k,vä¹‹åå†è¿›è¡Œæˆªæ–­ï¼Œå®ç°å¦‚ä¸‹ã€‚ class MultiHeadedAttention(nn.Module): def __init__(self, h, d_model, dropout=0.1) -\u003e None: # hä¸ºheadï¼Œè¿™é‡Œä¸º8ï¼Œd_modelä¸ºembeddingçš„ç»´åº¦ï¼Œè¿™é‡Œä¸º512 super().__init__() assert d_model % h == 0 self.d_k = d_model // h # 64 self.h = h self.Q_Linear = nn.Linear(d_model, d_model) self.K_Linear = nn.Linear(d_model, d_model) self.V_Linear = nn.Linear(d_model, d_model) self.res_Linear = nn.Linear(d_model, d_model) self.attn = None self.dropout = nn.Dropout(p=dropout) def forward(self, query, key, value, mask=None): if mask is not None: mask = mask.unsqueeze(1) batch_size = query.size(0) query = self.Q_Linear(query).view(batch_size, -1, self.h, self.d_k) # (batch_size, seq_len, h, d_k)å³(batch_size, seq_len, 8, 64) query = query.transpose(1, 2) # (batch_size, h, seq_len, d_k)å³(batch_size, 8, seq_len, 64) key = self.K_Linear(key).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) value = self.V_Linear(value).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout) # xä¸º(batch_size, h, seq_len, d_k) # attnä¸º(batch_size, h, seq_len1, seq_len2) x = x.transpose(1, 2).contiguous().view(batch_size, -1, self.h * self.d_k) # (batch_size, h, seq_len, d_k) -\u003e (batch_size, seq_len, h, d_k) -\u003e (batch_size, seq_len, h * d_k) = (batch_size, seq_len, 512) return self.res_Linear(x) ","date":"2022-06-08","objectID":"/transformer/:2:3","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"Masked self-attention åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œä¸»è¦æ˜¯æ¶ˆé™¤åé¢çš„ä¿¡æ¯å¯¹é¢„æµ‹çš„å½±å“ï¼Œå› ä¸ºdecoderè¾“å…¥çš„æ˜¯æ•´ä¸ªå¥å­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„å‚è€ƒç­”æ¡ˆï¼Œè€Œå®é™…é¢„æµ‹çš„æ—¶å€™å°±æ˜¯é¢„æµ‹åé¢çš„tokenï¼Œç”¨ä¸åˆ°åé¢çš„tokenï¼Œå¦‚æœä¸maskæ‰ï¼Œå½“å‰çš„tokenå°†çœ‹åˆ°â€œæœªæ¥â€ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› æ­¤å¿…é¡»è¦maskæ‰ã€‚ å…¶å®decoderé‡Œçš„sequence maskä¸encoderé‡Œçš„padding maskå¼‚æ›²åŒå·¥ï¼Œpadding maskå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†ä½¿å¥å­é•¿åº¦ä¸€è‡´è¿›è¡Œäº†paddingï¼Œè€Œä¸ºäº†é¿å…å…³æ³¨paddingçš„ä½ç½®ï¼Œè¿›è¡Œäº†maskï¼Œå…·ä½“çš„åšæ³•å°±æ˜¯å°†è¿™äº›ä½ç½®çš„å€¼å˜æˆè´Ÿæ— ç©·ï¼Œè¿™æ ·softmaxä¹‹åå°±æ¥è¿‘äº0äº†ã€‚ è€Œsequence maskæ€æƒ³ä¹Ÿå·®ä¸å¤šï¼š å‡è®¾ç°åœ¨è§£ç å™¨çš„è¾“å…¥â€\u003c s \u003e who am i \u003c e \u003eâ€œåœ¨åˆ†åˆ«ä¹˜ä¸Šä¸€ä¸ªçŸ©é˜µè¿›è¡Œçº¿æ€§å˜æ¢åå¾—åˆ°äº†Qã€Kã€Vï¼Œä¸”Qä¸Kä½œç”¨åå¾—åˆ°äº†æ³¨æ„åŠ›æƒé‡çŸ©é˜µï¼ˆæ­¤æ—¶è¿˜æœªè¿›è¡Œsoftmaxæ“ä½œï¼‰ï¼Œå¦‚å›¾17æ‰€ç¤ºã€‚ æ­¤æ—¶å·²ç»è®¡ç®—å¾—åˆ°äº†æ³¨æ„åŠ›æƒé‡çŸ©é˜µã€‚ç”±ç¬¬1è¡Œçš„æƒé‡å‘é‡å¯çŸ¥ï¼Œåœ¨è§£ç ç¬¬1ä¸ªæ—¶åˆ»æ—¶åº”è¯¥å°†20%ï¼ˆä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯ç»è¿‡softmaxåçš„å€¼ï¼‰çš„æ³¨æ„åŠ›æ”¾åˆ°â€™\u003c s \u003eâ€™ä¸Šï¼Œ30%çš„æ³¨æ„åŠ›æ”¾åˆ°â€™whoâ€™ä¸Šç­‰ç­‰ã€‚ä¸è¿‡æ­¤æ—¶æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæ¨¡å‹åœ¨å®é™…çš„é¢„æµ‹è¿‡ç¨‹ä¸­åªæ˜¯å°†å½“å‰æ—¶åˆ»ä¹‹å‰ï¼ˆåŒ…æ‹¬å½“å‰æ—¶åˆ»ï¼‰çš„æ‰€æœ‰æ—¶åˆ»ä½œä¸ºè¾“å…¥æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡å‹åœ¨é¢„æµ‹æ—¶æ˜¯çœ‹ä¸åˆ°å½“å‰æ—¶åˆ»ä¹‹åçš„ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTransformerä¸­çš„Decoderé€šè¿‡åŠ å…¥æ³¨æ„åŠ›æ©ç æœºåˆ¶æ¥è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚ å½“ç„¶è¿˜è¦è¿›è¡Œsoftmaxç­‰è®¡ç®—ã€‚ åœ¨ç½‘ä¸ŠæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œè¯´æ³•éƒ½å¾ˆä¸ä¸€æ ·ï¼Œä¸è¿‡æˆ‘æ›´å€¾å‘äºè¿™æ ·çš„çœ‹æ³•ã€‚è€Œåœ¨é¢„æµ‹çš„æ—¶å€™æ˜¯ç”¨å‰é¢çš„è¾“å‡ºç»“æœä½œä¸ºè¾“å…¥çš„ã€‚ å‡ å¼ å›¾å¸®åŠ©ç†è§£ï¼š åé¢è¿˜æœ‰padding maskï¼Œæ‰€æœ‰çš„self attentionéƒ½è¦ç”¨è¿™ä¸ªï¼Œå› ä¸ºpadçš„ä½ç½®æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å®è·µä¸€ä¸‹åŠ æ·±ç†è§£ï¼š é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰æ¨¡å‹ï¼š # è¯å…¸æ•°ä¸º10ï¼Œ è¯å‘é‡ç»´åº¦ä¸º8 embedding = nn.Embedding(10, 8) # å®šä¹‰Transformerï¼Œæ³¨æ„ä¸€å®šè¦æ”¹æˆevalæ¨¡å‹ï¼Œå¦åˆ™æ¯æ¬¡è¾“å‡ºç»“æœä¸ä¸€æ · transformer = nn.Transformer(d_model=8, batch_first=True).eval() æ¥ä¸‹æ¥å®šä¹‰æˆ‘ä»¬çš„srcå’Œtgtï¼š # Encoderçš„è¾“å…¥ src = torch.LongTensor([[0, 1, 2, 3, 4]]) # Decoderçš„è¾“å…¥ tgt = torch.LongTensor([[4, 3, 2, 1, 0]]) ç„¶åæˆ‘ä»¬å°†[4]é€ç»™Transformerè¿›è¡Œé¢„æµ‹ï¼Œæ¨¡æ‹Ÿæ¨ç†æ—¶çš„ç¬¬ä¸€æ­¥ï¼š transformer(embedding(src), embedding(tgt[:, :1]), # è¿™ä¸ªå°±æ˜¯ç”¨æ¥ç”Ÿæˆé˜¶æ¢¯å¼çš„maskçš„ tgt_mask=nn.Transformer.generate_square_subsequent_mask(1)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) ç„¶åæˆ‘ä»¬å°†[4, 3]é€ç»™Transformerï¼Œæ¨¡æ‹Ÿæ¨ç†æ—¶çš„ç¬¬äºŒæ­¥ï¼š transformer(embedding(src), embedding(tgt[:, :2]), tgt_mask=nn.Transformer.generate_square_subsequent_mask(2)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598], [ 1.2726, -0.3516, 0.6584, 0.3297, 1.1161, -1.4204, -1.5652, -0.0396]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) å‡ºçš„ç¬¬ä¸€ä¸ªå‘é‡å’Œä¸Šé¢é‚£ä¸ªä¸€æ¨¡ä¸€æ ·ã€‚ æœ€åæˆ‘ä»¬å†å°†tgtä¸€æ¬¡æ€§é€ç»™transformerï¼Œæ¨¡æ‹Ÿè®­ç»ƒè¿‡ç¨‹ï¼š transformer(embedding(src), embedding(tgt), tgt_mask=nn.Transformer.generate_square_subsequent_mask(5)) tensor([[[ 1.4053, -0.4680, 0.8110, 0.1218, 0.9668, -1.4539, -1.4427, 0.0598], [ 1.2726, -0.3516, 0.6584, 0.3297, 1.1161, -1.4204, -1.5652, -0.0396], [ 1.4799, -0.3575, 0.8310, 0.1642, 0.8811, -1.3140, -1.5643, -0.1204], [ 1.4359, -0.6524, 0.8377, 0.1742, 1.0521, -1.3222, -1.3799, -0.1454], [ 1.3465, -0.3771, 0.9107, 0.1636, 0.8627, -1.5061, -1.4732, 0.0729]]], grad_fn=\u003cNativeLayerNormBackward0\u003e) å¯ä»¥çœ‹åˆ°ä½¿ç”¨maskåå°±å¯ä»¥ä¿è¯å‰é¢çš„ç»“æœéƒ½æ˜¯ä¸å˜çš„ï¼Œä¸ç„¶å¦‚æœæ²¡æœ‰maskåˆ™è®¡ç®—attentionæ—¶å› ä¸ºè®¡ç®—æ³¨æ„åŠ›å˜åŒ–æ‰€ä»¥ç»“æœéƒ½ä¼šå˜åŒ–ï¼Œè¿™å°±æ˜¯Mask self-attentionçš„æ„ä¹‰ã€‚ åˆ°è¿™é‡Œself-attentionå°±ä»‹ç»å®Œäº† ","date":"2022-06-08","objectID":"/transformer/:2:4","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"ä»£ç  def attention(query, key, value, mask=None, dropout=None): d_k = query.size(-1) scores = torch.matmul(query, key.transpose(-2, -1)) / math.sqrt(d_k) # æœ€åä¸¤ä¸ªç»´åº¦ç›¸ä¹˜ï¼Œå³ä¸ºscoresï¼Œå†scaleä¸€ä¸‹ã€‚ if mask is not None: scores = scores.masked_fill(mask == 0, -1e9) # å°†maskçš„ä½ç½®çš„scoresç½®ä¸º-1e9 # å®é™…ä¸Špad maskçš„æ—¶å€™ï¼Œpadä¹Ÿä¼šä½œä¸ºkeyä¸å…¶å®ƒtokenå¯¹åº”çš„k,vè®¡ç®—scoreï¼Œpad maskåªæ˜¯æ¶ˆé™¤padä½œä¸ºk,væ—¶å€™çš„å½±å“ã€‚ä½†åœ¨æœ€åsoftmaxçš„æ—¶å€™ï¼Œå°†padçš„æŸå¤±å€¼å…¨éƒ¨ç½®ä¸º0 p_attn = F.softmax(scores, dim=-1) # å°†scoresè¿›è¡Œsoftmaxï¼Œå¾—åˆ°p_attnï¼Œè¿™é‡Œæ˜¯åœ¨æœ€åä¸€ä¸ªç»´åº¦ä¸Šsoftmaxï¼Œå› ä¸ºå¯¹æ¯ä¸ªqueryçš„æ‰€æœ‰keyè¿›è¡Œsoftmax if dropout: p_attn = dropout(p_attn) return torch.matmul(p_attn, value), p_attn class MultiHeadedAttention(nn.Module): def __init__(self, h, d_model, dropout=0.1) -\u003e None: # hä¸ºheadï¼Œè¿™é‡Œä¸º8ï¼Œd_modelä¸ºembeddingçš„ç»´åº¦ï¼Œè¿™é‡Œä¸º512 super().__init__() assert d_model % h == 0 self.d_k = d_model // h # 64 self.h = h self.Q_Linear = nn.Linear(d_model, d_model) self.K_Linear = nn.Linear(d_model, d_model) self.V_Linear = nn.Linear(d_model, d_model) self.res_Linear = nn.Linear(d_model, d_model) self.attn = None self.dropout = nn.Dropout(p=dropout) def forward(self, query, key, value, mask=None): if mask is not None: mask = mask.unsqueeze(1) batch_size = query.size(0) query = self.Q_Linear(query).view(batch_size, -1, self.h, self.d_k) # (batch_size, seq_len, h, d_k)å³(batch_size, seq_len, 8, 64) query = query.transpose(1, 2) # (batch_size, h, seq_len, d_k)å³(batch_size, 8, seq_len, 64) key = self.K_Linear(key).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) value = self.V_Linear(value).view(batch_size, -1, self.h, self.d_k).transpose(1, 2) x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout) # xä¸º(batch_size, h, seq_len, d_k) # attnä¸º(batch_size, h, seq_len1, seq_len2) x = x.transpose(1, 2).contiguous().view(batch_size, -1, self.h * self.d_k) # (batch_size, h, seq_len, d_k) -\u003e (batch_size, seq_len, h, d_k) -\u003e (batch_size, seq_len, h * d_k) = (batch_size, seq_len, 512) return self.res_Linear(x) ","date":"2022-06-08","objectID":"/transformer/:2:5","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"æ¨¡å‹æ¶æ„ ä¸‹é¢æ˜¯åŸå§‹è®ºæ–‡ä¸­çš„æ¶æ„ï¼š self-attentionä¸Šé¢å·²ç»è®²çš„æ¯”è¾ƒè¯¦ç»†äº†ï¼Œä¸‹é¢è¯´ä¸€ä¸‹å…¶ä½™çš„éƒ¨åˆ†ã€‚ ","date":"2022-06-08","objectID":"/transformer/:3:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"FFN(å‰é¦ˆç½‘ç»œ) é™¤äº†æ³¨æ„åŠ›ä»¥å¤–ï¼Œæ¯ä¸€å±‚éƒ½æœ‰ä¸€ä¸ªå‰é¦ˆç½‘ç»œï¼šä¸¤ä¸ªçº¿æ€§å±‚ä¹‹é—´å…·æœ‰ReLUéçº¿æ€§ï¼š \\[ FFN(x) = max(0, xW_1+b_1)W_2+b_2 \\] åœ¨é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶æŸ¥çœ‹å…¶ä»–ä»¤ç‰Œä¹‹åï¼Œæ¨¡å‹ä½¿ç”¨ FFN å—æ¥å¤„ç†è¿™äº›æ–°ä¿¡æ¯ã€‚ class PositionwiseFeedForward(nn.Module): def __init__(self, d_model, d_ff, dropout=0.1): super().__init__() self.w_1 = nn.Linear(d_model, d_ff) self.w_2 = nn.Linear(d_ff, d_model) self.dropout = nn.Dropout(p=dropout) def forward(self, x): return self.w_2(self.dropout(F.relu(self.w_1(x)))) ","date":"2022-06-08","objectID":"/transformer/:3:1","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"æ®‹å·®è¿æ¥ æ®‹å·®è¿æ¥éå¸¸ç®€å•ï¼ˆå°†å—çš„è¾“å…¥æ·»åŠ åˆ°å…¶è¾“å‡ºï¼‰ï¼Œä½†åŒæ—¶ä¹Ÿéå¸¸æœ‰ç”¨ï¼šå®ƒä»¬ç¼“è§£äº†é€šè¿‡ç½‘ç»œçš„æ¢¯åº¦æµå¹¶å…è®¸å †å å¾ˆå¤šå±‚ã€‚è§£å†³äº†ç½‘ç»œé€€åŒ–çš„é—®é¢˜ã€‚ åœ¨ Transformer ä¸­ï¼Œåœ¨æ¯ä¸ªæ³¨æ„åŠ›å’Œ FFN å—ä¹‹åä½¿ç”¨æ®‹å·®è¿æ¥ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæ®‹å·®æ˜¾ç¤ºä¸ºå›´ç»•ä¸€ä¸ªå—åˆ°é»„è‰²Â â€œAdd \u0026 Normâ€å±‚çš„ç®­å¤´ã€‚åœ¨â€œAdd \u0026 Normâ€éƒ¨åˆ†ï¼ŒÂ â€œAddâ€éƒ¨åˆ†ä»£è¡¨æ®‹å·®è¿æ¥ã€‚ ","date":"2022-06-08","objectID":"/transformer/:3:2","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"Layer Norm â€œAdd \u0026 Normâ€å±‚ä¸­çš„â€œNormâ€éƒ¨åˆ†Â è¡¨ç¤ºÂ Layer Normalizationã€‚å®ƒæ‰¹é‡ç‹¬ç«‹åœ°æ ‡å‡†åŒ–æ¯ä¸ªç¤ºä¾‹çš„å‘é‡è¡¨ç¤º - è¿™æ ·åšæ˜¯ä¸ºäº†æ§åˆ¶â€œæµâ€åˆ°ä¸‹ä¸€å±‚ã€‚å±‚å½’ä¸€åŒ–æé«˜äº†æ”¶æ•›ç¨³å®šæ€§ï¼Œæœ‰æ—¶ç”šè‡³æé«˜äº†è´¨é‡ã€‚ è¿™é‡Œçš„scaleå’Œbiaséƒ½æ˜¯å¯ä»¥è®­ç»ƒçš„å‚æ•°ã€‚ æ³¨æ„Layer Normä¸Batch Normæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œå¼•ç”¨ä¸€ä¸‹æ²ç¥çš„è§†é¢‘ï¼š è¿™æ˜¯Batch Normçš„åˆ‡æ³•ï¼Œå³å¯¹æ¯ä¸ªç‰¹å¾è¿›è¡Œnormã€‚ è¿™æ˜¯Layer normçš„åˆ‡æ³•ï¼Œå³å¯¹æ¯ä¸ªæ ·æœ¬è¿›è¡Œnormã€‚ ä¸ºä»€ä¹ˆç”¨layer normè€Œä¸ç”¨Batch normå‘¢ï¼Ÿ å½“ä½ çš„æ ·æœ¬é•¿åº¦å˜åŒ–æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä½¿ç”¨batch normè®¡ç®—çš„å‡å€¼å’Œæ–¹å·®æ³¢åŠ¨æ¯”è¾ƒå¤§ï¼Œè€Œä¸”batch norméœ€è¦è®°å½•å…¨å±€çš„å‡å€¼å’Œæ–¹å·®ï¼Œå½“é‡åˆ°æ–°çš„æµ‹è¯•æ ·æœ¬çš„æ—¶å€™ï¼Œç”±äºé•¿åº¦çš„åŸå› ï¼Œä¹‹å‰çš„å‡å€¼æ–¹å·®å¯èƒ½å°±æ•ˆæœä¸å¤ªå¥½äº†ã€‚ ä½†æ˜¯å¦‚æœä½¿ç”¨layer norm çš„è¯å°±æ²¡æœ‰é‚£ä¹ˆå¤šçš„é—®é¢˜ï¼Œå› ä¸ºå®ƒæ˜¯æ¯ä¸ªæ ·æœ¬è‡ªå·±è®¡ç®—å‡å€¼æ–¹å·®ï¼Œä¸éœ€è¦å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å‡å€¼æ–¹å·®ï¼Œæ‰€ä»¥ä¼šç¨³å®šä¸€ç‚¹ã€‚ class LayerNorm(nn.Module): def __init__(self, features, eps=1e-6) -\u003e None: super().__init__() self.a_2 = nn.Parameter(torch.ones(features)) self.b_2 = nn.Parameter(torch.zeros(features)) self.eps = eps def forward(self, x): mean = x.mean(-1, keepdim=True) std = x.std(-1, keepdim=True) return self.a_2 * (x - mean) / (std + self.eps) + self.b_2 class SublayerConnection(nn.Module): def __init__(self, size, dropout) -\u003e None: super().__init__() self.norm = LayerNorm(size) self.dropout = nn.Dropout(p=dropout) def forward(self, x, sublayer): return x + self.dropout(sublayer(self.norm(x))) # è¿™é‡Œå’Œè®ºæ–‡ä¸åŒï¼Œå…ˆnormå†æ‰”ç»™sublayerï¼ˆæ¯”å¦‚å¤šå¤´æ³¨æ„åŠ›ã€ffdï¼‰,ç†è®ºä¸Šæ˜¯self.norm(x+self.dropout(sublayer(x))) ","date":"2022-06-08","objectID":"/transformer/:3:3","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"ä½ç½®ç¼–ç (position encoding) (Position Embeddingæ˜¯å­¦ä¹ å¼ï¼Œè€ŒPosition Encodingä¸ºå›ºå®šå¼) è¯·æ³¨æ„ï¼Œç”±äº Transformer ä¸åŒ…å«é€’å½’æˆ–å·ç§¯ï¼Œå®ƒä¸çŸ¥é“è¾“å…¥æ ‡è®°(token)çš„é¡ºåºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è®©æ¨¡å‹æ˜ç¡®åœ°çŸ¥é“æ ‡è®°çš„ä½ç½®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç»„åµŒå…¥ï¼šç”¨äºæ ‡è®°ï¼ˆæˆ‘ä»¬æ€»æ˜¯è¿™æ ·åšï¼‰å’Œç”¨äºä½ç½®ï¼ˆè¯¥æ¨¡å‹æ‰€éœ€çš„æ–°åµŒå…¥ï¼‰ã€‚é‚£ä¹ˆä»¤ç‰Œçš„è¾“å…¥è¡¨ç¤ºæ˜¯ä¸¤ä¸ªåµŒå…¥çš„æ€»å’Œï¼šä»¤ç‰Œå’Œä½ç½®ã€‚ ä½ç½®åµŒå…¥æ˜¯å¯ä»¥å­¦ä¹ çš„ï¼Œä½†ä½œè€…å‘ç°å›ºå®šçš„åµŒå…¥ä¸ä¼šå½±å“è´¨é‡ã€‚Transformer ä¸­ä½¿ç”¨çš„å›ºå®šä½ç½®ç¼–ç æ˜¯ï¼š \\[ PE_{pos,2i} = sin(\\frac{pos}{10000^{\\frac{2i}{d_{model}}}}) \\] \\[ PE_{pos,2i+1} = cos(\\frac{pos}{10000^{\\frac{2i}{d_{model}}}}) \\] å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªè¯çš„ç»´åº¦éƒ½æ˜¯512ç»´ï¼Œå‡è®¾å¥å­é•¿åº¦ä¸º10ï¼Œåˆ™ä½ç½®ç¼–ç çš„è®¡ç®—å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ å¾—åˆ°ä½ç½®ç¼–ç åï¼Œå°†ä½ç½®ç¼–ç ä¸è¯åµŒå…¥ç®€å•ç›¸åŠ å³å¯ã€‚ #### ä»£ç  class PositionalEncoding(nn.Module): def __init__(self, d_model, dropout, max_len=5000) -\u003e None: super().__init__() self.dropout = nn.Dropout(p=dropout) position_embedding = torch.zeros(max_len, d_model) position = torch.arange(0, max_len).unsqueeze(1) div_term = torch.exp(torch.arange(0, d_model, 2) * -(math.log(10000.0) / d_model)) position_embedding[:, 0::2] = torch.sin(position * div_term) position_embedding[:, 1::2] = torch.cos(position * div_term) position_embedding = position_embedding.unsqueeze(0) # å¢åŠ ä¸€ç»´é¢„ç•™batch sizeçš„ä½ç½®ï¼Œæ‰€ä»¥åé¢forwardè¦åœ¨ç¬¬äºŒç»´ä¸Šé€‰å–åºåˆ—é•¿åº¦ self.register_buffer('PositionalEncoding', position_embedding) def forward(self, x): return self.dropout(x + Variable(self.PositionalEncoding[:, :x.size(1)], requires_grad=False)) è¿™é‡Œä¸ºäº†è®¡ç®—åšäº†è½¬æ¢ã€‚ ### Padding Mask å¯¹äºè¾“å…¥åºåˆ—ä¸€èˆ¬æˆ‘ä»¬éƒ½è¦è¿›è¡Œpaddingè¡¥é½ï¼Œä¹Ÿå°±æ˜¯è¯´è®¾å®šä¸€ä¸ªç»Ÿä¸€é•¿åº¦Nï¼Œåœ¨è¾ƒçŸ­çš„åºåˆ—åé¢å¡«å……0åˆ°é•¿åº¦ä¸ºNã€‚å¯¹äºé‚£äº›è¡¥é›¶çš„æ•°æ®æ¥è¯´ï¼Œæˆ‘ä»¬çš„attentionæœºåˆ¶ä¸åº”è¯¥æŠŠæ³¨æ„åŠ›æ”¾åœ¨è¿™äº›ä½ç½®ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†ã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼ŒæŠŠè¿™äº›ä½ç½®çš„å€¼åŠ ä¸Šä¸€ä¸ªéå¸¸å¤§çš„è´Ÿæ•°(è´Ÿæ— ç©·)ï¼Œè¿™æ ·ç»è¿‡softmaxåï¼Œè¿™äº›ä½ç½®çš„æƒé‡å°±ä¼šæ¥è¿‘0ã€‚Transformerçš„padding maskå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¼ é‡ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªBooleanï¼Œå€¼ä¸ºfalseçš„åœ°æ–¹å°±æ˜¯è¦è¿›è¡Œå¤„ç†çš„åœ°æ–¹ã€‚ ","date":"2022-06-08","objectID":"/transformer/:3:4","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"label smoothing(æ ‡ç­¾å¹³æ»‘) ç¥ç»ç½‘ç»œä¼šä¿ƒä½¿è‡ªèº«å¾€æ­£ç¡®æ ‡ç­¾å’Œé”™è¯¯æ ‡ç­¾å·®å€¼æœ€å¤§çš„æ–¹å‘å­¦ä¹ ï¼Œåœ¨è®­ç»ƒæ•°æ®è¾ƒå°‘ï¼Œä¸è¶³ä»¥è¡¨å¾æ‰€æœ‰çš„æ ·æœ¬ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ç½‘ç»œè¿‡æ‹Ÿåˆã€‚ label smoothingå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿™æ˜¯ä¸€ç§æ­£åˆ™åŒ–ç­–ç•¥ï¼Œä¸»è¦æ˜¯é€šè¿‡soft one-hotæ¥åŠ å…¥å™ªå£°ï¼Œå‡å°‘äº†çœŸå®æ ·æœ¬æ ‡ç­¾çš„ç±»åˆ«åœ¨è®¡ç®—æŸå¤±å‡½æ•°æ—¶çš„æƒé‡ï¼Œæœ€ç»ˆèµ·åˆ°æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚ å¢åŠ label smoothingåçœŸå®çš„æ¦‚ç‡åˆ†å¸ƒæœ‰å¦‚ä¸‹æ”¹å˜ï¼š ä»£ç  class LabelSmoothing(nn.Module): # [æ ‡ç­¾å¹³æ»‘](../Deep%20Learning/è®­ç»ƒtrick/æ ‡ç­¾å¹³æ»‘.md)æŸå¤±å‡½æ•° def __init__(self, size, padding_idx, smoothing=0.0) -\u003e None: super().__init__() self.criterion = nn.KLDivLoss(size_average=False) self.padding_idx = padding_idx self.confidence = 1.0 - smoothing self.smoothing = smoothing self.size = size self.true_dist = None def forward(self, x, target): # xçš„shapeä¸º(batch.size * seq.len, target.vocab.size) # yçš„shapeæ˜¯(batch.size * seq.len) # x=logitsï¼Œ(seq.len, target.vocab.size) # æ¯ä¸€è¡Œï¼Œä»£è¡¨ä¸€ä¸ªä½ç½®çš„è¯ # ç±»ä¼¼äºï¼šå‡è®¾seq.len=3, target.vocab.size=5 # xä¸­ä¿å­˜çš„æ˜¯log(prob) #x = tensor([[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233]]) # target ç±»ä¼¼äºï¼š # target = tensor([2, 1, 0])ï¼Œtorch.size=(3) assert x.size(1) == self.size true_dist = x.data.clone() # true_dist = tensor([[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233]]) true_dist.fill_(self.smoothing / (self.size - 2)) # true_dist = tensor([[0.1333, 0.1333, 0.1333, 0.1333, 0.1333], #[0.1333, 0.1333, 0.1333, 0.1333, 0.1333], #[0.1333, 0.1333, 0.1333, 0.1333, 0.1333]]) # æ³¨æ„ï¼Œè¿™é‡Œåˆ†æ¯target.vocab.size-2æ˜¯å› ä¸º # (1) æœ€ä¼˜å€¼ 0.6è¦å ä¸€ä¸ªä½ç½®ï¼› # (2) å¡«å……è¯ \u003cblank\u003e è¦è¢«æ’é™¤åœ¨å¤– # æ‰€ä»¥è¢«æ¿€æ´»çš„ç›®æ ‡è¯­è¨€è¯è¡¨å¤§å°å°±æ˜¯self.size-2 true_dist.scatter_(1, target.data.unsqueeze(1), self.confidence) # target.data.unsqueeze(1) -\u003e # tensor([[2], #[1], #[0]]); shape=torch.Size([3, 1]) # self.confidence = 0.6 # æ ¹æ®target.dataçš„æŒ‡ç¤ºï¼ŒæŒ‰ç…§åˆ—ä¼˜å…ˆ(1)çš„åŸåˆ™ï¼ŒæŠŠ0.6è¿™ä¸ªå€¼ # å¡«å…¥true_dist: å› ä¸ºtarget.dataæ˜¯2,1,0çš„å†…å®¹ï¼Œ # æ‰€ä»¥ï¼Œ0.6å¡«å…¥ç¬¬0è¡Œçš„ç¬¬2åˆ—ï¼ˆåˆ—å·ï¼Œè¡Œå·éƒ½æ˜¯0å¼€å§‹ï¼‰ # 0.6å¡«å…¥ç¬¬1è¡Œçš„ç¬¬1åˆ— # 0.6å¡«å…¥ç¬¬2è¡Œçš„ç¬¬0åˆ—ï¼š # true_dist = tensor([[0.1333, 0.1333, 0.6000, 0.1333, 0.1333], #[0.1333, 0.6000, 0.1333, 0.1333, 0.1333], #[0.6000, 0.1333, 0.1333, 0.1333, 0.1333]]) true_dist[:, self.padding_idx] = 0 # true_dist = tensor([[0.0000, 0.1333, 0.6000, 0.1333, 0.1333], #[0.0000, 0.6000, 0.1333, 0.1333, 0.1333], #[0.0000, 0.1333, 0.1333, 0.1333, 0.1333]]) # è®¾ç½®true_distè¿™ä¸ªtensorçš„ç¬¬ä¸€åˆ—çš„å€¼å…¨ä¸º0 # å› ä¸ºè¿™ä¸ªæ˜¯å¡«å……è¯'\u003cblank\u003e'æ‰€åœ¨çš„idä½ç½®ï¼Œä¸åº”è¯¥è®¡å…¥ # ç›®æ ‡è¯è¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtrue_distçš„æ¯ä¸€åˆ—ï¼Œä»£è¡¨ç›®æ ‡è¯­è¨€è¯è¡¨ #ä¸­çš„ä¸€ä¸ªè¯çš„id mask = torch.nonzero(target.data == self.padding_idx) # mask = tensor([[2]]), ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åä¸€ä¸ªè¯ 2,1,0ä¸­çš„0ï¼Œ # å› ä¸ºæ˜¯'\u003cblank\u003e'çš„idï¼Œæ‰€ä»¥é€šè¿‡ä¸Šé¢çš„ä¸€æ­¥ï¼ŒæŠŠä»–ä»¬æ‰¾å‡ºæ¥ # å¦‚æœä¸åŠ ä¸Šnonzeroï¼Œé‚£ä¹ˆmaskçš„shapeå°±æ˜¯torch.Size([3]) if mask.dim() \u003e 0: true_dist.index_fill_(0, mask.squeeze(), 0.0) # å½“target referenceåºåˆ—ä¸­æœ‰0è¿™ä¸ª'\u003cblank\u003e'çš„æ—¶å€™ï¼Œåˆ™éœ€è¦æŠŠ # è¿™ä¸€è¡Œçš„å€¼éƒ½æ¸…ç©ºã€‚ # åœ¨ä¸€ä¸ªbatché‡Œé¢çš„æ—¶å€™ï¼Œå¯èƒ½ä¸¤ä¸ªåºåˆ—é•¿åº¦ä¸ä¸€ï¼Œæ‰€ä»¥çŸ­çš„åºåˆ—éœ€è¦ # pad '\u003cblank\u003e'æ¥å¡«å……ï¼Œæ‰€ä»¥ä¼šå‡ºç°ç±»ä¼¼äº(2,1,0)è¿™æ ·çš„æƒ…å†µ # true_dist = tensor([[0.0000, 0.1333, 0.6000, 0.1333, 0.1333], # [0.0000, 0.6000, 0.1333, 0.1333, 0.1333], # [0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]) self.true_dist = true_dist return self.criterion(x, Variable(true_dist, requires_grad=False)) # è¿™ä¸€æ­¥å°±æ˜¯è°ƒç”¨KL lossæ¥è®¡ç®— # x = tensor([[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233], #[-20.7233, -1.6094, -0.3567, -2.3026, -20.7233]]) # true_dist=tensor([[0.0000, 0.1333, 0.6000, 0.1333, 0.1333], # [0.0000, 0.6000, 0.1333, 0.1333, 0.1333], # [0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]) ","date":"2022-06-08","objectID":"/transformer/:3:5","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"é¢„æµ‹ é¢„æµ‹è¿‡ç¨‹ä¸ä¸€èˆ¬seq2seqä¸åŒçš„æ˜¯ï¼Œtæ—¶åˆ»æ˜¯å°†1åˆ°t-1æ—¶åˆ»æ‰€æœ‰çš„é¢„æµ‹ç»“æœä½œä¸ºåºåˆ—è¿›è¡Œé¢„æµ‹ï¼Œè€Œseq2seqåªæ˜¯ä½¿ç”¨å‰ä¸€æ—¶åˆ»çš„è¾“å‡ºä½œä¸ºå½“å‰æ—¶åˆ»çš„è¾“å…¥ï¼Œè¿™é‡Œå›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼Œå®ç°äº†transformerä»£ç åå¯¹æ¯”ææ²è€å¸ˆçš„ä»£ç æ‰ç†è§£ã€‚ å…¶ä¸­seq2seq: transformer: æ³¨æ„ysæœ€åä¸ä¹‹å‰çš„ysä½¿ç”¨catå‡½æ•°åˆå¹¶åœ¨ä¸€èµ·ã€‚ ## æ€»ç»“ Transformerè¿˜æœ‰å¾ˆå¤šçš„æ¨¡å‹ç»†èŠ‚ï¼Œä»¥åé‡åˆ°äº†å†è®°å½•ä¸€ä¸‹ï¼Œåœ¨é¢è¯•ä¸­å¾ˆå®¹æ˜“é—®åˆ°è¿™äº›ç»†èŠ‚ï¼Œå› æ­¤å¯ä»¥å‚è€ƒé¢ç»è¾¹å­¦ä¹ è¾¹è®°å½•ï¼Œå¯ä»¥æŸ¥ç¼ºè¡¥æ¼ä¹Ÿå¯ä»¥å­¦åˆ°æ–°çš„ä¸œè¥¿ã€‚æ¥ä¸‹æ¥æŠŠä»£ç å¤ç°ä¸€ä¸‹å¯ä»¥åŠ æ·±ç†è§£ï¼Œå¹¶ä¸”æé«˜è‡ªå·±çš„ä»£ç æ°´å¹³å’Œå®è·µèƒ½åŠ›ã€‚ ","date":"2022-06-08","objectID":"/transformer/:4:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"ä¸€äº›é—®é¢˜ Transformeråœ¨å“ªé‡Œåšäº†æƒé‡å…±äº«ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åšæƒé‡å…±äº«ï¼Ÿ Transformeråœ¨ä¸¤ä¸ªåœ°æ–¹è¿›è¡Œäº†æƒé‡å…±äº«ï¼š ï¼ˆ1ï¼‰Encoderå’ŒDecoderé—´çš„Embeddingå±‚æƒé‡å…±äº«ï¼› ï¼ˆ2ï¼‰Decoderä¸­Embeddingå±‚å’ŒFCå±‚æƒé‡å…±äº«ã€‚ å¯¹äºï¼ˆ1ï¼‰ï¼Œã€ŠAttention is all you needã€‹ä¸­Transformerè¢«åº”ç”¨åœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸­ï¼Œæºè¯­è¨€å’Œç›®æ ‡è¯­è¨€æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†å®ƒä»¬å¯ä»¥å…±ç”¨ä¸€å¼ å¤§è¯è¡¨ï¼Œå¯¹äºä¸¤ç§è¯­è¨€ä¸­å…±åŒå‡ºç°çš„è¯ï¼ˆæ¯”å¦‚ï¼šæ•°å­—ï¼Œæ ‡ç‚¹ç­‰ç­‰ï¼‰å¯ä»¥å¾—åˆ°æ›´å¥½çš„è¡¨ç¤ºï¼Œè€Œä¸”å¯¹äºEncoderå’ŒDecoderï¼ŒåµŒå…¥æ—¶éƒ½åªæœ‰å¯¹åº”è¯­è¨€çš„embeddingä¼šè¢«æ¿€æ´»ï¼Œå› æ­¤æ˜¯å¯ä»¥å…±ç”¨ä¸€å¼ è¯è¡¨åšæƒé‡å…±äº«çš„ã€‚ è®ºæ–‡ä¸­ï¼ŒTransformerè¯è¡¨ç”¨äº†bpeæ¥å¤„ç†ï¼Œæ‰€ä»¥æœ€å°çš„å•å…ƒæ˜¯subwordã€‚è‹±è¯­å’Œå¾·è¯­åŒå±æ—¥è€³æ›¼è¯­æ—ï¼Œæœ‰å¾ˆå¤šç›¸åŒçš„subwordï¼Œå¯ä»¥å…±äº«ç±»ä¼¼çš„è¯­ä¹‰ã€‚è€Œåƒä¸­è‹±è¿™æ ·ç›¸å·®è¾ƒå¤§çš„è¯­ç³»ï¼Œè¯­ä¹‰å…±äº«ä½œç”¨å¯èƒ½ä¸ä¼šå¾ˆå¤§ã€‚ ä½†æ˜¯ï¼Œå…±ç”¨è¯è¡¨ä¼šä½¿å¾—è¯è¡¨æ•°é‡å¢å¤§ï¼Œå¢åŠ softmaxçš„è®¡ç®—æ—¶é—´ï¼Œå› æ­¤å®é™…ä½¿ç”¨ä¸­æ˜¯å¦å…±äº«å¯èƒ½è¦æ ¹æ®æƒ…å†µæƒè¡¡ã€‚ å¯¹äºï¼ˆ2ï¼‰ï¼ŒEmbeddingå±‚å¯ä»¥è¯´æ˜¯é€šè¿‡onehotå»å–åˆ°å¯¹åº”çš„embeddingå‘é‡ï¼ŒFCå±‚å¯ä»¥è¯´æ˜¯ç›¸åçš„ï¼Œé€šè¿‡å‘é‡ï¼ˆå®šä¹‰ä¸º xï¼‰å»å¾—åˆ°å®ƒå¯èƒ½æ˜¯æŸä¸ªè¯çš„softmaxæ¦‚ç‡ï¼Œå–æ¦‚ç‡æœ€å¤§ï¼ˆè´ªå©ªæƒ…å†µä¸‹ï¼‰çš„ä½œä¸ºé¢„æµ‹å€¼ã€‚ é‚£å“ªä¸€ä¸ªä¼šæ˜¯æ¦‚ç‡æœ€å¤§çš„å‘¢ï¼Ÿåœ¨FCå±‚çš„æ¯ä¸€è¡Œé‡çº§ç›¸åŒçš„å‰æä¸‹ï¼Œç†è®ºä¸Šå’Œ x ç›¸åŒçš„é‚£ä¸€è¡Œå¯¹åº”çš„ç‚¹ç§¯å’Œsoftmaxæ¦‚ç‡ä¼šæ˜¯æœ€å¤§çš„ã€‚ å› æ­¤ï¼ŒEmbeddingå±‚å’ŒFCå±‚æƒé‡å…±äº«ï¼ŒEmbeddingå±‚ä¸­å’Œå‘é‡ x æœ€æ¥è¿‘çš„é‚£ä¸€è¡Œå¯¹åº”çš„è¯ï¼Œä¼šè·å¾—æ›´å¤§çš„é¢„æµ‹æ¦‚ç‡ã€‚å®é™…ä¸Šï¼ŒDecoderä¸­çš„Embeddingå±‚å’ŒFCå±‚æœ‰ç‚¹åƒäº’ä¸ºé€†è¿‡ç¨‹ã€‚ é€šè¿‡è¿™æ ·çš„æƒé‡å…±äº«å¯ä»¥å‡å°‘å‚æ•°çš„æ•°é‡ï¼ŒåŠ å¿«æ”¶æ•›ã€‚ ","date":"2022-06-08","objectID":"/transformer/:5:0","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["NLP"],"content":"ä¸ºä»€ä¹ˆé™¤ä»¥æ ¹å·d è®ºæ–‡ä¸­çš„è§£é‡Šæ˜¯ï¼šå‘é‡çš„ç‚¹ç§¯ç»“æœä¼šå¾ˆå¤§ï¼Œå°† softmax å‡½æ•° push åˆ°æ¢¯åº¦å¾ˆå°çš„åŒºåŸŸï¼Œscaled ä¼šç¼“è§£è¿™ç§ç°è±¡ã€‚ \\[\\frac{\\partial\\mathbf{y}}{\\partial\\mathbf{x}}=\\mathrm{diag}(\\mathbf{y})-\\mathbf{y}\\mathbf{y}^T\\] å½“\\(\\mathbf{y} =\\)softmax\\(( \\mathbf{x} )\\)æ—¶ï¼Œ\\(\\mathbf{y}\\)å¯¹\\(\\mathbf{x}\\)çš„æ¢¯åº¦ä¸ºï¼š è¿™æ˜¯ä¸€ä¸ªjacobiçŸ©é˜µ\\(^{+}\\),è¡¨ç¤ºyçš„æ¯ä¸€ä¸ªå…ƒç´ å¯¹xæ¯ä¸€ä¸ªå…ƒç´ çš„å¯¼æ•°æ˜¯ä»€ä¹ˆã€‚ å±•å¼€ï¼š \\[\\frac{\\partial\\mathbf{y}}{\\partial\\mathbf{x}}=\\begin{bmatrix}y_1\u00260\u0026\\cdots\u00260\\\\0\u0026y_2\u0026\\cdots\u00260\\\\\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\\\\0\u00260\u0026\\cdots\u0026y_d\\end{bmatrix}-\\begin{bmatrix}y_1^2\u0026y_1y_2\u0026\\cdots\u0026y_1y_d\\\\y_2y_1\u0026y_2^2\u0026\\cdots\u0026y_2y_d\\\\\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\\\\y_dy_1\u0026y_dy_2\u0026\\cdots\u0026y_d^2\\end{bmatrix}\\] æ ¹æ®å‰é¢çš„è®¨è®ºï¼Œå½“è¾“å…¥ \\(\\mathbf{x}\\) çš„æŸä¸€ä¸ªå…ƒç´ è¾ƒå¤§æ—¶ï¼Œsoftmax ä¼šæŠŠå¤§éƒ¨åˆ†æ¦‚ç‡åˆ†å¸ƒ\\(^{+}\\)åˆ†é…ç»™æœ€å¤§çš„å…ƒ ç´ ï¼Œå‡è®¾æˆ‘ä»¬çš„è¾“å…¥æ•°é‡çº§å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±å°†äº§ç”Ÿä¸€ä¸ªæ¥è¿‘ one-hot çš„å‘é‡ \\[\\mathbf{y}\\approx[1,0,\\cdots,0]^\\top \\] æ­¤æ—¶ä¸Šé¢çš„çŸ©é˜µå˜ä¸ºå¦‚ä¸‹å½¢å¼ \\[\\frac{\\partial\\mathbf{y}}{\\partial\\mathbf{x}}\\approx\\begin{bmatrix}1\u00260\u0026\\cdots\u00260\\\\0\u00260\u0026\\cdots\u00260\\\\\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\\\\0\u00260\u0026\\cdots\u00260\\end{bmatrix}-\\begin{bmatrix}1\u00260\u0026\\cdots\u00260\\\\0\u00260\u0026\\cdots\u00260\\\\\\vdots\u0026\\vdots\u0026\\ddots\u0026\\vdots\\\\0\u00260\u0026\\cdots\u00260\\end{bmatrix}=\\mathbf{0}\\] ä¹Ÿå°±æ˜¯æ‰€æœ‰çš„æ¢¯åº¦éƒ½æ¥è¿‘0 é™¤ä»¥\\(\\sqrt{ d }\\)åå°±ä½¿xçš„åˆ†å¸ƒæ›´åŠ å¹³ç¼“ï¼Œä»è€Œé˜²æ­¢æ¢¯åº¦æ¶ˆå¤±ã€‚ from scipy.special import softmax import numpy as np def test_gradient(dim, time_steps=50, scale=1.0): # Assume components of the query and keys are drawn from N(0, 1) independently q = np.random.randn(dim) ks = np.random.randn(time_steps, dim) x = np.sum(q * ks, axis=1) / scale # x.shape = (time_steps,) y = softmax(x) grad = np.diag(y) - np.outer(y, y)# softmax gradient(dy/dx) return np.max(np.abs(grad)) # the maximum component of gradients NUMBER_OF_EXPERIMENTS = 5 # results of 5 random runs without scaling print([test_gradient(100) for _ in range(NUMBER_OF_EXPERIMENTS)]) print([test_gradient(1000) for _ in range(NUMBER_OF_EXPERIMENTS)]) # results of 5 random runs with scaling print([test_gradient(100, scale=np.sqrt(100)) for _ in range(NUMBER_OF_EXPERIMENTS)]) print([test_gradient(1000, scale=np.sqrt(1000)) for _ in range(NUMBER_OF_EXPERIMENTS)]) è¾“å‡ºå¯çœ‹åˆ°ä¸‹é¢çš„æ¢¯åº¦æ¯”ä¸Šé¢çš„æ¢¯åº¦æ›´å¤§ã€‚ è¿™æ—¶åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¤šåˆ†ç±»çš„softmax+äº¤å‰ç†µä¸éœ€è¦é™¤ä»¥ä¸œè¥¿å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºäº¤å‰ç†µä¸­æœ‰ä¸€ä¸ªlogï¼Œlog_softmaxçš„æ¢¯åº¦å’Œåˆšæ‰ç®—å‡ºæ¥çš„ä¸åŒï¼Œå°±ç®—è¾“å…¥çš„æŸä¸€ä¸ªxè¿‡å¤§ä¹Ÿä¸ä¼šæ¢¯åº¦æ¶ˆå¤±ã€‚æ‰€ä»¥å°±åˆå¯ä»¥æ¨æ–­å‡ºsoftmax+MSEä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ï¼Œå› ä¸ºMSEä¸­æ²¡æœ‰Logï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆåˆ†ç±»ä»»åŠ¡ä¸ä½¿ç”¨MSEæŸå¤±å‡½æ•°çš„åŸå› ä¹‹ä¸€ã€‚ ### ä¸ºä»€ä¹ˆ Transformer éœ€è¦è¿›è¡Œ Multi-head Attention å®éªŒè¯æ˜å¤šå¤´æ˜¯å¿…è¦çš„ï¼Œ8/16ä¸ªå¤´éƒ½å¯ä»¥å–å¾—æ›´å¥½çš„æ•ˆæœï¼Œä½†æ˜¯è¶…è¿‡16ä¸ªåè€Œæ•ˆæœä¸å¥½ã€‚æ¯ä¸ªå¤´å…³æ³¨çš„ä¿¡æ¯ä¸åŒï¼Œä½†æ˜¯å¤´ä¹‹é—´çš„å·®å¼‚éšç€å±‚æ•°å¢åŠ è€Œå‡å°‘ã€‚å¹¶ä¸”ä¸æ˜¯æ‰€æœ‰å¤´éƒ½æœ‰ç”¨ï¼Œæœ‰å·¥ä½œå°è¯•å‰ªæï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½çš„è¡¨ç°ã€‚ è®ºæ–‡ä¸­æåˆ°æ¨¡å‹åˆ†ä¸ºå¤šä¸ªå¤´ï¼Œå½¢æˆå¤šä¸ªå­ç©ºé—´ï¼Œæ¯ä¸ªå¤´å…³æ³¨ä¸åŒæ–¹é¢çš„ä¿¡æ¯ã€‚ é‚£ä¸ºä»€ä¹ˆæ¯ä¸ªå¤´çš„ç»´åº¦è¦é™å‘¢? ä¸€è¨€è”½ä¹‹çš„è¯ï¼Œå¤§æ¦‚æ˜¯ï¼šåœ¨ä¸å¢åŠ æ—¶é—´å¤æ‚åº¦çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶ï¼Œå€Ÿé‰´CNNå¤šæ ¸çš„æ€æƒ³ï¼Œåœ¨æ›´ä½çš„ç»´åº¦ï¼Œåœ¨å¤šä¸ªç‹¬ç«‹çš„ç‰¹å¾ç©ºé—´ï¼Œæ›´å®¹æ˜“å­¦ä¹ åˆ°æ›´ä¸°å¯Œçš„ç‰¹å¾ä¿¡æ¯ã€‚ ### ä¸ºä»€ä¹ˆ Transformer çš„ Embedding æœ€åè¦ä¹˜dmodel å…·ä½“çš„åŸå› æ˜¯ï¼Œå¦‚æœä½¿ç”¨ Xavier åˆå§‹åŒ–ï¼ŒEmbedding çš„æ–¹å·®ä¸º 1/d_modelï¼Œå½“d_modeléå¸¸å¤§æ—¶ï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½ä¼šå‡å°ã€‚é€šè¿‡ä¹˜ä¸€ä¸ªÂ dmodelÂ å¯ä»¥å°†æ–¹å·®æ¢å¤åˆ°1ã€‚ å› ä¸ºPosition Encodingæ˜¯é€šè¿‡ä¸‰è§’å‡½æ•°ç®—å‡ºæ¥çš„ï¼Œå€¼åŸŸä¸º[-1, 1]ã€‚æ‰€ä»¥å½“åŠ ä¸Š Position Encoding æ—¶ï¼Œéœ€è¦æ”¾å¤§Â embeddingÂ çš„æ•°å€¼ï¼Œå¦åˆ™è§„æ¨¡ä¸ä¸€è‡´ç›¸åŠ åä¼šä¸¢å¤±ä¿¡æ¯ã€‚ å› ä¸º Bert ä½¿ç”¨çš„æ˜¯å­¦ä¹ å¼çš„Embeddingï¼Œæ‰€ä»¥ Bert è¿™é‡Œå°±ä¸éœ€è¦æ”¾å¤§ã€‚ # å‚è€ƒ Bert/Transformer è¢«å¿½è§†çš„ç»†èŠ‚ï¼ˆæˆ–è®¸å¯ä»¥ç”¨æ¥åšé¢è¯•é¢˜ï¼‰ - çŸ¥ä¹ (zhihu.com) ","date":"2022-06-08","objectID":"/transformer/:5:1","tags":["NLP","Transformer"],"title":"Transformer","uri":"/transformer/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ€å¤§å­åºå’Œ https://leetcode-cn.com/problems/maximum-subarray/ ä¸€å¼€å§‹ç›´æ¥æš´åŠ›ï¼Œç»“æœtleäº†æœ€å class Solution: def maxSubArray(nums): res = -float('inf') for i in range(len(nums)): for j in range(i,len(nums)): res = max(res,sum(nums[i:j+1])) return res è¿™è¯´æ˜åœ¨leetcodeå°½é‡ä¸è¦åµŒå¥—å¾ªç¯ï¼Œå¤§æ¦‚ç‡Tle class Solution: def maxSubArray(nums): for i in range(1,len(nums)): maxs = max(nums[i-1]+nums[i],nums[i]) nums[i] = maxs return max(nums) æœ€åå·§å¦™åœ°åˆ©ç”¨äº†æ›¿æ¢çš„æ€æƒ³ï¼Œå°†æ¯æ¬¡ç›¸åŠ çš„å€¼å’Œå½“å‰æ¯”è¾ƒï¼Œå¹¶å°†å½“å‰æ›¿æ¢ä¸ºè¾ƒå¤§çš„é‚£ä¸ªå€¼ï¼Œæœ€åæ±‚æ•´ä¸ªåˆ—è¡¨çš„æœ€å¤§å€¼ã€‚ ","date":"2022-06-08","objectID":"/%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/:0:0","tags":["ç®—æ³•é¢˜","æœ€å¤§å­åºå’Œ"],"title":"æœ€å¤§å­åºå’Œ","uri":"/%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯ æ¯æ—¥ä¸€é¢˜åˆ·åˆ°çš„ã€‚ åŠ¨æ€è§„åˆ’ç±»å‹çš„é¢˜ç›®ï¼Œé‡ç‚¹å°±æ˜¯æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå› ä¸ºæˆ‘ä¸å¤ªç†Ÿç»ƒï¼Œå¯¹åŠ¨æ€è§„åˆ’çš„é¢˜ç›®åšçš„æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥WAäº†å¥½å‡ æ¬¡ã€‚ class Solution: def minCostClimbingStairs(cost): res = [] #res[i]å°±æ˜¯åˆ°ç¬¬ié˜¶æ¢¯æ—¶æœ€å°çš„èŠ±è´¹ res.append(cost[0]) #åˆ°ç¬¬ä¸€é˜¶æ¢¯æœ€å°å°±æ˜¯0+cost[0] res.append(cost[1]) #ç¬¬äºŒé˜¶æ¢¯æœ€å°å°±æ˜¯0+cost[1] #çŠ¶æ€è½¬ç§»æ–¹ç¨‹:res[i] = min(res[i-1],res[i-2])+cost[i] for i in range(2,len(cost)): res.append(min(res[i-1],res[i-2])+cost[i]) # return min(res[-1],res[-2]) è¸ä¸Šç¬¬içº§å°é˜¶æœ‰ä¸¤ç§æ–¹æ³•ï¼š å…ˆè¸ä¸Šç¬¬i-2çº§å°é˜¶ï¼ˆæœ€å°æ€»èŠ±è´¹dp[i-2]ï¼‰ï¼Œå†ç›´æ¥è¿ˆä¸¤æ­¥è¸ä¸Šç¬¬içº§å°é˜¶ï¼ˆèŠ±è´¹cost[i]ï¼‰ï¼Œæœ€å°æ€»èŠ±è´¹dp[i-2] + cost[i]ï¼› å…ˆè¸ä¸Šç¬¬i-1çº§å°é˜¶ï¼ˆæœ€å°æ€»èŠ±è´¹dp[i-1]ï¼‰ï¼Œå†è¿ˆä¸€æ­¥è¸ä¸Šç¬¬içº§å°é˜¶ï¼ˆèŠ±è´¹cost[i]ï¼‰ï¼Œæœ€å°æ€»èŠ±è´¹dp[i-1] + cost[i]ï¼› ä¸Šè¿°ä¸ºå¼•ç”¨çš„é¢˜è§£çš„è¯´æ˜ï¼Œæ›´åŠ æ·±äº†å¯¹åŠ¨æ€è§„åˆ’çš„ç†è§£ ","date":"2022-06-01","objectID":"/%E4%BD%BF%E7%94%A8%E6%9C%80%E5%B0%8F%E8%8A%B1%E8%B4%B9%E7%88%AC%E6%A5%BC%E6%A2%AF/:0:0","tags":["ç®—æ³•é¢˜","ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"],"title":"ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯","uri":"/%E4%BD%BF%E7%94%A8%E6%9C%80%E5%B0%8F%E8%8A%B1%E8%B4%B9%E7%88%AC%E6%A5%BC%E6%A2%AF/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"CRF ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:0:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¦‚ç‡å›¾æ¨¡å‹ä¸æ— å‘å›¾ å›¾æ˜¯ç”±ç»“ç‚¹å’Œè¿æ¥ç»“ç‚¹çš„è¾¹ç»„æˆçš„é›†åˆã€‚ç»“ç‚¹å’Œè¾¹åˆ†åˆ«è®°ä½œvå’Œeï¼Œç»“ç‚¹å’Œè¾¹çš„é›†åˆåˆ†åˆ«è®°ä½œVå’ŒEï¼Œå›¾è®°ä½œ\\(G=(V, E)\\)ã€‚ æ— å‘å›¾æ˜¯æŒ‡æ²¡æœ‰æ–¹å‘çš„å›¾ã€‚ æ¦‚ç‡å›¾æ¨¡å‹æ˜¯ç”±å›¾è¡¨ç¤ºçš„æ¦‚ç‡åˆ†å¸ƒã€‚è®¾æœ‰è”åˆæ¦‚ç‡åˆ†å¸ƒP(Y), Yæ˜¯ä¸€ç»„éšæœºå˜é‡ï¼Œç”±æ— å‘å›¾\\(G=(V,E)\\)è¡¨ç¤ºæ¦‚ç‡åˆ†å¸ƒP(Y)ï¼Œå³åœ¨å›¾Gä¸­ï¼Œç»“ç‚¹\\(v\\in V\\)è¡¨ç¤ºä¸€ä¸ªéšæœºå˜é‡\\(Y_v\\)ï¼Œ\\(Y=(Y_v)\\_{v\\in V}\\)ï¼Œè¾¹eè¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:1:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¦‚ç‡æ— å‘å›¾æ¨¡å‹ è®¾æœ‰è”åˆæ¦‚ç‡åˆ†å¸ƒP(Y)ï¼Œç”±æ— å‘å›¾\\(G=(V,E)\\)è¡¨ç¤ºï¼Œåœ¨å›¾Gä¸­ï¼Œç»“ç‚¹è¡¨ç¤ºéšæœºå˜é‡ï¼Œè¾¹è¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å¦‚æœè”åˆæ¦‚ç‡åˆ†å¸ƒæ»¡è¶³æˆå¯¹ã€å±€éƒ¨æˆ–å…¨å±€é©¬å°”ç§‘å¤«æ€§ï¼Œå°±ç§°æ­¤è”åˆæ¦‚ç‡åˆ†å¸ƒç§°ä¸ºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œæˆ–é©¬å°”ç§‘å¤«éšæœºåœºã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:2:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"å› å­åˆ†è§£ é¦–å…ˆç»™å‡ºæ— å‘å›¾çš„å›¢å’Œæœ€å¤§å›¢çš„å®šä¹‰ï¼š æ— å‘å›¾Gä¸­ä»»ä½•ä¸¤ä¸ªç»“ç‚¹å‡æœ‰è¾¹è¿æ¥çš„ç»“ç‚¹å­é›†ç§°ä¸ºå›¢ã€‚è‹¥Cæ˜¯æ— å‘å›¾Gçš„ä¸€ä¸ªå›¢ï¼Œå¹¶ä¸”ä¸èƒ½å†åŠ è¿›ä»»ä½•ä¸€ä¸ªGçš„ç»“ç‚¹ä½¿å…¶æˆä¸ºæ›´å¤§çš„å›¢ï¼Œåˆ™ç§°æ­¤Cä¸ºæœ€å¤§å›¢ã€‚ å°†æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒè¡¨ç¤ºä¸ºå…¶æœ€å¤§å›¢ä¸Šçš„éšæœºå˜é‡çš„å‡½æ•°çš„ä¹˜ç§¯å½¢å¼çš„æ“ä½œï¼Œç§°ä¸ºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å­åˆ†è§£ã€‚ ç»™å®šæ¦‚ç‡æ— å‘å›¾æ¨¡å‹, è®¾å…¶æ— å‘å›¾ä¸º \\(G, C\\) ä¸º \\(G\\) ä¸Šçš„æœ€å¤§å›¢, \\(Y_C\\) è¡¨ç¤º \\(C\\) å¯¹åº”çš„ éšæœºå˜é‡ã€‚é‚£ä¹ˆæ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ \\(P(Y)\\) å¯å†™ä½œå›¾ä¸­æ‰€æœ‰æœ€å¤§å›¢ \\(C\\) ä¸Šçš„ å‡½æ•° \\(\\Psi_C\\left(Y_C\\right)\\) çš„ä¹˜ç§¯å½¢å¼, å³ \\[ P(Y)=\\frac{1}{Z} \\prod_C \\Psi_C\\left(Y_C\\right) \\] å…¶ä¸­, \\(Z\\) æ˜¯è§„èŒƒåŒ–å› å­ (normalization factor), ç”±å¼ \\[ Z=\\sum_Y \\prod_C \\Psi_C\\left(Y_C\\right) \\] ç»™å‡ºã€‚è§„èŒƒåŒ–å› å­ä¿è¯ \\(P(Y)\\) æ„æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚å‡½æ•° \\(\\Psi_C\\left(Y_C\\right)\\) ç§°ä¸ºåŠ¿å‡½æ•° (potential function)ã€‚è¿™é‡Œè¦æ±‚åŠ¿å‡½æ•° \\(\\Psi_C\\left(Y_C\\right)\\) æ˜¯ä¸¥æ ¼æ­£çš„, é€šå¸¸å®šä¹‰ä¸ºæŒ‡æ•°å‡½æ•°: \\[ \\Psi_C\\left(Y_C\\right)=\\exp \\\\{-E\\left(Y_C\\right)\\\\\\} \\] ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:3:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¡ä»¶éšæœºåœº æ¡ä»¶éšæœºåœºæ˜¯æŒ‡ç»™å®šéšæœºå˜é‡Xçš„æ¡ä»¶ä¸‹ï¼Œéšæœºå˜é‡Yçš„é©¬å°”ç§‘å¤«éšæœºåœºã€‚ä¸€èˆ¬çš„æ¡ä»¶éšæœºåœºä¸»è¦æ˜¯æŒ‡çº¿æ€§é“¾æ¡ä»¶éšæœºåœºï¼Œå¯ä»¥ç”¨äºæ ‡æ³¨ç­‰é—®é¢˜ã€‚è¿™é‡Œçš„\\(P(Y|X)\\)ä¸­ï¼ŒYæ˜¯è¾“å‡ºå˜é‡ï¼Œè¡¨ç¤ºæ ‡æ³¨åºåˆ—ï¼ŒXæ˜¯è¾“å…¥å˜é‡ï¼Œè¡¨ç¤ºéœ€è¦æ ‡æ³¨çš„è§‚å¯Ÿåºåˆ—ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"ä¸€èˆ¬çš„æ¡ä»¶éšæœºåœº (æ¡ä»¶éšæœºåœº) è®¾ \\(X\\) ä¸ \\(Y\\) æ˜¯éšæœºå˜é‡, \\(P(Y \\mid X)\\) æ˜¯åœ¨ç»™å®š \\(X\\) çš„æ¡ä»¶ ä¸‹ \\(Y\\) çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚è‹¥éšæœºå˜é‡ \\(Y\\) æ„æˆä¸€ä¸ªç”±æ— å‘å›¾ \\(G=(V, E)\\) è¡¨ç¤ºçš„é©¬å°”å¯å¤« éšæœºåœº, å³ \\[ P\\left(Y_v \\mid X, Y_w, w \\neq v\\right)=P\\left(Y_v \\mid X, Y_w, w \\sim v\\right) \\] å¯¹ä»»æ„ç»“ç‚¹ \\(v\\) æˆç«‹, åˆ™ç§°æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ \\(P(Y \\mid X)\\) ä¸ºæ¡ä»¶éšæœºåœºã€‚å¼ä¸­ \\(w \\sim v\\) è¡¨ç¤ºåœ¨ å›¾ \\(G=(V, E)\\) ä¸­ä¸ç»“ç‚¹ \\(v\\) æœ‰è¾¹è¿æ¥çš„æ‰€æœ‰ç»“ç‚¹ \\(w, w \\neq v\\) è¡¨ç¤ºç»“ç‚¹ \\(v\\) ä»¥å¤–çš„æ‰€æœ‰ç»“ ç‚¹, \\(Y_v, Y_u\\) ä¸ \\(Y_w\\) ä¸ºç»“ç‚¹ \\(v, u\\) ä¸ \\(w\\) å¯¹åº”çš„éšæœºå˜é‡ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:1","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"çº¿æ€§é“¾æ¡ä»¶éšæœºåœº è®¾\\(X=(X_1,X_2, \\dots, X_n), \\quad Y=(Y_1, Y_2, \\dots , Y_n)\\)å‡ä¸ºçº¿æ€§é“¾è¡¨ç¤ºçš„éšæœºå˜é‡åºåˆ—ï¼Œè‹¥åœ¨ç»™å®šéšæœºå˜é‡åºåˆ—Xçš„æ¡ä»¶ä¸‹ï¼Œéšæœºå˜é‡Yçš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ\\(P(Y|X)\\)æ„æˆæ¡ä»¶éšæœºåœºï¼Œå³æ»¡è¶³é©¬å°”ç§‘å¤«æ€§ \\[ P\\left(Y_i \\mid X, Y_1, \\cdots, Y_{i-1}, Y_{i+1}, \\cdots, Y_n\\right)=P\\left(Y_i \\mid X, Y_{i-1}, Y_{i+1}\\right) \\] \\(i=1,2, \\cdots, n\\) (åœ¨ \\(i=1\\) å’Œ \\(n\\) æ—¶åªè€ƒè™‘å•è¾¹) åˆ™ç§° \\(P(Y \\mid X)\\) ä¸ºçº¿æ€§é“¾æ¡ä»¶éšæœºåœºã€‚åœ¨æ ‡æ³¨é—®é¢˜ä¸­, \\(X\\) è¡¨ç¤ºè¾“å…¥è§‚æµ‹åºåˆ—, \\(Y\\) è¡¨ç¤ºå¯¹ åº”çš„è¾“å‡ºæ ‡è®°åºåˆ—æˆ–çŠ¶æ€åºåˆ—ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:2","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"çº¿æ€§é“¾æ¡ä»¶éšæœºåœºå‚æ•°åŒ–å½¢å¼ æ ¹æ®å› å­åˆ†è§£, å¯ä»¥ç»™å‡ºçº¿æ€§é“¾æ¡ä»¶éšæœºåœº \\(P(Y \\mid X)\\) çš„å› å­åˆ†è§£å¼, å„å› å­æ˜¯å®š ä¹‰åœ¨ç›¸é‚»ä¸¤ä¸ªç»“ç‚¹ (æœ€å¤§å›¢) ä¸Šçš„åŠ¿å‡½æ•°ã€‚ (çº¿æ€§é“¾æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼) è®¾ \\(P(Y \\mid X)\\) ä¸ºçº¿æ€§é“¾æ¡ä»¶éšæœº åœº, åˆ™åœ¨éšæœºå˜é‡ \\(X\\) å–å€¼ä¸º \\(x\\) çš„æ¡ä»¶ä¸‹, éšæœºå˜é‡ \\(Y\\) å–å€¼ä¸º \\(y\\) çš„æ¡ä»¶æ¦‚ç‡å…·æœ‰å¦‚ä¸‹ å½¢å¼: \\[ P(y \\mid x)=\\frac{1}{Z(x)} \\exp \\left(\\sum_{i, k} \\lambda_k t_k\\left(y_{i-1}, y_i, x, i\\right)+\\sum_{i, l} \\mu_l s_l\\left(y_i, x, i\\right)\\right) \\] å…¶ä¸­, \\[ Z(x)=\\sum_y \\exp \\left(\\sum_{i, k} \\lambda_k t_k\\left(y_{i-1}, y_i, x, i\\right)+\\sum_{i, l} \\mu_l s_l\\left(y_i, x, i\\right)\\right) \\] å¼ä¸­, \\(t_k\\) å’Œ \\(s_l\\) æ˜¯ç‰¹å¾å‡½æ•°, \\(\\lambda_k\\) å’Œ \\(\\mu_l\\) æ˜¯å¯¹åº”çš„æƒå€¼ã€‚ \\(Z(x)\\) æ˜¯è§„èŒƒåŒ–å› å­, æ±‚å’Œæ˜¯åœ¨æ‰€ æœ‰å¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸Šè¿›è¡Œçš„ã€‚ è¿™ä¸¤ä¸ªå¼å­æ˜¯çº¿æ€§é“¾æ¡ä»¶éšæœºåœºæ¨¡å‹çš„åŸºæœ¬å½¢å¼, è¡¨ç¤ºç»™å®šè¾“å…¥åºåˆ— \\(x\\), å¯¹è¾“å‡ºåºåˆ— \\(y\\) é¢„æµ‹çš„æ¡ä»¶æ¦‚ç‡ã€‚\\(t_k\\) æ˜¯å®šä¹‰åœ¨è¾¹ä¸Šçš„ç‰¹ å¾å‡½æ•°, ç§°ä¸ºè½¬ç§»ç‰¹å¾, ä¾èµ–äºå½“å‰å’Œå‰ä¸€ä¸ªä½ç½®; \\(s_l\\) æ˜¯å®šä¹‰åœ¨ç»“ç‚¹ä¸Šçš„ç‰¹å¾å‡½æ•°, ç§°ä¸ºçŠ¶æ€ç‰¹å¾, ä¾èµ–äºå½“å‰ä½ç½®ã€‚ \\(t_k\\) å’Œ \\(s_l\\) éƒ½ä¾èµ–äºä½ç½®, æ˜¯å±€éƒ¨ç‰¹å¾å‡½æ•°ã€‚é€šå¸¸, ç‰¹ å¾å‡½æ•° \\(t_k\\) å’Œ \\(s_l\\) å–å€¼ä¸º 1 æˆ– 0 ; å½“æ»¡è¶³ç‰¹å¾æ¡ä»¶æ—¶å–å€¼ä¸º 1 , å¦åˆ™ä¸º 0 ã€‚æ¡ä»¶éšæœºåœºå®Œ å…¨ç”±ç‰¹å¾å‡½æ•° \\(t_k, s_l\\) å’Œå¯¹åº”çš„æƒå€¼ \\(\\lambda_k, \\mu_l\\) ç¡®å®šã€‚ çº¿æ€§é“¾æ¡ä»¶éšæœºåœºä¹Ÿæ˜¯å¯¹æ•°çº¿æ€§æ¨¡å‹ (log linear model)ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:3","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼ ä¸ºç®€ä¾¿èµ·è§, é¦–å…ˆå°†è½¬ç§»ç‰¹å¾å’ŒçŠ¶æ€ç‰¹å¾åŠå…¶æƒå€¼ç”¨ç»Ÿä¸€çš„ç¬¦å·è¡¨ç¤ºã€‚è®¾æœ‰ \\(K_1\\) ä¸ªè½¬ç§»ç‰¹å¾, \\(K_2\\) ä¸ªçŠ¶æ€ç‰¹å¾, \\(K=K_1+K_2\\), è®° \\[ f_k\\left(y_{i-1}, y_i, x, i\\right)= \\begin{cases}t_k\\left(y_{i-1}, y_i, x, i\\right), \u0026 k=1,2, \\cdots, K_1 \\\\\\\\ s_l\\left(y_i, x, i\\right), \u0026 k=K_1+l ; l=1,2, \\cdots, K_2\\end{cases} \\] ç„¶å, å¯¹è½¬ç§»ä¸çŠ¶æ€ç‰¹å¾åœ¨å„ä¸ªä½ç½® \\(i\\) æ±‚å’Œ, è®°ä½œ \\[ f_k(y, x)=\\sum_{i=1}^n f_k\\left(y_{i-1}, y_i, x, i\\right), \\quad k=1,2, \\cdots, K \\] ç”¨ \\(w_k\\) è¡¨ç¤ºç‰¹å¾ \\(f_k(y, x)\\) çš„æƒå€¼, å³ \\[ w_k= \\begin{cases}\\lambda_k, \u0026 k=1,2, \\cdots, K_1 \\\\\\\\ \\mu_l, \u0026 k=K_1+l ; l=1,2, \\cdots, K_2\\end{cases} \\] äºæ˜¯, æ¡ä»¶éšæœºåœºå¯è¡¨ç¤ºä¸º \\[ \\begin{aligned} P(y \\mid x) \u0026=\\frac{1}{Z(x)} \\exp \\sum_{k=1}^K w_k f_k(y, x) \\\\\\\\ Z(x) \u0026=\\sum_y \\exp \\sum_{k=1}^K w_k f_k(y, x) \\end{aligned} \\] è‹¥ä»¥ \\(w\\) è¡¨ç¤ºæƒå€¼å‘é‡, å³ \\[ w=\\left(w_1, w_2, \\cdots, w_K\\right)^{\\mathrm{T}} \\] ä»¥ \\(F(y, x)\\) è¡¨ç¤ºå…¨å±€ç‰¹å¾å‘é‡, å³ \\[ F(y, x)=\\left(f_1(y, x), f_2(y, x), \\cdots, f_K(y, x)\\right)^{\\mathrm{T}} \\] åˆ™æ¡ä»¶éšæœºåœºå¯ä»¥å†™æˆå‘é‡ \\(w\\) ä¸ \\(F(y, x)\\) çš„å†…ç§¯çš„å½¢å¼: \\[ P_w(y \\mid x)=\\frac{\\exp (w \\cdot F(y, x))}{Z_w(x)} \\] å…¶ä¸­, \\[ Z_w(x)=\\sum_y \\exp (w \\cdot F(y, x)) \\] ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:4","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"çŸ©é˜µå½¢å¼ å¯¹æ¯ä¸ª æ ‡è®°åºåˆ—å¼•è¿›ç‰¹æ®Šçš„èµ·ç‚¹å’Œç»ˆç‚¹çŠ¶æ€æ ‡è®° \\(y_0=\\) start å’Œ \\(y_{n+1}=s t o p\\), è¿™æ—¶æ ‡æ³¨åºåˆ— çš„æ¦‚ç‡ \\(P_w(y \\mid x)\\) å¯ä»¥é€šè¿‡çŸ©é˜µå½¢å¼è¡¨ç¤ºå¹¶æœ‰æ•ˆè®¡ç®—ã€‚ å¯¹è§‚æµ‹åºåˆ— \\(x\\) çš„æ¯ä¸€ä¸ªä½ç½® \\(i=1,2, \\cdots, n+1\\), ç”±äº \\(y_{i-1}\\) å’Œ \\(y_i\\) åœ¨ \\(m\\) ä¸ªæ ‡è®°ä¸­ å–å€¼, å¯ä»¥å®šä¹‰ä¸€ä¸ª \\(m\\) é˜¶çŸ©é˜µéšæœºå˜é‡ \\[ M_i(x)=\\left[M_i\\left(y_{i-1}, y_i \\mid x\\right)\\right] \\] çŸ©é˜µéšæœºå˜é‡çš„å…ƒç´ ä¸º \\[ \\begin{aligned} \u0026M_i\\left(y_{i-1}, y_i \\mid x\\right)=\\exp \\left(W_i\\left(y_{i-1}, y_i \\mid x\\right)\\right) \\\\\\\\ \u0026W_i\\left(y_{i-1}, y_i \\mid x\\right)=\\sum_{k=1}^K w_k f_k\\left(y_{i-1}, y_i, x, i\\right) \\end{aligned} \\] è¿™é‡Œ \\(w_k\\) å’Œ \\(f_k\\) åˆ†åˆ«ç”±å‰é¢çš„å¼å­ç»™å‡º, \\(y_{i-1}\\) å’Œ \\(y_i\\) æ˜¯æ ‡è®°éšæœºå˜é‡ \\(Y_{i-1}\\) å’Œ \\(Y_i\\) çš„å–å€¼ã€‚ è¿™æ ·, ç»™å®šè§‚æµ‹åºåˆ— \\(x\\), ç›¸åº”æ ‡è®°åºåˆ— \\(y\\) çš„éè§„èŒƒåŒ–æ¦‚ç‡å¯ä»¥é€šè¿‡è¯¥åºåˆ— \\(n+1\\) ä¸ªçŸ©é˜µçš„é€‚å½“å…ƒç´ çš„ä¹˜ç§¯ \\(\\prod_{i=1}^{n+1} M_i\\left(y_{i-1}, y_i \\mid x\\right)\\) è¡¨ç¤ºã€‚äºæ˜¯, æ¡ä»¶æ¦‚ç‡ \\(P_w(y \\mid x)\\) æ˜¯ \\[ P_w(y \\mid x)=\\frac{1}{Z_w(x)} \\prod_{i=1}^{n+1} M_i\\left(y_{i-1}, y_i \\mid x\\right) \\] å…¶ä¸­, \\(Z_w(x)\\) ä¸ºè§„èŒƒåŒ–å› å­, æ˜¯ \\(n+1\\) ä¸ªçŸ©é˜µçš„ä¹˜ç§¯çš„ (start, stop) å…ƒç´ , å³ \\[ Z_w(x)=\\left[M_1(x) M_2(x) \\cdots M_{n+1}(x)\\right]_{\\text {start,stop }} \\] æ³¨æ„, \\(y_0=\\) start ä¸ \\(y_{n+1}=\\) stop è¡¨ç¤ºå¼€å§‹çŠ¶æ€ä¸ç»ˆæ­¢çŠ¶æ€, è§„èŒƒåŒ–å› å­ \\(Z_w(x)\\) æ˜¯ä»¥ start ä¸ºèµ·ç‚¹ stopä¸ºç»ˆç‚¹é€šè¿‡çŠ¶æ€çš„æ‰€æœ‰è·¯å¾„ \\(y_1 y_2 \\cdots y_n\\) çš„éè§„èŒƒåŒ–æ¦‚ç‡ \\(\\prod_{i=1}^{n+1} M_i\\left(y_{i-1}, y_i \\mid x\\right)\\) ä¹‹å’Œã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:4:5","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¦‚ç‡è®¡ç®—é—®é¢˜ ä¸HMMç±»ä¼¼ï¼Œå¼•å…¥å‰å‘å’Œåå‘å˜é‡ï¼Œé€’å½’çš„è®¡ç®—æ¦‚ç‡å’Œä¸€äº›æœŸæœ›å€¼ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:5:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"å‰å‘-åå‘ç®—æ³• å¯¹æ¯ä¸ªæŒ‡æ ‡ \\(i=0,1, \\cdots, n+1\\), å®šä¹‰å‰å‘å‘é‡ \\(\\alpha_i(x)\\) : \\[ \\alpha_0(y \\mid x)= \\begin{cases}1, \u0026 y=\\text { start } \\\\\\\\ 0, \u0026 \\text { å¦åˆ™ }\\end{cases} \\] é€’æ¨å…¬å¼ä¸º \\[ \\alpha_i^{\\mathrm{T}}\\left(y_i \\mid x\\right)=\\alpha_{i-1}^{\\mathrm{T}}\\left(y_{i-1} \\mid x\\right)\\left[M_i\\left(y_{i-1}, y_i \\mid x\\right)\\right], \\quad i=1,2, \\cdots, n+1 \\] åˆå¯è¡¨ç¤ºä¸º \\[ \\alpha_i^{\\mathrm{T}}(x)=\\alpha_{i-1}^{\\mathrm{T}}(x) M_i(x) \\] \\(\\alpha_i\\left(y_i \\mid x\\right)\\) è¡¨ç¤ºåœ¨ä½ç½® \\(i\\) çš„æ ‡è®°æ˜¯ \\(y_i\\) å¹¶ä¸”ä» 1 åˆ° \\(i\\) çš„å‰éƒ¨åˆ†æ ‡è®°åºåˆ—çš„éè§„èŒƒåŒ–æ¦‚ ç‡, \\(y_i\\) å¯å–çš„å€¼æœ‰ \\(m\\) ä¸ª, æ‰€ä»¥ \\(\\alpha_i(x)\\) æ˜¯ \\(m\\) ç»´åˆ—å‘é‡ã€‚ åŒæ ·, å¯¹æ¯ä¸ªæŒ‡æ ‡ \\(i=0,1, \\cdots, n+1\\), å®šä¹‰åå‘å‘é‡ \\(\\beta_i(x)\\) : \\[ \\begin{aligned} \\beta_{n+1}\\left(y_{n+1} \\mid x\\right) \u0026= \\begin{cases}1, \u0026 y_{n+1}=\\text { stop } \\\\\\\\ 0, \u0026 \\text { å¦åˆ™ }\\end{cases} \\\\\\\\ \\beta_i\\left(y_i \\mid x\\right) \u0026=\\left[M_{i+1}\\left(y_i, y_{i+1} \\mid x\\right)\\right] \\beta_{i+1}\\left(y_{i+1} \\mid x\\right) \\end{aligned} \\] åˆå¯è¡¨ç¤ºä¸º \\[ \\beta_i(x)=M_{i+1}(x) \\beta_{i+1}(x) \\] \\(\\beta_i\\left(y_i \\mid x\\right)\\) è¡¨ç¤ºåœ¨ä½ç½® \\(i\\) çš„æ ‡è®°ä¸º \\(y_i\\) å¹¶ä¸”ä» \\(i+1\\) åˆ° \\(n\\) çš„åéƒ¨åˆ†æ ‡è®°åºåˆ—çš„éè§„èŒƒåŒ– æ¦‚ç‡ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:5:1","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¦‚ç‡è®¡ç®— æŒ‰ç…§å‰å‘-åå‘å‘é‡çš„å®šä¹‰, å¾ˆå®¹æ˜“è®¡ç®—æ ‡è®°åºåˆ—åœ¨ä½ç½® \\(i\\) æ˜¯æ ‡è®° \\(y_i\\) çš„æ¡ä»¶æ¦‚ç‡ å’Œåœ¨ä½ç½® \\(i-1\\) ä¸ \\(i\\) æ˜¯æ ‡è®° \\(y_{i-1}\\) å’Œ \\(y_i\\) çš„æ¡ä»¶æ¦‚ç‡: \\[ P\\left(Y_i=y_i \\mid x\\right)=\\frac{\\alpha_i^{\\mathrm{T}}\\left(y_i \\mid x\\right) \\beta_i\\left(y_i \\mid x\\right)}{Z(x)} \\] \\[ P\\left(Y_{i-1}=y_{i-1}, Y_i=y_i \\mid x\\right)=\\frac{\\alpha_{i-1}^{\\mathrm{T}}\\left(y_{i-1} \\mid x\\right) M_i\\left(y_{i-1}, y_i \\mid x\\right) \\beta_i\\left(y_i \\mid x\\right)}{Z(x)} \\] å…¶ä¸­, \\[ Z(x)=\\alpha_n^{\\mathrm{T}}(x) \\mathbf{1}=1 \\beta_1(x) \\] ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:5:2","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"é¢„æµ‹é—®é¢˜ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:6:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"ç»´ç‰¹æ¯”ç®—æ³• è¿˜æ˜¯ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•ã€‚ \\[ \\begin{aligned} y^* \u0026=\\arg \\max_y P_w(y \\mid x) \\\\\\\\ \u0026=\\arg \\max_y \\frac{\\exp (w \\cdot F(y, x))}{Z_w(x)} \\\\\\\\ \u0026=\\arg \\max_y \\exp (w \\cdot F(y, x)) \\\\\\\\ \u0026=\\arg \\max_y(w \\cdot F(y, x)) \\end{aligned} \\] äºæ˜¯, æ¡ä»¶éšæœºåœºçš„é¢„æµ‹é—®é¢˜æˆä¸ºæ±‚éè§„èŒƒåŒ–æ¦‚ç‡æœ€å¤§çš„æœ€ä¼˜è·¯å¾„é—®é¢˜ \\[ \\max_y(w \\cdot F(y, x)) \\] è¿™é‡Œ, è·¯å¾„è¡¨ç¤ºæ ‡è®°åºåˆ—ã€‚å…¶ä¸­, \\[ \\begin{aligned} w \u0026=\\left(w_1, w_2, \\cdots, w_K\\right)^{\\mathrm{T}} \\\\\\\\ F(y, x) \u0026=\\left(f_1(y, x), f_2(y, x), \\cdots, f_K(y, x)\\right)^{\\mathrm{T}} \\\\\\\\ f_k(y, x) \u0026=\\sum_{i=1}^n f_k\\left(y_{i-1}, y_i, x, i\\right), \\quad k=1,2, \\cdots, K \\end{aligned} \\] æ³¨æ„, è¿™æ—¶åªéœ€è®¡ç®—éè§„èŒƒåŒ–æ¦‚ç‡, è€Œä¸å¿…è®¡ç®—æ¦‚ç‡, å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ã€‚ä¸ºäº†æ±‚è§£æœ€ ä¼˜è·¯å¾„, å†™æˆå¦‚ä¸‹å½¢å¼: \\[ \\max_y \\sum_{i=1}^n w \\cdot F_i\\left(y_{i-1}, y_i, x\\right) \\] å…¶ä¸­, \\[ F_i\\left(y_{i-1}, y_i, x\\right)=\\left(f_1\\left(y_{i-1}, y_i, x, i\\right), f_2\\left(y_{i-1}, y_i, x, i\\right), \\cdots, f_K\\left(y_{i-1}, y_i, x, i\\right)\\right)^{\\mathrm{T}} \\] æ˜¯å±€éƒ¨ç‰¹å¾å‘é‡ã€‚ ä¸‹é¢å™è¿°ç»´ç‰¹æ¯”ç®—æ³•ã€‚é¦–å…ˆæ±‚å‡ºä½ç½® 1 çš„å„ä¸ªæ ‡è®° \\(j=1,2, \\cdots, m\\) çš„éè§„èŒƒåŒ–æ¦‚ç‡: \\[ \\delta_1(j)=w \\cdot F_1\\left(y_0=\\text { start, } y_1=j, x\\right), \\quad j=1,2, \\cdots, m \\] ä¸€èˆ¬åœ°, ç”±é€’æ¨å…¬å¼, æ±‚å‡ºåˆ°ä½ç½® \\(i\\) çš„å„ä¸ªæ ‡è®° \\(l=1,2, \\cdots, m\\) çš„éè§„èŒƒåŒ–æ¦‚ç‡çš„æœ€ å¤§å€¼, åŒæ—¶è®°å½•éè§„èŒƒåŒ–æ¦‚ç‡æœ€å¤§å€¼çš„è·¯å¾„ \\[ \\begin{gathered} \\delta_i(l)=\\max_{1 \\leqslant j \\leqslant m}\\left\\\\{\\delta_{i-1}(j)+w \\cdot F_i\\left(y_{i-1}=j, y_i=l, x\\right)\\right\\\\\\}, \\quad l=1,2, \\cdots, m \\\\\\\\ \\Psi_i(l)=\\arg \\max_{1 \\leqslant j \\leqslant m}\\left\\\\{\\delta_{i-1}(j)+w \\cdot F_i\\left(y_{i-1}=j, y_i=l, x\\right)\\right\\\\\\}, \\quad l=1,2, \\cdots, m \\end{gathered} \\] ç›´åˆ° \\(i=n\\) æ—¶ç»ˆæ­¢ã€‚è¿™æ—¶æ±‚å¾—éè§„èŒƒåŒ–æ¦‚ç‡çš„æœ€å¤§å€¼ä¸º \\[ \\operatorname{max}_y(w \\cdot F(y, x))=\\max_{1 \\leqslant j \\leqslant m} \\delta_n(j) \\] åŠæœ€ä¼˜è·¯å¾„çš„ç»ˆç‚¹ \\[ y_n^* =\\arg \\max_{1 \\leqslant j \\leqslant m} \\delta_n(j) \\] ç”±æ­¤æœ€ä¼˜è·¯å¾„ç»ˆç‚¹è¿”å›, \\[ y_i^* =\\Psi_{i+1}\\left(y_{i+1}^* \\right), \\quad i=n-1, n-2, \\cdots, 1 \\] æ±‚å¾—æœ€ä¼˜è·¯å¾„ \\(y^* =\\left(y_1^* , y_2^* , \\cdots, y_n^* \\right)^{\\mathrm{T}}\\) ã€‚ ç»¼ä¸Šæ‰€è¿°, å¾—åˆ°æ¡ä»¶éšæœºåœºé¢„æµ‹çš„ç»´ç‰¹æ¯”ç®—æ³•ã€‚ (æ¡ä»¶éšæœºåœºé¢„æµ‹çš„ç»´ç‰¹æ¯”ç®—æ³•) è¾“å…¥: æ¨¡å‹ç‰¹å¾å‘é‡ \\(F(y, x)\\) å’Œæƒå€¼å‘é‡ \\(w\\), è§‚æµ‹åºåˆ— \\(x=\\left(x_1, x_2, \\cdots, x_n\\right)\\); è¾“å‡º: æœ€ä¼˜è·¯å¾„ \\(y^* =\\left(y_1^* , y_2^* , \\cdots, y_n^* \\right)\\) ã€‚ (1) åˆå§‹åŒ– \\[ \\delta_1(j)=w \\cdot F_1\\left(y_0=\\operatorname{start}, y_1=j, x\\right), \\quad j=1,2, \\cdots, m \\] é€’æ¨ã€‚å¯¹ \\(i=2,3, \\cdots, n\\) \\[ \\begin{gathered} \\delta_i(l)=\\max_{1 \\leqslant j \\leqslant m}\\left\\\\{\\delta_{i-1}(j)+w \\cdot F_i\\left(y_{i-1}=j, y_i=l, x\\right)\\right\\\\\\}, \\quad l=1,2, \\cdots, m \\\\\\\\ \\Psi_i(l)=\\arg \\max_{1 \\leqslant j \\leqslant m}\\left\\\\{\\delta_{i-1}(j)+w \\cdot F_i\\left(y_{i-1}=j, y_i=l, x\\right)\\right\\\\\\}, \\quad l=1,2, \\cdots, m \\end{gathered} \\] ï¼ˆ3ï¼‰ç»ˆæ­¢ \\[ \\begin{gathered} \\max_y(w \\cdot F(y, x))=\\max_{1 \\leqslant j \\leqslant m} \\delta_n(j) \\\\\\\\ y_n^* =\\arg \\max_{1 \\leqslant j \\leqslant m} \\delta_n(j) \\end{gathered} \\] è¿”å›è·¯å¾„ \\[ y_i^* =\\Psi_{i+1}\\left(y_{i+1}^* \\right), \\quad i=n-1, n-2, \\cdots, 1 \\] æ±‚å¾—æœ€ä¼˜è·¯å¾„ \\(y^* =\\left(y_1^* , y_2^* , \\cdots, y_n^* \\right)\\_{\\text {ã€‚ }}\\) è‡ªå·±çš„ç†è§£å°±æ˜¯éè§„èŒƒåŒ–æ¦‚ç‡æ¯ä¸ªiä»£è¡¨æ—¶é—´æ­¥iï¼Œè¦å¯¹æ‰€æœ‰çš„\\(\\lambda_k t_k\\)å’Œ \\(\\mu_ks_k\\) è¿›è¡Œç­›é€‰ï¼Œæ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„ç›¸åŠ ï¼Œè¿™é‡Œè¦æ³¨æ„ä¸‹æ ‡çš„ç†è§£ã€‚æ‹¬å·é‡Œçš„å’ŒHMMçš„ç±»ä¼¼ï¼Œä»£è¡¨yçš„å–å€¼ã€‚ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:6:1","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"å®ä¾‹ è¿™é‡Œä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•æ±‚è§£ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:6:2","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"å‚æ•°å­¦ä¹ é—®é¢˜ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:7:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ€»ç»“ ","date":"2022-05-12","objectID":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/:8:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","é©¬å°”ç§‘å¤«ç½‘ç»œ","æ¡ä»¶éšæœºåœº"],"title":"æ¡ä»¶éšæœºåœº","uri":"/%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"Boostingç®—æ³•çš„å·¥ä½œæœºåˆ¶æ˜¯é¦–å…ˆä»è®­ç»ƒé›†ç”¨åˆå§‹æƒé‡è®­ç»ƒå‡ºä¸€ä¸ªå¼±å­¦ä¹ å™¨1ï¼Œæ ¹æ®å¼±å­¦ä¹ çš„å­¦ä¹ è¯¯å·®ç‡è¡¨ç°æ¥æ›´æ–°è®­ç»ƒæ ·æœ¬çš„æƒé‡ï¼Œä½¿å¾—ä¹‹å‰å¼±å­¦ä¹ å™¨1å­¦ä¹ è¯¯å·®ç‡é«˜çš„è®­ç»ƒæ ·æœ¬ç‚¹çš„æƒé‡å˜é«˜ï¼Œä½¿å¾—è¿™äº›è¯¯å·®ç‡é«˜çš„ç‚¹åœ¨åé¢çš„å¼±å­¦ä¹ å™¨2ä¸­å¾—åˆ°æ›´å¤šçš„é‡è§†ã€‚ç„¶ååŸºäºè°ƒæ•´æƒé‡åçš„è®­ç»ƒé›†æ¥è®­ç»ƒå¼±å­¦ä¹ å™¨2.ï¼Œå¦‚æ­¤é‡å¤è¿›è¡Œï¼Œç›´åˆ°å¼±å­¦ä¹ å™¨æ•°è¾¾åˆ°äº‹å…ˆæŒ‡å®šçš„æ•°ç›®Tï¼Œæœ€ç»ˆå°†è¿™Tä¸ªå¼±å­¦ä¹ å™¨é€šè¿‡é›†åˆç­–ç•¥è¿›è¡Œæ•´åˆï¼Œå¾—åˆ°æœ€ç»ˆçš„å¼ºå­¦ä¹ å™¨ã€‚ è¿™æ®µå™è¿°é‡Œé¢æœ‰å¾ˆå¤šéœ€è¦è§£å†³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å¦‚ä½•è®¡ç®—è¯¯å·®ç‡ï¼Œå¦‚ä½•å¾—åˆ°å¼±å­¦ä¹ å™¨æƒé‡ç³»æ•°ï¼Œå¦‚ä½•æ›´æ–°æ ·æœ¬æƒé‡ï¼Œå¦‚ä½•ç»“åˆã€‚ ","date":"2022-04-27","objectID":"/adaboost/:0:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","Adaboost"],"title":"Adaboost","uri":"/adaboost/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"Adaboost å…ˆçœ‹ä¸€ä¸‹adaboostçš„ç®—æ³•æµç¨‹ å°†åˆå§‹åŒ–æ ·æœ¬çš„æƒé‡ä¸º\\(\\frac{1}{m}\\)ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ·æœ¬æƒé‡åˆ°åº•æ€ä¹ˆç”¨å‘¢ï¼Œä¸»è¦æ˜¯ç”¨äºåœ¨æ„å»ºå¼±åˆ†ç±»å™¨æ—¶è®¡ç®—å¼±å­¦ä¹ å™¨åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®æ—¶ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—è¯¯å·®ï¼š \\[ \\epsilon_t = \\sum_{i=1}^mP(h_t(x_i) \\neq y_i) =\\sum_{i=1}^m D_{ti}I(h_t(x_i)\\neq y_i) \\] å¦‚æœå¼±åˆ†ç±»å™¨ä¸ºå†³ç­–æ ‘çš„è¯ï¼Œè‚¯å®šè¦é€‰æ‹©è¯¯å·®æœ€å°çš„åˆ’åˆ†ä½œä¸ºæœ€ä½³åˆ’åˆ†ï¼Œæœ€å°çš„è¯¯å·®æœ€ä¸ºæœ¬è½®å¼±åˆ†ç±»å™¨çš„è¯¯å·®ã€‚å®é™…ä¸Šæ ·æœ¬æƒé‡ä¸å‚ä¸è®­ç»ƒï¼Œåªæ˜¯é€šè¿‡æ ·æœ¬æƒé‡åŠ¨æ€è°ƒèŠ‚æ¨¡å‹çš„å…³æ³¨é‡ç‚¹ï¼Œå³é€šè¿‡è®¡ç®—è¯¯å·®ï¼Œå½±å“å†³ç­–æ ‘çš„åˆ’åˆ†ï¼Œæ¥è°ƒèŠ‚æ¨¡å‹çš„å…³æ³¨é‡ç‚¹ï¼Œè¿™å°±æ˜¯æ ·æœ¬æƒé‡çš„ä½œç”¨ã€‚ ç„¶åè®¡ç®—å¼±å­¦ä¹ å™¨æƒé‡\\(\\alpha_t\\)ï¼Œæ›´æ–°æ ·æœ¬æƒé‡ï¼Œå¯¹äºåˆ†ç±»é”™è¯¯çš„æ ·æœ¬æƒé‡ä¸Šå‡ï¼Œå¯¹äºåˆ†ç±»æ­£ç¡®çš„æ ·æœ¬æƒé‡ä¸‹è°ƒï¼Œå†é™¤ä»¥è§„èŒƒåŒ–å› å­ï¼Œç¡®ä¿ä»ç„¶æ˜¯ä¸€ä¸ªåˆ†å¸ƒï¼Œä¸€èˆ¬å°±æ˜¯\\(D_t\\)çš„å’Œä½œä¸ºè§„èŒƒåŒ–å› å­ï¼Œä¸‹ä¸€è½®çš„æ¨¡å‹å°±æ›´æ³¨æ„åˆ’åˆ†é”™è¯¯çš„è¿™äº›æ ·æœ¬ç‚¹ã€‚è¿™æ ·æ¯ä¸€è½®è¿­ä»£éƒ½ä¼šå¾—åˆ°å¼±åˆ†ç±»å™¨ç³»æ•°å’Œå¼±åˆ†ç±»å™¨ï¼Œè¿™é‡Œå…·ä½“çš„è®¡ç®—è¿‡ç¨‹å¯ä»¥å‚è€ƒæèˆªçš„ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ï¼Œè¿­ä»£å®Œæˆä»¥åï¼ŒæŒ‰ç…§å…¬å¼å°†æƒé‡ä¸å¼±åˆ†ç±»å™¨ç›¸ä¹˜åç›¸åŠ ï¼Œæœ€åç»è¿‡ä¿¡å·å‡½æ•°å¾—åˆ°æœ€ç»ˆçš„åˆ†ç±»ç»“æœã€‚ ## ä¼˜ç‚¹ Adaboostä½œä¸ºåˆ†ç±»å™¨æ—¶ï¼Œåˆ†ç±»ç²¾åº¦å¾ˆé«˜ åœ¨Adaboostçš„æ¡†æ¶ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å„ç§å›å½’åˆ†ç±»æ¨¡å‹æ¥æ„å»ºå¼±å­¦ä¹ å™¨ï¼Œéå¸¸çµæ´»ã€‚ ä½œä¸ºç®€å•çš„äºŒå…ƒåˆ†ç±»å™¨æ—¶ï¼Œæ„é€ ç®€å•ï¼Œç»“æœå¯ç†è§£ã€‚ ä¸å®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆ ","date":"2022-04-27","objectID":"/adaboost/:1:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","Adaboost"],"title":"Adaboost","uri":"/adaboost/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"ç¼ºç‚¹ å¯¹å¼‚å¸¸æ ·æœ¬æ•æ„Ÿï¼Œå¼‚å¸¸æ ·æœ¬åœ¨è¿­ä»£ä¸­å¯èƒ½ä¼šè·å¾—è¾ƒé«˜çš„æƒé‡ï¼Œå½±å“æœ€ç»ˆçš„å¼ºå­¦ä¹ å™¨çš„é¢„æµ‹å‡†ç¡®æ€§ã€‚ ","date":"2022-04-27","objectID":"/adaboost/:2:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","Adaboost"],"title":"Adaboost","uri":"/adaboost/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"å¦ä¸€ç§è§£é‡Š ä¸Šé¢å™è¿°çš„æ˜¯ä¸€èˆ¬çš„Adaboostç®—æ³•çš„è§£é‡Šï¼Œå…¶å®è¿˜æœ‰å¦å¤–ä¸€ç§è§£é‡Šï¼Œå°±æ˜¯adaboostä¸ºåŠ æ³•æ¨¡å‹ã€æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°ã€å­¦ä¹ ç®—æ³•ä¸ºå‰å‘åˆ†æ­¥ç®—æ³•çš„äºŒç±»åˆ†ç±»å­¦ä¹ æ–¹æ³•ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰å‘åˆ†æ­¥ç®—æ³•ï¼Ÿ è¾“å…¥: è®­ç»ƒæ•°æ®é›†\\(T=\\{(x_1, y_1 ),(x_2, y_2), \\cdots,\\left(x_N, y_N\\right)\\}\\); æŸå¤±å‡½æ•° \\(L(y, f(x))\\); åŸºå‡½æ•°é›† \\(\\{b(x ; \\gamma)\\}\\); è¾“å‡º: åŠ æ³•æ¨¡å‹ \\(f(x)\\) ã€‚ åˆå§‹åŒ– \\(f_0(x)=0\\); å¯¹ \\(m=1,2, \\cdots, M\\) æå°åŒ–æŸå¤±å‡½æ•° \\[ \\left(\\beta_m, \\gamma_m\\right)=\\arg \\min_{\\beta, \\gamma} \\sum_{i=1}^N L\\left(y_i, f_{m-1}\\left(x_i\\right)+\\beta b\\left(x_i ; \\gamma\\right)\\right) \\] å¾—åˆ°å‚æ•° \\(\\beta_m, \\gamma_m\\) ã€‚ æ›´æ–° \\[ f_m(x)=f_{m-1}(x)+\\beta_m b\\left(x ; \\gamma_m\\right) \\] å¾—åˆ°åŠ æ³•æ¨¡å‹ \\[ f(x)=f_M(x)=\\sum_{m=1}^M \\beta_m b\\left(x ; \\gamma_m\\right) \\] å­¦è¿‡GBDTçš„è¯å°±æ„Ÿè§‰ä¼šå¾ˆç†Ÿæ‚‰ã€‚å®é™…ä¸Šæå‡æ ‘å’ŒGBDTä¹Ÿéƒ½æ˜¯ä½¿ç”¨çš„å‰å‘åˆ†æ­¥ç®—æ³•ã€‚ ç›´æ¥ä¸Šç»“è®ºå§ï¼Œæ¨å¯¼çš„æ„Ÿè§‰æ²¡æœ‰å¿…è¦ï¼Œæ¯•ç«Ÿéƒ½æ˜¯boostingæ–¹æ³•ã€‚å…·ä½“è¯æ˜çš„è¿‡ç¨‹å¯ä»¥çœ‹æèˆªè€å¸ˆçš„ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ã€‚ Adaboostç®—æ³•æ˜¯å‰å‘åˆ†æ­¥åŠ æ³•ç®—æ³•çš„ç‰¹ä¾‹ï¼Œè¿™æ—¶ï¼Œæ¨¡å‹æ˜¯ç”±åŸºæœ¬åˆ†ç±»å™¨ç»„æˆçš„åŠ æ³•æ¨¡å‹ï¼ŒæŸå¤±å‡½æ•°æ˜¯æŒ‡æ•°å‡½æ•°ã€‚ ","date":"2022-04-27","objectID":"/adaboost/:3:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","Adaboost"],"title":"Adaboost","uri":"/adaboost/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"æ€»ç»“ æ€»æ˜¯è¦å†™ä¸ªæ€»ç»“çš„ï¼Œadaboostä¸€ç§boostingæ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­è¿­ä»£è°ƒæ•´æƒé‡ï¼Œæœ€åå°†æ¯ä¸€æ­¥çš„ç»“æœåŠ æƒæ±‚å’Œï¼Œå¯ä»¥è¯´æ˜¯ä¸€ç§å…¸å‹çš„boostingçš„æ–¹æ³•ã€‚ ","date":"2022-04-27","objectID":"/adaboost/:4:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","Adaboost"],"title":"Adaboost","uri":"/adaboost/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆ†å‰²ç­‰å’Œå­é›† ","date":"2022-03-25","objectID":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/:0:0","tags":["ç®—æ³•é¢˜","åˆ†å‰²ç­‰å’Œå­é›†"],"title":"åˆ†å‰²ç­‰å’Œå­é›†","uri":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/partition-equal-subset-sum/?utm_source=LCUS\u0026utm_medium=ip_redirect\u0026utm_campaign=transfer2china ","date":"2022-03-25","objectID":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/:1:0","tags":["ç®—æ³•é¢˜","åˆ†å‰²ç­‰å’Œå­é›†"],"title":"åˆ†å‰²ç­‰å’Œå­é›†","uri":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š å…¸å‹çš„01èƒŒåŒ…é—®é¢˜ï¼Œåˆ©ç”¨å¥—è·¯æ¡†æ¶åšå³å¯ æ³¨æ„åšäº†ä¼˜åŒ–ï¼ŒæŠŠåŸæœ¬çš„äºŒç»´dpé™ä½äº†ä¸€ç»´ ","date":"2022-03-25","objectID":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/:2:0","tags":["ç®—æ³•é¢˜","åˆ†å‰²ç­‰å’Œå­é›†"],"title":"åˆ†å‰²ç­‰å’Œå­é›†","uri":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def canPartition(self, nums: List[int]) -\u003e bool: if sum(nums) % 2: return False s = sum(nums) // 2 dp = [False for _ in range(s+1)] dp[0] = True for i in range(1,len(nums)+1): for j in range(s,nums[i-1]-1,-1): # å®¹é‡ dp[j] = dp[j] or dp[j-nums[i-1]] # ç”¨äº†oræ“ä½œç¬¦ return dp[s] æ›´ä¸€èˆ¬çš„å¥—è·¯ï¼Œå®šä¹‰äºŒç»´æ•°ç»„ï¼Œç„¶åäºŒç»´dp # iä»£è¡¨å‰iä¸ªç‰©å“,jä»£è¡¨èƒŒåŒ…å®¹é‡ã€‚ class Solution: def canPartition(self, nums: List[int]) -\u003e bool: if len(nums) \u003c= 1: return False if sum(nums) % 2: return False s = sum(nums) // 2 dp = [[False for _ in range(s+1)] for _ in range(len(nums)+1)] for i in range(len(nums)+1): dp[i][0] = True # èƒŒåŒ…å®¹é‡ä¸º0æ—¶ æ°¸è¿œéƒ½æ˜¯æ»¡çš„ æ‰€ä»¥ä¸ºtrue for i in range(1,len(nums)+1): # ç‰©å“ä¸ªæ•° for j in range(1,s+1): # èƒŒåŒ…å®¹é‡ï¼Œæœ€å¤§ä¸ºæ€»å’Œçš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ±‚çš„ if j - nums[i-1] \u003c 0: # å¦‚æœå®¹é‡å°äºå½“å‰ç‰©å“çš„é‡é‡ dp[i][j] = dp[i-1][j] else: dp[i][j] = dp[i-1][j] or dp[i-1][j-nums[i-1]] if dp[i][s]: # å‰ªæ return True return dp[len(nums)][s] '''é¦–å…ˆï¼Œç”±äºiæ˜¯ä» 1 å¼€å§‹çš„ï¼Œè€Œæ•°ç»„ç´¢å¼•æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ç¬¬iä¸ªç‰©å“çš„é‡é‡åº”è¯¥æ˜¯nums[i-1]ï¼Œè¿™ä¸€ç‚¹ä¸è¦ææ··ã€‚ dp[i - 1][j-nums[i-1]]ä¹Ÿå¾ˆå¥½ç†è§£ï¼šä½ å¦‚æœè£…äº†ç¬¬iä¸ªç‰©å“ï¼Œå°±è¦çœ‹èƒŒåŒ…çš„å‰©ä½™é‡é‡j - nums[i-1]é™åˆ¶ä¸‹æ˜¯å¦èƒ½å¤Ÿè¢«æ°å¥½è£…æ»¡ã€‚ æ¢å¥è¯è¯´ï¼Œå¦‚æœj - nums[i-1]çš„é‡é‡å¯ä»¥è¢«æ°å¥½è£…æ»¡ï¼Œé‚£ä¹ˆåªè¦æŠŠç¬¬iä¸ªç‰©å“è£…è¿›å»ï¼Œä¹Ÿå¯æ°å¥½è£…æ»¡jçš„é‡é‡ï¼›å¦åˆ™çš„è¯ï¼Œé‡é‡jè‚¯å®šæ˜¯è£…ä¸æ»¡çš„ã€‚''' ","date":"2022-03-25","objectID":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/:3:0","tags":["ç®—æ³•é¢˜","åˆ†å‰²ç­‰å’Œå­é›†"],"title":"åˆ†å‰²ç­‰å’Œå­é›†","uri":"/%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/"},{"categories":["é¢ç»"],"content":"kdæ ‘ knnç®—æ³•å°±æ˜¯ç”¨kdæ ‘å®ç°çš„ ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:0:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"äºŒåˆ†æŸ¥æ‰¾ å¾ˆç®€å• å°±ä¸è¯´äº† ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:1:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"BST å¾ˆç®€å• å°±ä¸è¯´äº† ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:2:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"å¤šç»´æ•°ç»„ å‡è®¾æ•°ç»„Bä¸º\\([[6, 2], [6, 3], [3, 5], [5, 0], [1, 2], [4, 9], [8, 1]]\\)ï¼Œæœ‰ä¸€ä¸ªå…ƒç´ xï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°æ•°ç»„Bä¸­è·ç¦»xæœ€è¿‘çš„å…ƒç´ ï¼Œåº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿæ¯”è¾ƒç›´æ¥çš„æƒ³æ³•æ˜¯ç”¨æ•°ç»„Bä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸xæ±‚è·ç¦»ï¼Œè·ç¦»æœ€å°çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚å‡è®¾x = [1, 1]ï¼Œé‚£ä¹ˆç”¨æ•°ç»„Bä¸­çš„æ‰€æœ‰å…ƒç´ ä¸xæ±‚è·ç¦»å¾—åˆ°[5.0, 5.4, 4.5, 4.1, 1.0, 8.5, 7.0]ï¼Œå…¶ä¸­è·ç¦»æœ€å°çš„æ˜¯1ï¼Œå¯¹åº”çš„å…ƒç´ æ˜¯æ•°ç»„Bä¸­çš„[1, 2]ï¼Œæ‰€ä»¥[1, 2]å°±æ˜¯æˆ‘ä»¬çš„æŸ¥æ‰¾ç»“æœã€‚ ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:3:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"kd-tree ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:4:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"å¦‚ä½•å»ºç«‹ ä½  1. å»ºç«‹æ ¹èŠ‚ç‚¹ï¼› é€‰å–æ–¹å·®æœ€å¤§çš„ç‰¹å¾ä½œä¸ºåˆ†å‰²ç‰¹å¾(æˆ–è€…æ ¹æ®æ·±åº¦é€‰æ‹©) é€‰æ‹©è¯¥ç‰¹å¾çš„ä¸­ä½æ•°ä½œä¸ºåˆ†å‰²ç‚¹ï¼› å°†æ•°æ®é›†ä¸­è¯¥ç‰¹å¾å°äºä¸­ä½æ•°çš„ä¼ é€’ç»™æ ¹èŠ‚ç‚¹çš„å·¦å„¿å­ï¼Œå¤§äºä¸­ä½æ•°çš„ä¼ é€’ç»™æ ¹èŠ‚ç‚¹çš„å³å„¿å­ï¼› é€’å½’æ‰§è¡Œæ­¥éª¤2-4ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½è¢«å»ºç«‹åˆ°KD Treeçš„èŠ‚ç‚¹ä¸Šä¸ºæ­¢ã€‚ ä¸éš¾çœ‹å‡ºï¼ŒKD Treeçš„å»ºç«‹æ­¥éª¤è·ŸBSTæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå¯ä»¥è®¤ä¸ºBSTæ˜¯KD Treeåœ¨ä¸€ç»´æ•°æ®ä¸Šçš„ç‰¹ä¾‹ã€‚KD Treeçš„ç®—æ³•å¤æ‚åº¦ä»‹äºO(Log2(N))å’ŒO(N)ä¹‹é—´ã€‚ ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:5:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹å·®æœ€å¤§çš„ç»´åº¦ æ•°æ®åˆ†å‰²ååˆ†æ•£çš„æ¯”è¾ƒå¼€ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å›æº¯æ—¶é—´ï¼Œå‡å°‘å­æ ‘çš„è®¿é—®ã€‚ ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:6:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"ä¸ºä»€ä¹ˆé€‰æ‹©ä¸­ä½æ•°ä½œä¸ºåˆ†å‰²ç‚¹ å› ä¸ºå€Ÿé‰´äº†BSTï¼Œé€‰å–ä¸­ä½æ•°ï¼Œè®©å·¦å­æ ‘å’Œå³å­æ ‘çš„æ•°æ®æ•°é‡ä¸€è‡´ï¼Œä¾¿äºäºŒåˆ†æŸ¥æ‰¾ã€‚ ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:7:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["é¢ç»"],"content":"æŸ¥æ‰¾å…ƒç´  ä»æ ¹èŠ‚ç‚¹å‡ºå‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ ¹æ®å½“å‰æ·±åº¦è®¡ç®—æ¯”è¾ƒçš„ç‰¹å¾ç»´åº¦ï¼Œè‹¥ç›®æ ‡èŠ‚ç‚¹çš„ç‰¹å¾å€¼å°äºå½“å‰èŠ‚ç‚¹çš„ç‰¹å¾å€¼åˆ™éå†å·¦å­æ ‘ï¼Œå¦åˆ™éå†å³å­æ ‘ æ‰¾åˆ°å¶å­ç»“ç‚¹åï¼Œå°†å…¶æš‚æ—¶æ ‡è®°ä¸ºå½“å‰æœ€é‚»è¿‘çš„ç‚¹ é€’å½’åœ°å‘ä¸Šå›é€€ï¼Œåœ¨å›é€€æ—¶éœ€è¦åšï¼š å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ç›®æ ‡èŠ‚ç‚¹çš„è·ç¦»æ›´è¿‘ï¼Œåˆ™æ›´æ–°æœ€é‚»è¿‘èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ å¦‚æœå½“å‰èŠ‚ç‚¹å¯¹åº”ç‰¹å¾ä¸ç›®æ ‡èŠ‚ç‚¹å¯¹åº”ç‰¹å¾çš„å€¼è·ç¦»å°äºå½“å‰æœ€å°å€¼æ—¶ï¼Œè¿›å…¥å½“å‰èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆå› ä¸ºåˆšåˆšä»ä¸€ä¸ªå­èŠ‚ç‚¹éå†å›æ¥ï¼‰è¿›è¡ŒæŸ¥æ‰¾ï¼ˆå¦‚æœå­˜åœ¨å­èŠ‚ç‚¹çš„è¯ï¼‰ï¼Œæœ‰å¯èƒ½å­˜åœ¨æ›´è¿‘çš„èŠ‚ç‚¹ã€‚å¦åˆ™çš„è¯ç»§ç»­å‘ä¸Šå›é€€ã€‚ å›é€€åˆ°æ ¹èŠ‚ç‚¹ç»“æŸã€‚å¾—åˆ°æœ€é‚»è¿‘ç‚¹ã€‚ class Node: def __init__(self, data, left=None, right=None): self.val = data self.left = left self.right = right class KDTree: def __init__(self, k): self.k = k def create_Tree(self, dataset, depth): if not dataset: return None mid_index = len(dataset) // 2 # ä¸­ä½æ•°ç´¢å¼• axis = depth % self.k # é€‰æ‹©çš„ç»´åº¦ sort_dataset = sorted(dataset, key=(lambda x: x[axis])) # æŒ‰ç…§ç»´åº¦æ’åº mid_data = sort_dataset[mid_index] # ä¸­ä½æ•°ç´¢å¼•å¯¹åº”çš„æ•°æ® cur_node = Node(mid_data) # åˆ›å»ºèŠ‚ç‚¹ left_data = sort_dataset[:mid_index] # å·¦å­æ ‘æ•°æ® right_data = sort_dataset[mid_index+1:] # å³å­æ ‘æ•°æ® cur_node.left = self.create_Tree(left_data, depth+1) # é€’å½’åˆ›å»ºå·¦å­æ ‘ cur_node.right = self.create_Tree(right_data, depth+1) # é€’å½’åˆ›å»ºå³å­æ ‘ # print(cur_node.val) return cur_node def search(self, tree, new_data): # kdæ ‘çš„æœç´¢ self.near_node = None # æœ€è¿‘çš„èŠ‚ç‚¹ self.near_val = None # æœ€è¿‘çš„èŠ‚ç‚¹çš„å€¼ def dfs(node, depth): if not node: return axis = depth % self.k # å½“å‰æ·±åº¦å¯¹åº”é€‰æ‹©çš„ç»´åº¦ if new_data[axis] \u003c node.val[axis]: # å¦‚æœæ–°æ•°æ®çš„ç»´åº¦å€¼å°äºå½“å‰èŠ‚ç‚¹çš„ç»´åº¦å€¼ dfs(node.left, depth+1) # é€’å½’æœç´¢å·¦å­æ ‘ else: dfs(node.right, depth+1) # é€’å½’æœç´¢å³å­æ ‘ # åˆ°è¿™å°±ç›¸å½“äºåˆ°è¾¾äº†å¶å­èŠ‚ç‚¹ dist = self.distance(new_data, node.val) # è®¡ç®—æ–°æ•°æ®ä¸å½“å‰èŠ‚ç‚¹çš„è·ç¦» if not self.near_val or dist \u003c self.near_val: # å¦‚æœå½“å‰èŠ‚ç‚¹çš„è·ç¦»å°äºæœ€è¿‘çš„èŠ‚ç‚¹çš„è·ç¦» self.near_val = dist # æ›´æ–°æœ€è¿‘çš„èŠ‚ç‚¹çš„è·ç¦» self.near_point = node.val # æ›´æ–°æœ€è¿‘çš„èŠ‚ç‚¹çš„å€¼ #åˆ¤æ–­æ˜¯å¦è¦è¿›å…¥å…„å¼ŸèŠ‚ç‚¹å¯»æ‰¾ if abs(new_data[axis] - node.val[axis]) \u003c self.near_val: # å¦‚æœæ–°æ•°æ®çš„ç»´åº¦å€¼ä¸å½“å‰èŠ‚ç‚¹çš„ç»´åº¦å€¼çš„å·®å€¼å°äºæœ€è¿‘çš„èŠ‚ç‚¹çš„è·ç¦»ï¼Œè¯´æ˜å…„å¼ŸèŠ‚ç‚¹åŒºåŸŸæœ‰å¯èƒ½å­˜åœ¨æ›´æ¥è¿‘çš„å€¼ã€‚ if new_data[axis] \u003c node.val[axis]: # æ§åˆ¶å»å…„å¼ŸèŠ‚ç‚¹è€Œä¸æ˜¯åˆšåˆšå›æº¯æ¥çš„èŠ‚ç‚¹ã€‚ dfs(node.right, depth+1) else: dfs(node.left, depth+1) dfs(tree, 0) return self.near_point def distance(self, point_1, point_2): res = 0 for i in range(self.k): res += (point_1[i] - point_2[i]) ** 2 return res ** 0.5 if __name__ == '__main__': data_set = [[2,3],[5,4],[9,6],[4,7],[8,1],[7,2]] new_data = [1,5] k = len(data_set[0]) kd_tree = KDTree(k) our_tree = kd_tree.create_Tree(data_set, 0) predict = kd_tree.search(our_tree, new_data) print('Nearest Point of {}: {}'.format(new_data,predict)) Nearest Point of [1, 5]: [2, 3] å€Ÿç”¨ä¸€ä¸‹åˆ«äººç”»çš„è§£é¢˜è¿‡ç¨‹ ## å‚è€ƒ https://zhuanlan.zhihu.com/p/499241064#:~:text=kd%E6%A0%91%E7%94%A8%E4%BA%8E%E5%AF%B9k%E7%BB%B4,%E7%9A%84%E6%97%B6%E5%80%99%E9%9D%9E%E5%B8%B8%E8%80%97%E6%97%B6%E3%80%82 ","date":"2022-03-21","objectID":"/kd%E6%A0%91/:8:0","tags":["é¢ç»","kdæ ‘"],"title":"kdæ ‘","uri":"/kd%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ€å°å…¬ä¼—å‰ç¼€ leetcodeä¸Šçš„ç®€å•é¢˜ï¼Œæœ€å°å…¬ä¼—å‰ç¼€ æœ‰ä¸‰ç§è§£æ³•ï¼Œä¸€ç§å¸¸è§„ï¼Œä¸¤ç§å·§å¦™è§£æ³• # æœ€å°å…¬å…±å‰ç¼€ #è§£1ï¼šå¸¸è§„è§£æ³• æ€è·¯å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­ å…ˆåˆ¤æ–­æ‰€æœ‰å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªæ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒå°±è¿”å›ï¼Œå¦åˆ™ç„¶åä¾æ¬¡å¾€ååˆ¤æ–­ def longestCommonPrefix1(strs): if len(strs) == 0: return '' if len(strs) == 1: return strs[0] minl=min([len(x) for x in strs]) #æ±‚æœ€å°é•¿åº¦ end = 0 while end \u003c minl: #åˆ¤æ–­æ˜¯å¦åˆ°æœ€å°é•¿åº¦ for i in range(1,len(strs)): #ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºåŸºå‡† if strs[i][end] != strs[i-1][end]: #å¦‚æœåˆ°endè¿™é‡Œä¸å†ç›¸ç­‰ åˆ™è¿”å›åˆ°endè¿™é‡Œçš„å­—ç¬¦ä¸²å³æœ€å°å…¬å…±å‰ç¼€ return strs[0][:end] end+=1 return strs[0][:end] #å¸¸è§„æ–¹æ³•å®¹æ˜“æƒ³åˆ° ä½†æ˜¯ç¼ºç‚¹æ˜¯è¿è¡Œé€Ÿåº¦æ…¢ï¼Œä»æ¯æ¬¡åˆ¤æ–­éƒ½è¦éå†æ‰€æœ‰å­—ç¬¦ä¸²å°±å¯ä»¥çœ‹å‡º #è§£2: é€šè¿‡asciiç æ¥åˆ¤æ–­ #Pythoné‡Œå­—ç¬¦ä¸²æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼ŒæŒ‰ç…§ascIIå€¼æ’ def longestCommonPrefix2(strs): if not strs: return 0 s1 = max(strs) s2 = min(strs) #æ‰¾å‡ºs1 s2çš„æœ€å°å…¬å…±å‰ç¼€å³ä¸ºæ•´ä¸ªåˆ—è¡¨çš„æœ€å°å…¬å…±å‰ç¼€ for i,s in enumerate(s2): if s1[i] != s: return s1[:i] return s2 #é€šè¿‡max å’Œ min å‡½æ•°æ¥æ‰¾åˆ°åˆ—è¡¨é‡Œé¢æœ€å¤§æœ€å°çš„ä¸¤ä¸ªå­—ç¬¦ä¸² ç„¶åæ‰¾åˆ°è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€å°å…¬å…±å‰ç¼€ã€‚ #è§£3ï¼šé€šè¿‡pythonè¯­æ³•ç³– å°†æ¯ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªå¯¹åº”å­—ç¬¦ä¸²å­˜ä¸ºä¸€ç»„ï¼Œç”¨zipå‡½æ•°ï¼Œæ¯”å¦‚è¯´æ‰€æœ‰çš„å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­˜åœ¨ä¸€èµ·ï¼Œç„¶åç”¨setå»é‡ï¼Œå¦‚æœç•™ä¸‹äº†ä¸€ä¸ªï¼Œåˆ™è¯´æ˜éƒ½é‡å¤äº†ï¼Œåˆ™å°±æ˜¯ç›¸åŒçš„ def longestCommonPrefix3(strs): if not strs: return 0 cc = list(map(set,zip(*strs))) #ä¸ºä»€ä¹ˆç”¨mapå‘¢ å› ä¸ºè¦å¯¹zipå‹ç¼©åçš„æ¯ä¸€ä¸ªåºåˆ—å»é‡ res = '' #ç»“æœ for i,s in enumerate(cc): x = list(s) if len(x) \u003e 1: #å¦‚æœé•¿åº¦å¤§äº1 è¯´æ˜æœ‰ä¸ä¸€æ ·çš„ åˆ™ç›´æ¥é€€å‡º break res += x[0] return res å¦‚ä¸Šï¼ ","date":"2022-03-20","objectID":"/%E6%9C%80%E5%B0%8F%E5%85%AC%E4%BC%97%E5%89%8D%E7%BC%80/:0:0","tags":["ç®—æ³•é¢˜","æœ€å°å…¬ä¼—å‰ç¼€"],"title":"æœ€å°å…¬ä¼—å‰ç¼€","uri":"/%E6%9C%80%E5%B0%8F%E5%85%AC%E4%BC%97%E5%89%8D%E7%BC%80/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å‚è€ƒï¼šhttps://cuijiahua.com/blog/2017/12/ml_13_regtree_1.html ","date":"2022-03-16","objectID":"/%E6%A0%91%E5%9B%9E%E5%BD%92/:0:0","tags":["Machine Learning","å›å½’ç®—æ³•","æ ‘å›å½’"],"title":"æ ‘å›å½’","uri":"/%E6%A0%91%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"1ã€ID3ç®—æ³•çš„å¼Šç«¯ å›å¿†ä¸€ä¸‹ï¼Œå†³ç­–æ ‘çš„æ ‘æ„å»ºç®—æ³•æ˜¯ID3ã€‚ID3çš„åšæ³•æ˜¯æ¯æ¬¡é€‰å–å½“å‰æœ€ä½³çš„ç‰¹å¾æ¥åˆ†å‰²æ•°æ®ï¼Œå¹¶æŒ‰ç…§è¯¥ç‰¹å¾çš„æ‰€æœ‰å¯èƒ½å–å€¼æ¥åˆ‡åˆ†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç‰¹å¾æœ‰4ç§å–å€¼ï¼Œé‚£ä¹ˆæ•°æ®å°†è¢«åˆ‡åˆ†æˆ4ä»½ã€‚ä¸€æ—¦æŒ‰æŸç‰¹å¾åˆ‡åˆ†åï¼Œè¯¥ç‰¹å¾åœ¨ä¹‹åçš„ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å°†ä¸ä¼šå†èµ·ä½œç”¨ï¼Œæ‰€ä»¥æœ‰è§‚ç‚¹è®¤ä¸ºè¿™ç§åˆ‡åˆ†æ–¹å¼è¿‡äºè¿…é€Ÿã€‚ é™¤äº†åˆ‡åˆ†è¿‡äºè¿…é€Ÿå¤–ï¼ŒID3ç®—æ³•è¿˜å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒä¸èƒ½ç›´æ¥å¤„ç†è¿ç»­å‹ç‰¹å¾ã€‚åªæœ‰äº‹å…ˆå°†è¿ç»­å‹ç‰¹å¾ç¦»æ•£åŒ–ï¼Œæ‰èƒ½åœ¨ID3ç®—æ³•ä¸­ä½¿ç”¨ã€‚ä½†è¿™ç§è½¬æ¢è¿‡ç¨‹ä¼šç ´åè¿ç»­å‹å˜é‡çš„å†…åœ¨ç‰¹æ€§ã€‚ ","date":"2022-03-16","objectID":"/%E6%A0%91%E5%9B%9E%E5%BD%92/:1:0","tags":["Machine Learning","å›å½’ç®—æ³•","æ ‘å›å½’"],"title":"æ ‘å›å½’","uri":"/%E6%A0%91%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"2ã€CARTç®—æ³• ä¸ID3ç®—æ³•ç›¸åï¼ŒCARTç®—æ³•æ­£å¥½é€‚ç”¨äºè¿ç»­å‹ç‰¹å¾ã€‚CARTç®—æ³•ä½¿ç”¨äºŒå…ƒåˆ‡åˆ†æ³•æ¥å¤„ç†è¿ç»­å‹å˜é‡ã€‚è€Œä½¿ç”¨äºŒå…ƒåˆ‡åˆ†æ³•åˆ™æ˜“äºå¯¹æ ‘æ„å»ºè¿‡ç¨‹è¿›è¡Œè°ƒæ•´ä»¥å¤„ç†è¿ç»­å‹ç‰¹å¾ã€‚å…·ä½“çš„å¤„ç†æ–¹æ³•æ˜¯ï¼šå¦‚æœç‰¹å¾å€¼å¤§äºç»™å®šå€¼å°±èµ°å·¦å­æ ‘ï¼Œå¦åˆ™å°±èµ°å³å­æ ‘ã€‚ CARTç®—æ³•æœ‰ä¸¤æ­¥ï¼š å†³ç­–æ ‘ç”Ÿæˆï¼šé€’å½’åœ°æ„å»ºäºŒå‰å†³ç­–æ ‘çš„è¿‡ç¨‹ï¼ŒåŸºäºè®­ç»ƒæ•°æ®é›†ç”Ÿæˆå†³ç­–æ ‘ï¼Œç”Ÿæˆçš„å†³ç­–æ ‘è¦å°½é‡å¤§ï¼›è‡ªä¸Šè€Œä¸‹ä»æ ¹å¼€å§‹å»ºç«‹èŠ‚ç‚¹ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å¤„è¦é€‰æ‹©ä¸€ä¸ªæœ€å¥½çš„å±æ€§æ¥åˆ†è£‚ï¼Œä½¿å¾—å­èŠ‚ç‚¹ä¸­çš„è®­ç»ƒé›†å°½é‡çš„çº¯ã€‚ä¸åŒçš„ç®—æ³•ä½¿ç”¨ä¸åŒçš„æŒ‡æ ‡æ¥å®šä¹‰â€æœ€å¥½â€ï¼š å†³ç­–æ ‘å‰ªæï¼šç”¨éªŒè¯æ•°æ®é›†å¯¹å·²ç”Ÿæˆçš„æ ‘è¿›è¡Œå‰ªæå¹¶é€‰æ‹©æœ€ä¼˜å­æ ‘ï¼Œè¿™æ—¶æŸå¤±å‡½æ•°æœ€å°ä½œä¸ºå‰ªæçš„æ ‡å‡†ã€‚ å†³ç­–æ ‘å‰ªææˆ‘ä»¬å…ˆä¸ç®¡ï¼Œæˆ‘ä»¬çœ‹ä¸‹å†³ç­–æ ‘ç”Ÿæˆã€‚ åœ¨å†³ç­–æ ‘çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å…ˆæ ¹æ®ä¿¡æ¯ç†µçš„è®¡ç®—æ‰¾åˆ°æœ€ä½³ç‰¹å¾åˆ‡åˆ†æ•°æ®é›†æ„å»ºå†³ç­–æ ‘ã€‚CARTç®—æ³•çš„å†³ç­–æ ‘ç”Ÿæˆä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š ä½¿ç”¨CARTç®—æ³•é€‰æ‹©ç‰¹å¾ æ ¹æ®ç‰¹å¾åˆ‡åˆ†æ•°æ®é›†åˆ æ„å»ºæ ‘ ","date":"2022-03-16","objectID":"/%E6%A0%91%E5%9B%9E%E5%BD%92/:2:0","tags":["Machine Learning","å›å½’ç®—æ³•","æ ‘å›å½’"],"title":"æ ‘å›å½’","uri":"/%E6%A0%91%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"æ¨å¯¼ é€‰æ‹©æœ€ä¼˜åˆ‡åˆ†å˜é‡jä¸åˆ‡åˆ†ç‚¹sï¼šéå†å˜é‡jï¼Œå¯¹è§„å®šçš„åˆ‡åˆ†å˜é‡jæ‰«æåˆ‡åˆ†ç‚¹sï¼Œé€‰æ‹©ä½¿ä¸‹å¼å¾—åˆ°æœ€å° å€¼æ—¶çš„(j,s)å¯¹ã€‚å…¶ä¸­Rmæ˜¯è¢«åˆ’åˆ†çš„è¾“å…¥ç©ºé—´ï¼Œ \\(\\mathrm{cm}\\) æ˜¯ç©ºé—´Rmå¯¹åº”çš„å›ºå®šè¾“å‡ºå€¼ã€‚ \\[ \\min_{j, s}\\left[\\min_{c_{1}} \\sum_{x_{i} \\in R_{i}(j, s)}\\left(y_{i}-c_{1}\\right)^{2}+\\min_{c_{2}} \\sum_{x_{i} \\in R_{i}(j, s)}\\left(y_{i}-c_{1}\\right)^{2}\\right] \\] ç”¨é€‰å®šçš„(j,s)å¯¹ï¼Œåˆ’åˆ†åŒºåŸŸå¹¶å†³å®šç›¸åº”çš„è¾“å‡ºå€¼ \\[ \\begin{gathered} R_{1}(j, s)={x \\mid x^{(j)} \\leq s}, R_{2}(j, s)={x \\mid x^{(j)}\u003es} \\\\\\\\ \\hat{c}_{m}=\\frac{1}{N_{m}} \\sum_{x_{i} \\in R_{m}(j, s)} y_{i} \\\\\\\\ x \\in R_{m}, m=1,2 \\end{gathered} \\] ç»§ç»­å¯¹ä¸¤ä¸ªå­åŒºåŸŸè°ƒç”¨ä¸Šè¿°æ­¥éª¤ï¼Œå°†è¾“å…¥ç©ºé—´åˆ’åˆ†ä¸º \\(M\\) ä¸ªåŒºåŸŸR1,R2,..,Rmï¼Œç”Ÿæˆå†³ç­–æ ‘ã€‚ \\[ f(x)=\\sum_{m=1}^{M} \\hat{c}_{m} I\\left(x \\epsilon R_{m}\\right) \\] å½“è¾“å…¥ç©ºé—´åˆ’åˆ†ç¡®å®šæ—¶ï¼Œå¯ä»¥ç”¨å¹³æ–¹è¯¯å·®æ¥è¡¨ç¤ºå›å½’æ ‘å¯¹äºè®­ç»ƒæ•°æ®çš„é¢„æµ‹æ–¹æ³•ï¼Œç”¨å¹³æ–¹è¯¯å·®æœ€å° çš„å‡†åˆ™æ±‚è§£æ¯ä¸ªå•å…ƒä¸Šçš„æœ€ä¼˜è¾“å‡ºå€¼ã€‚ ","date":"2022-03-16","objectID":"/%E6%A0%91%E5%9B%9E%E5%BD%92/:2:1","tags":["Machine Learning","å›å½’ç®—æ³•","æ ‘å›å½’"],"title":"æ ‘å›å½’","uri":"/%E6%A0%91%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å®ä¾‹ ã€æœºå™¨å­¦ä¹ ã€‘å›å½’å†³ç­–æ ‘-CSDNåšå®¢ ","date":"2022-03-16","objectID":"/%E6%A0%91%E5%9B%9E%E5%BD%92/:3:0","tags":["Machine Learning","å›å½’ç®—æ³•","æ ‘å›å½’"],"title":"æ ‘å›å½’","uri":"/%E6%A0%91%E5%9B%9E%E5%BD%92/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœç´¢æ—‹è½¬æ’åºæ•°ç»„ ","date":"2022-03-13","objectID":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/:0:0","tags":["ç®—æ³•é¢˜","æœç´¢æ—‹è½¬æ’åºæ•°ç»„"],"title":"æœç´¢æ—‹è½¬æ’åºæ•°ç»„","uri":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/search-in-rotated-sorted-array/ ","date":"2022-03-13","objectID":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/:1:0","tags":["ç®—æ³•é¢˜","æœç´¢æ—‹è½¬æ’åºæ•°ç»„"],"title":"æœç´¢æ—‹è½¬æ’åºæ•°ç»„","uri":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š æ˜æ˜¾çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œä¸è¿‡ä¸æ˜¯æœ‰åºæ•°ç»„äº†ï¼Œè€Œæ˜¯éƒ¨åˆ†æœ‰åºï¼Œæ‰€ä»¥éœ€è¦æœ‰åˆ¤æ–­ ","date":"2022-03-13","objectID":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/:2:0","tags":["ç®—æ³•é¢˜","æœç´¢æ—‹è½¬æ’åºæ•°ç»„"],"title":"æœç´¢æ—‹è½¬æ’åºæ•°ç»„","uri":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution(object): def search(self, nums, target): left, right = 0, len(nums) - 1 while left \u003c= right: mid = left + (right - left) // 2 if nums[mid] == target: return mid if nums[mid] \u003c nums[right]:#å³è¾¹ä¸ºå‡åº if nums[mid] \u003c target \u003c= nums[right]: left = mid + 1 else: right = mid if nums[left] \u003c= nums[mid]:#å·¦è¾¹ä¸ºå‡åº if nums[left] \u003c= target \u003c nums[mid]: right = mid else: left = mid + 1 return -1 ","date":"2022-03-13","objectID":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/:3:0","tags":["ç®—æ³•é¢˜","æœç´¢æ—‹è½¬æ’åºæ•°ç»„"],"title":"æœç´¢æ—‹è½¬æ’åºæ•°ç»„","uri":"/%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/"},{"categories":["pandas"],"content":"pandasè¡¥å……å­¦ä¹  æ¨èç½‘ç«™ï¼šhttp://joyfulpandas.datawhale.club/Content/Preface.html pandasæ ¸å¿ƒæ“ä½œæ‰‹å†Œï¼šhttps://mp.weixin.qq.com/s/l1V5e726XixI0W3EDHx0Nw ","date":"2022-02-22","objectID":"/some_api/:0:0","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"pd.joinå’Œpd.merge å¯ä»¥è¯´mergeåŒ…å«äº†joinæ“ä½œï¼Œmergeæ”¯æŒä¸¤ä¸ªdfé—´è¡Œæ–¹å‘æˆ–åˆ—æ–¹å‘çš„æ‹¼æ¥æ“ä½œï¼Œé»˜è®¤åˆ—æ‹¼æ¥ï¼Œå–äº¤é›†ï¼Œè€Œjoinåªæ˜¯ç®€åŒ–äº†mergeçš„è¡Œæ‹¼æ¥çš„æ“ä½œ pandasçš„mergeæ–¹æ³•æä¾›äº†ä¸€ç§ç±»ä¼¼äºSQLçš„å†…å­˜é“¾æ¥æ“ä½œï¼Œå®˜ç½‘æ–‡æ¡£æåˆ°å®ƒçš„æ€§èƒ½ä¼šæ¯”å…¶ä»–å¼€æºè¯­è¨€çš„æ•°æ®æ“ä½œï¼ˆä¾‹å¦‚Rï¼‰è¦é«˜æ•ˆã€‚ å¦‚æœå¯¹äºsqlæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œmergeä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚ mergeçš„å‚æ•° onï¼šåˆ—åï¼Œjoinç”¨æ¥å¯¹é½çš„é‚£ä¸€åˆ—çš„åå­—ï¼Œç”¨åˆ°è¿™ä¸ªå‚æ•°çš„æ—¶å€™ä¸€å®šè¦ä¿è¯å·¦è¡¨å’Œå³è¡¨ç”¨æ¥å¯¹é½çš„é‚£ä¸€åˆ—éƒ½æœ‰ç›¸åŒçš„åˆ—åã€‚ left_onï¼šå·¦è¡¨å¯¹é½çš„åˆ—ï¼Œå¯ä»¥æ˜¯åˆ—åï¼Œä¹Ÿå¯ä»¥æ˜¯å’ŒdataframeåŒæ ·é•¿åº¦çš„arraysã€‚ right_onï¼šå³è¡¨å¯¹é½çš„åˆ—ï¼Œå¯ä»¥æ˜¯åˆ—åï¼Œä¹Ÿå¯ä»¥æ˜¯å’ŒdataframeåŒæ ·é•¿åº¦çš„arraysã€‚ left_index/ right_index: å¦‚æœæ˜¯Trueçš„hauntedä»¥indexä½œä¸ºå¯¹é½çš„key howï¼šæ•°æ®èåˆçš„æ–¹æ³•ã€‚ sortï¼šæ ¹æ®dataframeåˆå¹¶çš„keysæŒ‰å­—å…¸é¡ºåºæ’åºï¼Œé»˜è®¤æ˜¯ï¼Œå¦‚æœç½®falseå¯ä»¥æé«˜è¡¨ç°ã€‚ ç®€å•ä¸¾ä¸€ä¸ªåˆšåˆšåœ¨æ¯”èµ›ä¸­é‡Œé¢ç”¨åˆ°çš„ä¾‹å­ data = pd.merge(data1, data2, on=\"carid\", how=\"inner\") # æ ¹æ®caridåˆå¹¶ä¸¤ä¸ªæ•°æ®é›† å¯ä»¥ç”¨pd.mergeï¼Œä¹Ÿå¯ä»¥ç”¨dataframe.mergeï¼Œæ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥é˜…å®˜æ–¹APIã€‚ ## pd.concat ä¹Ÿæ˜¯åˆå¹¶dataframe ç”¨æ³•ï¼š pd.concat([df1, df2]) # çºµå‘åˆå¹¶ pd.concat([df1, df2], axis=1) # æ¨ªå‘åˆå¹¶ å‚æ•° - ignore_index=Trueï¼Œé‡æ–°è®¾ç½®åˆå¹¶åçš„dataframeå¯¹è±¡çš„indexå€¼ - sort=Falseï¼Œåˆ—çš„é¡ºåºä¿æŒåŸæ · - join : {â€œinnerâ€, â€œouterâ€}ï¼Œé»˜è®¤ä¸ºouterã€‚ ## pd.append # è¯­æ³•ç»“æ„ df.append(self, other, ignore_index=False, verify_integrity=False, sort=False) other æ˜¯å®ƒè¦è¿½åŠ çš„å…¶ä»– DataFrame æˆ–è€…ç±»ä¼¼åºåˆ—å†…å®¹ ignore_index å¦‚æœä¸º True åˆ™é‡æ–°è¿›è¡Œè‡ªç„¶ç´¢å¼• verify_integrity å¦‚æœä¸º True åˆ™é‡åˆ°é‡å¤ç´¢å¼•å†…å®¹æ—¶æŠ¥é”™ sort è¿›è¡Œæ’åº ","date":"2022-02-22","objectID":"/some_api/:1:0","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"åŒç»“æ„ å°†åŒç»“æ„çš„æ•°æ®è¿½åŠ åœ¨åŸæ•°æ®åé¢ ### ä¸åŒç»“æ„ æ²¡æœ‰çš„åˆ—ä¼šå¢åŠ ï¼Œæ²¡æœ‰çš„ç›¸åº”å†…å®¹ä¸ºç©ºã€‚ ### å¯ä»¥åˆå¹¶è¿½åŠ å¤šä¸ª result = df1.append([df2, df3]) ","date":"2022-02-22","objectID":"/some_api/:1:1","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"è¿½åŠ åºåˆ— s2 = pd.Series(['X0', 'X1', 'X2', 'X3'], index=['A', 'B', 'C', 'D']) result = df1.append(s2, ignore_index=True) ","date":"2022-02-22","objectID":"/some_api/:1:2","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"è¿½åŠ å­—å…¸åˆ—è¡¨ dicts = [{'A': 1, 'B': 2, 'C': 3, 'X': 4}, {'A': 5, 'B': 6, 'C': 7, 'Y': 8}] result = df1.append(dicts, ignore_index=True, sort=False) ","date":"2022-02-22","objectID":"/some_api/:1:3","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"pd.rename DataFrame.rename(self, mapper=None, index=None, columns=None, axis=None, copy=True, inplace=False, level=None, errors=â€˜ignoreâ€™) ä½œç”¨å°±æ˜¯ä¿®æ”¹indexæˆ–è€…columnsçš„åå­—ã€‚ä½¿ç”¨æ—¶å¯ä»¥æŒ‡å®šmapperï¼Œç„¶åæŒ‡å®šaxisï¼Œé»˜è®¤axis=0ï¼Œå³ä¿®æ”¹index ä¹Ÿå¯ä»¥ä½¿ç”¨index=xxx,columns=xxxï¼ŒåŒæ—¶è¿›è¡Œä¿®æ”¹ã€‚ ","date":"2022-02-22","objectID":"/some_api/:2:0","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"pd.get_dummies ç”¨äºæ„é€ ç¦»æ•£æ•°æ®çš„ç‹¬çƒ­ç¼–ç  ç”¨æ³• training = pd.get_dummies(train_data, columns=[\"xxx\", \"xx\", \"x\"]) # å¯¹xxxã€xxã€xè¿™ä¸‰åˆ—è¿›è¡Œonehotç¼–ç  ","date":"2022-02-22","objectID":"/some_api/:3:0","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"pd.melt ç›´è§‚çš„çœ‹å°±æ˜¯å°†å®½æ•°æ®è½¬åŒ–ä¸ºé•¿æ•°æ®ã€‚è½¬åŒ–ä¸ºvariable-valueè¿™æ ·çš„å½¢å¼ã€‚ pandas.melt(frame, id_vars=None, value_vars=None, var_name=None, value_name='value', col_level=None) å‚æ•°è§£é‡Šï¼š frame:è¦å¤„ç†çš„æ•°æ®é›†ã€‚ id_vars:ä¸éœ€è¦è¢«è½¬æ¢çš„åˆ—åã€‚ value_vars:éœ€è¦è½¬æ¢çš„åˆ—åï¼Œå¦‚æœå‰©ä¸‹çš„åˆ—å…¨éƒ¨éƒ½è¦è½¬æ¢ï¼Œå°±ä¸ç”¨å†™äº†ã€‚ var_nameå’Œvalue_nameæ˜¯è‡ªå®šä¹‰è®¾ç½®å¯¹åº”çš„åˆ—åã€‚ col_level :å¦‚æœåˆ—æ˜¯MultiIndexï¼Œåˆ™ä½¿ç”¨æ­¤çº§åˆ«ã€‚ å¸¸å¸¸ä¸seabornçš„FacetGridä¸€èµ·è¿›è¡Œæ“ä½œï¼Œç¤ºä¾‹ï¼š f = pd.melt(train_data, value_vars=numeric_features) g = sns.FacetGrid(f, col=\"variable\", col_wrap=2, sharex=False, sharey=False) # col_warpé™åˆ¶ä¸€è¡Œåªæœ‰ä¸¤ä¸ªï¼Œsharxã€shareyé»˜è®¤ä¸ºTrue,ä¸matplotlib.pyplot.subplotsç›¸åã€‚ g = g.map(sns.distplot, \"value\") # ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥è‡ªå®šä¹‰å‡½æ•°ã€‚ ","date":"2022-02-22","objectID":"/some_api/:4:0","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["pandas"],"content":"sns.pairplot seabornä¸€èˆ¬ä¸pandasçš„æ•°æ®ç»“åˆï¼Œå› æ­¤ä¸åˆ†å¼€åšç¬”è®°äº†ã€‚ æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œsns.pairplotæ˜¯åœ¨æ•°æ®é›†ä¸­ç»˜åˆ¶æˆå¯¹å…³ç³»ã€‚ç”¨æ¥å±•ç°å˜é‡ä¸¤ä¸¤ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚çº¿æ€§ã€éçº¿æ€§ã€ç›¸å…³ç­‰ç­‰ã€‚ hueå‚æ•°å¯ä»¥æŒ‡å®šåˆ†ç±»ã€‚ä¸å…¶å®ƒplotçš„hueå‚æ•°ä¸€è‡´ã€‚ ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å‚æ•°diag_kind=\"kde\"ï¼Œå› ä¸ºå¯¹è§’çº¿ä¸Šçš„å˜é‡xä¸yéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ¢ç©¶å…³ç³»æ²¡æœ‰æ„ä¹‰ï¼Œå› æ­¤å±•ç¤ºæ ¸å¯†åº¦åˆ†å¸ƒã€‚ seaborn.pairplot(data, hue=None, hue_order=None, palette=None, vars=None, x_vars=None, y_vars=None, kind='scatter', diag_kind='hist', markers=None, size=2.5, aspect=1, dropna=True, plot_kws=None, diag_kws=None, grid_kws=None)Â¶ æ•°æ®æŒ‡å®šï¼š \u003e vars : ä¸dataä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨dataçš„å…¨éƒ¨å˜é‡ã€‚å‚æ•°ç±»å‹ï¼šnumericç±»å‹çš„å˜é‡listã€‚ {x, y}_vars : ä¸dataä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨dataçš„å…¨éƒ¨å˜é‡ã€‚å‚æ•°ç±»å‹ï¼šnumericç±»å‹çš„å˜é‡listã€‚ dropna : æ˜¯å¦å‰”é™¤ç¼ºå¤±å€¼ã€‚å‚æ•°ç±»å‹ï¼šboolean, optional ç‰¹æ®Šå‚æ•°ï¼š \u003e kind : {â€˜scatterâ€™, â€˜regâ€™}, optional Kind of plot for the non-identity relationships. diag_kind : {â€˜histâ€™, â€˜kdeâ€™}, optionalã€‚Kind of plot for the diagonal subplots. åŸºæœ¬å‚æ•°ï¼š \u003e size : é»˜è®¤ 6ï¼Œå›¾çš„å°ºåº¦å¤§å°ï¼ˆæ­£æ–¹å½¢ï¼‰ã€‚å‚æ•°ç±»å‹ï¼šnumeric hue : ä½¿ç”¨æŒ‡å®šå˜é‡ä¸ºåˆ†ç±»å˜é‡ç”»å›¾ã€‚å‚æ•°ç±»å‹ï¼šstring (å˜é‡å) hue_order : list of strings Order for the levels of the hue variable in the palette palette : è°ƒè‰²æ¿é¢œè‰² markers : ä½¿ç”¨ä¸åŒçš„å½¢çŠ¶ã€‚å‚æ•°ç±»å‹ï¼šlist aspect : scalar, optionalã€‚Aspect * size gives the width (in inches) of each facet. {plot, diag, grid}_kws : æŒ‡å®šå…¶ä»–å‚æ•°ã€‚å‚æ•°ç±»å‹ï¼šdicts ","date":"2022-02-22","objectID":"/some_api/:4:1","tags":["pandas","learn_four"],"title":"learn_four","uri":"/some_api/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA) çº¿æ€§åˆ¤åˆ«åˆ†æï¼Œä¹Ÿå°±æ˜¯LDAï¼ˆä¸ä¸»é¢˜æ¨¡å‹ä¸­çš„LDAåŒºåˆ†å¼€ï¼‰ï¼Œç°åœ¨å¸¸å¸¸ç”¨äºæ•°æ®çš„é™ç»´ä¸­ï¼Œä½†ä»å®ƒçš„åå­—ä¸­å¯ä»¥çœ‹å‡ºæ¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»çš„ç®—æ³•ï¼Œè€Œä¸”å±äºç¡¬åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯ç»“æœä¸æ˜¯æ¦‚ç‡ï¼Œæ˜¯å…·ä½“çš„ç±»åˆ« ## ä¸»è¦æ€æƒ³ 1. ç±»å†…æ–¹å·®å° 2. ç±»é—´æ–¹å·®å¤§ ## æ¨å¯¼ è¿™é‡Œä»¥äºŒç±»ä¸ºä¾‹ï¼Œå³åªæœ‰ä¸¤ä¸ªç±»åˆ«ã€‚ é¦–å…ˆæ˜¯æŠ•å½±ï¼Œæˆ‘ä»¬å‡å®šåŸæ¥çš„æ•°æ®æ˜¯å‘é‡ \\(x\\)ï¼Œé‚£ä¹ˆé¡ºç€ \\(w\\) æ–¹å‘çš„æŠ•å½±å°±æ˜¯æ ‡é‡ï¼š \\[ z=w^T\\cdot x(=|w|\\cdot|x|\\cos\\theta) \\] å¯¹ç¬¬ä¸€ç‚¹ï¼Œç›¸åŒç±»å†…éƒ¨çš„æ ·æœ¬æ›´ä¸ºæ¥è¿‘ï¼Œæˆ‘ä»¬å‡è®¾å±äºä¸¤ç±»çš„è¯•éªŒæ ·æœ¬æ•°é‡åˆ†åˆ«æ˜¯ \\(N_1\\)å’Œ \\(N_2\\)ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨æ–¹å·®çŸ©é˜µæ¥è¡¨å¾æ¯ä¸€ä¸ªç±»å†…çš„æ€»ä½“åˆ†å¸ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†åæ–¹å·®çš„å®šä¹‰ï¼Œç”¨ \\(S\\) è¡¨ç¤ºåŸæ•°æ®çš„åæ–¹å·®ï¼š \\[ \\begin{align} C_1:Var_z[C_1]\u0026=\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(z_i-\\bar{z_{c1}})(z_i-\\bar{z_{c1}})^T\\nonumber\\\\\\\\\\\\\\\\ \u0026=\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(w^Tx_i-\\frac{1}{N_1}\\sum\\limits_{j=1}^{N_1}w^Tx_j)(w^Tx_i-\\frac{1}{N_1}\\sum\\limits_{j=1}^{N_1}w^Tx_j)^T\\nonumber\\\\\\\\\\\\\\\\ \u0026=w^T\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}(x_i-\\bar{x_{c1}})(x_i-\\bar{x_{c1}})^Tw\\nonumber\\\\\\\\\\\\\\\\ \u0026=w^TS_1w\\\\\\\\\\\\\\\\ C_2:Var_z[C_2]\u0026=\\frac{1}{N_2}\\sum\\limits_{i=1}^{N_2}(z_i-\\bar{z_{c2}})(z_i-\\bar{z_{c2}})^T\\nonumber\\\\\\\\\\\\\\\\ \u0026=w^TS_2w \\end{align} \\] æ‰€ä»¥ç±»å†…è·ç¦»ä¸ºï¼š \\[ \\begin{align} Var_z[C_1]+Var_z[C_2]=w^T(S_1+S_2)w \\end{align} \\] å¯¹äºç¬¬äºŒç‚¹ç±»é—´è·ç¦»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç±»çš„å‡å€¼è¡¨ç¤ºè¿™ä¸ªè·ç¦»ï¼š \\[ \\begin{align} (\\bar{z_{c1}}-\\bar{z_{c2}})^2\u0026=(\\frac{1}{N_1}\\sum\\limits_{i=1}^{N_1}w^Tx_i-\\frac{1}{N_2}\\sum\\limits_{i=1}^{N_2}w^Tx_i)^2\\nonumber\\\\\\\\\\\\\\\\ \u0026=(w^T(\\bar{x_{c1}}-\\bar{x_{c2}}))^2\\nonumber\\\\\\\\\\\\\\\\ \u0026=w^T(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw \\end{align} \\] åˆè¿™ä¸¤ç‚¹ï¼Œç”±äºåæ–¹å·®æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œäºæ˜¯æˆ‘ä»¬ç”¨å°†è¿™ä¸¤ä¸ªå€¼ç›¸é™¤æ¥å¾—åˆ°æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ï¼Œå¹¶æœ€å¤§åŒ–è¿™ä¸ªå€¼ï¼š \\[ \\begin{align} \\hat{w}=\\mathop{argmax}\\limits_wJ(w)\u0026=\\mathop{argmax}\\limits_w\\frac{(\\bar{z_{c1}}-\\bar{z_{c2}})^2}{Var_z[C_1]+Var_z[C_2]}\\nonumber\\\\\\\\\\\\\\\\ \u0026=\\mathop{argmax}\\limits_w\\frac{w^T(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw}{w^T(S_1+S_2)w}\\nonumber\\\\\\\\\\\\\\\\ \u0026=\\mathop{argmax}\\limits_w\\frac{w^TS_bw}{w^TS_ww} \\end{align} \\] è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠæŸå¤±å‡½æ•°å’ŒåŸæ•°æ®é›†ä»¥åŠå‚æ•°ç»“åˆèµ·æ¥äº†ã€‚ä¸‹é¢å¯¹è¿™ä¸ªæŸå¤±å‡½æ•°æ±‚åå¯¼ï¼Œæ³¨æ„æˆ‘ä»¬å…¶å®å¯¹wçš„ç»å¯¹å€¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œåªå¯¹æ–¹å‘æœ‰è¦æ±‚ï¼Œå› æ­¤åªè¦ä¸€ä¸ªæ–¹ç¨‹å°±å¯ä»¥æ±‚è§£äº†ï¼š \\[ \\begin{aligned} \u0026\\frac{\\partial}{\\partial w}J(w)=2S_bw(w^TS_ww)^{-1}-2w^TS_bw(w^TS_ww)^{-2}S_ww=0\\nonumber\\\\\\\\\\\\\\\\ \u0026\\Longrightarrow S_bw(w^TS_ww)=(w^TS_bw)S_ww\\nonumber\\\\\\\\\\\\\\\\ \u0026\\Longrightarrow w\\propto S_w^{-1}S_bw=S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}})(\\bar{x_{c1}}-\\bar{x_{c2}})^Tw\\propto S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}}) \\end{aligned} \\] ä¹Ÿå°±æ˜¯è¯´æœ€åæˆ‘ä»¬çš„ç»“æœå°±æ˜¯\\(w=S_w^{-1}(\\bar{x_{c1}}-\\bar{x_{c2}})\\) å¯ä»¥å½’ä¸€åŒ–æ±‚å¾—å•ä½çš„wå€¼ã€‚ ","date":"2022-02-19","objectID":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","çº¿æ€§åˆ¤åˆ«åˆ†æ"],"title":"çº¿æ€§åˆ¤åˆ«åˆ†æ","uri":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å¤šç±»æƒ…å†µ å‰é¢çš„å¾ˆå®¹æ˜“ç±»æ¯”äºŒç±»çš„æƒ…å†µï¼Œç°åœ¨çš„ç›®æ ‡å‡½æ•°å˜æˆäº†ï¼š \\[ \\frac{W^TS_bW}{W^TS_wW} \\] ç°åœ¨çš„é—®é¢˜å°±æ˜¯è¿™äº›éƒ½æ˜¯çŸ©é˜µï¼Œä¸èƒ½åƒä¸Šé¢é‚£æ ·ç›´æ¥ä¼˜åŒ–ï¼Œéœ€è¦æ›¿æ¢ä¼˜åŒ–ç›®æ ‡ã€‚ \\[ \\underbrace{arg\\;max}_W\\;\\;J(W) = \\frac{\\prod\\limits_{diag}W^TS_bW}{\\prod\\limits_{diag}W^TS_wW} \\] å…¶ä¸­ \\(\\prod_{diag}A\\)ä¸ºAçš„ä¸»å¯¹è§’çº¿å…ƒç´ çš„ä¹˜ç§¯,Wä¸º\\(n \\times d\\)çš„çŸ©é˜µï¼Œnä¸ºåŸæ¥çš„ç»´åº¦ï¼Œdä¸ºæ˜ å°„åˆ°è¶…å¹³é¢çš„ç»´åº¦ï¼Œåˆ™æœ€ç»ˆçš„ç›®æ ‡å°±å˜æˆäº†ï¼š \\[ J(W) =Â \\frac{\\prod\\limits_{i=1}^dw_i^TS_bw_i}{\\prod\\limits_{i=1}^dw_i^TS_ww_i} = \\prod\\limits_{i=1}^d\\frac{w_i^TS_bw_i}{w_i^TS_ww_i} \\] æ ¹æ®å¹¿å¼ç‘åˆ©å•†ï¼Œæœ€å¤§å€¼æ˜¯çŸ©é˜µ\\(S_w^{-1}S_b\\)çš„æœ€å¤§ç‰¹å¾å€¼,æœ€å¤§çš„dä¸ªå€¼çš„ä¹˜ç§¯å°±æ˜¯çŸ©é˜µçš„ \\(S_w^{-1}S_b\\) æœ€å¤§çš„dä¸ªç‰¹å¾å€¼çš„ä¹˜ç§¯,æ­¤æ—¶å¯¹åº”çš„çŸ©é˜µ\\(W\\)ä¸ºè¿™æœ€å¤§çš„dä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å¼ æˆçš„çŸ©é˜µã€‚ ","date":"2022-02-19","objectID":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","çº¿æ€§åˆ¤åˆ«åˆ†æ"],"title":"çº¿æ€§åˆ¤åˆ«åˆ†æ","uri":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ€»ç»“ LDAæ˜¯ä¸€ç§ç›‘ç£å­¦ä¹ çš„é™ç»´æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„æ•°æ®é›†çš„æ¯ä¸ªæ ·æœ¬æ˜¯æœ‰ç±»åˆ«è¾“å‡ºçš„ã€‚è¿™ç‚¹å’ŒPCAä¸åŒã€‚PCAæ˜¯ä¸è€ƒè™‘æ ·æœ¬ç±»åˆ«è¾“å‡ºçš„æ— ç›‘ç£é™ç»´æŠ€æœ¯ã€‚LDAçš„æ€æƒ³å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼Œå°±æ˜¯â€œæŠ•å½±åç±»å†…æ–¹å·®æœ€å°ï¼Œç±»é—´æ–¹å·®æœ€å¤§â€ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æˆ‘ä»¬è¦å°†æ•°æ®åœ¨ä½ç»´åº¦ä¸Šè¿›è¡ŒæŠ•å½±ï¼ŒæŠ•å½±åå¸Œæœ›æ¯ä¸€ç§ç±»åˆ«æ•°æ®çš„æŠ•å½±ç‚¹å°½å¯èƒ½çš„æ¥è¿‘ï¼Œè€Œä¸åŒç±»åˆ«çš„æ•°æ®çš„ç±»åˆ«ä¸­å¿ƒä¹‹é—´çš„è·ç¦»å°½å¯èƒ½çš„å¤§ã€‚ å®é™…ä¸ŠLDAé™¤äº†å¯ä»¥ç”¨äºé™ç»´ä»¥å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ†ç±»ã€‚ä¸€ä¸ªå¸¸è§çš„LDAåˆ†ç±»åŸºæœ¬æ€æƒ³æ˜¯å‡è®¾å„ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°æ®ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œè¿™æ ·åˆ©ç”¨LDAè¿›è¡ŒæŠ•å½±åï¼Œå¯ä»¥åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡è®¡ç®—å„ä¸ªç±»åˆ«æŠ•å½±æ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼Œè¿›è€Œå¾—åˆ°è¯¥ç±»åˆ«é«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚å½“ä¸€ä¸ªæ–°çš„æ ·æœ¬åˆ°æ¥åï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæŠ•å½±ï¼Œç„¶åå°†æŠ•å½±åçš„æ ·æœ¬ç‰¹å¾åˆ†åˆ«å¸¦å…¥å„ä¸ªç±»åˆ«çš„é«˜æ–¯åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œè®¡ç®—å®ƒå±äºè¿™ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œæœ€å¤§çš„æ¦‚ç‡å¯¹åº”çš„ç±»åˆ«å³ä¸ºé¢„æµ‹ç±»åˆ«ã€‚ LDAç”¨äºé™ç»´ï¼Œå’ŒPCAæœ‰å¾ˆå¤šç›¸åŒï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„åœ°æ–¹ï¼Œå› æ­¤å€¼å¾—å¥½å¥½çš„æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…çš„é™ç»´å¼‚åŒç‚¹ã€‚ é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹ç›¸åŒç‚¹ï¼š 1ï¼‰ä¸¤è€…å‡å¯ä»¥å¯¹æ•°æ®è¿›è¡Œé™ç»´ã€‚ 2ï¼‰ä¸¤è€…åœ¨é™ç»´æ—¶å‡ä½¿ç”¨äº†çŸ©é˜µç‰¹å¾åˆ†è§£çš„æ€æƒ³ã€‚ 3ï¼‰ä¸¤è€…éƒ½å‡è®¾æ•°æ®ç¬¦åˆé«˜æ–¯åˆ†å¸ƒã€‚ æˆ‘ä»¬æ¥ç€çœ‹çœ‹ä¸åŒç‚¹ï¼š 1ï¼‰LDAæ˜¯æœ‰ç›‘ç£çš„é™ç»´æ–¹æ³•ï¼Œè€ŒPCAæ˜¯æ— ç›‘ç£çš„é™ç»´æ–¹æ³• 2ï¼‰LDAé™ç»´æœ€å¤šé™åˆ°ç±»åˆ«æ•°k-1çš„ç»´æ•°ï¼Œè€ŒPCAæ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ 3ï¼‰LDAé™¤äº†å¯ä»¥ç”¨äºé™ç»´ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ†ç±»ã€‚ 4ï¼‰LDAé€‰æ‹©åˆ†ç±»æ€§èƒ½æœ€å¥½çš„æŠ•å½±æ–¹å‘ï¼Œè€ŒPCAé€‰æ‹©æ ·æœ¬ç‚¹æŠ•å½±å…·æœ‰æœ€å¤§æ–¹å·®çš„æ–¹å‘ã€‚ ","date":"2022-02-19","objectID":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","çº¿æ€§åˆ¤åˆ«åˆ†æ"],"title":"çº¿æ€§åˆ¤åˆ«åˆ†æ","uri":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä»£ç  mean_list = [] for i in range(2): mean_list.append(np.mean(X_train[y_train==i], axis=0)) mean_list = np.array(mean_list) S_W = np.zeros((X_train.shape[1], X_train.shape[1])) # ç±»å†…æ•£åº¦çŸ©é˜µ for c, mv in zip(range(2), mean_list): class_scatter = np.zeros((X_train.shape[1], X_train.shape[1])) for row in X_train[y_train==c]: row, mv = row.reshape(X_train.shape[1], -1), mv.reshape(X_train.shape[1], -1) class_scatter += (row-mv).dot((row-mv).T) S_W += class_scatter over_all_mean = np.mean(X_train, axis=0) S_B = np.zeros((X_train.shape[1], X_train.shape[1])) # ç±»é—´æ•£åº¦çŸ©é˜µ for i, mean_vec in enumerate(mean_list): n = X_train[y_train==i, :].shape[0] mean_list_temp = mean_list[i, :].reshape(1, -1) over_all_mean = over_all_mean.reshape(X_train.shape[1], 1) S_B += n*(mean_vec-over_all_mean).dot((mean_vec-over_all_mean).T) eig_vals, eig_vecs = np.linalg.eig(np.linalg.inv(S_W).dot(S_B)) eig_pairs = [(np.abs(eig_vals[i]), eig_vecs[:, i]) for i in range(len(eig_vals))] eig_pairs = sorted(eig_pairs, key=lambda k: k[0], reverse=True) # eigv_sum = sum(eig_vals) # for i, j in enumerate(eig_pairs): # print('eigenvalue {0:}: {1:.2%}'.format(i + 1, (j[0] / eigv_sum).real)) # æ ¹æ®ç™¾åˆ†æ¯”æ˜¾ç¤ºç‰¹å¾å€¼ï¼Œä»è€Œé€‰å–æœ€å¤§çš„nä¸ªç‰¹å¾å€¼ W = np.hstack((eig_pairs[0][1].reshape(X_train.shape[1], 1), eig_pairs[1][1].reshape(X_train.shape[1], 1))) ","date":"2022-02-19","objectID":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","çº¿æ€§åˆ¤åˆ«åˆ†æ"],"title":"çº¿æ€§åˆ¤åˆ«åˆ†æ","uri":"/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ¡ä»¶æ¦‚ç‡ \\(P(B|A) = \\frac{P(AB)}{P(A)}\\) ","date":"2022-02-16","objectID":"/bayes/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä¹˜æ³•æ³•åˆ™ å¦‚æœP(A) \u003e 0 \\(P(AB) = P(A)P(B|A)\\) å¦‚æœ\\(P(A_1 \\dots A_{n-1})\\) \u003e 0 åˆ™ \\[ \\begin{aligned} P(A_1A_2\\dots A_n) = P(A_1A_2\\dots A_{n-1})P(A_n | A_1A_2\\dots A_{n-1}) \\\\\\\\ = P(A_1)P(A_2|A_1)P(A_3|A_1A_2)\\dots P(A_n|A_1A_2\\dots A_{n-1}) \\end{aligned} \\] å…¶ä¸­ç¬¬ä¸€æ­¥ä½¿ç”¨äº†ä¹˜æ³•å…¬å¼ï¼Œç„¶åå†å¯¹å‰è€…ç»§ç»­ä½¿ç”¨ä¹˜æ³•å…¬å¼ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€åçš„ç»“æœã€‚ ","date":"2022-02-16","objectID":"/bayes/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å…¨æ¦‚ç‡å…¬å¼(åŠ æ³•æ³•åˆ™) \\[ P(A) = \\sum_{i=1}^n P(B_i)P(A\\lvert B_i) = \\sum_{i=1}^n P(AB_i) \\] å¦‚æœæ˜¯è¿ç»­å˜é‡åˆ™ä¸º \\[ P(A) = \\int P(A,B) \\, dB \\] ï¼ˆåŠ æ³•è§„åˆ™ä¸ä¹˜æ³•è§„åˆ™ç»“åˆæ˜¯ä¸€äº›æ¨å¯¼çš„åŸºç¡€ï¼Œæ³¨æ„è¿ç»­ä¸­çš„ç§¯åˆ†ç­‰åŒäºç¦»æ•£ä¸­çš„è¿åŠ ï¼‰ ç‰¹ä¾‹ä¸º: \\[ P(A)=P(A\\lvert B)P(B) + P(A\\lvert \\bar{B})P(\\bar{B}) \\] å…¨æ¦‚ç‡å…¬å¼çš„æ„ä¹‰ï¼š å°†å¤æ‚çš„äº‹ä»¶Aåˆ’åˆ†ä¸ºè¾ƒä¸ºç®€å•çš„äº‹ä»¶ \\[ AB_1,AB_2,\\ldots,AB_n \\] å†ç»“åˆåŠ æ³•å…¬å¼å’Œä¹˜æ³•å…¬å¼è®¡ç®—å‡ºAçš„æ¦‚ç‡ ## è´å¶æ–¯å…¬å¼ å…ˆå¼•å…¥ä¸€ä¸ªå°ä¾‹å­ã€‚ \\[ P(X=ç©LOL)=0.6;\\\\\\\\ P(X=ä¸ç©LOL)=0.4 \\] è¿™ä¸ªæ¦‚ç‡æ˜¯æ ¹æ®ç»Ÿè®¡å¾—åˆ°æˆ–è€…æ ¹æ®è‡ªèº«ç»éªŒç»™å‡ºçš„ä¸€ä¸ªæ¦‚ç‡å€¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå…ˆéªŒæ¦‚ç‡(prior probability) æ­¤å¤– \\[ P(Y=ç”·æ€§\\lvert X=ç©LOL)=0.8,\\quad P(Y=å°å§å§\\vert X=ç©LOL)=0.2\\\\\\\\ P(Y=ç”·æ€§\\lvert X=ä¸ç©LOL)=0.2ï¼Œ\\quad P(Y=å°å§å§\\vert X=ä¸ç©LOL)=0.8 \\] æ±‚åœ¨å·²çŸ¥ç©å®¶ä¸ºç”·æ€§çš„æƒ…å†µä¸‹ï¼Œä»–æ˜¯LOLç©å®¶çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼š æ ¹æ®è´å¶æ–¯å‡†åˆ™ \\[ P(X=ç©LOL\\lvert Y=ç”·æ€§)=P(Y=ç”·æ€§\\lvert X=ç©LOL)\\frac{P(X=ç©LOL)}{[P(Y=ç”·æ€§\\lvert X=ç©LOL)P(X=ç©LOL)+P(Y=ç”·æ€§\\lvert X=ä¸ç©LOL)]P(X=ä¸ç©LOL)} \\] åˆ†æ¯ä¸ºå…¨æ¦‚ç‡å…¬å¼ ä¸‹é¢æ˜¯è´å¶æ–¯å…¬å¼çš„æ¨å¯¼ã€‚ \\[ P(B\\lvert A)=\\frac{P(AB)}{P(A)}=\\frac{P(BA)}{P(A)}\\iff \\frac{P(B)P(A\\lvert B)}{\\displaystyle \\sum_{j=1}^n P(B_j)P(A\\lvert B_j)} \\] è´å¶æ–¯å…¬å¼çš„æ„ä¹‰ï¼š åœ¨äº‹ä»¶Aå·²ç»å‘ç”Ÿçš„æ¡ä»¶ä¸‹ï¼Œè´å¶æ–¯å…¬å¼å¯ç”¨æ¥å¯»æ‰¾å¯¼è‡´Aå‘ç”Ÿå„ç§â€œåŸå› â€Biçš„æ¦‚ç‡ã€‚ å¯¹äºå…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡æ¥è¯´ï¼Œ \\[ \\begin{aligned} P(B\\lvert A)ä¸ºåéªŒæ¦‚ç‡ \\\\\\\\ P(B)å’ŒP(A)ä¸ºå…ˆéªŒæ¦‚ç‡ \\\\\\\\ P(A\\vert B)ä¸ºå¯èƒ½æ€§ \\end{aligned} \\] ","date":"2022-02-16","objectID":"/bayes/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä»‹ç» æœ´ç´ è´å¶æ–¯å±äºç”Ÿæˆå¼æ¨¡å‹ï¼Œ å…¶ä¸»è¦ç”¨äºåˆ†ç±»ï¼Œå±äºæ˜¯æœ€ç®€å•çš„æ¦‚ç‡å›¾æ¨¡å‹ï¼Œä¸»è¦ç”¨åˆ°æ¦‚ç‡è®ºä¸­å­¦åˆ°çš„è´å¶æ–¯å…¬å¼ï¼Œå…¶ä¸­éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œå‡è®¾ï¼Œå³è´å¶æ–¯å‡è®¾ã€‚ ","date":"2022-02-16","objectID":"/bayes/:4:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"è´å¶æ–¯å‡è®¾ æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾(æœ€ç®€å•çš„æ¦‚ç‡å›¾æ¨¡å‹(æœ‰å‘å›¾))ï¼Œç›®çš„æ˜¯ç®€åŒ–è®¡ç®— ","date":"2022-02-16","objectID":"/bayes/:5:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ¨å¯¼ å¯¹äºæ•°æ®é›†\\(\\\\{(x_i, y_i)\\\\}^N_{i=1}\\)ï¼Œ\\(x_i \\in R^p , \\quad y_i \\in \\\\{ 0, 1\\\\}\\) \\[ \\begin{aligned} \\hat{y} \u0026= \\arg \\max(y|X) \\\\\\\\ \u0026 = \\arg \\max\\frac{P(X,y)}{P(X)} \\\\\\\\ \u0026 = \\arg \\max\\frac{P(y)P(X|y)}{P(X)} \\\\\\\\ \u0026 = \\arg \\max(y) P(X|y) \\\\\\\\ \u0026 = \\arg \\max(y)P(x_1,x_2,\\dots x_p| y) \\end{aligned} \\] å…¶ä¸­ç”±äºæˆ‘ä»¬çš„æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ï¼Œå› æ­¤\\(P(X|y)\\)å¯ä»¥å†™ä¸º\\(\\prod_{j=1}^pP(x_j|y)\\) å³æœ€ç»ˆçš„å¼å­å°±æ˜¯ \\[ \\hat{y} = \\arg \\max(y)\\prod_{j=1}^p P(x_j|y) \\] è¿™å°±æ˜¯æœ´ç´ è´å¶æ–¯çš„ä¸»è¦æ¨å¯¼ã€‚ æ³¨æ„æœ¯è¯­ï¼š \\(P(y)\\)ä¸ºå…ˆéªŒæ¦‚ç‡ \\(P(y|X)\\)ä¸ºåéªŒæ¦‚ç‡ \\(P(X,y)\\)ä¸ºè”åˆæ¦‚ç‡ MAPï¼Œå³æœ€å¤§åéªŒä¼°è®¡ï¼Œé€‰æ‹©æœ‰æœ€é«˜åéªŒæ¦‚ç‡çš„ç±»ã€‚ ","date":"2022-02-16","objectID":"/bayes/:6:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"åéªŒæ¦‚ç‡æœ€å¤§åŒ–çš„å«ä¹‰ ï¼ˆæ¥è‡ªæèˆªã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹,æ¯”è¥¿ç“œä¹¦ä¸Šçš„æ›´å®¹æ˜“ç†è§£ï¼‰ ","date":"2022-02-16","objectID":"/bayes/:7:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æå¤§ä¼¼ç„¶ä¼°è®¡ åœ¨æœ´ç´ è´å¶æ–¯æ³•ä¸­, å­¦ä¹ æ„å‘³ç€ä¼°è®¡ \\(P\\left(Y=c_{k}\\right)\\) å’Œ \\(P\\left(X^{(j)}=x^{(j)} \\mid Y=c_{k}\\right)\\) ã€‚å¯ä»¥ åº”ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ³•ä¼°è®¡ç›¸åº”çš„æ¦‚ç‡ã€‚å…ˆéªŒæ¦‚ç‡ \\(P\\left(Y=c_{k}\\right)\\) çš„æå¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ \\[ P\\left(Y=c_{k}\\right)=\\frac{\\sum_{i=1}^{N} I\\left(y_{i}=c_{k}\\right)}{N}, \\quad k=1,2, \\cdots, K \\] è®¾ç¬¬ \\(j\\) ä¸ªç‰¹å¾ \\(x^{(j)}\\) å¯èƒ½å–å€¼çš„é›†åˆä¸º \\(\\left\\{a_{j 1}, a_{j 2}, \\cdots, a_{j S_{j}}\\right\\}\\), æ¡ä»¶æ¦‚ç‡ \\(P\\left(X^{(j)}=a_{j l} \\mid Y=\\right.\\) \\(c_{k}\\) ) çš„æå¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ \\[ \\begin{aligned} \u0026P\\left(X^{(j)}=a_{j l} \\mid Y=c_{k}\\right)=\\frac{\\sum_{i=1}^{N} I\\left(x_{i}^{(j)}=a_{j l}, y_{i}=c_{k}\\right)}{\\sum_{i=1}^{N} I\\left(y_{i}=c_{k}\\right)} \\\\\\\\ \u0026j=1,2, \\cdots, n ; \\quad l=1,2, \\cdots, S_{j} ; \\quad k=1,2, \\cdots, K \\end{aligned} \\] å¼ä¸­, \\(x_{i}^{(j)}\\) æ˜¯ç¬¬ \\(i\\) ä¸ªæ ·æœ¬çš„ç¬¬ \\(j\\) ä¸ªç‰¹å¾; \\(a_{j l}\\) æ˜¯ç¬¬ \\(j\\) ä¸ªç‰¹å¾å¯èƒ½å–çš„ç¬¬ \\(l\\) ä¸ªå€¼; \\(I\\) ä¸ºæŒ‡ ç¤ºå‡½æ•°ã€‚ \\(S_j\\)ä¸º\\(x^{(j)}\\)çš„å¯èƒ½å–å€¼æ•°ï¼Œ\\(K\\)ä¸ºç±»åˆ«æ•°ã€‚ ","date":"2022-02-16","objectID":"/bayes/:8:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å¯èƒ½ä¼šå‡ºç°æ‰€è¦ä¼°è®¡çš„æ¦‚ç‡å€¼ä¸º 0 çš„æƒ…å†µã€‚è¿™æ—¶ä¼šå½±å“åˆ°åéªŒæ¦‚ ç‡çš„è®¡ç®—ç»“æœ, ä½¿åˆ†ç±»äº§ç”Ÿåå·®ã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ–¹æ³•æ˜¯é‡‡ç”¨è´å¶æ–¯ä¼°è®¡ã€‚å…·ä½“åœ°, æ¡ ä»¶æ¦‚ç‡çš„è´å¶æ–¯ä¼°è®¡æ˜¯ \\[ P_{\\lambda}\\left(X^{(j)}=a_{j l} \\mid Y=c_{k}\\right)=\\frac{\\sum_{i=1}^{N} I\\left(x_{i}^{(j)}=a_{j l}, y_{i}=c_{k}\\right)+\\lambda}{\\sum_{i=1}^{N} I\\left(y_{i}=c_{k}\\right)+S_{j} \\lambda} \\] å¼ä¸­ \\(\\lambda \\geqslant 0\\) ã€‚ç­‰ä»·äºåœ¨éšæœºå˜é‡å„ä¸ªå–å€¼çš„é¢‘æ•°ä¸Šèµ‹äºˆä¸€ä¸ªæ­£æ•° \\(\\lambda\u003e0\\) ã€‚å½“ \\(\\lambda=0\\) æ—¶å°± æ˜¯æå¤§ä¼¼ç„¶ä¼°è®¡ã€‚å¸¸å– \\(\\lambda=1\\), è¿™æ—¶ç§°ä¸ºæ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ (Laplacian smoothing)ã€‚æ˜¾ç„¶, å¯¹ä»»ä½• \\(l=1,2, \\cdots, S_{j}, k=1,2, \\cdots, K\\), æœ‰ \\[ \\begin{aligned} \u0026P_{\\lambda}\\left(X^{(j)}=a_{j l} \\mid Y=c_{k}\\right)\u003e0 \\\\\\\\ \u0026\\sum_{l=1}^{S_{j}} P\\left(X^{(j)}=a_{j l} \\mid Y=c_{k}\\right)=1 \\end{aligned} \\] åŒæ ·, å…ˆéªŒæ¦‚ç‡çš„è´å¶æ–¯ä¼°è®¡æ˜¯ \\[ P_{\\lambda}\\left(Y=c_{k}\\right)=\\frac{\\sum_{i=1}^{N} I\\left(y_{i}=c_{k}\\right)+\\lambda}{N+K \\lambda} \\] ","date":"2022-02-16","objectID":"/bayes/:9:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ–‡æœ¬åˆ†ç±» æ¥ä¸‹æ¥æ˜¯æœ´ç´ è´å¶æ–¯åœ¨æ–‡æœ¬åˆ†ç±»ä¸­çš„è¿ç”¨ï¼Œè¿™é‡Œä»¥ç®€å•çš„äºŒåˆ†ç±»é—®é¢˜ï¼Œæƒ…æ„Ÿåˆ†æä¸ºä¾‹ã€‚ ","date":"2022-02-16","objectID":"/bayes/:10:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å¦‚ä½•å®šä¹‰å‡ ä¸ªæ¦‚ç‡ï¼Ÿ \\(P(y=k)\\)å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œå¯ä»¥åªè¯„ä¼°å¸¦æœ‰æ ‡ç­¾kçš„æ–‡æ¡£æ¯”ä¾‹ï¼Œå³ \\[ P(y=k) = \\frac{N(y=k)}{\\sum_iN(y=i)} \\] \\(P(x|y=k)= P(x_1,x_2,\\dots, x_n | y=k)\\) è¿™é‡Œå‡è®¾æ–‡æ¡£xè¢«è¡¨ç¤ºä¸ºä¸€ç»„ç‰¹å¾ï¼Œä¾‹å¦‚ä¸€ç»„å®ƒçš„è¯\\((x_1,x_2,\\dots, x_n)\\) è¿™é‡Œéœ€è¦ä¸¤ä¸ªå‡è®¾ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ä¸Šé¢æåˆ°çš„è´å¶æ–¯å‡è®¾ï¼Œå³ï¼š - æ¡ä»¶ç‹¬ç«‹å‡è®¾ï¼šç‰¹å¾åœ¨ç»™å®šç±»çš„æƒ…å†µä¸‹æ˜¯ç‹¬ç«‹çš„ - Bag of Wordså‡è®¾ï¼šè¯åºæ— å…³ç´§è¦ ç›´è§‚åœ°è¯´ï¼Œå‡è®¾ æ¯ä¸ªå•è¯å‡ºç°åœ¨ç±»åˆ«ä¸ºkçš„æ–‡æ¡£ä¸­çš„æ¦‚ç‡ä¸ä¾èµ–ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¾—åˆ°ï¼š \\[ P(x|y=k) = P(x_1,x_2,\\dots,x_n|y=k) = \\prod_{t=1}^nP(x_t|y=k) \\] æ¦‚ç‡\\(P(x_i|y=k)\\)ä¸ºå•è¯\\(x_i\\)å‡ºç°åœ¨æ ‡ç­¾ä¸ºkçš„æ–‡æ¡£ä¸­çš„é¢‘ç‡ï¼Œå³ \\[ P(x_i|y=k) = \\frac{N(x_i, y=k)}{\\sum_{t=1}^{|V|}N(x_t,y=k)} \\] ä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç°\\(N(x_i, y=k)=0\\)çš„æƒ…å†µ è¿™æ—¶å°±éœ€è¦æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ï¼Œå³åœ¨æ‰€æœ‰çš„è®¡æ•°ä¸­éƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„å‚æ•°\\(\\delta\\)ï¼Œ \\[ P(x_i|y=k)=\\frac{ {\\delta} + N(x_i, y=k) }{\\sum\\limits_{t=1}^{|V|}( {\\delta} + N(x_t, y=k))} = \\frac{ {\\delta} + N(x_i, y=k) }{ {\\delta\\cdot |V|} + \\sum\\limits_{t=1}^{|V|} N(x_t, y=k)} , \\] ç›´è§‚åœ°è¯´ï¼Œæœ´ç´ è´å¶æ–¯æœŸæœ›æŸäº›è¯ä½œä¸ºç±»æŒ‡ç¤ºç¬¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæƒ…æ„Ÿåˆ†ç±»æ ‡è®°Â awesomeã€Â brilliantã€Â greatÂ å°†æœ‰æ›´é«˜çš„æ¦‚ç‡ç»™å®šæ­£é¢ç±»åˆ«ç„¶åè´Ÿé¢ç±»åˆ«ã€‚Â ç±»ä¼¼åœ°ï¼Œç»™å®šè´Ÿç±»æ¯”æ­£ç±»Â ï¼Œæ ‡è®°awful,Â boring,Â badçš„æ¦‚ç‡æ›´é«˜ã€‚ åœ¨å®è·µä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯å–logï¼Œå•è°ƒæ€§ä¸å˜ï¼Œå˜ä¸º\\(\\log(x, y=k) = \\log P(y=k) + \\sum \\log P(x_i|y=k)\\) ","date":"2022-02-16","objectID":"/bayes/:10:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"è¡¥å……ï¼šè´å¶æ–¯ä¼°è®¡ æ˜“çŸ¥\\(P(\\theta \\mid D)\\)ç§°ä¸ºåéªŒæ¦‚ç‡ï¼Œæœ‰ä¸‰ç§ä¼°è®¡\\(\\theta\\)çš„æ–¹æ³•ï¼š ä½¿ç”¨åéªŒåˆ†å¸ƒçš„å¯†åº¦å‡½æ•°æœ€å¤§å€¼ç‚¹ä½œä¸º\\(\\theta\\)çš„ç‚¹ä¼°è®¡çš„æœ€å¤§åéªŒä¼°è®¡ï¼ˆMAPï¼‰ã€‚ ä½¿ç”¨åéªŒåˆ†å¸ƒçš„ä¸­ä½æ•°ä½œä¸º\\(\\theta\\)çš„ç‚¹ä¼°è®¡çš„åéªŒä¸­ä½æ•°ä¼°è®¡ï¼ˆä¸å¸¸ç”¨ï¼‰ã€‚ ä½¿ç”¨åéªŒåˆ†å¸ƒçš„å‡å€¼ä½œä¸º\\(\\theta\\)çš„ç‚¹ä¼°è®¡çš„åéªŒæœŸæœ›ä¼°è®¡ã€‚ å…¶ä¸­åéªŒæœŸæœ›ä¼°è®¡ä¹Ÿå°±æ˜¯è´å¶æ–¯ä¼°è®¡ã€‚ è´å¶æ–¯ä¼°è®¡æ˜¯åœ¨MAPä¸Šåšè¿›ä¸€æ­¥æ‹“å±•ï¼Œä¸ç›´æ¥ä¼°è®¡å‚æ•°çš„å€¼ï¼Œè€Œæ˜¯å…è®¸å‚æ•°æœä»ä¸€å®šçš„æ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼Œå…ˆæ±‚å‡º\\(\\theta\\)çš„åéªŒåˆ†å¸ƒ\\(p(\\theta \\mid x)\\)ï¼Œç„¶åæ±‚å‡º\\(\\theta\\)çš„æœŸæœ›å€¼ã€‚ ","date":"2022-02-16","objectID":"/bayes/:11:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","bayes"],"title":"bayes","uri":"/bayes/"},{"categories":["pandas","api"],"content":"æ­£ä¸ºé€†æ—¶é’ˆè½¬ï¼Œè´Ÿä¸ºé¡ºæ—¶é’ˆè½¬ã€‚ import numpy as np mat = np.array([[1,3,5], [2,4,6], [7,8,9] ]) print mat, \"# orignal\" mat90 = np.rot90(mat, 1) print mat90, \"# rorate 90 \u003cleft\u003e anti-clockwise\" mat90 = np.rot90(mat, -1) print mat90, \"# rorate 90 \u003cright\u003e clockwise\" mat180 = np.rot90(mat, 2) print mat180, \"# rorate 180 \u003cleft\u003e anti-clockwise\" mat270 = np.rot90(mat, 3) print mat270, \"# rorate 270 \u003cleft\u003e anti-clockwise\" ç›´æ¥å¤åˆ¶çš„ä»£ç ï¼Œpython2ï¼Œèƒ½çœ‹æ‡‚å°±è¡Œã€‚ ","date":"2022-02-12","objectID":"/rot90/:0:0","tags":["pandas","api","rot90"],"title":"rot90","uri":"/rot90/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"æ•°æ®æŒ–æ˜æ¯”èµ› ","date":"2022-01-26","objectID":"/eda/:0:0","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"å¯¹èµ›é¢˜è¿›è¡Œç†è§£ ","date":"2022-01-26","objectID":"/eda/:1:0","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"æ•°æ®åˆ†æ ","date":"2022-01-26","objectID":"/eda/:2:0","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"EDAç›®æ ‡ EDAçš„ä»·å€¼åœ¨äºç†Ÿæ‚‰æ•°æ®é›†ï¼Œäº†è§£æ•°æ®é›†ï¼Œå¯¹æ•°æ®é›†è¿›è¡ŒéªŒè¯æ¥ç¡®å®šæ‰€è·å¾—æ•°æ®é›†å¯ä»¥ç”¨äºæ¥ä¸‹æ¥çš„æœºå™¨å­¦ä¹ æˆ–è€…æ·±åº¦å­¦ä¹ ä½¿ç”¨ã€‚ å½“äº†è§£äº†æ•°æ®é›†ä¹‹åæˆ‘ä»¬ä¸‹ä¸€æ­¥å°±æ˜¯è¦å»äº†è§£å˜é‡é—´çš„ç›¸äº’å…³ç³»ä»¥åŠå˜é‡ä¸é¢„æµ‹å€¼ä¹‹é—´çš„å­˜åœ¨å…³ç³»ã€‚ å¼•å¯¼æ•°æ®ç§‘å­¦ä»ä¸šè€…è¿›è¡Œæ•°æ®å¤„ç†ä»¥åŠç‰¹å¾å·¥ç¨‹çš„æ­¥éª¤,ä½¿æ•°æ®é›†çš„ç»“æ„å’Œç‰¹å¾é›†è®©æ¥ä¸‹æ¥çš„é¢„æµ‹é—®é¢˜æ›´åŠ å¯é ã€‚ å®Œæˆå¯¹äºæ•°æ®çš„æ¢ç´¢æ€§åˆ†æï¼Œå¹¶å¯¹äºæ•°æ®è¿›è¡Œä¸€äº›å›¾è¡¨æˆ–è€…æ–‡å­—æ€»ç»“å¹¶æ‰“å¡ã€‚ ","date":"2022-01-26","objectID":"/eda/:2:1","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"ä¸»è¦æ“ä½œ è½½å…¥å„ç§æ•°æ®ç§‘å­¦ä»¥åŠå¯è§†åŒ–åº“: æ•°æ®ç§‘å­¦åº“ pandasã€numpyã€scipyï¼› å¯è§†åŒ–åº“ matplotlibã€seabonï¼› å…¶ä»–ï¼› è½½å…¥æ•°æ®ï¼š è½½å…¥è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼› ç®€ç•¥è§‚å¯Ÿæ•°æ®(head()+shape)ï¼› æ•°æ®æ€»è§ˆ: é€šè¿‡describe()æ¥ç†Ÿæ‚‰æ•°æ®çš„ç›¸å…³ç»Ÿè®¡é‡ é€šè¿‡info()æ¥ç†Ÿæ‚‰æ•°æ®ç±»å‹ åˆ¤æ–­æ•°æ®ç¼ºå¤±å’Œå¼‚å¸¸ æŸ¥çœ‹æ¯åˆ—çš„å­˜åœ¨nanæƒ…å†µ å¼‚å¸¸å€¼æ£€æµ‹ äº†è§£é¢„æµ‹å€¼çš„åˆ†å¸ƒ æ€»ä½“åˆ†å¸ƒæ¦‚å†µï¼ˆæ— ç•Œçº¦ç¿°é€Šåˆ†å¸ƒç­‰ï¼‰ æŸ¥çœ‹skewness and kurtosis æŸ¥çœ‹é¢„æµ‹å€¼çš„å…·ä½“é¢‘æ•° ç‰¹å¾åˆ†ä¸ºç±»åˆ«ç‰¹å¾å’Œæ•°å­—ç‰¹å¾ï¼Œå¹¶å¯¹ç±»åˆ«ç‰¹å¾æŸ¥çœ‹uniqueåˆ†å¸ƒ æ•°å­—ç‰¹å¾åˆ†æ ç›¸å…³æ€§åˆ†æ æŸ¥çœ‹å‡ ä¸ªç‰¹å¾å¾— ååº¦å’Œå³°å€¼ æ¯ä¸ªæ•°å­—ç‰¹å¾å¾—åˆ†å¸ƒå¯è§†åŒ– æ•°å­—ç‰¹å¾ç›¸äº’ä¹‹é—´çš„å…³ç³»å¯è§†åŒ– å¤šå˜é‡äº’ç›¸å›å½’å…³ç³»å¯è§†åŒ– ç±»å‹ç‰¹å¾åˆ†æ uniqueåˆ†å¸ƒ ç±»åˆ«ç‰¹å¾ç®±å½¢å›¾å¯è§†åŒ– ç±»åˆ«ç‰¹å¾çš„å°æç´å›¾å¯è§†åŒ– ç±»åˆ«ç‰¹å¾çš„æŸ±å½¢å›¾å¯è§†åŒ–ç±»åˆ« ç‰¹å¾çš„æ¯ä¸ªç±»åˆ«é¢‘æ•°å¯è§†åŒ–(count_plot) ç”¨pandas_profilingç”Ÿæˆæ•°æ®æŠ¥å‘Š ","date":"2022-01-26","objectID":"/eda/:2:2","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"ä¸»è¦æ­¥éª¤ å¯¹äºæ•°æ®çš„åˆæ­¥åˆ†æï¼ˆç›´æ¥æŸ¥çœ‹æ•°æ®ï¼Œæˆ–.sum(), .mean()ï¼Œ.descirbe()ç­‰ç»Ÿè®¡å‡½æ•°ï¼‰å¯ä»¥ä»ï¼šæ ·æœ¬æ•°é‡ï¼Œè®­ç»ƒé›†æ•°é‡ï¼Œæ˜¯å¦æœ‰æ—¶é—´ç‰¹å¾ï¼Œæ˜¯å¦æ˜¯æ—¶è®¸é—®é¢˜ï¼Œç‰¹å¾æ‰€è¡¨ç¤ºçš„å«ä¹‰ï¼ˆéåŒ¿åç‰¹å¾ï¼‰ï¼Œç‰¹å¾ç±»å‹ï¼ˆå­—ç¬¦ç±»ä¼¼ï¼Œintï¼Œfloatï¼Œtimeï¼‰ï¼Œç‰¹å¾çš„ç¼ºå¤±æƒ…å†µï¼ˆæ³¨æ„ç¼ºå¤±çš„åœ¨æ•°æ®ä¸­çš„è¡¨ç°å½¢å¼ï¼Œæœ‰äº›æ˜¯ç©ºçš„æœ‰äº›æ˜¯â€NANâ€ç¬¦å·ç­‰ï¼‰ï¼Œç‰¹å¾çš„å‡å€¼æ–¹å·®æƒ…å†µã€‚ åˆ†æè®°å½•æŸäº›ç‰¹å¾å€¼ç¼ºå¤±å æ¯”30%ä»¥ä¸Šæ ·æœ¬çš„ç¼ºå¤±å¤„ç†ï¼Œæœ‰åŠ©äºåç»­çš„æ¨¡å‹éªŒè¯å’Œè°ƒèŠ‚ï¼Œåˆ†æç‰¹å¾åº”è¯¥æ˜¯å¡«å……ï¼ˆå¡«å……æ–¹å¼æ˜¯ä»€ä¹ˆï¼Œå‡å€¼å¡«å……ï¼Œ0å¡«å……ï¼Œä¼—æ•°å¡«å……ç­‰ï¼‰ï¼Œè¿˜æ˜¯èˆå»ï¼Œè¿˜æ˜¯å…ˆåšæ ·æœ¬åˆ†ç±»ç”¨ä¸åŒçš„ç‰¹å¾æ¨¡å‹å»é¢„æµ‹ã€‚ å¯¹äºå¼‚å¸¸å€¼åšä¸“é—¨çš„åˆ†æï¼Œåˆ†æç‰¹å¾å¼‚å¸¸çš„labelæ˜¯å¦ä¸ºå¼‚å¸¸å€¼ï¼ˆæˆ–è€…åç¦»å‡å€¼è¾ƒè¿œæˆ–è€…äº‹ç‰¹æ®Šç¬¦å·ï¼‰,å¼‚å¸¸å€¼æ˜¯å¦åº”è¯¥å‰”é™¤ï¼Œè¿˜æ˜¯ç”¨æ­£å¸¸å€¼å¡«å……ï¼Œæ˜¯è®°å½•å¼‚å¸¸ï¼Œè¿˜æ˜¯æœºå™¨æœ¬èº«å¼‚å¸¸ç­‰ã€‚ å¯¹äºLabelåšä¸“é—¨çš„åˆ†æï¼Œåˆ†ææ ‡ç­¾çš„åˆ†å¸ƒæƒ…å†µç­‰ã€‚ è¿›æ­¥åˆ†æå¯ä»¥é€šè¿‡å¯¹ç‰¹å¾ä½œå›¾ï¼Œç‰¹å¾å’Œlabelè”åˆåšå›¾ï¼ˆç»Ÿè®¡å›¾ï¼Œç¦»æ•£å›¾ï¼‰ï¼Œç›´è§‚äº†è§£ç‰¹å¾çš„åˆ†å¸ƒæƒ…å†µï¼Œé€šè¿‡è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥å‘ç°æ•°æ®ä¹‹ä¸­çš„ä¸€äº›å¼‚å¸¸å€¼ç­‰ï¼Œé€šè¿‡ç®±å‹å›¾åˆ†æä¸€äº›ç‰¹å¾å€¼çš„åç¦»æƒ…å†µï¼Œå¯¹äºç‰¹å¾å’Œç‰¹å¾è”åˆä½œå›¾ï¼Œå¯¹äºç‰¹å¾å’Œlabelè”åˆä½œå›¾ï¼Œåˆ†æå…¶ä¸­çš„ä¸€äº›å…³è”æ€§ã€‚ è®°å½•è‡ªå·±ä¹‹å‰æ²¡ç”¨åˆ°çš„ä¸œè¥¿ ### æ•°æ®çš„ååº¦å’Œå³°åº¦ - æ•°æ®çš„ååº¦(skewness)ï¼šdataframe.skew() - æ•°æ®çš„å³°åº¦(kurtosis)ï¼šdataframe.kurt() ### logå˜æ¢ ä¸€èˆ¬è¦æ±‚é¢„æµ‹å€¼éœ€è¦ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œå› æ­¤éœ€è¦å…ˆlogå˜æ¢ä¸€ä¸‹ ### sns.pairplot ç”¨æ¥å±•ç°å˜é‡ä¸¤ä¸¤ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚çº¿æ€§ã€éçº¿æ€§ã€ç›¸å…³ hueå‚æ•°å¯ä»¥æŒ‡å®šåˆ†ç±»ã€‚ ","date":"2022-01-26","objectID":"/eda/:2:3","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"sns.heatmap çƒ­åº¦å›¾ï¼Œå¯ä»¥ç›´è§‚æ„Ÿå—å˜é‡ä¹‹é—´çš„ç›¸å…³ç¨‹åº¦ã€‚ æ›´å¤šçš„å¤„ç†æ–¹æ³•å¯ä»¥çœ‹pandasç¬”è®° ","date":"2022-01-26","objectID":"/eda/:2:4","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"ç‰¹å¾å·¥ç¨‹ ","date":"2022-01-26","objectID":"/eda/:3:0","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["æ¯”èµ›ç›¸å…³"],"content":"ä¸»è¦æ­¥éª¤ å¼‚å¸¸å¤„ç†ï¼š é€šè¿‡ç®±çº¿å›¾ï¼ˆæˆ– 3-Sigmaï¼‰åˆ†æåˆ é™¤å¼‚å¸¸å€¼ï¼› BOX-COX è½¬æ¢ï¼ˆå¤„ç†æœ‰ååˆ†å¸ƒï¼‰ï¼› é•¿å°¾æˆªæ–­ï¼› ç‰¹å¾å½’ä¸€åŒ–/æ ‡å‡†åŒ–ï¼š æ ‡å‡†åŒ–ï¼ˆè½¬æ¢ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼‰ï¼› å½’ä¸€åŒ–ï¼ˆæŠ“æ¢åˆ° [0,1] åŒºé—´ï¼‰ï¼› é’ˆå¯¹å¹‚å¾‹åˆ†å¸ƒï¼Œå¯ä»¥é‡‡ç”¨å…¬å¼ï¼š\\(log(\\frac{1+x}{1+median})\\) æ•°æ®åˆ†æ¡¶ï¼š ç­‰é¢‘åˆ†æ¡¶ï¼› ç­‰è·åˆ†æ¡¶ï¼› Best-KS åˆ†æ¡¶ï¼ˆç±»ä¼¼åˆ©ç”¨åŸºå°¼æŒ‡æ•°è¿›è¡ŒäºŒåˆ†ç±»ï¼‰ï¼› å¡æ–¹åˆ†æ¡¶ï¼› ç¼ºå¤±å€¼å¤„ç†ï¼š ä¸å¤„ç†ï¼ˆé’ˆå¯¹ç±»ä¼¼ XGBoost ç­‰æ ‘æ¨¡å‹ï¼‰ï¼› åˆ é™¤ï¼ˆç¼ºå¤±æ•°æ®å¤ªå¤šï¼‰ï¼› æ’å€¼è¡¥å…¨ï¼ŒåŒ…æ‹¬å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°/å»ºæ¨¡é¢„æµ‹/å¤šé‡æ’è¡¥/å‹ç¼©æ„ŸçŸ¥è¡¥å…¨/çŸ©é˜µè¡¥å…¨ç­‰ï¼› åˆ†ç®±ï¼Œç¼ºå¤±å€¼ä¸€ä¸ªç®±ï¼› ç‰¹å¾æ„é€ ï¼š æ„é€ ç»Ÿè®¡é‡ç‰¹å¾ï¼ŒæŠ¥å‘Šè®¡æ•°ã€æ±‚å’Œã€æ¯”ä¾‹ã€æ ‡å‡†å·®ç­‰ï¼› æ—¶é—´ç‰¹å¾ï¼ŒåŒ…æ‹¬ç›¸å¯¹æ—¶é—´å’Œç»å¯¹æ—¶é—´ï¼ŒèŠ‚å‡æ—¥ï¼ŒåŒä¼‘æ—¥ç­‰ï¼› åœ°ç†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ†ç®±ï¼Œåˆ†å¸ƒç¼–ç ç­‰æ–¹æ³•ï¼› éçº¿æ€§å˜æ¢ï¼ŒåŒ…æ‹¬ log/ å¹³æ–¹/ æ ¹å·ç­‰ï¼› ç‰¹å¾ç»„åˆï¼Œç‰¹å¾äº¤å‰ï¼› ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºã€‚ ç‰¹å¾ç­›é€‰ï¼š è¿‡æ»¤å¼ï¼ˆfilterï¼‰ï¼šå…ˆå¯¹æ•°æ®è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œç„¶ååœ¨è®­ç»ƒå­¦ä¹ å™¨ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰ Relief/æ–¹å·®é€‰æ‹©å‘/ç›¸å…³ç³»æ•°æ³•/å¡æ–¹æ£€éªŒæ³•/äº’ä¿¡æ¯æ³•ï¼› åŒ…è£¹å¼ï¼ˆwrapperï¼‰ï¼šç›´æ¥æŠŠæœ€ç»ˆå°†è¦ä½¿ç”¨çš„å­¦ä¹ å™¨çš„æ€§èƒ½ä½œä¸ºç‰¹å¾å­é›†çš„è¯„ä»·å‡†åˆ™ï¼Œå¸¸è§æ–¹æ³•æœ‰ LVMï¼ˆLas Vegas Wrapperï¼‰ ï¼› åµŒå…¥å¼ï¼ˆembeddingï¼‰ï¼šç»“åˆè¿‡æ»¤å¼å’ŒåŒ…è£¹å¼ï¼Œå­¦ä¹ å™¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œäº†ç‰¹å¾é€‰æ‹©ï¼Œå¸¸è§çš„æœ‰ lasso å›å½’ï¼› é™ç»´ï¼š PCA/LDA/LCA;æœ¬åšå®¢éƒ½æœ‰ä»‹ç» ç‰¹å¾é€‰æ‹©ä¹Ÿæ˜¯é™ç»´ ## å»ºæ¨¡è°ƒå‚ ## æ¨¡å‹èåˆ ","date":"2022-01-26","objectID":"/eda/:3:1","tags":["æ¯”èµ›ç›¸å…³","æ•°æ®æŒ–æ˜æ¯”èµ›"],"title":"æ•°æ®æŒ–æ˜æ¯”èµ›","uri":"/eda/"},{"categories":["é¢ç»"],"content":"ä»€ä¹ˆæ˜¯å‰ç¼€æ ‘ï¼Ÿ å‰ç¼€æ ‘æ˜¯Nå‰æ ‘çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå‰ç¼€æ ‘æ˜¯ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²çš„ã€‚å‰ç¼€æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‰ç¼€ï¼‰ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¼šæœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œé€šå¾€ä¸åŒå­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šæœ‰ç€ä¸åŒçš„å­—ç¬¦ã€‚å­èŠ‚ç‚¹ä»£è¡¨çš„å­—ç¬¦ä¸²æ˜¯ç”±èŠ‚ç‚¹æœ¬èº«çš„åŸå§‹å­—ç¬¦ä¸²ï¼Œä»¥åŠé€šå¾€è¯¥å­èŠ‚ç‚¹è·¯å¾„ä¸Šæ‰€æœ‰çš„å­—ç¬¦ç»„æˆçš„ã€‚ åœ¨ä¸Šå›¾ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨èŠ‚ç‚¹ä¸­æ ‡è®°çš„å€¼æ˜¯è¯¥èŠ‚ç‚¹å¯¹åº”è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€‰æ‹©ç¬¬äºŒæ¡è·¯å¾„ â€˜bâ€™ï¼Œç„¶åé€‰æ‹©å®ƒçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ â€˜aâ€™ï¼Œæ¥ä¸‹æ¥ç»§ç»­é€‰æ‹©å­èŠ‚ç‚¹ â€˜dâ€™ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šåˆ°è¾¾å¶èŠ‚ç‚¹ â€œbadâ€ã€‚èŠ‚ç‚¹çš„å€¼æ˜¯ç”±ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¸å…¶ç»è¿‡çš„è·¯å¾„ä¸­çš„å­—ç¬¦æŒ‰é¡ºåºå½¢æˆçš„ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ¹èŠ‚ç‚¹è¡¨ç¤ºç©ºå­—ç¬¦ä¸²ã€‚ å‰ç¼€æ ‘çš„ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§æ˜¯ï¼ŒèŠ‚ç‚¹æ‰€æœ‰çš„åä»£éƒ½ä¸è¯¥èŠ‚ç‚¹ç›¸å…³çš„å­—ç¬¦ä¸²æœ‰ç€å…±åŒçš„å‰ç¼€ã€‚è¿™å°±æ˜¯å‰ç¼€æ ‘åç§°çš„ç”±æ¥ã€‚ æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªä¾‹å­ã€‚ä¾‹å¦‚ï¼Œä»¥èŠ‚ç‚¹ â€œbâ€ ä¸ºæ ¹çš„å­æ ‘ä¸­çš„èŠ‚ç‚¹è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼Œéƒ½å…·æœ‰å…±åŒçš„å‰ç¼€ â€œbâ€ã€‚åä¹‹äº¦ç„¶ï¼Œå…·æœ‰å…¬å…±å‰ç¼€ â€œbâ€ çš„å­—ç¬¦ä¸²ï¼Œå…¨éƒ¨ä½äºä»¥ â€œbâ€ ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œå¹¶ä¸”å…·æœ‰ä¸åŒå‰ç¼€çš„å­—ç¬¦ä¸²æ¥è‡ªä¸åŒçš„åˆ†æ”¯ã€‚ å‰ç¼€æ ‘æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚è‡ªåŠ¨è¡¥å…¨ï¼Œæ‹¼å†™æ£€æŸ¥ç­‰ç­‰ã€‚ ","date":"2022-01-19","objectID":"/%E5%89%8D%E7%BC%80%E6%A0%91/:1:0","tags":["é¢ç»","å‰ç¼€æ ‘"],"title":"å‰ç¼€æ ‘","uri":"/%E5%89%8D%E7%BC%80%E6%A0%91/"},{"categories":["é¢ç»"],"content":"ä»£ç  import collections class TrieNode(object): # å®šä¹‰èŠ‚ç‚¹ # Initialize your data structure here. def __init__(self): self.node = collections.defaultdict(TrieNode) self.char = \"\" self.is_word = False @property def data(self): return self.node def __getitem__(self, key): return self.node[key] def __str__(self) -\u003e str: return self.char __repr__ = __str__ class Trie(object): def __init__(self): \"\"\" Initialize your data structure here. \"\"\" self.root = TrieNode() def insert(self, word): \"\"\" Inserts a word into the trie. :type word: str :rtype: void \"\"\" node = self.root for chars in word: temp = node.char node = node[chars] # å› ä¸ºdefaultdictï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è‡ªåŠ¨ç”Ÿæˆé”® node.char = temp + chars # é”®å¯ä»¥è§†ä¸ºè·¯å¾„ä¸Šçš„å­—ç¬¦ï¼ŒèŠ‚ç‚¹å¯ä»¥è§†ä¸ºä»æ ¹åˆ°å½“å‰èŠ‚ç‚¹è¡¨ç¤ºçš„å‰ç¼€æˆ–å•è¯ã€‚ node.is_word = True # è¿™é‡Œå¾ˆé‡è¦ï¼Œç”¨äºsearchåˆ¤æ–­æ˜¯å¦ä¸ºå®Œæ•´çš„å•è¯ def search(self, word): \"\"\" Returns if the word is in the trie. :type word: str :rtype: bool \"\"\" node = self.root for chars in word: if chars not in node.data.keys(): # å› ä¸ºdefaultdictæ‰€ä»¥ä¸èƒ½åˆ¤æ–­valueä¸ºNoneï¼Œè¦åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ return False node = node[chars] # åˆ¤æ–­å•è¯æ˜¯å¦æ˜¯å®Œæ•´çš„å­˜åœ¨åœ¨trieæ ‘ä¸­ return node.is_word def startsWith(self, prefix): \"\"\" Returns if there is any word in the trie that starts with the given prefix. :type prefix: str :rtype: bool \"\"\" node = self.root for chars in prefix: if chars not in node.data.keys(): # å’Œä¸Šé¢åŒç† return False node = node[chars] return True def get_all_words(self): # è·å–æ‰€æœ‰çš„å•è¯ q = [self.root] while q: node = q.pop(0) # ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ— for child in node.data.values(): if child.is_word: yield child.char q.append(child) ","date":"2022-01-19","objectID":"/%E5%89%8D%E7%BC%80%E6%A0%91/:2:0","tags":["é¢ç»","å‰ç¼€æ ‘"],"title":"å‰ç¼€æ ‘","uri":"/%E5%89%8D%E7%BC%80%E6%A0%91/"},{"categories":["é¢ç»"],"content":"åº”ç”¨ å‰ç¼€æ ‘åœ¨ä¸­æ–‡åˆ†è¯çš„åº”ç”¨ï¼Œå‰ç¼€æ ‘çš„å®ç°å’Œä¸Šé¢çš„å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦å°±æ˜¯æ‰¾å¥å­ä¸­çš„è¯æœ‰æ²¡æœ‰å‡ºç°åœ¨å‰ç¼€æ ‘ä¸­ã€‚ from trie import Trie import time class TrieTokenizer(Trie): \"\"\" åŸºäºå­—å…¸æ ‘(Trie Tree)çš„ä¸­æ–‡åˆ†è¯ç®—æ³• \"\"\" def __init__(self, dict_path): \"\"\" :param dict_path:å­—å…¸æ–‡ä»¶è·¯å¾„ \"\"\" super(TrieTokenizer, self).__init__() self.dict_path = dict_path self.create_trie_tree() self.punctuations = \"\"\"ï¼ï¼Ÿï½¡ï¼‚ï¼ƒï¼„ï¼…ï¼†ï¼‡ï¼šï¼ˆï¼‰ï¼Šï¼‹ï¼Œï¼ï¼ï¼šï¼›ï¼œï¼ï¼ï¼ ï¼»ï¼¼ï¼½ï¼¾ï¼¿ï½€ï½›ï½œï½ï½ï½Ÿï½ ï½¢ï½£ï½¤ã€ã€ƒã€‹ã€Œã€ã€ã€ã€ã€‘ã€”ã€•ã€–ã€—ã€˜ã€™ã€šã€›ã€œã€ã€ã€Ÿã€°ã€¾ã€¿â€“â€”â€˜â€™â€›â€œâ€â€â€Ÿâ€¦â€§ï¹.\"\"\" def load_dict(self): \"\"\" åŠ è½½å­—å…¸æ–‡ä»¶ è¯å…¸æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªè¯ï¼š AAåˆ¶ ABC ABS ABåˆ¶ ABè§’ :return: \"\"\" words = [] with open(self.dict_path, mode=\"r\", encoding=\"utf-8\") as file: for line in file: words.append(line.strip().encode('utf-8').decode('utf-8-sig')) return words def create_trie_tree(self): \"\"\" éå†è¯å…¸ï¼Œåˆ›å»ºå­—å…¸æ ‘ :return: \"\"\" words = self.load_dict() for word in words: self.insert(word) def mine_tree(self, tree, sentence, trace_index): \"\"\" ä»å¥å­ç¬¬trace_indexä¸ªå­—ç¬¦å¼€å§‹éå†æŸ¥æ‰¾è¯è¯­ï¼Œè¿”å›è¯è¯­å ä½ä¸ªæ•° :param tree: :param sentence: :param trace_index: :return: \"\"\" if trace_index \u003c= (len(sentence) - 1): if sentence[trace_index] in tree.data: trace_index = trace_index + 1 trace_index = self.mine_tree(tree.data[sentence[trace_index - 1]], sentence, trace_index) return trace_index def tokenize(self, sentence): tokens = [] sentence_len = len(sentence) while sentence_len != 0: trace_index = 0 # ä»å¥å­ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹éå† trace_index = self.mine_tree(self.root, sentence, trace_index) if trace_index == 0: # åœ¨å­—å…¸æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°ä»¥sentence[0]å¼€å¤´çš„è¯è¯­ tokens.append(sentence[0:1]) # å½“å‰å­—ç¬¦ä½œä¸ºåˆ†è¯ç»“æœ sentence = sentence[1:len(sentence)] # é‡æ–°éå†sentence sentence_len = len(sentence) else: # åœ¨å­—å…¸æ ‘ä¸­æ‰¾åˆ°äº†ä»¥sentence[0]å¼€å¤´çš„è¯è¯­ï¼Œå¹¶ä¸”trace_indexä¸ºè¯è¯­çš„ç»“æŸç´¢å¼• tokens.append(sentence[0:trace_index]) # å‘½ä¸­è¯è¯­ä½œä¸ºåˆ†è¯ç»“æœ sentence = sentence[trace_index:len(sentence)] # sentence_len = len(sentence) return tokens def combine(self, token_list): \"\"\" TODO:å¯¹ç»“æœåå¤„ç†ï¼šæ ‡ç‚¹ç¬¦å·/ç©ºæ ¼/åœç”¨è¯ :param token_list: :return: \"\"\" flag = 0 output = [] temp = [] for i in token_list: if len(i) != 1: # å½“å‰è¯è¯­é•¿åº¦ä¸ä¸º1 if flag == 0: output.append(i[::]) else: # ['è¯¥', 'æ–¹æ³•'] # temp=['è¯¥'] output.append(\"\".join(temp)) output.append(i[::]) temp = [] flag = 0 else: if flag == 0: temp.append(i) flag = 1 else: temp.append(i) return output if __name__ == '__main__': now = lambda: time.time() trie_cws = TrieTokenizer('data/32w_dic.txt') start = now() print(f\"Build Token Tree Time : {now() - start}\") sentence = 'è¯¥æ–¹æ³•çš„ä¸»è¦æ€æƒ³ï¼šè¯æ˜¯ç¨³å®šçš„ç»„åˆï¼Œå› æ­¤åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›¸é‚»çš„å­—åŒæ—¶å‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œå°±è¶Šæœ‰å¯èƒ½æ„æˆä¸€ä¸ªè¯ã€‚å› æ­¤å­—ä¸å­—ç›¸é‚»å‡ºç°çš„æ¦‚ç‡æˆ–é¢‘ç‡èƒ½è¾ƒå¥½åœ°åæ˜ æˆè¯çš„å¯ä¿¡åº¦ã€‚' 'å¯ä»¥å¯¹è®­ç»ƒæ–‡æœ¬ä¸­ç›¸é‚»å‡ºç°çš„å„ä¸ªå­—çš„ç»„åˆçš„é¢‘åº¦è¿›è¡Œç»Ÿè®¡ï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„äº’ç°ä¿¡æ¯ã€‚äº’ç°ä¿¡æ¯ä½“ç°äº†æ±‰å­—ä¹‹é—´ç»“åˆå…³ç³»çš„ç´§å¯†ç¨‹åº¦ã€‚å½“ç´§å¯†ç¨‹ åº¦é«˜äºæŸä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œ' 'ä¾¿å¯ä»¥è®¤ä¸ºæ­¤å­—ç»„å¯èƒ½æ„æˆäº†ä¸€ä¸ªè¯ã€‚è¯¥æ–¹æ³•åˆç§°ä¸ºæ— å­—å…¸åˆ†è¯ã€‚' tokens = trie_cws.tokenize(sentence) combine_tokens = trie_cws.combine(tokens) end = now() print(tokens) print(combine_tokens) print(f\"tokenize Token Tree Time : {end - start}\") ","date":"2022-01-19","objectID":"/%E5%89%8D%E7%BC%80%E6%A0%91/:3:0","tags":["é¢ç»","å‰ç¼€æ ‘"],"title":"å‰ç¼€æ ‘","uri":"/%E5%89%8D%E7%BC%80%E6%A0%91/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"Logisticå›å½’ ","date":"2022-01-15","objectID":"/logistic%E5%9B%9E%E5%BD%92/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","Logisticå›å½’"],"title":"Logisticå›å½’","uri":"/logistic%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"çº¿æ€§å›å½’ çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š \\[ y = w^Tx+b \\] å¹¿ä¹‰å›å½’æ¨¡å‹ï¼š \\[ y = g^{-1}(w^Tx+b) \\] ","date":"2022-01-15","objectID":"/logistic%E5%9B%9E%E5%BD%92/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","Logisticå›å½’"],"title":"Logisticå›å½’","uri":"/logistic%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"Sigmoidå‡½æ•° åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªè”ç³»å‡½æ•°ï¼Œå³gï¼Œå°†çº¿æ€§å›å½’çš„è¾“å‡ºå€¼ä¸å®é™…çš„æ ‡ç­¾å€¼è”ç³»èµ·æ¥ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨Sigmoidå‡½æ•° å³ï¼š \\[ \\delta(z) = \\frac{1}{1+e^{-z}} \\] å¯¹æ•°å‡ ç‡å…¶å®æ˜¯ä¸€ç§â€œsigmoidâ€å‡½æ•°ï¼Œå®ƒå°†zå€¼è½¬åŒ–ä¸ºä¸€ä¸ªæ¥è¿‘ 0 æˆ– 1 çš„ \\(y\\) å€¼: \\[ y=\\frac{1}{1+e^{-\\left(w^{T} x+b\\right)}} \\rightarrow \\operatorname{In} \\frac{y}{1-y}=w^{T} x+b \\] è‹¥å°†yè§†ä¸ºæ ·æœ¬ \\(x\\) ä½œä¸ºæ­£ä¾‹çš„å¯èƒ½æ€§ï¼Œåˆ™1-yæ˜¯å…¶åä¾‹çš„å¯èƒ½æ€§ï¼Œä¸¤è€…çš„æ¯”å€¼ \\(\\frac{y}{1-y}\\) ç§°ä¸ºâ€œå‡ ç‡â€ï¼Œåæ˜ äº†xä½œä¸ºæ­£ä¾‹çš„ç›¸å¯¹å¯èƒ½æ€§ï¼Œå¯¹å‡ ç‡å–å¯¹ æ•°åˆ™å¾—åˆ° \\(\\operatorname{In} \\frac{y}{1-y}\\) ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸Šå¼å…¶å®æ˜¯åœ¨ç”¨çº¿æ€§å›å½’æ¨¡å‹çš„é¢„æµ‹ç»“æœå»é€¼è¿‘çœŸå®æ ‡è®°çš„å¯¹æ•°å‡ ç‡ã€‚æ‰€ä»¥è¯¥æ¨¡å‹ä¹Ÿè¢«ç§°ä½œâ€œå¯¹æ•°å‡ ç‡å› å½’â€ã€‚ ## æŸå¤±å‡½æ•° \\[ J = -\\frac{1}{m}\\sum_{i=1}^my_i\\log(\\hat{y_i})+(1-y_i)\\log(1-\\hat{y}) \\] å®é™…ä¸Šå¯ä»¥çœ‹ä½œä¸‹é¢äº¤å‰ç†µæŸå¤±å‡½æ•°å½¢å¼åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸Šçš„å½¢å¼ï¼š \\[ J = -\\frac{1}{m}\\sum_{i=1}^my_i\\log(\\hat{y_i}) \\] è¿™é‡Œçš„\\(y_i\\)ä¸\\(\\hat{y_i}\\)éƒ½æ˜¯å‘é‡ï¼Œå…¶é•¿åº¦å°±æ˜¯ç±»åˆ«çš„æ•°é‡ã€‚å…¶ä¸­\\(y_i\\)ä»£è¡¨å®é™…åˆ†å¸ƒï¼Œå½¢å¼ä¸Šä¸ºonehotå‘é‡ã€‚\\(\\hat{y_i}\\)æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼Œä¸ºé¢„æµ‹çš„å€¼ã€‚ å…¶å®è¿™é‡Œå¯ä»¥æƒ³ä¸€ä¸‹ç¥ç»ç½‘ç»œï¼Œå¯¹äºsigmoidæ¥è¯´ï¼Œè¾“å‡ºå±‚çš„ç¥ç»å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸¤ä¸ªï¼Œå¦‚æœæ˜¯ä¸€ä¸ªçš„è¯å°±å¯ä»¥ç”¨ä¸Šé¢çš„å½¢å¼ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªçš„è¯å¯ä»¥ç”¨ä¸‹é¢çš„è¿™ç§å½¢å¼ã€‚ ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œå¯¹äºsoftmaxçš„è¿™ç§å½¢å¼ï¼Œå¯¹äºäºŒåˆ†ç±»æˆ‘ä»¬å¯ä»¥æ‹†åˆ†æˆè¿™æ · \\[ \\begin{cases} \\log \\hat{y_i}, \\quad y_i=1 \\\\\\\\ \\log (1-\\hat{y_i}), \\quad y_i=0 \\end{cases} \\] å†ç»“åˆèµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°é€»è¾‘å›å½’çš„æŸå¤±å‡½æ•°çš„ç»“æœã€‚ ## ä¸æå¤§ä¼¼ç„¶ä¼°è®¡çš„å…³ç³» \\[ h(x;\\theta) = p(y=1|x;\\theta) = \\frac{1}{1+e^{-\\theta x+b}} \\] \\[ p(y=0|x;\\theta) = 1-p(y=1|x;\\theta) \\] åˆ™å¯¹äºå•ä¸ªæ ·æœ¬ï¼š \\[ p(y|x;\\theta) = h(x;\\theta)^y(1-h(x;\\theta))^{(1-y)} \\] æ¥ä¸‹æ¥ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ä¼°è®¡å‡ºå‚æ•°\\(\\theta\\) \\[ \\begin{aligned} L(\\theta) = \\prod_{i=1}^mp(y_i|x_i;\\theta)\\\\\\\\ =\\prod_{i=1}^mh(x_i;\\theta)^{y_i}(1-h(x_i;\\theta)) ^{1-y_i} \\end{aligned} \\] åˆ™ï¼š \\[ l(\\theta) = \\ln L(\\theta) = \\sum_{i=1}^my_i\\ln (h(x_i;\\theta ))+(1-y_i)ln(1-h(x_i|\\theta)) \\] æå¤§è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æœ€å°åŒ–è¿™ä¸ªå‡½æ•°çš„è´Ÿæ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æŸå¤±å‡½æ•°ã€‚ ","date":"2022-01-15","objectID":"/logistic%E5%9B%9E%E5%BD%92/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","Logisticå›å½’"],"title":"Logisticå›å½’","uri":"/logistic%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"pythonå®ç° class LogisticRegression: def __init__(self): pass def sigmoid(self,a): res = [] for x in a: if x \u003e= 0: res.append(1/(1+np.exp(-x))) else: res.append(np.exp(x) / (np.exp(x) + 1)) return np.array(res) def train(self, X, y_true, n_iters=100, learning_rate=1): \"\"\" æ ¹æ®ç»™å®šçš„è®­ç»ƒé›†Xå’Œyæ¥è®­ç»ƒé€»è¾‘å›å½’ \"\"\" # ç¬¬é›¶æ­¥ï¼šåˆå§‹åŒ–å‚æ•° n_samples, n_features = X.shape #ğŸ‘†æ ·æœ¬æ•°må’Œç‰¹å¾é‡æ•°nåˆ†åˆ«èµ‹å€¼ä¸ºXçš„è¡Œæ•°å’Œåˆ—æ•° self.weights = np.zeros((n_features,1)) self.bias = 0 costs = [] for i in range(n_iters): # ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥ï¼šè®¡ç®—è¾“å…¥çš„ç‰¹å¾é‡å’Œæƒå€¼çš„çº¿æ€§ç»„åˆï¼Œä½¿ç”¨sigmoidå‡½æ•° y_predict = self.sigmoid(np.dot(X,self.weights)+self.bias) # ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—ä»£ä»·å€¼ï¼Œç”¨äºä¹‹åè®¡ç®—ä»£ä»·å‡½æ•°å€¼ cost = (-1/n_samples)*np.sum(y_true*np.log(y_predict+1e-5)+(1-y_true)*(np.log(1-y_predict+1e-5))) # ç¬¬å››æ­¥ï¼šè®¡ç®—æ¢¯åº¦ dw = (1/n_samples)*np.dot(X.T,(y_predict - y_true)) db = (1/n_samples)*np.sum(y_predict-y_true) # ç¬¬äº”æ­¥ï¼›æ›´æ–°å‚æ•° self.weights = self.weights - learning_rate * dw self.bias = self.bias - learning_rate * db costs.append(cost) if i%10 == 0: print(f\"Cost after iteration {i}:{cost}\") # return self.weights,self.bias,costs def predict(self,X): \"\"\" å¯¹äºæµ‹è¯•é›†Xï¼Œé¢„æµ‹äºŒå…ƒåˆ†ç±»æ ‡ç­¾ \"\"\" y_predict = self.sigmoid(np.dot(X,self.weights)+self.bias) return np.array(y_predict) ","date":"2022-01-15","objectID":"/logistic%E5%9B%9E%E5%BD%92/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","Logisticå›å½’"],"title":"Logisticå›å½’","uri":"/logistic%E5%9B%9E%E5%BD%92/"},{"categories":["pandas","api"],"content":"pd.melt ","date":"2022-01-12","objectID":"/melt/:0:0","tags":["pandas","api","melt"],"title":"melt","uri":"/melt/"},{"categories":["pandas","api"],"content":"ç”¨æ³• ç›´è§‚çš„çœ‹å°±æ˜¯å°†å®½æ•°æ®è½¬åŒ–ä¸ºé•¿æ•°æ®ã€‚è½¬åŒ–ä¸ºvariable-valueè¿™æ ·çš„å½¢å¼ã€‚ pandas.melt(frame, id_vars=None, value_vars=None, var_name=None, value_name='value', col_level=None) å‚æ•°è§£é‡Šï¼š frame:è¦å¤„ç†çš„æ•°æ®é›†ã€‚ id_vars:ä¸éœ€è¦è¢«è½¬æ¢çš„åˆ—åã€‚ value_vars:éœ€è¦è½¬æ¢çš„åˆ—åï¼Œå¦‚æœå‰©ä¸‹çš„åˆ—å…¨éƒ¨éƒ½è¦è½¬æ¢ï¼Œå°±ä¸ç”¨å†™äº†ã€‚ var_nameå’Œvalue_nameæ˜¯è‡ªå®šä¹‰è®¾ç½®å¯¹åº”çš„åˆ—åã€‚ col_level :å¦‚æœåˆ—æ˜¯MultiIndexï¼Œåˆ™ä½¿ç”¨æ­¤çº§åˆ«ã€‚ ## å®ä¾‹ import pandas as pd df = pd.DataFrame({'A': {0: 'a', 1: 'b', 2: 'c'}, 'B': {0: 1, 1: 3, 2: 5}, 'C': {0: 2, 1: 4, 2: 6} }) df ''' A B C 0 a 1 2 1 b 3 4 2 c 5 6 ''' pd.melt(df, id_vars=['A'], value_vars=['B']) ''' A variable value 0 a B 1 1 b B 3 2 c B 5 ''' pd.melt(df, id_vars=['A'], value_vars=['B', 'C']) ''' A variable value 0 a B 1 1 b B 3 2 c B 5 3 a C 2 4 b C 4 5 c C 6 ''' pd.melt(df, id_vars=['A'], value_vars=['B'], var_name='myVarName', value_name='myValueName') ''' A myVarName myValueName 0 a B 1 1 b B 3 2 c B 5 ''' pd.melt(df, id_vars=['A'], value_vars=['B', 'C'], ignore_index=False) ''' A variable value 0 a B 1 1 b B 3 2 c B 5 0 a C 2 1 b C 4 2 c C 6 ''' # å¤šé‡ç´¢å¼• df.columns = [list('ABC'), list('DEF')] df ''' A B C D E F 0 a 1 2 1 b 3 4 2 c 5 6 ''' # é€‰æ‹©æœ€å¤–å±‚ç´¢å¼• pd.melt(df, col_level=0, id_vars=['A'], value_vars=['B']) ''' A variable value 0 a B 1 1 b B 3 2 c B 5 ''' # é€‰æ‹©å†…å±‚ç´¢å¼• pd.melt(df, col_level=1, id_vars=['D'], value_vars=['E']) # é€‰æ‹©å¤åˆç´¢å¼• pd.melt(df, id_vars=[('A', 'D')], value_vars=[('B', 'E')]) ''' (A, D) variable_0 variable_1 value 0 a B E 1 1 b B E 3 2 c B E 5 ''' ","date":"2022-01-12","objectID":"/melt/:1:0","tags":["pandas","api","melt"],"title":"melt","uri":"/melt/"},{"categories":["NLP"],"content":"é¢„è®­ç»ƒæ¨¡å‹ ","date":"2022-01-03","objectID":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/:0:0","tags":["NLP","é¢„è®­ç»ƒæ¨¡å‹"],"title":"é¢„è®­ç»ƒæ¨¡å‹","uri":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ¦‚è¿° é¢„è®­ç»ƒæ¨¡å‹ï¼Œåˆ™æ˜¯ä½¿è‡ªç„¶è¯­è¨€å¤„ç†ç”±åŸæ¥çš„æ‰‹å·¥è°ƒå‚ã€ä¾é  ML ä¸“å®¶çš„é˜¶æ®µï¼Œè¿›å…¥åˆ°å¯ä»¥å¤§è§„æ¨¡ã€å¯å¤åˆ¶çš„å¤§å·¥ä¸šæ–½å±•çš„é˜¶æ®µã€‚è€Œä¸”é¢„è®­ç»ƒæ¨¡å‹ä»å•è¯­è¨€ã€æ‰©å±•åˆ°å¤šè¯­è¨€ã€å¤šæ¨¡æ€ä»»åŠ¡ã€‚ä¸€è·¯é”æ°”æ­£ç››ï¼Œæ‰€å‘æŠ«é¡ã€‚ é¢„è®­ç»ƒé€šè¿‡è‡ªç›‘ç£å­¦ä¹ ä»å¤§è§„æ¨¡æ•°æ®ä¸­è·å¾—ä¸å…·ä½“ä»»åŠ¡æ— å…³çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚ä½“ç°æŸä¸€ä¸ªè¯åœ¨ä¸€ä¸ªç‰¹å®šä¸Šä¸‹æ–‡ä¸­çš„è¯­ä¹‰è¡¨å¾ã€‚ç¬¬äºŒä¸ªæ­¥éª¤æ˜¯å¾®è°ƒï¼Œé’ˆå¯¹å…·ä½“çš„ä»»åŠ¡ä¿®æ­£ç½‘ç»œã€‚è®­ç»ƒæ•°æ®å¯ä»¥æ˜¯æ–‡æœ¬ã€æ–‡æœ¬-å›¾åƒå¯¹ã€æ–‡æœ¬-è§†é¢‘å¯¹ã€‚é¢„è®­ç»ƒæ¨¡å‹çš„è®­ç»ƒæ–¹æ³•å¯ä½¿ç”¨è‡ªç›‘ç£å­¦ä¹ æŠ€æœ¯ï¼ˆå¦‚è‡ªå›å½’çš„è¯­è¨€æ¨¡å‹å’Œè‡ªç¼–ç æŠ€æœ¯ï¼‰ã€‚å¯è®­ç»ƒå•è¯­è¨€ã€å¤šè¯­è¨€å’Œå¤šæ¨¡æ€çš„æ¨¡å‹ã€‚æ­¤ç±»æ¨¡å‹å¯ç»è¿‡å¾®è°ƒä¹‹åï¼Œç”¨äºæ”¯æŒåˆ†ç±»ã€åºåˆ—æ ‡è®°ã€ç»“æ„é¢„æµ‹å’Œåºåˆ—ç”Ÿæˆç­‰å„é¡¹æŠ€æœ¯ï¼Œå¹¶æ„å»ºæ–‡æ‘˜ã€æœºå™¨ç¿»è¯‘ã€å›¾ç‰‡æ£€ç´¢ã€è§†é¢‘æ³¨é‡Šç­‰åº”ç”¨ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åšé¢„è®­ç»ƒæ¨¡å‹ï¼Ÿé¦–å…ˆï¼Œé¢„è®­ç»ƒæ¨¡å‹æ˜¯ä¸€ç§è¿ç§»å­¦ä¹ çš„åº”ç”¨ï¼Œåˆ©ç”¨å‡ ä¹æ— é™çš„æ–‡æœ¬ï¼Œå­¦ä¹ è¾“å…¥å¥å­çš„æ¯ä¸€ä¸ªæˆå‘˜çš„ä¸Šä¸‹æ–‡ç›¸å…³çš„è¡¨ç¤ºï¼Œå®ƒéšå¼åœ°å­¦ä¹ åˆ°äº†é€šç”¨çš„è¯­æ³•è¯­ä¹‰çŸ¥è¯†ã€‚ç¬¬äºŒï¼Œå®ƒå¯ä»¥å°†ä»å¼€æ”¾é¢†åŸŸå­¦åˆ°çš„çŸ¥è¯†è¿ç§»åˆ°ä¸‹æ¸¸ä»»åŠ¡ï¼Œä»¥æ”¹å–„ä½èµ„æºä»»åŠ¡ï¼Œå¯¹ä½èµ„æºè¯­è¨€å¤„ç†ä¹Ÿéå¸¸æœ‰åˆ©ã€‚ç¬¬ä¸‰ï¼Œé¢„è®­ç»ƒæ¨¡å‹åœ¨å‡ ä¹æ‰€æœ‰ NLP ä»»åŠ¡ä¸­éƒ½å–å¾—äº†ç›®å‰æœ€ä½³çš„æˆæœã€‚æœ€åï¼Œè¿™ä¸ªé¢„è®­ç»ƒæ¨¡å‹+å¾®è°ƒæœºåˆ¶å…·å¤‡å¾ˆå¥½çš„å¯æ‰©å±•æ€§ï¼Œåœ¨æ”¯æŒä¸€ä¸ªæ–°ä»»åŠ¡æ—¶ï¼Œåªéœ€è¦åˆ©ç”¨è¯¥ä»»åŠ¡çš„æ ‡æ³¨æ•°æ®è¿›è¡Œå¾®è°ƒå³å¯ï¼Œä¸€èˆ¬å·¥ç¨‹å¸ˆå°±å¯ä»¥å®ç°ã€‚ ","date":"2022-01-03","objectID":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/:1:0","tags":["NLP","é¢„è®­ç»ƒæ¨¡å‹"],"title":"é¢„è®­ç»ƒæ¨¡å‹","uri":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å‘å±•è¶‹åŠ¿ é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªå…³é”®æŠ€æœ¯æ˜¯ Transformerã€‚å®ƒåœ¨ NLP å„ä¸ªä»»åŠ¡ä¸­éƒ½å–å¾—äº†ä¼˜å¼‚çš„æ€§èƒ½ï¼Œå®ƒæ˜¯é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„æ ¸å¿ƒç½‘ç»œã€‚ç»™å®šä¸€å¥è¯æˆ–æ˜¯ä¸€ä¸ªæ®µè½ä½œä¸ºè¾“å…¥ï¼Œé¦–å…ˆå°†è¾“å…¥åºåˆ—ä¸­å„ä¸ªè¯è½¬æ¢ä¸ºå…¶å¯¹åº”çš„è¯å‘é‡ï¼ŒåŒæ—¶åŠ ä¸Šæ¯ä¸€ä¸ªè¯çš„ä½ç½®å‘é‡ï¼Œä½“ç°è¯åœ¨åºåˆ—çš„ä½ç½®ã€‚ç„¶åå°†è¿™äº›è¯å‘é‡è¾“å…¥åˆ°å¤šå±‚ Transformer ç½‘ç»œä¸­ï¼Œé€šè¿‡è‡ªæ³¨æ„åŠ›ï¼ˆself-attentionï¼‰æœºåˆ¶æ¥å­¦ä¹ è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ï¼Œç¼–ç å…¶ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå†é€šè¿‡ä¸€ä¸ªå‰é¦ˆç½‘ç»œç»è¿‡éçº¿æ€§å˜åŒ–ï¼Œè¾“å‡ºç»¼åˆäº†ä¸Šä¸‹æ–‡ç‰¹å¾çš„å„ä¸ªè¯çš„å‘é‡è¡¨ç¤ºã€‚æ¯ä¸€å±‚ Transformer ç½‘ç»œä¸»è¦ç”± Multi-head self-attention å±‚ï¼ˆå¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼‰å’Œå‰é¦ˆç½‘ç»œå±‚ä¸¤ä¸ªå­å±‚æ„æˆã€‚Multi-head self-attention ä¼šå¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªä¸åŒå‚æ•°çš„ self-attentionï¼Œå¹¶å°†å„ä¸ª self-attention çš„ç»“æœæ‹¼æ¥ä½œä¸ºåç»­ç½‘ç»œçš„è¾“å…¥ï¼Œself-attention æœºåˆ¶ä¼šåœ¨åé¢ä¸­åšè¯¦ç»†ä»‹ç»ã€‚æ­¤åï¼Œæˆ‘ä»¬å¾—åˆ°äº†è•´å«å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å„ä¸ªè¯çš„è¡¨ç¤ºï¼Œç„¶åç½‘ç»œä¼šå°†å…¶è¾“å…¥åˆ°å‰é¦ˆç½‘ç»œå±‚ä»¥è®¡ç®—éçº¿æ€§å±‚æ¬¡çš„ç‰¹å¾ã€‚ åœ¨æ¯ä¸€å±‚ Transformer ç½‘ç»œä¸­ï¼Œä¼šå°†æ®‹å·®è¿æ¥ï¼ˆresidual connectionï¼‰æŠŠè‡ªæ³¨æ„åŠ›æœºåˆ¶å‰æˆ–è€…å‰é¦ˆç¥ç»ç½‘ç»œä¹‹å‰çš„å‘é‡å¼•å…¥è¿›æ¥ï¼Œä»¥å¢å¼ºè‡ªæ³¨æ„åŠ›æœºåˆ¶æˆ–è€…å‰é¦ˆç½‘ç»œçš„è¾“å‡ºç»“æœå‘é‡ã€‚å¹¶ä¸”è¿˜åšä¸€ä¸ª layer normalizationï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å½’ä¸€åŒ–æŠŠåŒå±‚çš„å„ä¸ªèŠ‚ç‚¹çš„å¤šç»´å‘é‡æ˜ å°„åˆ°ä¸€ä¸ªåŒºé—´é‡Œé¢ï¼Œè¿™æ ·å„å±‚èŠ‚ç‚¹çš„å‘é‡åœ¨ä¸€ä¸ªåŒºé—´é‡Œé¢ã€‚è¿™ä¸¤ä¸ªæ“ä½œåŠ å…¥åœ¨æ¯ä¸ªå­å±‚åï¼Œå¯æ›´åŠ å¹³æ»‘åœ°è®­ç»ƒæ·±å±‚æ¬¡ç½‘ç»œã€‚ Transformer å¯ä»¥ç”¨äºç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨äºè§£ç ã€‚æ‰€è°“è§£ç å°±æ˜¯æ ¹æ®ä¸€ä¸ªå¥å­çš„è¾“å…¥å¾—åˆ°ä¸€ä¸ªé¢„æƒ³çš„ç»“æœï¼Œæ¯”å¦‚æœºå™¨ç¿»è¯‘ï¼ˆè¾“å…¥æºè¯­è¨€å¥å­ï¼Œè¾“å‡ºç›®æ ‡è¯­è¨€å¥å­ï¼‰ï¼Œæˆ–è€…é˜…è¯»ç†è§£ï¼ˆè¾“å…¥æ–‡æ¡£å’Œé—®é¢˜ï¼Œè¾“å‡ºç­”æ¡ˆï¼‰ã€‚è§£ç æ—¶ï¼Œå·²ç»è§£ç å‡ºæ¥çš„è¯è¦åšä¸€ä¸ªè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œä¹‹åå’Œç¼–ç å¾—åˆ°çš„éšçŠ¶æ€çš„åºåˆ—å†åšä¸€ä¸ªæ³¨æ„åŠ›æœºåˆ¶ã€‚è¿™æ ·å¯ä»¥åš N å±‚ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªçº¿æ€§å±‚æ˜ å°„åˆ°è¯è¡¨çš„å¤§å°çš„ä¸€ä¸ªå‘é‡ã€‚æ¯ä¸ªå‘é‡ä»£è¡¨ä¸€ä¸ªè¯è¡¨è¯çš„è¾“å‡ºå¯èƒ½æ€§ï¼Œç»è¿‡ä¸€ä¸ªsoftmax å±‚å¾—åˆ°æ¯ä¸ªè¯çš„è¾“å‡ºæ¦‚ç‡ã€‚ æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹ self-attention æœºåˆ¶ï¼Œä»¥ä¸€ä¸ª head ä½œä¸ºç¤ºä¾‹ã€‚å‡å®šå½“å‰è¾“å…¥åŒ…å«ä¸‰ä¸ªè¯ï¼Œç»™å®šå…¶è¾“å…¥è¯å‘é‡æˆ–æ˜¯å…¶ä¸Šä¸€å±‚ Transformer ç½‘ç»œçš„è¾“å‡ºï¼Œå°†å…¶é€šè¿‡ä¸‰ç»„çº¿æ€§å˜æ¢ï¼Œè½¬æ¢å¾—åˆ°ä¸‰ç»„ queriesã€keys å’Œ values å‘é‡ã€‚Query å’Œ key å‘é‡ç”¨æ¥è®¡ç®—ä¸¤ä¸¤è¯ä¹‹é—´çš„å¾—åˆ†ï¼Œä¹Ÿå°±æ˜¯å…¶ä¾èµ–å…³ç³»ï¼Œè¿™ä¸ªå¾—åˆ†ä¼šåŒå…¶å¯¹åº”çš„ value å‘é‡åšåŠ æƒå’Œï¼Œä»¥å¾—åˆ°æ¯ä¸ªè¯ç»¼åˆä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¡¨ç¤ºã€‚ç»™å®šå½“å‰ç¬¬ä¸€ä¸ªè¯çš„ query å‘é‡ï¼Œå…¶é¦–å…ˆåŒå„ä¸ªè¯çš„ key å‘é‡é€šè¿‡ç‚¹ç§¯æ“ä½œå¾—åˆ°è¿™ä¸¤ä¸ªè¯çš„å¾—åˆ†ï¼Œè¿™äº›å¾—åˆ†ç”¨æ¥è¡¨ç¤ºè¿™ä¸¤ä¸ªè¯çš„ä¾èµ–æˆ–æ˜¯ç›¸å…³ç¨‹åº¦ã€‚è¿™äº›å¾—åˆ†ä¹‹åä¼šæ ¹æ® query ç­‰å‘é‡çš„ç»´åº¦åšä¸€å®šæ¯”ä¾‹çš„ç¼©æ”¾ï¼Œå¹¶å°†è¿™äº›å¾—åˆ†é€šè¿‡ softmax æ“ä½œåšå½’ä¸€åŒ–ã€‚ä¹‹åï¼Œå„ä¸ªå¾—åˆ†ä¼šåŒå…¶ç›¸å¯¹åº”çš„ value å‘é‡ç›¸ä¹˜å¾—åˆ°é’ˆå¯¹ç¬¬ä¸€ä¸ªè¯åŠ æƒçš„å„ä¸ª value å‘é‡ï¼Œè¿™äº›åŠ æƒçš„ value å‘é‡æœ€ç»ˆç›¸åŠ ä»¥å¾—åˆ°å½“å‰ç¬¬ä¸€ä¸ªè¯çš„ä¸Šä¸‹æ–‡è¡¨ç¤ºã€‚ åœ¨å¾—åˆ°ç¬¬ä¸€ä¸ªè¯çš„ä¸Šä¸‹æ–‡è¡¨ç¤ºåï¼Œç»™å®šç¬¬äºŒä¸ªè¯çš„ query å‘é‡ï¼Œæˆ‘ä»¬ä¼šé‡å¤ä¹‹å‰çš„æ“ä½œï¼Œè®¡ç®—å½“å‰ query å‘é‡åŒå„ä¸ªè¯ key å‘é‡çš„å¾—åˆ†ï¼Œå¯¹è¿™äº›å¾—åˆ†åš softmax å½’ä¸€åŒ–å¤„ç†ï¼Œå¹¶å°†è¿™äº›å¾—åˆ†åŒå…¶å¯¹åº”çš„ value å‘é‡åšåŠ æƒå’Œï¼Œä»¥å¾—åˆ°å…¶ç¼–ç ä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¡¨ç¤ºã€‚ ç¬¬äºŒä¸ªå…³é”®æŠ€æœ¯æ˜¯è‡ªç›‘ç£å­¦ä¹ ã€‚åœ¨é¢„è®­ç»ƒçš„æ¨¡å‹ä¸­ï¼ŒARï¼ˆè‡ªå›å½’ï¼‰LM å’Œ AEï¼ˆè‡ªåŠ¨ç¼–ç å™¨ï¼‰æ˜¯æœ€å¸¸ç”¨çš„è‡ªç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œå…¶ä¸­ï¼Œè‡ªå›å½’ LM æ—¨åœ¨åˆ©ç”¨å‰é¢çš„è¯åºåˆ—é¢„æµ‹ä¸‹ä¸ªè¯çš„å‡ºç°æ¦‚ç‡ï¼ˆè¯­è¨€æ¨¡å‹ï¼‰ã€‚è‡ªåŠ¨ç¼–ç å™¨æ—¨åœ¨å¯¹æŸåçš„è¾“å…¥å¥å­ï¼Œæ¯”å¦‚é®æ©äº†å¥å­æŸä¸ªè¯ã€æˆ–è€…æ‰“ä¹±äº†è¯åºç­‰ï¼Œé‡å»ºåŸå§‹æ•°æ®ã€‚é€šè¿‡è¿™äº›è‡ªç›‘ç£å­¦ä¹ æ‰‹æ®µæ¥å­¦ä¹ å•è¯çš„ä¸Šä¸‹æ–‡ç›¸å…³è¡¨ç¤ºã€‚ ç¬¬ä¸‰ä¸ªå…³é”®æŠ€æœ¯å°±æ˜¯å¾®è°ƒã€‚åœ¨åšå…·ä½“ä»»åŠ¡æ—¶ï¼Œå¾®è°ƒæ—¨åœ¨åˆ©ç”¨å…¶æ ‡æ³¨æ ·æœ¬å¯¹é¢„è®­ç»ƒç½‘ç»œçš„å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚ä»¥æˆ‘ä»¬ä½¿ç”¨åŸºäº BERTï¼ˆä¸€ç§æµè¡Œçš„é¢„è®­ç»ƒæ¨¡å‹ï¼‰ä¸ºä¾‹æ¥åˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯å¦è¯­ä¹‰ç›¸åŒã€‚è¾“å…¥æ˜¯ä¸¤ä¸ªå¥å­ï¼Œç»è¿‡ BERT å¾—åˆ°æ¯ä¸ªå¥å­çš„å¯¹åº”ç¼–ç è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„ç¬¬ä¸€ä¸ªéšèŠ‚ç‚¹é¢„æµ‹åˆ†ç±»æ ‡è®°åˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯åŒä¹‰å¥å­çš„æ¦‚ç‡ï¼ŒåŒæ—¶éœ€è¦é¢å¤–åŠ ä¸€ä¸ªçº¿æ€§å±‚å’Œ softmax è®¡ç®—å¾—åˆ°åˆ†ç±»æ ‡ç­¾çš„åˆ†å¸ƒã€‚é¢„æµ‹æŸå¤±å¯ä»¥åä¼ ç»™ BERT å†å¯¹ç½‘ç»œè¿›è¡Œå¾®è°ƒã€‚å½“ç„¶ä¹Ÿå¯ä»¥é’ˆå¯¹å…·ä½“ä»»åŠ¡è®¾è®¡ä¸€ä¸ªæ–°ç½‘ç»œï¼ŒæŠŠé¢„è®­ç»ƒçš„ç»“æœä½œä¸ºå…¶è¾“å…¥ã€‚ æ€»ä½“æ¥è®²ï¼Œé¢„è®­ç»ƒæ¨¡å‹å‘å±•è¶‹åŠ¿ï¼šç¬¬ä¸€ï¼Œæ¨¡å‹è¶Šæ¥è¶Šå¤§ã€‚æ¯”å¦‚ Transformer çš„å±‚æ•°å˜åŒ–ï¼Œä»12å±‚çš„ Base æ¨¡å‹åˆ°24å±‚çš„ Large æ¨¡å‹ã€‚å¯¼è‡´æ¨¡å‹çš„å‚æ•°è¶Šæ¥è¶Šå¤§ï¼Œæ¯”å¦‚ GPT 110 Mï¼Œåˆ° GPT-2 æ˜¯1.5 Billionï¼Œå›¾çµæ˜¯ 17 Billionï¼Œè€Œ GPT-3 è¾¾åˆ°äº†æƒŠäººçš„ 175 Billionã€‚ä¸€èˆ¬è€Œè¨€æ¨¡å‹å¤§äº†ï¼Œå…¶èƒ½åŠ›ä¹Ÿä¼šè¶Šæ¥è¶Šå¼ºï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·ç¡®å®éå¸¸å¤§ã€‚ç¬¬äºŒï¼Œé¢„è®­ç»ƒæ–¹æ³•ä¹Ÿåœ¨ä¸æ–­å¢åŠ ï¼Œä»è‡ªå›å½’ LMï¼Œåˆ°è‡ªåŠ¨ç¼–ç çš„å„ç§æ–¹æ³•ï¼Œä»¥åŠå„ç§å¤šä»»åŠ¡è®­ç»ƒç­‰ã€‚ç¬¬ä¸‰ï¼Œè¿˜æœ‰ä»è¯­è¨€ã€å¤šè¯­è¨€åˆ°å¤šæ¨¡æ€ä¸æ–­æ¼”è¿›ã€‚æœ€åå°±æ˜¯æ¨¡å‹å‹ç¼©ï¼Œä½¿ä¹‹èƒ½åœ¨å®é™…åº”ç”¨ä¸­ç»æµçš„ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨æ‰‹æœºç«¯ã€‚è¿™å°±æ¶‰åŠåˆ°çŸ¥è¯†è’¸é¦å’Œ teacher-student modelsï¼ŒæŠŠå¤§æ¨¡å‹ä½œä¸º teacherï¼Œè®©ä¸€ä¸ªå°æ¨¡å‹ä½œä¸º student æ¥å­¦ä¹ ï¼Œæ¥è¿‘å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯æ¨¡å‹çš„å‚æ•°å‡å°‘å¾ˆå¤šã€‚ æ¯ä¸ªè§‚ç‚¹éƒ½å¯ä»¥çœ‹ä¸€ä¸‹å‚è€ƒæ–‡ç« ã€‚ ","date":"2022-01-03","objectID":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/:2:0","tags":["NLP","é¢„è®­ç»ƒæ¨¡å‹"],"title":"é¢„è®­ç»ƒæ¨¡å‹","uri":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ·±å±‚è¡¨å¾é˜¶æ®µ åœ¨word embeddingè¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œä»‹ç»äº†ä¼ ç»Ÿçš„è¯å‘é‡ï¼Œä¹Ÿå°±æ˜¯å›ºå®šçš„è¯å‘é‡ã€‚æœ¬æ–‡å°†ä»‹ç»deep contextualizedè¯å‘é‡æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯æ·±å±‚è¡¨å¾é˜¶æ®µã€‚ ä¸¤ä¸ªä¼Ÿå¤§çš„æƒ³æ³•ï¼š ç¼–ç çš„å†…å®¹ï¼šä»å•è¯åˆ°ä¸Šä¸‹æ–‡ä¸­çš„å•è¯ ï¼ˆä» Word2Vec/GloVe/etc. åˆ° Cove/ELMo çš„è¿‡æ¸¡ï¼‰ ç”¨äºä¸‹æ¸¸ä»»åŠ¡ï¼šä»ä»…æ›¿æ¢ç‰¹å®šä»»åŠ¡æ¨¡å‹ä¸­çš„è¯åµŒå…¥åˆ°æ›¿æ¢æ•´ä¸ªç‰¹å®šä»»åŠ¡æ¨¡å‹ ï¼ˆä» Cove/ELMo åˆ° GPT/BERT çš„è¿‡æ¸¡ï¼‰ã€‚ å…·ä½“çš„æ¨¡å‹å¯ä»¥çœ‹æœ¬åšå®¢å…¶ä½™å†…å®¹ã€‚ ","date":"2022-01-03","objectID":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/:3:0","tags":["NLP","é¢„è®­ç»ƒæ¨¡å‹"],"title":"é¢„è®­ç»ƒæ¨¡å‹","uri":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"å‚è€ƒ https://www.zhihu.com/question/327642286 https://zhuanlan.zhihu.com/p/115014536 ","date":"2022-01-03","objectID":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/:4:0","tags":["NLP","é¢„è®­ç»ƒæ¨¡å‹"],"title":"é¢„è®­ç»ƒæ¨¡å‹","uri":"/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"},{"categories":["pandas","api"],"content":"çŸ©é˜µçš„åè½¬ï¼Œå¯ä»¥æŒ‰ç…§å„ä¸ªç»´åº¦å¾ˆå¥½ç†è§£ã€‚ ä¾‹å­ï¼š cs_matrix = np.array([[ 4, 3, 2, 1, 0], [ 8, 7, 6, 5, 1], [11, 10, 9, 6, 2], [13, 12, 10, 7, 3], [14, 13, 11, 8, 4]]) np.flip(cs_matrix, 0) å˜æˆäº†ï¼š np.flip(cs_matrix, 1) å˜æˆäº†ï¼š ","date":"2022-01-01","objectID":"/flip/:0:0","tags":["pandas","api","flip"],"title":"flip","uri":"/flip/"},{"categories":["NLP"],"content":"ELMo åœ¨Transformerä¸­æåˆ°äº†ELMoè§£å†³äº†word2vecä¸­å­˜åœ¨çš„å¤šä¹‰è¯é—®é¢˜ï¼Œå…¶ä½¿ç”¨åŒå‘çš„LSTMä½œä¸ºç‰¹å¾æå–å™¨ï¼Œè€ƒè™‘äº†ä¸Šä¸‹æ–‡çš„è¯­ä¹‰ï¼Œæ‰€ä»¥å¯ä»¥è§£å†³å¤šä¹‰è¯é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« å°±è¯¦ç»†ä»‹ç»ä¸€ä¸‹ELMoã€‚ ElMoä¸CoVeå¾ˆç±»ä¼¼ï¼Œä¸è¿‡å®ƒä¸æ˜¯åŸºäºæœºå™¨ç¿»è¯‘æ¨¡å‹ï¼Œè€Œæ˜¯è¯­è¨€æ¨¡å‹ã€‚ä»…ä»…é€šè¿‡ç”¨æ¥è‡ª LM çš„åµŒå…¥æ›¿æ¢è¯åµŒå…¥ (GloVe)ï¼Œä»–ä»¬å°±åœ¨é—®ç­”ã€å…±æŒ‡è§£æã€æƒ…æ„Ÿåˆ†æã€å‘½åå®ä½“è¯†åˆ«ç­‰å¤šé¡¹ä»»åŠ¡ä¸Šè·å¾—äº†å·¨å¤§çš„æ”¹è¿›ã€‚ ","date":"2021-12-12","objectID":"/elmo/:0:0","tags":["NLP","ELMo"],"title":"ELMo","uri":"/elmo/"},{"categories":["NLP"],"content":"æ¨¡å‹è®­ç»ƒ(char-CNN ä¹‹ä¸Šçš„å‰å‘å’Œåå‘ LSTM-LMs) è¯¥æ¨¡å‹éå¸¸ç®€å•ï¼Œå®ƒç”±ä¸¤å±‚ LSTM è¯­è¨€æ¨¡å‹ç»„æˆï¼šå‰å‘å’Œåå‘ã€‚ä½¿ç”¨è¿™ä¸¤ç§æ¨¡å‹æ˜¯ä¸ºäº†ä½¿æ¯ä¸ªæ ‡è®°éƒ½å¯ä»¥å…·æœ‰ä¸¤ä¸ªä¸Šä¸‹æ–‡ï¼šå·¦å’Œå³ã€‚ åŒæ ·æœ‰è¶£çš„æ˜¯ä½œè€…å¦‚ä½•è·å¾—åˆå§‹å•è¯è¡¨ç¤ºï¼ˆç„¶åå°†å…¶é¦ˆé€åˆ° LSTMï¼‰ã€‚è®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹ï¼Œåœ¨æ ‡å‡†è¯åµŒå…¥å±‚ä¸­ï¼Œå¯¹äºè¯æ±‡è¡¨ä¸­çš„æ¯ä¸ªè¯ï¼Œæˆ‘ä»¬è®­ç»ƒä¸€ä¸ªå”¯ä¸€çš„å‘é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ - è¯åµŒå…¥ä¸çŸ¥é“å®ƒä»¬æ‰€åŒ…å«çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬ä¸çŸ¥é“å•è¯represent,Â represents,Â represented, å’ŒÂ representationåœ¨ä¹¦é¢ä¸Šæ˜¯æ¥è¿‘çš„ï¼‰ - OOVé—®é¢˜ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œä½œè€…å°†å•è¯è¡¨ç¤ºä¸ºå­—ç¬¦çº§ç½‘ç»œçš„è¾“å‡ºã€‚æ­£å¦‚æˆ‘ä»¬ä»æ’å›¾ä¸­çœ‹åˆ°çš„ï¼Œè¿™ä¸ª CNN éå¸¸ç®€å•ï¼Œç”±æˆ‘ä»¬ä¹‹å‰å·²ç»çœ‹åˆ°çš„ç»„ä»¶ç»„æˆï¼šå·ç§¯ã€å…¨å±€æ± åŒ–ã€highway connectionså’Œçº¿æ€§å±‚ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå•è¯è¡¨ç¤ºé€šè¿‡æ„é€ çŸ¥é“å®ƒä»¬çš„å­—ç¬¦ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è¡¨ç¤ºé‚£äº›æˆ‘ä»¬åœ¨è®­ç»ƒä¸­ä»æœªè§è¿‡çš„å•è¯ã€‚ ","date":"2021-12-12","objectID":"/elmo/:1:0","tags":["NLP","ELMo"],"title":"ELMo","uri":"/elmo/"},{"categories":["NLP"],"content":"è·å–è¡¨ç¤º è®­ç»ƒæ¨¡å‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è·å–å•è¯è¡¨ç¤ºã€‚ä¸ºæ­¤ï¼Œå¯¹äºæ¯ä¸ªå•è¯ï¼Œæˆ‘ä»¬ç»“åˆæ¥è‡ªå‰å‘å’Œåå‘ LSTM çš„ç›¸åº”å±‚çš„è¡¨ç¤ºã€‚é€šè¿‡è¿æ¥è¿™äº›å‰å‘å’Œåå‘å‘é‡ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªâ€œçŸ¥é“â€å·¦å³ä¸Šä¸‹æ–‡çš„å•è¯è¡¨ç¤ºã€‚ æ€»ä½“è€Œè¨€ï¼ŒELMo è¡¨ç¤ºå…·æœ‰ä¸‰å±‚ï¼š ç¬¬ 0 å±‚ï¼ˆåµŒå…¥ï¼‰Â - å­—ç¬¦çº§ CNN çš„è¾“å‡ºï¼› ç¬¬ 1 å±‚- æ¥è‡ªå‰å‘å’Œåå‘ LSTM çš„ç¬¬ 1 å±‚çš„è¿æ¥è¡¨ç¤ºï¼› ç¬¬ 2 å±‚- æ¥è‡ªå‰å‘å’Œåå‘ LSTM çš„ç¬¬ 2 å±‚çš„è¿æ¥è¡¨ç¤ºï¼› è¿™äº›å±‚ä¸­çš„æ¯ä¸€å±‚éƒ½å¯¹ä¸åŒç±»å‹çš„ä¿¡æ¯è¿›è¡Œç¼–ç ï¼šç¬¬ 0 å±‚ - ä»…å•è¯çº§åˆ«ï¼Œç¬¬ 1 å±‚å’Œç¬¬ 2 å±‚ - ä¸Šä¸‹æ–‡ä¸­çš„å•è¯ã€‚æ¯”è¾ƒç¬¬ 1 å±‚å’Œç¬¬ 2 å±‚ï¼Œç¬¬ 2 å±‚å¯èƒ½åŒ…å«æ›´å¤šé«˜çº§ä¿¡æ¯ï¼šè¿™äº›è¡¨ç¤ºæ¥è‡ªç›¸åº” LM çš„æ›´é«˜å±‚ã€‚ ç”±äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡éœ€è¦ä¸åŒç§ç±»çš„ä¿¡æ¯ï¼ŒELMo ä½¿ç”¨ç‰¹å®šäºä»»åŠ¡çš„æƒé‡æ¥ç»„åˆæ¥è‡ªä¸‰å±‚çš„è¡¨ç¤ºã€‚è¿™äº›æ˜¯ä¸ºæ¯ä¸ªä¸‹æ¸¸ä»»åŠ¡å­¦ä¹ çš„æ ‡é‡ã€‚å¾—åˆ°çš„å‘é‡ï¼Œå³æ‰€æœ‰å±‚è¡¨ç¤ºçš„åŠ æƒå’Œï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå•è¯ã€‚ ","date":"2021-12-12","objectID":"/elmo/:2:0","tags":["NLP","ELMo"],"title":"ELMo","uri":"/elmo/"},{"categories":["NLP"],"content":"æ€»ç»“ CoVeå’ŒELMoéƒ½ç”¨äº†ä¸Šä¸‹æ–‡å•è¯ï¼Œè§£å†³äº†word2vecä¸­å¤šä¹‰è¯çš„é—®é¢˜ã€‚ä½†ä»–ä»¬ä¸»è¦æ˜¯æ›¿æ¢åµŒå…¥å±‚ï¼Œå¹¶ä¿æŒç‰¹å®šäºä»»åŠ¡çš„æ¨¡å‹æ¶æ„å‡ ä¹å®Œå¥½æ— æŸã€‚è¿™æ„å‘³ç€ä¾‹å¦‚ï¼Œå¯¹äºå…±æŒ‡è§£å†³ï¼Œå¿…é¡»ä½¿ç”¨ä¸ºæ­¤ä»»åŠ¡è®¾è®¡çš„ç‰¹å®šæ¨¡å‹ï¼Œç”¨äºè¯æ€§æ ‡è®° - ä¸€äº›å…¶ä»–æ¨¡å‹ï¼Œç”¨äºé—®ç­” - å¦ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„æ¨¡å‹ç­‰ã€‚å¯¹äºè¿™äº›ä»»åŠ¡ä¸­çš„æ¯ä¸€ä¸ªï¼Œä¸“é—¨ç ”ç©¶å®ƒçš„ç ”ç©¶äººå‘˜ä¸æ–­æ”¹è¿›ç‰¹å®šäºä»»åŠ¡çš„æ¨¡å‹æ¶æ„ã€‚ ä¸ä»¥å‰çš„æ¨¡å‹ç›¸æ¯”ï¼ŒGPT/BERT ä¸æ˜¯ä½œä¸ºè¯åµŒå…¥çš„æ›¿ä»£å“ï¼Œè€Œæ˜¯ä½œä¸ºç‰¹å®šä»»åŠ¡æ¨¡å‹çš„æ›¿ä»£å“ã€‚åœ¨è¿™ä¸ªæ–°è®¾ç½®ä¸­ï¼Œé¦–å…ˆä½¿ç”¨å¤§é‡æœªæ ‡è®°æ•°æ®ï¼ˆçº¯æ–‡æœ¬ï¼‰å¯¹æ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒã€‚ç„¶åï¼Œè¯¥æ¨¡å‹åœ¨æ¯ä¸ªä¸‹æ¸¸ä»»åŠ¡ä¸Šè¿›è¡Œå¾®è°ƒã€‚é‡è¦çš„æ˜¯ï¼Œç°åœ¨åœ¨å¾®è°ƒæœŸé—´ï¼Œæ‚¨å¿…é¡»åªä½¿ç”¨ä»»åŠ¡æ„ŸçŸ¥è¾“å…¥è½¬æ¢ï¼ˆå³ä»¥æŸç§æ–¹å¼æä¾›æ•°æ®ï¼‰ï¼ŒÂ è€Œä¸æ˜¯Â ä¿®æ”¹æ¨¡å‹æ¶æ„ã€‚ ","date":"2021-12-12","objectID":"/elmo/:3:0","tags":["NLP","ELMo"],"title":"ELMo","uri":"/elmo/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"Stacking ","date":"2021-11-25","objectID":"/stacking/:0:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Stacking"],"title":"Stacking","uri":"/stacking/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"æ€æƒ³ç®€ä»‹ ç®€å•å¾—ç†è§£ï¼Œå°±æ˜¯å¯¹äºå¤šä¸ªå­¦ä¹ å™¨ï¼Œåˆ†åˆ«å¯¹ç»“æœè¿›è¡Œé¢„æµ‹ï¼Œç„¶åå°†é¢„æµ‹çš„ç»“æœä½œä¸ºç‰¹å¾ï¼Œå†å¯¹ç»“æœè¿›è¡Œé¢„æµ‹ã€‚ ä¸Šä¸€å¼ ç»å…¸çš„å›¾ï¼š ä»¥è¿™ä¸ª5æŠ˜stackingä¸ºä¾‹ï¼š é¦–å…ˆå°†æ‰€æœ‰æ•°æ®é›†ç”Ÿæˆæµ‹è¯•é›†å’Œè®­ç»ƒé›†ï¼ˆå‡å¦‚è®­ç»ƒé›†ä¸º10000,æµ‹è¯•é›†ä¸º2500è¡Œï¼‰ï¼Œé‚£ä¹ˆä¸Šå±‚ä¼šè¿›è¡Œ5æŠ˜äº¤å‰æ£€éªŒï¼Œä½¿ç”¨è®­ç»ƒé›†ä¸­çš„8000æ¡ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™2000è¡Œä½œä¸ºéªŒè¯é›†ï¼ˆæ©™è‰²ï¼‰ã€‚ æ¯æ¬¡éªŒè¯ç›¸å½“äºä½¿ç”¨äº†è“è‰²çš„8000æ¡æ•°æ®è®­ç»ƒå‡ºä¸€ä¸ªæ¨¡å‹ï¼Œä½¿ç”¨æ¨¡å‹å¯¹éªŒè¯é›†è¿›è¡ŒéªŒè¯å¾—åˆ°2000æ¡æ•°æ®ï¼Œå¹¶å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°2500æ¡æ•°æ®ï¼Œè¿™æ ·ç»è¿‡5æ¬¡äº¤å‰æ£€éªŒï¼Œå¯ä»¥å¾—åˆ°ä¸­é—´çš„æ©™è‰²çš„\\(5\\times 2000\\)æ¡éªŒè¯é›†çš„ç»“æœ(ç›¸å½“äºæ¯æ¡æ•°æ®çš„é¢„æµ‹ç»“æœ)ï¼Œ\\(5\\times 2500\\)æ¡æµ‹è¯•é›†çš„é¢„æµ‹ç»“æœã€‚ æ¥ä¸‹æ¥ä¼šå°†éªŒè¯é›†çš„\\(5\\times 2000\\)æ¡é¢„æµ‹ç»“æœæ‹¼æ¥æˆ10000è¡Œé•¿çš„çŸ©é˜µï¼Œæ ‡è®°ä¸ºA1ï¼Œè€Œå¯¹äº\\(5\\times 2500\\)è¡Œçš„æµ‹è¯•é›†çš„é¢„æµ‹ç»“æœè¿›è¡ŒåŠ æƒå¹³å‡ï¼Œå¾—åˆ°ä¸€ä¸ª2500ä¸€åˆ—çš„çŸ©é˜µï¼Œæ ‡è®°ä¸ºB1ã€‚ ä¸Šé¢å¾—åˆ°ä¸€ä¸ªåŸºæ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„é¢„æµ‹ç»“æœA1ã€B1,è¿™æ ·å½“æˆ‘ä»¬å¯¹3ä¸ªåŸºæ¨¡å‹è¿›è¡Œé›†æˆçš„è¯ï¼Œç›¸äºå¾—åˆ°äº†A1ã€A2ã€A3ã€B1ã€B2ã€B3å…­ä¸ªçŸ©é˜µã€‚ ä¹‹åæˆ‘ä»¬ä¼šå°†A1ã€A2ã€A3å¹¶åˆ—åœ¨ä¸€èµ·æˆ10000è¡Œ3åˆ—çš„çŸ©é˜µä½œä¸ºtraining data,B1ã€B2ã€B3åˆå¹¶åœ¨ä¸€èµ·æˆ2500è¡Œ3åˆ—çš„çŸ©é˜µä½œä¸ºtesting dataï¼Œè®©ä¸‹å±‚å­¦ä¹ å™¨åŸºäºè¿™æ ·çš„æ•°æ®è¿›è¡Œå†è®­ç»ƒã€‚ å†è®­ç»ƒæ˜¯åŸºäºæ¯ä¸ªåŸºç¡€æ¨¡å‹çš„é¢„æµ‹ç»“æœä½œä¸ºç‰¹å¾ï¼ˆä¸‰ä¸ªç‰¹å¾ï¼‰ï¼Œæ¬¡å­¦ä¹ å™¨ä¼šå­¦ä¹ è®­ç»ƒå¦‚æœå¾€è¿™æ ·çš„åŸºå­¦ä¹ çš„é¢„æµ‹ç»“æœä¸Šèµ‹äºˆæƒé‡wï¼Œæ¥ä½¿å¾—æœ€åçš„é¢„æµ‹æœ€ä¸ºå‡†ç¡®ã€‚ ","date":"2021-11-25","objectID":"/stacking/:1:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Stacking"],"title":"Stacking","uri":"/stacking/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ "],"content":"ä¼ªä»£ç  ","date":"2021-11-25","objectID":"/stacking/:2:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Stacking"],"title":"Stacking","uri":"/stacking/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å‚è€ƒï¼šhttps://cuijiahua.com/blog/2017/11/ml_11_regression_1.html ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:0:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"ä»€ä¹ˆæ˜¯å›å½’ï¼Ÿ å›å½’çš„ç›®çš„æ˜¯é¢„æµ‹æ•°å€¼å‹çš„ç›®æ ‡å€¼ã€‚æœ€ç›´æ¥çš„åŠæ³•æ˜¯ä¾æ®è¾“å…¥å†™å‡ºä¸€ä¸ªç›®æ ‡å€¼çš„è®¡ç®—å…¬å¼ã€‚ HorsePower = 0.0015 * annualSalary - 0.99 * hoursListeningToPublicRadio è¿™å°±æ˜¯æ‰€è°“çš„å›å½’æ–¹ç¨‹ï¼ˆregression equationï¼‰ï¼Œå…¶ä¸­çš„0.0015å’Œ-0.99ç§°ä¸ºå›å½’ç³»æ•°ï¼ˆregression weightsï¼‰ï¼Œæ±‚è¿™äº›å›å½’ç³»æ•°çš„è¿‡ç¨‹å°±æ˜¯å›å½’ã€‚ä¸€æ—¦æœ‰äº†è¿™äº›å›å½’ç³»æ•°ï¼Œå†ç»™å®šè¾“å…¥ï¼Œåšé¢„æµ‹å°±éå¸¸å®¹æ˜“äº†ã€‚å…·ä½“çš„åšæ³•æ˜¯ç”¨å›å½’ç³»æ•°ä¹˜ä»¥è¾“å…¥å€¼ï¼Œå†å°†ç»“æœå…¨éƒ¨åŠ åœ¨ä¸€èµ·ï¼Œå°±å¾—åˆ°äº†é¢„æµ‹å€¼ã€‚ è¯´åˆ°å›å½’ï¼Œä¸€èˆ¬éƒ½æ˜¯æŒ‡çº¿æ€§å›å½’ï¼ˆlinear regressionï¼‰ï¼Œæ‰€ä»¥æœ¬æ–‡é‡Œçš„å›å½’å’Œçº¿æ€§å›å½’ä»£è¡¨åŒä¸€ä¸ªæ„æ€ã€‚çº¿æ€§å›å½’æ„å‘³ç€å¯ä»¥å°†è¾“å…¥é¡¹åˆ†åˆ«ä¹˜ä»¥ä¸€äº›å¸¸é‡ï¼Œå†å°†ç»“æœåŠ èµ·æ¥å¾—åˆ°è¾“å‡ºã€‚ è¿™é‡Œçš„çº¿æ€§å¯ä»¥æ˜¯å¯¹å˜é‡çš„çº¿æ€§ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹å‚æ•°çš„çº¿æ€§ã€‚æ¯”å¦‚\\(y=x^2\\)å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¿æ€§å‡½æ•°ã€‚ ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:1:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"æ­£è§„æ–¹ç¨‹æ¨å¯¼ å°†å‘é‡è¡¨è¾¾å½¢å¼è½¬ä¸ºçŸ©é˜µè¡¨è¾¾å½¢å¼ï¼Œåˆ™æœ‰ \\(J(\\theta)=\\frac{1}{2}(X \\theta-y)^{2}\\) ï¼Œå…¶ä¸­ \\(X\\) ä¸º \\(m\\) è¡Œ \\(n\\) åˆ—çš„çŸ©é˜µï¼ˆ \\(m\\) ä¸ºæ ·æœ¬ä¸ªæ•°ï¼Œ \\(n\\) ä¸ºç‰¹ å¾ä¸ªæ•°)ï¼Œ \\(\\theta\\) ä¸º \\(n\\) è¡Œ1åˆ—çš„çŸ©é˜µï¼Œ \\(y\\) ä¸º \\(m\\) è¡Œ1åˆ—çš„çŸ©é˜µï¼Œå¯¹ \\(J(\\theta)\\) è¿›è¡Œå¦‚ä¸‹å˜æ¢ \\[ \\begin{aligned} \u0026J(\\theta)=\\frac{1}{2}(X \\theta-y)^{T}(X \\theta-y) \\\\\\\\ \u0026=\\frac{1}{2}\\left(\\theta^{T} X^{T}-y^{T}\\right)(X \\theta-y) \\\\\\\\ \u0026=\\frac{1}{2}\\left(\\theta^{T} X^{T} X \\theta-\\theta^{T} X^{T} y-y^{T} X \\theta-y^{T} y\\right) \\end{aligned} \\] æ¥ä¸‹æ¥å¯¹ \\(J(\\theta)\\) åå¯¼ï¼Œéœ€è¦ç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªçŸ©é˜µçš„æ±‚å¯¼æ³•åˆ™: \\[ \\begin{aligned} \u0026\\frac{d A B}{d B}=A^{T} \\\\\\\\ \u0026\\frac{d X^{T} A X}{d X}=2 A X \\end{aligned} \\] æ‰€ä»¥æœ‰: \\[ \\begin{aligned} \u0026\\frac{\\partial J(\\theta)}{\\partial \\theta}=\\frac{1}{2}\\left(2 X^{T} X \\theta-X^{T} y-\\left(y^{T} X\\right)^{T}-0\\right) \\\\\\\\ \u0026=\\frac{1}{2}\\left(2 X^{T} X \\theta-X^{T} y-X^{T} y-0\\right) \\\\\\\\ \u0026=X^{T} X \\theta-X^{T} y \\\\\\\\ \u0026\\text { ä»¤ } \\frac{\\partial J(\\theta)}{\\partial \\theta}=0 ï½ \\\\\\\\ {\\text { åˆ™æœ‰ } \\theta=\\left(X^{T} X\\right)^{-1} X^{T} y} \\end{aligned} \\] å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°å…¬å¼ä¸­åŒ…å«é€†çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹ç¨‹åªåœ¨é€†çŸ©é˜µå­˜åœ¨çš„æ—¶å€™ä½¿ç”¨ï¼Œä¹Ÿå³æ˜¯è¿™ä¸ªçŸ©é˜µæ˜¯ä¸€ä¸ªæ–¹é˜µï¼Œå¹¶ä¸”å…¶è¡Œåˆ—å¼ä¸ä¸º0ã€‚ é™¤äº†è¿™ç§æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ€å°äºŒä¹˜æ³•æ¥è§£å†³ã€‚ ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:2:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å±€éƒ¨åŠ æƒçº¿æ€§å›å½’ çº¿æ€§å›å½’çš„ä¸€ä¸ªé—®é¢˜æ˜¯æœ‰å¯èƒ½å‡ºç°æ¬ æ‹Ÿåˆç°è±¡ï¼Œå› ä¸ºå®ƒæ±‚çš„æ˜¯å…·æœ‰å°å‡æ–¹è¯¯å·®çš„æ— åä¼° è®¡ã€‚æ˜¾è€Œæ˜“è§ï¼Œå¦‚æœæ¨¡å‹æ¬ æ‹Ÿåˆå°†ä¸èƒ½å–å¾—å¥½çš„é¢„æµ‹æ•ˆæœã€‚æ‰€ä»¥æœ‰äº›æ–¹æ³•å…è®¸åœ¨ä¼°è®¡ä¸­å¼•å…¥ä¸€ äº›åå·®ï¼Œä»è€Œé™ä½é¢„æµ‹çš„å‡æ–¹è¯¯å·®ã€‚ å…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å±€éƒ¨åŠ æƒçº¿æ€§å›å½’ï¼ˆLocally Weighted Linear Regressionï¼ŒLWLRï¼‰ã€‚ æ™®é€šçº¿æ€§å›å½’: \\[ \\min J_R=\\sum_{i=1}^m\\left(g\\left(x_i\\right)-y_i\\right)^2 \\] å±€éƒ¨åŠ æƒçº¿æ€§å›å½’: \\[ \\min J_{L R}=\\sum_{i=1}^m \\theta_i\\left(g\\left(x_i\\right)-y_i\\right)^2 \\] è¿™é‡Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åŠ å…¥äº†æƒé‡ \\(\\theta\\), é‡‡ç”¨ä¹‹å‰çš„æœ€å°äºŒä¹˜æ³•æ±‚è§£æƒæ•° \\(\\mathbf{w}\\) : \\[ \\hat{\\mathbf{w}}^* =\\arg \\min_{\\hat{\\mathbf{w}}} \\theta(\\mathbf{y}-\\mathbf{X} \\hat{\\mathbf{w}})^T(\\mathbf{y}-\\mathbf{X} \\hat{\\mathbf{w}}) \\] åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç»™å¾…é¢„æµ‹ç‚¹é™„è¿‘çš„æ¯ä¸ªç‚¹èµ‹äºˆä¸€å®šçš„æƒé‡ã€‚ä¸kNNä¸€æ ·ï¼Œè¿™ç§ç®—æ³•æ¯æ¬¡é¢„æµ‹å‡éœ€è¦äº‹å…ˆé€‰å–å‡ºå¯¹åº”çš„æ•°æ®å­é›†ã€‚è¯¥ç®—æ³•è§£é™¤å›å½’ç³»æ•°Wçš„å½¢å¼å¦‚ä¸‹ï¼š \\[ \\hat{w} = (X^T\\theta X)^{-1}X^T\\theta y \\] å…¶ä¸­Wæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œè¿™ä¸ªå…¬å¼è·Ÿæˆ‘ä»¬ä¸Šé¢æ¨å¯¼çš„å…¬å¼çš„åŒºåˆ«å°±åœ¨äºWï¼Œå®ƒç”¨æ¥ç»™æ¯ä¸ªåº—èµ‹äºˆæƒé‡ã€‚ LWLRä½¿ç”¨â€æ ¸â€ï¼ˆä¸æ”¯æŒå‘é‡æœºä¸­çš„æ ¸ç±»ä¼¼ï¼‰æ¥å¯¹é™„è¿‘çš„ç‚¹èµ‹äºˆæ›´é«˜çš„æƒé‡ã€‚æ ¸çš„ç±»å‹å¯ä»¥è‡ªç”±é€‰æ‹©ï¼Œæœ€å¸¸ç”¨çš„æ ¸å°±æ˜¯é«˜æ–¯æ ¸ï¼Œé«˜æ–¯æ ¸å¯¹åº”çš„æƒé‡å¦‚ä¸‹ï¼š \\[ \\theta(i,i) = exp\\left ( \\frac{ (x^{(i)}-x)^2}{-2k^2}\\right) \\] è¿™æ ·å°±æ„é€ äº†ä¸€ä¸ªåªå«å¯¹è§’å…ƒç´ çš„æƒé‡çŸ©é˜µ \\(w\\) ï¼Œå¹¶ä¸”ç‚¹xiä¸ \\(x\\) è¶Šæ¥è¿‘ï¼Œ \\(\\theta(i, i)\\) çš„å€¼è¶Šå¤§ï¼Œå½“ \\(x i\\) ä¸ \\(x\\) éå¸¸æ¥è¿‘æ—¶ï¼Œ \\(\\theta(i, i)\\) çš„å€¼è¶‹äº 1 ï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ä¹‹å‰çš„ä¼˜åŒ–å¼: \\[ \\min J_{L R}=\\sum_{i=1}^m \\theta_i\\left(g\\left(x_i\\right)-y_i\\right)^2 \\] å¯¹äºä¸€ä¸ªæ•°æ®ç‚¹ï¼Œä¸å…¶é è¿‘çš„ç‚¹ï¼Œæƒé‡å¤§ï¼Œä¸å…¶ç›¸è·è¾ƒè¿œçš„ç‚¹ï¼Œæƒé‡å°ï¼Œä»è€Œä¼˜åŒ–é—®é¢˜ä¼šæœ‰æ‰€åå€šï¼Œé è¿‘çš„ç‚¹å¯¹è¯¥æ•°æ®ç‚¹çš„å›å½’æ‹Ÿåˆèµ·è¾ƒå¤§ä½œç”¨ï¼Œè€Œç›¸è·è¾ƒè¿œçš„ ç‚¹ç”±äºæƒæ•°å¾ˆå°ï¼Œé€ æˆçš„å½±å“åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œè¿™æ ·å°±ç­‰åŒäºæ¯ä¸ªç‚¹çš„å›å½’éƒ½æ˜¯åŸºäºä¸å…¶ç›¸è·è¾ƒè¿‘çš„ç‚¹ä¸ºåŸºç¡€ï¼Œè€Œå¿½ç•¥äº†è¾ƒè¿œçš„ç‚¹ï¼Œè¿™ä¹Ÿå°±æ˜¯åŒéƒ¨åŠ æƒçº¿æ€§å›å½’å±€éƒ¨çš„ç”±æ¥ï¼Œå› ä¸ºå®ƒç€é‡è€ƒè™‘ç›®æ ‡ç‚¹åŒéƒ¨çš„æ•°æ®ç‚¹ä¸ºå›å½’åŸºç¡€. å¯ä»¥çœ‹åˆ°ï¼ŒåŠ æƒå‡½æ•°åªæœ‰ä¸€ä¸ªç³»æ•°ï¼Œé‚£å°±æ˜¯åˆ†æ¯ä¸Šçš„ \\(k\\) ï¼Œå½“Kå–å¾ˆå°æ—¶ï¼Œ expå¾—åˆ°çš„å¾ˆå¤šå€¼å‡è¶‹äº 0 ï¼Œæ­¤æ—¶åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†æ ·æœ¬ç”¨äºè®­ç»ƒï¼Œè€Œå½“kå–å¾ˆå¤§æ—¶ï¼Œ expçš„å€¼ ä¸ä¼šå¾ˆå¿«è¶‹äº 0 ï¼Œä»è€Œä¼šæœ‰ä¸€å¤§éƒ¨åˆ†ç‚¹ç”¨äºè®­ç»ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´kçš„å€¼ï¼Œå†³å®šè¿™ä¸ªâ€˜å±€éƒ¨â€™çš„å¤§å°ç©¶ç«Ÿæ˜¯å¤šå¤§ å¦‚æœæ•°æ®çš„ç‰¹å¾æ¯”æ ·æœ¬ç‚¹è¿˜å¤šåº”è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœçŸ©é˜µæœ‰å¤šé‡å…±çº¿æ€§æ€ä¹ˆåŠï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ä¸Šæ–‡çš„æ–¹æ³•è¿›è¡Œè®¡ç®—äº†ï¼Œå› ä¸ºçŸ©é˜µXä¸æ˜¯æ»¡ç§©çŸ©é˜µï¼Œéæ»¡ç§©çŸ©é˜µåœ¨æ±‚é€†æ—¶ä¼šå‡ºç°é—®é¢˜ã€‚ è§£å†³çš„æ–¹æ³•å°±æ˜¯æ­£åˆ™åŒ–ã€‚åœ¨çº¿æ€§å›å½’ä¸­ï¼Œæ­£åˆ™åŒ–ä¸»è¦æœ‰L1æ­£åˆ™åŒ–ä¸L2æ­£åˆ™åŒ–ï¼ŒL1æ­£åˆ™åŒ–å¯¹åº”LASSOå›å½’ï¼ŒL2æ­£åˆ™åŒ–å¯¹åº”å²­å›å½’ã€‚ #!/usr/bin/env python #-*- coding:utf-8 -*- from numpy import * import matplotlib.pyplot as plt \"\"\" æ‰“å¼€ä¸€ä¸ªç”¨tabé”®åˆ†éš”çš„æ–‡æœ¬æ–‡ä»¶ parameters: fileName -æ–‡ä»¶å return: dataMat -æ•°æ®çŸ©é˜µ labelMat -ç›®æ ‡å€¼å‘é‡ \"\"\" def loadDataSet(fileName): numFeat = len(open(fileName).readline().split('\\t')) - 1 #å¾—åˆ°åˆ—æ•°ï¼Œä¸åŒ…æ‹¬æœ€åä¸€åˆ—ï¼Œé»˜è®¤æœ€åä¸€åˆ—å€¼ä¸ºç›®æ ‡å€¼ dataMat = []; labelMat = [] fr = open(fileName) for line in fr.readlines(): lineArr =[] curLine = line.strip().split('\\t') for i in range(numFeat): lineArr.append(float(curLine[i])) dataMat.append(lineArr) labelMat.append(float(curLine[-1])) return dataMat,labelMat \"\"\" è®¡ç®—æœ€ä½³æ‹Ÿåˆç›´çº¿ parameters: xArr -ç»™å®šçš„è¾“å…¥å€¼ yArr -ç»™å®šçš„è¾“å‡ºå€¼ return: ws -å›å½’ç³»æ•° \"\"\" def standRegres(xArr,yArr): xMat = mat(xArr); yMat = mat(yArr).T #å°†æ•°æ®ä¿å­˜åˆ°çŸ©é˜µä¸­ #è®¡ç®—x.T *x xTx = xMat.T @ xMat #ä½¿ç”¨linalg.det()æ–¹æ³•æ¥åˆ¤æ–­å®ƒçš„è¡Œåˆ—å¼æ˜¯å¦ä¸ºé›¶ï¼Œå³æ˜¯å¦å¯é€† if linalg.det(xTx) == 0.0: return #ä½¿ç”¨æœ€å°äºŒä¹˜æ³•è®¡ç®—wå€¼ ws = linalg.inv(xTx) @ xMat.T @ yMat return ws \"\"\" è®¡ç®—å±€éƒ¨åŠ æƒçº¿æ€§å›å½’ç³»æ•° parameters: testPoint -å¾…é¢„æµ‹æ•°æ® xArr -ç»™å®šè¾“å…¥å€¼ yArr -ç»™å®šè¾“å‡ºå€¼ k -é«˜æ–¯æ ¸çš„kå€¼ï¼Œå†³å®šå¯¹é™„è¿‘çš„ç‚¹èµ‹äºˆå¤šå¤§çš„æƒé‡ return: testPoint * ws -å›å½’é¢„æµ‹çš„ä¼°è®¡å€¼ \"\"\" def lwlr(testPoint, xArr, yArr, k=1.0): xMat = mat(xArr); yMat = mat(yArr).T #è¯»å…¥æ•°æ®åˆ°çŸ©é˜µ m = shape(xMat)[0] #åˆ›å»ºå¯¹è§’æƒé‡çŸ©é˜µï¼Œè¯¥çŸ©é˜µä¸ºæ–¹é˜µï¼ŒçŸ©é˜µç»´æ•°ä¸ºæ ·æœ¬ç‚¹ä¸ªæ•° theta = eye(m, m) #éå†æ•´ä¸ªæ•°æ®é›† for i, x in enumerate(xMat): #è®¡ç®—å¾…é¢„æµ‹æ•°æ®ä¸æ¯ä¸ªæ ·æœ¬ç‚¹çš„å·®å€¼ x_i = (testPoint - x) @ (testPoint - x).T #è®¡ç®—æ¯ä¸ªæ ·æœ¬ç‚¹å¯¹åº”çš„æƒé‡å€¼ï¼Œéšç€æ ·æœ¬ç‚¹ä¸å¾…é¢„æµ‹ç‚¹è·ç¦»çš„é€’å¢ï¼Œæƒé‡å°†ä»¥æŒ‡æ•°çº§è¡°å‡ theta[i][i] = exp(x_i / (-2 * k ** 2)) #è®¡ç®—x.T Î¸ x xT_theta_x = xMat.T @ theta @ xMat #åˆ¤æ–­çŸ©é˜µæ˜¯å¦å¯é€† if linalg.det(xT_theta_x) == 0: return #ä½¿ç”¨æœ€å°äºŒä¹˜æ³•è®¡ç®—wå€¼ ws = linalg.inv(xT_theta_x) @ (xMat.T @ (theta @ yMat)) return testPoint*ws \"\"\" æµ‹è¯•å‡½æ•° parameters: testArr -æµ‹è¯•æ•°æ®é›† xArr -ç»™å®šè¾“å…¥å€¼ yArr -ç»™å®šè¾“å‡ºå€¼ k -é«˜æ–¯æ ¸çš„kå€¼ return: yHat -é¢„æµ‹å€¼ \"\"\" def lwlrTest(testArr, xArr, yArr,k=1.0): m = shape(xArr)[0] yHat = zeros(m) for i in range(m): yHat[i] = lwlr(testArr[i],xArr,yArr,k) return yHat \"\"\" è®¡ç®—é¢„æµ‹è¯¯å·®çš„å¹³æ–¹å’Œ parameters: yArr -ç»™å®šyå€¼ yHatArr -é¢„æµ‹yå€¼ return: ((yArr-yHatArr)**2).sum() -è¯¯å·®çŸ©é˜µ \"\"\" def rssError(yArr,yHatArr): return ((yArr-yHatArr)**2).sum() if __name__=='__main__': abX,abY = loadDataSet('linear_regression_abalone/abalone.txt') yHat01 = lwlrTest(abX[0:99],abX[0:99],abY[0:99],0.1) yHat1 = lwlrTest(abX[0:99],abX[0:99],abY[0:99],1) yHat10 = lwlrTest(abX[0:99],abX[0:99],abY[0:99],10) print(\"ä½¿ç”¨å±€éƒ¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹è¯¯å·®ï¼š\") print(\"æ ¸ä¸º0.1æ—¶ï¼š\",rssError(abY[0:99],yHat01.T)) print(\"æ ¸ä¸º1æ—¶ï¼š\",rssError(abY[0:99],yHat1.T)) print(\"æ ¸ä¸º10æ—¶ï¼š\",rssError(abY[0:99],yHat10.T)) yHat01 = lwlrTest(abX[100:199],abX[0:99],abY[0:99],0.1) yHat1 = lwlrTest(abX[100:199],abX[0:99],abY[0:99],1) yHat10 = lwlrTest(abX[100:199],abX[0:99],abY[0:99],10) print(\"ä½¿ç”¨å±€éƒ¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹è¯¯å·®åœ¨æ–°æ•°æ®ä¸Šçš„è¡¨ç°ï¼š","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:3:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å²­å›å½’ å²­å›å½’å³æˆ‘ä»¬æ‰€è¯´çš„L2æ­£åˆ™çº¿æ€§å›å½’ï¼Œåœ¨ä¸€èˆ¬çš„çº¿æ€§å›å½’æœ€å°åŒ–å‡æ–¹è¯¯å·®çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªå‚æ•°wçš„L2èŒƒæ•°çš„ç½šé¡¹ï¼Œä»è€Œæœ€å°åŒ–ç½šé¡¹æ®‹å·®å¹³æ–¹å’Œï¼š \\[ min\\mid \\mid Xw-y \\mid\\mid_2^2 + \\lambda \\mid\\mid w\\mid\\mid_2^2 \\] ç®€å•è¯´æ¥ï¼Œå²­å›å½’å°±æ˜¯åœ¨æ™®é€šçº¿æ€§å›å½’çš„åŸºç¡€ä¸Šå¼•å…¥å•ä½çŸ©é˜µã€‚å›å½’ç³»æ•°çš„è®¡ç®—å…¬å¼å˜å½¢å¦‚ä¸‹ï¼š \\[ \\hat{w} = (X^TX+\\lambda I)^{-1}X^Ty \\] å¼ä¸­ï¼ŒçŸ©é˜µIæ˜¯ä¸€ä¸ªmxmçš„å•ä½çŸ©é˜µï¼ŒåŠ ä¸Šä¸€ä¸ªÎ»Iä»è€Œä½¿å¾—çŸ©é˜µéå¥‡å¼‚ï¼Œè¿›è€Œèƒ½å¯¹çŸ©é˜µæ±‚é€†ã€‚ å½“\\(\\lambda\\)è¿‡å°ï¼Œåˆ™ç›¸å½“äºåŸæ¥çš„æ­£è§„æ–¹ç¨‹ï¼Œä¼šé€ æˆè¿‡æ‹Ÿåˆï¼Œè€Œ\\(\\lambda\\)è¿‡å¤§æ—¶ï¼Œæ¨¡å‹çš„æ–¹å·®ä¼šæ›´å°ï¼Œä½†åå·®ä¼šå˜å¤§ï¼Œæ‰€ä»¥å²­å›å½’çš„å…³é”®æ˜¯æ‰¾åˆ°ä¸€ä¸ªåˆç†çš„\\(\\lambda\\)å€¼æ¥å¹³è¡¡æ¨¡å‹çš„æ–¹å·®å’Œåå·®ã€‚ å²­å›å½’æœ€å…ˆç”¨æ¥å¤„ç†ç‰¹å¾æ•°å¤šäºæ ·æœ¬æ•°çš„æƒ…å†µï¼Œç°åœ¨ä¹Ÿç”¨äºåœ¨ä¼°è®¡ä¸­åŠ å…¥åå·®ï¼Œä»è€Œå¾—åˆ°æ›´å¥½çš„ä¼°è®¡ã€‚è¿™é‡Œé€šè¿‡å¼•å…¥Î»æ¥é™åˆ¶äº†æ‰€æœ‰wä¹‹å’Œï¼Œé€šè¿‡å¼•å…¥è¯¥æƒ©ç½šé¡¹ï¼Œèƒ½å¤Ÿå‡å°‘ä¸é‡è¦çš„å‚æ•°ï¼Œè¿™ä¸ªæŠ€æœ¯åœ¨ç»Ÿè®¡å­¦ä¸­ä¹Ÿå¯ä»¥å«åšç¼©å‡ï¼ˆshrinkageï¼‰ã€‚ ç¼©å‡æ–¹æ³•å¯ä»¥å»æ‰ä¸é‡è¦çš„å‚æ•°ï¼Œå› æ­¤èƒ½æ›´å¥½åœ°è£‚è§£æ•°æ®ã€‚æ­¤å¤–ï¼Œä¸ç®€å•çš„çº¿æ€§å›å½’ç›¸æ¯”ï¼Œç¼©å‡æ³•èƒ½å¤Ÿå–å¾—æ›´å¥½çš„é¢„æµ‹æ•ˆæœã€‚ å›¾ç»˜åˆ¶äº†å›å½’ç³»æ•°ä¸log(Î»)çš„å…³ç³»ã€‚åœ¨æœ€å·¦è¾¹ï¼Œå³Î»æœ€å°æ—¶ï¼Œå¯ä»¥å¾—åˆ°æ‰€æœ‰ç³»æ•°çš„åŸå§‹å€¼ï¼ˆä¸çº¿æ€§å›å½’ä¸€è‡´ï¼‰ï¼›è€Œåœ¨å³è¾¹ï¼Œç³»æ•°å…¨éƒ¨ç¼©å‡æˆ0ï¼›åœ¨ä¸­é—´éƒ¨åˆ†çš„æŸä¸ªä½ç½®ï¼Œå°†ä¼šå¾—åˆ°æœ€å¥½çš„é¢„æµ‹ç»“æœã€‚æƒ³è¦å¾—åˆ°æœ€ä½³çš„Î»å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨äº¤å‰éªŒè¯çš„æ–¹å¼è·å¾—ï¼Œæ–‡ç« çš„åé¢ä¼šç»§ç»­è®²è§£ã€‚ ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:4:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"Lasso Lassoå¯¹å›å½’ç³»æ•°åšäº†é™å®šï¼Œå¯¹åº”çš„çº¦æŸæ¡ä»¶å¦‚ä¸‹ï¼š \\[ \\sum_{k=1}^n|w_k| \\leq \\lambda \\] è€Œå²­å›å½’çš„çº¦æŸæ¡ä»¶å¦‚ä¸‹ï¼š \\[ \\sum_{k=1}^nw_k^2 \\leq \\lambda \\] å”¯ä¸€ä¸åŒç‚¹åœ¨äºï¼ŒLassoçš„çº¦æŸæ¡ä»¶ç”¨ç»å¯¹å€¼å–ä»£äº†å¹³æ–¹å’Œï¼Œè™½ç„¶çº¦æŸå½¢å¼ç¨ä½œå˜åŒ–ï¼Œä½†ç»“æœå¤§ç›¸å¾„åº­ï¼Œç»†å¾®çš„å˜åŒ–æå¤§åœ°å¢åŠ äº†è®¡ç®—å¤æ‚åº¦ã€‚æ‰€ä»¥ç”¨æ›´ç®€å•çš„å‰å‘é€æ­¥å›å½’æ¥å–ä»£ã€‚ ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:5:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"å‰å‘é€æ­¥å›å½’ å‰å‘é€æ­¥çº¿æ€§å›å½’ç®—æ³•å±äºä¸€ç§è´ªå¿ƒç®—æ³•ï¼Œå³æ¯ä¸€æ­¥éƒ½å°½å¯èƒ½å‡å°‘è¯¯å·®ã€‚æˆ‘ä»¬è®¡ç®—å›å½’ç³»æ•°ï¼Œä¸å†æ˜¯é€šè¿‡å…¬å¼è®¡ç®—ï¼Œè€Œæ˜¯é€šè¿‡æ¯æ¬¡å¾®è°ƒå„ä¸ªå›å½’ç³»æ•°ï¼Œç„¶åè®¡ç®—é¢„æµ‹è¯¯å·®ã€‚é‚£ä¸ªä½¿è¯¯å·®æœ€å°çš„ä¸€ç»„å›å½’ç³»æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æœ€ä½³å›å½’ç³»æ•°ã€‚ è¯¥ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š æ•°æ®æ ‡å‡†åŒ–ï¼Œä½¿å…¶æ»¡è¶³0å‡å€¼å’Œå•ä½æ–¹å·®ã€‚ åœ¨æ¯è½®è¿­ä»£ä¸­ï¼š è®¾ç½®å½“å‰æœ€å°è¯¯å·®lowestErrorä¸ºæ­£æ— ç©· å¯¹æ¯ä¸ªç‰¹å¾ å¢å¤§æˆ–ç¼©å° æ”¹å˜ä¸€ä¸ªç³»æ•°å¾—åˆ°æ–°çš„W è®¡ç®—æ–°Wä¸‹çš„è¯¯å·® å¦‚æœè¯¯å·®Errorå°äºå½“å‰æœ€å°è¯¯å·®lowestErrorï¼šè®¾ç½®Wbestç­‰äºå½“å‰çš„W å°†Wè®¾ç½®ä¸ºæ–°çš„Wbest ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:6:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["Machine Learning","å›å½’ç®—æ³•"],"content":"ä»£ç  ä½¿ç”¨çš„ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªéšæœºæ¢¯åº¦ä¸‹é™ import numpy as np import matplotlib.pyplot as plt np.random.seed(42) w = np.array([2, 1, 4, 5, 3]) d = len(w) X = [] Y = [] for _ in range(1000000): x = np.random.randn(d) y = w.dot(x) + np.random.randn() X.append(x) Y.append(y) X = np.array(X) Y = np.array(Y) def mse(y_true, y_test): return ((y_true - y_test) ** 2) / len(y_true) def gradient(y_true, y_test): return 2 * (y_test - y_true) / len(y_true) def batch_gradient_descent(w, alpha, x, y): y_pred = x.dot(w) error = mse(y, y_pred).mean() grad = np.dot(x.T, gradient(y, y_pred)) w = w - alpha * grad return w, error def stochastic_gradient_descent(w, alpha, x, y, epoch): alpha_update = alpha for i in range(len(x)): y_pred = x[i].dot(w) grad = np.dot(x[i].T, (y_pred - y[i])) * 2 / len(x) w = w- alpha_update * grad alpha_update = alpha_update / (epoch+1) error = mse(y, x.dot(w)).mean() return w, error X_test = [] Y_test = [] for _ in range(10000): x = np.random.randn(d) y = w.dot(x) + np.random.randn() X_test.append(x) Y_test.append(y) X_test = np.array(X_test) Y_test = np.array(Y_test) def l2_mse(y_true, y_test, l, w): return ((y_true - y_test) ** 2) / len(y_true) + l * np.sum(w ** 2) def l2_gradient(y_true, y_test): return 2 * (y_test - y_true) / len(y_true) def batch_gradient_descent_with_l2(w, alpha, x, y, l): y_pred = x.dot(w) error = l2_mse(y, y_pred, l, w).mean() grad = np.dot(x.T, l2_gradient(y, y_pred)) w = w - alpha * grad - alpha * l * w *2 return w, error if __name__ == \"__main__\": train_loss = [] test_loss = [] print(\"Batch Gradient Descent\") for epoch in range(1000): w, error = batch_gradient_descent(w, 0.01, X, Y) # train y_pred = X_test.dot(w) error_test = mse(Y_test, y_pred).mean() # test if epoch % 100 == 0: print(\"Epoch: {}, TrainError: {}, TestError: {}\".format(epoch, error, error_test)) train_loss.append(error) test_loss.append(error_test) plt.plot(train_loss, label=\"Train-No-L2\") plt.legend() plt.xlabel(\"Epoch\") plt.ylabel(\"Loss\") plt.show() plt.plot(test_loss, label=\"Test-No-L2\") plt.xlabel(\"Epoch\") plt.ylabel(\"Loss\") plt.legend() plt.show() plt.plot(train_loss, label=\"Train-No-L2\") plt.plot(test_loss, label=\"Test-No-L2\") plt.legend() plt.show() # ============================================ train_loss = [] test_loss = [] print(\"Batch Gradient Descent with L2\") l = 0.0001 # lambda for epoch in range(1000): w, error = batch_gradient_descent_with_l2(w, 0.01, X, Y, l) # train y_pred = X_test.dot(w) error_test = l2_mse(Y_test, y_pred, l, w).mean() # test if epoch % 100 == 0: print(\"Epoch: {}, TrainError: {}, TestError: {}\".format(epoch, error, error_test)) train_loss.append(error) test_loss.append(error_test) plt.plot(train_loss, label=\"Train-L2\") plt.legend() plt.xlabel(\"Epoch\") plt.ylabel(\"Loss\") plt.show() plt.plot(test_loss, label=\"Test-L2\") plt.xlabel(\"Epoch\") plt.ylabel(\"Loss\") plt.legend() plt.show() plt.plot(train_loss, label=\"Train-L2\") plt.plot(test_loss, label=\"Test-L2\") plt.legend() plt.show() å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æ•°å­¦å…¬å¼çš„å¤ç°ã€‚ ## æ€»ç»“ ç¼©å‡æ–¹æ³•ï¼ˆé€æ­¥çº¿æ€§å›å½’æˆ–å²­å›å½’ï¼‰ï¼Œå°±æ˜¯å°†ä¸€äº›ç³»æ•°ç¼©å‡æˆå¾ˆå°çš„å€¼æˆ–è€…ç›´æ¥ç¼©å‡ä¸º0ã€‚è¿™æ ·åšï¼Œå°±å¢å¤§äº†æ¨¡å‹çš„åå·®ï¼ˆå‡å°‘äº†ä¸€äº›ç‰¹å¾çš„æƒé‡ï¼‰ï¼Œé€šè¿‡æŠŠä¸€äº›ç‰¹å¾çš„å›å½’ç³»æ•°ç¼©å‡åˆ°0ï¼ŒåŒæ—¶ä¹Ÿå°±å‡å°‘äº†æ¨¡å‹çš„å¤æ‚åº¦ã€‚æ¶ˆé™¤äº†å¤šä½™çš„ç‰¹å¾ä¹‹åï¼Œæ¨¡å‹æ›´å®¹æ˜“ç†è§£ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†é¢„æµ‹è¯¯å·®ã€‚ ","date":"2021-11-25","objectID":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/:7:0","tags":["Machine Learning","å›å½’ç®—æ³•","çº¿æ€§å›å½’"],"title":"çº¿æ€§å›å½’","uri":"/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"},{"categories":["ç®—æ³•é¢˜"],"content":"è®¡æ•°è´¨æ•° https://leetcode-cn.com/problems/count-primes/ ä¸€å¼€å§‹ç›´æ¥æš´åŠ›ï¼Œéšçº¦æ„Ÿè§‰ä¼šè¶…æ—¶ï¼Œæœç„¶ä¸å‡ºæˆ‘æ‰€æ–™ class Solution: def countPrimes(self, n: int) -\u003e int: counts = 0 for i in range(n): if self.isprime(i): counts += 1 return counts def isprime(self,n): from itertools import count if n \u003c=1: return False for i in count(2): if i* i \u003e n: return True if n % i == 0: return False æˆ‘è¿˜ç‰¹æ„ç”¨äº†itertoolsåº“ï¼Œæ²¡æƒ³åˆ°è¿˜æ˜¯è¶…æ—¶äº† ","date":"2021-11-19","objectID":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜","è®¡æ•°è´¨æ•°"],"title":"è®¡æ•°è´¨æ•°","uri":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"åŸƒæ°ç­› class Solution: def countPrimes(self, n: int) -\u003e int: res = [1] * n count = 0 for i in range(2, n): if res[i]: count += 1 for j in range(i*i, n, i): res[j] = 0 return count åŸƒæ°ç­›çš„åŸç†ï¼šä» 2 å¼€å§‹ï¼Œå°†æ¯ä¸ªè´¨æ•°çš„å€æ•°éƒ½æ ‡è®°ä¸ºåˆæ•°ã€‚åŒæ ·çš„ï¼Œæ ‡è®°åˆ° æ ¹å·nåœæ­¢ã€‚ å‡è®¾ä¸€ä¸ªæ•° i ä¸ºè´¨æ•°æ—¶ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äº i ä¸”æ˜¯ i çš„å€æ•°çš„æ•°ä¸€å®šä¸æ˜¯è´¨æ•°ï¼Œä¾‹å¦‚ 2iï¼Œ3iâ€¦ã€‚é‚£ä¹ˆæˆ‘ä»¬å°†è¿™äº›ä¸æ˜¯è´¨æ•°çš„æ•°è¿›è¡Œæ ‡è®°ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ ‡è®°åº”è¯¥ä» i * i å¼€å§‹ï¼Œè€Œä¸æ˜¯ 2 * i å¼€å§‹ã€‚å› ä¸ºå¯¹äºæ¯ä¸ªæ•° i æ¥è¯´ï¼Œæšä¸¾æ˜¯ä»å°åˆ°å¤§çš„ï¼Œæ­¤æ—¶å‰é¢æ•°å­—çš„å€æ•°éƒ½å·²ç»è¿›è¡Œäº†æ ‡è®°ã€‚å¯¹äº i è€Œè¨€ï¼Œ2âˆ—i ä¹Ÿè‚¯å®šä¼šè¢«åœ¨æšä¸¾æ•°å­— 2 æ—¶è¿›è¡Œæ ‡è®°ï¼Œ[2, i) åŒºé—´çš„æ•°åŒç†ã€‚ ","date":"2021-11-19","objectID":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/:1:0","tags":["ç®—æ³•é¢˜","è®¡æ•°è´¨æ•°"],"title":"è®¡æ•°è´¨æ•°","uri":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ¬§æ‹‰ç­›ï¼ˆçº¿æ€§ç­›ï¼‰ å…·ä½“çš„è¯æ˜ä¸è¯´äº†ï¼ŒèƒŒæ¿å­å°±è¡Œ class Solution: def countPrimes(self, n: int) -\u003e int: if n \u003c= 1: return 0 is_prime = [True] * n is_prime[0] = is_prime[1] = False res = [] for i in range(2, n): if is_prime[i]: res.append(i) j = 0 while j \u003c len(res) and (tmp:=i*res[j]) \u003c n: is_prime[tmp] = False if i % res[j] == 0: # å¦‚æœres[j]ä¸ºå½“å‰æ•°çš„çº¦æ•°ï¼Œåˆ™i*res[j+1]ç­‰åé¢çš„æ•°å¿…ç„¶ä¼šåœ¨åé¢çš„è®¡ç®—å¾—åˆ°ã€‚å°±ç»“æŸå¾ªç¯ã€‚è¿™å‡å°‘äº†é‡å¤è®¡ç®—ã€‚ break j += 1 return len(res) ","date":"2021-11-19","objectID":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/:2:0","tags":["ç®—æ³•é¢˜","è®¡æ•°è´¨æ•°"],"title":"è®¡æ•°è´¨æ•°","uri":"/%E8%AE%A1%E6%95%B0%E8%B4%A8%E6%95%B0/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ„ŸçŸ¥æœºç®—æ³• æ„ŸçŸ¥æœºå°è±¡ä¸­æ²¡æœ‰ç³»ç»Ÿå­¦ä¹ è¿‡ä½†æ˜¯æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç®—æ³•ï¼Œæœ€è¿‘çœ‹äº†ä¸€ä¸‹æèˆªè€å¸ˆçš„ç»Ÿè®¡å­¦ä¹ æ–¹æ³•ï¼Œå‘ç°æ„ŸçŸ¥æœºçš„æ€æƒ³å’Œsvmååˆ†ç±»ä¼¼ï¼Œå¹¶ä¸”æ¯”svmç®€å•çš„å¤šï¼Œä¸éœ€è¦é—´éš”æœ€å¤§ï¼Œåªéœ€è¦åˆ†å¼€å°±å¯ä»¥ã€‚åŒæ—¶è€å¸ˆåœ¨è¯¾å ‚ä¸Šé¢è®²çš„ç‰ˆæœ¬ä¹Ÿæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä¸»è¦æ˜¯è®¡ç®—ä¸Šçš„ä¸åŒï¼Œæœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„ã€‚ç„¶åå°±æ‰“ç®—æ•´ç†ä¸€ä¸‹è¿™ä¸€å—ã€‚ ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ„ŸçŸ¥æœºæ¨¡å‹ å‡è®¾è¾“å…¥ç©ºé—´ï¼ˆç‰¹å¾ç©ºé—´) æ˜¯ \\(\\mathcal{X} \\subseteq \\mathbf{R}^n\\), è¾“å‡ºç©ºé—´æ˜¯ \\(\\mathcal{Y}=\\\\{+1,-1\\\\}\\) ã€‚è¾“å…¥ \\(x \\in \\mathcal{X}\\) è¡¨ç¤ºå®ä¾‹çš„ç‰¹å¾å‘é‡, å¯¹åº”äºè¾“å…¥ç©ºé—´ (ç‰¹å¾ç©ºé—´ ) çš„ç‚¹; è¾“å‡º \\(y \\in \\mathcal{Y}\\) è¡¨ç¤ºå®ä¾‹çš„ç±»åˆ«ã€‚ç”±è¾“å…¥ç©ºé—´åˆ°è¾“å‡ºç©ºé—´çš„å¦‚ä¸‹å‡½æ•° \\[ f(x)=\\operatorname{sign}(w \\cdot x+b) \\] ç§°ä¸ºæ„ŸçŸ¥æœºã€‚å…¶ä¸­, \\(w\\) å’Œ \\(b\\) ä¸ºæ„ŸçŸ¥æœºæ¨¡å‹å‚æ•°, \\(w \\in \\mathbf{R}^n\\) å«ä½œæƒå€¼ (weight) æˆ–æƒå€¼å‘ é‡ (weight vector), \\(b \\in \\mathbf{R}\\) å«ä½œåç½® (bias), \\(w \\cdot x\\) è¡¨ç¤º \\(w\\) å’Œ \\(x\\) çš„å†…ç§¯ã€‚sign æ˜¯ç¬¦å· å‡½æ•°, å³ \\[ \\operatorname{sign}(x)=\\left\\{\\begin{array}{cc} +1, \u0026 x \\geqslant 0 \\\\\\\\ -1, \u0026 x\u003c0 \\end{array}\\right. \\] ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æŸå¤±å‡½æ•° å‡è®¾è®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„, æ„ŸçŸ¥æœºå­¦ä¹ çš„ç›®æ ‡æ˜¯æ±‚å¾—ä¸€ä¸ªèƒ½å¤Ÿå°†è®­ç»ƒé›†æ­£å® ä¾‹ç‚¹å’Œè´Ÿå®ä¾‹ç‚¹å®Œå…¨æ­£ç¡®åˆ†å¼€çš„åˆ†ç¦»è¶…å¹³é¢ã€‚ä¸ºäº†æ‰¾å‡ºè¿™æ ·çš„è¶…å¹³é¢, å³ç¡®å®šæ„ŸçŸ¥ æœºæ¨¡å‹å‚æ•° \\(w, b\\), éœ€è¦ç¡®å®šä¸€ä¸ªå­¦ä¹ ç­–ç•¥, å³å®šä¹‰ (ç»éªŒ) æŸå¤±å‡½æ•°å¹¶å°†æŸå¤±å‡½æ•°æ å°åŒ–ã€‚ æŸå¤±å‡½æ•°çš„ä¸€ä¸ªè‡ªç„¶é€‰æ‹©æ˜¯è¯¯åˆ†ç±»ç‚¹çš„æ€»æ•°ã€‚ä½†æ˜¯, è¿™æ ·çš„æŸå¤±å‡½æ•°ä¸æ˜¯å‚æ•° \\(w\\), \\(b\\) çš„è¿ç»­å¯å¯¼å‡½æ•°, ä¸æ˜“ä¼˜åŒ–ã€‚æŸå¤±å‡½æ•°çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢ \\(S\\) çš„æ€»è· ç¦», è¿™æ˜¯æ„ŸçŸ¥æœºæ‰€é‡‡ç”¨çš„ã€‚ä¸ºæ­¤, é¦–å…ˆå†™å‡ºè¾“å…¥ç©ºé—´ \\(\\mathbf{R}^n\\) ä¸­ä»»ä¸€ç‚¹ \\(x_0\\) åˆ°è¶…å¹³é¢ \\(S\\) çš„ è·ç¦»: \\[ \\frac{1}{\\|w\\|}\\left|w \\cdot x_0+b\\right| \\] è¿™é‡Œ, \\(\\|w\\|\\) æ˜¯ \\(w\\) çš„ \\(L_2\\) èŒƒæ•°ã€‚ å…¶æ¬¡, å¯¹äºè¯¯åˆ†ç±»çš„æ•°æ® \\(\\left(x_i, y_i\\right)\\) æ¥è¯´, \\[ -y_i\\left(w \\cdot x_i+b\\right)\u003e0 \\] æˆç«‹ã€‚å› ä¸ºå½“ \\(w \\cdot x_i+b\u003e0\\) æ—¶, \\(y_i=-1\\); è€Œå½“ \\(w \\cdot x_i+b\u003c0\\) æ—¶, \\(y_i=+1\\) ã€‚ å› æ­¤, è¯¯ åˆ†ç±»ç‚¹ \\(x_i\\) åˆ°è¶…å¹³é¢ \\(S\\) çš„è·ç¦»æ˜¯ \\[ -\\frac{1}{\\|w\\|} y_i\\left(w \\cdot x_i+b\\right) \\] è¿™æ ·, å‡è®¾è¶…å¹³é¢ \\(S\\) çš„è¯¯åˆ†ç±»ç‚¹é›†åˆä¸º \\(M\\), é‚£ä¹ˆæ‰€æœ‰è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢ \\(S\\) çš„æ€» è·ç¦»ä¸º \\[ -\\frac{1}{\\|w\\|} \\sum_{x_i \\in M} y_i\\left(w \\cdot x_i+b\\right) \\] ä¸è€ƒè™‘ \\(\\frac{1}{\\|w\\|}\\), å°±å¾—åˆ°æ„ŸçŸ¥æœºå­¦ä¹ çš„æŸå¤±å‡½æ•°ã€‚ å³ \\[ L(w, b) = -\\sum_{x_i \\in M} y_i\\left(w \\cdot x_i+b\\right) \\] ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ›´æ–°å‚æ•°ï¼Œå¯¹æŸå¤±å‡½æ•°æ±‚å¯¼å¾—åˆ°ï¼š \\[ \\begin{aligned} \u0026\\nabla_w L(w, b)=-\\sum_{x_i \\in M} y_i x_i \\\\\\\\ \u0026\\nabla_b L(w, b)=-\\sum_{x_i \\in M} y_i \\end{aligned} \\] éšæœºé€‰å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹ \\(\\left(x_i, y_i\\right)\\), å¯¹ \\(w, b\\) è¿›è¡Œæ›´æ–°: \\[ \\begin{gathered} w \\leftarrow w+\\eta y_i x_i \\\\\\\\ b \\leftarrow b+\\eta y_i \\end{gathered} \\] ## ç®—æ³•æµç¨‹ æ€»ç»“å¯å¾—ï¼Œæ„ŸçŸ¥æœºç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š è¾“å…¥: è®­ç»ƒæ•°æ®é›† \\(T=\\left\\{\\left(x_1, y_1\\right),\\left(x_2, y_2\\right), \\cdots,\\left(x_N, y_N\\right)\\right\\\\\\}\\), å…¶ä¸­ \\(x_i \\in \\mathcal{X}=\\mathbf{R}^n, y_i \\in\\) \\(\\mathcal{Y}=\\\\{-1,+1\\\\}, i=1,2, \\cdots, N\\); å­¦ä¹ ç‡ \\(\\eta(0\u003c\\eta \\leqslant 1)\\); è¾“å‡º: \\(w, b\\); æ„ŸçŸ¥æœºæ¨¡å‹ \\(f(x)=\\operatorname{sign}(w \\cdot x+b)\\) ã€‚ (1) é€‰å–åˆå€¼ \\(w_0, b_0\\); (2) åœ¨è®­ç»ƒé›†ä¸­é€‰å–æ•°æ® \\(\\left(x_i, y_i\\right)\\); (3) å¦‚æœ \\(y_i\\left(w \\cdot x_i+b\\right) \\leqslant 0\\), \\[ \\begin{aligned} \u0026w \\leftarrow w+\\eta y_i x_i \\\\\\\\ \u0026b \\leftarrow b+\\eta y_i \\end{aligned} \\] è½¬è‡³ (2), ç›´è‡³è®­ç»ƒé›†ä¸­æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ã€‚ è¿™å¾ˆå®¹æ˜“ç†è§£ã€‚å°±æ˜¯æ±‚è§£æœ€ä½³å‚æ•°\\(w\\)å’Œ\\(b\\)ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œå¯¹äºæ¯ä¸ªæ ·æœ¬ï¼Œå¦‚æœå…¶çœŸå®çš„æ ‡ç­¾ä¸é¢„æµ‹çš„ç»“æœç¬¦å·ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯signå‡½æ•°ä¹‹å‰çš„ç»“æœä¸åŒå·ï¼Œåˆ™è¯´æ˜åˆ†ç±»é”™è¯¯ï¼Œåˆ™å°±éœ€è¦æ›´æ–°å‚æ•°ï¼Œä¸æ–­åœ°ç»§ç»­æ›´æ–°ç›´åˆ°æ‰€æœ‰çš„æ ·æœ¬éƒ½åˆ†ç±»æ­£ç¡®ã€‚ ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å¦ä¸€ç§è¡¨è¾¾æ–¹å¼ æ„ŸçŸ¥å™¨: ç”¨æ•°æ®è®­ç»ƒçº¿æ€§æ¨¡å‹ \\(g({x})={w}^T {x}+w_0\\) å¢å¹¿çš„æ ·æœ¬å‘é‡: \\[ {y}=\\left(1 ; x_1 ; x_2 ; \\ldots ; x_d\\right) \\] å¢å¹¿çš„æƒå‘é‡: \\[ {\\alpha}=\\left(w_0 ; w_1 ; \\ldots ; w_d\\right) \\] çº¿æ€§åˆ¤åˆ«å‡½æ•°: \\[ g({y})={\\alpha}^T {y} \\] å†³ç­–è§„åˆ™: å¦‚æœ \\(g({y})\u003e0\\), åˆ™ \\(y \\in \\omega_0\\); å¦‚æœ \\(g({y})\u003c0\\), åˆ™ \\(y \\in \\omega_1\\) è‹¥å®šä¹‰æ–°å˜é‡ \\(y^{\\prime}\\), ä½¿ \\[ y_i^{\\prime}=\\left\\{\\begin{array}{lll} y_i, \\text { è‹¥ } \u0026 {y}_i \\in \\omega_0 \\\\ -{y}_i, \\text { è‹¥ } \u0026 {y}_i \\in \\omega_1 \\end{array} \\quad i=1,2, \\ldots, m\\right. \\] æ ·æœ¬å¯åˆ†æ€§æ¡ä»¶å˜ä¸ºï¼šå­˜åœ¨ \\(\\alpha\\), ä½¿ \\[ {\\alpha}^T {y}_i^{\\prime}\u003e0, i=1,2, \\ldots, m \\] \\(y^{\\prime}\\) ç§°ä½œè§„èŒƒåŒ–å¢å¹¿æ ·æœ¬å‘é‡, ä»è®°ä½œ \\(y\\) ã€‚ å¯ä»¥ç”¨è¿™æ ·çš„å½¢å¼å®šä¹‰æŸå¤±å‡½æ•°ä¸ºï¼š \\[ J(\\alpha) = \\sum_{\\alpha^Ty_k \\leq 0} (-\\alpha^Ty_k) \\] å…¶ä¸­wå’Œbåˆå¹¶ä¸ºäº†\\(\\alpha\\)ã€‚\\(y_k\\)ä¸ºåŸæ¥çš„xåŠ ä¸Šäº†1ç”¨äºä¸åç½®bå¯¹åº”ã€‚ ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ¢¯åº¦ä¸‹é™è¿­ä»£æ³•æ±‚è§£ \\[ \\boldsymbol{\\alpha}(t+1)=\\boldsymbol{\\alpha}(t)-\\rho_t \\nabla J_P(\\boldsymbol{\\alpha}) \\] ä¸‹ä¸€æ—¶åˆ»çš„æƒå‘é‡æ˜¯æŠŠå½“å‰æ—¶åˆ»çš„æƒå‘é‡å‘ç›®æ ‡å‡½æ•°çš„è´Ÿæ¢¯åº¦æ–¹å‘è°ƒæ•´ä¸€ä¸ªä¿® æ­£é‡, \\(\\rho_t\\) ä¸ºè°ƒæ•´çš„æ­¥é•¿ (â€œå­¦ä¹ ç‡â€)ã€‚ \\[ \\nabla J_P(\\boldsymbol{\\alpha})=\\frac{\\partial J_P(\\boldsymbol{\\alpha})}{\\partial \\boldsymbol{\\alpha}}=\\sum_{\\alpha^T y_k \\leq 0}\\left(-y_k\\right) \\] æ‰€ä»¥ \\[ \\alpha(t+1)=\\alpha(t)+\\rho_t \\sum_{\\alpha^T y_k \\leq 0} y_k \\] å³æ¯æ¬¡è¿­ä»£æ—¶æŠŠé”™åˆ†çš„æ ·æœ¬æŒ‰ç…§æŸä¸ªç³»æ•°åŠ åˆ°æƒå‘é‡ä¸Šã€‚ å½“æ²¡æœ‰é”™åˆ†æ ·æœ¬æ—¶, å¾—åˆ°ä¸€ä¸ªåˆé€‚çš„è§£ $^* $ ã€‚ ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:3:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å›ºå®šå¢é‡æ³• ï¼ˆ1ï¼‰ä»»æ„é€‰æ‹©åˆå§‹æƒå‘é‡ \\(\\alpha(0)\\); (2) å¯¹æ ·æœ¬ \\(y_j\\), è‹¥ \\(\\alpha(t)^T y_j \\leq 0\\), åˆ™ \\(\\alpha(t+1)=\\alpha(t)+y_j\\) (å‡è®¾ \\(\\left.\\rho_t=1\\right)\\), å¦åˆ™ç»§ ç»­; (3) å¯¹æ‰€æœ‰æ ·æœ¬é‡å¤ (2), ç›´è‡³å¯¹æ‰€æœ‰çš„æ ·æœ¬éƒ½æœ‰ \\(\\alpha(t)^T y_j\u003e0\\), å³ \\(J_P(\\boldsymbol{\\alpha})=0\\) ä¸æ¢¯åº¦ä¸‹é™æ³•çš„åŒºåˆ«å°±æ˜¯æ¯æ¬¡åªå¯¹ä¸€ä¸ªæ ·æœ¬æ›´æ–°ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼š åŸå§‹çš„æ•°æ®ï¼Œå¯¹äºç¬¬äºŒç±»åˆ™å¢å¹¿ä¹‹åå–è´Ÿæ•°å°±å¯ä»¥ç†è§£ä¸ºå‰é¢ç¬¬ä¸€ç§è¡¨è¾¾çš„\\(y_i\\left(w \\cdot x_i+b\\right)\\)ï¼Œ å¤§äº0åˆ™è¯´æ˜åˆ†ç±»æ­£ç¡®ï¼Œå¦åˆ™è¯´æ˜åˆ†ç±»é”™è¯¯ï¼Œå°±éœ€è¦æ›´æ–°å‚æ•°ã€‚ ","date":"2021-11-16","objectID":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/:3:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","æ„ŸçŸ¥æœºç®—æ³•"],"title":"æ„ŸçŸ¥æœºç®—æ³•","uri":"/%E6%84%9F%E7%9F%A5%E6%9C%BA%E7%AE%97%E6%B3%95/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ€å¤§æ•° ","date":"2021-11-08","objectID":"/%E6%9C%80%E5%A4%A7%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜","æœ€å¤§æ•°"],"title":"æœ€å¤§æ•°","uri":"/%E6%9C%80%E5%A4%A7%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/largest-number/ ","date":"2021-11-08","objectID":"/%E6%9C%80%E5%A4%A7%E6%95%B0/:1:0","tags":["ç®—æ³•é¢˜","æœ€å¤§æ•°"],"title":"æœ€å¤§æ•°","uri":"/%E6%9C%80%E5%A4%A7%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š ä¸€å¼€å§‹ç›´æ¥æš´åŠ›æœç´¢ï¼ŒæŠŠæ‰€æœ‰çš„æƒ…å†µéƒ½åˆ—ä¸¾ç„¶åæ¯”è¾ƒï¼Œç»“æœè¶…æ—¶äº†ï¼Œæœ€ååˆ©ç”¨äº†è‡ªå®šä¹‰æ’åºçš„æ–¹æ³• ","date":"2021-11-08","objectID":"/%E6%9C%80%E5%A4%A7%E6%95%B0/:2:0","tags":["ç®—æ³•é¢˜","æœ€å¤§æ•°"],"title":"æœ€å¤§æ•°","uri":"/%E6%9C%80%E5%A4%A7%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def largestNumber(self, nums: List[int]) -\u003e str: class Comapre(str): def __lt__(self,other): return int(self+other) \u003e int(other+self) nums.sort(key=Comapre) return str(int(''.join(map(str,nums)))) æ³¨æ„çš„æ˜¯è¿™é‡Œåˆ©ç”¨äº†è‡ªå®šä¹‰çš„æ¯”è¾ƒç±»å‹ï¼Œç»§æ‰¿äº†strï¼Œä¹Ÿå¯ä»¥ä»functoolsé‡Œå¯¼å…¥cmp_to_keyæ–¹æ³•æ¥å®ç°æ¯”è¾ƒ python3ä¹‹åä¸æ”¯æŒcmpï¼Œæ‰€ç”¨keyå‡½æ•°å¹¶ä¸ç›´æ¥æ¯”è¾ƒä»»æ„ä¸¤ä¸ªåŸå§‹å…ƒç´ ï¼Œè€Œæ˜¯é€šè¿‡keyå‡½æ•°æŠŠé‚£äº›å…ƒç´ è½¬æ¢æˆä¸€ä¸ªä¸ªæ–°çš„å¯æ¯”è¾ƒå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ çš„keyï¼Œç„¶åç”¨å…ƒç´ çš„keyä»£æ›¿å…ƒç´ å»å‚ä¸æ¯”è¾ƒã€‚å¦‚æœåŸå§‹å…ƒç´ æœ¬æ¥å°±æ˜¯å¯æ¯”è¾ƒå¯¹è±¡ï¼Œæ¯”å¦‚æ•°å­—ã€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¸è€ƒè™‘æ€§èƒ½ä¼˜åŒ–å¯ä»¥ç›´æ¥sort(key=lambda e: e)ã€‚ä¸è¿‡è¿™ç§åŸºäºkeyå‡½æ•°çš„è®¾è®¡å€¾å‘äºæ¯ä¸ªå…ƒç´ çš„å¤§å°æœ‰ä¸ªç»å¯¹æ ‡å‡†ï¼Œä½†æœ‰æ—¶å´ä¼šå‡ºç°å•ä¸ªå…ƒç´ å¹¶æ²¡æœ‰ä¸€ä¸ªç»å¯¹çš„å¤§å°çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ functools.cmp_to_keyæ„å»ºåŸºäºå¤šä¸ªå…ƒç´ çš„æ¯”è¾ƒå‡½æ•°ã€‚ ","date":"2021-11-08","objectID":"/%E6%9C%80%E5%A4%A7%E6%95%B0/:3:0","tags":["ç®—æ³•é¢˜","æœ€å¤§æ•°"],"title":"æœ€å¤§æ•°","uri":"/%E6%9C%80%E5%A4%A7%E6%95%B0/"},{"categories":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—"],"content":" image.png image.png ","date":"2021-11-02","objectID":"/lstm/:0:0","tags":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—","LSTM"],"title":"LSTM","uri":"/lstm/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ£€æŸ¥å¹³è¡¡æ€§ ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/:0:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/check-balance-lcci/ ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/:1:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š ç®—æ·±åº¦ï¼Œç„¶åä½œå·®æ˜¯å¦å¤§äº1 ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/:2:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š # Definition for a binary tree node. # class TreeNode: # def __init__(self, x): # self.val = x # self.left = None # self.right = None class Solution: def isBalanced(self, root: TreeNode) -\u003e bool: if self.maxdepth(root) \u003c 1: return True if abs(self.maxdepth(root.left) - self.maxdepth(root.right)) \u003e 1: return False return self.isBalanced(root.right) and self.isBalanced(root.left) def maxdepth(self,root): if not root: return 0 return 1 + max(self.maxdepth(root.right),self.maxdepth(root.left)) ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/:3:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7-1/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ£€æŸ¥å¹³è¡¡æ€§ ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/:0:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/check-balance-lcci/ ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/:1:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š ç®—æ·±åº¦ï¼Œç„¶åä½œå·®æ˜¯å¦å¤§äº1 ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/:2:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š # Definition for a binary tree node. # class TreeNode: # def __init__(self, x): # self.val = x # self.left = None # self.right = None class Solution: def isBalanced(self, root: TreeNode) -\u003e bool: if self.maxdepth(root) \u003c 1: return True if abs(self.maxdepth(root.left) - self.maxdepth(root.right)) \u003e 1: return False return self.isBalanced(root.right) and self.isBalanced(root.left) def maxdepth(self,root): if not root: return 0 return 1 + max(self.maxdepth(root.right),self.maxdepth(root.left)) ","date":"2021-10-27","objectID":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/:3:0","tags":["ç®—æ³•é¢˜","æ£€æŸ¥å¹³è¡¡æ€§"],"title":"æ£€æŸ¥å¹³è¡¡æ€§","uri":"/%E6%A3%80%E6%9F%A5%E5%B9%B3%E8%A1%A1%E6%80%A7/"},{"categories":["NLP"],"content":"è¯­è¨€æ¨¡å‹ è¯­è¨€æ¨¡å‹æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¸»é¢˜ï¼Œå¾ˆå¤šnlpçš„ä»»åŠ¡éƒ½æ˜¯åŸºäºè¯­è¨€æ¨¡å‹è¿›è¡Œçš„ï¼Œå› æ­¤ç†è§£è¯­è¨€æ¨¡å‹æ˜¯å¾ˆé‡è¦çš„ã€‚ è¯­è¨€æ¨¡å‹ç®€å•è¯´å°±æ˜¯ è®¡ç®—ä¸€ä¸ªå¥å­åœ¨è¯­è¨€ä¸­å‡ºç°çš„æ¦‚ç‡ã€‚ ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:0:0","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ•°å­¦è¡¨ç¤º ä¸€ä¸ªè¯­è¨€æ¨¡å‹é€šå¸¸æ„å»ºå­—ç¬¦ä¸²sçš„æ¦‚ç‡åˆ†å¸ƒp(s)ï¼Œè¿™é‡Œp(s)ååº”å­—ç¬¦ä¸²sä½œä¸ºä¸€ä¸ªå¥å­å‡ºç°çš„æ¦‚ç‡ã€‚ å¯¹äºä¸€ä¸ªç”±mä¸ªåŸºå…ƒï¼ˆå¯ä»¥æ˜¯å­—ã€è¯æˆ–è€…çŸ­è¯­ï¼‰æ„æˆçš„å¥å­\\(s=w_1,w_2, \\dots w_m\\)ï¼Œå…¶æ¦‚ç‡è®¡ç®—å…¬å¼å¯ä»¥è¡¨ç¤ºä¸º(ä¹˜æ³•å…¬å¼ï¼Œè¯¦è§bayes)ï¼š \\[ p(s) = p(w_1)p(w_2\\mid w_1)p(w_3\\mid w_1, w_2)\\cdots p(w_m\\mid w_1w_2\\dots w_{m-1})= \\prod_{i=1}^mp(w_i\\mid w_1\\cdots,w_{i-1}) \\] ä½†æ˜¯å¾ˆæ˜æ˜¾è¿™ä¸ªè®¡ç®—å¤æ‚åº¦æ˜¯æå¤§çš„ã€‚ ## è¯„ä»·æŒ‡æ ‡ è¯­è¨€æ¨¡å‹çš„å¸¸ç”¨è¯„ä»·æŒ‡æ ‡æ˜¯å›°æƒ‘åº¦ï¼ˆperplexityï¼‰ï¼šåœ¨ä¸€ä¸ªæµ‹è¯•æ•°æ®ä¸Šçš„perplexityè¶Šä½ï¼Œè¯´æ˜å»ºæ¨¡çš„æ•ˆæœè¶Šå¥½ã€‚perplexityè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š ç®€å•æ¥è¯´ï¼Œå›°æƒ‘åº¦å°±æ˜¯åˆ»ç”»ä¸€ä¸ªè¯­è¨€æ¨¡å‹é¢„æµ‹ä¸€ä¸ªè¯­è¨€æ ·æœ¬çš„èƒ½åŠ›ï¼Œå…¶å®é™…ä¸Šå°±æ˜¯è®¡ç®—æ¯ä¸€ä¸ªè¯å¾—åˆ°çš„æ¦‚ç‡å€’æ•°çš„å‡ ä½•å¹³å‡ï¼Œå³æ¨¡å‹é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„å¹³å‡å¯é€‰æ‹©æ•°é‡ã€‚ åœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸ä½¿ç”¨logçš„å½¢å¼ï¼Œå³ï¼š ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:1:0","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"ç»Ÿè®¡è¯­è¨€æ¨¡å‹ ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:2:0","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"n-gram ä¸ºäº†è§£å†³å¤æ‚åº¦é«˜çš„é—®é¢˜ï¼Œå› æ­¤å¼•å…¥é©¬å°”ç§‘å¤«å‡è®¾ï¼Œå³å½“å‰è¯çš„é¢„æµ‹æ¦‚ç‡åªä¸ä¹‹å‰n-1ä¸ªè¯ç›¸å…³ï¼ŒåŸºäºæ­¤ï¼Œè¯­è¨€æ¨¡å‹å¯ä»¥ä¿®æ”¹å¦‚ä¸‹ï¼š \\[ p(s) = p(w_1, w_2, \\dots, w_m) = \\prod_{i=1}^mp(w_i\\mid w_{i-n+1}, w_{i-1}) \\] å½“nå–1,2,3æ—¶ï¼Œn-gramå¯ä»¥ç§°ä¸ºunigramã€bigramã€trigramã€‚nè¶Šå¤§å¤æ‚åº¦è¶Šé«˜ã€‚ n-gram modelä¸€èˆ¬é‡‡ç”¨MLEè¿›è¡Œå‚æ•°ä¼°è®¡ï¼š \\[ p(w_i\\mid w_{i-n+1}, \\cdots, w_{i-1}) = \\frac{C(w_{i-n+1}, \\cdots,w_{i-1}, w_i)}{C(w_{i-n+1}, \\cdots, w_{i-1})} \\] å³ä½¿è®­ç»ƒè¯­æ–™å†å¤§ï¼Œä¹Ÿå­˜åœ¨å‚æ•°ä¸º0çš„æƒ…å†µï¼Œè¿™æ—¶å€™å°±éœ€è¦å¼•å…¥æ•°æ®å¹³æ»‘ç­–ç•¥ï¼Œå…¶ä¸­æœ€ä¸ºå¸¸ç”¨çš„å°±æ˜¯æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ã€‚ ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:2:1","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ Add one æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ï¼Œå³å¼ºåˆ¶è®©æ‰€æœ‰çš„n-gramè‡³å°‘å‡ºç°ä¸€æ¬¡ï¼Œåªéœ€è¦åœ¨åˆ†å­å’Œåˆ†æ¯ä¸Šåˆ†åˆ«åšåŠ æ³•å³å¯ã€‚è¿™ä¸ªæ–¹æ³•çš„å¼Šç«¯æ˜¯ï¼Œå¤§éƒ¨åˆ†n-graméƒ½æ˜¯æ²¡æœ‰å‡ºç°è¿‡çš„ï¼Œå¾ˆå®¹æ˜“ä¸ºä»–ä»¬åˆ†é…è¿‡å¤šçš„æ¦‚ç‡ç©ºé—´ã€‚ #### Add-K åœ¨Add-oneçš„åŸºç¡€ä¸Šåšäº†ä¸€ç‚¹å°æ”¹åŠ¨ï¼ŒåŸæœ¬æ˜¯åŠ ä¸€ï¼Œç°åœ¨åŠ ä¸Šä¸€ä¸ªå°äº1çš„å¸¸æ•°K Kã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯è¿™ä¸ªå¸¸æ•°ä»ç„¶éœ€è¦äººå·¥ç¡®å®šï¼Œå¯¹äºä¸åŒçš„è¯­æ–™åº“Kå¯èƒ½ä¸åŒã€‚ kå–1æ—¶ä¸add one ç›¸åŒ ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:2:2","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP"],"content":"Kneser-Ney Smoothing è¿™æ˜¯ç›®å‰ngramæ¨¡å‹æ•ˆæœæœ€å¥½çš„å¹³æ»‘æ–¹æ³•ã€‚ ## ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹ å…·ä½“å¯ä»¥çœ‹æœ¬åšå®¢æœ‰å…³ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼ŒNNLMæ˜¯ç¬¬ä¸€ä¸ªå‡ºç°çš„ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹ã€‚ ","date":"2021-10-26","objectID":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/:2:3","tags":["NLP","è¯­è¨€æ¨¡å‹"],"title":"è¯­è¨€æ¨¡å‹","uri":"/%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"éšé©¬å°”ç§‘å¤«æ¨¡å‹ ","date":"2021-10-25","objectID":"/hmm/:0:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ä»‹ç» HMMå¯ä»¥çœ‹åšæ˜¯å¤„ç†åºåˆ—æ¨¡å‹çš„ä¼ ç»Ÿæ–¹æ³•ã€‚ ä¸€èˆ¬æ¥è¯´HMMè§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š è¯„ä¼°è§‚å¯Ÿåºåˆ—æ¦‚ç‡ã€‚ç»™å®šæ¨¡å‹\\(\\lambda=(A,B,\\prod)\\)å’Œè§‚å¯Ÿåºåˆ—\\(O=\\\\{o_1,o_2,\\dots,o_T\\\\}\\)ï¼Œè®¡ç®—åœ¨æ¨¡å‹\\(\\lambda\\)ä¸‹è§‚æµ‹åºåˆ—Oå‡ºç°çš„æ¦‚ç‡\\(P(O\\lvert \\lambda)\\)ï¼Œè¿™ä¸ªé—®é¢˜éœ€è¦ç”¨åˆ°å‰å‘åå‘ç®—æ³•ï¼Œå±äºä¸‰ä¸ªé—®é¢˜ä¸­æœ€ç®€å•çš„ã€‚ é¢„æµ‹é—®é¢˜ï¼Œä¹Ÿå«è§£ç é—®é¢˜ã€‚å³ç»™å®šæ¨¡å‹\\(\\lambda = (A,B,\\prod)\\)å’Œè§‚æµ‹åºåˆ—\\(O=\\\\{o_1,o_2,\\dots,o_T\\\\}\\)ï¼Œæ±‚åœ¨ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶ä¸‹ï¼Œæœ€å¯èƒ½å‡ºç°çš„å¯¹åº”çš„çŠ¶æ€åºåˆ—ï¼Œè¿™ä¸ªé—®é¢˜çš„æ±‚è§£éœ€è¦ç”¨åˆ°åŸºäºåŠ¨æ€è§„åˆ’çš„ç»´ç‰¹æ¯”ç®—æ³•ï¼Œè¿™ä¸ªé—®é¢˜å±äºä¸‰ä¸ªé—®é¢˜ä¸­å¤æ‚åº¦å±…ä¸­çš„ç®—æ³•ã€‚ æ¨¡å‹å‚æ•°å­¦ä¹ é—®é¢˜ã€‚å³ç»™å®šè§‚æµ‹åºåˆ—\\(O=\\\\{o_1,o_2,\\dots,o_T\\\\}\\)ï¼Œä¼°è®¡æ¨¡å‹\\(\\lambda = (A,B,\\prod)\\)çš„å‚æ•°ï¼Œä½¿å¾—è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—çš„æ¡ä»¶æ¦‚ç‡\\(P(O\\lvert\\lambda)\\)æœ€å¤§ï¼Œè¿™ä¸ªé—®é¢˜çš„æ±‚è§£éœ€è¦ç”¨åˆ°åŸºäºEMç®—æ³•çš„é²å§†-éŸ¦å°”å¥‡ç®—æ³•ã€‚å±äºä¸‰ä¸ªé—®é¢˜ä¸­æœ€å¤æ‚çš„ã€‚ ","date":"2021-10-25","objectID":"/hmm/:1:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"å®šä¹‰ è®¾ \\(Q\\) æ˜¯æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€çš„é›†åˆ, \\(V\\) æ˜¯æ‰€æœ‰å¯èƒ½çš„è§‚æµ‹çš„é›†åˆ: \\[ Q=\\left\\{q_1, q_2, \\cdots, q_N\\right\\}, \\quad V=\\left\\{v_1, v_2, \\cdots, v_M\\right\\} \\] å…¶ä¸­, \\(N\\) æ˜¯å¯èƒ½çš„çŠ¶æ€æ•°, \\(M\\) æ˜¯å¯èƒ½çš„è§‚æµ‹æ•°ã€‚ \\(I\\) æ˜¯é•¿åº¦ä¸º \\(T\\) çš„çŠ¶æ€åºåˆ—, \\(O\\) æ˜¯å¯¹åº”çš„è§‚æµ‹åºåˆ—: \\[ I=\\left(i_1, i_2, \\cdots, i_T\\right), \\quad O=\\left(o_1, o_2, \\cdots, o_T\\right) \\] \\(A\\) æ˜¯çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ: \\[ A=\\left[a_{i j}\\right]_{N \\times N} \\] å…¶ä¸­, \\[ a_{i j}=P\\left(i_{t+1}=q_j \\mid i_t=q_i\\right), \\quad i=1,2, \\cdots, N ; \\quad j=1,2, \\cdots, N \\] æ˜¯åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_i\\) çš„æ¡ä»¶ä¸‹åœ¨æ—¶åˆ» \\(t+1\\) è½¬ç§»åˆ°çŠ¶æ€ \\(q_j\\) çš„æ¦‚ç‡ã€‚ \\(B\\) æ˜¯è§‚æµ‹æ¦‚ç‡çŸ©é˜µ: \\[ B=\\left[b_j(k)\\right]_{N \\times M} \\] å…¶ä¸­, \\[ b_j(k)=P\\left(o_t=v_k \\mid i_t=q_j\\right), \\quad k=1,2, \\cdots, M ; \\quad j=1,2, \\cdots, N \\] æ˜¯åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_j\\) çš„æ¡ä»¶ä¸‹ç”Ÿæˆè§‚æµ‹ \\(v_k\\) çš„æ¦‚ç‡ã€‚ \\(\\pi\\) æ˜¯åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡: \\[ \\pi=\\left(\\pi_i\\right) \\] å…¶ä¸­, \\[ \\pi_i=P\\left(i_1=q_i\\right), \\quad i=1,2, \\cdots, N \\] æ˜¯æ—¶åˆ» \\(t=1\\) å¤„äºçŠ¶æ€ \\(q_i\\) çš„æ¦‚ç‡ã€‚ éšé©¬å°”å¯å¤«æ¨¡å‹ç”±åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡ \\(\\pi\\) ã€çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ \\(A\\) å’Œè§‚æµ‹æ¦‚ç‡çŸ©é˜µ \\(B\\) å†³å®šã€‚ \\(\\pi\\) å’Œ \\(A\\) å†³å®šçŠ¶æ€åºåˆ—, \\(B\\) å†³å®šè§‚æµ‹åºåˆ—ã€‚å› æ­¤, éšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda\\) å¯ä»¥ç”¨ä¸‰å…ƒ ç¬¦å·è¡¨ç¤º, å³ \\[ \\lambda=(A, B, \\pi) \\] \\(A, B, \\pi\\) ç§°ä¸ºéšé©¬å°”å¯å¤«æ¨¡å‹çš„ä¸‰è¦ç´ ã€‚ çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ \\(A\\) ä¸åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡ \\(\\pi\\) ç¡®å®šäº†éšè—çš„é©¬å°”å¯å¤«é“¾, ç”Ÿæˆä¸ å¯è§‚æµ‹çš„çŠ¶æ€åºåˆ—ã€‚è§‚æµ‹æ¦‚ç‡çŸ©é˜µ \\(B\\) ç¡®å®šäº†å¦‚ä½•ä»çŠ¶æ€ç”Ÿæˆè§‚æµ‹, ä¸çŠ¶æ€åºåˆ—ç»¼åˆç¡® å®šäº†å¦‚ä½•äº§ç”Ÿè§‚æµ‹åºåˆ—ã€‚ ","date":"2021-10-25","objectID":"/hmm/:2:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ä¸¤ä¸ªåŸºæœ¬å‡è®¾ é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾, å³å‡è®¾éšè—çš„é©¬å°”å¯å¤«é“¾åœ¨ä»»æ„æ—¶åˆ» \\(t\\) çš„çŠ¶æ€åªä¾èµ– äºå…¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€, ä¸å…¶ä»–æ—¶åˆ»çš„çŠ¶æ€åŠè§‚æµ‹æ— å…³, ä¹Ÿä¸æ—¶åˆ» \\(t\\) æ— å…³: \\[ P\\left(i_t \\mid i_{t-1}, o_{t-1}, \\cdots, i_1, o_1\\right)=P\\left(i_t \\mid i_{t-1}\\right), \\quad t=1,2, \\cdots, T \\] è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾, å³å‡è®¾ä»»æ„æ—¶åˆ»çš„è§‚æµ‹åªä¾èµ–äºè¯¥æ—¶åˆ»çš„é©¬å°”å¯å¤«é“¾çš„çŠ¶ æ€, ä¸å…¶ä»–è§‚æµ‹åŠçŠ¶æ€æ— å…³: \\[ P\\left(o_t \\mid i_T, o_T, i_{T-1}, o_{T-1}, \\cdots, i_{t+1}, o_{t+1}, i_t, i_{t-1}, o_{t-1}, \\cdots, i_1, o_1\\right)=P\\left(o_t \\mid i_t\\right) \\] ","date":"2021-10-25","objectID":"/hmm/:3:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"è§‚æµ‹åºåˆ—ç”Ÿæˆçš„è¿‡ç¨‹ è¾“å…¥: éšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda=(A, B, \\pi)\\), è§‚æµ‹åºåˆ—é•¿åº¦ \\(T\\); è¾“å‡º: è§‚æµ‹åºåˆ— \\(O=\\left(o_1, o_2, \\cdots, o_T\\right)\\) ã€‚ (1) æŒ‰ç…§åˆå§‹çŠ¶æ€åˆ†å¸ƒ \\(\\pi\\) äº§ç”ŸçŠ¶æ€ \\(i_1\\); (2) ä»¤ \\(t=1\\); (3) æŒ‰ç…§çŠ¶æ€ \\(i_t\\) çš„è§‚æµ‹æ¦‚ç‡åˆ†å¸ƒ \\(b_{i_t}(k)\\) ç”Ÿæˆ \\(o_t\\) : (4) æŒ‰ç…§çŠ¶æ€ \\(i_t\\) çš„çŠ¶æ€è½¬ç§»æ¦‚ç‡åˆ†å¸ƒ \\(\\left\\{a_{i_t i_{t+1}}\\right\\}\\) äº§ç”ŸçŠ¶æ€ \\(i_{t+1}, i_{t+1}=1,2, \\cdots, N\\); (5) ä»¤ \\(t=t+1\\); å¦‚æœ \\(t\u003cT\\), è½¬æ­¥ (3); å¦åˆ™, ç»ˆæ­¢ã€‚ ","date":"2021-10-25","objectID":"/hmm/:4:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"æ¦‚ç‡è®¡ç®—é—®é¢˜ ","date":"2021-10-25","objectID":"/hmm/:5:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ç›´æ¥è®¡ç®—ï¼ˆå¤æ‚åº¦å¤ªé«˜ï¼‰ ç»™å®šæ¨¡å‹ \\(\\lambda=(A, B, \\pi)\\) å’Œè§‚æµ‹åºåˆ— \\(O=\\left(o_1, o_2, \\cdots, o_T\\right)\\), è®¡ç®—è§‚æµ‹åºåˆ— \\(O\\) å‡ºç° çš„æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ã€‚æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯æŒ‰æ¦‚ç‡å…¬å¼ç›´æ¥è®¡ç®—ã€‚é€šè¿‡åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„é•¿åº¦ä¸º \\(T\\) çš„çŠ¶æ€åºåˆ— \\(I=\\left(i_1, i_2, \\cdots, i_T\\right)\\), æ±‚å„ä¸ªçŠ¶æ€åºåˆ— \\(I\\) ä¸è§‚æµ‹åºåˆ— \\(O=\\left(o_1, o_2, \\cdots, o_T\\right)\\) çš„è”åˆæ¦‚ç‡ \\(P(O, I \\mid \\lambda)\\), ç„¶åå¯¹æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—æ±‚å’Œ, å¾—åˆ° \\(P(O \\mid \\lambda)\\) ã€‚ çŠ¶æ€åºåˆ— \\(I=\\left(i_1, i_2, \\cdots, i_T\\right)\\) çš„æ¦‚ç‡æ˜¯: \\[ P(I \\mid \\lambda)=\\pi_{i_1} a_{i_1 i_2} a_{i_2 i_3} \\cdots a_{i_{T-1} i_T} \\] å¯¹å›ºå®šçš„çŠ¶æ€åºåˆ— \\(I=\\left(i_1, i_2, \\cdots, i_T\\right)\\), è§‚æµ‹åºåˆ— \\(O=\\left(o_1, o_2, \\cdots, o_T\\right)\\) çš„æ¦‚ç‡æ˜¯: \\[ P(O \\mid I, \\lambda)=b_{i_1}\\left(o_1\\right) b_{i_2}\\left(o_2\\right) \\cdots b_{i_T}\\left(o_T\\right) \\] \\(O\\) å’Œ \\(I\\) åŒæ—¶å‡ºç°çš„è”åˆæ¦‚ç‡ä¸º \\[ \\begin{aligned} P(O, I \\mid \\lambda) \u0026=P(O \\mid I, \\lambda) P(I \\mid \\lambda) \\\\\\\\ \u0026=\\pi_{i_1} b_{i_1}\\left(o_1\\right) a_{i_1 i_2} b_{i_2}\\left(o_2\\right) \\cdots a_{i_{T-1} i_T} b_{i_T}\\left(o_T\\right) \\end{aligned} \\] ç„¶å, å¯¹æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ— \\(I\\) æ±‚å’Œ, å¾—åˆ°è§‚æµ‹åºåˆ— \\(O\\) çš„æ¦‚ç‡ \\(P(O \\mid \\lambda)\\), å³ \\[ \\begin{aligned} P(O \\mid \\lambda) \u0026=\\sum_I P(O \\mid I, \\lambda) P(I \\mid \\lambda) \\\\\\\\ \u0026=\\sum_{i_1, i_2, \\cdots, i_T} \\pi_{i_1} b_{i_1}\\left(o_1\\right) a_{i_1 i_2} b_{i_2}\\left(o_2\\right) \\cdots a_{i_{T-1} i_T} b_{i_T}\\left(o_T\\right) \\end{aligned} \\] è¿™ç§ç®—æ³•å¤æ‚åº¦å¤ªé«˜ï¼Œè®¡ç®—é‡å¤ªå¤§ï¼Œæœ‰æ•ˆç®—æ³•ä¸ºå‰å‘ç®—æ³•å’Œåå‘ç®—æ³•ã€‚ ","date":"2021-10-25","objectID":"/hmm/:5:1","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"å‰å‘ç®—æ³• é¦–å…ˆå®šä¹‰å‰å‘æ¦‚ç‡ã€‚ ç»™å®šéšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda\\), å®šä¹‰åˆ°æ—¶åˆ» \\(t\\) éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º \\(o_1, o_2, \\cdots, o_t\\) ä¸”çŠ¶æ€ä¸º \\(q_i\\) çš„æ¦‚ç‡ä¸ºå‰å‘æ¦‚ç‡, è®°ä½œ \\[ \\alpha_t(i)=P\\left(o_1, o_2, \\cdots, o_t, i_t=q_i \\mid \\lambda\\right) \\] å¯ä»¥é€’æ¨åœ°æ±‚å¾—å‰å‘æ¦‚ç‡ \\(\\alpha_t(i)\\) åŠè§‚æµ‹åºåˆ—æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ã€‚ (è§‚æµ‹åºåˆ—æ¦‚ç‡çš„å‰å‘ç®—æ³•) è¾“å…¥: éšé©¬å°”å¯å¤«æ…”å‹ \\(\\lambda\\), è§‚æµ‹åºåˆ— \\(O\\); è¾“å‡º: è§‚æµ‹åºåˆ—æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ã€‚ (1) åˆå€¼ \\[ \\alpha_1(i)=\\pi_i b_i\\left(o_1\\right), \\quad i=1,2, \\cdots, N \\] ï¼ˆ2ï¼‰é€’æ¨ å¯¹ \\(t=1,2, \\cdots, T-1\\), \\[ \\alpha_{t+1}(i)=\\left[\\sum_{j=1}^N \\alpha_t(j) a_{j i}\\right] b_i\\left(o_{t+1}\\right), \\quad i=1,2, \\cdots, N \\] ç»ˆæ­¢ \\[ P(O \\mid \\lambda)=\\sum_{i=1}^N \\alpha_T(i) \\] å‰å‘ç®—æ³•, æ­¥éª¤ (1) åˆå§‹åŒ–å‰å‘æ¦‚ç‡, æ˜¯åˆå§‹æ—¶åˆ»çš„çŠ¶æ€ \\(i_1=q_i\\) å’Œè§‚æµ‹ \\(o_1\\) çš„ è”åˆæ¦‚ç‡ã€‚æ­¥éª¤ (2) æ˜¯å‰å‘æ¦‚ç‡çš„é€’æ¨å…¬å¼, è®¡ç®—åˆ°æ—¶åˆ» \\(t+1\\) éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º \\(o_1, o_2, \\cdots, o_t, o_{t+1}\\) ä¸”åœ¨æ—¶åˆ» \\(t+1\\) å¤„äºçŠ¶æ€ \\(q_i\\) çš„å‰å‘æ¦‚ç‡, å¦‚å›¾ \\(10.1\\) æ‰€ç¤ºã€‚åœ¨å¼ (10.16) çš„æ–¹æ‹¬å¼§é‡Œ, æ—¢ç„¶ \\(\\alpha_t(j)\\) æ˜¯åˆ°æ—¶åˆ» \\(t\\) è§‚æµ‹åˆ° \\(o_1, o_2, \\cdots, o_t\\) å¹¶åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_j\\) çš„å‰å‘æ¦‚ç‡, é‚£ä¹ˆä¹˜ç§¯ \\(\\alpha_t(j) a_{j i}\\) å°±æ˜¯åˆ°æ—¶åˆ» \\(t\\) è§‚æµ‹åˆ° \\(o_1, o_2, \\cdots, o_t\\) å¹¶åœ¨æ—¶åˆ» \\(t\\) å¤„äº çŠ¶æ€ \\(q_j\\) è€Œåœ¨æ—¶åˆ» \\(t+1\\) åˆ°è¾¾çŠ¶æ€ \\(q_i\\) çš„è”åˆæ¦‚ç‡ã€‚å¯¹è¿™ä¸ªä¹˜ç§¯åœ¨æ—¶åˆ» \\(t\\) çš„æ‰€æœ‰å¯èƒ½çš„ #### ç»Ÿè®¡å­¦ä¹ æ–¹æ³•ä¸­å‰å‘ç®—æ³•çš„ä¾‹å­ ### åå‘ç®—æ³• ç»™å®šéšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda\\), å®šä¹‰åœ¨æ—¶åˆ» \\(t\\) çŠ¶æ€ä¸º \\(q_i\\) çš„æ¡ä»¶ä¸‹, ä» \\(t+1\\) åˆ° \\(T\\) çš„éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º \\(o_{t+1}, o_{t+2}, \\cdots, o_T\\) çš„æ¦‚ç‡ä¸ºåå‘æ¦‚ç‡, è®°ä½œ \\[ \\beta_t(i)=P\\left(o_{t+1}, o_{t+2}, \\cdots, o_T \\mid i_t=q_i, \\lambda\\right) \\] å¯ä»¥ç”¨é€’æ¨çš„æ–¹æ³•æ±‚å¾—åå‘æ¦‚ç‡ \\(\\beta_t(i)\\) åŠè§‚æµ‹åºåˆ—æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ã€‚ (è§‚æµ‹åºåˆ—æ¦‚ç‡çš„åå‘ç®—æ³•) è¾“å…¥: éšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda\\), è§‚æµ‹åºåˆ— \\(O\\); è¾“å‡º: è§‚æµ‹åºåˆ—æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ã€‚ (1) \\[ \\beta_T(i)=1, \\quad i=1,2, \\cdots, N \\] å¯¹ \\(t=T-1, T-2, \\cdots, 1\\) \\[ \\beta_t(i)=\\sum_{j=1}^N a_{i j} b_j\\left(o_{t+1}\\right) \\beta_{t+1}(j), \\quad i=1,2, \\cdots, N \\] åå‘ç®—æ³•åˆ°è¿™ä¸€æ­¥åªç”¨åˆ°äº†ç¬¬äºŒä¸ªè§‚æµ‹å€¼ï¼Œè¿˜æœ‰ç¬¬ä¸€ä¸ªè§‚æµ‹å€¼æ²¡æœ‰ç”¨åˆ°ã€‚ å› æ­¤æœ€åè¦ä¹˜ä¸Šã€‚ (3) \\[ P(O \\mid \\lambda)=\\sum_{i=1}^N \\pi_i b_i\\left(o_1\\right) \\beta_1(i) \\] ","date":"2021-10-25","objectID":"/hmm/:5:2","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ç»“åˆ åˆ©ç”¨å‰å‘æ¦‚ç‡å’Œåå‘æ¦‚ç‡çš„å®šä¹‰å¯ä»¥å°†è§‚æµ‹åºåˆ—æ¦‚ç‡ \\(P(O \\mid \\lambda)\\) ç»Ÿä¸€å†™æˆ \\[ P(O \\mid \\lambda)=\\sum_{i=1}^N \\sum_{j=1}^N \\alpha_t(i) a_{i j} b_j\\left(o_{t+1}\\right) \\beta_{t+1}(j), \\quad t=1,2, \\cdots, T-1 \\] ä¹Ÿå¯ä»¥å†™æˆï¼š \\[ P(O\\mid \\lambda) = \\sum_{i=1}^N[\\alpha_t(i)\\beta_t(i)], \\quad t=1,2,\\cdots, T-1 \\] ","date":"2021-10-25","objectID":"/hmm/:5:3","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ä¸€äº›æ¦‚ç‡å’ŒæœŸæœ›é—®é¢˜ åˆ©ç”¨å‰å‘æ¦‚ç‡å’Œåå‘æ¦‚ç‡, å¯ä»¥å¾—åˆ°å…³äºå•ä¸ªçŠ¶æ€å’Œä¸¤ä¸ªçŠ¶æ€æ¦‚ç‡çš„è®¡ç®—å…¬å¼ã€‚ 1. ç»™å®šæ¨¡å‹ \\(\\lambda\\) å’Œè§‚æµ‹ \\(O\\), åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_i\\) çš„æ¦‚ç‡ã€‚è®° \\[ \\gamma_t(i)=P\\left(i_t=q_i \\mid O, \\lambda\\right) \\] å¯ä»¥é€šè¿‡å‰å‘åå‘æ¦‚ç‡è®¡ç®—ã€‚äº‹å®ä¸Šï¼Œ \\[ \\gamma_t(i)=P\\left(i_t=q_i \\mid O, \\lambda\\right)=\\frac{P\\left(i_t=q_i, O \\mid \\lambda\\right)}{P(O \\mid \\lambda)} \\] ç”±å‰å‘æ¦‚ç‡ \\(\\alpha_t(i)\\) å’Œåå‘æ¦‚ç‡ \\(\\beta_t(i)\\) å®šä¹‰å¯çŸ¥: \\[ \\alpha_t(i) \\beta_t(i)=P\\left(i_t=q_i, O \\mid \\lambda\\right) \\] äºæ˜¯å¾—åˆ°: \\[ \\gamma_t(i)=\\frac{\\alpha_t(i) \\beta_t(i)}{P(O \\mid \\lambda)}=\\frac{\\alpha_t(i) \\beta_t(i)}{\\sum_{j=1}^N \\alpha_t(j) \\beta_t(j)} \\] ç»™å®šæ¨¡å‹ \\(\\lambda\\) å’Œè§‚æµ‹ \\(O\\), åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_i\\) ä¸”åœ¨æ—¶åˆ» \\(t+1\\) å¤„äºçŠ¶æ€ \\(q_j\\) çš„æ¦‚ ç‡ã€‚è®° \\[ \\xi_t(i, j)=P\\left(i_t=q_i, i_{t+1}=q_j \\mid O, \\lambda\\right) \\] å¯ä»¥é€šè¿‡å‰å‘åå‘æ¦‚ç‡è®¡ç®—: \\[ \\xi_t(i, j)=\\frac{P\\left(i_t=q_i, i_{t+1}=q_j, O \\mid \\lambda\\right)}{P(O \\mid \\lambda)}=\\frac{P\\left(i_t=q_i, i_{t+1}=q_j, O \\mid \\lambda\\right)}{\\sum_{i=1}^N \\sum_{j=1}^N P\\left(i_t=q_i, i_{t+1}=q_j, O \\mid \\lambda\\right)} \\] è€Œ \\[ P(i_t=q_i,i_{t+1}=q_j,O | \\lambda) = \\alpha_t(i)a_{ij}b_j(o_{t+1})\\beta_{t+1}(j) \\] æ‰€ä»¥ \\[ \\xi_t(i, j)=\\frac{\\alpha_t(i) a_{i j} b_j\\left(o_{t+1}\\right) \\beta_{t+1}(j)}{\\sum_{i=1}^N \\sum_{j=1}^N \\alpha_t(i) a_{i j} b_j\\left(o_{t+1}\\right) \\beta_{t+1}(j)} \\] å°† \\(\\gamma_t(i)\\) å’Œ \\(\\xi_t(i, j)\\) å¯¹å„ä¸ªæ—¶åˆ» \\(t\\) æ±‚å’Œ, å¯ä»¥å¾—åˆ°ä¸€äº›æœ‰ç”¨çš„æœŸæœ›å€¼ã€‚ åœ¨è§‚æµ‹ \\(O\\) ä¸‹çŠ¶æ€ \\(i\\) å‡ºç°çš„æœŸæœ›å€¼: \\[ \\sum_{t=1}^T \\gamma_t(i) \\] ï¼ˆ2ï¼‰åœ¨è§‚æµ‹ \\(O\\) ä¸‹ç”±çŠ¶æ€ \\(i\\) è½¬ç§»çš„æœŸæœ›å€¼: \\[ \\sum_{t=1}^{T-1} \\gamma_t(i) \\] åœ¨è§‚æµ‹ \\(O\\) ä¸‹ç”±çŠ¶æ€ \\(i\\) è½¬ç§»åˆ°çŠ¶æ€ \\(j\\) çš„æœŸæœ›å€¼: \\[ \\sum_{t=1}^{T-1} \\xi_t(i, j) \\] ","date":"2021-10-25","objectID":"/hmm/:6:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"é¢„æµ‹é—®é¢˜ ","date":"2021-10-25","objectID":"/hmm/:7:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"è¿‘ä¼¼ç®—æ³• è¿‘ä¼¼ç®—æ³•çš„æƒ³æ³•æ˜¯, åœ¨æ¯ä¸ªæ—¶åˆ» \\(t\\) é€‰æ‹©åœ¨è¯¥æ—¶åˆ»æœ€æœ‰å¯èƒ½å‡ºç°çš„çŠ¶æ€ $i_t^* $, ä»è€Œå¾— åˆ°ä¸€ä¸ªçŠ¶æ€åºåˆ— \\(I^* =\\left(i_1^* , i_2^* , \\cdots, i_T^* \\right)\\), å°†å®ƒä½œä¸ºé¢„æµ‹çš„ç»“æœã€‚ ç»™å®šéšé©¬å°”å¯å¤«æ¨¡å‹ \\(\\lambda\\) å’Œè§‚æµ‹åºåˆ— \\(O\\), åœ¨æ—¶åˆ» \\(t\\) å¤„äºçŠ¶æ€ \\(q_i\\) çš„æ¦‚ç‡ \\(\\gamma_t(i)\\) æ˜¯ \\[ \\gamma_t(i)=\\frac{\\alpha_t(i) \\beta_t(i)}{P(O \\mid \\lambda)}=\\frac{\\alpha_t(i) \\beta_t(i)}{\\sum_{j=1}^N \\alpha_t(j) \\beta_t(j)} \\] åœ¨æ¯ä¸€æ—¶åˆ» \\(t\\) æœ€æœ‰å¯èƒ½çš„çŠ¶æ€ $i_t^* $ æ˜¯ \\[ i_t^* =\\arg \\max_{1 \\leqslant i \\leqslant N}\\left[\\gamma_t(i)\\right], \\quad t=1,2, \\cdots, T \\] ä»è€Œå¾—åˆ°çŠ¶æ€åºåˆ— \\(I^* =\\left(i_1^* , i_2^* , \\cdots, i_T^* \\right)\\) ã€‚ è¿‘ä¼¼ç®—æ³•çš„ä¼˜ç‚¹æ˜¯è®¡ç®—ç®€å•, å…¶ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯é¢„æµ‹çš„çŠ¶æ€åºåˆ—æ•´ä½“æ˜¯æœ€æœ‰å¯èƒ½ çš„çŠ¶æ€åºåˆ—, å› ä¸ºé¢„æµ‹çš„çŠ¶æ€åºåˆ—å¯èƒ½æœ‰å®é™…ä¸å‘ç”Ÿçš„éƒ¨åˆ†ã€‚äº‹å®ä¸Š, ä¸Šè¿°æ–¹æ³•å¾—åˆ° çš„çŠ¶æ€åºåˆ—ä¸­æœ‰å¯èƒ½å­˜åœ¨è½¬ç§»æ¦‚ç‡ä¸º 0 çš„ç›¸é‚»çŠ¶æ€, å³å¯¹æŸäº› \\(i, j, a_{i j}=0\\) æ—¶ã€‚å°½ç®¡ å¦‚æ­¤, è¿‘ä¼¼ç®—æ³•ä»ç„¶æ˜¯æœ‰ç”¨çš„ã€‚ è¿‘ä¼¼ç®—æ³•å°±æ˜¯ä¸€ç§è´ªå¿ƒçš„ç®—æ³•ï¼Œæ¯ä¸ªæ—¶åˆ»éƒ½å–æœ€æœ‰å¯èƒ½çš„çŠ¶æ€ï¼Œä½†æ•´ä½“åºåˆ—å¹¶ä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£ã€‚ ","date":"2021-10-25","objectID":"/hmm/:7:1","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"ç»´ç‰¹æ¯”ç®—æ³• ç»´ç‰¹æ¯”ç®—æ³•å®é™…ä¸Šæ˜¯ç”¨åŠ¨æ€è§„åˆ’è§£éšé©¬å°”ç§‘å¤«æ¨¡å‹é¢„æµ‹é—®é¢˜ï¼Œç”¨åŠ¨æ€è§„åˆ’æ±‚è§£æ¦‚ç‡æœ€å¤§è·¯å¾„ï¼Œä¸€æ¡è·¯å¾„å¯¹åº”ç€ä¸€æ¡çŠ¶æ€åºåˆ—ã€‚ é¦–å…ˆå¯¼å…¥ä¸¤ä¸ªå˜é‡ \\(\\delta\\) å’Œ \\(\\Psi\\) ã€‚å®šä¹‰åœ¨æ—¶åˆ» \\(t\\) çŠ¶æ€ä¸º \\(i\\) çš„æ‰€æœ‰å•ä¸ªè·¯å¾„ \\(\\left(i_1, i_2, \\cdots, i_t\\right)\\) ä¸­æ¦‚ç‡æœ€å¤§å€¼ä¸º \\[ \\delta_t(i)=\\max_{i_1, i_2, \\cdots, i_{t-1}} P\\left(i_t=i, i_{t-1}, \\cdots, i_1, o_t, \\cdots, o_1 \\mid \\lambda\\right), \\quad i=1,2, \\cdots, N \\] åé¢çš„éƒ¨åˆ†ä¸å‰å‘ç®—æ³•çš„éƒ¨åˆ†æœ‰ç‚¹ç±»ä¼¼ã€‚ ç”±å®šä¹‰å¯å¾—å˜é‡ \\(\\delta\\) çš„é€’æ¨å…¬å¼: \\[ \\begin{aligned} \\delta_{t+1}(i) \u0026=\\max_{i_1, i_2, \\cdots, i_t} P\\left(i_{t+1}=i, i_t, \\cdots, i_1, o_{t+1}, \\cdots, o_1 \\mid \\lambda\\right) \\\\\\\\ \u0026=\\max_{1 \\leqslant j \\leqslant N}\\left[\\delta_t(j) a_{j i}\\right] b_i\\left(o_{t+1}\\right), \\quad i=1,2, \\cdots, N ; \\quad t=1,2, \\cdots, T-1 \\end{aligned} \\] å®šä¹‰åœ¨æ—¶åˆ» \\(t\\) çŠ¶æ€ä¸º \\(i\\) çš„æ‰€æœ‰å•ä¸ªè·¯å¾„ \\(\\left(i_1, i_2, \\cdots, i_{t-1}, i\\right)\\) ä¸­æ¦‚ç‡æœ€å¤§çš„è·¯å¾„çš„ ç¬¬ \\(t-1\\) ä¸ªç»“ç‚¹ä¸º \\[ \\Psi_t(i)=\\arg \\max_{1 \\leqslant j \\leqslant N}\\left[\\delta_{t-1}(j) a_{j i}\\right], \\quad i=1,2, \\cdots, N \\] å¯ä»¥ç®€å•ç†è§£ä¸ºæ‰¾åˆ°ä½¿å¾—ä»t-1çš„jåˆ°tçš„iå¼å­\\(\\delta_{t-1}(j)a_{ji}\\)æœ€å¤§çš„jï¼Œä¹Ÿå°±æ˜¯è¯´\\(\\Psi_t(i)\\)ä»£è¡¨t-1æ—¶åˆ»çš„æœ€ä½³çŠ¶æ€å€¼ï¼Œå¦‚æœtæ—¶åˆ»çš„æœ€ä½³çŠ¶æ€å€¼æ˜¯içš„è¯ï¼Œé‚£ä¹ˆt-1æ—¶åˆ»çš„æœ€ä½³çŠ¶æ€å€¼å°±æ˜¯\\(\\Psi_t(i)\\)ï¼Œåé¢å›æº¯è¦ç”¨åˆ° ä¸‹é¢ä»‹ç»ç»´ç‰¹æ¯”ç®—æ³•ã€‚ è¾“å…¥: æ¨¡å‹ \\(\\lambda=(A, B, \\pi)\\) å’Œè§‚æµ‹ \\(O=\\left(o_1, o_2, \\cdots, o_T\\right)\\); è¾“å‡º: æœ€ä¼˜è·¯å¾„ \\(I^* =\\left(i_1^* , i_2^* , \\cdots, i_T^* \\right)\\) ã€‚ ï¼ˆ1ï¼‰åˆå§‹åŒ– \\[ \\begin{gathered} \\delta_1(i)=\\pi_i b_i\\left(o_1\\right), \\quad i=1,2, \\cdots, N \\\\\\\\ \\Psi_1(i)=0, \\quad i=1,2, \\cdots, N \\end{gathered} \\] å‰è€…å’Œå‰å‘ç®—æ³•çš„åˆå§‹åŒ–æ˜¯ä¸€æ ·çš„ã€‚ é€’æ¨ã€‚å¯¹ \\(t=2,3, \\cdots, T\\) \\[ \\begin{array}{ll} \\delta_t(i)=\\max_{1 \\leqslant j \\leqslant N}\\left[\\delta_{t-1}(j) a_{j i}\\right] b_i\\left(o_t\\right), \\quad i=1,2, \\cdots, N \\\\\\\\ \\Psi_t(i)=\\arg \\max_{1 \\leqslant j \\leqslant N}\\left[\\delta_{t-1}(j) a_{j i}\\right], \\quad i=1,2, \\cdots, N \\end{array} \\] ç»ˆæ­¢ \\[ \\begin{gathered} P^* =\\max_{1 \\leqslant i \\leqslant N} \\delta_T(i) \\\\\\\\ i_T^* =\\arg \\max_{1 \\leqslant i \\leqslant N}\\left[\\delta_T(i)\\right] \\end{gathered} \\] è¿™é‡Œå¾—åˆ°çš„æ˜¯æœ€åä¸€ä¸ªæ—¶åˆ»çš„æœ€ä½³çŠ¶æ€å€¼ï¼Œç„¶åè¿›è¡Œå›æº¯ã€‚ æœ€ä¼˜è·¯å¾„å›æº¯ã€‚å¯¹ \\(t=T-1, T-2, \\cdots, 1\\) \\[ i_t^* =\\Psi_{t+1}\\left(i_{t+1}^* \\right) \\] æ±‚å¾—æœ€ä¼˜è·¯å¾„ \\(I^* =\\left(i_1^* , i_2^* , \\cdots, i_T^* \\right)\\) ã€‚ ä¹¦ä¸Šçš„ä¾‹å­ çœ‹ä¸€ä¸ªä¾‹å­å°±å¾ˆå®¹æ˜“ç†è§£äº† #### ä»£ç  def viterbi(obs, states, start_p, trans_p, emit_p): V = [{}] # åˆ—è¡¨idxä»£è¡¨æ—¶é—´tï¼Œå­—å…¸çš„é”®ä»£è¡¨çŠ¶æ€å€¼ï¼Œå€¼ä»£è¡¨æ¦‚ç‡ path = {} # æœ€ä½³è·¯å¾„ for y in states: V[0][y] = start_p[y] * emit_p[y].get(obs[0], 1e-5) path[y] = [0] # éƒ½åˆå§‹åŒ–ä¸º0 for t in range(1, len(obs)): V.append({}) for y in states: em_p = emit_p[y].get(obs[t], 1e-5) # å–å‡ºè§‚æµ‹å€¼å¯¹åº”çš„æ¦‚ç‡ (prob, state) = max([(V[t-1][y0]*trans_p[y0][y]*em_p, y0) for y0 in states]) V[t][y] = prob path[y] = path[y] + [state] # è®°å½•è·¯å¾„ï¼Œstateæ˜¯å½“å‰æ—¶é—´tçŠ¶æ€ä¸ºyæ—¶t-1çš„æœ€ä½³çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä»stateè½¬ç§»åˆ°yçš„æ¦‚ç‡æœ€å¤§ã€‚å¦‚æœæœ€åæ—¶åˆ»çš„æœ€ä½³çŠ¶æ€æ˜¯yï¼Œåˆ™å›æº¯ä»yå¼€å§‹ï¼Œæœ€åçš„çŠ¶æ€ä¹Ÿæ˜¯yã€‚ (prob, state) = max((V[len(obs)-1][y], y) for y in states) # æ±‚æœ€åæ—¶åˆ»çš„æœ€å¤§æ¦‚ç‡å’ŒçŠ¶æ€ã€‚ return path[state][1:] + [state] # åˆå§‹çŠ¶æ€æ˜¯0ï¼Œæ‰€ä»¥å»æ‰ç¬¬ä¸€ä¸ª0ï¼Œå†åŠ ä¸Šæœ€åæ—¶åˆ»çš„æœ€å¤§æ¦‚ç‡çš„çŠ¶æ€ï¼Œç»“æœå°±æ˜¯æœ€ä½³è·¯å¾„ã€‚è¿™é‡Œé”®å¯¹å€¼çš„è¿‡ç¨‹ç›¸å½“äºå›æº¯äº†ã€‚ A = { 0 : {0:0.5, 1:0.2, 2:0.3}, 1 : {0:0.3, 1:0.5, 2:0.2}, 2 : {0:0.2, 1:0.3, 2:0.5} } B = { 0: {'çº¢': 0.5, 'ç™½': 0.5}, 1: {'çº¢': 0.4, 'ç™½': 0.6}, 2: {'çº¢': 0.7, 'ç™½': 0.3} } Ï€ = {0:0.2, 1:0.4, 2:0.4} viterbi(['çº¢', 'ç™½', 'çº¢'], [0, 1, 2], Ï€, A, B) æ‹¿ä¸Šé¢çš„ä¾‹å­è¿›è¡Œå®éªŒï¼Œæ€è·¯æ˜¯å®Œå…¨æŒ‰ç…§æèˆªè€å¸ˆä¹¦çš„æ€è·¯æ¥çš„ã€‚è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ï¼Œåªæ˜¯å›æº¯çš„å®ç°ä¸å¤ªä¸€æ ·ï¼Œè¿™ä¸ªä¸¥æ ¼æ¥è¯´ä¸èƒ½å«åšå›æº¯ã€‚ ","date":"2021-10-25","objectID":"/hmm/:7:2","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"å­¦ä¹ ç®—æ³• ","date":"2021-10-25","objectID":"/hmm/:8:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ"],"content":"å‚è€ƒ ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹æèˆª https://www.52nlp.cn/hmm-learn-best-practices-one-introduction https://www.cnblogs.com/pinard/p/6945257.html ","date":"2021-10-25","objectID":"/hmm/:9:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","è´å¶æ–¯ç½‘ç»œ","HMM"],"title":"HMM","uri":"/hmm/"},{"categories":["NLP"],"content":"What? TF-IDF(term frequencyâ€“inverse document frequency)æ˜¯ä¸€ç§ç”¨äºä¿¡æ¯æ£€ç´¢ä¸æ•°æ®æŒ–æ˜çš„å¸¸ç”¨åŠ æƒæŠ€æœ¯ï¼Œå¸¸ç”¨äºæŒ–æ˜æ–‡ç« ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸”ç®—æ³•ç®€å•é«˜æ•ˆï¼Œå¸¸è¢«å·¥ä¸šç”¨äºæœ€å¼€å§‹çš„æ–‡æœ¬æ•°æ®æ¸…æ´—ã€‚ TF-IDFæœ‰ä¸¤å±‚æ„æ€ï¼Œä¸€å±‚æ˜¯â€è¯é¢‘â€ï¼ˆTerm Frequencyï¼Œç¼©å†™ä¸ºTFï¼‰ï¼Œå¦ä¸€å±‚æ˜¯â€é€†æ–‡æ¡£é¢‘ç‡â€ï¼ˆInverse Document Frequencyï¼Œç¼©å†™ä¸ºIDFï¼‰ã€‚ å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ç‰‡é•¿æ–‡å«åšã€Šé‡åŒ–ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‹è¯é¢‘é«˜åœ¨æ–‡ç« ä¸­å¾€å¾€æ˜¯åœç”¨è¯ï¼Œâ€œçš„â€ï¼Œâ€œæ˜¯â€ï¼Œâ€œäº†â€ç­‰ï¼Œè¿™äº›åœ¨æ–‡æ¡£ä¸­æœ€å¸¸è§ä½†å¯¹ç»“æœæ¯«æ— å¸®åŠ©ã€éœ€è¦è¿‡æ»¤æ‰çš„è¯ï¼Œç”¨TFå¯ä»¥ç»Ÿè®¡åˆ°è¿™äº›åœç”¨è¯å¹¶æŠŠå®ƒä»¬è¿‡æ»¤ã€‚å½“é«˜é¢‘è¯è¿‡æ»¤åå°±åªéœ€è€ƒè™‘å‰©ä¸‹çš„æœ‰å®é™…æ„ä¹‰çš„è¯ã€‚ ä½†è¿™æ ·åˆä¼šé‡åˆ°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½å‘ç°â€é‡åŒ–â€ã€â€œç³»ç»Ÿâ€ã€â€œæ¶æ„â€è¿™ä¸‰ä¸ªè¯çš„å‡ºç°æ¬¡æ•°ä¸€æ ·å¤šã€‚è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œä½œä¸ºå…³é”®è¯ï¼Œå®ƒä»¬çš„é‡è¦æ€§æ˜¯ä¸€æ ·çš„ï¼Ÿäº‹å®ä¸Šç³»ç»Ÿåº”è¯¥åœ¨å…¶ä»–æ–‡ç« æ¯”è¾ƒå¸¸è§ï¼Œæ‰€ä»¥åœ¨å…³é”®è¯æ’åºä¸Šï¼Œâ€œé‡åŒ–â€å’Œâ€œæ¶æ„â€åº”è¯¥æ’åœ¨â€œç³»ç»Ÿâ€å‰é¢ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦IDFï¼ŒIDFä¼šç»™å¸¸è§çš„è¯è¾ƒå°çš„æƒé‡ï¼Œå®ƒçš„å¤§å°ä¸ä¸€ä¸ªè¯çš„å¸¸è§ç¨‹åº¦æˆåæ¯”ã€‚ å½“æœ‰TF(è¯é¢‘)å’ŒIDF(é€†æ–‡æ¡£é¢‘ç‡)åï¼Œå°†è¿™ä¸¤ä¸ªè¯ç›¸ä¹˜ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªè¯çš„TF-IDFçš„å€¼ã€‚æŸä¸ªè¯åœ¨æ–‡ç« ä¸­çš„TF-IDFè¶Šå¤§ï¼Œé‚£ä¹ˆä¸€èˆ¬è€Œè¨€è¿™ä¸ªè¯åœ¨è¿™ç¯‡æ–‡ç« çš„é‡è¦æ€§ä¼šè¶Šé«˜ï¼Œæ‰€ä»¥é€šè¿‡è®¡ç®—æ–‡ç« ä¸­å„ä¸ªè¯çš„TF-IDFï¼Œç”±å¤§åˆ°å°æ’åºï¼Œæ’åœ¨æœ€å‰é¢çš„å‡ ä¸ªè¯ï¼Œå°±æ˜¯è¯¥æ–‡ç« çš„å…³é”®è¯ã€‚ ","date":"2021-10-24","objectID":"/tf-idf/:1:0","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"æ­¥éª¤ ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—è¯é¢‘ï¼š \\[ è¯é¢‘(TF) = \\frac{æŸä¸ªè¯åœ¨æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°}{æ–‡ç« çš„æ€»è¯æ•°} \\] ç¬¬äºŒæ­¥ï¼Œè®¡ç®—é€†æ–‡æ¡£é¢‘ç‡ï¼š \\[ é€†æ–‡æ¡£é¢‘ç‡(IDF) = log(\\frac{è¯­æ–™åº“çš„æ–‡æ¡£æ€»æ•°}{åŒ…å«è¯¥è¯çš„æ–‡æ¡£æ•°+1}) \\] 1.ä¸ºä»€ä¹ˆ+1ï¼Ÿæ˜¯ä¸ºäº†å¤„ç†åˆ†æ¯ä¸º0çš„æƒ…å†µã€‚å‡å¦‚æ‰€æœ‰çš„æ–‡ç« éƒ½ä¸åŒ…å«è¿™ä¸ªè¯ï¼Œåˆ†å­å°±ä¸º0ï¼Œæ‰€ä»¥+1æ˜¯ä¸ºäº†é˜²æ­¢åˆ†æ¯ä¸º0çš„æƒ…å†µã€‚ 2.ä¸ºä»€ä¹ˆè¦ç”¨logå‡½æ•°ï¼Ÿlogå‡½æ•°æ˜¯å•è°ƒé€’å¢ï¼Œæ±‚logæ˜¯ä¸ºäº†å½’ä¸€åŒ–ï¼Œä¿è¯åæ–‡æ¡£é¢‘ç‡ä¸ä¼šè¿‡å¤§ã€‚ 3.ä¼šå‡ºç°è´Ÿæ•°ï¼Ÿè‚¯å®šä¸ä¼šï¼Œåˆ†å­è‚¯å®šæ¯”åˆ†æ¯å¤§ã€‚ ç¬¬ä¸‰æ­¥ï¼Œè®¡ç®—TF-IDFï¼š \\[ TF-IDF = è¯é¢‘(TF) \\times é€†æ–‡æ¡£é¢‘ç‡(IDF) \\] ","date":"2021-10-24","objectID":"/tf-idf/:2:0","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"ä¼˜ç¼ºç‚¹ TF-IDFçš„ä¼˜ç‚¹æ˜¯ç®€å•å¿«é€Ÿï¼Œè€Œä¸”å®¹æ˜“ç†è§£ã€‚ç¼ºç‚¹æ˜¯æœ‰æ—¶å€™ç”¨è¯é¢‘æ¥è¡¡é‡æ–‡ç« ä¸­çš„ä¸€ä¸ªè¯çš„é‡è¦æ€§ä¸å¤Ÿå…¨é¢ï¼Œæœ‰æ—¶å€™é‡è¦çš„è¯å‡ºç°çš„å¯èƒ½ä¸å¤Ÿå¤šï¼Œè€Œä¸”è¿™ç§è®¡ç®—æ— æ³•ä½“ç°ä½ç½®ä¿¡æ¯ï¼Œæ— æ³•ä½“ç°è¯åœ¨ä¸Šä¸‹æ–‡çš„é‡è¦æ€§ã€‚å¦‚æœè¦ä½“ç°è¯çš„ä¸Šä¸‹æ–‡ç»“æ„ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦ä½¿ç”¨word2vecç®—æ³•æ¥æ”¯æŒã€‚ ","date":"2021-10-24","objectID":"/tf-idf/:3:0","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"ä»£ç  corpus = ['this is the first document', 'this is the second second document', 'and the third one', 'is this the first document'] words_list = list() for i in range(len(corpus)): words_list.append(corpus[i].split(' ')) ","date":"2021-10-24","objectID":"/tf-idf/:4:0","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"æ‰‹åŠ¨å®ç° def manual(): from collections import Counter count_list = list() for i in range(len(words_list)): count = Counter(words_list[i]) count_list.append(count) import math def tf(word, count): return count[word] / sum(count.values()) def idf(word, count_list): n_contain = sum([1 for count in count_list if word in count]) return math.log(len(count_list) / (1 + n_contain)) def tf_idf(word, count, count_list): return tf(word, count) * idf(word, count_list) for i, count in enumerate(count_list): print(\"ç¬¬ {} ä¸ªæ–‡æ¡£ TF-IDF ç»Ÿè®¡ä¿¡æ¯\".format(i + 1)) scores = {word : tf_idf(word, count, count_list) for word in count} sorted_word = sorted(scores.items(), key = lambda x : x[1], reverse=True) for word, score in sorted_word: print(\"\\tword: {}, TF-IDF: {}\".format(word, round(score, 5))) ","date":"2021-10-24","objectID":"/tf-idf/:4:1","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"gensim def gensim_work(): from gensim import corpora # èµ‹ç»™è¯­æ–™åº“ä¸­æ¯ä¸ªè¯(ä¸é‡å¤çš„è¯)ä¸€ä¸ªæ•´æ•°id dic = corpora.Dictionary(words_list) # åˆ›å»ºè¯å…¸ new_corpus = [dic.doc2bow(words) for words in words_list] # å…ƒç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯è¯è¯­åœ¨è¯å…¸ä¸­å¯¹åº”çš„idï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¯è¯­åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•° from gensim import models tfidf = models.TfidfModel(new_corpus) tfidf.save(\"tfidf.model\") # è½½å…¥æ¨¡å‹ tfidf = models.TfidfModel.load(\"tfidf.model\") # ä½¿ç”¨è¿™ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹å¾—åˆ°å•è¯çš„tfidfå€¼ res = [tfidf[temp] for temp in new_corpus] print(res) ","date":"2021-10-24","objectID":"/tf-idf/:4:2","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["NLP"],"content":"sklearn def sklearn_work(): from sklearn.feature_extraction.text import TfidfVectorizer vectorizer = TfidfVectorizer() tfidf = vectorizer.fit_transform(corpus) print(tfidf.toarray()) # æƒé‡ print(vectorizer.get_feature_names()) # å•è¯ print(vectorizer.vocabulary_) # è¯å…¸ ","date":"2021-10-24","objectID":"/tf-idf/:4:3","tags":["NLP","TF-IDF"],"title":"TF-IDF","uri":"/tf-idf/"},{"categories":["pandas"],"content":"è®°å½•ä¸€ä¸‹å®è®­å­¦åˆ°çš„å†…å®¹ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:0:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"å¸ƒå°”ç´¢å¼• å¸ƒå°”ç´¢å¼•ä¸èƒ½ä½¿ç”¨and or not ï¼Œåªèƒ½ç”¨\u0026 | ~ å› ä¸ºåªèƒ½ç”¨ä½æ“ä½œç¬¦ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:1:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"èŠ±å“¨ç´¢å¼• arr = np.arange(32).reshape((8, 4)) arr array([[ 0, 1, 2, 3], [ 4, 5, 6, 7], [ 8, 9, 10, 11], [12, 13, 14, 15], [16, 17, 18, 19], [20, 21, 22, 23], [24, 25, 26, 27], [28, 29, 30, 31]]) arr[[1, 5, 7, 2], [0, 3, 1, 2]] array([ 4, 23, 29, 10]) ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:1:1","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"æ›´å¸¸ç”¨çš„æ–¹å¼ä¸º arr[[1, 5, 7, 2]][:, [0, 3, 1, 2]] # è¡Œï¼Œåˆ—é‡ç½®é¡ºåº array([[ 4, 7, 5, 6], [20, 23, 21, 22], [28, 31, 29, 30], [ 8, 11, 9, 10]]) ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:1:2","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"pandas.cut import pandas as pd import numpy as np cars = pd.read_csv(\"second_cars_info.csv\",encoding=\"gbk\") final_ = [cars.Sec_price.min()] + list(np.linspace(10,100,10)) + [cars.Sec_price.max()] pd.cut(cars[\"Sec_price\"],bins=final_).value_counts().sort_index() # å¯¹åŒºé—´è¿›è¡Œæ’åº # labelså‚æ•°ç»™æ¯ä¸ªåŒºé—´è´´ä¸Šæ ‡ç­¾ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:2:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":".strçš„ç”¨æ³• å¯ä»¥å¯¹è¡Œåˆ—è¿›è¡Œpythonå­—ç¬¦ä¸²ä¸€æ ·çš„æ“ä½œ stud_alcoh[[\"Mjob\",'Fjob']].apply(lambda x:x.str.upper()) # å¯¹Mjob Fjobä¸¤åˆ—å˜æˆå¤§å†™ # ä¹Ÿå¯ä»¥ç”¨applymap stud_alcoh[[\"Mjob\",'Fjob']].applymap(lambda x:x.upper()) #åŒºåˆ«å°±åœ¨äº.str # å› ä¸ºapplymapåªèƒ½å¯¹dataframeè¿›è¡Œæ“ä½œ,applyå¯ä»¥å¯¹Dataframeå’ŒSeriesè¿›è¡Œæ“ä½œã€‚ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:3:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"groupbyä¸applyçµæ´»è¿ç”¨ coffee = pd.read_excel(\"coffee.xlsx\") coffee.groupby(\"åŒºåŸŸ\").apply(lambda x:x[\"é”€å”®é¢\"].sum()) # å¦‚æœæ˜¯DataFramegroupbyå¯¹è±¡è°ƒç”¨applyï¼Œè½¬æ¢å‡½æ•°å¤„ç†çš„å°±æ˜¯æ¯ä¸€ä¸ªåˆ†ç»„ï¼ˆdataframeï¼‰ # ç­‰ä»·äº coffee.groupby(\"åŒºåŸŸ\")['é”€å”®é¢'].sum() æ±‚å„ä¸ªåŒºåŸŸçš„ é”€å”®æ€»å’Œã€å¹³å‡é”€å”®é¢ã€é¢„è®¡é”€å”®é¢ä¸å®é™…é”€å”®é¢çš„å·®å¼‚æ€»å’Œ def transfer(x_):# x_ç±»å‹æ˜¯dataframe res = pd.Series() res[\"é”€å”®æ€»å’Œ\"] = x_[\"é”€å”®é¢\"].sum() res[\"å¹³å‡é”€å”®é¢\"] = x_['é”€å”®é¢'].mean() res['å·®å€¼'] = ( x_[\"é”€å”®é¢\"] - x_['é¢„è®¡é”€å”®é¢']).mean() return res # è¿”å›çš„æ˜¯ä¸€ä¸ªseries coffee.groupby(\"åŒºåŸŸ\").apply(transfer) æ±‚å‡ºä¸ªåŒºåŸŸä¸­ï¼Œé«˜äºè¯¥åŒºåŸŸå¹³å‡åˆ©æ¶¦çš„è®°å½• def transfer(x): # x(dataframe) mean_value = x[\"åˆ©æ¶¦é¢\"].mean() condition = x[\"åˆ©æ¶¦é¢\"] \u003e mean_value return x[condition] # dataframe c = coffee.groupby(\"åŒºåŸŸ\").apply(transfer) # äºŒç»´ç´¢å¼• # c.loc[(\"Central\",0)] ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:4:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"groupbyä¹Ÿå¯ä»¥åµŒå¥— def top_3_data(x):# x è¡¨ç¤ºDataFrame æ¯ä¸ªåŒºåŸŸçš„æ•°æ®é›† res = x.groupby(\"äº§å“åç§°\").sum().sort_values(\"é”€å”®é¢\",ascending=False).iloc[:3] return res coffee.groupby(\"åŒºåŸŸ\").apply(top_3_data) ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:4:1","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"nlargest nsmallest æ±‚æ¯ä¸€åˆ—æœ€å¤§çš„å‡ ä¸ªå¤šæœ€å°çš„å‡ ä¸ªï¼Œä¸€èˆ¬é…åˆgroupbyå’Œapplyä½¿ç”¨ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:5:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"pd.Grouper grouper = pd.Grouper(key=\"è®¢å•æ—¥æœŸ\",freq=\"M\") æŒ‰æœˆè¿›è¡Œåˆ†ç»„ ã€‚freq=\"Y\"å°±æ˜¯æŒ‰å¹´åˆ†ç»„ def top_sale_month(x): #x è¡¨ç¤ºDataFrame æ¯ä¸ªäº§å“çš„æ•°æ®é›† grouper = pd.Grouper(key=\"è®¢å•æ—¥æœŸ\",freq=\"M\") return x.groupby(grouper).sum().nlargest(1,\"é”€å”®é¢\") coffee.groupby(\"äº§å“åç§°\").apply(top_sale_month).reset_index() reset_index()æ–¹æ³•å°±æ˜¯æŒ‰ç…§åŸæ¥çš„indexæ˜¾ç¤ºï¼Œä¸ç„¶å°±æ˜¯æŒ‰ç…§åˆ†ç»„çš„ç»“æœå±•ç¤º ## plt.xticks plt.yticks å¯ä»¥ç†è§£ä¸ºè‡ªå®šä¹‰xè½´çš„åæ ‡ plt.figure(figsize=(12,8)) width = 0.2 plt.bar(np.arange(4)+0,np.random.randint(3,10,(4)),color='r',width=width) plt.bar(np.arange(4)+width*1,np.random.randint(3,10,(4)),color='g',width=width) plt.bar(np.arange(4)+width*2,np.random.randint(3,10,(4)),color='b',width=width) plt.xticks(np.arange(4)+width/2,list(\"abcd\")) # å°†0 1 2 3 æ›¿æ¢ä¸º a b c d plt.show() ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:6:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["pandas"],"content":"np.where np.where(condition, [x, y]),è¿™é‡Œä¸‰ä¸ªå‚æ•°,å…¶ä¸­å¿…å†™å‚æ•°æ˜¯condition(åˆ¤æ–­æ¡ä»¶),åè¾¹çš„xå’Œyæ˜¯å¯é€‰å‚æ•°.é‚£ä¹ˆè¿™ä¸‰ä¸ªå‚æ•°éƒ½æœ‰æ€æ ·çš„è¦æ±‚å‘¢? conditionï¼šarray_likeï¼Œbool,å½“ä¸ºTrueæ—¶ï¼Œäº§ç”Ÿxï¼Œå¦åˆ™äº§ç”Ÿy æƒ…å†µ1ï¼š np.where([[True, False], [True, True]], [[1, 2], [3, 4]], [[9, 8], [7, 6]]) è¿”å›ï¼š array([[1, 8], [3, 4]]) æ¡ä»¶ä¸­ç¬¬0ä¸ªå…ƒç´ ä¸­çš„ç¬¬0ä¸ªå…ƒç´ æ˜¯true,é‚£ä¹ˆå–xä¸­çš„ç›¸å¯¹åº”å…ƒç´ 1; æ¡ä»¶ä¸­ç¬¬0ä¸ªå…ƒç´ ä¸­çš„ç¬¬1ä¸ªå…ƒç´ æ˜¯false,é‚£ä¹ˆå–yä¸­çš„ç›¸å¯¹åº”å…ƒç´ 8; æ¡ä»¶ä¸­ç¬¬1ä¸ªå…ƒç´ ä¸­çš„ç¬¬0ä¸ªå…ƒç´ æ˜¯ture,é‚£ä¹ˆå–xä¸­ç›¸å¯¹åº”çš„å…ƒç´ 3; æ¡ä»¶ä¸­ç¬¬1ä¸ªå…ƒç´ ä¸­çš„ç¬¬1ä¸ªå…ƒç´ æ˜¯ture,é‚£ä¹ˆå–xä¸­ç›¸å¯¹åº”çš„å…ƒç´ 4; æ‰€ä»¥æœ€åçš„ç»“æœä¸­å–å‡ºçš„å…ƒç´ æ˜¯1,8,3,4. æƒ…å†µ2ï¼š x = np.arange(9.).reshape(3, 3) np.where(x\u003e5) # è¿”å›çš„æ˜¯ç´¢å¼• (array([2, 2, 2], dtype=int64), array([0, 1, 2], dtype=int64)) ç¬¬ä¸€ä¸ªarrayæ˜¯è¡Œåæ ‡ï¼Œç¬¬äºŒä¸ªarrayä¸ºåˆ—åæ ‡ã€‚ ä¸æƒ³è¦ç´¢å¼•æƒ³è¦å…·ä½“çš„æ•°å€¼ä¹Ÿå¾ˆç®€å• x[np.where(x\u003e5)] array([6., 7., 8.]) np.where(x \u003c 5, x, -1) array([[ 0., 1., 2.], [ 3., 4., -1.], [-1., -1., -1.]]) å¯è§å°äºäº”çš„éƒ¨åˆ†ä¸å˜ï¼Œå¤§äº5çš„åˆ™å˜æˆäº†-1 np.whereå¸¸ç”¨äºpandasçš„Seriesä¸­ã€‚ ","date":"2021-10-24","objectID":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/:7:0","tags":["pandas","learn_three"],"title":"å®è®­å­¦ä¹ å†…å®¹","uri":"/%E5%AE%9E%E8%AE%AD%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•° ","date":"2021-10-19","objectID":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜","å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°"],"title":"å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°","uri":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/minimum-insertions-to-balance-a-parentheses-string/ ","date":"2021-10-19","objectID":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/:1:0","tags":["ç®—æ³•é¢˜","å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°"],"title":"å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°","uri":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š æœ¬é¢˜å’Œå‰é¢çš„é¢˜å±äºåŒä¸€ç³»åˆ—çš„ï¼Œéƒ½æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ï¼Œä¸è¿‡è¿™ä¸ªä¸æ˜¯1:1 è€Œæ˜¯1:2 æ€è·¯è¿˜æ˜¯å·®ä¸å¤šï¼Œä¸è¿‡åˆ¤æ–­æ¡ä»¶éœ€è¦æ”¹å˜ ","date":"2021-10-19","objectID":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/:2:0","tags":["ç®—æ³•é¢˜","å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°"],"title":"å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°","uri":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def minInsertions(self, s: str) -\u003e int: res,temp = 0,0 for i in s: if i == '(': temp += 2 if temp % 2 == 1: res += 1 temp -= 1 if i == ')': temp -= 1 if temp == -1: res += 1 temp = 1 return res + temp å¼€å§‹è¿˜æ˜¯åˆå§‹åŒ–ï¼Œtempä»£è¡¨éœ€æ±‚çš„å³æ‹¬å·çš„æ•°é‡ å¦‚æœæœ‰å·¦æ‹¬å·çš„è¯ï¼Œåˆ™è®©å³æ‹¬å·çš„éœ€æ±‚+2 å› ä¸ºä¸€ä¸ªå·¦å¯¹åº”ä¸¤ä¸ªå³ è¿™é‡Œæœ‰ä¸ªéš¾ç‚¹ï¼Œå¦‚æœéœ€æ±‚çš„æ˜¯å¥‡æ•°çš„è¯ï¼Œåˆ™åº”æ·»åŠ ä¸€ä¸ªå³æ‹¬å·ï¼Œç„¶åè®©éœ€æ±‚å‡1 å¦‚æœæ˜¯å³æ‹¬å·ï¼Œåˆ™éœ€æ±‚ å‡1 å¦‚æœéœ€æ±‚çš„æˆäº†-1 çš„è¯ åˆ™åœ¨å·¦è¾¹è¡¥ä¸Šå·¦æ‹¬å· res++ æ­¤æ—¶è¿˜éœ€è¦ä¸€ä¸ªå³æ‹¬å·ï¼Œåˆ™tempå†åˆå§‹åŒ–ä¸º1 æœ€åè¿˜æ˜¯è¾“å‡º Q:ä¸ºä»€ä¹ˆæœ€åä¸æ˜¯ temp == -2 res += 1 temp=0 å‘¢ï¼Ÿ çœ‹çœ‹è¿™ä¸ªä¾‹å­: \")))))))\" è¿™æ˜¯7ä¸ªå³æ‹¬å·ï¼Œæœ€åå‡åˆ°æœ€åçš„è¯ï¼Œtempæ˜¯ä¸ªè´Ÿæ•°ï¼Œå½±å“äº†æœ€åçš„ç»“æœã€‚ æ‰€ä»¥è¿˜æ˜¯è¦ç”¨åŸæ¥çš„é‚£æ ·ï¼Œ-1çš„æ—¶å€™å°±è¿›è¡Œåˆ¤æ–­ï¼Œä¸ç”¨è€ƒè™‘å¥‡å¶çš„é—®é¢˜äº† ","date":"2021-10-19","objectID":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/:3:0","tags":["ç®—æ³•é¢˜","å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°"],"title":"å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°","uri":"/%E5%B9%B3%E8%A1%A1%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%91%E6%8F%92%E5%85%A5%E6%AC%A1%E6%95%B0/"},{"categories":["python"],"content":"å¯å˜ä¸ä¸å¯å˜ â€œ-=â€æ“ä½œç¬¦ä¼šè°ƒç”¨__isub__å‡½æ•°ï¼Œè€Œâ€-â€œæ“ä½œç¬¦ä¼šè°ƒç”¨__sub__å‡½æ•°ï¼Œä¸€èˆ¬å¯¹äºå¯å˜å¯¹è±¡æ¥è¯´â€œ-=â€æ“ä½œç¬¦ä¼šç›´æ¥æ”¹å˜selfè‡ªèº«ã€‚ import torch x1 = 1 x2 = 2 params = [x1, x2] for p in params: print(id(p), id(x1), id(x2)) p -= 4 print(id(p), id(x1), id(x2)) print(params) x1 = torch.Tensor([1]) x2 = torch.Tensor([2]) params = [x1, x2] for p in params: print(id(p), id(x1), id(x2)) p -= 4 print(id(p), id(x1), id(x2)) print(params) 9784896 9784896 9784928 9784768 9784896 9784928 9784928 9784896 9784928 9784800 9784896 9784928 [1, 2] 139752445458112 139752445458112 139752445458176 139752445458112 139752445458112 139752445458176 139752445458176 139752445458112 139752445458176 139752445458176 139752445458112 139752445458176 [tensor([-3.]), tensor([-2.])] å¯ä»¥çœ‹åˆ°å¯¹äºintç±»å‹ï¼Œåœ°å€å˜æ¢äº†ï¼Œè€Œtorchç±»å‹ï¼Œåœ°å€å´æ²¡æœ‰å˜åŒ–ã€‚ p -= 4ç­‰ä»·äºp.sub_(4)ã€‚è¿™ä¸ªå¯å˜å¯¹è±¡æ”¹å˜äº†è‡ªèº«ã€‚å†™æˆp = p - 4åˆ™ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œä¹Ÿå°±ä¸å¯èƒ½ä½œç”¨åˆ°åŸå…ˆçš„â€œå¯å˜å¯¹è±¡â€ã€‚ intç±»æ²¡æœ‰å‘ç”Ÿå°±åœ°å˜åŒ–æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ã€‚ è¿™æ˜¯python â€œ-â€ ä¸â€-=â€œçš„ä¸€ä¸ªå‘ å¾®å¦™çš„å­—ç¬¦ä¸² a = 'some_thing' b = 'some'+'_'+'thing' id(a),id(b) (1957716471920, 1957716471920) a = 'wtf' b = 'wtf' a is b True a = 'wtf!' b = 'wtf!' a is b False a,b = 'wtf!','wtf!' a is b True 'a'*20 is 'aaaaaaaaaaaaaaaaaaaa','a'*21 is 'aaaaaaaaaaaaaaaaaaaaa' (True, False) Cpython åœ¨ç¼–è¯‘ä¼˜åŒ–æ—¶, æŸäº›æƒ…å†µä¸‹ä¼šå°è¯•ä½¿ç”¨å·²ç»å­˜åœ¨çš„ä¸å¯å˜å¯¹è±¡,æˆä¸ºå­—ç¬¦ä¸²é©»ç•™ å‘ç”Ÿé©»ç•™ä¹‹å, è®¸å¤šå˜é‡å¯èƒ½æŒ‡å‘å†…å­˜ä¸­çš„ç›¸åŒå­—ç¬¦ä¸²å¯¹è±¡ æ‰€æœ‰é•¿åº¦ä¸º 0 å’Œé•¿åº¦ä¸º 1 çš„å­—ç¬¦ä¸²éƒ½è¢«é©»ç•™. å­—ç¬¦ä¸²åœ¨ç¼–è¯‘æ—¶è¢«å®ç° (â€˜wtfâ€™ å°†è¢«é©»ç•™, ä½†æ˜¯ â€™â€˜.join([â€™wâ€™, â€™tâ€™, â€™fâ€™] å°†ä¸ä¼šè¢«é©»ç•™) å­—ç¬¦ä¸²ä¸­åªåŒ…å«å­—æ¯ï¼Œæ•°å­—æˆ–ä¸‹åˆ’çº¿æ—¶å°†ä¼šé©»ç•™. æ‰€ä»¥ â€™wtf!â€™ ç”±äºåŒ…å« ! è€Œæœªè¢«é©»ç•™ã€‚ å½“åœ¨åŒä¸€è¡Œå°† a å’Œ b çš„å€¼è®¾ç½®ä¸º â€œwtf!â€ çš„æ—¶å€™, Python è§£é‡Šå™¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡, ç„¶ååŒæ—¶å¼•ç”¨ç¬¬äºŒä¸ªå˜é‡. å¸¸é‡æŠ˜å (constant folding) æ˜¯ Python ä¸­çš„ä¸€ç§ çª¥å­”ä¼˜åŒ–(peephole optimization) æŠ€æœ¯. è¿™æ„å‘³ç€åœ¨ç¼–è¯‘æ—¶è¡¨è¾¾å¼ â€˜aâ€™*20 ä¼šè¢«æ›¿æ¢ä¸º â€˜aaaaaaaaaaaaaaaaaaaaâ€™ ä»¥å‡å°‘è¿è¡Œæ—¶çš„æ—¶é’Ÿå‘¨æœŸ. åªæœ‰é•¿åº¦å°äº 20 çš„å­—ç¬¦ä¸²æ‰ä¼šå‘ç”Ÿå¸¸é‡æŠ˜å . a = 1 b = 1 a is b,id(a) == id(b) (True, True) is æ˜¯æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸åŒ(is è¡¨ç¤ºå¯¹è±¡æ ‡è¯†ç¬¦å³ object identity)ï¼Œå³ç”¨ id() å‡½æ•°æŸ¥çœ‹çš„åœ°å€æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™è¿”å› Trueï¼Œå¦‚æœä¸åŒåˆ™è¿”å› Falseã€‚is ä¸èƒ½è¢«é‡è½½ã€‚ == æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ­¤æ“ä½œç¬¦å†…éƒ¨è°ƒç”¨çš„æ˜¯ _eq() æ–¹æ³•ã€‚æ‰€ä»¥ a==b ç­‰æ•ˆäºa.___eq__(b)ï¼Œæ‰€ä»¥ = å¯ä»¥è¢«é‡è½½ ","date":"2021-10-18","objectID":"/wtf/:1:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"æ˜¯æ—¶å€™æ¥ç‚¹è›‹ç³•äº†! some_dict = {} some_dict[5.5] = 'ruby' some_dict[5.0] = 'javascript' some_dict[5] = 'python' print(some_dict[5.0]) python 5 == 5.0,hash(5) == hash(5.0) (True, True) Python å­—å…¸é€šè¿‡æ£€æŸ¥é”®å€¼æ˜¯å¦ç›¸ç­‰å’Œæ¯”è¾ƒå“ˆå¸Œå€¼æ¥ç¡®å®šä¸¤ä¸ªé”®æ˜¯å¦ç›¸åŒ. å…·æœ‰ç›¸åŒå€¼çš„ä¸å¯å˜å¯¹è±¡åœ¨Pythonä¸­å§‹ç»ˆå…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ ","date":"2021-10-18","objectID":"/wtf/:2:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"æœ¬è´¨ä¸Š,æˆ‘ä»¬éƒ½ä¸€æ · class WTF: pass print(WTF() == WTF(),WTF() is WTF()) print(hash(WTF()) == hash(WTF())) print(id(WTF()) == id(WTF())) False False True True å½“è°ƒç”¨ id å‡½æ•°æ—¶, Python åˆ›å»ºäº†ä¸€ä¸ª WTF ç±»çš„å¯¹è±¡å¹¶ä¼ ç»™ id å‡½æ•°. ç„¶å id å‡½æ•°è·å–å…¶idå€¼ (ä¹Ÿå°±æ˜¯å†…å­˜åœ°å€), ç„¶åä¸¢å¼ƒè¯¥å¯¹è±¡. è¯¥å¯¹è±¡å°±è¢«é”€æ¯äº†. å½“æˆ‘ä»¬è¿ç»­ä¸¤æ¬¡è¿›è¡Œè¿™ä¸ªæ“ä½œæ—¶, Pythonä¼šå°†ç›¸åŒçš„å†…å­˜åœ°å€åˆ†é…ç»™ç¬¬äºŒä¸ªå¯¹è±¡. å› ä¸º (åœ¨CPythonä¸­) id å‡½æ•°ä½¿ç”¨å¯¹è±¡çš„å†…å­˜åœ°å€ä½œä¸ºå¯¹è±¡çš„idå€¼, æ‰€ä»¥ä¸¤ä¸ªå¯¹è±¡çš„idå€¼æ˜¯ç›¸åŒçš„. print(id(id(WTF())) == id(id(WTF()))) ##æ— è®ºå¤šå°‘ä¸ªIDéƒ½æ˜¯True åŸå› å°±åœ¨ä¸Šé¢ ##è™½ç„¶id(id(WTF())) == id(id(WTF())) ä½†æ˜¯id(WTF()) is id(WTF()) è¿”å›True ##åŸå› å°±æ˜¯idè¿™ä¸ªå‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ç‰¹æ®Šæ€§ print(id(WTF()) is id(WTF())) True False class WTF(object): def __init__(self): print(\"I\") def __del__(self): print(\"D\") WTF() is WTF() ##è¿™æ—¶æ˜¯ä¸¤ä¸ªå¯¹è±¡ä¸€èµ·åˆ›å»ºï¼Œç„¶åä¸€èµ·é”€æ¯ï¼Œæ‰€ä»¥idä¸ä¸€æ · I I D D False id(WTF()) == id(WTF()) ##è¿™æ—¶å€™å…ˆåˆ›å»ºä¸€ä¸ªé”€æ¯ï¼Œç„¶åå†åˆ›å»ºã€‚å¯¹è±¡é”€æ¯çš„é¡ºåºæ˜¯é€ æˆæ‰€æœ‰ä¸åŒä¹‹å¤„çš„åŸå› . I D I D True ","date":"2021-10-18","objectID":"/wtf/:3:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"ä¸ºä»€ä¹ˆï¼Ÿ some_string = \"wtf\" some_dict = {} for i, some_dict[i] in enumerate(some_string): pass some_dict Python è¯­æ³• ä¸­å¯¹ for çš„å®šä¹‰æ˜¯: {0: 'w', 1: 't', 2: 'f'} for_stmt: 'for' exprlist 'in' testlist ':' suite ['else' ':' suite] å…¶ä¸­ exprlist æŒ‡åˆ†é…ç›®æ ‡. è¿™æ„å‘³ç€å¯¹å¯è¿­ä»£å¯¹è±¡ä¸­çš„æ¯ä¸€é¡¹éƒ½ä¼šæ‰§è¡Œç±»ä¼¼ {exprlist} = {next_value} çš„æ“ä½œ. for i in range(4): print(i) i = 10 0 1 2 3 ","date":"2021-10-18","objectID":"/wtf/:4:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"åˆ—è¡¨å‰¯æœ¬ list1 = [1,2,3,4,5] list2 = list1 list2[0] = 6 print(list1,list2) [6, 2, 3, 4, 5] [6, 2, 3, 4, 5] list1 = [1,2,3,4,5] list2 = list1[:] list2[0] = 6 print(list1,list2) [1, 2, 3, 4, 5] [6, 2, 3, 4, 5] ","date":"2021-10-18","objectID":"/wtf/:5:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"æ‰§è¡Œæ—¶æœºå·®å¼‚ array = [1, 8, 15] g = (x for x in array if array.count(x) \u003e 0) ##è¿™æ—¶å€™xä¸º[1,8,15]çš„è§£åŒ… ##è€Œåé¢çš„arrayå˜æˆäº†ä¸‹é¢çš„ array = [2, 8, 22] print(list(g)) [8] åœ¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¸­, in å­å¥åœ¨å£°æ˜æ—¶æ‰§è¡Œ, è€Œæ¡ä»¶å­å¥åˆ™æ˜¯åœ¨è¿è¡Œæ—¶æ‰§è¡Œ. æ‰€ä»¥åœ¨è¿è¡Œå‰, array å·²ç»è¢«é‡æ–°èµ‹å€¼ä¸º [2, 8, 22], å› æ­¤å¯¹äºä¹‹å‰çš„ 1, 8 å’Œ 15, åªæœ‰ count(8) çš„ç»“æœæ˜¯å¤§äº 0 çš„, æ‰€ä»¥ç”Ÿæˆå™¨åªä¼šç”Ÿæˆ 8. array_1 = [1,2,3,4] g1 = (x for x in array_1) array_1 = [1,2,3,4,5] array_2 = [1,2,3,4] g2 = (x for x in array_2) array_2[:] = [1,2,3,4,5] print(list(g1)) print(list(g2)) [1, 2, 3, 4] [1, 2, 3, 4, 5] ç¬¬äºŒéƒ¨åˆ†ä¸­ g1 å’Œ g2 çš„è¾“å‡ºå·®å¼‚åˆ™æ˜¯ç”±äºå˜é‡ array_1 å’Œ array_2 è¢«é‡æ–°èµ‹å€¼çš„æ–¹å¼å¯¼è‡´çš„. åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹, array_1 è¢«ç»‘å®šåˆ°æ–°å¯¹è±¡ [1,2,3,4,5], å› ä¸º in å­å¥æ˜¯åœ¨å£°æ˜æ—¶è¢«æ‰§è¡Œçš„ï¼Œ æ‰€ä»¥å®ƒä»ç„¶å¼•ç”¨æ—§å¯¹è±¡ [1,2,3,4]. åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹, å¯¹ array_2 çš„åˆ‡ç‰‡èµ‹å€¼å°†ç›¸åŒçš„æ—§å¯¹è±¡ [1,2,3,4] åŸåœ°æ›´æ–°ä¸º [1,2,3,4,5]. å› æ­¤ g2 å’Œ array_2 ä»ç„¶å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡(è¿™ä¸ªå¯¹è±¡ç°åœ¨å·²ç»æ›´æ–°ä¸º [1,2,3,4,5]). ","date":"2021-10-18","objectID":"/wtf/:6:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"å‡ºäººæ„æ–™çš„is a = 256 b = 256 a is b True a = 257 b = 257 ##256 æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡, è€Œ 257 ä¸æ˜¯ ##å½“ä½ å¯åŠ¨Python çš„æ—¶å€™, -5 åˆ° 256 çš„æ•°å€¼å°±å·²ç»è¢«åˆ†é…å¥½äº†. ##è¿™äº›æ•°å­—å› ä¸ºç»å¸¸ä½¿ç”¨æ‰€ä»¥é€‚åˆè¢«æå‰å‡†å¤‡å¥½ a is b False a,b = 257,257 ##å½“ a å’Œ b åœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨ç›¸åŒçš„å€¼åˆå§‹åŒ–æ—¶ï¼Œä¼šæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡. print(a is b) print(id(a),id(b)) True 1957717387056 1957717387056 [] == [] True [] is [] ##ä¸¤ä¸ªç©ºåˆ—è¡¨ä½äºä¸åŒçš„å†…å­˜åœ°å€ False ","date":"2021-10-18","objectID":"/wtf/:7:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"ä¸€è¹´å³è‡³! row = [\"\"] * 3 board = [row] * 3 board [['', '', ''], ['', '', ''], ['', '', '']] board[0][0] = 'X' board ##è¿™æ˜¯å› ä¸ºä¹‹å‰å¯¹rowåšä¹˜æ³•å¯¼è‡´çš„ [['X', '', ''], ['X', '', ''], ['X', '', '']] ##å¦‚ä½•é¿å…è¿™ç§æƒ…å†µï¼Ÿ board = [['']*3 for _ in range(3)] board[0][0] = 'X' board [['X', '', ''], ['', '', ''], ['', '', '']] ","date":"2021-10-18","objectID":"/wtf/:8:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"éº»çƒ¦çš„è¾“å‡º funcs = [] res = [] for x in range(7): def func(): return x funcs.append(func) res.append(func()) func_res = [func() for func in funcs] print(func_res,res) [6, 6, 6, 6, 6, 6, 6] [0, 1, 2, 3, 4, 5, 6] power_x = [lambda x:x**i for i in range(11)] print([func(2) for func in power_x]) [1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024] åœ¨å¾ªç¯å†…éƒ¨å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶, å¦‚æœè¯¥å‡½æ•°åœ¨å…¶ä¸»ä½“ä¸­ä½¿ç”¨äº†å¾ªç¯å˜é‡, åˆ™é—­åŒ…å‡½æ•°å°†ä¸å¾ªç¯å˜é‡ç»‘å®š, è€Œä¸æ˜¯å®ƒçš„å€¼. å› æ­¤, æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯ä½¿ç”¨æœ€ååˆ†é…ç»™å˜é‡çš„å€¼æ¥è¿›è¡Œè®¡ç®—çš„. ","date":"2021-10-18","objectID":"/wtf/:9:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"è¿Pythonä¹ŸçŸ¥é“çˆ±æ˜¯éš¾è¨€çš„ import this The Zen of Python, by Tim Peters Beautiful is better than ugly. Explicit is better than implicit. Simple is better than complex. Complex is better than complicated. Flat is better than nested. Sparse is better than dense. Readability counts. Special cases aren't special enough to break the rules. Although practicality beats purity. Errors should never pass silently. Unless explicitly silenced. In the face of ambiguity, refuse the temptation to guess. There should be one-- and preferably only one --obvious way to do it. Although that way may not be obvious at first unless you're Dutch. Now is better than never. Although never is often better than *right* now. If the implementation is hard to explain, it's a bad idea. If the implementation is easy to explain, it may be a good idea. Namespaces are one honking great idea -- let's do more of those! love = this this is love True love is True False love is False False love is not True or False True love is not True or False;love is love True ","date":"2021-10-18","objectID":"/wtf/:10:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"ä¸‰ä¸ªå¼•å· print('wtfpython''') wtfpython print(\"wtf\" \"python\") wtfpython ","date":"2021-10-18","objectID":"/wtf/:11:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"å¸ƒå°”ä½ å’‹äº†? mixed_list = [False, 1.0, \"some_string\", 3, True, [], False] integers_found_so_far = 0 booleans_found_so_far = 0 for item in mixed_list: if isinstance(item, int): integers_found_so_far += 1 elif isinstance(item, bool): booleans_found_so_far += 1 integers_found_so_far 4 booleans_found_so_far 0 another_dict = {} another_dict[True] = \"JavaScript\" another_dict[1] = \"Ruby\" another_dict[1.0] = \"Python\" another_dict[True] 'Python' å¸ƒå°”å€¼æ˜¯ int çš„å­ç±» some_iterable = ('a', 'b') def some_func(val): return \"something\" [x for x in some_iterable] ['a', 'b'] [(yield x) for x in some_iterable] \u003cgenerator object \u003clistcomp\u003e at 0x000001CC6FFC3888\u003e list([(yield x) for x in some_iterable]) ['a', 'b'] list(((yield x) for x in some_iterable)) ['a', None, 'b', None] list(some_func((yield x)) for x in some_iterable) ['a', 'something', 'b', 'something'] ","date":"2021-10-18","objectID":"/wtf/:12:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"æ¶ˆå¤±çš„å¤–éƒ¨å˜é‡ e = 7 try: raise Exception() except Exception as e: pass print(e) ##error! ","date":"2021-10-18","objectID":"/wtf/:13:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"ä»æœ‰åˆ°æ—  some_list = [1, 2, 3] some_dict = { \"key_1\": 1, \"key_2\": 2, \"key_3\": 3 } some_list = some_list.append(4) some_dict = some_dict.update({\"key_4\": 4}) some_list some_dict å¤§å¤šæ•°ä¿®æ”¹åºåˆ—/æ˜ å°„å¯¹è±¡çš„æ–¹æ³•, æ¯”å¦‚ list.append, dict.update, list.sort ç­‰ç­‰. éƒ½æ˜¯åŸåœ°ä¿®æ”¹å¯¹è±¡å¹¶è¿”å› None. è¿™æ ·åšçš„ç†ç”±æ˜¯, å¦‚æœæ“ä½œå¯ä»¥åŸåœ°å®Œæˆ, å°±å¯ä»¥é¿å…åˆ›å»ºå¯¹è±¡çš„å‰¯æœ¬æ¥æé«˜æ€§èƒ½. ","date":"2021-10-18","objectID":"/wtf/:14:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"è¿­ä»£åˆ—è¡¨æ—¶åˆ é™¤å…ƒç´  list_1 = [1, 2, 3, 4] list_2 = [1, 2, 3, 4] list_3 = [1, 2, 3, 4] list_4 = [1, 2, 3, 4] for idx, item in enumerate(list_1): del item for idx, item in enumerate(list_2): list_2.remove(item) for idx, item in enumerate(list_3[:]): list_3.remove(item) for idx, item in enumerate(list_4): list_4.pop(idx) list_1 ##æ²¡æœ‰ä¿®æ”¹list_1 [1, 2, 3, 4] list_2 ##æ¯ä¸€æ¬¡åˆ é™¤å…ƒç´ å è¿­ä»£çš„list_2ä¹Ÿå‘ç”Ÿæ”¹å˜ æ¯”å¦‚ç¬¬ä¸€æ¬¡åˆ é™¤äº†1 list_2ä¸º[2,3,4]è¿™æ—¶idx=1 æ‰€ä»¥ä¸‹ä¸€ä¸ªåˆ é™¤äº†3 [2, 4] list_3 ##è¿­ä»£å‰¯æœ¬ä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µ [] list_4 [2, 4] ","date":"2021-10-18","objectID":"/wtf/:15:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"å¾ªç¯å˜é‡æ³„éœ² for x in range(7): if x == 6: print(x, ': for x inside loop') print(x, ': x in global') 6 : for x inside loop 6 : x in global ## è¿™æ¬¡æˆ‘ä»¬å…ˆåˆå§‹åŒ–x x = -1 for x in range(7): if x == 6: print(x, ': for x inside loop') print(x, ': x in global') 6 : for x inside loop 6 : x in global x = 1 print([x for x in range(5)]) print(x, ': x in global') [0, 1, 2, 3, 4] 1 : x in global ","date":"2021-10-18","objectID":"/wtf/:16:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"å½“å¿ƒé»˜è®¤çš„å¯å˜å‚æ•° def some_func(default_arg=[]): default_arg.append(\"some_string\") return default_arg some_func() ['some_string'] some_func() ['some_string', 'some_string'] some_func([]) ['some_string'] some_func() ['some_string', 'some_string', 'some_string'] Pythonä¸­å‡½æ•°çš„é»˜è®¤å¯å˜å‚æ•°å¹¶ä¸æ˜¯æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶éƒ½ä¼šè¢«åˆå§‹åŒ–. ç›¸å, å®ƒä»¬ä¼šä½¿ç”¨æœ€è¿‘åˆ†é…çš„å€¼ä½œä¸ºé»˜è®¤å€¼. å½“æˆ‘ä»¬æ˜ç¡®çš„å°† [] ä½œä¸ºå‚æ•°ä¼ é€’ç»™ some_func çš„æ—¶å€™, å°±ä¸ä¼šä½¿ç”¨ default_arg çš„é»˜è®¤å€¼, æ‰€ä»¥å‡½æ•°ä¼šè¿”å›æˆ‘ä»¬æ‰€æœŸæœ›çš„ç»“æœ. some_func.__defaults__ (['some_string', 'some_string', 'some_string'],) é¿å…å¯å˜å‚æ•°å¯¼è‡´çš„é”™è¯¯çš„å¸¸è§åšæ³•æ˜¯å°† None æŒ‡å®šä¸ºå‚æ•°çš„é»˜è®¤å€¼, ç„¶åæ£€æŸ¥æ˜¯å¦æœ‰å€¼ä¼ ç»™å¯¹åº”çš„å‚æ•°. ä¾‹: def some_func(default_arg=None): if not default_arg: default_arg = [] default_arg.append(\"some_string\") return default_arg ","date":"2021-10-18","objectID":"/wtf/:17:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"åŒäººä¸åŒå‘½ a = [1, 2, 3, 4] b = a a = a + [5, 6, 7, 8] a [1, 2, 3, 4, 5, 6, 7, 8] b [1, 2, 3, 4] a = [1, 2, 3, 4] b = a a += [5, 6, 7, 8] a [1, 2, 3, 4, 5, 6, 7, 8] b [1, 2, 3, 4, 5, 6, 7, 8] a += b å¹¶ä¸æ€»æ˜¯ä¸ a = a + b è¡¨ç°ç›¸åŒ. ç±»å®ç° op= è¿ç®—ç¬¦çš„æ–¹å¼ ä¹Ÿè®¸ æ˜¯ä¸åŒçš„, åˆ—è¡¨å°±æ˜¯è¿™æ ·åšçš„. è¡¨è¾¾å¼ a = a + [5,6,7,8] ä¼šç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨, å¹¶è®© a å¼•ç”¨è¿™ä¸ªæ–°åˆ—è¡¨, åŒæ—¶ä¿æŒ b ä¸å˜. è¡¨è¾¾å¼ a += [5,6,7,8] å®é™…ä¸Šæ˜¯ä½¿ç”¨çš„æ˜¯ â€œextendâ€ å‡½æ•°, æ‰€ä»¥ a å’Œ b ä»ç„¶æŒ‡å‘å·²è¢«ä¿®æ”¹çš„åŒä¸€åˆ—è¡¨. a_var = 'global variable' def a_func(): print(a_var, '[ a_var inside a_func() ]') a_func() print(a_var, '[ a_var outside a_func() ]') global variable [ a_var inside a_func() ] global variable [ a_var outside a_func() ] a_var = 'global value' def a_func(): a_var = 'local value' print(a_var, '[ a_var inside a_func() ]') a_func() print(a_var, '[ a_var outside a_func() ]') local value [ a_var inside a_func() ] global value [ a_var outside a_func() ] a_var = 'global value' def a_func(): global a_var a_var = 'local value' print(a_var, '[ a_var inside a_func() ]') print(a_var, '[ a_var outside a_func() ]') a_func() print(a_var, '[ a_var outside a_func() ]') global value [ a_var outside a_func() ] local value [ a_var inside a_func() ] local value [ a_var outside a_func() ] a_var = 'global value' def outer(): a_var = 'enclosed value' def inner(): a_var = 'local value' print(a_var) inner() outer() local value a_var = 'global variable' def len(in_var): print('called my len() function') l = 0 for i in in_var: l += 1 return l def a_func(in_var): len_in_var = len(in_var) print('Input variable is of length', len_in_var) a_func('Hello, World!') called my len() function Input variable is of length 13 a = 'global' def outer(): def len(in_var): print('called my len() function: ', end=\"\") l = 0 for i in in_var: l += 1 return l a = 'local' def inner(): global len nonlocal a a += ' variable' inner() print('a is', a) print(len(a)) outer() print(len(a)) print('a is', a) a is local variable called my len() function: 14 called my len() function 6 a is global ","date":"2021-10-18","objectID":"/wtf/:18:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["python"],"content":"å¤§æµ·æé’ˆ x, y = (0, 1) if True else None, None x,y ((0, 1), None) ##æ­£ç¡®åšæ³• x,y = (0,1) if True else (None,None) x,y (0, 1) t = ('one', 'two') for i in t: print(i) t = ('one') for i in t: print(i) t = () print(t) one two o n e () ##æ˜æ˜¾ä¸Šé¢çš„æŠŠt = ('one') tå½“æˆå­—ç¬¦ä¸²äº†ï¼Œæ­£ç¡®åšæ³•å¦‚ä¸‹ t = ('one',) ##æ³¨æ„é€—å· for i in t: print(i) one ","date":"2021-10-18","objectID":"/wtf/:19:0","tags":["python","WTF"],"title":"WTF","uri":"/wtf/"},{"categories":["NLP"],"content":"å…±ç°çŸ©é˜µ ä¸»è¦ç”¨äºå‘ç°ä¸»é¢˜ï¼Œè§£å†³è¯å‘é‡ç›¸è¿‘å…³ç³»çš„è¡¨ç¤º ä¾‹å¦‚ï¼Œè¯­æ–™åº“å¦‚ä¸‹ï¼š - I like deep learning. - I like NLP. - I enjoy flying. åˆ™å…±ç°çŸ©é˜µå¦‚ä¸‹(çª—å£å¤§å°ä¸º1) ä¾‹å¦‚ï¼šâ€œI likeâ€å‡ºç°åœ¨ç¬¬1ï¼Œ2å¥è¯ä¸­ï¼Œä¸€å…±å‡ºç°2æ¬¡ï¼Œæ‰€ä»¥=2ã€‚Â å¯¹ç§°çš„çª—å£æŒ‡çš„æ˜¯ï¼Œâ€œlike Iâ€ä¹Ÿæ˜¯2æ¬¡ å°†å…±ç°çŸ©é˜µè¡Œ(åˆ—)ä½œä¸ºè¯å‘é‡è¡¨ç¤ºåï¼Œå¯ä»¥çŸ¥é“likeï¼Œenjoyéƒ½æ˜¯åœ¨Ié™„è¿‘ä¸”ç»Ÿè®¡æ•°ç›®å¤§çº¦ç›¸ç­‰ï¼Œä»–ä»¬æ„æ€ç›¸è¿‘ã€‚ ","date":"2021-10-15","objectID":"/%E5%85%B1%E7%8E%B0%E7%9F%A9%E9%98%B5/:0:0","tags":["NLP","å…±ç°çŸ©é˜µ"],"title":"å…±ç°çŸ©é˜µ","uri":"/%E5%85%B1%E7%8E%B0%E7%9F%A9%E9%98%B5/"},{"categories":["NLP"],"content":"ä»£ç  import numpy as np word2ind = {w:i for i,w in enumerate(words)} # wordåˆ°keyï¼Œwordså°±æ˜¯è¯æ±‡è¡¨ M = np.zeros((num_words, num_words)) # num_wordsæ˜¯è¯æ±‡è¡¨çš„é•¿åº¦ for c in corpus: # å‡è®¾è¯­æ–™åº“æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…ƒç´ ä¸ºä¸€æ®µæ–‡æœ¬ã€‚éå†è¯­æ–™åº“ for idx, word in enumerate(c): # éå†æ–‡æœ¬çš„æ¯ä¸€ä¸ªè¯ï¼Œè¿™é‡Œé»˜è®¤ç©ºæ ¼åˆ†è¯ for i in range(1, window_size+1): # å¯¹çª—å£å¤§ å°è¿›è¡Œéå† left = idx - i # è‡ªå·±ä¸è‡ªå·±ä¸ç®—å…±ç°ï¼Œæ‰€ä»¥è¿™é‡Œè¦åŠ å‡ right = idx + i if left \u003e= 0: # å·¦è¾¹å…ƒç´  M[word2ind[word], word2ind[c[left]]] += 1 if right \u003c len(c): # å³è¾¹å…ƒç´  M[word2ind[word], word2ind[c[right]]] += 1 ","date":"2021-10-15","objectID":"/%E5%85%B1%E7%8E%B0%E7%9F%A9%E9%98%B5/:1:0","tags":["NLP","å…±ç°çŸ©é˜µ"],"title":"å…±ç°çŸ©é˜µ","uri":"/%E5%85%B1%E7%8E%B0%E7%9F%A9%E9%98%B5/"},{"categories":["python"],"content":"ä¸¤ä¸ªæ•°çš„äº¤æ¢ # a = 1 # b = 2 # temp = b # b = a # a = temp # print(a,b) a = 1 b = 2 a,b = b,a print(a,b) 2 1 ","date":"2021-10-10","objectID":"/skill/:1:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"æ ¼å¼åŒ–å­—ç¬¦ä¸² a = 17 name = \"wlb\" # print('%s is %d years old' % (name,a)) # print('{} is {} years old'.format(name,a)) print(f'{name} is {a} years old') #æ˜æ˜¾è¿™ä¸ªæ–¹æ³•æ›´ç®€å• wlb is 17 years old ","date":"2021-10-10","objectID":"/skill/:2:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"yieldä¸yield from def fib(n): a = 0 b = 1 for _ in range(n): yield a a,b = b,a+b for i in fib(10): print(i) #æ³¨é‡Šçš„å†…å®¹ä¸yield aæ•ˆæœç›¸åŒï¼Œyieldç›¸å½“äºä½¿å…¶æˆä¸ºä¸€ä¸ªè¿­ä»£å™¨ yieldä¸€ä¸ªæ•°åä¼šç«‹é©¬ä¼ é€’å‡ºå»ï¼Œè€Œreturn è¦ç­‰åˆ—è¡¨éƒ½ç”Ÿæˆå®Œæ¯•åæ‰ä¼šä¼ å‡ºå» #ä»–çš„ä¼˜åŠ¿åœ¨äºä¸€äº›è€—æ—¶çš„æ“ä½œ # é€šè¿‡yieldæ¥è¿›è¡Œdfsï¼Œç”±äºæ²¡æœ‰å®ç°__next__å› æ­¤æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ class Node: def __init__(self,value) -\u003e None: self._value = value self._node = [] def __repr__(self) -\u003e str: return f'Node({self._value})' def add_children(self,node:'Node') -\u003e 'Node': self._node.append(node) def __iter__(self): return iter(self._node) def dfs(self): yield self for i in self: yield from i.dfs() root = Node(0) children1 = Node(1) children2 = Node(2) root.add_children(children1) root.add_children(children2) children1.add_children(Node(3)) children1.add_children(Node(4)) children11 = Node(5) children2.add_children(children11) children11.add_children(Node(6)) for c in root.dfs(): print(c) from typing import Iterable def test_format(datas: Iterable[str], max_len: int): for data in datas: if len(data) \u003e max_len: yield data[:max_len] + '...' else: yield data print(list(test_format(['vllbc', 'test_for_this_function', 'good'],5))) # æŠŠé•¿åº¦å¤§äº5çš„éƒ¨åˆ†å˜æˆçœç•¥å· #å­ç”Ÿæˆå™¨ def average_gen(): total = 0 count = 0 average = 0 while True: new_num = yield average if new_num is None: break count += 1 total += new_num average = total/count return total,count,average # å§”æ‰˜ç”Ÿæˆå™¨ def proxy_gen(): while True: total,count,average = yield from average_gen() # yield fromåé¢æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡,æ­¤æ–‡åé¢çš„å°†å¤šç»´æ•°ç»„è½¬åŒ–ä¸ºä¸€ç»´æ•°ç»„ä¸­flattenå‡½æ•°å°±ç”¨åˆ°äº†yield fromï¼ŒåŸç†å°±æ˜¯å¦‚æœåˆ—è¡¨ä¸­ä¸€ä¸ªå…ƒç´ æ˜¯åˆ—è¡¨å°±yield fromè¿™ä¸ªåˆ—è¡¨ï¼Œå¦åˆ™å°±ç›´æ¥yieldè¿™ä¸ªå…ƒç´ ï¼Œä¹Ÿåˆ©ç”¨äº†é€’å½’çš„æ–¹æ³•ã€‚å¦‚æœå­ç”Ÿæˆå™¨é€€å‡ºwhileå¾ªç¯äº†ï¼Œå°±æ‰§è¡Œreturnä»¥è·å–è¿”å›å€¼ã€‚ print(total,count,average) def main(): t = proxy_gen() next(t) print(t.send(10)) print(t.send(15)) print(t.send(20)) t.send(None) main() ","date":"2021-10-10","objectID":"/skill/:3:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"åˆ—è¡¨è§£æå¼ lists = [f\"http://www.baidu.com/page{n}\" for n in range(21)] lists#æ­¤æ–¹æ³•åœ¨çˆ¬è™«æ„é€ urlsä¸­éå¸¸å¸¸ç”¨ # lists = [f\"http://www.baidu.com/page{n}\" for n in range(21) if n%2==0] pageå¶æ•° # alp = \"abcdefghigklmnopqrstuvwxyz\" # ALP = [n.upper() for n in alp] å°†å°å†™è½¬æ¢ä¸ºå¤§å†™ ","date":"2021-10-10","objectID":"/skill/:4:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"enumerate lists = ['apple','banana','cat','dog'] for index,name in enumerate(lists): print(index,name) # æ‰‹åŠ¨å®ç°ä¸€ä¸‹enumerate from typing import Iterable def enumerate_(Iterable:Iterable,start=0): yield from zip(range(start,start+len(Iterable)),Iterable) for i,item in enumerate_([1,2,3,4,5,6],9): print(i,item) ","date":"2021-10-10","objectID":"/skill/:5:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å­—å…¸çš„åˆå¹¶ dic1 = {'qq':1683070754, 'phone':123456789 } dic2 = { 'height':180, 'handsome':True } dic3 = {**dic1,**dic2} #åˆå¹¶ä¸¤ä¸ªå­—å…¸ **å«åšè§£åŒ… #æˆ–è€…ç”¨dic1.update(dic2) å°†dic2åˆå¹¶åˆ°dic1 ç›¸åŒé”®åˆ™dic2æ›¿ä»£dic1 dic3 {'handsome': True, 'height': 180, 'phone': 123456789, 'qq': 1683070754} ","date":"2021-10-10","objectID":"/skill/:6:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"åºåˆ—è§£åŒ… name = \"wang lingbo\" xing,ming = name.split(\" \") #splitè¿”å›ä¸€ä¸ªåºåˆ—ï¼Œåˆ†åˆ«èµ‹ç»™xing å’Œming print(xing,ming) #x,*y,z = [1,2,3,4,5] #x:1 z:5 y:[2,3,4] wang lingbo ","date":"2021-10-10","objectID":"/skill/:7:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"åŒ¿åå‡½æ•°lambda lists = [1,2,3,4,5,6] maps = map(lambda x:x*x,lists) print(maps) print(list(maps)) \u003cmap object at 0x000001911C8E03C8\u003e [1, 4, 9, 16, 25, 36] ","date":"2021-10-10","objectID":"/skill/:8:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"è£…é¥°å™¨ def logging(level): def wapper(func): def inner_wapper(*args, **wbargs): print(f'{level} enter in {func.__name__}()') return func(*args, **wbargs) #ä¸å†™return ä¹Ÿå¯ä»¥ return inner_wapper return wapper @logging('inner') def say(a): print('hello! {}'.format(a)) say('wlb') inner enter in say() hello! wlb import time def print_time(func): def wapper(*args,**wbargs): print(f'{func.__name__}()è°ƒç”¨äº{time.asctime(time.localtime(time.time()))}') return func(*args,**wbargs) #ä¸å†™return ä¹Ÿå¯ä»¥ return wapper @print_time def my_name(name): print(f'look!{name}') my_name(\"wlb\") my_name()è°ƒç”¨äºWed Dec 9 21:21:00 2020 look!wlb ","date":"2021-10-10","objectID":"/skill/:9:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"mapã€reduceã€filter # map print(list(map(abs,[-1,-2,-3,-4,-5]))) #ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰å‡½æ•°æˆ–è€…ç”¨åŒ¿åå‡½æ•° # reduce from functools import reduce #python3ä¸­éœ€è¦ä»å†…ç½®åº“å¯¼å…¥ print(reduce(lambda x,y:x+y,list(map(int,str(131351412))))) # filter a = [1,2,3,4,5,6,7,8,9] new_a = filter(lambda x:x%2!=0,a) #filterå°±æ˜¯ç­›é€‰ list(new_a) # è¿™ä¸‰ä¸ªéƒ½æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­å¸¸ç”¨çš„å‡½æ•° ","date":"2021-10-10","objectID":"/skill/:10:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"join() # lists = ['1','2','3','4','5'] # ''.join(lists) lists = [1,2,3,4,5] ''.join(list(map(str,lists))) #joinåªèƒ½æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ‰€ä»¥è¦mapè½¬æ¢ä¸€ä¸‹ '12345' ","date":"2021-10-10","objectID":"/skill/:11:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´ ab = [[1, 2, 3], [5, 8], [7, 8, 9]] print([i for item in ab for i in item]) #åˆ©ç”¨åˆ—è¡¨è§£æå¼ print(sum(ab, [])) # åˆ©ç”¨sumå‡½æ•° from functools import reduce print(reduce(lambda x,y:x+y,ab)) # åˆ©ç”¨reduce from itertools import chain print(list(chain(*ab))) # åˆ©ç”¨chain def flatten(items,ignore=(str,bytes)): for x in items: if isinstance(x,Iterable) and not isinstance(x,ignore): yield from flatten(x) else: yield x print(list(flatten(ab))) # åˆ©ç”¨è‡ªå·±å®šä¹‰çš„å‡½æ•° [1, 2, 3, 5, 8, 7, 8, 9] ","date":"2021-10-10","objectID":"/skill/:12:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å°†ä¸€ä¸ªåˆ—è¡¨å€’åº lists = [2,4,3,2,5,4] lists[::-1] # list(reversed(lists)) ","date":"2021-10-10","objectID":"/skill/:13:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"éšæœºç”Ÿæˆå¯†ç  import random b = 8 t = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890' print(''.join(random.sample(t,b))) # ä¸»è¦å°±æ˜¯ç”¨sampleè¿™ä¸ªæ–¹æ³•æ¥å–å¤šä¸ªéšæœºå€¼ 0KmtEZSU ","date":"2021-10-10","objectID":"/skill/:14:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"æ–­è¨€ assert(True is True) #æˆåŠŸ print('yes') assert(True is False) #æŠ¥é”™ print('no') yes ","date":"2021-10-10","objectID":"/skill/:15:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"åˆå¹¶åˆ—è¡¨ list1 = [1,2,31,13] list2 = [5,2,12,32] # list1.append(list2) # print(list1) #é”™è¯¯æ–¹æ³• list1.extend(list2) print(list1) #æ­£ç¡®æ–¹æ³• [1, 2, 31, 13, 5, 2, 12, 32] a = [1,2,3,4,5] b = ['a','b','c','d','e'] fin = dict() for k,i in zip(a,b): fin[k] = i print(fin) # {1: 'a', 2: 'b', 3: 'c', 4: 'd', 5: 'e'} # æˆ–è€… d = {} for i,d[i] in zip(a,b): pass print(d) # {1: 'a', 2: 'b', 3: 'c', 4: 'd', 5: 'e'} ä¸ºä»€ä¹ˆï¼Ÿåœ¨WTFpythonä¸­æœ‰è®² # æˆ–è€… fin = dict(zip(a,b)) print(fin) # {1: 'a', 2: 'b', 3: 'c', 4: 'd', 5: 'e'} ","date":"2021-10-10","objectID":"/skill/:16:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å¯¹listè¿›è¡Œè§£åŒ… lists = ['dog','cat','you'] print(*lists) #æƒ³å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œzipæ“ä½œæ—¶ï¼Œå¯ä»¥è¿™æ · print(list(zip(*lists))) def test(*args): print(\"args:\",args) test(*lists) dog cat you [('d', 'c', 'y'), ('o', 'a', 'o'), ('g', 't', 'u')] args:('dog','cat','you') ","date":"2021-10-10","objectID":"/skill/:17:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å¯¹ç±»çš„ä¸€äº›æ“ä½œ class Test: x = 1 y = 2 print(Test.x,Test.y) #==\u003eprint(Test().x,Test().y) class Test: def __init__(self,x,y): self.x = x self.y = y test = Test(1,2) print(test.x,test.y) 1 2 1 2 class Test: def __init__(self,maxlen): self.maxlen = maxlen self.lists = [] def put(self,*args): for i in args: if len(self.lists) \u003c= self.maxlen: self.lists.append(i) else: break def get(self): return self.lists.pop() def empty(self): if len(self.lists) != 0: return False else: return True def __len__(self): return len(self.lists) def __del__(self): print(\"del this class\") def printfs(self): return self.lists test = Test(10) test.put(1,2,3,4,5,6) print(test.empty()) print(len(test)) print(test.printfs()) test.__del__() #ç›´æ¥è°ƒç”¨testè¿˜å­˜åœ¨ï¼Œ__del__æ˜¯ææ„å‡½æ•°ï¼Œåƒåœ¾å›æ”¶æ—¶å°±ä¼šè°ƒç”¨a print(test) #del test #print(test) è¿™æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºdelå°†testè¿™ä¸ªå¯¹è±¡ç›´æ¥åˆ é™¤äº† False 6 [1, 2, 3, 4, 5, 6] del this class \u003c__main__.Test object at 0x0000021B7DF33EB0\u003e del this class ","date":"2021-10-10","objectID":"/skill/:18:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"ä¸€äº›å†…ç½®å‡½æ•° all([True,True,False]) #False all([True,True,True]) #True any([True,True,False]) #True any([True,False,False])#True any([False,False]) #False import random for i in iter(lambda:random.randint(1,10),5): print(i) #ç›¸å½“äº while True: x = random.randint(1,10) print(x) if x == 5: break iter(object[, sentinel]) sentinelä¸ºå¯é€‰å‚æ•°ï¼Œè‹¥ä¸ä¼ å…¥ï¼Œåˆ™objectå¿…é¡»ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œä¼ å…¥åˆ™å¿…é¡»ä¸ºå¯è°ƒç”¨å¯¹è±¡,å½“å¯è°ƒç”¨å¯¹è±¡çš„è¿”å›å€¼ä¸ºsentinelæŠ›å‡ºå¼‚å¸¸ï¼Œä½†forå¾ªç¯ä¼šå¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œè¿™å¸¸å¸¸ç”¨äºIOæ“ä½œ â€‹ #è¿™æ˜¯cookbooké‡Œé¢çš„ä¸€ä¸ªä¾‹å­ import sys f = open('xxx/xxx.txt') for chunk in iter(lambda:f.read(10),''): n = sys.stdout.write(chunk) #æ·±å…¥ç†è§£ä¸€ä¸‹ import random class Test: def __init__(self): self.lists = [1,23,2,4,1,421,412] def __call__(self): return random.choice(self.lists) for i in iter(Test(),1): print(i) #è¿™æ˜¯å¯ä»¥æ­£å¸¸è¾“å‡ºçš„ï¼Œå› ä¸ºå®ä¾‹åŒ–Teståæ˜¯ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œè¿”å›åˆ—è¡¨çš„éšæœºå€¼ï¼Œå½“è¿”å›1æ—¶åˆ™å¾ªç¯ç»“æŸï¼Œå¦‚æœæŠŠ__call__é­”æ³•æ–¹æ³•å»äº†åï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¦‚æœæƒ³è¦ä¸ä½¿ç”¨é­”æ³•æ–¹æ³•çš„è¯å¯ä»¥ç”¨åŒ¿åå‡½æ•° import random class Test: def __init__(self): self.lists = [1,23,2,4,1,421,412] # def __call__(self): # return random.choice(self.lists) for i in iter(lambda:random.choice(Test().lists),1): print(i) #æ€»ä¹‹ï¼Œå¹çˆ†cookbook ","date":"2021-10-10","objectID":"/skill/:19:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"functools.partial #å…ˆçœ‹æ¼”ç¤º from functools import partial def add(a,b): return a + b addOne = partial(add,1) addOne(2) #3 addOne(4) #5 #å¤§æ¦‚æ„æ€å°±æ˜¯åˆ©ç”¨partialå°†å‡½æ•°çš„ä¸€ä¸ªå‚æ•°å›ºå®šä½äº† def partial(func,*wargs): def wapper(*kargs): args = list(wargs) print(f\"args:{args}\") print(f\"kargs:{kargs}\") args.extend(kargs) print(f\"last:{args}\") return func(*args) return wapper def add(a,b,c): return a + b + c addone = partial(add,1,2) #æ­¤æ—¶addoneç›¸å½“äºwapper print(addone(3)) #è°ƒç”¨wrapper 3ä¸ºä¼ å…¥çš„kargs #è¾“å‡ºï¼š args:[1, 2] kargs:(3,) last:[1, 2, 3] 6 #ä¸Šé¢æ˜¯partialå‡½æ•°çš„ç®€åŒ–ç‰ˆæœ¬ #å¾ˆæ˜æ˜¾çš„é—­åŒ…æ“ä½œï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥ç†è§£ #å½“ç„¶ä¹Ÿå¯ä»¥è½¬æ¢ä¸ºè£…é¥°å™¨æ“ä½œ from functools import wraps from functools import wraps,partial def out_wapper(*wargs): def partialout(func): return partial(func,*wargs) # è¿™æ˜¯ä½¿ç”¨partialåŸç†çš„ # @wraps(func) # def wrapper(*kargs): # args = list(wargs) # print(f\"args:{args}\") # print(f\"kargs:{kargs}\") # args.extend(kargs) # print(f\"last:{args}\") # return func(*args) # return wrapper return partialout @out_wapper(1,2) def add(a,b,c): return a + b + c print(add(3)) #6 #æ˜æ˜¾è£…é¥°å™¨è¦éº»çƒ¦ä¸€ç‚¹å®ç°ï¼Œä¸è¿‡æ¯•ç«Ÿæ˜¯å°è£…å¥½çš„å‡½æ•°ï¼Œä»¥åç›´æ¥ç”¨å°±å¯ä»¥ï¼Œä¸è¿‡äº†è§£è¿™äº›æœ‰åŠ©äºæé«˜æ€ç»´æ°´å¹³ ","date":"2021-10-10","objectID":"/skill/:20:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"@classmethodå’Œ@staticmethod class A(object): bar = 1 def func1(self): print ('foo') @classmethod def func2(cls): print ('func2') print (cls.bar) cls().func1() # è°ƒç”¨ foo æ–¹æ³• A.func2() # ä¸éœ€è¦å®ä¾‹åŒ– func2 1 foo class A(object): # å±æ€§é»˜è®¤ä¸ºç±»å±æ€§ï¼ˆå¯ä»¥ç»™ç›´æ¥è¢«ç±»æœ¬èº«è°ƒç”¨ï¼‰ num = \"ç±»å±æ€§\" # å®ä¾‹åŒ–æ–¹æ³•ï¼ˆå¿…é¡»å®ä¾‹åŒ–ç±»ä¹‹åæ‰èƒ½è¢«è°ƒç”¨ï¼‰ def func1(self): # self : è¡¨ç¤ºå®ä¾‹åŒ–ç±»åçš„åœ°å€id print(\"func1\") print(self) # ç±»æ–¹æ³•ï¼ˆä¸éœ€è¦å®ä¾‹åŒ–ç±»å°±å¯ä»¥è¢«ç±»æœ¬èº«è°ƒç”¨ï¼‰ @classmethod def func2(cls): # cls : è¡¨ç¤ºæ²¡ç”¨è¢«å®ä¾‹åŒ–çš„ç±»æœ¬èº« print(\"func2\") print(cls) print(cls.num) cls().func1() # ä¸ä¼ é€’ä¼ é€’é»˜è®¤selfå‚æ•°çš„æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥è¢«ç±»è°ƒç”¨çš„ï¼Œä½†æ˜¯è¿™æ ·åšä¸æ ‡å‡†ï¼‰ def func3(): print(\"func3\") print(A.num) # å±æ€§æ˜¯å¯ä»¥ç›´æ¥ç”¨ç±»æœ¬èº«è°ƒç”¨çš„ # A.func1() è¿™æ ·è°ƒç”¨æ˜¯ä¼šæŠ¥é”™ï¼šå› ä¸ºfunc1()è°ƒç”¨æ—¶éœ€è¦é»˜è®¤ä¼ é€’å®ä¾‹åŒ–ç±»åçš„åœ°å€idå‚æ•°ï¼Œå¦‚æœä¸å®ä¾‹åŒ–ç±»æ˜¯æ— æ³•è°ƒç”¨çš„ A.func2() A.func3() class A(object): def foo(self, x): print(\"executing foo(%s,%s)\" % (self, x)) print('self:', self) @staticmethod def static_foo(x): print(\"executing static_foo(%s)\" % x) é—®é¢˜ï¼š@staticmethodä¿®é¥°çš„æ–¹æ³•å‡½æ•°ä¸æ™®é€šçš„ç±»å¤–å‡½æ•°ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ™®é€šå‡½æ•°ï¼Ÿ @staticmethodæ˜¯æŠŠå‡½æ•°åµŒå…¥åˆ°ç±»ä¸­çš„ä¸€ç§æ–¹å¼ï¼Œå‡½æ•°å°±å±äºç±»ï¼ŒåŒæ—¶è¡¨æ˜å‡½æ•°ä¸éœ€è¦è®¿é—®è¿™ä¸ªç±»ã€‚é€šè¿‡å­ç±»çš„ç»§æ‰¿è¦†ç›–ï¼Œèƒ½æ›´å¥½çš„ç»„ç»‡ä»£ç ã€‚ from pydantic import BaseModel from typing import Sequence class Test(BaseModel): text: Sequence[str] @classmethod def create(cls,text: Sequence[str]) -\u003e \"Test\": # classmethodå¸¸ç”¨æ„é€ å‡½æ•° return cls(text=text) def to_tuple(self) -\u003e \"Test\": return Test(text=tuple(self.text)) @classmethod def join(cls, *Tests): return cls.create(sum([i.text for i in Tests],[])) test = Test.create(list(\"Hello world\")) t2 = Test.create(list(\"NIHAO\")) print(Test.join(test, t2)) # text=['H', 'e', 'l', 'l', 'o', ' ', 'w', 'o', 'r', 'l', 'd', 'N', 'I', 'H', 'A', 'O'] ","date":"2021-10-10","objectID":"/skill/:21:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"ç”¨ç±»å®ç°è£…é¥°å™¨ #å…ˆçœ‹è¿™æ ·çš„ä»£ç  ç±»å®ç°è£…é¥°å™¨è¦æ±‚ç±»å¿…é¡»æ˜¯å¯è°ƒç”¨çš„ import time import functools class DelayFunc: def __init__(self, duration, func): self.duration = duration self.func = func def __call__(self, *args, **kwargs): print(f'Wait for {self.duration} seconds...') time.sleep(self.duration) return self.func(*args, **kwargs) def eager_call(self, *args, **kwargs): print('Call without delay') return self.func(*args, **kwargs) def delay(duration): \"\"\"è£…é¥°å™¨ï¼šæ¨è¿ŸæŸä¸ªå‡½æ•°çš„æ‰§è¡Œã€‚åŒæ—¶æä¾› .eager_call æ–¹æ³•ç«‹å³æ‰§è¡Œ \"\"\" # æ­¤å¤„ä¸ºäº†é¿å…å®šä¹‰é¢å¤–å‡½æ•°ï¼Œç›´æ¥ä½¿ç”¨ functools.partial å¸®åŠ©æ„é€  # DelayFunc å®ä¾‹ return functools.partial(DelayFunc, duration) @delay(2) def add(a,b): print(a,b) add(1,2) #å»¶è¿Ÿä¸¤ç§’è¾“å‡º3 ç›¸å½“äºdelay(2)(add)(1,2) add.eager_call(1,2) #ä¸å»¶è¿Ÿè¾“å‡º3 ç›¸å½“äºdelay(2)(add).eager_call(1,2) #é¢ï¼Œå½“ç„¶ï¼Œæƒ³æ›´æ·±å…¥ç†è§£çš„è¯ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ def delay(duration): def partial(func): return DelayFunc(duration,func) return partial # ä¸Šé¢çš„å°±ç›¸å½“äº partial(DelayFunc,duration),ç¼ºçš„funcå‚æ•°å°±æ˜¯è¦ä¿®é¥°çš„å‡½æ•° @delay(2) def add(a,b): return a + b print(add(1,2)) ä¸çº¯å‡½æ•°ç›¸æ¯”ï¼Œæˆ‘è§‰å¾—ä½¿ç”¨ç±»å®ç°çš„è£…é¥°å™¨åœ¨ç‰¹å®šåœºæ™¯ä¸‹æœ‰å‡ ä¸ªä¼˜åŠ¿ï¼š å®ç°æœ‰çŠ¶æ€çš„è£…é¥°å™¨æ—¶ï¼Œæ“ä½œç±»å±æ€§æ¯”æ“ä½œé—­åŒ…å†…å˜é‡æ›´ç¬¦åˆç›´è§‰ã€ä¸æ˜“å‡ºé”™ å®ç°ä¸ºå‡½æ•°æ‰©å……æ¥å£çš„è£…é¥°å™¨æ—¶ï¼Œä½¿ç”¨ç±»åŒ…è£…å‡½æ•°ï¼Œæ¯”ç›´æ¥ä¸ºå‡½æ•°å¯¹è±¡è¿½åŠ å±æ€§æ›´æ˜“äºç»´æŠ¤ æ›´å®¹æ˜“å®ç°ä¸€ä¸ªåŒæ—¶å…¼å®¹è£…é¥°å™¨ä¸ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®çš„å¯¹è±¡ ","date":"2021-10-10","objectID":"/skill/:22:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"BaseModel from pydantic import BaseModel,AnyUrl class Test(BaseModel): # ç»§æ‰¿åå¯ä»¥ç”¨ç±»å±æ€§åˆ›å»ºå®ä¾‹ url: AnyUrl data: str def __str__(self): return self.url + self.data kwargs = { 'url': 'https://www.baidu.com', 'data': '/search' } print(Test(**kwargs)) ","date":"2021-10-10","objectID":"/skill/:23:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"pythonç±»å‹æ³¨é‡Š from pydantic import BaseModel from typing import Any class cout(): def __init__(self, cls: \"Test\", text: str) -\u003e None: self.cls = cls self.text = text def __str__(self): return f\"{self.cls} {self.text}\" #ç¨‹åºåˆ°coutæ—¶ Testç±»å¹¶æ²¡æœ‰å®šä¹‰ï¼Œä½†æœ€åTeståœ¨å˜é‡ç©ºé—´ä¸­ï¼Œæ‰€ä»¥åŠ ä¸Šå¼•å· class Test(BaseModel): def __str__(self) -\u003e str: return \"I am Test Class\" print(cout(cls=Test(), text=\"hello world!\")) ","date":"2021-10-10","objectID":"/skill/:24:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"namedtuple from collections import namedtuple Test = namedtuple(\"Test\", ['name', 'age', 'sex']) def test_for_test(name: str, year: int, sex: str) -\u003e \"Test\": return Test( name=name.title(), age=2021 - year, sex=sex ) name,age,sex = test_for_test('wlb', 2002, 'male') print(name, age, sex) ","date":"2021-10-10","objectID":"/skill/:25:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"@property from pydantic import BaseModel class Test(): def __init__(self, cls, n): self.cls = cls self.n = n @property def to_string_cls(self): return self.cls @property def to_strings(self): return self.n class Test_For(BaseModel): num: int def __str__(self): return str(self.num) __repr__ = __str__ test = Test(Test_For, 22) print(test.to_string_cls(num=1)) # 1 print(test.to_strings) # 22 ","date":"2021-10-10","objectID":"/skill/:26:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"åœ¨è¾¹ç•Œå¤„æ€è€ƒ from typing import Iterable from pydantic import BaseModel,conint,ValidationError class NumberInput(BaseModel): num: conint(ge=0, le=100) def input_a_number(): while True: n = input(\"è¾“å…¥ä¸€ä¸ªæ•°\") try: n = NumberInput(num=n) except ValidationError as e: print(e) continue n = n.num break return n print(input_a_number()) #è¦æ±‚è¾“å…¥ä¸€ä¸ª0-100çš„æ•° è¿™æ ·æ˜¯ä¸æ˜¯å¾ˆä¼˜é›… ","date":"2021-10-10","objectID":"/skill/:27:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"super()è¿›é˜¶ ä»Šå¤©å­¦ä¹ cookbook8-8å­ç±»ä¸­æ‰©å±•property å…ˆè´´ä¸€ä¸‹ä»£ç  class Person: def __init__(self, name): self.name = name # æœ‰æ„æ€çš„æ˜¯ è¿™é‡Œçš„self.nameæ˜¯@propertyä¿®é¥°çš„ è¿™è¡Œä»£ç è°ƒç”¨name.setter # Getter function @property def name(self): return self._name # Setter function @name.setter def name(self, value): if not isinstance(value, str): raise TypeError('Expected a string') self._name = value # Deleter function @name.deleter def name(self): raise AttributeError(\"Can't delete attribute\") # å­ç±» class SubPerson(Person): @property def name(self): print('Getting name') return super().name @name.setter def name(self, value): print('Setting name to', value) super(SubPerson, SubPerson).name.__set__(self, value) @name.deleter def name(self): print('Deleting name') super(SubPerson, SubPerson).name.__delete__(self) çœ‹åˆ°super(SubPerson, SubPerson)æ„Ÿåˆ°å¾ˆç–‘æƒ‘ï¼Œäºæ˜¯æœç´¢èµ„æ–™å¤§è‡´ææ˜ç™½äº† é€šä¿—è¯´é»˜è®¤çš„super(SubPerson,self) (ç›´æ¥å†™super()ä¹Ÿå¯) è¿”å›çš„æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ \u003e ä¸ºäº†å§”æ‰˜ç»™ä¹‹å‰å®šä¹‰çš„setteræ–¹æ³•ï¼Œéœ€è¦å°†æ§åˆ¶æƒä¼ é€’ç»™ä¹‹å‰å®šä¹‰çš„nameå±æ€§çš„ __set__() æ–¹æ³•ã€‚ ä¸è¿‡ï¼Œè·å–è¿™ä¸ªæ–¹æ³•çš„å”¯ä¸€é€”å¾„æ˜¯ä½¿ç”¨ç±»å˜é‡è€Œä¸æ˜¯å®ä¾‹å˜é‡æ¥è®¿é—®å®ƒã€‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨ super(SubPerson, SubPerson) çš„åŸå› ã€‚ ä»ä¹¦ä¸­è¿™å¥è¯å¯ä»¥çœ‹å‡º super(cls,cls)è¿”å›çš„æ˜¯ä¸€ä¸ªç±» ä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œsuper()çš„å‚æ•°çš„ä½œç”¨å°±æ˜¯ç”¨äºå®šä½ä½ç½® ç¬¬ä¸€ä¸ªclså¿…é¡»æ˜¯ç¬¬äºŒclsçš„çˆ¶ç±»æˆ–è€…äºŒè€…ç›¸åŒï¼Œå¯ä»¥é€šè¿‡cls.__mro__æŸ¥çœ‹ç»§æ‰¿é¡ºåº æ¯”å¦‚åœ¨Dé‡Œé¢super(A,D).__init__(self) è€Œ__mro__ ä¸º (\u003cclass '__main__.D'\u003e, \u003cclass '__main__.A'\u003e, \u003cclass '__main__.B'\u003e, \u003cclass '__main__.C'\u003e, \u003cclass '__main__.Base'\u003e, \u003cclass 'object'\u003e) é‚£ä¹ˆå°±è°ƒç”¨ä»Aä»¥åçš„ç±»çš„__init__() ä¸è¿‡é‡ç‚¹ä¸åœ¨è¿™é‡Œï¼Œé‡ç‚¹æ˜¯super(cls,cls)å’Œsuper(cls,object)çš„åŒºåˆ« ä½¿ç”¨super(cls,cls)å¿…é¡»æ˜¾ç¤ºçš„ä¼ å…¥selfå‚æ•°ï¼Œå³super(cls,cls).func(self,â€¦)ã€‚æ€»ä¹‹å…¶å°±æ˜¯ä¸€ä¸ªå®šä½æ–¹æ³•ï¼Œåˆ«çš„ä½œç”¨æˆ‘æš‚ä¸”ä¸çŸ¥ã€‚ ### ä¸€ä¸ªç¤ºä¾‹ class A: def say(self): print(\"I am A\") class B(A): def say(self): # super(B, B).say(self) super().say() class C(A): def say(self): print(\"I am C\") class D(B, C): def say(self): super().say() D().say() ä¸Šè¿°çš„è¿™æ®µä»£ç æ€ä¹ˆä¿®æ”¹Dè¾“å‡ºéƒ½æ˜¯I am Cï¼Œè¿™æ˜¯å› ä¸ºåœ¨Bä¸­super().say()ç›¸å½“äºsuper(B,self).say()ï¼Œè€Œæ ¹æ®ä¸Šè¿°å†…å®¹è¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå…¶ä¸­selfæ˜¯Dçš„å®ä¾‹ï¼ŒæŸ¥çœ‹Dçš„mroå¯ä»¥çŸ¥é“Cåœ¨Bçš„åé¢ï¼Œæ‰€ä»¥æ ¹æ®superçš„ä½œç”¨ï¼Œåˆ™ä¼šè°ƒç”¨ç»§æ‰¿å…³ç³»ä¸­Båé¢ç±»çš„sayæ–¹æ³•ï¼Œå³Cçš„say æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šå¾—åˆ°åŒªå¤·æ‰€æ€çš„ç»“æœï¼Œå°†ä»£ç ä¿®æ”¹æˆæ³¨é‡Šçš„é‚£æ ·å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ç†è§£ã€‚ ## dataclass from dataclasses import dataclass import random @dataclass(order=True) # ç­‰äºå®ç°äº†å„ç§æ¯”è¾ƒæ–¹æ³•ä¾‹å¦‚=ã€\u003eã€\u003c,æ’åºå‡½æ•°éƒ½ä¾èµ–æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ class A: n: int nums = [A(random.randint(1,10)) for _ in range(10)] nums = sorted(nums) print(nums, end='') x = '''hello''' print(x) dataclasså¯ä»¥è‡ªåŠ¨æ·»åŠ __rapr__æ–¹æ³•ï¼Œä¸å¿…è‡ªå·±å®ç° @dataclass(init=True, repr=True, eq=True, order=False, unsafe_hash=False, frozen=False) initï¼šé»˜è®¤å°†ç”Ÿæˆ __init__ æ–¹æ³•ã€‚å¦‚æœä¼ å…¥ Falseï¼Œé‚£ä¹ˆè¯¥ç±»å°†ä¸ä¼šæœ‰ __init__ æ–¹æ³•ã€‚ reprï¼š__repr__ æ–¹æ³•é»˜è®¤ç”Ÿæˆã€‚å¦‚æœä¼ å…¥ Falseï¼Œé‚£ä¹ˆè¯¥ç±»å°†ä¸ä¼šæœ‰ __repr__ æ–¹æ³•ã€‚ eqï¼šé»˜è®¤å°†ç”Ÿæˆ __eq__ æ–¹æ³•ã€‚å¦‚æœä¼ å…¥ Falseï¼Œé‚£ä¹ˆ __eq__ æ–¹æ³•å°†ä¸ä¼šè¢« dataclass æ·»åŠ ï¼Œä½†é»˜è®¤ä¸º object.__eq__ã€‚ orderï¼šé»˜è®¤å°†ç”Ÿæˆ __gt__ã€__ge__ã€__lt__ã€__le__ æ–¹æ³•ã€‚å¦‚æœä¼ å…¥ Falseï¼Œåˆ™çœç•¥å®ƒä»¬ã€‚ unsafe_hashï¼šé»˜è®¤ç”Ÿæˆ__hash__æ–¹æ³•ï¼Œç”¨äºæ„å»ºå¯hashableçš„ç±» from dataclasses import dataclass @dataclass(unsafe_hash=True) class VisitRecordDC: first_name: str last_name: str phone_number: str # è·³è¿‡â€œè®¿é—®æ—¶é—´â€å­—æ®µï¼Œä¸ä½œä¸ºä»»ä½•å¯¹æ¯”æ¡ä»¶ date_visited: str = field(hash=False, compare=False) def find_potential_customers_v4(): return set(VisitRecordDC(**r) for r in users_visited_phuket) - \\ #æ±‚å·®é›† set(VisitRecordDC(**r) for r in users_visited_nz) ","date":"2021-10-10","objectID":"/skill/:28:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"è‡ªå®šä¹‰format class Student: def __init__(self, name, age): self.name = name self.age = age def __format__(self, format_spec): if format_spec == 'long': return f'{self.name} is {self.age} years old.' elif format_spec == 'simple': return f'{self.name}({self.age})' raise ValueError('invalid format spec') vllbc = Student('vllbc', '18') print(f'{vllbc:simple}') print(f'{vllbc:long}') ","date":"2021-10-10","objectID":"/skill/:29:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"æŠ½è±¡ç±»å®è·µ import collections from abc import ABC, abstractmethod from typing import List customer = collections.namedtuple('customer', ['name', 'points']) class Goods(): def __init__(self, name: str, quantity: float, price: float) -\u003e None: self.name = name self.quantity = quantity self.price = price def total(self) -\u003e float: return self.quantity * self.price class Order(): def __init__(self, customer: customer, cart: List[Goods], prom=None) -\u003e None: self.customer = customer self.cart = cart self.prom = prom def total(self): if not hasattr(self, '__total'): self.__total = sum(i.total() for i in self.cart) return self.__total def due(self): if self.prom is None: discount = 0 else: discount = self.prom.discount(self) return self.total() - discount def __repr__(self) -\u003e str: return f'\u003cOrder total: {self.total():.2f} due: {self.due():.2f}\u003e' class Prom(ABC): # æŠ½è±¡ç±» @abstractmethod def discount(self,order) -\u003e float: '''discount''' class discount1(Prom): def discount(self,order) -\u003e float: return order.total() * 0.05 if order.customer.points \u003e= 10000 else 0 john = customer(name='vllbc', points=100000) carts = [Goods(name='apple', quantity=5, price=10), Goods( name='banana', quantity=8, price=5), Goods(name='peach', quantity=4, price=8)] order = Order(customer=john, cart=carts,prom=discount1()) ","date":"2021-10-10","objectID":"/skill/:30:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"accumulate import itertools test_list = [i for i in range(1, 11)] for i in itertools.accumulate(test_list): print(i, end=\",\") # 1,3,6,10,15,21,28,36,45,55, print() for i in itertools.accumulate(test_list, lambda x, y: x * y): print(i, end=',') # 1,2,6,24,120,720,5040,40320,362880,3628800, ","date":"2021-10-10","objectID":"/skill/:31:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å¼‚æ­¥è£…é¥°å™¨ from functools import wraps import asyncio def decorator(func): @wraps(func) async def hello(*args, **kwargs): await asyncio.sleep(2) return await func(*args,**kwargs) return hello @decorator async def test(): print(\"hello\") asyncio.run(test()) ","date":"2021-10-10","objectID":"/skill/:32:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"bisect import bisect import time # BREAKPOINTS å¿…é¡»æ˜¯å·²ç»æ’å¥½åºçš„ï¼Œä¸ç„¶æ— æ³•è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ BREAKPOINTS = (1, 60, 3600, 3600 * 24) TMPLS = ( # unit, template (1, \"less than 1 second ago\"), (1, \"{units} seconds ago\"), (60, \"{units} minutes ago\"), (3600, \"{units} hours ago\"), (3600 * 24, \"{units} days ago\"), ) def from_now(ts): \"\"\"æ¥æ”¶ä¸€ä¸ªè¿‡å»çš„æ—¶é—´æˆ³ï¼Œè¿”å›è·ç¦»å½“å‰æ—¶é—´çš„ç›¸å¯¹æ—¶é—´æ–‡å­—æè¿° \"\"\" seconds_delta = int(time.time() - ts) unit, tmpl = TMPLS[bisect.bisect(BREAKPOINTS, seconds_delta)] # bisectç±»ä¼¼äºindexæ–¹æ³•ï¼Œè¦æ˜¯ä¸å­˜åœ¨ä¼šé€‰æ‹©æ•°å€¼æœ€æ¥è¿‘çš„ç´¢å¼• return tmpl.format(units=seconds_delta // unit) ","date":"2021-10-10","objectID":"/skill/:33:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"contextlib from contextlib import contextmanager,ContextDecorator # contextmanagerå¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œä¸éœ€è¦è‡ªå·±å»å®ç°ä¸€ä¸ªå®šä¹‰äº†__enter__å’Œ__exit__æ–¹æ³•çš„ç±» @contextmanager def open_file(filename, methods=\"r\"): print(f\"æ‰“å¼€äº†æ–‡ä»¶{filename}\") res_file = open(filename, mode=methods) # __enter__æ–¹æ³• è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯è‡ªå·±å®šä¹‰çš„ç±» try: yield res_file # ç›¸å½“äºåœ¨__enter__æ–¹æ³•é‡Œé¢è¿”å›self yieldåé¢ä¸ºç©ºçš„è¯å°±ä¸ç”¨asäº† except Exception as e: print(\"æœ‰é”™è¯¯å‘ç”Ÿ\", e) # __exit__æ–¹æ³•é‡Œçš„é”™è¯¯å¤„ç† finally: res_file.close() # __exit__ with open_file(\"testvim.txt\") as fp: print(fp) ","date":"2021-10-10","objectID":"/skill/:34:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"è¯»å–å¤§æ–‡ä»¶ from functools import partial def digits_(file,block_size=1024*8): # åˆ†å—è¯»å– _read = partial(file.read, block_size) # ä½¿ç”¨partial,ä¹Ÿå¯ä»¥ä½¿ç”¨lambda:file.read(block_size) for line in iter(_read, \"\"): # å½“è¯»å–å®Œæ¯•æ—¶é€€å‡º for s in line: if s.isdigit(): yield s # ä½¿ç”¨yield def count_digits(fname): \"\"\"è®¡ç®—æ–‡ä»¶é‡ŒåŒ…å«å¤šå°‘ä¸ªæ•°å­—å­—ç¬¦\"\"\" count = 0 with open(fname) as file: for _ in digits_(file=file): count+=1 return count ","date":"2021-10-10","objectID":"/skill/:35:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"__exit__ã€__enter__ # def __enter__(self): # è¯¥æ–¹æ³•å°†åœ¨è¿›å…¥ä¸Šä¸‹æ–‡æ—¶è°ƒç”¨ # return self # def __exit__(self, exc_type, exc_val, exc_tb): # è¯¥æ–¹æ³•å°†åœ¨é€€å‡ºä¸Šä¸‹æ–‡æ—¶è°ƒç”¨ # exc_type, exc_val, exc_tb åˆ†åˆ«è¡¨ç¤ºè¯¥ä¸Šä¸‹æ–‡å†…æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€å¼‚å¸¸å€¼ã€é”™è¯¯æ ˆ # __enter__()ï¼šä¸»è¦æ‰§è¡Œä¸€äº›ç¯å¢ƒå‡†å¤‡å·¥ä½œï¼ŒåŒæ—¶è¿”å›ä¸€èµ„æºå¯¹è±¡ã€‚å¦‚æœä¸Šä¸‹æ–‡ç®¡ç†å™¨open(\"test.txt\")çš„__enter__()å‡½æ•°è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚ # __exit__()ï¼šå®Œæ•´å½¢å¼ä¸º__exit__(type, value, traceback),è¿™ä¸‰ä¸ªå‚æ•°å’Œè°ƒç”¨sys.exec_info()å‡½æ•°è¿”å›å€¼æ˜¯ä¸€æ ·çš„ï¼Œåˆ†åˆ«ä¸ºå¼‚å¸¸ç±»å‹ã€å¼‚å¸¸ä¿¡æ¯å’Œå †æ ˆã€‚å¦‚æœ*æ‰§è¡Œä½“è¯­å¥*æ²¡æœ‰å¼•å‘å¼‚å¸¸ï¼Œåˆ™è¿™ä¸‰ä¸ªå‚æ•°å‡è¢«è®¾ä¸ºNoneã€‚å¦åˆ™ï¼Œå®ƒä»¬å°†åŒ…å«ä¸Šä¸‹æ–‡çš„å¼‚å¸¸ä¿¡æ¯ã€‚__exit__()æ–¹æ³•è¿”å›Trueæˆ–False,åˆ†åˆ«æŒ‡ç¤ºè¢«å¼•å‘çš„å¼‚å¸¸æœ‰æ²¡æœ‰è¢«å¤„ç†ï¼Œå¦‚æœè¿”å›Falseï¼Œå¼•å‘çš„å¼‚å¸¸å°†ä¼šè¢«ä¼ é€’å‡ºä¸Šä¸‹æ–‡ã€‚å¦‚æœ__exit__()å‡½æ•°å†…éƒ¨å¼•å‘äº†å¼‚å¸¸ï¼Œåˆ™ä¼šè¦†ç›–æ‰æ‰§è¡Œä½“çš„ä¸­å¼•å‘çš„å¼‚å¸¸ã€‚å¤„ç†å¼‚å¸¸æ—¶ï¼Œä¸éœ€è¦é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œåªéœ€è¦è¿”å›Falseï¼Œwithè¯­å¥ä¼šæ£€æµ‹__exit__()è¿”å›Falseæ¥å¤„ç†å¼‚å¸¸ã€‚ ","date":"2021-10-10","objectID":"/skill/:36:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"enum from enum import IntEnum class Test(IntEnum): X = 2 Y = 1 print(2 == Test.X) ","date":"2021-10-10","objectID":"/skill/:37:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"pydanticæ•°æ®éªŒè¯ from pydantic import BaseModel, conint, ValidationError # pydanticä¸»è¦åŠŸèƒ½å°±æ˜¯ä½œæ•°æ®éªŒè¯ from typing import ( List, Union, Optional, Dict ) class Test(BaseModel): name: Optional[str] sex: Union[str, List[str]] d: Dict[str, int] id: conint(ge=1,le=10) try: test = Test(name='wlb', sex='male', d={'dict':1}, id=1) print(test.dict(), test.__annotations__) # {'name': 'wlb', 'sex': 'male', 'd': {'dict': 1}, 'id': 1} {'name': typing.Union[str, NoneType], 'sex': typing.Union[str, typing.List[str]], 'd': typing.Dict[str, int], 'id': \u003cclass '__main__.ConstrainedIntValue'\u003e} except ValidationError: print(\"æ•°æ®é”™è¯¯\") ","date":"2021-10-10","objectID":"/skill/:38:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"islice from itertools import islice def test(): t = 0 while True: yield t t += 1 for i in islice(test(), 10, 21, 2): print(i) ","date":"2021-10-10","objectID":"/skill/:39:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"__iter__ã€__next__ class Range7: # å¯è¿­ä»£ç±»å‹ åªéœ€è¦å®ç°__iter__å³å¯ def __init__(self,start,end) -\u003e None: self.start = start self.end = end def __iter__(self): return Range7iterator(self) class Range7iterator: #è¿™æ˜¯è¿­ä»£å™¨,ä¸€èˆ¬çš„è¿­ä»£å™¨åªèƒ½è°ƒç”¨ä¸€æ¬¡ def __init__(self,rangeobj) -\u003e None: self.rangeobj = rangeobj self.cur = rangeobj.start def __iter__(self): return self def __next__(self): while True: if self.cur \u003e self.rangeobj.end: raise StopIteration if self.is_7(self.cur): res = self.cur self.cur += 1 return res self.cur += 1 def is_7(self,num): if num == 0: return False return num%7==0 or \"7\" in str(num) for i in Range7(1,100): print(i,end=\" \") #å¯è¿­ä»£å¯¹è±¡ä¸ä¸€å®šæ˜¯è¿­ä»£å™¨ï¼Œä½†è¿­ä»£å™¨ä¸€å®šæ˜¯å¯è¿­ä»£å¯¹è±¡ # å¯¹å¯è¿­ä»£å¯¹è±¡ä½¿ç”¨ iter() ä¼šè¿”å›è¿­ä»£å™¨ï¼Œè¿­ä»£å™¨åˆ™ä¼šè¿”å›å®ƒè‡ªèº« # æ¯ä¸ªè¿­ä»£å™¨çš„è¢«è¿­ä»£è¿‡ç¨‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¯è¿­ä»£å¯¹è±¡åˆ™ä¸ä¸€å®š # å¯è¿­ä»£å¯¹è±¡åªéœ€è¦å®ç° __iter__ æ–¹æ³•ï¼Œè€Œè¿­ä»£å™¨è¦é¢å¤–å®ç° __next__ æ–¹æ³• ","date":"2021-10-10","objectID":"/skill/:40:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"æ±‚å­—å…¸çš„æœ€å¤§å€¼ prices = { 'ACME': 45.23, 'AAPL': 612.78, 'IBM': 205.55, 'HPQ': 37.20, 'FB': 10.75 } print(max(zip(prices.values(),prices.keys()))) print(max(prices.items(),key=lambda x:x[1])) print(max(prices,key=lambda k:prices[k])) ","date":"2021-10-10","objectID":"/skill/:41:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"æ³¨æ„å¾ªç¯å˜é‡ funcs = [] res = [] for x in range(7): def func(x=x): # å»æ‰x=xåˆ™å‡ºç°[6,6,6,6,6,6] åœ¨å¾ªç¯å†…éƒ¨å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶, å¦‚æœè¯¥å‡½æ•°åœ¨å…¶ä¸»ä½“ä¸­ä½¿ç”¨äº†å¾ªç¯å˜é‡, åˆ™é—­åŒ…å‡½æ•°å°†ä¸å¾ªç¯å˜é‡ç»‘å®š, è€Œä¸æ˜¯å®ƒçš„å€¼. å› æ­¤, æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯ä½¿ç”¨æœ€ååˆ†é…ç»™å˜é‡çš„å€¼æ¥è¿›è¡Œè®¡ç®—çš„. return x funcs.append(func) res.append(func()) func_res = [f() for f in funcs] print(func_res) def create_mult(): res = [] for i in range(5): def func(x, i=i): # å»æ‰i=iåˆ™å…¨è¾“å‡º8ï¼ŒåŸå› å’Œä¸Šé¢ä¸€æ · return x * i res.append(func) return res for cr in create_mult(): print(cr(2)) ","date":"2021-10-10","objectID":"/skill/:42:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"ç©ºå¯¹è±¡æ¨¡å¼ ä¿®æ”¹å‰ import decimal class CreateAccountError(Exception): \"\"\"Unable to create a account error\"\"\" class Account: \"\"\"ä¸€ä¸ªè™šæ‹Ÿçš„é“¶è¡Œè´¦å·\"\"\" def __init__(self, username, balance): self.username = username self.balance = balance @classmethod def from_string(cls, s): \"\"\"ä»å­—ç¬¦ä¸²åˆå§‹åŒ–ä¸€ä¸ªè´¦å·\"\"\" try: username, balance = s.split() balance = decimal.Decimal(float(balance)) except ValueError: raise CreateAccountError('input must follow pattern \"{ACCOUNT_NAME} {BALANCE}\"') if balance \u003c 0: raise CreateAccountError('balance can not be negative') return cls(username=username, balance=balance) def caculate_total_balance(accounts_data): \"\"\"è®¡ç®—æ‰€æœ‰è´¦å·çš„æ€»ä½™é¢ \"\"\" result = 0 for account_string in accounts_data: try: user = Account.from_string(account_string) except CreateAccountError: pass else: result += user.balance return result accounts_data = [ 'piglei 96.5', 'cotton 21', 'invalid_data', 'roland $invalid_balance', 'alfred -3', ] print(caculate_total_balance(accounts_data)) ","date":"2021-10-10","objectID":"/skill/:43:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"ç©ºå¯¹è±¡æ¨¡å¼ç®€ä»‹ é¢å¤–å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥è¡¨ç¤ºNone ","date":"2021-10-10","objectID":"/skill/:43:1","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å¥½å¤„ å®ƒå¯ä»¥åŠ å¼ºç³»ç»Ÿçš„ç¨³å›ºæ€§ï¼Œèƒ½æœ‰æœ‰æ•ˆåœ°é˜²æ­¢ç©ºæŒ‡é’ˆæŠ¥é”™å¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“ï¼Œä½¿ç³»ç»Ÿæ›´åŠ ç¨³å®šã€‚ å®ƒèƒ½å¤Ÿå®ç°å¯¹ç©ºå¯¹è±¡æƒ…å†µçš„å®šåˆ¶åŒ–çš„æ§åˆ¶ï¼Œèƒ½å¤ŸæŒæ¡å¤„ç†ç©ºå¯¹è±¡çš„ä¸»åŠ¨æƒã€‚ å®ƒå¹¶ä¸ä¾é Clientæ¥ä¿è¯æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚ å®ƒé€šè¿‡isNoneå¯¹==Noneçš„æ›¿æ¢ï¼Œæ˜¾å¾—æ›´åŠ ä¼˜é›…ï¼Œæ›´åŠ æ˜“æ‡‚ã€‚ import decimal class Account: \"\"\"ä¸€ä¸ªè™šæ‹Ÿçš„é“¶è¡Œè´¦å·\"\"\" def __init__(self, username, balance): self.username = username self.balance = balance @classmethod def from_string(cls, s): \"\"\"ä»å­—ç¬¦ä¸²åˆå§‹åŒ–ä¸€ä¸ªè´¦å·\"\"\" try: username, balance = s.split() balance = decimal.Decimal(float(balance)) except ValueError: # raise CreateAccountError('input must follow pattern \"{ACCOUNT_NAME} {BALANCE}\"') return NullAccount() if balance \u003c 0: return NullAccount() return cls(username=username, balance=balance) def caculate_total_balance(accounts_data): \"\"\"è®¡ç®—æ‰€æœ‰è´¦å·çš„æ€»ä½™é¢ \"\"\" return sum(Account.from_string(s).balance for s in accounts_data) class NullAccount: # è¦è¿”å›çš„ç©ºå¯¹è±¡ username = \"\" # å½“å‘ç”Ÿé”™è¯¯æ—¶usernameçš„å€¼ balance = 0 # å½“å‘ç”Ÿé”™è¯¯æ—¶balanceçš„å€¼ def re_Null(): return NotImplementedError accounts_data = [ 'piglei 96.5', 'cotton 21', 'invalid_data', 'roland $invalid_balance', 'alfred -3', ] print(caculate_total_balance(accounts_data)) ","date":"2021-10-10","objectID":"/skill/:43:2","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"pathlib from pathlib import Path # æŠŠtxtæ–‡ä»¶é‡å‘½åä¸ºcsvæ–‡ä»¶ def unify_ext_with_pathlib(path): for fpath in Path(path).glob(\"*.txt\"): fpath.rename(fpath.with_suffix(\".csv\")) print(Path(\".\") / \"test_pathlib.py\") # Pathç±»å‹å¯ä»¥ä½¿ç”¨/è¿ç®—ç¬¦ print(Path(\"testvim.txt\").read_text()) # ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹ # .resolve() å–ç»å¯¹è·¯å¾„ # with_name() ä¿®æ”¹æ–‡ä»¶å with_suffix()ä¿®æ”¹åç¼€å # æŠŠå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ‰¹é‡é‡å‘½å # import os # from pathlib import Path # p = Path(\".\") # for filepath in p.glob(\"test_*.py\"): # name = filepath.with_name(str(filepath).replace(\"test_\",\"\")) # filepath.rename(name) ","date":"2021-10-10","objectID":"/skill/:44:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å•å…ƒæµ‹è¯• def say_hello(name=None): if name: return f\"hello {name}\" return \"hello world\" import unittest from typing import List class sayhellotest(unittest.TestCase): def setUp(self,nums:List[int] = 0): return super().setUp() def tearDown(self): return super().tearDown() def test_sayhello(self): rv = say_hello() self.assertEqual(rv,\"hello world\") def test_to_name(self): rv = say_hello(\"wlb\") self.assertEqual(rv,\"hello wlb\") if __name__ == '__main__': unittest.main() ","date":"2021-10-10","objectID":"/skill/:45:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"takewhileå’Œdropwhile from itertools import dropwhile,takewhile # ä½ æƒ³éå†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä½†æ˜¯å®ƒå¼€å§‹çš„æŸäº›å…ƒç´ ä½ å¹¶ä¸æ„Ÿå…´è¶£ï¼Œæƒ³è·³è¿‡å®ƒä»¬ï¼Œç”¨dropwhile with open('testvim.txt','r') as fp: for i in dropwhile(lambda i:i.startswith(\"#\"),fp): # è·³è¿‡å‰é¢#å·å¼€å¤´çš„ print(i) with open(\"testvim.txt\",\"r\") as fp: for i in takewhile(lambda i:i.startswith(\"#\"),fp): # éå†å¸¦#å·å¼€å¤´çš„ï¼Œé‡åˆ°ä¸æ˜¯#å·å¼€å¤´çš„å°±é€€å‡ºå¾ªç¯ï¼Œå¯ä»¥å½“åšbreakä½¿ç”¨ # ç›¸å½“äº if not i.startwith(\"#\"): break print(i) ","date":"2021-10-10","objectID":"/skill/:46:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"è£…é¥°å™¨å¯ä»¥è£…é¥°æ–¹æ³• import random import wrapt # ä¸ºç¬¬ä¸‰æ–¹åº“ def provide_number(min_num, max_num): @wrapt.decorator def wrapper(wrapped, instance, args, kwargs): # å‚æ•°å«ä¹‰ï¼š # # - wrappedï¼šè¢«è£…é¥°çš„å‡½æ•°æˆ–ç±»æ–¹æ³• # - instanceï¼š # - å¦‚æœè¢«è£…é¥°è€…ä¸ºæ™®é€šç±»æ–¹æ³•ï¼Œè¯¥å€¼ä¸ºç±»å®ä¾‹ # - å¦‚æœè¢«è£…é¥°è€…ä¸º classmethod ç±»æ–¹æ³•ï¼Œè¯¥å€¼ä¸ºç±» # - å¦‚æœè¢«è£…é¥°è€…ä¸ºç±»/å‡½æ•°/é™æ€æ–¹æ³•ï¼Œè¯¥å€¼ä¸º None # # - argsï¼šè°ƒç”¨æ—¶çš„ä½ç½®å‚æ•°ï¼ˆæ³¨æ„æ²¡æœ‰ * ç¬¦å·ï¼‰ # - kwargsï¼šè°ƒç”¨æ—¶çš„å…³é”®å­—å‚æ•°ï¼ˆæ³¨æ„æ²¡æœ‰ ** ç¬¦å·ï¼‰ # num = random.randint(min_num, max_num) # æ— éœ€å…³æ³¨ wrapped æ˜¯ç±»æ–¹æ³•æˆ–æ™®é€šå‡½æ•°ï¼Œç›´æ¥åœ¨å¤´éƒ¨è¿½åŠ å‚æ•° args = (num,) + args return wrapped(*args, **kwargs) return wrapper @provide_number(1, 100) def print_random_number(num): print(num) class Foo: @provide_number(1, 100) def print_random_number(self, num): print(num) Foo().print_random_number() print_random_number() # ä½¿ç”¨ wrapt æ¨¡å—ç¼–å†™çš„è£…é¥°å™¨ï¼Œç›¸æ¯”åŸæ¥æ‹¥æœ‰ä¸‹é¢è¿™äº›ä¼˜åŠ¿ï¼š # åµŒå¥—å±‚çº§å°‘ï¼šä½¿ç”¨ @wrapt.decorator å¯ä»¥å°†ä¸¤å±‚åµŒå¥—å‡å°‘ä¸ºä¸€å±‚ # æ›´ç®€å•ï¼šå¤„ç†ä½ç½®ä¸å…³é”®å­—å‚æ•°æ—¶ï¼Œå¯ä»¥å¿½ç•¥ç±»å®ä¾‹ç­‰ç‰¹æ®Šæƒ…å†µ # æ›´çµæ´»ï¼šé’ˆå¯¹ instance å€¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­åï¼Œæ›´å®¹æ˜“è®©è£…é¥°å™¨å˜å¾—é€šç”¨ ","date":"2021-10-10","objectID":"/skill/:47:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"___getattribute__ ____getattribute__ä»…åœ¨æ–°å¼ç±»ä¸­å¯ç”¨ï¼Œé‡è½½__getattrbute__æ–¹æ³•å¯¹ç±»å®ä¾‹çš„æ¯ä¸ªå±æ€§è®¿é—®éƒ½æœ‰æ•ˆã€‚ class ClassA: x = 'a' def __init__(self): self.y = 'b' def __getattribute__(self, item): return '__getattribute__' if __name__ == '__main__': a = ClassA() # ä½¿ç”¨å®ä¾‹ç›´æ¥è®¿é—®å­˜åœ¨çš„ç±»å±æ€§æ—¶,ä¼šè°ƒç”¨__getattribute__æ–¹æ³• # è¾“å‡ºç»“æœ __getattribute__ print(a.x) # ä½¿ç”¨å®ä¾‹ç›´æ¥è®¿é—®å®ä¾‹å­˜åœ¨çš„å®ä¾‹å±æ€§æ—¶,ä¼šè°ƒç”¨__getattribute__æ–¹æ³• # è¾“å‡ºç»“æœ __getattribute__ print(a.y) # ä½¿ç”¨å®ä¾‹ç›´æ¥è®¿é—®å®ä¾‹ä¸å­˜åœ¨çš„å®ä¾‹å±æ€§æ—¶,ä¹Ÿä¼šè°ƒç”¨__getattribute__æ–¹æ³• # è¾“å‡ºç»“æœ __getattribute__ print(a.z) ç”±äº__getattr__åªé’ˆå¯¹æœªå®šä¹‰å±æ€§çš„è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨è‡ªå·±çš„ä»£ç ä¸­è‡ªç”±åœ°è·å–å…¶ä»–å±æ€§ï¼Œè€Œ__getattribute__é’ˆå¯¹æ‰€æœ‰çš„å±æ€§è¿è¡Œï¼Œå› æ­¤è¦ååˆ†æ³¨æ„é¿å…åœ¨è®¿é—®å…¶ä»–å±æ€§æ—¶ï¼Œå†æ¬¡è°ƒç”¨è‡ªèº«çš„é€’å½’å¾ªç¯ã€‚ å½“åœ¨__getattribute__ä»£ç å—ä¸­ï¼Œå†æ¬¡æ‰§è¡Œå±æ€§çš„è·å–æ“ä½œæ—¶ï¼Œä¼šå†æ¬¡è§¦å‘__getattribute__æ–¹æ³•çš„è°ƒç”¨ï¼Œä»£ç å°†ä¼šé™·å…¥æ— é™é€’å½’ï¼Œç›´åˆ°Pythoné€’å½’æ·±åº¦é™åˆ¶ï¼ˆé‡è½½__setter__æ–¹æ³•ä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼‰ã€‚ ç¤ºä¾‹ä»£ç ï¼ˆæ— é™é€’å½’ï¼‰ï¼š class ClassA: x = 'a' def __getattribute__(self, item): print('__getattribute__') return self.item if __name__ == '__main__': a = ClassA() a.x è¿è¡Œç»“æœå¼•å‘å¼‚å¸¸ã€‚ åŒæ—¶ï¼Œä¹Ÿæ²¡åŠæ³•é€šè¿‡ä»__dict__å–å€¼çš„æ–¹å¼æ¥é¿å…æ— é™é€’å½’ class ClassA: x = 'a' def __getattribute__(self, name): return self.__dict__[name] if __name__ == '__main__': a = ClassA() # æ— é™é€’å½’ a.x ä¸ºäº†é¿å…æ— é™é€’å½’ï¼Œåº”è¯¥æŠŠè·å–å±æ€§çš„æ–¹æ³•æŒ‡å‘ä¸€ä¸ªæ›´é«˜çš„è¶…ç±»ï¼Œä¾‹å¦‚objectï¼ˆå› ä¸º__getattribute__åªåœ¨æ–°å¼ç±»ä¸­å¯ç”¨ï¼Œè€Œæ–°å¼ç±»æ‰€æœ‰çš„ç±»éƒ½æ˜¾å¼æˆ–éšå¼åœ°ç»§æ‰¿è‡ªobjectï¼Œæ‰€ä»¥å¯¹äºæ–°å¼ç±»æ¥è¯´ï¼Œobjectæ˜¯æ‰€æœ‰æ–°å¼ç±»çš„è¶…ç±»ï¼‰ã€‚ ä¿®æ”¹ä»£ç ï¼ˆé¿å…æ— é™é€’å½’å¾ªç¯ï¼‰ï¼š class ClassA: x = 'a' def __getattribute__(self, item): print('__getattribute__') return super().__getattribute__(self, item) if __name__ == '__main__': a = ClassA() print(a.x) ç»“æœï¼š __getattribute__ a ","date":"2021-10-10","objectID":"/skill/:48:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"___getattr__ã€__setattr__ åŒºåˆ« getattribute å’Œ getattrï¼Œå‰è€…æ˜¯ä»»ä½•é€šè¿‡ x.y è®¿é—®å®ä¾‹çš„å±æ€§æ—¶éƒ½ä¼šè°ƒç”¨çš„ç‰¹æ®Šæ–¹æ³•ï¼Œè€Œåè€…åˆ™æ˜¯åœ¨æ­£å¸¸è®¿é—®å½¢å¼ä¸‹æ— æ³•æ‰¾åˆ°çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è°ƒç”¨ã€‚ class Chain(object): def __init__(self, path=''): self._path = path def __getattr__(self, path): return Chain('%s/%s' % (self._path, path)) def __str__(self): return self._path def users(self,name): return Chain(f\"{self._path}/users/{name}\") __repr__ = __str__ chain = Chain(\"vllbc\") print(chain.x.x.x.x.x) # out: vllbc/x/x/x/x/x å¦å¤–ï¼Œå½“åŒæ—¶å®šä¹‰__getattribute__å’Œ__getattr__æ—¶ï¼Œ__getattr__æ–¹æ³•ä¸ä¼šå†è¢«è°ƒç”¨ï¼Œé™¤éæ˜¾ç¤ºè°ƒç”¨__getattr__æ–¹æ³•æˆ–å¼•å‘AttributeErrorå¼‚å¸¸ã€‚å¯ä»¥åœ¨__getattribute__ä¸­æŠ›å‡ºå¼‚å¸¸æ¥è°ƒç”¨getattrã€‚ ","date":"2021-10-10","objectID":"/skill/:49:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"__getitem__ ","date":"2021-10-10","objectID":"/skill/:50:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å…ƒç±» ''' å…ƒç±»å°±æ˜¯æ§åˆ¶ç±»çš„åˆ›å»ºçš„ç±» ''' class ModelMetaclass(type): def __new__(cls, name, bases, attrs): if name == 'Model': return type.__new__(cls, name, bases, attrs) print(f\"found model {name}\") maps = dict() for k, v in attrs.items(): if isinstance(v, Field): print(f\"Found mapping {k} ==\u003e {v}\") maps[k] = v for k, v in maps.items(): attrs.pop(k) attrs['__mappings__'] = maps attrs['__table__'] = name return type.__new__(cls, name, bases, attrs) class Field(object): def __init__(self, name, column_type): self.name = name self.column_type = column_type def __str__(self): return '\u003c%s:%s\u003e' % (self.__class__.__name__, self.name) class StringField(Field): def __init__(self, name, column_type='TXT'): super().__init__(name, column_type) class IntegerField(Field): def __init__(self, name, column_type='INT'): super().__init__(name, column_type) class Model(dict, metaclass=ModelMetaclass): def __init__(self, **kw): super(Model, self).__init__(**kw) def __getattr__(self, key): try: return self[key] except KeyError: raise AttributeError(r\"'Model' object has no attribute '%s'\" % key) def __setattr__(self, key, value): self[key] = value def save(self): fields = [] params = [] args = [] for k, v in self.__mappings__.items(): fields.append(k) params.append('?') args.append(getattr(self, k, None)) sql = 'insert into %s (%s) values (%s)' % ( self.__table__, ','.join(fields), ','.join(params)) print('SQL: %s' % sql) print('ARGS: %s' % str(args)) class User(Model): # å®šä¹‰ç±»çš„å±æ€§åˆ°åˆ—çš„æ˜ å°„ï¼š id = IntegerField('id') name = StringField('username') email = StringField('email') password = StringField('password') # åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼š u = User(id=12345, name='Michael', email='test@orm.org', password='my-pwd') # ä¿å­˜åˆ°æ•°æ®åº“ï¼š u.save() ","date":"2021-10-10","objectID":"/skill/:51:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å…³äºhash # setä¸­çš„å…ƒç´ è¦æ±‚å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„ï¼Œä½†setæœ¬èº«æ˜¯ä¸å¯å“ˆå¸Œçš„ a = set([1,2,3,4]) a.add([1,2,3]) # ä¼šæŠ¥é”™ï¼Œå› ä¸ºåˆ—è¡¨æ˜¯ä¸å¯å“ˆå¸Œçš„ hash(a) # ä¼šæŠ¥é”™ï¼Œå› ä¸ºsetæœ¬èº«æ˜¯ä¸å¯å“ˆå¸Œçš„ b = tuple([1,2,3,4]) # å…ƒç»„æœ¬èº«æ˜¯å¯å“ˆå¸Œçš„ c = tuple([1,2,3,[4,5]]) # å¦‚æœå…ƒç»„é‡Œé¢æœ‰ä¸å¯å“ˆå¸Œçš„å…ƒç´  é‚£ä¹ˆæ•´ä¸ªå…ƒç»„ä¹Ÿæ˜¯ä¸å¯å“ˆå¸Œçš„äº† # åœ¨ç±»ä¸­å®šä¹‰__hash__æ–¹æ³•å°±å¯ä»¥å˜æˆå¯å“ˆå¸Œçš„ç±»ï¼Œæ³¨æ„é¿å…è¿”å›å¯èƒ½é‡å¤çš„hashå€¼ class My_Hash: def __hash__(self) -\u003e int: return 111 # è¿˜æœ‰ç®€ä¾¿çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨dataclassç±»ï¼Œå¯ä»¥çœæ—¶çœåŠ›ï¼Œæœ¬åšå®¢ä¹Ÿæœ‰ä»‹ç»ã€‚ ","date":"2021-10-10","objectID":"/skill/:52:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"å¤„ç†åˆ—è¡¨è¶Šç•Œ å‡å¦‚ä½ è¯·æ±‚çš„ä¸æ˜¯æŸä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯ä¸€æ®µèŒƒå›´çš„åˆ‡ç‰‡ã€‚é‚£ä¹ˆæ— è®ºä½ æŒ‡å®šçš„èŒƒå›´æ˜¯å¦æœ‰æ•ˆï¼Œç¨‹åºéƒ½åªä¼šè¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ []ï¼Œè€Œä¸ä¼šæŠ›å‡ºä»»ä½•é”™è¯¯ã€‚ äº†è§£äº†è¿™ç‚¹åï¼Œä½ ä¼šå‘ç°åƒä¸‹é¢è¿™ç§è¾¹ç•Œå¤„ç†ä»£ç æ ¹æœ¬æ²¡æœ‰å¿…è¦ï¼š def sum_list(l, limit): \"\"\"å¯¹åˆ—è¡¨çš„å‰ limit ä¸ªå…ƒç´ æ±‚å’Œ \"\"\" # å¦‚æœ limit è¿‡å¤§ï¼Œè®¾ç½®ä¸ºæ•°ç»„é•¿åº¦é¿å…è¶Šç•Œ if limit \u003e len(l): limit = len(l) return sum(l[:limit]) å› ä¸ºåšåˆ‡ç‰‡ä¸ä¼šæŠ›å‡ºä»»ä½•é”™è¯¯ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ¤æ–­ limit æ˜¯å¦è¶…å‡ºèŒƒå›´ï¼Œç›´æ¥åš sum æ“ä½œå³å¯ï¼š def sum_list(l, limit): return sum(l[:limit]) ","date":"2021-10-10","objectID":"/skill/:53:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"oræ“ä½œç¬¦ åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ or çš„ç‰¹ç‚¹æ¥ç®€åŒ–ä¸€äº›è¾¹ç•Œå¤„ç†é€»è¾‘ã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š context = {} # ä»…å½“ extra_context ä¸ä¸º None æ—¶ï¼Œå°†å…¶è¿½åŠ è¿› context ä¸­ if extra_context: context.update(extra_context) # ç­‰åŒäº context.update(extra_context or {}) å› ä¸º a or b or c or â€¦ è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œä¼šè¿”å›è¿™äº›å˜é‡é‡Œç¬¬ä¸€ä¸ªå¸ƒå°”å€¼ä¸ºçœŸçš„å€¼ï¼Œç›´åˆ°æœ€åä¸€ä¸ªä¸ºæ­¢ã€‚ å«ä¹‰ä¸ºå½“extra_contextä¸ºNoneæ—¶ï¼Œä¼šè¿”å›{} ## å­—å…¸çš„é”® åœ¨pythoné‡Œé¢ï¼ŒPython å­—å…¸é€šè¿‡æ£€æŸ¥é”®å€¼æ˜¯å¦ç›¸ç­‰å’Œæ¯”è¾ƒå“ˆå¸Œå€¼æ¥ç¡®å®šä¸¤ä¸ªé”®æ˜¯å¦ç›¸åŒ.å…·æœ‰ç›¸åŒå€¼çš„ä¸å¯å˜å¯¹è±¡(å¯å“ˆå¸Œ)åœ¨Pythonä¸­å§‹ç»ˆå…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚ æ³¨æ„:Â å…·æœ‰ä¸åŒå€¼çš„å¯¹è±¡ä¹Ÿå¯èƒ½å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ï¼ˆå“ˆå¸Œå†²çªï¼‰ã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­ some_dict = {} some_dict[5.5] = \"Ruby\" some_dict[5.0] = \"JavaScript\" some_dict[5] = \"Python\" \u003e\u003e\u003e some_dict[5.5] \"Ruby\" \u003e\u003e\u003e some_dict[5.0] \"Python\" \u003e\u003e\u003e some_dict[5] \"Python\" å› ä¸ºPythonå°†Â 5Â å’ŒÂ 5.0Â è¯†åˆ«ä¸ºÂ some_dictÂ çš„åŒä¸€ä¸ªé”®, æ‰€ä»¥å·²æœ‰å€¼ â€œJavaScriptâ€ å°±è¢« â€œPythonâ€ è¦†ç›–äº†. ","date":"2021-10-10","objectID":"/skill/:54:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["python"],"content":"ç±»__init__å‚æ•°å¿«é€Ÿèµ‹ç»™self def __init__(self, x=1) -\u003e None: super().__init__() self.__dict__.update(locals()) pass å³å¯ï¼Œæ­¤æ—¶ä¸éœ€è¦self.x=xä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨self.x ","date":"2021-10-10","objectID":"/skill/:55:0","tags":["python","skill"],"title":"skill","uri":"/skill/"},{"categories":["ç®—æ³•é¢˜"],"content":"é•¿åº¦æœ€å°çš„å­æ•°ç»„ ","date":"2021-09-30","objectID":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/:0:0","tags":["ç®—æ³•é¢˜","é•¿åº¦æœ€å°çš„å­æ•°ç»„"],"title":"é•¿åº¦æœ€å°çš„å­æ•°ç»„","uri":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/minimum-size-subarray-sum/ ","date":"2021-09-30","objectID":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/:1:0","tags":["ç®—æ³•é¢˜","é•¿åº¦æœ€å°çš„å­æ•°ç»„"],"title":"é•¿åº¦æœ€å°çš„å­æ•°ç»„","uri":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ ä¸€å¼€å§‹æƒ³çš„æ˜¯ç›´æ¥æ’åºï¼Œç„¶åä»åé¢å¼€å§‹éå†ï¼Œå› ä¸ºè¦æ±‚æœ€å°çš„ ç„¶åå‡ºé”™äº†ï¼Œï¼Œï¼Œï¼Œï¼Œ class Solution: def minSubArrayLen(self, s: int, nums: List[int]) -\u003e int: nums.sort() end = len(nums) - 1 while end \u003e 0: for i in range(end,-1,-1): if sum(nums[i:end+1]) \u003e= s: return len(nums[i:end+1]) end -= 1 return 0 åœ¨ 213 [12,28,83,4,25,26,25,2,25,25,25,12] å‡ºäº†é”™ï¼Œç»“æœè¯•äº†ä¸€ä¸‹æ’åºåçš„åˆ—è¡¨ [2, 4, 12, 12, 25, 25, 25, 25, 25, 26, 28, 83] ç»“æœå±…ç„¶æ˜¯å¯¹çš„ï¼Œè¯´æ˜æ˜¯æˆ‘çš„ä»£ç çš„é—®é¢˜ï¼Œä¸åº”è¯¥æ’åº é‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ class Solution: def minSubArrayLen(self, s: int, nums: List[int]) -\u003e int: if not nums: return 0 left = 0 right = 0 res = float('inf') while right \u003c len(nums): while sum(nums[left:right+1]) \u003e= s: res = min(res, right-left +1) left += 1 else: right += 1 if res == float('inf'): return 0 return res æ€è·¯ä¹Ÿå·®ä¸å¤šï¼Œä¹Ÿæ˜¯ç”¨åˆ°äº†åŒæŒ‡é’ˆã€‚ä¸è¿‡å¿…é¡»æ³¨æ„è¦åˆ¤æ–­æœ€å°çš„è¿™ä¸ªæ¡ä»¶å•Šã€‚ ","date":"2021-09-30","objectID":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/:2:0","tags":["ç®—æ³•é¢˜","é•¿åº¦æœ€å°çš„å­æ•°ç»„"],"title":"é•¿åº¦æœ€å°çš„å­æ•°ç»„","uri":"/%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"SVM ","date":"2021-09-20","objectID":"/svm/:0:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"kernel ","date":"2021-09-20","objectID":"/svm/:1:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä»‹ç» å…¶å®æ ¸å‡½æ•°å’Œæ˜ å°„å…³ç³»å¹¶ä¸å¤§ï¼Œkernelå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿ç®—æŠ€å·§ã€‚ ä¸€èˆ¬è®¤ä¸ºï¼ŒåŸæœ¬åœ¨ä½ç»´çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®é›†åœ¨è¶³å¤Ÿé«˜çš„ç»´åº¦å­˜åœ¨çº¿æ€§å¯åˆ†çš„è¶…å¹³é¢ã€‚ å›´ç»•è¿™ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€åšçš„å°±æ˜¯è¦åœ¨Feature Spaceå¥—ç”¨åŸæœ¬åœ¨çº¿æ€§å¯åˆ†æƒ…å†µä¸‹çš„Input Spaceä¸­ä½¿ç”¨è¿‡çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæ¥æ‰¾åˆ°é‚£ä¸ªMaximaizing Marginçš„è¶…å¹³é¢ã€‚åŸç†æœºåˆ¶ä¸€æ¨¡ä¸€æ ·ï¼Œæ˜¯äºŒæ¬¡è§„åˆ’ï¼Œå”¯ä¸€ä¸åŒæ˜¯ä»£å…¥æ•°æ®çš„ä¸åŒï¼Œå°†åŸæ¥çš„\\(x_i\\)æ›¿æ¢æˆäº†é«˜ç»´ç©ºé—´ä¸­çš„\\(\\phi(x_i)\\)ï¼Œè¿™å°±æ˜¯æ˜ å°„å‡½æ•°ï¼Œæ˜ å°„åˆ°é«˜ç»´ç©ºé—´ã€‚ å…·ä½“çš„æŠ€å·§(trick)ï¼Œå°±æ˜¯ç®€åŒ–è®¡ç®—äºŒæ¬¡è§„åˆ’ä¸­é—´çš„ä¸€æ­¥å†…ç§¯è®¡ç®—ã€‚ä¹Ÿå³ä¸­é—´æ­¥éª¤æœ‰ä¸€æ­¥å¿…é¡»æ±‚å¾—\\(\\phi(x_i) \\phi(x_j)\\)ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ ¸å‡½æ•°\\(K(x_i,x_j) = \\phi(x_i)\\phi(x_j)\\)ï¼Œè¿™æ ·æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼è®¡ç®—æ¯ä¸€ä¸ª\\(\\phi(x_i)\\)ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“å®ƒçš„å½¢å¼ï¼Œå°±å¯ä»¥ç›´æ¥è®¡ç®—ç»“æœå‡ºæ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¸å‡½æ•°ã€å†…ç§¯ã€ç›¸ä¼¼åº¦è¿™ä¸‰ä¸ªè¯æ˜¯ç­‰ä»·çš„ã€‚å› ä¸ºinner productå…¶å®å°±æ˜¯ä¸€ç§similarityçš„åº¦é‡ã€‚æ ¸å‡½æ•°å’Œæ˜ å°„æ˜¯æ— å…³çš„ã€‚ ","date":"2021-09-20","objectID":"/svm/:1:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä¾‹å­ ä¸¾ä¸€ä¸ªä¾‹å­ï¼š è€ƒè™‘ä¸€ä¸ªå¸¦æœ‰ç‰¹å¾æ˜ å°„çš„äºŒç»´è¾“å…¥ç©ºé—´ \\(\\chi \\subseteq \\mathbb{R}^{2}\\) : ç‰¹å¾æ˜ å°„äºŒç»´åˆ°ä¸‰ç»´: \\(\\quad \\Phi: x=\\left(x_{1}, x_{2}\\right) \\rightarrow \\Phi(x)=\\left(x_{1}^{2}, x_{2}^{2}, \\sqrt{2} x_{1} x_{2}\\right) \\in F=\\mathbb{R}^{3}\\) ç‰¹å¾ç©ºé—´ä¸­çš„å†…ç§¯ï¼š \\[ \\begin{aligned} \\langle\\Phi(x), \\Phi(z)\\rangle \u0026=\\left\\langle\\left(x_{1}^{2}, x_{2}^{2}, \\sqrt{2} x_{1} x_{2}\\right),\\left(z_{1}^{2}, z_{2}^{2}, \\sqrt{2} z_{1} z_{2}\\right)\\right\\rangle \\\\\\\\ \u0026=x_{1}^{2} z_{1}^{2}+x_{2}^{2} z_{2}^{2}+2 x_{1} x_{2} z_{1} z_{2} \\\\\\\\ \u0026=\\left\\langle x_{1} z_{1}+x_{2} z_{2}\\right\\rangle^{2} \\\\\\\\ \u0026=\\langle x, z\\rangle^{2} \\end{aligned} \\] æ ¹æ®ä¸Šé¢å¯å¾—ï¼Œæ ¸å‡½æ•°\\(k(x,z) = \\langle x,z \\rangle^2=\\phi(x)^T \\phi(z)\\) è€Œè¿™é‡Œä¸ºä»€ä¹ˆæ˜ å°„å‡½æ•°æ˜¯è¿™æ ·çš„å½¢å¼å‘¢ï¼Œå…¶å®å¯ä»¥æ˜¯åæ¨å‡ºæ¥çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œåæ­£å‡‘å·§é€šè¿‡è¿™ç§æ˜ å°„å‡½æ•°å¯ä»¥å¾—åˆ°è¿™ä¸ªæ ¸å‡½æ•°ã€‚ ","date":"2021-09-20","objectID":"/svm/:1:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å¸¸ç”¨æ ¸å‡½æ•°ç†è§£ ä»¥é«˜æ–¯æ ¸å‡½æ•°ä¸ºä¾‹ï¼Œ \\[ \\kappa\\left(x_{1}, x_{2}\\right)=\\exp \\left(-\\frac{\\left|x_{1}-x_{2}\\right|^{2}}{2 \\sigma^{2}}\\right) \\] æˆ‘ä»¬å‡è®¾ \\(\\sigma=1\\) ï¼Œåˆ™ \\[ \\begin{aligned} \\kappa\\left(x_{1}, x_{2}\\right) \u0026=\\exp \\left(-\\frac{\\left|x_{1}-x_{2}\\right|^{2}}{2 \\sigma^{2}}\\right) \\\\\\\\ \u0026=\\exp \\left(-\\left(x_{1}-x_{2}\\right)^{2}\\right) \\\\\\\\ \u0026=\\exp \\left(-x_{1}^{2}\\right) \\exp \\left(-x_{2}^{2}\\right) \\exp \\left(2 x_{1} x_{2}\\right) \\\\\\\\ \u0026 \\text { Taylor } \\\\\\\\ \u0026=\\exp \\left(-x_{1}^{2}\\right) \\exp \\left(-x_{2}^{2}\\right)\\left(\\sum_{i=0}^{\\infty} \\frac{\\left(2 x_{1} x_{2}\\right)^{i}}{i !}\\right) \\\\\\\\ \u0026=\\sum_{i=0}^{\\infty}\\left(\\exp \\left(-x_{1}^{2}\\right) \\exp \\left(-x_{2}^{2}\\right) \\sqrt{\\left.\\frac{2^{i}}{i !} \\sqrt{\\frac{2^{i}}{i !}} x_{1}^{i} x_{2}^{i}\\right)}\\right.\\\\\\\\ \u0026=\\sum_{i=0}^{\\infty}\\left(\\left[\\exp \\left(-x_{1}^{2}\\right) \\sqrt{\\frac{2^{i}}{i !}} x_{1}^{i}\\right]\\left[\\exp \\left(-x_{2}^{2}\\right) \\sqrt{\\frac{2^{i}}{i !}} x_{2}^{i}\\right]\\right) \\\\\\\\ \u0026=\\phi\\left(x_{1}\\right)^{T} \\phi\\left(x_{2}\\right) \\end{aligned} \\] wè¿™ä¸ï¼Œå·²ç»æœ‰äº†å®šä¹‰çš„é‚£ç§å½¢å¼ï¼Œå¯¹äº \\(\\phi(x)\\) ï¼Œç”±äº \\[ \\phi(x)=\\exp \\left(-x^{2}\\right) \\cdot\\left(1, \\sqrt{\\frac{2^{1}}{1 !}} x, \\sqrt{\\frac{2^{2}}{2 !}} x^{2}, \\cdots\\right) \\] æ‰€ä»¥ï¼Œå¯ä»¥æ˜ å°„åˆ°ä»»ä½•ä¸€ä¸ªç»´åº¦ä¸Šã€‚ ","date":"2021-09-20","objectID":"/svm/:1:3","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ ¸å‡½æ•°ç±»åˆ« å…¶å®å¸¸ç”¨çš„å°±é‚£å‡ ä¸ªï¼Œé«˜æ–¯æ ¸å‡½æ•°æœ€ä¸ºå¸¸ç”¨ã€‚ ","date":"2021-09-20","objectID":"/svm/:1:4","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å‚è€ƒ https://www.cnblogs.com/damin1909/p/12955240.html https://blog.csdn.net/mengjizhiyou/article/details/103437423 ","date":"2021-09-20","objectID":"/svm/:1:5","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº ","date":"2021-09-20","objectID":"/svm/:2:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"çº¿æ€§å¯åˆ† åœ¨äºŒç»´ç©ºé—´ä¸Šï¼Œä¸¤ç±»ç‚¹è¢«ä¸€æ¡ç›´çº¿å®Œå…¨åˆ†å¼€å«åšçº¿æ€§å¯åˆ†ã€‚ ","date":"2021-09-20","objectID":"/svm/:2:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æœ€å¤§é—´éš”è¶…å¹³é¢ ä»¥æœ€å¤§é—´éš”æŠŠä¸¤ç±»æ ·æœ¬åˆ†å¼€çš„è¶…å¹³é¢ï¼Œä¹Ÿç§°ä¹‹ä¸ºæœ€å¤§é—´éš”è¶…å¹³é¢ã€‚ ","date":"2021-09-20","objectID":"/svm/:2:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ”¯æŒå‘é‡ æ ·æœ¬ä¸­è·ç¦»è¶…å¹³é¢æœ€è¿‘çš„ä¸€äº›ç‚¹ï¼Œè¿™äº›ç‚¹å«åšæ”¯æŒå‘é‡ã€‚ ","date":"2021-09-20","objectID":"/svm/:2:3","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æœ€ä¼˜åŒ–é—®é¢˜ SVM æƒ³è¦çš„å°±æ˜¯æ‰¾åˆ°å„ç±»æ ·æœ¬ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»æœ€è¿œï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°æœ€å¤§é—´éš”è¶…å¹³é¢ã€‚ä»»æ„è¶…å¹³é¢å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªçº¿æ€§æ–¹ç¨‹æ¥æè¿°ï¼š \\[ w^Tx+b=0 \\] äºŒç»´ç©ºé—´ç‚¹(x,y)åˆ°ç›´çº¿\\(Ax+By+C=0\\)çš„è·ç¦»å…¬å¼ä¸ºï¼š \\[ \\frac{|Ax+By+C|}{\\sqrt{A^2+B^2}} \\] æ‰©å±•åˆ°nç»´ç©ºé—´ä¸­ï¼Œ\\(x=(x_1, x_2,\\dots, x_n)\\)åˆ°ç›´çº¿\\(w^Tx+b=0\\)çš„è·ç¦»ä¸ºï¼š \\[ \\frac{|w^Tx+b|}{||w||} \\] å¦‚å›¾æ‰€ç¤ºï¼Œæ ¹æ®æ”¯æŒå‘é‡çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“ï¼Œæ”¯æŒå‘é‡åˆ°è¶…å¹³é¢çš„è·ç¦»ä¸º dï¼Œå…¶ä»–ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»å¤§äº dã€‚ äºæ˜¯æˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªå…¬å¼ï¼š ä¹‹åå¾—åˆ°: åˆ†æ¯éƒ½æ˜¯æ­£æ•°ï¼Œå› æ­¤å¯ä»¥ä»¤å®ƒä¸º1ã€‚ åˆå¹¶å¾—ï¼š è‡³æ­¤æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æœ€å¤§é—´éš”è¶…å¹³é¢çš„ä¸Šä¸‹ä¸¤ä¸ªè¶…å¹³é¢ï¼š æ¯ä¸ªæ”¯æŒå‘é‡åˆ°è¶…å¹³é¢çš„è·ç¦»å¯ä»¥å†™ä¸ºï¼š æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°ï¼š æœ€å¤§åŒ–è¿™ä¸ªè·ç¦»ï¼š è¿™é‡Œä¹˜ä¸Š 2 å€ä¹Ÿæ˜¯ä¸ºäº†åé¢æ¨å¯¼ï¼Œå¯¹ç›®æ ‡å‡½æ•°æ²¡æœ‰å½±å“ã€‚åˆšåˆšæˆ‘ä»¬å¾—åˆ°æ”¯æŒå‘é‡\\(y(w^Tx+b) = 1\\)ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°ï¼š \\[ \\max\\frac{2}{||w||} \\] å¯¹ç›®æ ‡è¿›è¡Œè½¬æ¢ï¼š \\[ \\min\\frac{1}{2}||w||^2 \\] æ‰€ä»¥å¾—åˆ°çš„æœ€ä¼˜åŒ–é—®é¢˜æ˜¯ï¼š ","date":"2021-09-20","objectID":"/svm/:2:4","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"å¯¹å¶é—®é¢˜ æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•ã€æ‹‰æ ¼æœ—æ—¥å¯¹å¶å’ŒKKTæ¡ä»¶ å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/38163970 ç»™å®šçº¦æŸä¼˜åŒ–é—®é¢˜ï¼š \\[ \\begin{aligned} \u0026\\min f(x) \\\\\\\\ \u0026 s.t. g(x) = 0 \\end{aligned} \\] ä¸ºæ–¹ä¾¿åˆ†æï¼Œå‡è®¾Â fÂ ä¸Â gÂ æ˜¯è¿ç»­å¯å¯¼å‡½æ•°ã€‚Lagrangeä¹˜æ•°æ³•æ˜¯ç­‰å¼çº¦æŸä¼˜åŒ–é—®é¢˜çš„å…¸å‹è§£æ³•ã€‚å®šä¹‰Lagrangianå‡½æ•° \\[ L(x, \\lambda) = f(x) + \\lambda g(x) \\] å…¶ä¸­Â Î»Â ç§°ä¸ºLagrangeä¹˜æ•°ã€‚Lagrangeä¹˜æ•°æ³•å°†åŸæœ¬çš„çº¦æŸä¼˜åŒ–é—®é¢˜è½¬æ¢æˆç­‰ä»·çš„æ— çº¦æŸä¼˜åŒ–é—®é¢˜ è®¡ç®—Â LÂ å¯¹Â xÂ ä¸Â Î»Â çš„åå¯¼æ•°å¹¶è®¾ä¸ºé›¶ï¼Œå¯å¾—æœ€ä¼˜è§£çš„å¿…è¦æ¡ä»¶ï¼š æ¥ä¸‹æ¥æ˜¯ä¸ç­‰å¼çº¦æŸï¼š \\[ \\begin{aligned} \u0026 \\min f(x) \\\\ \u0026 s.t. g(x) \\leq 0 \\end{aligned} \\] æ®æ­¤æˆ‘ä»¬å®šä¹‰å¯è¡ŒåŸŸ(feasible region)\\(K=x\\in R^n | g(x)\\leq 0\\)ã€‚è®¾$x^* $ä¸ºæ»¡è¶³æ¡ä»¶çš„æœ€ä½³è§£ï¼Œåˆ†æƒ…å†µè®¨è®ºï¼š \\(g(x^* ) \u003c 0\\)ï¼Œæœ€ä½³è§£ä½äºKçš„å†…éƒ¨ï¼Œä¸ºå†…éƒ¨è§£ï¼Œè¿™æ—¶çš„çº¦æŸæ˜¯æ— æ•ˆçš„ã€‚ \\(g(x^* ) = 0\\)ï¼Œæœ€ä½³è§£è½åœ¨Kçš„è¾¹ç•Œï¼Œç§°ä¸ºè¾¹ç•Œè§£ï¼Œæ­¤æ—¶çš„çº¦æŸæ˜¯æœ‰æ•ˆçš„ã€‚ è¿™ä¸¤ç§æƒ…å†µçš„æœ€ä½³è§£å…·æœ‰ä¸åŒçš„å¿…è¦æ¡ä»¶ã€‚ å…·æœ‰ä¸åŒçš„å¿…è¦æ¡ä»¶ï¼š å†…éƒ¨è§£ï¼šåœ¨çº¦æŸæ¡ä»¶æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œ\\(g(x)\\)ä¸èµ·ä½œç”¨ï¼Œçº¦æŸä¼˜åŒ–é—®é¢˜é€€åŒ–ä¸ºæ— çº¦æŸä¼˜åŒ–é—®é¢˜ï¼Œå› æ­¤$x^* \\(æ»¡è¶³\\)= 0$ è¾¹ç•Œè§£ï¼šåœ¨çº¦æŸæœ‰æ•ˆçš„æƒ…å†µä¸‹ï¼Œçº¦æŸä¸ç­‰å¼å˜ä¸ºç­‰å¼\\(g(x)=0\\)ã€‚æ­¤æ—¶æ‹‰æ ¼æœ—æ—¥å‡½æ•°åœ¨$x^* \\(çš„æ¢¯åº¦ä¸º0ï¼Œå³\\)f = -g\\(ï¼Œ\\)f(x)\\(çš„æå°å€¼åœ¨è¾¹ç•Œå–åˆ°ï¼Œé‚£ä¹ˆå¯è¡ŒåŸŸå†…éƒ¨çš„\\)f(x)\\(åº”è¯¥éƒ½æ˜¯å¤§äºè¿™ä¸ªæå°å€¼ï¼Œåˆ™\\)f(x)\\(çš„æ–¹å‘æ˜¯å¯è¡ŒåŸŸå†…éƒ¨ã€‚è€Œ\\)g\\(çš„æ–¹å‘ä¸ºå¯è¡ŒåŸŸå¤–éƒ¨ï¼Œå› ä¸ºçº¦æŸæ¡ä»¶æ˜¯\\)g(x) \\(ï¼Œä¹Ÿå°±æ˜¯å¯è¡ŒåŸŸå¤–éƒ¨éƒ½æ˜¯\\)g(x) \u003e 0\\(ï¼Œæ‰€ä»¥æ¢¯åº¦æ–¹å‘å°±æ˜¯æŒ‡å‘å‡½æ•°å¢åŠ çš„æ–¹å‘ã€‚è¯´æ˜ä¸¤ä¸ªå‡½æ•°çš„æ¢¯åº¦æ–¹å‘ç›¸åï¼Œè¦æƒ³ä¸Šé¢çš„ç­‰å¼æˆç«‹ï¼Œå¿…é¡»æœ‰\\)\\(ï¼Œè¿™å°±æ˜¯å¯¹å¶å¯è¡Œæ€§ã€‚ å› æ­¤ï¼Œä¸è®ºæ˜¯å†…éƒ¨è§£æˆ–è¾¹ç•Œè§£ï¼ŒÂ \\)g(x)=0$Â æ’æˆç«‹ æ•´åˆä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œæœ€ä½³è§£çš„å¿…è¦æ¡ä»¶åŒ…æ‹¬Lagrangianå‡½æ•°çš„å®šå¸¸æ–¹ç¨‹å¼ã€åŸå§‹å¯è¡Œæ€§ã€å¯¹å¶å¯è¡Œæ€§ï¼Œä»¥åŠäº’è¡¥æ¾å¼›æ€§ï¼š è¿™å°±æ˜¯KKTæ¡ä»¶ã€‚ ä¸Šé¢ç»“æœå¯æ¨å¹¿è‡³å¤šä¸ªçº¦æŸç­‰å¼ä¸çº¦æŸä¸ç­‰å¼çš„æƒ…å†µã€‚è€ƒè™‘æ ‡å‡†çº¦æŸä¼˜åŒ–é—®é¢˜(æˆ–ç§°éçº¿æ€§è§„åˆ’)ï¼š å®šä¹‰Lagrangian å‡½æ•° åˆ™KKTæ¡ä»¶ä¸º åº”ç”¨ å·²çŸ¥svmä¼˜åŒ–çš„ä¸»è¦é—®é¢˜ï¼š é‚£ä¹ˆæ±‚è§£çº¿æ€§å¯åˆ†çš„ SVM çš„æ­¥éª¤ä¸ºï¼š æ­¥éª¤1ï¼š æ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š æ­¥éª¤2ï¼š åˆ©ç”¨å¼ºå¯¹å¶æ€§è½¬åŒ–ï¼š ç°å¯¹å‚æ•° w å’Œ b æ±‚åå¯¼æ•°ï¼š å…·ä½“æ­¥éª¤ï¼š åœ¨å‰é¢çš„æ­¥éª¤ä¸­å³ä¸ºï¼š æˆ‘ä»¬å°†è¿™ä¸ªç»“æœå¸¦å›åˆ°å‡½æ•°ä¸­å¯å¾—ï¼š ä¹Ÿå°±æ˜¯è¯´ï¼š æ­¥éª¤3ï¼š ç”±ä¸Šè¿°è¿‡ç¨‹éœ€è¦æ»¡è¶³KKTæ¡ä»¶ï¼ˆ\\(\\alpha\\)å°±æ˜¯æœ¬æ–‡ä¸­çš„\\(\\lambda\\)ï¼‰ï¼š æ˜“å¾—ï¼Œå½“\\(\\lambda_i\\)å¤§äº0ï¼Œåˆ™å¿…æœ‰\\(y_if(x_i)=1\\),æ‰€å¯¹åº”çš„æ ·æœ¬ç‚¹æ˜¯ä¸€ä¸ªæ”¯æŒå‘é‡ï¼Œå³ä½äºæœ€å¤§é—´éš”è¾¹ç•Œä¸Šã€‚ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªäºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œé—®é¢˜è§„æ¨¡æ­£æ¯”äºè®­ç»ƒæ ·æœ¬æ•°ï¼Œæˆ‘ä»¬å¸¸ç”¨ SMO(Sequential Minimal Optimization) ç®—æ³•æ±‚è§£ã€‚ SMO(Sequential Minimal Optimization)ï¼Œåºåˆ—æœ€å°ä¼˜åŒ–ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼šæ¯æ¬¡åªä¼˜åŒ–ä¸€ä¸ªå‚æ•°ï¼Œå…¶ä»–å‚æ•°å…ˆå›ºå®šä½ï¼Œä»…æ±‚å½“å‰è¿™ä¸ªä¼˜åŒ–å‚æ•°çš„æå€¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ SMO ç®—æ³•åœ¨ SVM ä¸­çš„åº”ç”¨ã€‚ æˆ‘ä»¬åˆšè¯´äº† SMO ç®—æ³•æ¯æ¬¡åªä¼˜åŒ–ä¸€ä¸ªå‚æ•°ï¼Œä½†æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æœ‰çº¦æŸæ¡ä»¶ï¼Œæ²¡æ³•ä¸€æ¬¡åªå˜åŠ¨ä¸€ä¸ªå‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†ä¸€æ¬¡é€‰æ‹©ä¸¤ä¸ªå‚æ•°ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š é€‰æ‹©ä¸¤ä¸ªéœ€è¦æ›´æ–°çš„å‚æ•°\\(\\lambda _i\\)å’Œ\\(\\lambda_j\\)ï¼Œå›ºå®šå…¶ä»–å‚æ•°ã€‚äºæ˜¯æˆ‘ä»¬æœ‰ä»¥ä¸‹çº¦æŸï¼š å…¶ä¸­\\(c = -\\sum_{k\\neq i, j}\\lambda_ky_k\\)ï¼Œ å› æ­¤å¯ä»¥å¾—å‡º\\(\\lambda_j = \\frac{c-\\lambda_iy_i}{y_j}\\)ï¼Œè¿™æ ·å°±ç›¸å½“äºæŠŠç›®æ ‡é—®é¢˜è½¬åŒ–æˆäº†ä»…æœ‰ä¸€ä¸ªçº¦æŸæ¡ä»¶çš„æœ€ä¼˜åŒ–é—®é¢˜ï¼Œä»…æœ‰çš„çº¦æŸæ˜¯\\(\\lambda_i\u003e0\\) å¯¹äºä»…æœ‰ä¸€ä¸ªçº¦æŸæ¡ä»¶çš„æœ€ä¼˜åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨\\(\\lambda_i\\)ä¸Šå¯¹ä¼˜åŒ–ç›®æ ‡æ±‚åå¯¼ï¼Œä»¤å¯¼æ•°ä¸ºé›¶ï¼Œä»è€Œæ±‚å‡ºå˜é‡å€¼\\(\\lambda_{inew}\\)ï¼Œä»è€Œæ±‚å‡º\\(\\lambda_{jnew}\\) å¤šæ¬¡è¿­ä»£ç›´è‡³æ”¶æ•›ã€‚ é€šè¿‡ SMO æ±‚å¾—æœ€ä¼˜è§£$^* $ æ­¥éª¤4ï¼š æˆ‘ä»¬æ±‚åå¯¼æ•°æ—¶å¾—åˆ°ï¼š ç”±ä¸Šå¼å¯æ±‚å¾— wã€‚ ç”±äºæ‰€æœ‰\\(\\lambda_i\u003e0\\)çš„ç‚¹éƒ½æ˜¯æ”¯æŒå‘é‡ï¼Œå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªæ”¯æŒå‘é‡ä»£å…¥\\(y_s(w^Tx_s+b)=1\\)ï¼Œæ±‚å‡ºbå³å¯ã€‚ ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥\\(y_s\\)ï¼Œæœ€åå¾—\\(b = y_s-wx_s\\) ä¸ºäº†æ›´å…·é²æ£’æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾—æ”¯æŒå‘é‡çš„å‡å€¼ï¼š æ­¥éª¤5ï¼š w å’Œ b éƒ½æ±‚å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å°±èƒ½æ„é€ å‡ºæœ€å¤§åˆ†å‰²è¶…å¹³é¢ï¼š\\(w^Tx+b=0\\) åˆ†ç±»å†³ç­–å‡½æ•°ï¼š\\(f(x) = sign(w^Tx+b)\\) å°†æ–°æ ·æœ¬ç‚¹å¯¼å…¥åˆ°å†³ç­–å‡½æ•°ä¸­æ—¢å¯å¾—åˆ°æ ·æœ¬çš„åˆ†ç±»ã€‚ ","date":"2021-09-20","objectID":"/svm/:2:5","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"çº¿æ€§æ”¯æŒå‘é‡æœºä¸è½¯é—´éš” ","date":"2021-09-20","objectID":"/svm/:3:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"è½¯é—´éš” åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®Œå…¨çº¿æ€§å¯åˆ†çš„æ ·æœ¬æ˜¯å¾ˆå°‘çš„ï¼Œå¦‚æœé‡åˆ°äº†ä¸èƒ½å¤Ÿå®Œå…¨çº¿æ€§å¯åˆ†çš„æ ·æœ¬ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼š äºæ˜¯æˆ‘ä»¬å°±æœ‰äº†è½¯é—´éš”ï¼Œç›¸æ¯”äºç¡¬é—´éš”çš„è‹›åˆ»æ¡ä»¶ï¼Œæˆ‘ä»¬å…è®¸ä¸ªåˆ«æ ·æœ¬ç‚¹å‡ºç°åœ¨é—´éš”å¸¦é‡Œé¢ï¼Œå³å…è®¸å‡ºç°åˆ†ç±»é”™è¯¯çš„æ ·æœ¬ï¼š æˆ‘ä»¬å…è®¸éƒ¨åˆ†æ ·æœ¬ç‚¹ä¸æ»¡è¶³çº¦æŸæ¡ä»¶ï¼š \\[ y_i(w^Tx_i+b) \\geq 1 \\] åˆ™ä¼˜åŒ–ç›®æ ‡å˜æˆäº† \\[ \\min_{w, b} \\frac{1}{2}\\|{w}\\|^{2}+C \\sum_{i=1}^{m} \\ell_{0 / 1}\\left(y_{i}\\left({w}^{\\mathrm{T}} {x}_{i}+b\\right)-1\\right), \\] å…¶ä¸­ \\(C\u003e0\\) æ˜¯ä¸€ä¸ªå¸¸æ•°, \\(\\ell_{0 / 1}\\) æ˜¯ â€œ \\(0 / 1\\) æŸå¤±å‡½æ•°â€ \\[ \\ell_{0 / 1}(z)= \\begin{cases}1, \u0026 \\text { if } z\u003c0 \\\\\\\\ 0, \u0026 \\text { otherwise. }\\end{cases} \\] æ˜¾ç„¶, å½“ \\(C\\) ä¸ºæ— ç©·å¤§æ—¶, \\(\\xi_i\\)å¿…ç„¶æ— ç©·å°ï¼Œå¦‚æ­¤ä¸€æ¥çº¿æ€§svmå°±åˆå˜æˆäº†çº¿æ€§å¯åˆ†svmï¼Œå½“\\(C\\)ä¸ºæœ‰é™å€¼æ—¶ï¼Œæ‰ä¼šå…è®¸éƒ¨åˆ†æ ·æœ¬ä¸éµå¾ªçº¦æŸæ¡ä»¶ ç„¶è€Œ, \\(\\ell_{0 / 1}\\) éå‡¸ã€éè¿ç»­, æ•°å­¦æ€§è´¨ä¸å¤ªå¥½, ä½¿å¾—ä¸æ˜“ç›´æ¥æ±‚è§£. äº æ˜¯, äººä»¬é€šå¸¸ç”¨å…¶ä»–ä¸€äº›å‡½æ•°æ¥ä»£æ›¿ \\(\\ell_{0 / 1}\\), ç§°ä¸º â€œæ›¿ä»£æŸå¤±â€ (surrogate loss). æ›¿ä»£æŸå¤±å‡½æ•°ä¸€èˆ¬å…·æœ‰è¾ƒå¥½çš„æ•°å­¦æ€§è´¨, å¦‚å®ƒä»¬é€šå¸¸æ˜¯å‡¸çš„è¿ç»­å‡½æ•°ä¸”æ˜¯ \\(\\ell_{0 / 1}\\) çš„ä¸Šç•Œ. ç»™å‡ºäº†ä¸‰ç§å¸¸ç”¨çš„æ›¿ä»£æŸå¤±å‡½æ•°: hinge æŸå¤±: \\(\\ell_{\\text {hinge }}(z)=\\max(0,1-z)\\); æŒ‡æ•°æŸå¤±(exponential loss): \\(\\ell_{\\exp }(z)=\\exp (-z)\\); å¯¹ç‡æŸå¤±(logistic loss): \\(\\ell_{\\log }(z)=\\log (1+\\exp (-z))\\). è‹¥é‡‡ç”¨ hinge æŸå¤±, åˆ™å˜æˆ \\[ \\min_{w, b} \\frac{1}{2}\\|{w}\\|^{2}+C \\sum_{i=1}^{m} \\max\\left(0,1-y_{i}\\left({w}^{\\mathrm{T}} {x}_{i}+b\\right)\\right) \\] ä¸ºäº†åº¦é‡è¿™ä¸ªé—´éš”è½¯åˆ°ä½•ç§ç¨‹åº¦ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ ·æœ¬å¼•å…¥ä¸€ä¸ªæ¾å¼›å˜é‡\\(\\xi_i\\)ï¼Œä»¤\\(\\xi_i \\geq 0\\)ï¼Œä¸”\\(1-y_i(w^Tx_i+b)-\\xi_i\\leq 0\\)ï¼Œå¦‚ä¸‹å›¾ï¼š ","date":"2021-09-20","objectID":"/svm/:3:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä¼˜åŒ–ç›®æ ‡ä¸æ±‚è§£ ä¼˜åŒ–ç›®æ ‡ï¼š æ­¥éª¤1ï¼š æ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š æ­¥éª¤2ï¼š åˆ†åˆ«æ±‚å¯¼ï¼Œå¾—å‡ºä»¥ä¸‹å…³ç³»ï¼š å°†è¿™äº›å…³ç³»å¸¦å…¥æ‹‰æ ¼æœ—æ—¥å‡½æ•°ä¸­ï¼Œå¾—åˆ°ï¼š åˆ™ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå’Œç¡¬é—´éš”çš„ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸ªçº¦æŸæ¡ä»¶ã€‚ ç„¶åä½¿ç”¨SMOç®—æ³•æ±‚$^* $ è½¯é—´éš”KKTæ¡ä»¶ å…¶ä¸­\\(\\alpha\\)å¯¹åº”æœ¬æ–‡çš„\\(\\lambda\\)ï¼Œ\\(\\mu\\)å¯¹åº”æœ¬æ–‡çš„\\(\\mu\\) å› æ­¤ç”±ç¬¬ä¸‰ä¸ªå¼å­å¾—å¿…æœ‰\\(\\lambda_i =0\\)æˆ–è€…\\(y_if(x_i) - 1+\\xi_i \\geq 0\\) \\(\\lambda_i=0\\)ï¼Œåˆ™è¯¥æ ·æœ¬å¯¹å…¶æ²¡æœ‰ä»»ä½•å½±å“ã€‚ \\(\\lambda_i \u003e 0\\)ï¼Œåˆ™æ ·æœ¬ä¸ºæ”¯æŒå‘é‡ã€‚ è‹¥\\(\\lambda_i \u003cC\\),åˆ™\\(\\mu_i \u003e 0\\)ï¼Œè¿›è€Œæœ‰\\(\\xi_i=0\\)ï¼Œåˆ™æ ·æœ¬æ°åœ¨æœ€å¤§é—´éš”è¾¹ç•Œä¸Šã€‚ä¹Ÿæ˜¯æ”¯æŒå‘é‡ã€‚ è‹¥\\(\\lambda_i=C\\),åˆ™æœ‰\\(\\mu_i=0\\)ï¼Œæ­¤æ—¶è‹¥\\(\\xi_i\\leq 1\\)ï¼Œåˆ™æ ·æœ¬è½åœ¨æœ€å¤§é—´éš”å†…éƒ¨ã€‚è‹¥\\(\\xi_i\u003e1\\)åˆ™æ ·æœ¬è¢«é”™è¯¯åˆ†ç±»ã€‚ å†çœ‹ä¸€ä¸‹ä¸‹é¢è¿™å›¾å°±ç†è§£äº†ã€‚ æ­¥éª¤3ï¼š ç„¶åæˆ‘ä»¬é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå¼å­æ±‚å‡º w å’Œ bï¼Œæœ€ç»ˆæ±‚å¾—è¶…å¹³é¢ è¿™è¾¹è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨é—´éš”å†…çš„é‚£éƒ¨åˆ†æ ·æœ¬ç‚¹æ˜¯ä¸æ˜¯æ”¯æŒå‘é‡ï¼Ÿ æˆ‘ä»¬å¯ä»¥ç”±æ±‚å‚æ•° w çš„é‚£ä¸ªå¼å­å¯çœ‹å‡ºï¼Œåªè¦Â \\(\\lambda_i \u003e 0\\)çš„ç‚¹éƒ½èƒ½å½±å“æˆ‘ä»¬çš„è¶…å¹³é¢ï¼Œå› æ­¤éƒ½æ˜¯æ”¯æŒå‘é‡ã€‚ ","date":"2021-09-20","objectID":"/svm/:3:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"éçº¿æ€§æ”¯æŒå‘é‡æœº æˆ‘ä»¬åˆšåˆšè®¨è®ºçš„ç¡¬é—´éš”å’Œè½¯é—´éš”éƒ½æ˜¯åœ¨è¯´æ ·æœ¬çš„å®Œå…¨çº¿æ€§å¯åˆ†æˆ–è€…å¤§éƒ¨åˆ†æ ·æœ¬ç‚¹çš„çº¿æ€§å¯åˆ†ã€‚ ä½†æˆ‘ä»¬å¯èƒ½ä¼šç¢°åˆ°çš„ä¸€ç§æƒ…å†µæ˜¯æ ·æœ¬ç‚¹ä¸æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œæ¯”å¦‚ï¼š è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ³•å°±æ˜¯ï¼šå°†äºŒç»´çº¿æ€§ä¸å¯åˆ†æ ·æœ¬æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ä¸­ï¼Œè®©æ ·æœ¬ç‚¹åœ¨é«˜ç»´ç©ºé—´çº¿æ€§å¯åˆ†ï¼Œæ¯”å¦‚ï¼š å¯¹äºåœ¨æœ‰é™ç»´åº¦å‘é‡ç©ºé—´ä¸­çº¿æ€§ä¸å¯åˆ†çš„æ ·æœ¬ï¼Œæˆ‘ä»¬å°†å…¶æ˜ å°„åˆ°æ›´é«˜ç»´åº¦çš„å‘é‡ç©ºé—´é‡Œï¼Œå†é€šè¿‡é—´éš”æœ€å¤§åŒ–çš„æ–¹å¼ï¼Œå­¦ä¹ å¾—åˆ°æ”¯æŒå‘é‡æœºï¼Œå°±æ˜¯éçº¿æ€§ SVMã€‚ æˆ‘ä»¬ç”¨ x è¡¨ç¤ºåŸæ¥çš„æ ·æœ¬ç‚¹ï¼Œç”¨\\(\\phi(x)\\)è¡¨ç¤º x æ˜ å°„åˆ°ç‰¹å¾æ–°çš„ç‰¹å¾ç©ºé—´ååˆ°æ–°å‘é‡ã€‚é‚£ä¹ˆåˆ†å‰²è¶…å¹³é¢å¯ä»¥è¡¨ç¤ºä¸º: \\(f(x) = w\\phi(x)+b\\) å¯¹äºéçº¿æ€§ SVM çš„å¯¹å¶é—®é¢˜å°±å˜æˆäº†ï¼š åŒºåˆ«å°±åœ¨äºä¼˜åŒ–ç›®æ ‡ä¸­çš„å†…ç§¯ã€‚ ","date":"2021-09-20","objectID":"/svm/:4:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ ¸å‡½æ•° æˆ‘ä»¬ä¸ç¦æœ‰ä¸ªç–‘é—®ï¼šåªæ˜¯åšä¸ªå†…ç§¯è¿ç®—ï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ ¸å‡½æ•°çš„å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºä½ç»´ç©ºé—´æ˜ å°„åˆ°é«˜ç»´ç©ºé—´åç»´åº¦å¯èƒ½ä¼šå¾ˆå¤§ï¼Œå¦‚æœå°†å…¨éƒ¨æ ·æœ¬çš„ç‚¹ä¹˜å…¨éƒ¨è®¡ç®—å¥½ï¼Œè¿™æ ·çš„è®¡ç®—é‡å¤ªå¤§äº†ã€‚ ä½†å¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€æ ¸å‡½æ•°\\(k(x,y) = (\\phi(x), \\phi(y))\\)ï¼Œxä¸yåœ¨ç‰¹å¾ç©ºé—´ä¸­çš„å†…ç§¯ï¼Œå°±ç­‰äºå®ƒä»¬åœ¨åŸå§‹ç©ºé—´ä¸­é€šè¿‡å‡½æ•°\\(k(x,y)\\)è®¡ç®—çš„ç»“æœï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦çŸ¥é“æ˜ å°„å‡½æ•°å’Œè®¡ç®—é«˜ç»´ç©ºé—´ä¸­çš„å†…ç§¯äº†ã€‚ æœ‰å…³å†…å®¹çœ‹æœ¬æ–‡ä¸€å¼€å§‹å¯¹kernelçš„ä»‹ç»ã€‚ ","date":"2021-09-20","objectID":"/svm/:4:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"æ€»ç»“ SVMæ˜¯æ·±åº¦å­¦ä¹ æµè¡Œä¹‹å‰çš„é¦–é€‰åˆ†ç±»æ–¹æ³•ï¼Œåœ¨è®¸å¤šä»»åŠ¡ä¸Šéƒ½æœ‰å¾ˆå¥½çš„æ•ˆæœï¼Œç¨å¾®ä¿®æ”¹åå¯ä»¥ç”¨äºå›å½’ä»»åŠ¡ä¸­ã€‚æ€»ç»“ä¸€ä¸‹svmç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€‚ ","date":"2021-09-20","objectID":"/svm/:5:0","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ä¼˜ç‚¹ æœ‰ä¸¥æ ¼çš„æ•°å­¦ç†è®ºæ”¯æŒï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œä¸ä¾é ç»Ÿè®¡æ–¹æ³•ï¼Œä»è€Œç®€åŒ–äº†é€šå¸¸çš„åˆ†ç±»å’Œå›å½’é—®é¢˜ï¼› èƒ½æ‰¾å‡ºå¯¹ä»»åŠ¡è‡³å…³é‡è¦çš„å…³é”®æ ·æœ¬ï¼ˆå³ï¼šæ”¯æŒå‘é‡ï¼‰ï¼› é‡‡ç”¨æ ¸æŠ€å·§ä¹‹åï¼Œå¯ä»¥å¤„ç†éçº¿æ€§åˆ†ç±»/å›å½’ä»»åŠ¡ï¼› æœ€ç»ˆå†³ç­–å‡½æ•°åªç”±å°‘æ•°çš„æ”¯æŒå‘é‡æ‰€ç¡®å®šï¼Œè®¡ç®—çš„å¤æ‚æ€§å–å†³äºæ”¯æŒå‘é‡çš„æ•°ç›®ï¼Œè€Œä¸æ˜¯æ ·æœ¬ç©ºé—´çš„ç»´æ•°ï¼Œè¿™åœ¨æŸç§æ„ä¹‰ä¸Šé¿å…äº†â€œç»´æ•°ç¾éš¾â€ã€‚ ","date":"2021-09-20","objectID":"/svm/:5:1","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["Machine Learning","åˆ†ç±»ç®—æ³•"],"content":"ç¼ºç‚¹ è®­ç»ƒæ—¶é—´é•¿ã€‚å½“é‡‡ç”¨ SMO ç®—æ³•æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦æŒ‘é€‰ä¸€å¯¹å‚æ•° å½“é‡‡ç”¨æ ¸æŠ€å·§æ—¶ï¼Œå¦‚æœéœ€è¦å­˜å‚¨æ ¸çŸ©é˜µï¼Œåˆ™ç©ºé—´å¤æ‚åº¦ä¸º\\(O(N^2)\\) æ¨¡å‹é¢„æµ‹æ—¶ï¼Œé¢„æµ‹æ—¶é—´ä¸æ”¯æŒå‘é‡çš„ä¸ªæ•°æˆæ­£æ¯”ã€‚å½“æ”¯æŒå‘é‡çš„æ•°é‡è¾ƒå¤§æ—¶ï¼Œé¢„æµ‹è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ã€‚ ## å‚è€ƒ https://zhuanlan.zhihu.com/p/77750026 ","date":"2021-09-20","objectID":"/svm/:5:2","tags":["Machine Learning","åˆ†ç±»ç®—æ³•","SVM"],"title":"SVM","uri":"/svm/"},{"categories":["ç®—æ³•é¢˜"],"content":"å­—ç¬¦ä¸²çš„æ’åˆ— ","date":"2021-09-18","objectID":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/:0:0","tags":["ç®—æ³•é¢˜","å­—ç¬¦ä¸²çš„æ’åˆ—"],"title":"å­—ç¬¦ä¸²çš„æ’åˆ—","uri":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/permutation-in-string/ ","date":"2021-09-18","objectID":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/:1:0","tags":["ç®—æ³•é¢˜","å­—ç¬¦ä¸²çš„æ’åˆ—"],"title":"å­—ç¬¦ä¸²çš„æ’åˆ—","uri":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š æ»‘åŠ¨çª—å£åŠ å­—å…¸ ","date":"2021-09-18","objectID":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/:2:0","tags":["ç®—æ³•é¢˜","å­—ç¬¦ä¸²çš„æ’åˆ—"],"title":"å­—ç¬¦ä¸²çš„æ’åˆ—","uri":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution(object): def checkInclusion(self, s1, s2): counter1 = collections.Counter(s1) N = len(s2) left = 0 right = len(s1) - 1 counter2 = collections.Counter(s2[0:right]) while right \u003c N: counter2[s2[right]] += 1 if counter1 == counter2: return True counter2[s2[left]] -= 1 if counter2[s2[left]] == 0: del counter2[s2[left]] left += 1 right += 1 return False ","date":"2021-09-18","objectID":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/:3:0","tags":["ç®—æ³•é¢˜","å­—ç¬¦ä¸²çš„æ’åˆ—"],"title":"å­—ç¬¦ä¸²çš„æ’åˆ—","uri":"/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97/"},{"categories":["pandas","api"],"content":"ç±»ä¼¼äºpandasçš„applyï¼Œå°±æ˜¯åœ¨æŸä¸€ç»´ä¸Šè¿›è¡Œå®šä¹‰çš„å‡½æ•°æ“ä½œ apply_along_axis(func1d, axis, arr, *args, **kwargs) å®˜ç½‘çš„ä¾‹å­ def my_func(a): return (a[0] + a[-1]) * 0.5 b = np.array([[1,2,3], [4,5,6], [7,8,9]]) np.apply_along_axis(my_func, 0, b) # ç»“æœ array([ 4., 5., 6.]) # ç»“æœ array([ 2., 5., 8.]) ","date":"2021-09-03","objectID":"/apply_along_axis/:0:0","tags":["pandas","api","apply_along_axis"],"title":"apply_along_axis","uri":"/apply_along_axis/"},{"categories":["ç®—æ³•é¢˜"],"content":"é‡‡è´­æ–¹æ¡ˆ ","date":"2021-08-30","objectID":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/:0:0","tags":["ç®—æ³•é¢˜","é‡‡è´­æ–¹æ¡ˆ"],"title":"é‡‡è´­æ–¹æ¡ˆ","uri":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/4xy4Wx/ ","date":"2021-08-30","objectID":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/:1:0","tags":["ç®—æ³•é¢˜","é‡‡è´­æ–¹æ¡ˆ"],"title":"é‡‡è´­æ–¹æ¡ˆ","uri":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š é¢˜ç›®å¾ˆç®€å•ï¼Œæ€æƒ³å°±æ˜¯åŒæŒ‡é’ˆï¼Œæ„Ÿè§‰æ˜¯ä¸ªåŒæŒ‡é’ˆçš„å…¸å‹ä¾‹å­å°±å†™äº†ä¸‹æ¥ å…ˆå¯¹æ•°ç»„è¿›è¡Œä»å°åˆ°å¤§æ’åºï¼Œç„¶ååŒæŒ‡é’ˆä»ä¸¤è¾¹ç§»åŠ¨ï¼Œå¦‚æœä¸€ç›´å¤§äºtargetå°±ä¸€ç›´å·¦ç§»right ç„¶åright - leftå°±æ˜¯æ‰€æœ‰æˆç«‹çš„æ•°ç›®ï¼Œå†ç§»åŠ¨left è¿›è¡Œç­›é€‰ ","date":"2021-08-30","objectID":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/:2:0","tags":["ç®—æ³•é¢˜","é‡‡è´­æ–¹æ¡ˆ"],"title":"é‡‡è´­æ–¹æ¡ˆ","uri":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def purchasePlans(self, nums: List[int], target: int) -\u003e int: nums.sort() left = 0 right = len(nums) - 1 res = 0 while left \u003c right and left \u003c len(nums): while left \u003c right and nums[right] + nums[left] \u003e target: right -= 1 res += right - left left += 1 return res % (1000000007) ","date":"2021-08-30","objectID":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/:3:0","tags":["ç®—æ³•é¢˜","é‡‡è´­æ–¹æ¡ˆ"],"title":"é‡‡è´­æ–¹æ¡ˆ","uri":"/%E9%87%87%E8%B4%AD%E6%96%B9%E6%A1%88/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä½è¿ç®—çš„ä¸€ä¸ªåº”ç”¨ ç¿»äº†ç¿»ä»¥å‰ç”¨pythonåˆ·leetcodeçš„è®°å½•ï¼Œæœ€ååˆ·çš„ä¸€é“é¢˜æ˜¯è¿™æ ·çš„ https://leetcode-cn.com/problems/single-number/ å«åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œå½“æ—¶çœ‹é¢˜æ„Ÿè§‰éå¸¸ç®€å•å•Šï¼ç›´æ¥æå°±è¡Œäº† å½“æ—¶ä¸€å¼€å§‹æˆ‘çš„åšæ³•æ˜¯è¿™æ ·çš„ class Solution: def singleNumber(self, nums): for i in set(nums): if nums.count(i) ==1: return i ä¿¡å¿ƒæ»¡æ»¡çš„æäº¤ï¼Œç»“æœå‘ç°TLEäº†ã€‚ã€‚ ç„¶åçœ‹è¶…æ—¶æ¡ˆä¾‹çš„è¾“å…¥ï¼Œæ²¡æœ‰ä¸€ä¸ªæ•°å­—é‡å¤ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘çš„setè·Ÿæ²¡æœ‰ä¸€æ ·ï¼Œæ‰€ä»¥è¯´è‚¯å®šä¸èƒ½è¿™ä¹ˆåšã€‚ ç„¶ååˆæƒ³åˆ°äº†å“ˆå¸Œè¡¨ class Solution: def singleNumber(self, nums): dic={} for num in nums: if num in dic.keys(): dic[num]+=1 else: dic[num]=1 for i in dic.keys(): if dic[i] ==1: return i è¿™æ ·ä¹Ÿç®—æ˜¯ACäº†ã€‚æœ¬ä»¥ä¸ºè¿™ä¸ªé¢˜å°±è¿™ä¹ˆç»“æŸäº†ï¼Œç»“æœæ— æ„ä¸­çœ‹åˆ°äº†åˆ«çš„é¢˜è§£éœ‡æƒŠäº† ä»£ç æ•°é‡æ¯”æˆ‘çŸ­çš„å¤šå¾—å¤šã€‚ ç„¶åå°±è®¤è¯†åˆ°äº†ä½è¿ç®—çš„é­”åŠ›ã€‚ã€‚ å…ˆä¸Šä»£ç ï¼š class Solution: def singleNumber(self, nums): a = 0 for i in nums: a^=i return a ç®€å•çš„ä¸€ä¸ªå¼‚æˆ–è¿ç®—å°±è¾¾åˆ°äº†ç›®çš„ çœŸæ˜¯å¤ªç¥å¥‡äº†ï¼ æ‰¾åˆ°ç›¸å…³èµ„æ–™ äº¤æ¢å¾‹ï¼ša ^ b ^ c \u003c=\u003e a ^ c ^ b ä»»ä½•æ•°äº0å¼‚æˆ–ä¸ºä»»ä½•æ•° 0 ^ n =\u003e n ç›¸åŒçš„æ•°å¼‚æˆ–ä¸º0: n ^ n =\u003e 0 ä¹Ÿå°±æ˜¯è¯´ç›¸åŒçš„æ•°å°±å¼‚æˆ–ä¸º0äº†ï¼Œè¾¾åˆ°äº†å»é‡çš„ç›®çš„ã€‚ ","date":"2021-08-23","objectID":"/%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/:0:0","tags":["ç®—æ³•é¢˜","åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"],"title":"åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","uri":"/%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/"},{"categories":["NLP","æ¦‚ç‡å›¾æ¨¡å‹"],"content":"æ¦‚ç‡å›¾æ¨¡å‹æ¦‚è¿° ","date":"2021-08-13","objectID":"/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0/:0:0","tags":["NLP","æ¦‚ç‡å›¾æ¨¡å‹","æ¦‚ç‡å›¾æ¨¡å‹æ¦‚è¿°"],"title":"æ¦‚ç‡å›¾æ¨¡å‹æ¦‚è¿°","uri":"/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0/"},{"categories":["é¢ç»"],"content":"Bæ ‘ Bæ ‘å°±æ˜¯B-æ ‘ï¼Œä»¥å‰è¿˜ä»¥ä¸ºè¿™æ˜¯ä¸¤ç§æ ‘ï¼Œç°åœ¨æ‰çŸ¥é“è¿™ä¿©å°±æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚ ","date":"2021-08-07","objectID":"/b%E6%A0%91/:0:0","tags":["é¢ç»","Bæ ‘"],"title":"Bæ ‘","uri":"/b%E6%A0%91/"},{"categories":["é¢ç»"],"content":"åŸºæœ¬æ¦‚å¿µ æ‰€æœ‰çš„å¶å­ç»“ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚ä¸Šï¼Œå¹¶ä¸”ä¸å¸¦ä¿¡æ¯(å¯ä»¥çœ‹åšæ˜¯å¤–éƒ¨ç»“ç‚¹æˆ–æŸ¥æ‰¾å¤±è´¥çš„ç»“ç‚¹ï¼Œå®é™…ä¸Šè¿™äº›ç»“ç‚¹ä¸å­˜åœ¨ï¼ŒæŒ‡å‘è¿™äº›ç»“ç‚¹çš„æŒ‡é’ˆä¸ºç©º)ã€‚ æ¯ä¸ªç»“ç‚¹åŒ…å«çš„å…³é”®å­—ä¸ªæ•°æœ‰ä¸Šç•Œå’Œä¸‹ç•Œã€‚ç”¨ä¸€ä¸ªè¢«ç§°ä¸º B-æ ‘çš„Â æœ€å°åº¦æ•°Â çš„å›ºå®šæ•´æ•°Â tâ‰¥2Â æ¥è¡¨ç¤ºè¿™äº›ç•Œ ï¼Œå…¶ä¸­Â tÂ å–å†³äºç£ç›˜å—çš„å¤§å°ï¼š a.é™¤æ ¹ç»“ç‚¹ä»¥å¤–çš„æ¯ä¸ªç»“ç‚¹å¿…é¡»è‡³å°‘æœ‰Â tâˆ’1Â ä¸ªå…³é”®å­—ã€‚å› æ­¤ï¼Œé™¤äº†æ ¹ç»“ç‚¹ä»¥å¤–çš„æ¯ä¸ªå†…éƒ¨ç»“ç‚¹æœ‰ t ä¸ªå­©å­ã€‚å¦‚æœæ ‘éç©ºï¼Œæ ¹ç»“ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªå…³é”®å­—ã€‚ æ¯ä¸ªç»“ç‚¹è‡³å¤šåŒ…å«Â 2tâˆ’1Â ä¸ªå…³é”®å­—ã€‚ ä¸€ä¸ªåŒ…å«xä¸ªå…³é”®å­—çš„ç»“ç‚¹æœ‰x+1ä¸ªå­©å­ã€‚ ä¸€ä¸ªç»“ç‚¹ä¸­æ‰€æœ‰çš„å…³é”®å­—å‡åºæ’åˆ—ï¼Œä¸¤ä¸ªå…³é”®å­—\\(k_1\\)å’Œ\\(k_2\\)ä¹‹é—´çš„å­©å­ç»“ç‚¹çš„æ‰€æœ‰å…³é”®å­—keyåœ¨\\((k_1, k_2)\\)çš„èŒƒå›´å†…ã€‚ å…¶ä¸­æœ€å°åº¦æ•°å’ŒBæ ‘çš„é˜¶ä¸ä¸€æ ·ï¼š åº¦ï¼šä¸€ä¸ªç»“ç‚¹å«æœ‰çš„å­ç»“ç‚¹çš„ä¸ªæ•°ç§°ä¸ºè¯¥ç»“ç‚¹çš„åº¦ é˜¶ï¼šä¸€æ£µæ ‘çš„æœ€å¤§å­©å­æ•° æœ€å°åº¦minimum degreeï¼ˆtï¼‰ï¼šç”¨æ¥è¡¡é‡ç»“ç‚¹çš„å…³é”®å­—æ•°é‡èŒƒå›´ é˜¶ orderï¼ˆmï¼‰ï¼šè¡¡é‡Bæ ‘ä¸­çš„ç»“ç‚¹çš„æœ€å¤§å­©å­æ•° å…³ç³»å¦‚ä¸‹ï¼š \\[ t = ceil(\\frac{m}{2}) \\quad m = 2t \\] å¯ä»¥ç®€å•ç†è§£ä¸ºæœ€å°åº¦æ˜¯å­©å­æ•°çš„æœ€å°å€¼ï¼Œé˜¶æ˜¯å­©å­æ•°çš„æœ€å¤§å€¼ã€‚æœ€å°åº¦-1æ˜¯èŠ‚ç‚¹å…³é”®å­—æ•°çš„æœ€å°å€¼ï¼Œé˜¶-1æ˜¯èŠ‚ç‚¹å…³é”®å­—æ•°çš„æœ€å¤§å€¼ã€‚ ","date":"2021-08-07","objectID":"/b%E6%A0%91/:1:0","tags":["é¢ç»","Bæ ‘"],"title":"Bæ ‘","uri":"/b%E6%A0%91/"},{"categories":["é¢ç»"],"content":"æŸ¥æ‰¾ æŸ¥æ‰¾å¾ˆç®€å•ï¼Œå¯¹æ¯ä¸ªé”®ä¸­çš„ç´¢å¼•è¿›è¡Œæ¯”è¾ƒç„¶åæŸ¥æ‰¾å°±å¯ä»¥ã€‚ ","date":"2021-08-07","objectID":"/b%E6%A0%91/:2:0","tags":["é¢ç»","Bæ ‘"],"title":"Bæ ‘","uri":"/b%E6%A0%91/"},{"categories":["é¢ç»"],"content":"æ’å…¥ ä¼ªä»£ç ï¼š åˆå§‹åŒ–Â xÂ ä½œä¸ºæ ¹ç»“ç‚¹ å½“Â xÂ ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š æ‰¾åˆ°Â xÂ çš„ä¸‹ä¸€ä¸ªè¦è¢«è®¿é—®çš„å­©å­ç»“ç‚¹Â y å¦‚æœÂ yÂ æ²¡æœ‰æ»¡ï¼Œåˆ™å°†ç»“ç‚¹Â yÂ ä½œä¸ºæ–°çš„Â x å¦‚æœÂ yÂ å·²ç»æ»¡äº†ï¼Œæ‹†åˆ†Â yÂ ï¼Œç»“ç‚¹Â xÂ çš„æŒ‡é’ˆæŒ‡å‘ç»“ç‚¹Â yÂ çš„ä¸¤éƒ¨åˆ†ã€‚ å¦‚æœÂ kÂ æ¯”Â yÂ ä¸­é—´çš„å…³é”®å­—å°ï¼Œ åˆ™å°†Â yÂ çš„ç¬¬ä¸€éƒ¨åˆ†ä½œä¸ºæ–°çš„Â xÂ ï¼Œå¦åˆ™å°†Â yÂ çš„ç¬¬äºŒéƒ¨åˆ†ä½œä¸ºæ–°çš„Â xÂ ï¼Œå½“å°†Â yÂ æ‹†åˆ†åï¼Œå°†Â yÂ ä¸­çš„ä¸€ä¸ªå…³é”®å­—ç§»åŠ¨åˆ°å®ƒçš„çˆ¶ç»“ç‚¹Â xÂ å½“ä¸­ã€‚ å½“Â xÂ æ˜¯å¶å­ç»“ç‚¹æ—¶ï¼Œç¬¬äºŒæ­¥ç»“æŸï¼› ç”±äºæˆ‘ä»¬å·²ç»æå‰æŸ¥åˆ†äº†æ‰€æœ‰ç»“ç‚¹ï¼ŒxÂ å¿…å®šè‡³å°‘æœ‰ä¸€ä¸ªé¢å¤–çš„å…³é”®å­—ç©ºé—´ï¼Œè¿›è¡Œç®€å•çš„æ’å…¥å³å¯ã€‚ ","date":"2021-08-07","objectID":"/b%E6%A0%91/:3:0","tags":["é¢ç»","Bæ ‘"],"title":"Bæ ‘","uri":"/b%E6%A0%91/"},{"categories":["é¢ç»"],"content":"åˆ é™¤ å¾…åˆ é™¤çš„å…³é”®å­— k åœ¨ç»“ç‚¹ x ä¸­ï¼Œä¸” x æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ é™¤å…³é”®å­—k å¾…åˆ é™¤çš„å…³é”®å­— k åœ¨ç»“ç‚¹ x ä¸­ï¼Œä¸” x æ˜¯å†…éƒ¨ç»“ç‚¹ï¼Œåˆ†ä¸€ä¸‹ä¸‰ç§æƒ…å†µ 1). å¦‚æœä½äºç»“ç‚¹ x ä¸­çš„å…³é”®å­— k ä¹‹å‰çš„ç¬¬ä¸€ä¸ªå­©å­ç»“ç‚¹ y è‡³å°‘æœ‰ t ä¸ªå…³é”®å­—ï¼Œåˆ™åœ¨å­©å­ç»“ç‚¹ y ä¸­æ‰¾åˆ° k çš„å‰é©±ç»“ç‚¹Â k0Â ï¼Œé€’å½’åœ°åˆ é™¤å…³é”®å­—Â k0Â ï¼Œå¹¶å°†ç»“ç‚¹ x ä¸­çš„å…³é”®å­— k æ›¿æ¢ä¸ºÂ k0 ç›´æ¥å‰é©±ï¼šå½“å‰å…³é”®å­—å·¦ä¾§æŒ‡é’ˆ æ‰€æŒ‡å­æ ‘ä¸­â€œæœ€å³ä¸‹â€çš„å…ƒç´  åˆ é™¤ B-æ ‘ä¸­çš„å…³é”®å­—Â GÂ ï¼ŒGÂ çš„å‰ä¸€ä¸ªå­©å­ç»“ç‚¹Â yÂ ä¸ºÂ [Dã€Eã€F]Â ï¼ŒåŒ…å« 3ä¸ªå…³é”®å­—ï¼Œæ»¡è¶³æƒ…å†µä¸€ï¼Œå…³é”®å­—Â GÂ çš„ç›´æ¥å‰é©±ä¸ºå…³é”®Â FÂ ï¼Œåˆ é™¤Â FÂ ï¼Œç„¶åå°†Â GÂ æ›¿æ¢ä¸ºÂ FÂ . 2).y æ‰€åŒ…å«çš„å…³é”®å­—å°‘äº t ä¸ªå…³é”®å­—ï¼Œåˆ™æ£€æŸ¥ç»“ç‚¹ x ä¸­å…³é”®å­— k çš„åä¸€ä¸ªå­©å­ç»“ç‚¹ z åŒ…å«çš„å…³é”®å­—çš„ä¸ªæ•°ï¼Œå¦‚æœ z åŒ…å«çš„å…³é”®å­—çš„ä¸ªæ•°è‡³å°‘ä¸º t ä¸ªï¼Œåˆ™åœ¨ z ä¸­æ‰¾åˆ°å…³é”®å­— k çš„ç›´æ¥åç»§Â K0Â ,ç„¶ååˆ é™¤Â K0Â ï¼Œå¹¶å°†å…³é”® k æ›¿æ¢ä¸ºÂ K0Â . ç›´æ¥åç»§ï¼šå½“å‰å…³é”®å­—å³ä¾§æŒ‡é’ˆ æ‰€æŒ‡å­æ ‘ä¸­â€œæœ€å·¦ä¸‹â€çš„å…ƒç´  åˆ é™¤ B-æ ‘ä¸­çš„å…³é”®å­—Â CÂ ,Â yÂ ä¸­åŒ…å«çš„å…³é”®å­—çš„ä¸ªæ•°ä¸º 2 ä¸ªï¼Œå°äºÂ t = 3Â ,ç»“ç‚¹Â [Cã€Gã€L]Â ä¸­çš„ å…³é”®å­—Â CÂ çš„åä¸€ä¸ªå­©å­ z ä¸ºÂ [Dã€Eã€F]Â åŒ…å« 3 ä¸ªå…³é”®å­—ï¼Œå…³é”®å­—Â CÂ çš„ç›´æ¥åç»§ä¸ºÂ DÂ ï¼Œåˆ é™¤Â DÂ ï¼Œç„¶åå°†Â CÂ æ›¿æ¢ä¸ºÂ DÂ . 3). å¦‚æœ y å’Œ z éƒ½åªåŒ…å« t -1 ä¸ªå…³é”®å­—ï¼Œåˆå¹¶å…³é”®å­— k å’Œæ‰€æœ‰ z ä¸­çš„å…³é”®å­—åˆ° ç»“ç‚¹ y ä¸­ï¼Œç»“ç‚¹ x å°†å¤±å»å…³é”®å­— k å’Œå­©å­ç»“ç‚¹ zï¼Œy æ­¤æ—¶åŒ…å« 2t -1 ä¸ªå…³é”®å­—ï¼Œé‡Šæ”¾ç»“ç‚¹ z çš„ç©ºé—´å¹¶é€’å½’åœ°ä»ç»“ç‚¹ y ä¸­åˆ é™¤å…³é”®å­— k. åˆ é™¤å…³é”®å­—Â CÂ , ç»“ç‚¹ y åŒ…å« 2 ä¸ªå…³é”®å­— ï¼Œç»“ç‚¹ z åŒ…å« 2 ä¸ªå…³é”®å­—ï¼Œå‡ç­‰äºÂ t - 1 = 2Â ä¸ªï¼Œ åˆå¹¶å…³é”®å­—Â CÂ å’Œç»“ç‚¹ z ä¸­çš„æ‰€æœ‰å…³é”®å­—åˆ°ç»“ç‚¹Â yÂ å½“ä¸­ï¼š ä¹‹åç›´æ¥åˆ é™¤Cå³å¯ã€‚ å¦‚æœå…³é”®å­— k ä¸åœ¨å½“å‰åœ¨å†…éƒ¨ç»“ç‚¹ x ä¸­ï¼Œåˆ™ç¡®å®šå¿…åŒ…å« k çš„å­æ ‘çš„æ ¹ç»“ç‚¹Â x.c(i)Â ï¼ˆå¦‚æœ k ç¡®å®åœ¨ B-æ ‘ä¸­ï¼‰ã€‚å¦‚æœÂ x.c(i)Â åªæœ‰ t - 1 ä¸ªå…³é”®å­—ï¼Œå¿…é¡»æ‰§è¡Œä¸‹é¢ä¸¤ç§æƒ…å†µè¿›è¡Œå¤„ç†ï¼š é¦–å…ˆæˆ‘ä»¬å¾—ç¡®è®¤ä»€ä¹ˆæ˜¯å½“å‰å†…éƒ¨ç»“ç‚¹ x ï¼Œä»€ä¹ˆæ˜¯Â x.c(i)Â ,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ P ç°åœ¨ä¸æ˜¯æ ¹ç»“ç‚¹ï¼Œè€Œæ˜¯å®Œæ•´ B-æ ‘çš„ä¸€ä¸ªå­æ ‘çš„æ ¹ç»“ç‚¹ï¼š 1). x.c(i)Â ä»…åŒ…å« t - 1 ä¸ªå…³é”®å­—ä¸”Â x.c(i)Â çš„ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹åŒ…å«è‡³å°‘ t ä¸ªå…³é”®å­—ï¼Œåˆ™å°† x çš„æŸä¸€ä¸ªå…³é”®å­—ä¸‹ç§»åˆ°Â x.c(i)Â ä¸­ï¼Œå°†Â x.c(i)Â çš„ç›¸é‚»çš„å·¦å…„å¼Ÿæˆ–å³å…„å¼Ÿç»“ç‚¹ä¸­çš„ä¸€ä¸ªå…³é”®å­—ä¸Šç§»åˆ° x å½“ä¸­ï¼Œå°†è¯¥å…„å¼Ÿç»“ç‚¹ä¸­ç›¸åº”çš„å­©å­æŒ‡é’ˆç§»åˆ°Â x.c(i)Â ä¸­ï¼Œä½¿å¾—Â x.c(i)Â å¢åŠ ä¸€ä¸ªé¢å¤–çš„å…³é”®å­—ã€‚ æˆ‘ä»¬ä»¥åˆ é™¤ç»“ç‚¹Â [Aã€B]Â ä¸­çš„ç»“ç‚¹Â BÂ ä¸ºä¾‹ï¼Œä¸Šå›¾ä¸­Â x.c(i)Â åŒ…å« 2 ä¸ªå…³é”®å­—ï¼Œå³ t - 1 ä¸ªå…³é”®å­—ï¼ŒÂ x.c(i)Â çš„ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹Â [Hã€Jã€K]Â åŒ…å« 3 ä¸ªå…³é”®å­—ï¼ˆæ»¡è¶³è‡³å°‘ t ä¸ªå…³é”®å­—çš„è¦æ±‚ï¼‰ï¼Œåˆ™å°†å…„å¼Ÿç»“ç‚¹Â [Hã€Jã€K]Â ä¸­çš„å…³é”®å­—Â HÂ å‘ä¸Šç§»åŠ¨åˆ°Â xÂ ä¸­ï¼Œ å°† x ä¸­çš„å…³é”®å­—Â CÂ ä¸‹ç§»åˆ°Â x.c(i)Â ä¸­ï¼›åˆ é™¤å…³é”®å­—Â BÂ . 2).å¦‚æœÂ x.c(i)Â åŠÂ x.c(i)Â çš„æ‰€æœ‰ç›¸é‚»å…„å¼Ÿéƒ½åªåŒ…å« t - 1 ä¸ªå…³é”®å­—ï¼Œåˆ™å°†Â x.c(i)Â ä¸ ä¸€ä¸ªå…„å¼Ÿåˆå¹¶ï¼Œå³å°† x çš„ä¸€ä¸ªå…³é”®å­—ç§»åŠ¨è‡³æ–°åˆå¹¶çš„ç»“ç‚¹ï¼Œä½¿ä¹‹æˆä¸ºè¯¥ç»“ç‚¹çš„ä¸­é—´å…³é”®å­—ï¼Œå°†åˆå¹¶åçš„ç»“ç‚¹ä½œä¸ºæ–°çš„ x ç»“ç‚¹ . ä»¥æ­¤å›¾ä¸ºä¾‹ï¼š ä¸Šé¢çš„å›¾æ ‡æ˜äº†ç›¸åº”çš„ x åŠÂ x.c(i)Â ï¼Œæˆ‘ä»¬ä»¥åˆ é™¤å…³é”®å­—Â DÂ ä¸ºä¾‹ï¼Œæ­¤æ—¶å½“å‰å†…éƒ¨ç»“ç‚¹ x ä¸åŒ…å«å…³é”®å­—Â DÂ , ç¡®å®šæ˜¯ç¬¬ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤å…³é”®Â DÂ ä¸€å®šåœ¨ç»“ç‚¹ x çš„ç¬¬ä¸€ä¸ªå­©å­ç»“ç‚¹æ‰€åœ¨çš„å­æ ‘ä¸­ï¼Œç»“ç‚¹ x çš„ç¬¬ä¸€ä¸ªå­©å­ç»“ç‚¹æ‰€åœ¨å­æ ‘çš„è·Ÿç»“ç‚¹ä¸ºÂ x.c(i) å³ [Cã€L]Â . å…¶ä¸­Â ç»“ç‚¹ [Cã€L]Â åŠå…¶ç›¸é‚»çš„å…„å¼Ÿç»“ç‚¹Â [Tã€W]Â éƒ½åªåŒ…å« 2 ä¸ªç»“ç‚¹ï¼ˆå³Â t - 1) ï¼Œåˆ™å°†Â [Cã€L]Â ä¸Â [Tã€W]Â åˆå¹¶ï¼Œå¹¶å°†ç»“ç‚¹ x å½“ä¸­ä»…æœ‰çš„å…³é”®å­—Â PÂ åˆå¹¶åˆ°æ–°ç»“ç‚¹ä¸­ï¼›ç„¶åå°†åˆå¹¶åçš„ç»“ç‚¹ä½œä¸ºæ–°çš„ x ç»“ç‚¹ï¼Œé€’å½’åˆ é™¤å…³é”®å­—Â DÂ ï¼Œå‘ç°D æ­¤æ—¶åœ¨å¶å­ç»“ç‚¹ y ä¸­ï¼Œç›´æ¥åˆ é™¤ï¼Œå°±æ˜¯Â 1.Â çš„æƒ…å†µã€‚ ","date":"2021-08-07","objectID":"/b%E6%A0%91/:4:0","tags":["é¢ç»","Bæ ‘"],"title":"Bæ ‘","uri":"/b%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ— ","date":"2021-08-06","objectID":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/:0:0","tags":["ç®—æ³•é¢˜","å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"],"title":"å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","uri":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®: https://leetcode-cn.com/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/ ","date":"2021-08-06","objectID":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/:1:0","tags":["ç®—æ³•é¢˜","å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"],"title":"å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","uri":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š æ»‘åŠ¨çª—å£å³å¯ï¼Œæ»‘åŠ¨çª—å£å°±æ˜¯é€‰å–æ•°ç»„çš„ä¸€éƒ¨åˆ†æ¥è¿›è¡Œæ“ä½œï¼Œleft å’Œ rightåªèƒ½å‘å³ç§»åŠ¨ ","date":"2021-08-06","objectID":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/:2:0","tags":["ç®—æ³•é¢˜","å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"],"title":"å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","uri":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def findContinuousSequence(self, target: int) -\u003e List[List[int]]: res = [] left,right = 1,2 while left \u003c= target // 2: # ä¼˜åŒ– å‡å°‘æ—¶é—´å¤æ‚åº¦ if sum(range(left,right+1)) \u003c target: # å°äºtarget å³æŒ‡é’ˆç§»åŠ¨ right += 1 elif sum(range(left,right+1)) \u003e target: # å¤§äºtarget å·¦æŒ‡é’ˆç§»åŠ¨ left += 1 else: res.append(list(range(left,right+1))) # ç›¸ç­‰çš„è¯ ä¸¤ä¸ªæŒ‡é’ˆéƒ½ç§»åŠ¨ right += 1 left += 1 return res ","date":"2021-08-06","objectID":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/:3:0","tags":["ç®—æ³•é¢˜","å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"],"title":"å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","uri":"/%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆå¹¶åŒºé—´ ","date":"2021-08-03","objectID":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/:0:0","tags":["ç®—æ³•é¢˜","åˆå¹¶åŒºé—´"],"title":"åˆå¹¶åŒºé—´","uri":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š â€‹ https://leetcode-cn.com/problems/merge-intervals/ ","date":"2021-08-03","objectID":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/:1:0","tags":["ç®—æ³•é¢˜","åˆå¹¶åŒºé—´"],"title":"åˆå¹¶åŒºé—´","uri":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ ä¸€å¼€å§‹æ€è·¯æƒ³çš„æ˜¯ï¼Œæ ¹æ®æ¯ä¸€ä¸ªåŒºé—´çš„leftæ’åºåï¼Œç„¶åæ¯”è¾ƒæ¯ä¸€ä¸ªæ•°ï¼Œå†å‘å‰æ›´æ–°ï¼Œç„¶åå†™äº†åŠå¤©ï¼Œä¸€ç›´WAï¼Œæ„Ÿè§‰è¿™ä¸ªæ€è·¯ä¸å¤ªè¡Œäº† ","date":"2021-08-03","objectID":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/:2:0","tags":["ç®—æ³•é¢˜","åˆå¹¶åŒºé—´"],"title":"åˆå¹¶åŒºé—´","uri":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š â€‹ å…ˆè´´ä¸Šé”™è¯¯çš„ä»£ç ï¼š class Solution: def merge(self, res: List[List[int]]) -\u003e List[List[int]]: if not res: return [] res.sort(key=lambda i:i[0]) n = len(res) - 1 for i in range(0,n): if res[i][1] \u003c res[i+1][0]: continue else: res[i+1] = [res[i][0],max(res[i][1],res[i+1][1])] res[i] = res[i-1] ress = [] for i in res: if i not in ress: ress.append(i) return ress åœ¨[[1,4],[0,2],[3,5]] â€‹ å‡ºé”™äº† è¾“å‡ºï¼š [[3,5],[0,5]] é¢„æœŸç»“æœï¼š [[0,5]] åº”è¯¥æ˜¯æ€è·¯çš„é”™è¯¯ åæ¥è§‰å¾—ä¸åº”è¯¥åœ¨åŸæ•°ç»„ä¸Šæ“ä½œ åˆæ”¹äº†å¦‚ä¸‹ï¼Œç»ˆäºè¿‡äº† class Solution: def merge(self, intervals: List[List[int]]) -\u003e List[List[int]]: if not intervals: return [] intervals.sort(key=lambda i:i[0]) res = [] for i in intervals: if len(res) == 0 or res[-1][1] \u003c i[0]: res.append(i) else: res[-1][1] = max(res[-1][1],i[1]) return res è¿™ä¸ªæ€è·¯å°±æ˜¯å…ˆåˆ›é€ ä¸€ä¸ªç©ºæ•°ç»„res ç„¶åå¦‚æœæ•°ç»„ä¸ºç©ºæˆ–è€…é¢˜è®¾çš„æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™ï¼ŒæŠŠåŸæ•°ç»„çš„å€¼åŠ è¿›å»ï¼Œè¦æ˜¯æ¡ä»¶æˆç«‹çš„è¯ï¼Œåˆ™å°†ç›®å‰åŒºé—´çš„rightæ”¹ä¸ºç›®å‰åŒºé—´çš„rightå’ŒåŸæ•°ç»„çš„rightä¹‹é—´çš„æœ€å¤§å€¼ï¼Œé¢„é˜²[[1,4],[2,3]]è¿™ç§æƒ…å†µã€‚æ³¨æ„è¿™ä¸ªä¹Ÿæ˜¯æŒ‰leftæ’åºçš„ æˆ‘ä¸Šé¢ä»£ç çš„æ€è·¯å’Œè¿™ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œçœ‹æ¥ç±»ä¼¼çš„é¢˜ç›®å°½é‡ä¸è¦åœ¨åŸæ•°ç»„ä¸Šé¢æ“ä½œï¼Œé™¤éé¢˜ç›®è¦æ±‚ ","date":"2021-08-03","objectID":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/:3:0","tags":["ç®—æ³•é¢˜","åˆå¹¶åŒºé—´"],"title":"åˆå¹¶åŒºé—´","uri":"/%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"SVDå¥‡å¼‚å€¼åˆ†è§£ å‚è€ƒï¼šhttps://www.cnblogs.com/pinard/p/6251584.html ","date":"2021-07-16","objectID":"/svd/:0:0","tags":["Machine Learning","é™ç»´ç®—æ³•","SVD"],"title":"SVD","uri":"/svd/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡ é¦–å…ˆå›é¡¾ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡\\(Ax=\\lambda x\\) \\(\\lambda\\) æ˜¯çŸ©é˜µAçš„ä¸€ä¸ªç‰¹å¾å€¼ï¼Œxæ˜¯çŸ©é˜µAçš„ç‰¹å¾å€¼\\(\\lambda\\)å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚ æ±‚å‡ºç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡å¯ä»¥å°†çŸ©é˜µAè¿›è¡Œç‰¹å¾åˆ†è§£ã€‚å¦‚æœæ±‚å‡ºäº†Açš„nä¸ªç‰¹å¾å€¼ï¼Œä»¥åŠè¿™nä¸ªç‰¹å¾å€¼æ‰€å¯¹åº”çš„ç‰¹å¾å‘é‡\\({w_1,w_2,\\dots,w_n}\\)ï¼Œå¦‚æœè¿™nä¸ªç‰¹å¾å‘é‡çº¿æ€§æ— å…³ï¼Œåˆ™çŸ©é˜µAå°±å¯ä»¥ç”¨ä¸‹å¼è¿›è¡Œè¡¨ç¤ºï¼š \\[ A = W\\sum W^{-1} \\] å…¶ä¸­Wä¸ºè¿™nä¸ªç‰¹å¾å‘é‡æ‰€å¼ æˆçš„\\(n\\times n\\)ç»´çŸ©é˜µï¼Œ\\(\\sum\\)ä¸ºè¿™nä¸ªç‰¹å¾å€¼ä¸ºä¸»å¯¹è§’çº¿çš„çŸ©é˜µã€‚ æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠnä¸ªç‰¹å¾å‘é‡æ ‡å‡†åŒ–ï¼Œå³\\(w_i^Tw_i=1\\)ï¼Œæ­¤æ—¶Wçš„nä¸ªç‰¹å¾å‘é‡ä¸ºæ ‡å‡†æ­£äº¤åŸºï¼Œæ»¡è¶³\\(W^TW=I\\)ï¼Œå³\\(W^T=W^{-1}\\)ï¼Œä¹Ÿå°±æ˜¯è¯´Wä¸ºé…‰çŸ©é˜µã€‚ è¿™æ ·ç‰¹å¾åˆ†è§£è¡¨è¾¾å¼å¯ä»¥å†™ä¸º\\(A=W\\sum W^T\\) ç‰¹å¾åˆ†è§£è¦æ±‚Aå¿…é¡»ä¸ºæ–¹é˜µï¼Œå¦‚æœè¡Œåˆ—ä¸ç›¸åŒåˆ™ä½¿ç”¨SVDè¿›è¡Œåˆ†è§£ã€‚ ","date":"2021-07-16","objectID":"/svd/:1:0","tags":["Machine Learning","é™ç»´ç®—æ³•","SVD"],"title":"SVD","uri":"/svd/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"SVD å‡è®¾Aä¸ºä¸€ä¸ª\\(m\\times n\\)çš„çŸ©é˜µï¼Œé‚£ä¹ˆå®šä¹‰Açš„SVDä¸ºï¼š \\[ A = U\\sum V^T \\] å…¶ä¸­Uæ˜¯ä¸€ä¸ª\\(m\\times n\\)çš„çŸ©é˜µï¼Œ\\(\\sum\\)æ˜¯ä¸€ä¸ª\\(m\\times n\\)çš„çŸ©é˜µï¼Œé™¤äº†ä¸»å¯¹è§’çº¿ä¸Šçš„å…ƒç´ å…¨ä¸º0ï¼Œä¸»å¯¹è§’çº¿ä¸Šçš„æ¯ä¸ªå…ƒç´ æˆä¸ºå¥‡å¼‚å€¼ï¼ŒVæ˜¯ä¸€ä¸ª\\(n\\times n\\)çš„çŸ©é˜µï¼ŒUå’ŒVéƒ½æ˜¯é…‰çŸ©é˜µã€‚ å…ˆå¾—åˆ°\\(m\\times m\\)çš„æ–¹é˜µ\\(AA^T\\),ç„¶åè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œ\\((AA^T)u_i=\\lambda_iu_i\\) å°†\\(AA^T\\)çš„æ‰€æœ‰ç‰¹å¾å‘é‡å¼ æˆä¸€ä¸ª\\(m\\times m\\)çš„çŸ©é˜µUï¼Œå°±æ˜¯SVDå…¬å¼é‡Œé¢çš„UçŸ©é˜µäº†ã€‚ åå¾—åˆ°\\(n\\times n\\)çš„æ–¹é˜µ\\(A^TA\\),ç„¶åè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œ\\((A^TA)v_i=\\lambda_iv_i\\) å°†\\(A^TA\\)çš„æ‰€æœ‰ç‰¹å¾å‘é‡å¼ æˆä¸€ä¸ª\\(n\\times n\\)çš„çŸ©é˜µVï¼Œå°±æ˜¯SVDå…¬å¼é‡Œé¢çš„VçŸ©é˜µäº†ã€‚ ç‰¹å¾å€¼å’Œå¥‡å¼‚å€¼æ»¡è¶³ä»¥ä¸‹å…³ç³»\\(\\sigma_i = \\sqrt{\\lambda_i}\\)ï¼Œæ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚\\(A^TA\\)çš„ç‰¹å¾å€¼å–å¹³æ–¹æ ¹æ¥æ±‚å¥‡å¼‚å€¼ã€‚ ","date":"2021-07-16","objectID":"/svd/:2:0","tags":["Machine Learning","é™ç»´ç®—æ³•","SVD"],"title":"SVD","uri":"/svd/"},{"categories":["NLP"],"content":"è¯åµŒå…¥ ","date":"2021-07-16","objectID":"/word-embedding/:0:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"ä»‹ç» è¯åµŒå…¥æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­è¯­è¨€æ¨¡å‹ä¸è¡¨å¾å­¦ä¹ æŠ€æœ¯çš„ç»Ÿç§°ã€‚æ¦‚å¿µä¸Šè€Œè¨€ï¼Œå®ƒæ˜¯æŒ‡æŠŠä¸€ä¸ªç»´æ•°ä¸ºæ‰€æœ‰è¯çš„æ•°é‡çš„é«˜ç»´ç©ºé—´åµŒå…¥åˆ°ä¸€ä¸ªç»´æ•°ä½å¾—å¤šçš„è¿ç»­å‘é‡ç©ºé—´ä¸­ï¼Œæ¯ä¸ªå•è¯æˆ–è¯ç»„è¢«æ˜ å°„ä¸ºå®æ•°åŸŸä¸Šçš„å‘é‡ã€‚ è¯åµŒå…¥çš„æ–¹æ³•åŒ…æ‹¬äººå·¥ç¥ç»ç½‘ç»œã€å¯¹è¯è¯­åŒç°çŸ©é˜µé™ç»´ã€æ¦‚ç‡æ¨¡å‹ä»¥åŠå•è¯æ‰€åœ¨ä¸Šä¸‹æ–‡çš„æ˜¾å¼è¡¨ç¤ºç­‰ã€‚ åœ¨åº•å±‚è¾“å…¥ä¸­ï¼Œä½¿ç”¨è¯åµŒå…¥æ¥è¡¨ç¤ºè¯ç»„çš„æ–¹æ³•æå¤§æå‡äº†NLPä¸­è¯­æ³•åˆ†æå™¨å’Œæ–‡æœ¬æƒ…æ„Ÿåˆ†æç­‰çš„æ•ˆæœã€‚ ä»¥ä¸Šæ˜¯ç™¾åº¦ç™¾ç§‘ä¸­å¯¹è¯åµŒå…¥çš„å®šä¹‰ã€‚æœ¬æ–‡åªä»‹ç»ä¼ ç»Ÿçš„è¯å‘é‡ï¼Œä¹Ÿå°±æ˜¯å›ºå®šçš„è¯å‘é‡ã€‚deep contextualizedè¯å‘é‡æ¨¡å‹åœ¨æœ¬åšå®¢é¢„è®­ç»ƒæ¨¡å‹å†…å®¹é‡Œé¢ã€‚è¯åµŒå…¥ä¹Ÿå¯ä»¥ç§°ä¸ºè¯è¡¨å¾(word representation)ï¼Œå¯ä»¥ç²—ç•¥å¾—æŠŠå®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š ä¸€ã€ç‰¹å¾å·¥ç¨‹é˜¶æ®µï¼Œä»¥è¯è¢‹æ¨¡å‹ä¸ºå…¸å‹ä»£è¡¨ã€‚ äºŒã€æµ…å±‚è¡¨è¯é˜¶æ®µï¼Œä»¥word2vecä¸ºå…¸å‹ä»£è¡¨ã€‚ ä¸‰ã€æ·±å±‚è¡¨å¾é˜¶æ®µï¼Œä»¥åŸºäºtransformerçš„Bertä¸ºå…¸å‹ä»£è¡¨ã€‚ æœ¬æ–‡ä»‹ç»äº†ä¸€ã€äºŒä¸¤éƒ¨åˆ†å†…å®¹ ","date":"2021-07-16","objectID":"/word-embedding/:1:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"è¯­è¨€æ¨¡å‹ ä¸€å¥è¯ï¼Œè¯­è¨€æ¨¡å‹æ˜¯è¿™æ ·ä¸€ä¸ªæ¨¡å‹ï¼šå¯¹äºä»»æ„çš„è¯åºåˆ—ï¼Œå®ƒèƒ½å¤Ÿè®¡ç®—å‡ºè¿™ä¸ªåºåˆ—æ˜¯ä¸€å¥è¯çš„æ¦‚ç‡ã€‚ å…·ä½“çš„è¯¦è§æœ¬åšå®¢æœ‰å…³è¯­è¨€æ¨¡å‹çš„æ–‡ç« ã€‚ ä¸ºä»€ä¹ˆè¦ä»‹ç»è¯­è¨€æ¨¡å‹ï¼Œå› ä¸ºNLPçš„åšé¢„è®­ç»ƒä¸€èˆ¬é€‰æ‹©ç”¨è¯­è¨€æ¨¡å‹ä»»åŠ¡æ¥åšçš„ã€‚ è¯­è¨€æ¨¡å‹ä¸»è¦æœ‰ï¼š N-gram LMã€FeedForward Neural Network LMã€RNN LMå’ŒGPTç³»åˆ— æœ¬æ–‡ä¼šæ¶‰åŠåˆ°Neural Network LMï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªè¯­è¨€æ¨¡å‹ï¼Œè¯å‘é‡åªæ˜¯å…¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå‰¯äº§ç‰©ã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:2:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"ç‰¹å¾å·¥ç¨‹é˜¶æ®µ(åŸºäºè®¡æ•°çš„æ–¹æ³•) ","date":"2021-07-16","objectID":"/word-embedding/:3:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"One-Hot æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å•è¯è¡¨ç¤ºä¸º one-hot å‘é‡ï¼šå¯¹äºè¯æ±‡è¡¨ä¸­çš„ç¬¬ i ä¸ªå•è¯ï¼Œå‘é‡åœ¨ç¬¬ i ä¸ªç»´åº¦ä¸Šå…·æœ‰ 1ï¼Œåœ¨å…¶ä½™ç»´åº¦ä¸Šå…·æœ‰ 0ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œè¿™æ˜¯è¡¨ç¤ºåˆ†ç±»ç‰¹å¾çš„æœ€ç®€å•æ–¹æ³•ã€‚ One-Hotçš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå®ƒå¯¹è‡ªå·±ä»£è¡¨çš„è¯ä¸€æ— æ‰€çŸ¥ï¼Œæ²¡æœ‰æ•æ‰åˆ°è¯çš„æ„ä¹‰ã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:3:1","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"è¯è¢‹æ¨¡å‹ å³æ— è§†è¯è¯­çš„é¡ºåºï¼Œåªå…³å¿ƒå‡ºç°çš„æ¬¡æ•°ï¼Œä»¥ä¸‹éƒ½å±äºè¯è¢‹æ¨¡å‹ã€‚åœ¨æ–‡æœ¬åŒ¹é…é¢†åŸŸä¹Ÿæœ‰ç±»ä¼¼çš„å­—é¢æ„ä¹‰çš„åŒ¹é…ã€‚æœ¬åšå®¢æœ‰ç›¸å…³å†…å®¹ã€‚ ### TFIDF æƒé‡ä¹Ÿå¯ä»¥ä½œä¸ºè¯å‘é‡è¡¨ç¤ºã€‚ä¹Ÿå¯ä»¥è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦ç­‰ï¼Œæœ¬åšå®¢æœ‰ç›¸å…³å†…å®¹ã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:3:2","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"å…±ç°çŸ©é˜µ è¯¦è§æœ¬åšå®¢å…±ç°çŸ©é˜µ ### PPMI è¯¦è§æœ¬åšå®¢äº’ä¿¡æ¯ç›¸å…³åšæ–‡ã€‚ ä¸­æ–‡åå­—ä¸ºæ­£ç‚¹äº’ä¿¡æ¯ï¼Œå…¬å¼å¦‚ä¸‹ \\[ PPMI(w, c) = max(0, PMI(w, c)) \\\\\\\\ PMI(w, c) = log\\frac{P(w,c)}{P(w)P(c)} = log \\frac{N(w,c)|(w,c)|}{N(w)N(c)} \\] äº‹å®è¯æ˜ï¼Œword2vecè¢«è¯æ˜å¯ä»¥éšå¼é€¼è¿‘PMIçŸ©é˜µçš„å› å¼åˆ†è§£ã€‚ ã€Neural Word Embedding as Implicit Matrix Factorizationã€è¿™ç¯‡è®ºæ–‡å°±è¯¦ç»†è®¨è®ºäº†è¿™ä¸ªé—®é¢˜ã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:3:3","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"ä¸»é¢˜æ¨¡å‹ è¿™ä¸ªæ›´æ˜¯é‡é‡çº§ï¼Œè§æœ¬åšå®¢ã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:3:4","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"æµ…å±‚è¡¨å¾é˜¶æ®µ(åŸºäºæ¨ç†çš„æ–¹æ³•) ","date":"2021-07-16","objectID":"/word-embedding/:4:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"NNLM ä»‹ç» å…ˆæ¥å¼ ç»å…¸çš„å›¾ç‰‡ è¿™å°±æ˜¯å¤§åé¼é¼çš„ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹ï¼ˆå…¶å®ƒçš„è¯­è¨€æ¨¡å‹è¯¦è§æœ¬åšå®¢è¯­è¨€æ¨¡å‹éƒ¨åˆ†ï¼‰ å­¦ä¹ ä»»åŠ¡æ˜¯è¾“å…¥æŸä¸ªå¥ä¸­å•è¯\\(W_t=i\\)å‰é¢å¥å­çš„t-1ä¸ªå•è¯ï¼Œè¦æ±‚ç½‘ç»œæ­£ç¡®é¢„æµ‹å•è¯\\(W_t=i\\)ï¼Œå³æœ€å¤§åŒ–ï¼š \\[ P(W_t=i | W_1, W_2, \\dots W_{(t-1)}; \\theta) \\] å‰é¢ä»»æ„å•è¯ \\(W_i\\)ç”¨Onehotç¼–ç ï¼ˆæ¯”å¦‚ï¼š0001000ï¼‰ä½œä¸ºåŸå§‹å•è¯è¾“å…¥ï¼Œä¹‹åä¹˜ä»¥çŸ©é˜µQåè·å¾—å‘é‡ \\(C(W_i)\\)ï¼Œæ¯ä¸ªå•è¯çš„ \\(C(W_i)\\) æ‹¼æ¥ï¼Œä¸Šæ¥éšå±‚ï¼Œç„¶åæ¥softmaxå»é¢„æµ‹åé¢åº”è¯¥åç»­æ¥å“ªä¸ªå•è¯ã€‚ è¿™ä¸ª\\(C(W_i)\\)æ˜¯ä»€ä¹ˆï¼Ÿ è¿™å…¶å®å°±æ˜¯å•è¯å¯¹åº”çš„Word Embeddingå€¼ï¼Œé‚£ä¸ªçŸ©é˜µQåŒ…å«Vè¡Œï¼ŒVä»£è¡¨è¯å…¸å¤§å°ï¼Œæ¯ä¸€è¡Œå†…å®¹ä»£è¡¨å¯¹åº”å•è¯çš„Word embeddingå€¼ã€‚åªä¸è¿‡Qçš„å†…å®¹ä¹Ÿæ˜¯ç½‘ç»œå‚æ•°ï¼Œéœ€è¦å­¦ä¹ è·å¾—ï¼Œè®­ç»ƒåˆšå¼€å§‹ç”¨éšæœºå€¼åˆå§‹åŒ–çŸ©é˜µQï¼Œå½“è¿™ä¸ªç½‘ç»œè®­ç»ƒå¥½ä¹‹åï¼ŒçŸ©é˜µQçš„å†…å®¹è¢«æ­£ç¡®èµ‹å€¼ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå•è¯å¯¹åº”çš„Word embeddingå€¼ã€‚ æ‰€ä»¥ä½ çœ‹ï¼Œé€šè¿‡è¿™ä¸ªç½‘ç»œå­¦ä¹ è¯­è¨€æ¨¡å‹ä»»åŠ¡ï¼Œè¿™ä¸ªç½‘ç»œä¸ä»…è‡ªå·±èƒ½å¤Ÿæ ¹æ®ä¸Šæ–‡é¢„æµ‹åæ¥å•è¯æ˜¯ä»€ä¹ˆï¼ŒåŒæ—¶è·å¾—ä¸€ä¸ªå‰¯äº§å“ï¼Œå°±æ˜¯é‚£ä¸ªçŸ©é˜µQï¼Œè¿™å°±æ˜¯å•è¯çš„Word Embeddingæ˜¯è¢«å¦‚ä½•å­¦ä¼šçš„ã€‚ å‚æ•°è§£é‡Š è®­ç»ƒæ ·æœ¬(Context(w), w),wæ˜¯è¯­æ–™Cçš„æ¯ä¸€ä¸ªè¯ï¼ŒContext(w)ä¸ºå–å…¶å‰n-1ä¸ªè¯ æŠ•å½±å±‚å‘é‡\\(X_w\\): å°†è¯¥è®­ç»ƒæ ·æœ¬(Context(w), w)çš„å‰n-1ä¸ªè¯çš„è¯å‘é‡é¦–å°¾æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè¿™é‡Œçš„è¯å‘é‡å¯ä»¥ç”¨ç‹¬çƒ­ç¼–ç è¡¨ç¤ºã€‚\\(X_w\\)çš„å½¢çŠ¶ä¸º \\((n-1)\\times m\\)ï¼Œè¿™é‡Œçš„mä¸ºè¯æ±‡è¡¨çš„æ‰€æœ‰è¯çš„ä¸ªæ•°ã€‚ éšè—å±‚å‘é‡\\(Z_w\\): \\[ Z_w = tanh(WX_w+p) \\] è¾“å‡ºå±‚å‘é‡\\(y_w\\): ç»´åº¦ä¸ºN=|D|,å³è¯å…¸Dä¸­è¯çš„ä¸ªæ•°ã€‚ \\[ y_w = Uz_w + q \\] åœ¨å¯¹\\(y_w\\)åšsoftmaxåï¼Œ\\(y_w\\)çš„åˆ†é‡å°±è¡¨ç¤ºå½“å‰è¯æ˜¯wçš„æ¦‚ç‡ \\[ p(w|Context(w)) = \\frac{e^{y_w,iw}}{\\sum_{i-1}^N e^{y^{w, i}} } \\] ä¼˜ç‚¹ä¸ç¼ºç‚¹ NNLMç›¸å¯¹äºN-gramsè¯­è¨€æ¨¡å‹ï¼Œæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š è¯è¯­ä¸è¯è¯­é—´çš„ç›¸ä¼¼åº¦å¯ä»¥é€šè¿‡è¯å‘é‡æ¥ä½“ç° åŸºäºè¯å‘é‡çš„æ¨¡å‹è‡ªå¸¦ã€å¹³æ»‘åŒ–ã€åŠŸèƒ½ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚ å½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œç¼ºç‚¹å°±æ˜¯è®¡ç®—é‡å¤ªå¤§ã€‚ ä¸‹é¢å°±é‡ç‚¹ä»‹ç»ä¸€ä¸‹word2vecï¼Œç›¸æ¯”äºNNLMæ¥è¯´è¿™æ˜¯ä¸“é—¨è®­ç»ƒè¯å‘é‡çš„ä¸€ç§å·¥å…·ï¼Œè€Œè¯å‘é‡å¯¹äºNNLMæ¥è¯´åªæ˜¯ä¸€ä¸ªå‰¯äº§ç‰©ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªè¯­è¨€æ¨¡å‹ã€‚ ä»£ç  ä»£ç æ¥è‡ªhttps://github.com/graykode/nlp-tutorial import torch import torch.nn as nn import torch.optim as optim def make_batch(): input_batch = [] target_batch = [] for sen in sentences: word = sen.split() # space tokenizer input = [word_dict[n] for n in word[:-1]] # create (1~n-1) as input target = word_dict[word[-1]] # create (n) as target, We usually call this 'casual language model' input_batch.append(input) target_batch.append(target) return input_batch, target_batch # Model class NNLM(nn.Module): def __init__(self): super(NNLM, self).__init__() self.C = nn.Embedding(n_class, m) self.H = nn.Linear(n_step * m, n_hidden, bias=False) self.d = nn.Parameter(torch.ones(n_hidden)) self.U = nn.Linear(n_hidden, n_class, bias=False) self.W = nn.Linear(n_step * m, n_class, bias=False) self.b = nn.Parameter(torch.ones(n_class)) def forward(self, X): X = self.C(X) # X : [batch_size, n_step, m] X = X.view(-1, n_step * m) # [batch_size, n_step * m] tanh = torch.tanh(self.d + self.H(X)) # [batch_size, n_hidden] output = self.b + self.W(X) + self.U(tanh) # [batch_size, n_class] return output if __name__ == '__main__': n_step = 2 # number of steps, n-1 in paper n_hidden = 2 # number of hidden size, h in paper m = 2 # embedding size, m in paper sentences = [\"i like dog\", \"i love coffee\", \"i hate milk\"] word_list = \" \".join(sentences).split() # ['i', 'like', 'dog', 'dog', 'i', 'love', 'coffee', 'i', 'hate', 'milk'] word_list = list(set(word_list)) # ['i', 'like', 'dog', 'love', 'coffee', 'hate', 'milk'] word_dict = {w: i for i, w in enumerate(word_list)} # {'i':0, 'like':1, 'dog':2, 'love':3, 'coffee':4, 'hate':5, 'milk':6} number_dict = {i: w for i, w in enumerate(word_list)} # {0:'i', 1:'like', 2:'dog', 3:'love', 4:'coffee', 5:'hate', 6:'milk'} n_class = len(word_dict) # number of Vocabulary, just like |V|, in this task n_class=7 model = NNLM() criterion = nn.CrossEntropyLoss() optimizer = optim.Adam(model.parameters(), lr=0.001) input_batch, target_batch = make_batch() input_batch = torch.LongTensor(input_batch) target_batch = torch.LongTensor(target_batch) # Training for epoch in range(5000): optimizer.zero_grad() output = model(input_batch) # output : [batch_size, n_class], target_batch : [batch_size] loss = criterion(output, target_batch) if (epoch + 1) % 1000 == 0: print('Epoch:', '%04d' % (epoch + 1), 'cost =', '{:.6f}'.format(loss)) loss.backward() optimizer.step() # Predict predict = model(input_batch).data.argmax(1, keepdim=True) # Test print([sen.split()[:2] for sen in sentences], '-\u003e', [number_dict[n.item()] for n in predict.squeeze()]) ","date":"2021-07-16","objectID":"/word-embedding/:4:1","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"word2vec Word2Vecæ˜¯ä»å¤§é‡æ–‡æœ¬è¯­æ–™ä¸­ä»¥æ— ç›‘ç£çš„æ–¹å¼å­¦ä¹ è¯­ä¹‰çŸ¥è¯†çš„ä¸€ç§æ¨¡å‹ï¼Œå®ƒè¢«å¤§é‡åœ°ç”¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬åšè‡ªç„¶è¯­è¨€å¤„ç†å‘¢ï¼ŸWord2Vecå…¶å®å°±æ˜¯é€šè¿‡å­¦ä¹ æ–‡æœ¬æ¥ç”¨è¯å‘é‡çš„æ–¹å¼è¡¨å¾è¯çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå³é€šè¿‡ä¸€ä¸ªåµŒå…¥ç©ºé—´ä½¿å¾—è¯­ä¹‰ä¸Šç›¸ä¼¼çš„å•è¯åœ¨è¯¥ç©ºé—´å†…è·ç¦»å¾ˆè¿‘ã€‚Embeddingå…¶å®å°±æ˜¯ä¸€ä¸ªæ˜ å°„ï¼Œå°†å•è¯ä»åŸå…ˆæ‰€å±çš„ç©ºé—´æ˜ å°„åˆ°æ–°çš„å¤šç»´ç©ºé—´ä¸­ï¼Œä¹Ÿå°±æ˜¯æŠŠåŸå…ˆè¯æ‰€åœ¨ç©ºé—´åµŒå…¥åˆ°ä¸€ä¸ªæ–°çš„ç©ºé—´ä¸­å»ã€‚ Word2Vecå’ŒNNLMä¸ä¸€æ ·ï¼ŒNNLMçš„ä¸»è¦ä»»åŠ¡æ˜¯è¦å­¦ä¹ ä¸€ä¸ªè§£å†³è¯­è¨€æ¨¡å‹ä»»åŠ¡çš„ç½‘ç»œç»“æ„ï¼Œè¯­è¨€æ¨¡å‹å°±æ˜¯è¦çœ‹åˆ°ä¸Šæ–‡é¢„æµ‹ä¸‹æ–‡ï¼Œè€Œword embeddingåªæ˜¯æ— å¿ƒæ’æŸ³çš„ä¸€ä¸ªå‰¯äº§å“ã€‚ä½†æ˜¯Word2Vecç›®æ ‡ä¸ä¸€æ ·ï¼Œå®ƒå•çº¯å°±æ˜¯è¦word embeddingçš„ï¼Œè¿™æ˜¯ä¸»äº§å“ï¼Œæ‰€ä»¥å®ƒå®Œå…¨å¯ä»¥éšæ€§åœ°è¿™ä¹ˆå»è®­ç»ƒç½‘ç»œã€‚ (skip-gramä¸CBOWåªæ˜¯word2vecçš„å˜ä½“ã€‚) è®­ç»ƒæ€è·¯ Word2Vec æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œå…¶å‚æ•°æ˜¯è¯å‘é‡ã€‚è¿™äº›å‚æ•°é’ˆå¯¹æŸä¸ªç›®æ ‡è¿›è¡Œè¿­ä»£ä¼˜åŒ–ã€‚ç›®æ ‡è¿«ä½¿è¯å‘é‡â€œçŸ¥é“â€ä¸€ä¸ªè¯å¯èƒ½å‡ºç°çš„ä¸Šä¸‹æ–‡ï¼šè®­ç»ƒå‘é‡ä»¥é¢„æµ‹ç›¸åº”è¯çš„å¯èƒ½ä¸Šä¸‹æ–‡ã€‚æ­£å¦‚æ‚¨ä»åˆ†å¸ƒå‡è®¾ä¸­æ‰€è®°å¾—çš„é‚£æ ·ï¼Œå¦‚æœå‘é‡â€œçŸ¥é“â€ä¸Šä¸‹æ–‡ï¼Œå®ƒä»¬å°±â€œçŸ¥é“â€å•è¯çš„å«ä¹‰ã€‚ è·å–ä¸€ä¸ªå·¨å¤§çš„æ–‡æœ¬è¯­æ–™åº“ï¼› ä½¿ç”¨æ»‘åŠ¨çª—å£æµè§ˆæ–‡æœ¬ï¼Œä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå•è¯ã€‚åœ¨æ¯ä¸€æ­¥ï¼Œéƒ½æœ‰ä¸€ä¸ªä¸­å¿ƒè¯å’Œä¸Šä¸‹æ–‡è¯ï¼ˆæ­¤çª—å£ä¸­çš„å…¶ä»–è¯ï¼‰ï¼› å¯¹äºä¸­å¿ƒè¯ï¼Œè®¡ç®—ä¸Šä¸‹æ–‡è¯çš„æ¦‚ç‡ï¼› è°ƒæ•´å‘é‡ä»¥å¢åŠ è¿™äº›æ¦‚ç‡ã€‚ æ¨å¯¼ ä»¥Skip-gramsæ¨¡å‹ä¸ºä¾‹ï¼Œé¦–å…ˆæ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼Œä¸­å¿ƒè¯ã€èƒŒæ™¯è¯ï¼ˆä¸Šä¸‹æ–‡è¯ï¼‰ã€è´Ÿé‡‡æ ·è¯ã€‚ä¸­å¿ƒè¯å°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥ï¼Œå› ä¸ºskip-gramsç›¸å½“äºåœ¨ä¸€å¥è¯ä¸­æ‰£å»ä¸€ä¸ªè¯ï¼Œç„¶åç”¨è¿™ä¸ªè¯é¢„æµ‹è¿™å¥è¯çš„å…¶ä½™è¯ã€‚å½¢å¼ä¸Šç»™äººçš„æ„Ÿè§‰å°±æ˜¯ä¸€å¯¹å¤šï¼Œè¿™é‡Œçš„ä¸€å¥è¯å…¶å®ä¸æ˜¯ä¸€å¥è¯ï¼Œæ˜¯æˆ‘ä»¬è®¾å®šçš„çª—å£å¤§å°ï¼Œæ¯”å¦‚ä¸€å¥è¯â€I miss you very muchâ€ï¼Œ è®¾ç½®ä¸­å¿ƒè¯ä¸ºyouï¼Œçª—å£å¤§å°ä¸º1ï¼Œé‚£ä¹ˆèƒŒæ™¯è¯å°±æ˜¯â€missâ€å’Œâ€veryâ€ã€‚é‚£ä¹ˆå¯¹äºæˆ‘ä»¬çš„æ¨¡å‹æ¥è¯´ï¼Œmisså’Œveryå°±æ˜¯æ­£ä¾‹ï¼Œå°±æ˜¯æˆ‘ä»¬çš„é¢„æµ‹å€¼(sigmoidå)çš„å€¼æ¥è¿‘äº1çš„ï¼Œè€Œå…¶ä½™çš„è¯å°±æ˜¯è´Ÿä¾‹ï¼Œå°±æ˜¯ä½¿å…¶å€¼æ¥è¿‘äº0çš„ã€‚æ‰€ä»¥è´Ÿé‡‡æ ·å°±æ˜¯ä»è¿™äº›è´Ÿä¾‹ä¸­éšæœºæŠ½å–ä¸€äº›è´Ÿä¾‹ï¼Œä¸ç„¶æ¯æ¬¡éƒ½è¦è®¡ç®—å•è¯è¡¨ä¸­æ‰€æœ‰å•è¯çš„sigmoidå€¼ï¼Œè¿™ä¸ªè®¡ç®—é‡å¾ˆå¤§ï¼Œè€Œä½¿ç”¨è´Ÿé‡‡æ ·å°±å¤§å¤§ç¼©å°äº†è®¡ç®—é‡ã€‚ ç›®æ ‡å‡½æ•°ï¼šè´Ÿä¼¼ç„¶å¯¹æ•° å¯¹äºæ¯ä¸ªä½ç½®\\(t=1,\\dots, T\\)ï¼Œåœ¨æ–‡æœ¬è¯­æ–™åº“ä¸­ï¼ŒWord2Vecåœ¨ç»™å®šä¸­å¿ƒè¯çš„må¤§å°çª—å£å†…é¢„æµ‹ä¸Šä¸‹æ–‡è¯\\(w_t\\): \\[ Likelihood=L(\\theta)=\\prod_{t=1}^T\\prod_{-m\\leq j\\leq m, j\\neq0} P(w_{t+j} | w_t, \\theta) \\] ç›®æ ‡å‡½æ•°\\(J(\\theta)\\)ä¸ºå¹³å‡è´Ÿå¯¹æ•°ä¼¼ç„¶ \\[ Loss = J(\\theta) = -\\frac{1}{T}\\sum_{t=1}^T\\sum_{-m\\leq j\\leq m, j\\neq0} logP(w_{t+j}|w_t, \\theta) \\] å¯¹äºæ¯ä¸ªå•è¯wæˆ‘ä»¬éƒ½æœ‰ä¸¤ä¸ªå‘é‡ï¼š \\(v_w\\)å½“wæ˜¯ä¸­å¿ƒè¯ \\(u_w\\)å½“wæ—¶èƒŒæ™¯è¯ å› ä¸ºword2vecæ˜¯ä¸€ä¸ªä¸“é—¨è®­ç»ƒè¯å‘é‡çš„ç¥ç»ç½‘ç»œï¼Œè¾“å…¥ä¸ºonehotå‘é‡ï¼Œç»è¿‡ç¬¬ä¸€å±‚Wçš„è®¡ç®—å¾—åˆ°éšè—å±‚ï¼Œå°±ç›¸å½“äºæŸ¥è¡¨ï¼Œæ•°å€¼ä¸ºä¸­å¿ƒè¯çš„è¯å‘é‡ï¼Œç„¶åå†ä¸ç¬¬äºŒå±‚çš„Wè®¡ç®—å¾—åˆ°è¾“å‡ºï¼Œè¾“å‡ºçš„ç»´åº¦å’Œè¾“å…¥çš„ç»´åº¦ç›¸åŒï¼Œå› æ­¤è¾“å‡ºå±‚çš„ç»“æœåœ¨è®¡ç®—ä¸Šå°±æ˜¯\\(u_c^Tv_w\\)ã€‚å³è¾“å…¥å±‚å¯¹åº”çš„ä¸­å¿ƒè¯çš„è¯å‘é‡*è¾“å‡ºå±‚å¯¹åº”èƒŒæ™¯è¯çš„è¯å‘é‡ï¼Œå†ç»è¿‡softmaxå°±æ˜¯å¯¹åº”èƒŒæ™¯è¯çš„æ¦‚ç‡ã€‚ è®­ç»ƒå®Œæ¯•åï¼Œæˆ‘ä»¬åªä½¿ç”¨\\(v_w\\)ï¼Œå³åªä½¿ç”¨ä»è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡ã€‚ å¯¹äºä¸­å¿ƒè¯wï¼Œä¸Šä¸‹æ–‡è¯cçš„æ¦‚ç‡ä¸ºï¼š \\[ P(c|w) = \\frac{exp(u_c^Tv_w)}{\\sum_{o\\in V}exp(u_o^Tv_w)} \\] è¿™å°±æ˜¯softmaxå‡½æ•°ã€‚ è®­ç»ƒ \\(\\theta^{new} = \\theta^{old} - \\alpha \\nabla_\\theta J(\\theta)\\) ä¸€æ¬¡è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œæ¯æ¬¡æ›´æ–°éƒ½æ˜¯é’ˆå¯¹ä¸€å¯¹ä¸­å¿ƒè¯å’Œå…¶ä¸­ä¸€ä¸ªèƒŒæ™¯è¯ã€‚æŸå¤±å‡½æ•°ï¼š \\[ Loss = J(\\theta) = -\\frac{1}{T}logL(\\theta)= -\\frac{1}{T}\\sum_{t=1}^T\\sum_{-m\\leq j\\leq m, j\\neq0} logP(w_{t+j}|w_t, \\theta)\\\\\\\\=\\frac{1}{T}\\sum_{t=1}^T\\sum_{-m\\leq j\\leq m, j\\neq0}J_{t,j}(\\theta). \\] å…¶ä¸­\\(J_{t,j}(\\theta) = -logP(w_{t+j}|w_t, \\theta)\\) ä»¥â€I miss you very muchâ€è¿™å¥è¯ä¸ºä¾‹å­ï¼Œä¸­å¿ƒè¯ä¸ºâ€youâ€ï¼Œå…¶ä¸­ä¸€ä¸ªèƒŒæ™¯è¯ä¸ºmissï¼Œåˆ™æŸå¤±é¡¹ä¸º \\[ J_{t,j}(\\theta) = -logP(miss|you) = -log\\frac{exp(u_{miss}^Tv_{you})}{\\sum_{o\\in V}exp(u_o^Tv_{you})} = \\\\\\\\-u_{miss}^Tv_{you}+log\\sum_{o\\in V} exp(u_o^Tv_{you}) \\] è¿™æ˜¯ä¸­å¿ƒè¯å¯¹åº”å…¶ä¸­ä¸€ä¸ªèƒŒæ™¯è¯çš„æŸå¤±å‡½æ•°ï¼Œå¦‚æœè¦æ±‚æ€»çš„æŸå¤±ï¼Œåˆ™å°†æ‰€æœ‰èƒŒæ™¯è¯çš„æŸå¤±ç›¸åŠ ï¼Œç„¶åå°†æ‰€æœ‰æ ·æœ¬çš„æŸå¤±æ±‚å¹³å‡ï¼Œå°±æ˜¯ä¸Šé¢çš„Lossã€‚å…¶å®è¿™å°±æ˜¯äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œæ˜¯ä¸ªå¤šåˆ†ç±»é—®é¢˜ï¼Œé¢„æµ‹çš„targetç›¸å½“äºmisså¯¹åº”çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯åºåˆ—å€¼ï¼Œå…·ä½“çš„pytorchä»£ç ä¸º loss = (-output_layer[:, Y] + torch.log(torch.sum(torch.exp(output_layer), dim=1))).mean() è¿™é‡Œçš„output_layerå°±æ˜¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºå±‚ï¼Œæ³¨æ„è¿™é‡Œçš„éƒ½æ˜¯å¯¹batchæ“ä½œï¼Œè¿™é‡Œæ±‚å‡ºçš„lossæ˜¯è¿™ä¸ªbatchä¸Šæœ€ç»ˆçš„lossï¼Œè€Œä¸æ˜¯ä¸€å¯¹ä¸­å¿ƒè¯ä¸èƒŒæ™¯è¯çš„lossã€‚ç†è§£äº†è¿™ä¸ªç®€å•çš„word2vecæ¨¡å‹å°±ç®—ç†è§£äº†ã€‚ ä¸‹é¢æ±‚ä¸€ä¸‹æ¢¯åº¦ï¼š æ³¨æ„è¿™é‡Œçš„cä¸ºcenter word, oä¸ºä¸Šä¸‹æ–‡è¯ \\[ \\frac{\\partial logP(w_o|w_c)}{\\partial v_c} = \\frac{\\partial}{\\partial v_c}log\\frac{exp(u_0^Tv_c)}{\\sum_{i=1}^{|V|}exp(u_i^Tv_c)}\\\\\\\\= \\frac{\\partial}{\\partial v_c}log\\, exp(u_o^Tv_c) - \\frac{\\partial}{\\partial v_c}log\\sum_{i=1}^{|V|}exp(u_i^Tv_c) \\] å·¦è¾¹çš„ï¼š \\[ \\frac{\\partial}{\\partial v_c}log\\, exp(u_o^Tv_c)=\\frac{\\partial}{\\partial v_c}u_o^Tv_c=u_o \\] ç¬¬äºŒéƒ¨åˆ†æ¨å¯¼ \\[ \\begin{aligned} \\frac{\\partial}{\\partial {v}_{c}} \\log \\sum_{i=1}^{|V|} \\exp \\left({u}_{i}^{T} {v}_{c}\\right) \u0026=\\frac{1}{\\sum_{i=1}^{|V|} \\exp \\left({u}_{i}^{T} {v}_{c}\\right)} \\cdot \\frac{\\partial}{\\partial {v}_{c}} \\sum_{x=1}^{|V|} \\exp \\left({u}_{x}^{T} {v}_{c}\\right) \\\\\\\\ \u0026=\\frac{1}{A} \\cdot \\sum_{x=1}^{|V|} \\frac{\\partial}{\\partial {v}_{c}} \\exp \\left({u}_{x}^{T} {v}_{c}\\right) \\\\\\\\ \u0026=\\frac{1}{A} \\cdot \\sum_{x=1}^{|V|} \\exp \\left({u}_{x}^{T} {v}_{c}\\right) \\frac{\\partial}{\\partial {v}_{c}} {u}_{x}^{T} {v}_{c} \\\\\\\\ \u0026=\\frac{1}{\\sum_{i=1}^{|V|} \\exp \\left({u}_{i}^{T} {v}_{c}\\right)} \\sum_{x=1}^{|V|} \\exp \\left({u}_{x}^{T} {v}_{c}\\right) {u}_{x} \\\\\\\\ \u0026=\\sum_{x=1}^{|V|} \\frac{\\exp \\left({u}_{x}^{T} {v}_{c}\\right)}{\\sum_{i=1}^{|V|} \\exp \\left({u}_{i}^{T} {v}_{c}\\right)} {u}_{x} \\\\\\\\ \u0026=\\sum_{x=1}^{|V|} P\\left(w_{x} \\mid w_{c}\\right) {u}_{x} \\end{aligned} \\] ç»¼ä¸Šæ‰€è¿° \\[ \\frac{\\partial \\log P\\left(w_{o} \\mid w_{c}\\right)}{\\partial {v}_{c}}={u}_{o}-\\sum_{j \\in V} P\\left(w_{j} \\mid w_{c}\\right) {u}_{j} \\] é€šè¿‡ä¸Šé¢è®¡ç®—å¾—åˆ°æ¢¯åº¦åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ¥ä¸æ–­è¿­ä»£æ¨¡å‹å‚æ•°\\(v_c\\)","date":"2021-07-16","objectID":"/word-embedding/:4:2","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"GloVe GloVe æ¨¡å‹æ˜¯åŸºäºè®¡æ•°çš„æ–¹æ³•å’Œé¢„æµ‹æ–¹æ³•ï¼ˆä¾‹å¦‚ Word2Vecï¼‰çš„ç»„åˆã€‚æ¨¡å‹åç§° GloVe ä»£è¡¨â€œGlobal Vectorsâ€ï¼Œä½“ç°äº†å®ƒçš„æ€æƒ³ï¼šè¯¥æ–¹æ³•åˆ©ç”¨ è¯­æ–™åº“ä¸­çš„å…¨å±€ä¿¡æ¯æ¥å­¦ä¹ å‘é‡ã€‚ æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ï¼Œæœ€ç®€å•çš„åŸºäºè®¡æ•°çš„æ–¹æ³•ä½¿ç”¨å…±ç°è®¡æ•°æ¥è¡¡é‡å•è¯ w å’Œä¸Šä¸‹æ–‡cä¹‹é—´çš„å…³è”ï¼š\\(N(w,c)\\)ã€‚ GloVe ä¹Ÿä½¿ç”¨è¿™äº›è®¡æ•°æ¥æ„å»ºæŸå¤±å‡½æ•°ï¼š \\[ J(\\theta) = \\sum_{w,c\\in V}f(N(w,c)) \\cdot(u_c^Tv_w+b_c+\\bar{b_w}-logN(w,c)^2) \\] å…¶ä¸­ï¼š \\[ f(x) = \\begin{cases} (\\frac{x}{x_{max}})^{0.75}, \\quad if \\;x \u003c x_{max} \\\\\\\\ 1, \\quad if \\; x\\geq x_{max} \\end{cases} \\] å…·ä½“çš„æ¨å¯¼å¯ä»¥çœ‹è¿™ä¸ªåšå®¢ï¼šhttps://www.cnblogs.com/Lee-yl/p/11172255.html å¯ä»¥çœ‹åˆ°GloVeå¹¶æ²¡æœ‰ä½¿ç”¨ç¥ç»ç½‘ç»œçš„æ–¹æ³•ã€‚ ä¸ Word2Vec ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸åŒçš„ ä¸­å¿ƒè¯å’Œä¸Šä¸‹æ–‡è¯å‘é‡â€”â€”è¿™äº›æ˜¯æˆ‘ä»¬çš„å‚æ•°ã€‚æ­¤å¤–ï¼Œè¯¥æ–¹æ³•å¯¹æ¯ä¸ªè¯å‘é‡éƒ½æœ‰ä¸€ä¸ªæ ‡é‡åç½®é¡¹ã€‚ ç‰¹åˆ«æœ‰è¶£çš„æ˜¯ GloVe æ§åˆ¶ç¨€æœ‰è¯å’Œé¢‘ç¹è¯å½±å“çš„æ–¹å¼ï¼šæ¯å¯¹ ( w , c ) çš„æŸå¤±ä»¥å¦‚ä¸‹æ–¹å¼åŠ æƒ ç½•è§äº‹ä»¶å—åˆ°æƒ©ç½šï¼Œ éå¸¸é¢‘ç¹çš„äº‹ä»¶ä¸ä¼šè¢«è¿‡åº¦åŠ æƒã€‚ ","date":"2021-07-16","objectID":"/word-embedding/:4:3","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["NLP"],"content":"å…³äºword embedding word embeddingåªèƒ½é€šè¿‡è¯­è¨€æ¨¡å‹çš„è®­ç»ƒè·å–å—ï¼Ÿ ä¸æ˜¯çš„ï¼›äº‹å®ä¸Šä»»ä½•NLPä»»åŠ¡éƒ½å¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è·å–word embeddingï¼Œç”šè‡³ç‰¹å®šä»»åŠ¡ä¸‹çš„word embeddingåœ¨ç‰¹å®šä»»åŠ¡ä¸­çš„ä½¿ç”¨æ•ˆæœè¿˜ä¼šæ›´å¥½ï¼ˆå¦‚åŸºäºfasttextçš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼‰ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬å¹³æ—¶æåŠçš„word embeddingå‡æ˜¯åœ¨è¯­è¨€æ¨¡å‹ä»»åŠ¡ä¸­äº§ç”Ÿï¼Œç§ä»¥ä¸ºä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼ša).è¯­è¨€æ¨¡å‹æ˜¯æ— ç›‘ç£ä»»åŠ¡ï¼Œå­˜åœ¨æµ·é‡è®­ç»ƒè¯­æ–™ï¼Œæ— éœ€æ ‡æ³¨æˆæœ¬ï¼›b).è¯­è¨€æ¨¡å‹ä»»åŠ¡æœ¬èº«è¦æ±‚è¾ƒé«˜ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥å­¦ä¹ å¤§é‡çš„è¯­ä¹‰çŸ¥è¯†ï¼Œè¿›è€Œç”Ÿæˆé«˜è´¨çš„word representationã€‚ å¦‚ä½•è¯„ä¼°word embeddingå¥½åï¼Ÿ æœ‰ä¸¤ç§æ–¹å¼ï¼šç¬¬ä¸€ç§ï¼ŒæŠŠword embeddingèå…¥ç°æœ‰ç³»ç»Ÿä¸­ï¼Œçœ‹å…¶å¯¹ç³»ç»Ÿæ€§èƒ½çš„æå‡ï¼›ç¬¬äºŒï¼Œä»è¯­è¨€å­¦çš„è§’åº¦å¯¹word embeddingè¿›è¡Œåˆ†æï¼Œå¦‚ç›¸ä¼¼åº¦ã€è¯­ä¹‰åç§»ç­‰ã€‚æ›´ç»†èŠ‚çš„å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ ## å‚è€ƒ å‚è€ƒï¼š https://blog.csdn.net/malefactor/article/details/83961886 https://www.zybuluo.com/Dounm/note/591752 https://lena-voita.github.io/nlp_course/word_embeddings.html https://wmathor.com/index.php/archives/1430/ https://zhuanlan.zhihu.com/p/27234078 Rong X . word2vec Parameter Learning Explained[J]. Computer Science, 2014. ","date":"2021-07-16","objectID":"/word-embedding/:5:0","tags":["NLP","Word Embedding"],"title":"Word Embedding","uri":"/word-embedding/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä¸‰æ•°ä¹‹å’Œ ","date":"2021-07-16","objectID":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/:0:0","tags":["ç®—æ³•é¢˜","ä¸‰æ•°ä¹‹å’Œ"],"title":"ä¸‰æ•°ä¹‹å’Œ","uri":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/3sum/solution/ ","date":"2021-07-16","objectID":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/:1:0","tags":["ç®—æ³•é¢˜","ä¸‰æ•°ä¹‹å’Œ"],"title":"ä¸‰æ•°ä¹‹å’Œ","uri":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ ç¬¬ä¸€çœ¼çœ‹å°±æƒ³åˆ°äº†ç”¨åŒæŒ‡é’ˆï¼Œæ³¨æ„é‡å¤æ•°å€¼çš„å¤„ç†é—®é¢˜ï¼Œç®—æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£é—®é¢˜ ","date":"2021-07-16","objectID":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/:2:0","tags":["ç®—æ³•é¢˜","ä¸‰æ•°ä¹‹å’Œ"],"title":"ä¸‰æ•°ä¹‹å’Œ","uri":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def threeSum(self, nums: List[int]) -\u003e List[List[int]]: res = [] if len(nums) \u003c 3: return [] nums.sort() for i, num in enumerate(nums): if num \u003e 0: return res if i \u003e 0 and nums[i] == nums[i-1]: continue left, right = i+1, len(nums) - 1 while left \u003c right: temp = nums[i] + nums[left] + nums[right] if temp == 0: res.append([nums[i], nums[left], nums[right]]) while left \u003c right and nums[right-1] == nums[right]: right -= 1 while left \u003c right and nums[left+1] == nums[left]: left += 1 left += 1 right -= 1 if temp \u003e 0: right -=1 if temp \u003c 0: left += 1 return res ","date":"2021-07-16","objectID":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/:3:0","tags":["ç®—æ³•é¢˜","ä¸‰æ•°ä¹‹å’Œ"],"title":"ä¸‰æ•°ä¹‹å’Œ","uri":"/%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"# ROCæ›²çº¿ äº†è§£ä»€ä¹ˆæ˜¯ROCæ›²çº¿å’ŒAUCä¹‹å‰ï¼Œè¦å…ˆäº†è§£ä»€ä¹ˆæ˜¯æ··æ·†çŸ©é˜µã€‚ æ··æ·†çŸ©é˜µä¸­æœ‰ç€Positiveã€Negativeã€Trueã€Falseçš„æ¦‚å¿µï¼Œå…¶æ„ä¹‰å¦‚ä¸‹ï¼š ç§°é¢„æµ‹ç±»åˆ«ä¸º1çš„ä¸ºPositiveï¼ˆé˜³æ€§ï¼‰ï¼Œé¢„æµ‹ç±»åˆ«ä¸º0çš„ä¸ºNegativeï¼ˆé˜´æ€§ï¼‰ã€‚ é¢„æµ‹æ­£ç¡®çš„ä¸ºTrueï¼ˆçœŸï¼‰ï¼Œé¢„æµ‹é”™è¯¯çš„ä¸ºFalseï¼ˆä¼ªï¼‰ã€‚ å› æ­¤æœ‰äº†True Postive Rateã€False Postive Rateä¸¤ä¸ªæ¦‚å¿µ \\(TPRate = \\frac{TP}{TP+FN}\\) \\(FPRate = \\frac{FP}{FP+TN}\\) TPRateçš„æ„ä¹‰æ˜¯æ‰€æœ‰çœŸå®ç±»åˆ«ä¸º1çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ç±»åˆ«ä¸º1çš„æ¯”ä¾‹ã€‚ FPRateçš„æ„ä¹‰æ˜¯æ‰€æœ‰çœŸå®ç±»åˆ«ä¸º0çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ç±»åˆ«ä¸º1çš„æ¯”ä¾‹ã€‚ æŒ‰ç…§å®šä¹‰ï¼ŒAUCå³ROCæ›²çº¿ä¸‹çš„é¢ç§¯ï¼Œè€ŒROCæ›²çº¿çš„æ¨ªè½´æ˜¯FPRateï¼Œçºµè½´æ˜¯TPRateï¼Œå½“äºŒè€…ç›¸ç­‰æ—¶ï¼Œå³y=xï¼Œå¦‚ä¸‹å›¾: è¿™æ ·çš„åˆ†ç±»å™¨å’ŒççŒœæ²¡å•¥åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹æˆAUCçš„æœ€å°å€¼ä¸º0.5ã€‚ è€Œæˆ‘ä»¬å¸Œæœ›åˆ†ç±»å™¨è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼šå¯¹äºçœŸå®ç±»åˆ«ä¸º1çš„æ ·æœ¬ï¼Œåˆ†ç±»å™¨é¢„æµ‹ä¸º1çš„æ¦‚ç‡ï¼ˆå³TPRateï¼‰ï¼Œè¦å¤§äºçœŸå®ç±»åˆ«ä¸º0è€Œé¢„æµ‹ç±»åˆ«ä¸º1çš„æ¦‚ç‡ï¼ˆå³FPRateï¼‰ï¼Œå³yï¼xã€‚è¿™æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œåˆ†ç±»å™¨è‚¯å®šè¦åˆ†å¯¹çš„å˜›ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨äºŒåˆ†ç±»ï¼ˆ0ï¼Œ1ï¼‰çš„æ¨¡å‹ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬æœ€åçš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ¦‚ç‡å€¼ï¼Œè¡¨ç¤ºç»“æœæ˜¯1çš„æ¦‚ç‡ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ€åæ€ä¹ˆå†³å®šè¾“å…¥çš„xæ˜¯å±äº0æˆ–1å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ª é˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªé˜ˆå€¼åˆ™å½’ç±»ä¸º1ï¼Œä½äºè¿™ä¸ªé˜ˆå€¼å°±å½’ç±»ä¸º0ã€‚ æ‰€ä»¥ï¼Œä¸åŒçš„é˜ˆå€¼ä¼šå¯¼è‡´åˆ†ç±»çš„ç»“æœä¸åŒï¼Œä¹Ÿå°±æ˜¯æ··æ·†çŸ©é˜µä¸ä¸€æ ·äº†ï¼ŒFPRå’ŒTPRä¹Ÿå°±ä¸ä¸€æ ·äº†ã€‚æ‰€ä»¥å½“é˜ˆå€¼ä»0å¼€å§‹æ…¢æ…¢ç§»åŠ¨åˆ°1çš„è¿‡ç¨‹ï¼Œå°±ä¼šå½¢æˆå¾ˆå¤šå¯¹(FPR, TPR)çš„å€¼ï¼Œå°†å®ƒä»¬ç”»åœ¨åæ ‡ç³»ä¸Šï¼Œå°±æ˜¯æ‰€è°“çš„ROCæ›²çº¿äº†ã€‚ çœ‹è¿™å¼ å›¾ï¼š å½“é˜ˆå€¼é€‰å–ä¸º0.5æ—¶ï¼Œé˜ˆå€¼å³è¾¹çš„è§†ä¸º é¢„æµ‹ä¸ºæ­£ä¾‹ ï¼Œé˜ˆå€¼å·¦è¾¹çš„è§†ä¸º é¢„æµ‹ä¸ºè´Ÿä¾‹ ã€‚ç”±äºå‡†ç¡®åº¦ä¸º\\(\\frac{TP+TN}{all}\\)ï¼Œå› æ­¤å¯å¾—æ­¤æ—¶çš„å‡†ç¡®åº¦ä¸º90%ã€‚ çœ‹è¿™å¼ å›¾ï¼š é˜ˆå€¼è®¾å®šä¸º0.6ï¼Œå³å³è¾¹è§†ä¸º é¢„æµ‹ä¸ºæ­£ä¾‹ ï¼Œçº¢è‰²çš„ä¸ºå®é™…ä¸ºæ­£ä¾‹ï¼Œè“è‰²çš„ä¸ºå®é™…ä¸ºè´Ÿä¾‹ï¼Œå› æ­¤å¾ˆå®¹æ˜“å¾—åˆ°FP=0ï¼Œå› ä¸ºé˜ˆå€¼å³è¾¹æ²¡æœ‰è“è‰²åŒºåŸŸï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ã€‚ å½“è“è‰²åŒºåŸŸä¸çº¢è‰²åŒºåŸŸåŸºæœ¬é‡å æ—¶ï¼ŒROCæ›²çº¿å°±å’Œæ¥è¿‘y=xè¿™æ¡çº¿äº†ã€‚ å…¶å®ï¼ŒAUCè¡¨ç¤ºçš„æ˜¯æ­£ä¾‹æ’åœ¨è´Ÿä¾‹å‰é¢çš„æ¦‚ç‡ æˆ‘ä»¬çŸ¥é“é˜ˆå€¼å¯ä»¥å–ä¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†ç±»çš„ç»“æœä¼šå—åˆ°é˜ˆå€¼çš„å½±å“ã€‚å¦‚æœä½¿ç”¨AUCçš„è¯ï¼Œå› ä¸ºé˜ˆå€¼å˜åŠ¨è€ƒè™‘åˆ°äº†ï¼Œæ‰€ä»¥è¯„ä¼°çš„æ•ˆæœæ›´å¥½ã€‚ æœ€åè¯´è¯´AUCçš„ä¼˜åŠ¿ï¼ŒAUCçš„è®¡ç®—æ–¹æ³•åŒæ—¶è€ƒè™‘äº†åˆ†ç±»å™¨å¯¹äºæ­£ä¾‹å’Œè´Ÿä¾‹çš„åˆ†ç±»èƒ½åŠ›ï¼Œåœ¨æ ·æœ¬ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶èƒ½å¤Ÿå¯¹åˆ†ç±»å™¨ä½œå‡ºåˆç†çš„è¯„ä»·ã€‚ ","date":"2021-06-26","objectID":"/roc%E6%9B%B2%E7%BA%BF/:1:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ROCæ›²çº¿"],"title":"ROCæ›²çº¿","uri":"/roc%E6%9B%B2%E7%BA%BF/"},{"categories":["Machine Learning","æ€§èƒ½æŒ‡æ ‡"],"content":"AUCè®¡ç®— ","date":"2021-06-26","objectID":"/roc%E6%9B%B2%E7%BA%BF/:2:0","tags":["Machine Learning","æ€§èƒ½æŒ‡æ ‡","ROCæ›²çº¿"],"title":"ROCæ›²çº¿","uri":"/roc%E6%9B%B2%E7%BA%BF/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:0:0","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹1 ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:1:0","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š â€‹ https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/ ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:1:1","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ åŒæŒ‡é’ˆï¼Œå®šä¹‰ nums[0...i] ä¸ºä¸ºéé‡å¤æ•°åˆ—ï¼Œéå†æ•´ä¸ªæ•°åˆ—ä¸æ–­çš„ç»´æŠ¤è¿™ä¸ªå®šä¹‰ ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:1:2","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š â€‹ class Solution: def removeDuplicates(self, nums: List[int]) -\u003e int: start = 0 for i in range(len(nums)): if nums[i] != nums[start]: start += 1 nums[i],nums[start] = nums[start],nums[i] return start + 1 ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:1:3","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹2 ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:2:0","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š â€‹ https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array-ii/ ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:2:1","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ ä¹Ÿæ˜¯åˆ©ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆç”¨äºéå†æ•°ç»„å…ƒç´ ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¦æ‹·è´èµ‹å€¼çš„ç´¢å¼•ä½ç½® ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:2:2","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š â€‹ class Solution: def removeDuplicates(self, nums: List[int]) -\u003e int: if len(nums) \u003c= 2: #é•¿åº¦å°äºç­‰äº2æ—¶ return len(nums) count = 1 #ç”¨äºé‡å¤çš„è®¡æ•° j = 1 #æŒ‡å‘å¤šä½™é‡å¤çš„å…ƒç´  for i in range(1,len(nums)): if nums[i] == nums[i-1]: count += 1 #é‡å¤äº†å°±åŠ ä¸€ if count \u003e 2: #å¦‚æœé‡å¤ä¸¤æ¬¡ä»¥ä¸Šå°±passæ‰ï¼Œç­‰ç€è¢«æ›¿æ¢ pass else: nums[j] = nums[i] j += 1 else: nums[j] = nums[i] #å¦‚æœä¸ç›¸ç­‰äº† æŠŠå¤šä½™é‡å¤çš„é‚£ä¸ªæ›¿æ¢æ‰äº† count = 1 #é‡ç½®è®¡æ•° j += 1 return j è¿™æ˜¯ä¸€ç§æ€è·¯æ¯”è¾ƒæ¸…æ™°çš„å†™æ³• ","date":"2021-06-22","objectID":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/:2:3","tags":["ç®—æ³•é¢˜","åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"],"title":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","uri":"/%E5%88%A0%E9%99%A4%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/"},{"categories":["python"],"content":"import threading import time ","date":"2021-06-13","objectID":"/asyncio/:0:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"å¤šçº¿ç¨‹ä¾‹å­ def spider(): #..... time.sleep(0.02) def main1(): for i in range(100): spider() def main2(): thread_list = [] for i in range(100): thread = threading.Thread(target = spider) thread.start() thread_list.append(thread) for t in thread_list: t.join() if __name__ == \"__main__\": start = time.time() main1() end = time.time() print(\"time1 :{:.4f}\".format(end-start)) start = time.time() main2() end = time.time() print(\"time2 :{:4f}\".format(end-start)) time1 :2.0523 time2 :0.037929 ","date":"2021-06-13","objectID":"/asyncio/:1:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"yield def fib(n): a,b = 0,1 while b\u003cn: a,b = b,a+b yield a print(fib(100)) for i in fib(100): print(i) \u003cgenerator object fib at 0x000002B1A7AA1E60\u003e 1 1 2 3 5 8 13 21 34 55 89 ","date":"2021-06-13","objectID":"/asyncio/:2:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"åç¨‹ GEN_CREATED åˆ›å»ºå®Œæˆï¼Œç­‰å¾…æ‰§è¡Œ GEN_RUNNING è§£é‡Šå™¨æ­£åœ¨æ‰§è¡Œ GEN_SUSPENDED åœ¨ yield è¡¨è¾¾å¼å¤„æš‚åœ GEN_CLOSE æ‰§è¡Œç»“æŸï¼Œç”Ÿæˆå™¨åœæ­¢ import inspect def generator(): i = \"æ¿€æ´»ç”Ÿæˆå™¨\" while True: try: value = yield i except ValueError: print(\"OVER\") i = value g = generator() print(inspect.getgeneratorstate(g)) #æŸ¥çœ‹çŠ¶æ€ next(g) # next(g)ç›¸å½“äºg.send(None) å¯ä»¥ç”¨åé¢çš„è¯­å¥æ¥é¢„ç¼´æºç¨‹ GEN_CREATED 'æ¿€æ´»ç”Ÿæˆå™¨' inspect.getgeneratorstate(g) #æŸ¥çœ‹ç”Ÿæˆå™¨çŠ¶æ€ 'GEN_SUSPENDED' g.send(\"hello world\") 'hello world' æš‚åœçŠ¶æ€çš„ç”Ÿæˆå™¨å¯ä»¥ä½¿ç”¨ send æ–¹æ³•å‘é€æ•°æ®ï¼Œæ­¤æ–¹æ³•çš„å‚æ•°å°±æ˜¯ yield è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ yield è¡¨è¾¾å¼ç­‰å·å‰é¢çš„ value å˜é‡çš„å€¼å˜æˆ â€˜Hello Shiyanlouâ€™ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œå®Œä¸€æ¬¡ while å¾ªç¯ï¼Œå˜é‡ i è¢«èµ‹å€¼ï¼Œç»§ç»­è¿è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œyield è¡¨è¾¾å¼å¼¹å‡ºå˜é‡ i g.throw(ValueError) #æŠ›å‡ºå¼‚å¸¸ ç»“æŸ OVER 'hello world' g.close() inspect.getgeneratorstate(g) #å…³é—­äº† 'GEN_CLOSED' ","date":"2021-06-13","objectID":"/asyncio/:3:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"é¢„æ¿€åç¨‹ from functools import wraps def corcut(func): @wraps(func) def wrapper(*args,**kw): g = func(*args,**kw) next(g) return g return wrapper @corcut #è£…é¥°å™¨ def generator(): i = \"æ¿€æ´»ç”Ÿæˆå™¨\" while True: try: value = yield i except ValueError: print(\"OVER\") i = value g = generator() print(inspect.getgeneratorstate(g)) #æ­¤æ—¶å·²ç»ç”¨è£…é¥°å™¨å°†ç”Ÿæˆå™¨æ¿€æ´»äº† GEN_SUSPENDED @corcut def generator(): l = [] while True: value = yield if value == \"CLOSE\": break l.append(value) return l g = generator() for i in ['a','b','CLOSE']: try: g.send(i) except StopIteration as e: value = e.value value ['a', 'b'] ","date":"2021-06-13","objectID":"/asyncio/:4:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"yield fromç”¨æ³• from itertools import chain c = chain({'one','two','three'},list(\"abc\")) for i in c: print(i) three two one a b c def chains1(*args): for i in args: for n in i: yield n def chains2(*args): for i in args: yield from i #iä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œé¿å…åµŒå¥—å¾ªç¯ c1 = chains1({\"one\",\"two\",\"three\"},list(\"abc\")) for i in c1: print(i) print(\"\\n\") c2 = chains2({\"one\",\"two\",\"three\"},list(\"abc\")) for i in c2: print(i) three two one a b c three two one a b c ","date":"2021-06-13","objectID":"/asyncio/:5:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"è½¬ç§»æ§åˆ¶æƒ from functools import wraps from faker import Faker import time def corout(func): @wraps(func) def wapper(*args,**kw): g = func(*args,**kw) next(g) return g return wapper # å­ç”Ÿæˆå™¨ def generator(): l = [] while True: i = yield if i == \"CLOSE\": break l.append(i) return sorted(l) # å§”æ‰˜ç”Ÿæˆå™¨ @corout def generator2(): while True: l = yield from generator() print(\"æ’åºåçš„åˆ—è¡¨\",l) print(\"-----------------\") # å®¢æˆ·ç«¯ if __name__ == \"__main__\": fake = Faker().country_code nest_country = [[fake() for i in range(3)] for j in range(3)] for country in nest_country: print('å›½å®¶ä»£å·åˆ—è¡¨ï¼š', country) c = generator2() for i in country: c.send(i) c.send(\"CLOSE\") å›½å®¶ä»£å·åˆ—è¡¨ï¼š ['AM', 'ZA', 'BG'] æ’åºåçš„åˆ—è¡¨ ['AM', 'BG', 'ZA'] ----------------- å›½å®¶ä»£å·åˆ—è¡¨ï¼š ['UG', 'BE', 'SI'] æ’åºåçš„åˆ—è¡¨ ['BE', 'SI', 'UG'] ----------------- å›½å®¶ä»£å·åˆ—è¡¨ï¼š ['SC', 'KI', 'KI'] æ’åºåçš„åˆ—è¡¨ ['KI', 'KI', 'SC'] ----------------- yieldæ˜¾ç„¶ä¸åªæ˜¯ç”¨æ¥å‡å°å¾ªç¯æ¬¡æ•°çš„ï¼Œå¼•ç”¨ä¸€ä¸‹ã€Šæµç•…çš„pythonã€‹ä¸­å…³äºyield from çš„æ„ä¹‰ï¼š - å­ç”Ÿæˆå™¨äº§å‡ºçš„å€¼éƒ½ç›´æ¥ä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨çš„è°ƒç”¨æ–¹ï¼ˆå³å®¢æˆ·ç«¯ä»£ç ï¼‰ã€‚ - ä½¿ç”¨ send() æ–¹æ³•å‘ç»™å§”æ´¾ç”Ÿæˆå™¨çš„å€¼éƒ½ç›´æ¥ä¼ ç»™å­ç”Ÿæˆå™¨ã€‚å¦‚æœå‘é€çš„å€¼æ˜¯ Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„ next() æ–¹æ³•ã€‚å¦‚æœå‘é€çš„å€¼ä¸æ˜¯ Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„ send() æ–¹æ³•ã€‚å¦‚æœè°ƒç”¨çš„æ–¹æ³•æŠ›å‡º StopIteration å¼‚å¸¸ï¼Œé‚£ä¹ˆå§”æ´¾ç”Ÿæˆå™¨æ¢å¤è¿è¡Œã€‚ä»»ä½•å…¶ä»–å¼‚å¸¸éƒ½ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ã€‚ - ç”Ÿæˆå™¨é€€å‡ºæ—¶ï¼Œç”Ÿæˆå™¨ï¼ˆæˆ–å­ç”Ÿæˆå™¨ï¼‰ä¸­çš„ return expr è¡¨è¾¾å¼ä¼šè§¦å‘ StopIteration(expr) å¼‚å¸¸æŠ›å‡ºã€‚ - yield from è¡¨è¾¾å¼çš„å€¼æ˜¯å­ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶ä¼ ç»™ StopIterationå¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ ä¸ºä»€ä¹ˆyieldå¯ä»¥è½¬ç§»æ§åˆ¶æƒï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸€æ®µä¼ªä»£ç ï¼š æ³¨æ„è¿™é‡Œçš„6æ˜¯å§”æ‰˜ç”Ÿæˆå™¨å‘å­ç”Ÿæˆå™¨å‘é€_sï¼Œè€Œ_sæ˜¯è°ƒç”¨æ–¹å‘å§”æ‰˜ç”Ÿæˆå™¨å‘é€çš„ï¼Œå‘é€åå¾—åˆ°ç»“æœ_yï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯yieldå³æŠ›å‡ºç»™è°ƒç”¨æ–¹ã€‚ ## asyncioæ¨¡å— import time import asyncio def one(): start = time.time() @asyncio.coroutine #1 def do_something(): #2 print(\"start ------\") time.sleep(0.1) #3 print(\"doing something\") loop = asyncio.get_event_loop() #4 coroutine = do_something() #5 loop.run_until_complete(coroutine) #6 end = time.time() print(\"æ¶ˆè€—æ—¶é—´:{:.4f}\".format(end-start))#7 one() start ------ doing something æ¶ˆè€—æ—¶é—´:0.1012 ä»£ç è¯´æ˜ï¼š 1ã€ä½¿ç”¨åç¨‹è£…é¥°å™¨åˆ›å»ºåç¨‹å‡½æ•° 2ã€åç¨‹å‡½æ•° 3ã€æ¨¡æ‹Ÿ IO æ“ä½œ 4ã€åˆ›å»ºäº‹ä»¶å¾ªç¯ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œget_event_loop æ–¹æ³•ä¼šè·å–å½“å‰å·²ç»å­˜åœ¨çš„äº‹ä»¶å¾ªç¯ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸­æ²¡æœ‰ï¼Œæ–°å»ºä¸€ä¸ª 5ã€è°ƒç”¨åç¨‹å‡½æ•°è·å–åç¨‹å¯¹è±¡ 6ã€å°†åç¨‹å¯¹è±¡æ³¨å…¥åˆ°äº‹ä»¶å¾ªç¯ï¼Œåç¨‹çš„è¿è¡Œç”±äº‹ä»¶å¾ªç¯æ§åˆ¶ã€‚äº‹ä»¶å¾ªç¯çš„ run_until_complete æ–¹æ³•ä¼šé˜»å¡è¿è¡Œï¼Œç›´åˆ°ä»»åŠ¡å…¨éƒ¨å®Œæˆã€‚åç¨‹å¯¹è±¡ä½œä¸º run_until_complete æ–¹æ³•çš„å‚æ•°ï¼Œloop ä¼šè‡ªåŠ¨å°†åç¨‹å¯¹è±¡åŒ…è£…æˆä»»åŠ¡æ¥è¿è¡Œã€‚åé¢æˆ‘ä»¬ä¼šè®²åˆ°å¤šä¸ªä»»åŠ¡æ³¨å…¥äº‹ä»¶å¾ªç¯çš„æƒ…å†µ 7ã€æ‰“å°ç¨‹åºè¿è¡Œè€—æ—¶ import time import asyncio def two(): start = time.time() @asyncio.coroutine def do_something(): print(\"start ------\") time.sleep(0.1) print(\"doing something\") loop = asyncio.get_event_loop() coroutine = do_something() task = loop.create_task(coroutine) #1 print(\"taskæ˜¯ä¸æ˜¯Taskçš„ç¤ºä¾‹ï¼Ÿ\",isinstance(task,asyncio.Task)) #2 print(\"task state\",task._state) #3 loop.run_until_complete(task) #4 print(\"take state\",task._state) end = time.time() print(\"æ¶ˆè€—æ—¶é—´:{:.4f}\".format(end-start)) two() taskæ˜¯ä¸æ˜¯Taskçš„ç¤ºä¾‹ï¼Ÿ True task state PENDING start ------ doing something take state FINISHED æ¶ˆè€—æ—¶é—´:0.1013 1ã€äº‹ä»¶å¾ªç¯çš„ create_task æ–¹æ³•å¯ä»¥åˆ›å»ºä»»åŠ¡ï¼Œå¦å¤– asyncio.ensure_future æ–¹æ³•ä¹Ÿå¯ä»¥åˆ›å»ºä»»åŠ¡ï¼Œå‚æ•°é¡»ä¸ºåç¨‹å¯¹è±¡ 2ã€task æ˜¯ asyncio.Task ç±»çš„å®ä¾‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨åç¨‹å¯¹è±¡åˆ›å»ºä»»åŠ¡ï¼Ÿå› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ asyncio.Task åšäº†ä¸€äº›å·¥ä½œï¼ŒåŒ…æ‹¬é¢„æ¿€åç¨‹ã€åç¨‹è¿è¡Œä¸­é‡åˆ°æŸäº›å¼‚å¸¸æ—¶çš„å¤„ç† **3ã€task å¯¹è±¡çš„ _state å±æ€§ä¿å­˜å½“å‰ä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€æœ‰ PENDING å’Œ FINISHED ä¸¤ç§** 4ã€å°†ä»»åŠ¡æ³¨å…¥äº‹ä»¶å¾ªç¯ï¼Œé˜»å¡è¿è¡Œ ","date":"2021-06-13","objectID":"/asyncio/:6:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"async / await import functools def three(): start = time.time() #@asyncio.coroutine async def do_something(): #1 print(\"start doing\") time.sleep(0.1) print(\"done\") def callback(name,task): #2 print(\"call back:{}\".format(name)) print(\"call back:{}\".format(task._state)) loop = asyncio.get_event_loop() coroutine = do_something() task = loop.create_task(coroutine) task.add_done_callback(functools.partial(callback, 'vllbc')) #3 loop.run_until_complete(task) end = time.time() print(\"total time {:.4f}\".format(end-start)) three() start doing done call back:vllbc call back:FINISHED total time 0.1013 ä»£ç è¯´æ˜ï¼š 1ã€ä½¿ç”¨ async å…³é”®å­—æ›¿ä»£ asyncio.coroutine è£…é¥°å™¨åˆ›å»ºåç¨‹å‡½æ•° 2ã€å›è°ƒå‡½æ•°ï¼Œåç¨‹ç»ˆæ­¢åéœ€è¦é¡ºä¾¿è¿è¡Œçš„ä»£ç å†™å…¥è¿™é‡Œï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰è¦æ±‚ï¼Œæœ€åä¸€ä¸ªä½ç½®å‚æ•°é¡»ä¸º task å¯¹è±¡ 3ã€task å¯¹è±¡çš„ add_done_callback æ–¹æ³•å¯ä»¥æ·»åŠ å›è°ƒå‡½æ•°ï¼Œæ³¨æ„å‚æ•°å¿…é¡»æ˜¯å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸èƒ½ä¼ å…¥å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œè¿™ä¸€ç‚¹éœ€è¦é€šè¿‡ functools æ¨¡å—çš„ partial æ–¹æ³•è§£å†³ï¼Œå°†å›è°ƒå‡½æ•°å’Œå…¶å‚æ•° name ä½œä¸º partial æ–¹æ³•çš„å‚æ•°ï¼Œæ­¤æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯åå‡½æ•°ï¼Œåå‡½æ•°å¯ä½œä¸º task.add_done_callback æ–¹æ³•çš„å‚æ•° def four(): start = time.time() async def do_something(name,t): print(\"start !\u003e\u003e\",name) await asyncio.sleep(t) #1 print('Stop coroutine', name) return 'Coroutine {} OK'.format(name) #2 loop = asyncio.get_event_loop() coroutine1 = do_something('wlb',3) #3 coroutine2 = do_something('yyh',1) task1 = loop.create_task(coroutine1) #4 task2 = loop.create_task(coroutine2) gather = asyncio.gather(task1,task2) #5 loop.run_until_complete(gather) print(\"task1\",task1.result()) print(\"task2\",task2.result()) #result = loop.run_until_complete(gather) #è¿™é‡Œresultå°±æ˜¯ä¸¤ä¸ªè¿”å›å€¼ç»„æˆçš„åˆ—è¡¨ å³['task1 Coroutine wlb OK','task2 Coroutine yyh OK'] end = time.time() print(\"total time:{:.4f}\".format(end-start)) four() start !\u003e\u003e wlb start !\u003e\u003e yyh Stop coroutine yyh Stop coroutine wlb task1 Coroutine wlb OK task2 Coroutine yyh OK total time:3.0022 ä»£ç è¯´æ˜ï¼š 1ã€await å…³é”®å­—ç­‰åŒäº Python 3.4 ä¸­çš„ yield from è¯­å¥ï¼Œåé¢æ¥åç¨‹å¯¹è±¡ã€‚asyncio.sleep æ–¹æ³•çš„è¿”å›å€¼ä¸ºåç¨‹å¯¹è±¡ï¼Œè¿™ä¸€æ­¥ä¸ºé˜»å¡è¿è¡Œã€‚asyncio.sleep ä¸ time.sleep æ˜¯ä¸åŒçš„ï¼Œå‰è€…é˜»å¡å½“å‰åç¨‹ï¼Œå³ corowork å‡½æ•°çš„è¿è¡Œï¼Œè€Œ time.sleep ä¼šé˜»å¡æ•´ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»ç”¨å‰è€…ï¼Œé˜»å¡å½“å‰åç¨‹ï¼ŒCPU å¯ä»¥åœ¨çº¿ç¨‹å†…çš„å…¶å®ƒåç¨‹ä¸­æ‰§è¡Œ 2ã€åç¨‹å‡½æ•°çš„ return å€¼å¯ä»¥åœ¨åç¨‹è¿è¡Œç»“æŸåä¿å­˜åˆ°å¯¹åº”çš„ task å¯¹è±¡çš„ result æ–¹æ³•ä¸­ 3ã€åˆ›å»ºä¸¤ä¸ªåç¨‹å¯¹è±¡ï¼Œåœ¨åç¨‹å†…éƒ¨åˆ†åˆ«é˜»å¡ 3 ç§’å’Œ 1 ç§’ 4ã€åˆ›å»ºä¸¤ä¸ªä»»åŠ¡å¯¹è±¡ 5ã€å°†ä»»åŠ¡å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œasyncio.gather æ–¹æ³•åˆ›å»ºä»»åŠ¡æ”¶é›†å™¨ã€‚æ³¨æ„ï¼Œasyncio.gather æ–¹æ³•ä¸­å‚æ•°çš„é¡ºåºå†³å®šäº†åç¨‹çš„å¯åŠ¨é¡ºåº 6ã€å°†ä»»åŠ¡æ”¶é›†å™¨ä½œä¸ºå‚æ•°ä¼ å…¥äº‹ä»¶å¾ªç¯çš„ run_until_complete æ–¹æ³•ï¼Œé˜»å¡è¿è¡Œï¼Œç›´åˆ°å…¨éƒ¨ä»»åŠ¡å®Œæˆ 7ã€ä»»åŠ¡ç»“æŸåï¼Œäº‹ä»¶å¾ªç¯åœæ­¢ï¼Œæ‰“å°ä»»åŠ¡çš„ result æ–¹æ³•è¿”å›å€¼ï¼Œå³åç¨‹å‡½æ•°çš„ return å€¼ åˆ°è¿™ä¸€æ­¥ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥çœ‹å¾—å‡ºï¼Œä¸Šé¢çš„ä»£ç å·²ç»æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ç»“æ„äº†ï¼Œåœ¨äº‹ä»¶å¾ªç¯å†…éƒ¨ï¼Œä¸¤ä¸ªåç¨‹æ˜¯äº¤æ›¿è¿è¡Œå®Œæˆçš„ã€‚ç®€å•å™è¿°ä¸€ä¸‹ç¨‹åºåç¨‹éƒ¨åˆ†çš„è¿è¡Œè¿‡ç¨‹ï¼š -\u003e é¦–å…ˆè¿è¡Œ task1 -\u003e æ‰“å° [corowork] Start coroutine ONE -\u003e é‡åˆ° asyncio.sleep é˜»å¡ -\u003e é‡Šæ”¾ CPU è½¬åˆ° task2 ä¸­æ‰§è¡Œ -\u003e æ‰“å° [corowork] Start coroutine TWO -\u003e å†æ¬¡é‡åˆ° asyncio.sleep é˜»å¡ -\u003e è¿™æ¬¡æ²¡æœ‰å…¶å®ƒåç¨‹å¯ä»¥è¿è¡Œäº†ï¼Œåªèƒ½ç­‰é˜»å¡ç»“æŸ -\u003e task2 çš„é˜»å¡æ—¶é—´è¾ƒçŸ­ï¼Œé˜»å¡ 1 ç§’åå…ˆç»“æŸï¼Œæ‰“å° [corowork] Stop coroutine TWO -\u003e åˆè¿‡äº† 2 ç§’ï¼Œé˜»å¡ 3 ç§’çš„ task1 ä¹Ÿç»“æŸäº†é˜»å¡ï¼Œæ‰“å° [corowork] Stop coroutine ONE -\u003e è‡³æ­¤ä¸¤ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œäº‹ä»¶å¾ªç¯åœæ­¢ -\u003e æ‰“å°ä¸¤ä¸ªä»»åŠ¡çš„ result -\u003e æ‰“å°ç¨‹åºè¿è¡Œæ—¶é—´ -\u003e ç¨‹åºå…¨éƒ¨ç»“æŸ ","date":"2021-06-13","objectID":"/asyncio/:7:0","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"awaitçš„ç†è§£ ä»ä¸Šæ–‡ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°awaitå…¶å®æ˜¯ä»yield fromä¸­è½¬å˜è¿‡æ¥çš„ï¼Œå½“åœ¨ä»£ç ä¸­çœ‹åˆ°awaitæ—¶ï¼Œå¯ä»¥çŸ¥é“å½“å‰åç¨‹è¦å»è¿è¡Œawaitåé¢çš„ä»»åŠ¡ï¼Œæ­¤æ—¶æ§åˆ¶æƒå›åˆ°äº†event loopæ‰‹ä¸­ï¼Œå»æ‰§è¡Œå…¶å®ƒçš„ä»»åŠ¡ï¼Œå½“å‰é¢çš„ä»»åŠ¡å®Œæˆäº†ä»¥åï¼Œåˆ™è½¬å»æ‰§è¡Œå‰é¢awaitåé¢çš„ä»£ç ã€‚æ³¨æ„å½“awaitç›´æ¥è·Ÿä¸€ä¸ªcoroutlineæ—¶ï¼Œæ­¤æ—¶ç›¸å½“äºå»yield fromï¼Œä¼šå¡åœ¨é‚£é‡Œï¼Œå¹¶ä¸ä¼šå®ç°çœŸæ­£çš„å¼‚æ­¥ï¼Œæ‰€ä»¥è¦å…ˆå°†coroutlineå˜ä¸ºtaskæˆ–è€…futureå°±å¯ä»¥ç›´æ¥awaitã€‚ ## å¼‚æ­¥ç¼–ç¨‹ ","date":"2021-06-13","objectID":"/asyncio/:7:1","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"ä¸€ä¸ªä¹°åœŸè±†çš„ä¾‹å­ import asyncio import random # potatoç±» class Potato: # ç”ŸæˆåœŸè±† @classmethod def make(cls, num, *args, **kws): potatos = [] for i in range(num): potatos.append(cls.__new__(cls, *args, **kws)) return potatos all_potatos = Potato.make(5) ## è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç”¨async forè¿­ä»£ï¼Œnumsä¸ºæƒ³ä¹°çš„æ•°é‡ã€‚ async def take_photos(nums): count = 0 while True: # å¦‚æœæ²¡æœ‰åœŸè±†äº†ï¼ŒæŒ‚èµ·å½“å‰ä»»åŠ¡è¯·æ±‚ç”ŸæˆåœŸè±†ä»»åŠ¡ã€‚ if len(all_potatos) == 0: await askfor_photos() else: photo = all_potatos.pop() # å¦‚æœæœ‰åœŸè±†å°†åœŸè±†æŠ›å‡ºå» yield photo count += 1 if count == nums : break async def askfor_photos(): await asyncio.sleep(2) all_potatos.append(Potato.make(5)) async def buy_photos(): bucket = [] async for p in take_photos(50): bucket.append(p) print(f\"Go photo {id(p)}\") loop = asyncio.get_event_loop() loop.run_until_complete(buy_photos()) ","date":"2021-06-13","objectID":"/asyncio/:7:2","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["python"],"content":"requestsä¾‹å­ import asyncio import requests import time # ç›¸å½“äºå§”æ‰˜ç”Ÿæˆå™¨ async def result(url): res = await request_url(url) print(url, res) # ç›¸å½“äºå­ç”Ÿæˆå™¨ async def request_url(url): res = requests.get(url) print(url) await asyncio.sleep(2) print(\"execute_time:\", time.time() - start) return res url_list = [\"https://www.csdn.net/\", \"https://vllbc.top/\", \"https://www.baidu.com/\", ] # ä»¥ä¸‹ç›¸å½“äºè°ƒç”¨æ–¹ start = time.time() print(f\"start_time:{start}\\n\") task = [result(url) for url in url_list] loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.wait(task)) endtime = time.time() - start print(\"\\nendtime:\", time.time()) print(\"all_execute_time:\", endtime) ","date":"2021-06-13","objectID":"/asyncio/:7:3","tags":["python","asyncio"],"title":"asyncio","uri":"/asyncio/"},{"categories":["ç®—æ³•é¢˜"],"content":"ç§»é™¤å…ƒç´  è¿˜æ˜¯ä»¥å‰åˆ·è¿‡çš„é¢˜ https://leetcode-cn.com/problems/remove-element/ ä»¥å‰çš„æ€è·¯æ—©å¿˜äº† ç„¶åæˆ‘é‡æ–°åšäº†ä¸€ä¸‹ï¼Œä¸€å¼€å§‹å°±ä¸€è¡Œä»£ç  class Solution: def removeElement(self, nums: List[int], val: int) -\u003e int: return len(list(filter(lambda x:x!=val,nums))) â€‹ ç„¶åå‘ç°è¾“å‡ºå’Œæ­£ç¡®è¾“å‡ºä¸ä¸€æ ·ã€‚äºæ˜¯çœ‹äº†äº†ä¸‹é¢çš„æç¤ºï¼Œç„¶åæ”¹äº†æ”¹ class Solution: def removeElement(self, nums: List[int], val: int) -\u003e int: for i in range(nums.count(val)): nums.remove(val) return len(nums) ä½†è¿™ç®—ä¸ä¸Šå«ç®—æ³•ï¼Œåˆ©ç”¨åŒæŒ‡é’ˆåšæ³•å¦‚ä¸‹ï¼š class Solution: def removeElement(self, nums: List[int], val: int) -\u003e int: left = 0 for i in range(len(nums)): if nums[i] != val: nums[left], nums[i] = nums[i], nums[left] left += 1 return left ","date":"2021-06-12","objectID":"/%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/:0:0","tags":["ç®—æ³•é¢˜","ç§»é™¤å…ƒç´ "],"title":"ç§»é™¤å…ƒç´ ","uri":"/%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/"},{"categories":["NLP"],"content":"å‚è€ƒï¼šhttps://blog.csdn.net/asialee_bird/article/details/96894533 TextRankç®—æ³•æ˜¯ä¸€ç§åŸºäºå›¾çš„ç”¨äºå…³é”®è¯æŠ½å–å’Œæ–‡æ¡£æ‘˜è¦çš„æ’åºç®—æ³•ï¼Œç”±è°·æ­Œçš„ç½‘é¡µé‡è¦æ€§æ’åºç®—æ³•PageRankç®—æ³•æ”¹è¿›è€Œæ¥ï¼Œå®ƒåˆ©ç”¨ä¸€ç¯‡æ–‡æ¡£å†…éƒ¨çš„è¯è¯­é—´çš„å…±ç°ä¿¡æ¯(è¯­ä¹‰)ä¾¿å¯ä»¥æŠ½å–å…³é”®è¯ï¼Œå®ƒèƒ½å¤Ÿä»ä¸€ä¸ªç»™å®šçš„æ–‡æœ¬ä¸­æŠ½å–å‡ºè¯¥æ–‡æœ¬çš„å…³é”®è¯ã€å…³é”®è¯ç»„ï¼Œå¹¶ä½¿ç”¨æŠ½å–å¼çš„è‡ªåŠ¨æ–‡æ‘˜æ–¹æ³•æŠ½å–å‡ºè¯¥æ–‡æœ¬çš„å…³é”®å¥ã€‚ ","date":"2021-05-20","objectID":"/textrank/:0:0","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["NLP"],"content":"PageRankç®—æ³• PageRankç®—æ³•é€šè¿‡è®¡ç®—ç½‘é¡µé“¾æ¥çš„æ•°é‡å’Œè´¨é‡æ¥ç²—ç•¥ä¼°è®¡ç½‘é¡µçš„é‡è¦æ€§ï¼Œç®—æ³•åˆ›ç«‹ä¹‹åˆå³åº”ç”¨åœ¨è°·æ­Œçš„æœç´¢å¼•æ“ä¸­ï¼Œå¯¹ç½‘é¡µè¿›è¡Œæ’åã€‚ PageRankç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰é“¾æ¥æ•°é‡ï¼šå¦‚æœä¸€ä¸ªç½‘é¡µè¢«è¶Šå¤šçš„å…¶ä»–ç½‘é¡µé“¾æ¥ï¼Œè¯´æ˜è¿™ä¸ªç½‘é¡µè¶Šé‡è¦ï¼Œå³è¯¥ç½‘é¡µçš„PRå€¼ï¼ˆPageRankå€¼ï¼‰ä¼šç›¸å¯¹è¾ƒé«˜ï¼› ï¼ˆ2ï¼‰é“¾æ¥è´¨é‡ï¼šå¦‚æœä¸€ä¸ªç½‘é¡µè¢«ä¸€ä¸ªè¶Šé«˜æƒå€¼çš„ç½‘é¡µé“¾æ¥ï¼Œä¹Ÿèƒ½è¡¨æ˜è¿™ä¸ªç½‘é¡µè¶Šé‡è¦ï¼Œå³ä¸€ä¸ªPRå€¼å¾ˆé«˜çš„ç½‘é¡µé“¾æ¥åˆ°ä¸€ä¸ªå…¶ä»–ç½‘é¡µï¼Œé‚£ä¹ˆè¢«é“¾æ¥åˆ°çš„ç½‘é¡µçš„PRå€¼ä¼šç›¸åº”åœ°å› æ­¤è€Œæé«˜ã€‚ ","date":"2021-05-20","objectID":"/textrank/:1:0","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["NLP"],"content":"TextRankç®—æ³• TextRankç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ–‡æ¡£çœ‹ä½œä¸€ä¸ªè¯çš„ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¸­çš„é“¾æ¥è¡¨ç¤ºè¯ä¸è¯ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ã€‚ TextRankç®—æ³•ä¸»è¦åŒ…æ‹¬ï¼šå…³é”®è¯æŠ½å–ã€å…³é”®çŸ­è¯­æŠ½å–ã€å…³é”®å¥æŠ½å–ã€‚ ","date":"2021-05-20","objectID":"/textrank/:2:0","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["NLP"],"content":"ï¼ˆ1ï¼‰å…³é”®è¯æŠ½å–ï¼ˆkeyword extractionï¼‰ å…³é”®è¯æŠ½å–æ˜¯æŒ‡ä»æ–‡æœ¬ä¸­ç¡®å®šä¸€äº›èƒ½å¤Ÿæè¿°æ–‡æ¡£å«ä¹‰çš„æœ¯è¯­çš„è¿‡ç¨‹ã€‚å¯¹å…³é”®è¯æŠ½å–è€Œè¨€ï¼Œç”¨äºæ„å»ºé¡¶ç‚¹é›†çš„æ–‡æœ¬å•å…ƒå¯ä»¥æ˜¯å¥å­ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ï¼›æ ¹æ®è¿™äº›å­—ä¹‹é—´çš„å…³ç³»ï¼ˆæ¯”å¦‚ï¼šåœ¨ä¸€ä¸ªæ¡†ä¸­åŒæ—¶å‡ºç°ï¼‰æ„å»ºè¾¹ã€‚æ ¹æ®ä»»åŠ¡çš„éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨è¯­æ³•è¿‡æ»¤å™¨ï¼ˆsyntactic filtersï¼‰å¯¹é¡¶ç‚¹é›†è¿›è¡Œä¼˜åŒ–ã€‚è¯­æ³•è¿‡æ»¤å™¨çš„ä¸»è¦ä½œç”¨æ˜¯å°†æŸä¸€ç±»æˆ–è€…æŸå‡ ç±»è¯æ€§çš„å­—è¿‡æ»¤å‡ºæ¥ä½œä¸ºé¡¶ç‚¹é›†ã€‚ ","date":"2021-05-20","objectID":"/textrank/:2:1","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["NLP"],"content":"ï¼ˆ2ï¼‰å…³é”®çŸ­è¯­æŠ½å–ï¼ˆkeyphrase extrationï¼‰ å…³é”®è¯æŠ½å–ç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°çš„Nä¸ªå…³é”®è¯ï¼Œåœ¨åŸå§‹æ–‡æœ¬ä¸­ç›¸é‚»çš„å…³é”®è¯æ„æˆå…³é”®çŸ­è¯­ã€‚å› æ­¤ï¼Œä»get_keyphraseså‡½æ•°çš„æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå…ˆè°ƒç”¨get_keywordsæŠ½å–å…³é”®è¯ï¼Œç„¶ååˆ†æå…³é”®è¯æ˜¯å¦å­˜åœ¨ç›¸é‚»çš„æƒ…å†µï¼Œæœ€åç¡®å®šå“ªäº›æ˜¯å…³é”®çŸ­è¯­ã€‚ ","date":"2021-05-20","objectID":"/textrank/:2:2","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["NLP"],"content":"ï¼ˆ3ï¼‰å…³é”®å¥æŠ½å–ï¼ˆsentence extractionï¼‰ å¥å­æŠ½å–ä»»åŠ¡ä¸»è¦é’ˆå¯¹çš„æ˜¯è‡ªåŠ¨æ‘˜è¦è¿™ä¸ªåœºæ™¯ï¼Œå°†æ¯ä¸€ä¸ªsentenceä½œä¸ºä¸€ä¸ªé¡¶ç‚¹ï¼Œæ ¹æ®ä¸¤ä¸ªå¥å­ä¹‹é—´çš„å†…å®¹é‡å¤ç¨‹åº¦æ¥è®¡ç®—ä»–ä»¬ä¹‹é—´çš„â€œç›¸ä¼¼åº¦â€ï¼Œä»¥è¿™ä¸ªç›¸ä¼¼åº¦ä½œä¸ºè”ç³»ï¼Œç”±äºä¸åŒå¥å­ä¹‹é—´ç›¸ä¼¼åº¦å¤§å°ä¸ä¸€è‡´ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹æ„å»ºçš„æ˜¯ä»¥ç›¸ä¼¼åº¦å¤§å°ä½œä¸ºedgeæƒé‡çš„æœ‰æƒå›¾ã€‚ ","date":"2021-05-20","objectID":"/textrank/:2:3","tags":["NLP","TextRank"],"title":"TextRank","uri":"/textrank/"},{"categories":["python"],"content":"matplotlib.pyplotå­¦ä¹  ","date":"2021-05-02","objectID":"/pyplot/:0:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"ç»˜å›¾æ ‡è®° import matplotlib.pyplot as plt import numpy as np ypoints = np.array([1,3,4,5,8,9,6,1,3,4,5,2,4]) plt.plot(ypoints, marker = 'o') # \"o\"ä»£è¡¨å®å¿ƒåœ† plt.show() makerå¯ç”¨çš„ç¬¦å·å¦‚ä¸‹ï¼š ","date":"2021-05-02","objectID":"/pyplot/:1:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"fmtå‚æ•° fmt = '[marker][line][color]' ä¾‹å¦‚ o:rï¼Œo è¡¨ç¤ºå®å¿ƒåœ†æ ‡è®°ï¼Œ: è¡¨ç¤ºè™šçº¿ï¼Œr è¡¨ç¤ºé¢œè‰²ä¸ºçº¢è‰²ã€‚ ","date":"2021-05-02","objectID":"/pyplot/:2:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"çº¿ç±»å‹ çº¿çš„ç±»å‹å¯ä»¥ä½¿ç”¨ linestyle å‚æ•°æ¥å®šä¹‰ï¼Œç®€å†™ä¸º lsã€‚ ","date":"2021-05-02","objectID":"/pyplot/:3:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"çº¿çš„å®½åº¦ çº¿çš„å®½åº¦å¯ä»¥ä½¿ç”¨ linewidth å‚æ•°æ¥å®šä¹‰ï¼Œç®€å†™ä¸º lwï¼Œå€¼å¯ä»¥æ˜¯æµ®ç‚¹æ•°ï¼Œå¦‚ï¼š1ã€2.0ã€5.67 ç­‰ã€‚ ","date":"2021-05-02","objectID":"/pyplot/:3:1","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"é¢œè‰²ç±»å‹ ","date":"2021-05-02","objectID":"/pyplot/:4:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"çº¿çš„é¢œè‰² çº¿çš„é¢œè‰²å¯ä»¥ä½¿ç”¨ color å‚æ•°æ¥å®šä¹‰ï¼Œç®€å†™ä¸º cã€‚ ","date":"2021-05-02","objectID":"/pyplot/:4:1","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"æ ‡è®°å¤§å°ä¸é¢œè‰² æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ ‡è®°çš„å¤§å°ä¸é¢œè‰²ï¼Œä½¿ç”¨çš„å‚æ•°åˆ†åˆ«æ˜¯ï¼š markersizeï¼Œç®€å†™ä¸º msï¼šå®šä¹‰æ ‡è®°çš„å¤§å°ã€‚ markerfacecolorï¼Œç®€å†™ä¸º mfcï¼šå®šä¹‰æ ‡è®°å†…éƒ¨çš„é¢œè‰²ã€‚ markeredgecolorï¼Œç®€å†™ä¸º mecï¼šå®šä¹‰æ ‡è®°è¾¹æ¡†çš„é¢œè‰²ã€‚ import matplotlib.pyplot as plt import numpy as np ypoints = np.array([6, 2, 13, 10]) plt.plot(ypoints, marker = 'o', ms = 20) plt.show() ","date":"2021-05-02","objectID":"/pyplot/:4:2","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib è½´æ ‡ç­¾å’Œæ ‡é¢˜ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ xlabel() å’Œ ylabel() æ–¹æ³•æ¥è®¾ç½® x è½´å’Œ y è½´çš„æ ‡ç­¾ã€‚ import numpy as np import matplotlib.pyplot as plt x = np.array([1, 2, 3, 4]) y = np.array([1, 4, 9, 16]) plt.plot(x, y) plt.xlabel(\"x - label\") plt.ylabel(\"y - label\") plt.show() ","date":"2021-05-02","objectID":"/pyplot/:5:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"æ ‡é¢˜ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ title() æ–¹æ³•æ¥è®¾ç½®æ ‡é¢˜ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­—ä½“æ ·å¼ï¼Œé€šè¿‡ä¼ å…¥fontdictå‚æ•° import matplotlib.pyplot as plt import numpy as np font = {\"color\":\"blue\",\"size\":20} ypoints = np.array([1,3,4,5,8,9,6,1,3,4,5,2,4]) plt.plot(ypoints,marker=\"o\",color=\"r\",linestyle=\"-.\") plt.title(\"test\",fontdict=font) plt.xlabel(\"x\",fontdict=font) plt.ylabel(\"y\",fontdict=font) plt.show() ","date":"2021-05-02","objectID":"/pyplot/:5:1","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib ç½‘æ ¼çº¿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pyplot ä¸­çš„ grid() æ–¹æ³•æ¥è®¾ç½®å›¾è¡¨ä¸­çš„ç½‘æ ¼çº¿ã€‚ grid() æ–¹æ³•è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š matplotlib.pyplot.grid(b=None, which='major', axis='both', ) å‚æ•°è¯´æ˜ï¼š bï¼šå¯é€‰ï¼Œé»˜è®¤ä¸º Noneï¼Œå¯ä»¥è®¾ç½®å¸ƒå°”å€¼ï¼Œtrue ä¸ºæ˜¾ç¤ºç½‘æ ¼çº¿ï¼Œfalse ä¸ºä¸æ˜¾ç¤ºï¼Œå¦‚æœè®¾ç½® **kwargs å‚æ•°ï¼Œåˆ™å€¼ä¸º trueã€‚ whichï¼šå¯é€‰ï¼Œå¯é€‰å€¼æœ‰ â€˜majorâ€™ã€â€˜minorâ€™ å’Œ â€˜bothâ€™ï¼Œé»˜è®¤ä¸º â€˜majorâ€™ï¼Œè¡¨ç¤ºåº”ç”¨æ›´æ”¹çš„ç½‘æ ¼çº¿ã€‚ axisï¼šå¯é€‰ï¼Œè®¾ç½®æ˜¾ç¤ºå“ªä¸ªæ–¹å‘çš„ç½‘æ ¼çº¿ï¼Œå¯ä»¥æ˜¯å– â€˜bothâ€™ï¼ˆé»˜è®¤ï¼‰ï¼Œâ€˜xâ€™ æˆ– â€˜yâ€™ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–¹å‘ï¼Œx è½´æ–¹å‘æˆ– y è½´æ–¹å‘ã€‚ **kwargsï¼šå¯é€‰ï¼Œè®¾ç½®ç½‘æ ¼æ ·å¼ï¼Œå¯ä»¥æ˜¯ color=â€˜râ€™, linestyle=â€˜-â€™ å’Œ linewidth=2ï¼Œåˆ†åˆ«è¡¨ç¤ºç½‘æ ¼çº¿çš„é¢œè‰²ï¼Œæ ·å¼å’Œå®½åº¦ã€‚ ä»¥ä¸‹å®ä¾‹æ·»åŠ ä¸€ä¸ªç®€å•çš„ç½‘æ ¼çº¿ï¼Œå¹¶è®¾ç½®ç½‘æ ¼çº¿çš„æ ·å¼ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š grid(color = 'color', linestyle = 'linestyle', linewidth = number) å‚æ•°è¯´æ˜ï¼š colorï¼šâ€™bâ€™ è“è‰²ï¼Œâ€˜mâ€™ æ´‹çº¢è‰²ï¼Œâ€˜gâ€™ ç»¿è‰²ï¼Œâ€˜yâ€™ é»„è‰²ï¼Œâ€˜râ€™ çº¢è‰²ï¼Œâ€˜kâ€™ é»‘è‰²ï¼Œâ€˜wâ€™ ç™½è‰²ï¼Œâ€˜câ€™ é’ç»¿è‰²ï¼Œâ€˜#008000â€™ RGB é¢œè‰²ç¬¦ä¸²ã€‚ linestyleï¼šâ€™â€â€™ å®çº¿ï¼Œâ€˜â€â€â€™ ç ´æŠ˜çº¿ï¼Œâ€˜â€.â€™ ç‚¹åˆ’çº¿ï¼Œâ€˜:â€™ è™šçº¿ã€‚ linewidthï¼šè®¾ç½®çº¿çš„å®½åº¦ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæ•°å­—ã€‚ ","date":"2021-05-02","objectID":"/pyplot/:6:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib ç»˜åˆ¶å¤šå›¾ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pyplot ä¸­çš„ subplot() å’Œ subplots() æ–¹æ³•æ¥ç»˜åˆ¶å¤šä¸ªå­å›¾ã€‚ subpot() æ–¹æ³•åœ¨ç»˜å›¾æ—¶éœ€è¦æŒ‡å®šä½ç½®ï¼Œsubplots() æ–¹æ³•å¯ä»¥ä¸€æ¬¡ç”Ÿæˆå¤šä¸ªï¼Œåœ¨è°ƒç”¨æ—¶åªéœ€è¦è°ƒç”¨ç”Ÿæˆå¯¹è±¡çš„ ax å³å¯ã€‚ ","date":"2021-05-02","objectID":"/pyplot/:7:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"subplot subplot(nrows, ncols, index, **kwargs) subplot(pos, **kwargs) subplot(**kwargs) subplot(ax) ä»¥ä¸Šå‡½æ•°å°†æ•´ä¸ªç»˜å›¾åŒºåŸŸåˆ†æˆ nrows è¡Œå’Œ ncols åˆ—ï¼Œç„¶åä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹çš„é¡ºåºå¯¹æ¯ä¸ªå­åŒºåŸŸè¿›è¡Œç¼–å· 1â€¦N ï¼Œå·¦ä¸Šçš„å­åŒºåŸŸçš„ç¼–å·ä¸º 1ã€å³ä¸‹çš„åŒºåŸŸç¼–å·ä¸º Nï¼Œç¼–å·å¯ä»¥é€šè¿‡å‚æ•° index æ¥è®¾ç½®ã€‚ è®¾ç½® numRows ï¼ 1ï¼ŒnumCols ï¼ 2ï¼Œå°±æ˜¯å°†å›¾è¡¨ç»˜åˆ¶æˆ 1x2 çš„å›¾ç‰‡åŒºåŸŸ, å¯¹åº”çš„åæ ‡ä¸ºï¼š (1, 1), (1, 2) è®¾ç½® numRows ï¼ 2ï¼ŒnumCols ï¼ 2ï¼Œå°±æ˜¯å°†å›¾è¡¨ç»˜åˆ¶æˆ 2x2 çš„å›¾ç‰‡åŒºåŸŸ, å¯¹åº”çš„åæ ‡ä¸ºï¼š (1, 1), (1, 2) (2, 1), (2, 2) ","date":"2021-05-02","objectID":"/pyplot/:7:1","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"subplots() subplots() æ–¹æ³•è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š matplotlib.pyplot.subplots(nrows=1, ncols=1, *, sharex=False, sharey=False, squeeze=True, subplot_kw=None, gridspec_kw=None, **fig_kw) å‚æ•°è¯´æ˜ï¼š nrowsï¼šé»˜è®¤ä¸º 1ï¼Œè®¾ç½®å›¾è¡¨çš„è¡Œæ•°ã€‚ ncolsï¼šé»˜è®¤ä¸º 1ï¼Œè®¾ç½®å›¾è¡¨çš„åˆ—æ•°ã€‚ sharexã€shareyï¼šè®¾ç½® xã€y è½´æ˜¯å¦å…±äº«å±æ€§ï¼Œé»˜è®¤ä¸º falseï¼Œå¯è®¾ç½®ä¸º â€˜noneâ€™ã€â€˜allâ€™ã€â€˜rowâ€™ æˆ– â€˜colâ€™ã€‚ False æˆ– none æ¯ä¸ªå­å›¾çš„ x è½´æˆ– y è½´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒTrue æˆ– â€˜allâ€™ï¼šæ‰€æœ‰å­å›¾å…±äº« x è½´æˆ– y è½´ï¼Œâ€˜rowâ€™ è®¾ç½®æ¯ä¸ªå­å›¾è¡Œå…±äº«ä¸€ä¸ª x è½´æˆ– y è½´ï¼Œâ€˜colâ€™ï¼šè®¾ç½®æ¯ä¸ªå­å›¾åˆ—å…±äº«ä¸€ä¸ª x è½´æˆ– y è½´ã€‚ squeezeï¼šå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º Trueï¼Œè¡¨ç¤ºé¢å¤–çš„ç»´åº¦ä»è¿”å›çš„ Axes(è½´)å¯¹è±¡ä¸­æŒ¤å‡ºï¼Œå¯¹äº N1 æˆ– 1N ä¸ªå­å›¾ï¼Œè¿”å›ä¸€ä¸ª 1 ç»´æ•°ç»„ï¼Œå¯¹äº N*Mï¼ŒN\u003e1 å’Œ M\u003e1 è¿”å›ä¸€ä¸ª 2 ç»´æ•°ç»„ã€‚å¦‚æœè®¾ç½®ä¸º Falseï¼Œåˆ™ä¸è¿›è¡ŒæŒ¤å‹æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå…ƒç´ ä¸º Axes å®ä¾‹çš„2ç»´æ•°ç»„ï¼Œå³ä½¿å®ƒæœ€ç»ˆæ˜¯1x1ã€‚ subplot_kwï¼šå¯é€‰ï¼Œå­—å…¸ç±»å‹ã€‚æŠŠå­—å…¸çš„å…³é”®å­—ä¼ é€’ç»™ add_subplot() æ¥åˆ›å»ºæ¯ä¸ªå­å›¾ã€‚ gridspec_kwï¼šå¯é€‰ï¼Œå­—å…¸ç±»å‹ã€‚æŠŠå­—å…¸çš„å…³é”®å­—ä¼ é€’ç»™ GridSpec æ„é€ å‡½æ•°åˆ›å»ºå­å›¾æ”¾åœ¨ç½‘æ ¼é‡Œ(grid)ã€‚ **fig_kwï¼šæŠŠè¯¦ç»†çš„å…³é”®å­—å‚æ•°ä¼ ç»™ figure() å‡½æ•°ã€‚ å¸¸ç”¨æŠ€å·§ x = np.linspace(0, 2*np.pi, 400) y = np.sin(x**2) fig, axs = plt.subplots(2, 2) for i in axs.flatten(): # axs.flatten()å°†äºŒç»´æ•°ç»„å˜ä¸ºä¸€ç»´ï¼Œæ–¹ä¾¿å¾ªç¯ã€‚ i.plot(x, y) ","date":"2021-05-02","objectID":"/pyplot/:7:2","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib æ•£ç‚¹å›¾ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pyplot ä¸­çš„ scatter() æ–¹æ³•æ¥ç»˜åˆ¶æ•£ç‚¹å›¾ã€‚ scatter() æ–¹æ³•è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š matplotlib.pyplot.scatter(x, y, s=None, c=None, marker=None, cmap=None, norm=None, vmin=None, vmax=None, alpha=None, linewidths=None, *, edgecolors=None, plotnonfinite=False, data=None, **kwargs) å‚æ•°è¯´æ˜ï¼š xï¼Œyï¼šé•¿åº¦ç›¸åŒçš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å³å°†ç»˜åˆ¶æ•£ç‚¹å›¾çš„æ•°æ®ç‚¹ï¼Œè¾“å…¥æ•°æ®ã€‚ sï¼šç‚¹çš„å¤§å°ï¼Œé»˜è®¤ 20ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ¯ä¸ªå‚æ•°ä¸ºå¯¹åº”ç‚¹çš„å¤§å°ã€‚ cï¼šç‚¹çš„é¢œè‰²ï¼Œé»˜è®¤è“è‰² â€˜bâ€™ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ª RGB æˆ– RGBA äºŒç»´è¡Œæ•°ç»„ã€‚ markerï¼šç‚¹çš„æ ·å¼ï¼Œé»˜è®¤å°åœ†åœˆ â€˜oâ€™ã€‚ cmapï¼šColormapï¼Œé»˜è®¤ Noneï¼Œæ ‡é‡æˆ–è€…æ˜¯ä¸€ä¸ª colormap çš„åå­—ï¼Œåªæœ‰ c æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°æ•°ç»„çš„æ—¶æ‰ä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰ç”³æ˜å°±æ˜¯ image.cmapã€‚ normï¼šNormalizeï¼Œé»˜è®¤ Noneï¼Œæ•°æ®äº®åº¦åœ¨ 0-1 ä¹‹é—´ï¼Œåªæœ‰ c æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°çš„æ•°ç»„çš„æ—¶æ‰ä½¿ç”¨ã€‚ vminï¼Œvmaxï¼šï¼šäº®åº¦è®¾ç½®ï¼Œåœ¨ norm å‚æ•°å­˜åœ¨æ—¶ä¼šå¿½ç•¥ã€‚ alphaï¼šï¼šé€æ˜åº¦è®¾ç½®ï¼Œ0-1 ä¹‹é—´ï¼Œé»˜è®¤ Noneï¼Œå³ä¸é€æ˜ã€‚ linewidthsï¼šï¼šæ ‡è®°ç‚¹çš„é•¿åº¦ã€‚ edgecolorsï¼šï¼šé¢œè‰²æˆ–é¢œè‰²åºåˆ—ï¼Œé»˜è®¤ä¸º â€˜faceâ€™ï¼Œå¯é€‰å€¼æœ‰ â€˜faceâ€™, â€˜noneâ€™, Noneã€‚ plotnonfiniteï¼šï¼šå¸ƒå°”å€¼ï¼Œè®¾ç½®æ˜¯å¦ä½¿ç”¨éé™å®šçš„ c ( inf, -inf æˆ– nan) ç»˜åˆ¶ç‚¹ã€‚ **kwargsï¼šï¼šå…¶ä»–å‚æ•°ã€‚ è®¾ç½®é¢œè‰²æ¡éœ€è¦ä½¿ç”¨ cmap å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º â€˜viridisâ€™ï¼Œä¹‹åé¢œè‰²å€¼è®¾ç½®ä¸º 0 åˆ° 100 çš„æ•°ç»„ã€‚ å¦‚æœè¦æ˜¾ç¤ºé¢œè‰²æ¡ï¼Œéœ€è¦ä½¿ç”¨ plt.colorbar() æ–¹æ³•ï¼š ","date":"2021-05-02","objectID":"/pyplot/:8:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib æŸ±å½¢å›¾ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pyplot ä¸­çš„ bar() æ–¹æ³•æ¥ç»˜åˆ¶æŸ±å½¢å›¾ã€‚ bar() æ–¹æ³•è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š matplotlib.pyplot.bar(x, height, width=0.8, bottom=None, *, align='center', data=None, **kwargs) å‚æ•°è¯´æ˜ï¼š xï¼šæµ®ç‚¹å‹æ•°ç»„ï¼ŒæŸ±å½¢å›¾çš„ x è½´æ•°æ®ã€‚ heightï¼šæµ®ç‚¹å‹æ•°ç»„ï¼ŒæŸ±å½¢å›¾çš„é«˜åº¦ã€‚ widthï¼šæµ®ç‚¹å‹æ•°ç»„ï¼ŒæŸ±å½¢å›¾çš„å®½åº¦ã€‚ bottomï¼šæµ®ç‚¹å‹æ•°ç»„ï¼Œåº•åº§çš„ y åæ ‡ï¼Œé»˜è®¤ 0ã€‚ alignï¼šæŸ±å½¢å›¾ä¸ x åæ ‡çš„å¯¹é½æ–¹å¼ï¼Œâ€˜centerâ€™ ä»¥ x ä½ç½®ä¸ºä¸­å¿ƒï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚ â€˜edgeâ€™ï¼šå°†æŸ±å½¢å›¾çš„å·¦è¾¹ç¼˜ä¸ x ä½ç½®å¯¹é½ã€‚è¦å¯¹é½å³è¾¹ç¼˜çš„æ¡å½¢ï¼Œå¯ä»¥ä¼ é€’è´Ÿæ•°çš„å®½åº¦å€¼åŠ align=â€˜edgeâ€™ã€‚ **kwargsï¼šï¼šå…¶ä»–å‚æ•°ã€‚ å‚ç›´æ–¹å‘çš„æŸ±å½¢å›¾å¯ä»¥ä½¿ç”¨ barh() æ–¹æ³•æ¥è®¾ç½®ï¼š ","date":"2021-05-02","objectID":"/pyplot/:9:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["python"],"content":"Matplotlib é¥¼å›¾ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pyplot ä¸­çš„ pie() æ–¹æ³•æ¥ç»˜åˆ¶é¥¼å›¾ã€‚ pie() æ–¹æ³•è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š matplotlib.pyplot.pie(x, explode=None, labels=None, colors=None, autopct=None, pctdistance=0.6, shadow=False, labeldistance=1.1, startangle=0, radius=1, counterclock=True, wedgeprops=None, textprops=None, center=0, 0, frame=False, rotatelabels=False, *, normalize=None, data=None)[source] å‚æ•°è¯´æ˜ï¼š xï¼šæµ®ç‚¹å‹æ•°ç»„ï¼Œè¡¨ç¤ºæ¯ä¸ªæ‰‡å½¢çš„é¢ç§¯ã€‚ explodeï¼šæ•°ç»„ï¼Œè¡¨ç¤ºå„ä¸ªæ‰‡å½¢ä¹‹é—´çš„é—´éš”ï¼Œé»˜è®¤å€¼ä¸º0ã€‚ labelsï¼šåˆ—è¡¨ï¼Œå„ä¸ªæ‰‡å½¢çš„æ ‡ç­¾ï¼Œé»˜è®¤å€¼ä¸º Noneã€‚ colorsï¼šæ•°ç»„ï¼Œè¡¨ç¤ºå„ä¸ªæ‰‡å½¢çš„é¢œè‰²ï¼Œé»˜è®¤å€¼ä¸º Noneã€‚ autopctï¼šè®¾ç½®é¥¼å›¾å†…å„ä¸ªæ‰‡å½¢ç™¾åˆ†æ¯”æ˜¾ç¤ºæ ¼å¼ï¼Œ%d%% æ•´æ•°ç™¾åˆ†æ¯”ï¼Œ%0.1f ä¸€ä½å°æ•°ï¼Œ %0.1f%% ä¸€ä½å°æ•°ç™¾åˆ†æ¯”ï¼Œ %0.2f%% ä¸¤ä½å°æ•°ç™¾åˆ†æ¯”ã€‚ labeldistanceï¼šæ ‡ç­¾æ ‡è®°çš„ç»˜åˆ¶ä½ç½®ï¼Œç›¸å¯¹äºåŠå¾„çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º 1.1ï¼Œå¦‚ \u003c1åˆ™ç»˜åˆ¶åœ¨é¥¼å›¾å†…ä¾§ã€‚ pctdistanceï¼šï¼šç±»ä¼¼äº labeldistanceï¼ŒæŒ‡å®š autopct çš„ä½ç½®åˆ»åº¦ï¼Œé»˜è®¤å€¼ä¸º 0.6ã€‚ shadowï¼šï¼šå¸ƒå°”å€¼ True æˆ– Falseï¼Œè®¾ç½®é¥¼å›¾çš„é˜´å½±ï¼Œé»˜è®¤ä¸º Falseï¼Œä¸è®¾ç½®é˜´å½±ã€‚ radiusï¼šï¼šè®¾ç½®é¥¼å›¾çš„åŠå¾„ï¼Œé»˜è®¤ä¸º 1ã€‚ startangleï¼šï¼šèµ·å§‹ç»˜åˆ¶é¥¼å›¾çš„è§’åº¦ï¼Œé»˜è®¤ä¸ºä» x è½´æ­£æ–¹å‘é€†æ—¶é’ˆç”»èµ·ï¼Œå¦‚è®¾å®š =90 åˆ™ä» y è½´æ­£æ–¹å‘ç”»èµ·ã€‚ counterclockï¼šå¸ƒå°”å€¼ï¼Œè®¾ç½®æŒ‡é’ˆæ–¹å‘ï¼Œé»˜è®¤ä¸º Trueï¼Œå³é€†æ—¶é’ˆï¼ŒFalse ä¸ºé¡ºæ—¶é’ˆã€‚ wedgeprops ï¼šå­—å…¸ç±»å‹ï¼Œé»˜è®¤å€¼ Noneã€‚å‚æ•°å­—å…¸ä¼ é€’ç»™ wedge å¯¹è±¡ç”¨æ¥ç”»ä¸€ä¸ªé¥¼å›¾ã€‚ä¾‹å¦‚ï¼šwedgeprops={â€˜linewidthâ€™:5} è®¾ç½® wedge çº¿å®½ä¸º5ã€‚ textprops ï¼šå­—å…¸ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºï¼šNoneã€‚ä¼ é€’ç»™ text å¯¹è±¡çš„å­—å…¸å‚æ•°ï¼Œç”¨äºè®¾ç½®æ ‡ç­¾ï¼ˆlabelsï¼‰å’Œæ¯”ä¾‹æ–‡å­—çš„æ ¼å¼ã€‚ center ï¼šæµ®ç‚¹ç±»å‹çš„åˆ—è¡¨ï¼Œé»˜è®¤å€¼ï¼š(0,0)ã€‚ç”¨äºè®¾ç½®å›¾æ ‡ä¸­å¿ƒä½ç½®ã€‚ frame ï¼šå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤å€¼ï¼šFalseã€‚å¦‚æœæ˜¯ Trueï¼Œç»˜åˆ¶å¸¦æœ‰è¡¨çš„è½´æ¡†æ¶ã€‚ rotatelabels ï¼šå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤ä¸º Falseã€‚å¦‚æœä¸º Trueï¼Œæ—‹è½¬æ¯ä¸ª label åˆ°æŒ‡å®šçš„è§’åº¦ã€‚ ","date":"2021-05-02","objectID":"/pyplot/:10:0","tags":["python","pyplot"],"title":"pyplot","uri":"/pyplot/"},{"categories":["Machine Learning"],"content":"èŒƒæ•°çš„å®šä¹‰ \\[ {\\lVert x \\rVert}_p := \\left(\\sum_{i=1}^n{\\lvert x_i\\rvert}^p\\right)^{\\frac{1}{p}} \\] ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:1:0","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"æ ‡å‡†åŒ–ä¸å½’ä¸€åŒ– ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:2:0","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"å®šä¹‰ å½’ä¸€åŒ–å’Œæ ‡å‡†åŒ–éƒ½æ˜¯å¯¹æ•°æ®åšå˜æ¢çš„æ–¹å¼ï¼Œå°†åŸå§‹çš„ä¸€åˆ—æ•°æ®è½¬æ¢åˆ°æŸä¸ªèŒƒå›´ï¼Œæˆ–è€…æŸç§å½¢æ€ã€‚ \u003eå½’ä¸€åŒ–ï¼šå°†ä¸€åˆ—æ•°æ®å˜åŒ–åˆ°æŸä¸ªå›ºå®šåŒºé—´(èŒƒå›´)ä¸­ï¼Œé€šå¸¸ï¼Œè¿™ä¸ªåŒºé—´æ˜¯[0, 1]ï¼Œå¹¿ä¹‰çš„è®²ï¼Œå¯ä»¥æ˜¯å„ç§åŒºé—´ï¼Œæ¯”å¦‚æ˜ å°„åˆ°[0ï¼Œ1]ä¸€æ ·å¯ä»¥ç»§ç»­æ˜ å°„åˆ°å…¶ä»–èŒƒå›´ï¼Œå›¾åƒä¸­å¯èƒ½ä¼šæ˜ å°„åˆ°[0,255]ï¼Œå…¶ä»–æƒ…å†µå¯èƒ½æ˜ å°„åˆ°[-1,1]ï¼› æ ‡å‡†åŒ–ï¼šå°†æ•°æ®å˜æ¢ä¸ºå‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1çš„åˆ†å¸ƒã€‚åˆ‡è®°ï¼Œå¹¶éä¸€å®šæ˜¯æ­£æ€çš„ï¼› ä¸­å¿ƒåŒ–ï¼šè¿˜æœ‰ä¸€ç§å¤„ç†å«åšä¸­å¿ƒåŒ–ï¼Œä¹Ÿå«é›¶å‡å€¼å¤„ç†ï¼Œå°±æ˜¯å°†æ¯ä¸ªåŸå§‹æ•°æ®å‡å»è¿™äº›æ•°æ®çš„å‡å€¼ã€‚ ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:2:1","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"å·®å¼‚ å½’ä¸€åŒ–ä¼šä¸¥æ ¼é™å®šå˜æ¢åçš„æ•°æ®çš„èŒƒå›´ï¼Œæ ‡å‡†åŒ–æ²¡æœ‰ä¸¥æ ¼çš„åŒºé—´ï¼Œå˜æ¢åçš„æ•°æ®æ²¡æœ‰èŒƒå›´ï¼Œåªæ˜¯å…¶å‡å€¼ä¸º0ï¼Œæ ‡æ³¨å·®ä¸º1. å½’ä¸€åŒ–å¯¹æ•°æ®çš„ç¼©æ”¾æ¯”ä¾‹åªä¸æå€¼æœ‰å…³ï¼Œè€Œæ ‡å‡†åŒ–ç¼©æ”¾æ¯”ä¾‹ä¸æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰å…³ã€‚ ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:2:2","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"æ ‡å‡†åŒ–ã€å½’ä¸€åŒ–çš„å¥½å¤„ ç»Ÿè®¡å»ºæ¨¡ä¸­ï¼Œå¦‚å›å½’æ¨¡å‹ï¼Œè‡ªå˜é‡\\(X\\)çš„é‡çº²ä¸ä¸€è‡´å¯¼è‡´äº†å›å½’ç³»æ•°æ— æ³•ç›´æ¥è§£è¯»æˆ–è€…é”™è¯¯è§£è¯»ï¼›éœ€è¦å°†\\(X\\)éƒ½å¤„ç†åˆ°ç»Ÿä¸€é‡çº²ä¸‹ï¼Œè¿™æ ·æ‰å¯æ¯”ï¼› æœºå™¨å­¦ä¹ ä»»åŠ¡å’Œç»Ÿè®¡å­¦ä»»åŠ¡ä¸­æœ‰å¾ˆå¤šåœ°æ–¹è¦ç”¨åˆ°â€œè·ç¦»â€çš„è®¡ç®—ï¼Œæ¯”å¦‚PCAï¼Œæ¯”å¦‚KNNï¼Œæ¯”å¦‚kmeansç­‰ç­‰ï¼Œå‡ä½¿ç®—æ¬§å¼è·ç¦»ï¼Œä¸åŒç»´åº¦é‡çº²ä¸åŒå¯èƒ½ä¼šå¯¼è‡´è·ç¦»çš„è®¡ç®—ä¾èµ–äºé‡çº²è¾ƒå¤§çš„é‚£äº›ç‰¹å¾è€Œå¾—åˆ°ä¸åˆç†çš„ç»“æœï¼› å‚æ•°ä¼°è®¡æ—¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œåœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜æ—¶ï¼Œ å½’ä¸€åŒ–/æ ‡å‡†åŒ–åå¯ä»¥åŠ å¿«æ¢¯åº¦ä¸‹é™çš„æ±‚è§£é€Ÿåº¦ï¼Œå³æå‡æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ã€‚ ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:2:3","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"å†³ç­–è¾¹ç•Œ æ‰€è°“å†³ç­–è¾¹ç•Œå°±æ˜¯èƒ½å¤ŸæŠŠæ ·æœ¬æ­£ç¡®åˆ†ç±»çš„ä¸€æ¡è¾¹ç•Œï¼Œä¸»è¦æœ‰çº¿æ€§å†³ç­–è¾¹ç•Œ(linear decision boundaries)å’Œéçº¿æ€§å†³ç­–è¾¹ç•Œ(non-linear decision boundaries)ã€‚æ³¨æ„ï¼šå†³ç­–è¾¹ç•Œæ˜¯å‡è®¾å‡½æ•°çš„å±æ€§ï¼Œç”±å‚æ•°å†³å®šï¼Œè€Œä¸æ˜¯ç”±æ•°æ®é›†çš„ç‰¹å¾å†³å®šã€‚ä¸‹é¢ä¸»è¦ä¸¾ä¸€äº›ä¾‹å­ï¼Œå½¢è±¡åŒ–çš„æ¥è¯´æ˜çº¿æ€§å†³ç­–è¾¹ç•Œå’Œéçº¿æ€§å†³ç­–è¾¹ç•Œã€‚ ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:3:0","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"æ–¹å·®ä¸åå·® å½“æˆ‘ä»¬çš„æ¨¡å‹è¡¨ç°ä¸ä½³æ—¶ï¼Œé€šå¸¸æ˜¯å‡ºç°ä¸¤ç§é—®é¢˜ï¼Œä¸€ç§æ˜¯ é«˜åå·® é—®é¢˜ï¼Œå¦ä¸€ç§æ˜¯ é«˜æ–¹å·® é—®é¢˜ã€‚è¯†åˆ«å®ƒä»¬æœ‰åŠ©äºé€‰æ‹©æ­£ç¡®çš„ä¼˜åŒ–æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ åå·® ä¸ æ–¹å·® çš„æ„ä¹‰ã€‚ åå·®: æè¿°æ¨¡å‹è¾“å‡ºç»“æœçš„æœŸæœ›ä¸æ ·æœ¬çœŸå®ç»“æœçš„å·®è·ã€‚ æ–¹å·®: æè¿°æ¨¡å‹å¯¹äºç»™å®šå€¼çš„è¾“å‡ºç¨³å®šæ€§ã€‚ å°±åƒæ‰“é¶ä¸€æ ·ï¼Œåå·®æè¿°äº†æˆ‘ä»¬çš„å°„å‡»æ€»ä½“æ˜¯å¦åç¦»äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼Œè€Œæ–¹å·®æè¿°äº†å°„å‡»å‡†ä¸å‡†ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡å„ç§æƒ…å†µä¸‹ è®­ç»ƒé›† å’Œ äº¤å‰éªŒè¯é›† çš„ è¯¯å·® æ›²çº¿æ¥ç›´è§‚åœ°ç†è§£ é«˜åå·® ä¸ é«˜æ–¹å·® çš„æ„ä¹‰ã€‚ å¯¹äº å¤šé¡¹å¼å›å½’ï¼Œå½“æ¬¡æ•°é€‰å–è¾ƒä½æ—¶ï¼Œæˆ‘ä»¬çš„ è®­ç»ƒé›†è¯¯å·® å’Œ äº¤å‰éªŒè¯é›†è¯¯å·® éƒ½ä¼šå¾ˆå¤§ï¼›å½“æ¬¡æ•°é€‰æ‹©åˆšå¥½æ—¶ï¼Œè®­ç»ƒé›†è¯¯å·® å’Œ äº¤å‰éªŒè¯é›†è¯¯å·® éƒ½å¾ˆå°ï¼›å½“æ¬¡æ•°è¿‡å¤§æ—¶ä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œè™½ç„¶ è®­ç»ƒé›†è¯¯å·® å¾ˆå°ï¼Œä½† äº¤å‰éªŒè¯é›†è¯¯å·® ä¼šå¾ˆå¤§ï¼ˆ å…³ç³»å›¾å¦‚ä¸‹ ï¼‰ å¯¹äº æ­£åˆ™åŒ– å‚æ•°ï¼Œä½¿ç”¨åŒæ ·çš„åˆ†ææ–¹æ³•ï¼Œå½“å‚æ•°æ¯”è¾ƒå°æ—¶å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆç°è±¡ï¼Œä¹Ÿå°±æ˜¯é«˜æ–¹å·®é—®é¢˜ã€‚è€Œå‚æ•°æ¯”è¾ƒå¤§æ—¶å®¹æ˜“äº§ç”Ÿæ¬ æ‹Ÿåˆç°è±¡ï¼Œä¹Ÿå°±æ˜¯é«˜åå·®é—®é¢˜ã€‚ åå·®å’Œæ–¹å·®ä¸æ•°æ®å™ªå£°ä¹‹å’Œå°±æ˜¯æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ› æ¨¡å‹çš„æœŸæœ›é¢„æµ‹ï¼ˆè¿™é‡ŒxæŒ‡æ‰€æœ‰çš„æ ·æœ¬ï¼ŒæœŸæœ›é¢„æµ‹ä¸ºè¯¥æ¨¡å‹çš„æ‰€æœ‰é¢„æµ‹ç»“æœçš„æœŸæœ›ã€‚ä¹Ÿå¯ä»¥è¡¨ç¤ºæœ‰å¤šä¸ªæ¨¡å‹åŒæ—¶å¯¹xä¸€ä¸ªæ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼ŒæœŸæœ›é¢„æµ‹ä¸ºæ‰€æœ‰æ¨¡å‹é¢„æµ‹çš„æœŸæœ›ï¼‰ï¼š æ ·æœ¬æ•°ç›¸åŒçš„ä¸åŒè®­ç»ƒé›†äº§ç”Ÿçš„æ–¹å·®ï¼ˆå¯ä»¥ç†è§£ä¸ºæµ‹è¯•é›†é¢„æµ‹ç»“æœä¸è®­ç»ƒé›†è¾“å‡ºæœŸæœ›ä¹‹é—´çš„æ–¹å·®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å‹ä¸­æ‰€æœ‰çš„é¢„æµ‹ä¸é¢„æµ‹æœŸæœ›ä¹‹é—´çš„å¹³æ–¹å·®ï¼‰ï¼š å™ªå£°ï¼ˆè¿™é‡Œçš„å™ªå£°ä¸ºäººå·¥æ ‡æ³¨çš„é”™è¯¯ã€‚ï¼‰ï¼š æœŸæœ›è¾“å‡ºä¸çœŸå®æ ‡è®°çš„å·®åˆ«ç§°ä¸ºåå·®(ä¹Ÿæœ‰ä¸¤ç§ç†è§£ï¼Œä¸€ç§æ˜¯å¤šæ¨¡å‹çš„é¢„æµ‹æœŸæœ›ä¸çœŸå®å€¼ä¹‹é—´çš„åå·®ï¼Œè¿˜æœ‰ä¸€ç§å°±ç›´æ¥æ˜¯å•æ¨¡å‹çš„é¢„æµ‹è¾“å‡ºï¼ˆå› ä¸ºå•æ¨¡å‹çš„é¢„æµ‹æœŸæœ›å°±æ˜¯å®ƒçš„è¾“å‡ºäº†ï¼‰ä¸çœŸå®å€¼ä¹‹é—´çš„å¹³æ–¹å·®å°±å¯ä»¥è®°ä¸ºåå·®çš„å¹³æ–¹ï¼Œå…¶å®è¿™é‡Œåº”ç†è§£ä¸ºå¤šæ¨¡å‹çš„æƒ…å†µ æ³›åŒ–è¯¯å·®ä¹Ÿå°±æ˜¯æœŸæœ›é£é™©ã€‚ ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:4:0","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"å‚è€ƒ å‚è€ƒ1 å‚è€ƒ2 ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:4:1","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"æ”¹è¿›ç­–ç•¥ [é«˜æ–¹å·®] é‡‡é›†æ›´å¤šçš„æ ·æœ¬æ•°æ®ï¼Œ(å‚è€ƒæ­£è§„æ–¹ç¨‹) [é«˜æ–¹å·®] å‡å°‘ç‰¹å¾æ•°é‡ï¼Œå»é™¤éä¸»è¦çš„ç‰¹å¾ [é«˜åå·®] å¼•å…¥æ›´å¤šçš„ç›¸å…³ç‰¹å¾ [é«˜åå·®] é‡‡ç”¨å¤šé¡¹å¼ç‰¹å¾ [é«˜åå·®] å‡å°æ­£åˆ™åŒ–å‚æ•° Î» [é«˜æ–¹å·®] å¢åŠ æ­£åˆ™åŒ–å‚æ•° Î» ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:4:2","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Machine Learning"],"content":"å­¦ä¹ æ›²çº¿ æ— è®ºä½ æ˜¯è¦æ£€æŸ¥ä½ çš„å­¦ä¹ ç®—æ³•æ˜¯å¦æ­£å¸¸å·¥ä½œæˆ–æ˜¯è¦æ”¹è¿›ç®—æ³•çš„è¡¨ç°ï¼Œå­¦ä¹ æ›²çº¿ éƒ½æ˜¯ä¸€ä¸ªååˆ†ç›´è§‚æœ‰æ•ˆçš„å·¥å…·ã€‚å­¦ä¹ æ›²çº¿ çš„æ¨ªè½´æ˜¯æ ·æœ¬æ•°ï¼Œçºµè½´ä¸º è®­ç»ƒé›† å’Œ äº¤å‰éªŒè¯é›† çš„ è¯¯å·® ","date":"2021-05-01","objectID":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/:5:0","tags":["Machine Learning","æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ"],"title":"æœºå™¨å­¦ä¹ çš„ä¸€äº›æ¦‚å¿µ","uri":"/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"Softmaxç†è§£ ä¸»è¦è®°å½•äº†åœ¨ä½¿ç”¨softmaxè¿™ä¸ªå‡½æ•°ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæ¯”è¾ƒåŸºç¡€ï¼Œä½†ç¡®å®å›°æ‰°äº†ä¸€æ®µæ—¶é—´ã€‚ åœ¨å­¦ä¹ word2vecä¸­, ä½¿ç”¨çš„ä¸€èˆ¬éƒ½æ˜¯å¦‚ä¸‹çš„æŸå¤±å‡½æ•°ï¼š \\[ \\begin{aligned} Loss = J(\\theta) = -\\frac{1}{T}logL(\\theta)= -\\frac{1}{T}\\sum_{t=1}^T\\sum_{-m\\leq j\\leq m, j\\neq0} logP(w_{t+j}|w_t, \\theta) \\\\\\\\ =\\frac{1}{T}\\sum_{t=1}^T\\sum_{-m\\leq j\\leq m, j\\neq0}J_{t,j}(\\theta). \\end{aligned} \\] \\[ \\begin{aligned} J_{t,j}(\\theta) = -logP(miss|xwh) = -log\\frac{exp(u_{miss}^Tv_{xwh})}{\\sum_{o\\in V}exp(u_o^Tv_{xwh})} = \\\\\\\\ -u_{miss}^Tv_{xwh}+log\\sum_{o\\in V} exp(u_o^Tv_{xwh}) \\end{aligned} \\] ä½†æ˜¯è¯´èµ·äº¤å‰ç†µå¾€å¾€æ˜¯ä¸‹é¢çš„å¼å­ï¼š \\[ L = -\\sum_{c=1}^Cy_clog(p_c) \\] åœ¨å­¦ä¹ çš„æ—¶å€™å°±ç–‘æƒ‘ï¼Œè¿™ä¸¤ç§å½¢å¼æœ‰ä»€ä¹ˆåŒºåˆ«ä¸è”ç³»å‘¢ï¼Œæœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« æ­£å¥½è§£ç­”äº†è¿™ä¸ªç–‘æƒ‘ã€‚ ä¸‹é¢ç»™å‡ºç»“è®ºï¼š ç¬¬ä¸€ç§å½¢å¼æ˜¯åªé’ˆå¯¹æ­£ç¡®ç±»åˆ«çš„å¯¹åº”ç‚¹è¾“å‡ºï¼Œå°†è¿™ä¸ªä½ç½®çš„softmaxå³æ¦‚ç‡æœ€å¤§åŒ–ï¼Œè€Œç¬¬äºŒç§å½¢å¼æ˜¯ç›´æ¥è¡¡é‡çœŸå®åˆ†å¸ƒå’Œå®é™…è¾“å‡ºä¹‹é—´çš„è·ç¦»ï¼Œå› ä¸ºäº¤å‰ç†µå°±æ˜¯ç”±KLæ•£åº¦å˜å½¢å¾—æ¥çš„ã€‚ ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:0:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"äº¤å‰ç†µ ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:1:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"ä¿¡æ¯é‡ ä¸€æ¡ä¿¡æ¯çš„ä¿¡æ¯é‡å¤§å°å’Œå®ƒçš„ä¸ç¡®å®šæ€§æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ä¸€å¥è¯å¦‚æœéœ€è¦å¾ˆå¤šå¤–éƒ¨ä¿¡æ¯æ‰èƒ½ç¡®å®šï¼Œæˆ‘ä»¬å°±ç§°è¿™å¥è¯çš„ä¿¡æ¯é‡æ¯”è¾ƒå¤§ã€‚ å°†ä¿¡æ¯çš„å®šä¹‰ä¸ºä¸‹ï¼š \\(I(x_0) = -log(p(x_0))\\) ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:1:1","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"ç†µ ä¿¡æ¯é‡æ˜¯å¯¹äºå•ä¸ªäº‹ä»¶æ¥è¯´çš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸€ä»¶äº‹æœ‰å¾ˆå¤šç§å‘ç”Ÿçš„å¯èƒ½ï¼Œæ¯”å¦‚æ·éª°å­æœ‰å¯èƒ½å‡ºç°6ç§æƒ…å†µï¼Œæ˜å¤©çš„å¤©æ°”å¯èƒ½æ™´ã€å¤šäº‘æˆ–è€…ä¸‹é›¨ç­‰ç­‰ã€‚ç†µæ˜¯è¡¨ç¤ºéšæœºå˜é‡ä¸ç¡®å®šçš„åº¦é‡ï¼Œæ˜¯å¯¹æ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„äº‹ä»¶äº§ç”Ÿçš„ä¿¡æ¯é‡çš„æœŸæœ›ã€‚å…¬å¼å¦‚ä¸‹ï¼š \\[ H(X) = -\\sum_{i=1}^np(x_i)log(p(x_i)) \\] ### ç›¸å¯¹ç†µ ç›¸å¯¹ç†µä¹Ÿç§°ä¹‹ä¸ºKLæ•£åº¦ï¼Œç”¨äºè¡¡é‡å¯¹äºåŒæ„éšæœºå˜é‡xçš„ä¸¤ä¸ªåˆ†å¸ƒp(x)å’Œq(x)ä¹‹é—´çš„å·®å¼‚ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œp(x)é€šå¸¸æè¿°æ ·æœ¬çš„çœŸå®åˆ†å¸ƒï¼Œä¾‹å¦‚[1, 0, 0, 0]è¡¨ç¤ºæ ·æœ¬å±äºç¬¬ä¸€ç±»ï¼Œè€Œq(x)å¸¸å¸¸ç”¨äºè¡¨ç¤ºé¢„æµ‹çš„åˆ†å¸ƒï¼Œä¾‹å¦‚[0.7, 0.1, 0.1, 0.1] KLæ•£åº¦çš„å®šä¹‰å…¬å¼å¦‚ä¸‹ï¼š \\[ D_{KL}(p||q) = \\sum_{i=1}^np(x_i)log(\\frac{p(x_i)}{q(x_i)}) \\] KLè¶Šå°åˆ™è¯´æ˜äºŒè€…è¶Šæ¥è¿‘ ### äº¤å‰ç†µ å°†KLæ•£åº¦å˜å½¢ \\[ D_{KL}(p||q) = \\sum_{i=1}^np(x_i)log(p(x_i)) -\\sum_{i=1}^np(x_i)log(q(x_i)) = -H(p(x)) - \\sum_{i=1}^np(x_i)log(q(x_i)) \\] ååŠéƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çš„äº¤å‰ç†µï¼Œå¸¸å¸¸ç”¨äºè¯„ä¼°predictå’Œlabelä¹‹é—´çš„å·®åˆ«ã€‚ ## ç†è§£ ä»¥ä¸€ä¸ªä¸‰åˆ†ç±»çš„é—®é¢˜æ¥è¯´ï¼Œå‡è®¾çœŸå®åˆ†å¸ƒä¸º[0, 1, 0]ï¼Œåˆ™å¯¹äºç¬¬äºŒä¸ªå¼å­æ¥è¯´ \\[ L = -\\sum_{c=1}^Cy_clog(p_c) = -0 \\times log(p_0) - 1\\times log(p_1) - 0\\times log(p_3) = -log(p_1) \\] å¯¹äºç¬¬ä¸€ä¸ªå¼å­å°±æ˜¯ \\[ loss_1 = -log(\\frac{e^{z_1}}{\\sum_{c=1}^C e^{z_c}}) = -log(p_1) = -z_1+log\\sum_{c=1}^Ce^{z_c} \\] æ‰€ä»¥è¯´å®é™…ä¸Šè¿™ä¿©æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‡ºå‘ç‚¹ä¸ä¸€æ ·ã€‚åœ¨skip-gramä¸­ï¼Œä½¿ç”¨çš„å°±æ˜¯ç¬¬ä¸€ç§å¼å­ï¼Œå¯¹å®ƒæ¥è¯´ï¼Œæ­£ç¡®çš„ç±»åˆ«å°±æ˜¯èƒŒæ™¯è¯ï¼Œå°±ç›´æ¥å°†èƒŒæ™¯è¯çš„æ¦‚ç‡æœ€å¤§ï¼Œå³æŸå¤±å‡½æ•°æœ€å°ã€‚ loss = (-output_layer[:, Y] + torch.log(torch.sum(torch.exp(output_layer), dim=1))).mean() è¿™è¡Œä»£ç å°±æ˜¯å¯¹ç¬¬ä¸€ä¸ªå¼å­çš„å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸºäºbatchçš„ã€‚è´Ÿé‡‡æ ·çš„å½¢å¼æœ‰ä¸€äº›ä¸åŒï¼Œè¿™é‡Œä¸å†è®¨è®ºï¼Œåˆ°è¿™é‡Œæˆ‘æ‰ç»ˆäºç¨ç¨ç†è§£äº†softmaxè¿™ä¸ªå‡½æ•°ã€‚ ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:1:2","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"ä¸äºŒåˆ†ç±»çš„è”ç³» å…·ä½“çš„è¯´äºŒåˆ†ç±»å°±æ˜¯ä¸¤ä¸ªç±»åˆ«ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„æ–¹æ³•å®šä¹‰ï¼Œå¯¹äºæ­£ç±»å’Œè´Ÿç±»éƒ½ç”¨ä¸åŒçš„æ¦‚ç‡è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥åªè®¡ç®—æ­£ç±»ï¼Œè´Ÿç±»å°±ç­‰äº1-æ­£ç±»ï¼Œä¸Šè¿°å‡ºç°çš„yéƒ½æ˜¯å‘é‡çš„å½¢å¼ï¼Œå¯¹äºäºŒåˆ†ç±»ï¼Œå‘é‡çš„é•¿åº¦å°±æ˜¯2ï¼Œå°±å¯ä»¥ç›´æ¥å±•å¼€ï¼Œæœ€åçš„ç»“æœå°±æ˜¯ç†ŸçŸ¥çš„æŸå¤±å‡½æ•°çš„å½¢å¼ã€‚ ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:2:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"å‚è€ƒ https://zhuanlan.zhihu.com/p/105722023 ","date":"2021-04-30","objectID":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/:3:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","äº¤å‰ç†µæŸå¤±å‡½æ•°"],"title":"äº¤å‰ç†µæŸå¤±å‡½æ•°","uri":"/%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"éªŒè¯äºŒå‰æœç´¢æ ‘ https://leetcode-cn.com/problems/validate-binary-search-tree/ # Definition for a binary tree node. # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: def isValidBST(self, root: TreeNode) -\u003e bool: return self.search(root,-(232),232) def search(self,root,mins,maxs): if root == None: return True if root.val \u003e mins and root.val \u003c maxs: pass else: return False return all([self.search(root.left,mins,root.val),self.search(root.right,root.val,maxs)]) æœ€åç”¨äº†ä¸ªall ä¹Ÿæ˜¯ç®€æ´äº†ä»£ç  ","date":"2021-04-22","objectID":"/%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/:0:0","tags":["ç®—æ³•é¢˜","éªŒè¯äºŒå‰æœç´¢æ ‘"],"title":"éªŒè¯äºŒå‰æœç´¢æ ‘","uri":"/%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"},{"categories":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—"],"content":"å›çœ‹åšå®¢ï¼Œå‘ç°æ·±åº¦å­¦ä¹ çš„ç¬”è®°ç©ºè¡è¡ï¼Œæ‰å‘è§‰ä¸€ç›´æ²¡æœ‰è¯¦ç»†å¾—è¿›è¡Œç¬”è®°ï¼Œä½†ä¹Ÿæ„Ÿè§‰ç¡®å®æ²¡æœ‰ä»€ä¹ˆå¯ä»¥è®°å½•çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯ä¸€äº›ç½‘ç»œå’Œæ¨¡å‹ï¼Œå…·ä½“çš„trickå€’æ˜¯è®°å½•äº†ä¸€äº›ï¼Œä¸è¿‡ä¸ºäº†åšå®¢çš„ç¾è§‚ï¼Œè¿˜æ˜¯å†™ä¸€äº›ä¸œè¥¿å§ï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯ä¸€äº›å°çŸ¥è¯†ã€‚ (MLPå°±ä¸è®°å½•äº†) RNNå…¶å®å¾ˆç±»ä¼¼äºä¸€ä¸ªè‡ªå›å½’æ¨¡å‹ï¼Œç”¨å†å²è§‚æµ‹é¢„æµ‹ä¸‹ä¸€ä¸ªè§‚æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾ä¸é€‚ç”¨æ‰€æœ‰çš„å†å²é¢„æµ‹ä¸‹ä¸€ä¸ªï¼Œè€Œæ˜¯éƒ¨åˆ†çš„å†å²ï¼Œä¹Ÿå°±æ˜¯è¯´åºåˆ—æ»¡è¶³é©¬å°”ç§‘å¤«æ¡ä»¶ï¼Œè€ŒRNNï¼Œå³å¾ªç¯ç¥ç»ç½‘ç»œï¼Œå°±ç¬¦åˆä¸€é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹ï¼Œå³å½“å‰è§‚æµ‹ä»…ä»…ä¸å‰ä¸€ä¸ªçš„è§‚æµ‹æœ‰å…³ï¼Œæ¨¡å‹å›¾å¦‚ä¸‹ï¼š ","date":"2021-04-21","objectID":"/rnn/:0:0","tags":["Deep Learning","å¾ªç¯ç¥ç»ç½‘ç»œç³»åˆ—","RNN"],"title":"RNN","uri":"/rnn/"},{"categories":["å·¥å…·"],"content":"èŒƒå›´+æ–‡æœ¬å¯¹è±¡ ","date":"2021-04-20","objectID":"/vim/:0:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"èŒƒå›´ å†…éƒ¨ï¼šiÂ ï¼Œæ„æŒ‡ inner å¤–éƒ¨ï¼šaÂ ï¼Œè‹±æ–‡å•è¯ aï¼Œä¸€ä¸ªçš„æ„æ€ ","date":"2021-04-20","objectID":"/vim/:1:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"æ–‡æœ¬å¯¹è±¡ (Â æˆ–Â )Â ï¼šä¸€å¯¹Â () bÂ ï¼šä¸€å¯¹Â () {Â æˆ–Â }Â ï¼šä¸€å¯¹Â {} BÂ ï¼šä¸€å¯¹Â {} [Â æˆ–Â ]Â ï¼šä¸€å¯¹Â [] \u003cÂ æˆ–Â \u003eÂ ï¼šä¸€å¯¹Â \u003c\u003e tÂ ï¼štag ï¼ˆHTML æˆ– XMLï¼‰æ ‡ç­¾ 'Â æˆ–Â 'Â ï¼šä¸€å¯¹Â '' \"Â æˆ–Â \"Â ï¼šä¸€å¯¹Â \"\" `Â æˆ–Â `Â ï¼šä¸€å¯¹Â `` wÂ ï¼šä¸€ä¸ªå•è¯ sÂ ï¼šä¸€ä¸ªå¥å­ï¼›ä»¥Â .Â !Â ?Â ç»“å°¾å³ä¸ºä¸€ä¸ªå¥å­ pÂ ï¼šä¸€ä¸ªæ®µè½ï¼›ä»¥ä¸€ä¸ªæ¢è¡Œç¬¦é—´éš”å³ä¸ºä¸€ä¸ªæ®µè½(ä¸€èˆ¬ç”¨äºå¯¹å‡½æ•°ä½“æ“ä½œ) æ¯”å¦‚i'ä»£è¡¨'å†…éƒ¨ï¼Œiwä»£è¡¨å…‰æ ‡æ‰€åœ¨å•è¯ï¼Œæ³¨æ„åˆ°ï¼ŒåŠ ä¸Šäº†èŒƒå›´iæˆ–è€…aï¼Œåˆ™åŸæœ¬çš„wå«ä¹‰ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œæ³¨æ„è¿™æ˜¯ä¸¤ä¸ªä¸œè¥¿ï¼ŒåŸæœ¬çš„wä¸ºä¸€ä¸ªç§»åŠ¨ï¼Œè€Œè¿™é‡Œçš„wä»£è¡¨æ–‡æœ¬å¯¹è±¡å³å•è¯ã€‚ move ","date":"2021-04-20","objectID":"/vim/:2:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"some easy hjklï¼Œå·¦ä¸‹ä¸Šå³ wbeWBEï¼Œå•è¯çº§åˆ« 0å’Œ$ï¼Œè¡Œé¦–å’Œè¡Œå°¾ ^å’Œg _ï¼Œè¡Œé¦–å’Œè¡Œå°¾ï¼Œä½†ä¸ç®—ç©ºç™½å­—ç¬¦ Hå’ŒLï¼Œé¡µé¢ç›¸å…³ï¼ŒåŸºæœ¬å°±æ˜¯æ˜ å°„åˆ°^å’Œg _ %æ‹¬å·åŒ¹é… ","date":"2021-04-20","objectID":"/vim/:3:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"search å…‰æ ‡ç§»åˆ°è¦æœç´¢çš„å•è¯ï¼Œ*å‘ä¸‹æŸ¥æ‰¾ï¼Œ#å‘ä¸ŠæŸ¥æ‰¾ /å‘ä¸‹æ¨¡ç³Šæœç´¢ï¼Œ?å‘ä¸Šæ¨¡ç³Šæœç´¢ï¼Œé…åˆnå’ŒN fÂ + å­—ç¬¦ï¼šè‡ªå·¦å¾€å³ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸­ FÂ + å­—ç¬¦ï¼šè‡ªå³å¾€å·¦ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸­ tÂ + å­—ç¬¦ï¼šè‡ªå·¦å¾€å³ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦çš„å‰ä¸€ä¸ªå­—ç¬¦ä¸­ TÂ + å­—ç¬¦ï¼šè‡ªå³å¾€å·¦ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦çš„åä¸€ä¸ªå­—ç¬¦ä¸­ ;ï¼šé‡å¤æ‰§è¡Œä¸Šä¸€ä¸ªæœç´¢å‘½ä»¤ ,ï¼š ä¸ä¸Šä¸€ä¸ªå‘½ä»¤æ–¹å‘ç›¸ååœ°æ‰§è¡Œä¸Šä¸€ä¸ªæœç´¢å‘½ä»¤ åŠ¨è¯ ","date":"2021-04-20","objectID":"/vim/:4:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"some easy d: åˆ é™¤ c: åˆ é™¤å¹¶è¿›å…¥insertæ¨¡å¼ y: å¤åˆ¶ ys, ds, csï¼Œvim-surroundæ’ä»¶ï¼Œå¯¹åº”æ·»åŠ æ‹¬å·ï¼Œåˆ é™¤æ‹¬å·ï¼Œä¿®æ”¹æ‹¬å· .é‡å¤ä¸Šä¸€ä¸ªå‘½ä»¤ uæ’¤é”€ä¸Šæ¡å‘½ä»¤ pç²˜è´´å‰ªåˆ‡æ¿å†…å®¹ ræ›¿æ¢ ","date":"2021-04-20","objectID":"/vim/:5:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"g+ï¼Ÿæ•´ç† g : å®šä½åˆ°ä¸Šæ¬¡ç¼–è¾‘ä½ç½® g c æ³¨é‡Š g h å¼¹å‡ºå˜é‡æˆ–è€…å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ guå’ŒgU å°å†™æˆ–å¤§å†™ï¼Œg u uå’Œg U Uæ•´è¡Œå°å†™å¤§å†™ g b å¤šé€‰ç›¸åŒçš„word ggæ–‡ä»¶é¦–ï¼ŒGæ–‡ä»¶å°¾ 3Gæˆ–3ggæˆ–:3ï¼Œè·³åˆ°ç¬¬3è¡Œ æ•°é‡è¯ 1234567...è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œçš„æ¬¡æ•°ã€‚ ç»“åˆèµ·æ¥å§ ","date":"2021-04-20","objectID":"/vim/:6:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"åŠ¨è¯ + move d hï¼Œåˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ d wï¼Œåˆ é™¤å­—ç¬¦åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ d tVï¼Œåˆ é™¤å­—ç¬¦åˆ°ä¸‹ä¸€ä¸ªvå­—ç¬¦å‰é¢ d 2fbï¼Œåˆ é™¤å­—ç¬¦åˆ°ç¬¬äºŒä¸ªbï¼Œä¸”åŒ…æ‹¬è¿™ä¸ªbï¼Œç­‰åŒäº2 dfb ","date":"2021-04-20","objectID":"/vim/:7:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["å·¥å…·"],"content":"åŠ¨è¯ + ï¼ˆèŒƒå›´ï¼‰ +æ–‡æœ¬å¯¹è±¡ ys w'ï¼Œç»™å½“å‰åˆ°ä¸‹ä¸€ä¸ªå•è¯å‰æ·»åŠ 'å· ds 'ï¼Œåˆ é™¤åŒ…è£¹çš„ç¬¦å· cs [(ï¼Œå°†[]ä¿®æ”¹ä¸º() yssbï¼Œæ•´è¡Œæ·»åŠ æ‹¬å·ï¼Œé‡å¤ä¸¤æ¬¡ä»£è¡¨å¯¹è¡Œæ“ä½œï¼Œbåœ¨å‰é¢ä»‹ç»è¯´äº†æ˜¯æ–‡æœ¬å¯¹è±¡ï¼Œä»£è¡¨æ‹¬å·ã€‚ ysiw'ï¼Œå‡ºç°äº†ä¸¤ä¸ªæ–‡æœ¬å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªä¸å‰é¢çš„iç»“åˆä¸ºiwä»£è¡¨å•è¯ï¼Œç¬¬äºŒä¸ªæ–‡æœ¬å¯¹è±¡ä»£è¡¨å³ä½è¦æ·»åŠ çš„å¼•å·ï¼Œæ³¨æ„å’Œç¬¬ä¸€æ¡çš„åŒºåˆ«ï¼Œwæ‰€ä»£è¡¨çš„ä¸åŒã€‚ gUwï¼Œå¤§å†™ç›´åˆ°ä¸‹ä¸€ä¸ªå•è¯å‰ï¼Œæ˜¯åŠ¨è¯+moveï¼ŒgUiwï¼Œå¤§å†™å…‰æ ‡æ‰€åœ¨å•è¯ï¼Œæ˜¯åŠ¨è¯+èŒƒå›´+æ–‡æœ¬å¯¹è±¡ã€‚ ","date":"2021-04-20","objectID":"/vim/:8:0","tags":["vim","å·¥å…·"],"title":"vim","uri":"/vim/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"L1 Loss ä¹Ÿç§°ä¸ºMean Absolute Errorï¼Œå³å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰ï¼Œå®ƒè¡¡é‡çš„æ˜¯é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´è·ç¦»çš„å¹³å‡è¯¯å·®å¹…åº¦ï¼Œä½œç”¨èŒƒå›´ä¸º0åˆ°æ­£æ— ç©·ã€‚ ä¼˜ç‚¹ï¼šÂ å¯¹ç¦»ç¾¤ç‚¹ï¼ˆOutliersï¼‰æˆ–è€…å¼‚å¸¸å€¼æ›´å…·æœ‰é²æ£’æ€§ã€‚ ç¼ºç‚¹ï¼šÂ ç”±å›¾å¯çŸ¥å…¶åœ¨0ç‚¹å¤„çš„å¯¼æ•°ä¸è¿ç»­ï¼Œä½¿å¾—æ±‚è§£æ•ˆç‡ä½ä¸‹ï¼Œå¯¼è‡´æ”¶æ•›é€Ÿåº¦æ…¢ï¼›è€Œå¯¹äºè¾ƒå°çš„æŸå¤±å€¼ï¼Œå…¶æ¢¯åº¦ä¹ŸåŒå…¶ä»–åŒºé—´æŸå¤±å€¼çš„æ¢¯åº¦ä¸€æ ·å¤§ï¼Œæ‰€ä»¥ä¸åˆ©äºç½‘ç»œçš„å­¦ä¹ ã€‚ ","date":"2021-04-19","objectID":"/smooth-l1-loss/:1:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","Smooth L1 Loss"],"title":"Smooth L1 Loss","uri":"/smooth-l1-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"L2 Loss ä¹Ÿç§°ä¸ºMean Squred Errorï¼Œå³å‡æ–¹å·®ï¼ˆMSEï¼‰ï¼Œå®ƒè¡¡é‡çš„æ˜¯é¢„æµ‹å€¼ä¸çœŸå®1å€¼ä¹‹é—´è·ç¦»çš„å¹³æ–¹å’Œï¼Œä½œç”¨èŒƒå›´åŒä¸º0åˆ°æ­£æ— ç©·ã€‚ ä¼˜ç‚¹ï¼šÂ æ”¶æ•›é€Ÿåº¦å¿«ï¼Œèƒ½å¤Ÿå¯¹æ¢¯åº¦ç»™äºˆåˆé€‚çš„æƒ©ç½šæƒé‡ï¼Œè€Œä¸æ˜¯â€œä¸€è§†åŒä»â€ï¼Œä½¿æ¢¯åº¦æ›´æ–°çš„æ–¹å‘å¯ä»¥æ›´åŠ ç²¾ç¡®ã€‚ ç¼ºç‚¹ï¼šÂ å¯¹å¼‚å¸¸å€¼ååˆ†æ•æ„Ÿï¼Œæ¢¯åº¦æ›´æ–°çš„æ–¹å‘å¾ˆå®¹æ˜“å—ç¦»ç¾¤ç‚¹æ‰€ä¸»å¯¼ï¼Œä¸å…·å¤‡é²æ£’æ€§ã€‚ æä¸€å˜´ï¼ŒçœŸçš„ä¸ç†è§£é²æ£’æ€§è¿™ä¸ªç¿»è¯‘çš„å«ä¹‰ï¼Œåæ¥æ‰çŸ¥é“æ˜¯éŸ³è¯‘ï¼ŒçœŸçš„æ˜¯ï¼Œæ¯’å®³äº†å¤šå°‘äººã€‚ã€‚ç†è§£æˆç¨³å®šæ€§å°±è¡Œã€‚ ","date":"2021-04-19","objectID":"/smooth-l1-loss/:2:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","Smooth L1 Loss"],"title":"Smooth L1 Loss","uri":"/smooth-l1-loss/"},{"categories":["Deep Learning","æŸå¤±å‡½æ•°"],"content":"Smooth L1 Loss ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œå¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹å…¶å®äºŒè€…éƒ½ä¸ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦æ–°çš„æŸå¤±å‡½æ•°ã€‚å³å¹³æ»‘çš„L1æŸå¤±ï¼ˆSLL)ã€‚ SLLé€šè¿‡ç»¼åˆL1å’ŒL2æŸå¤±çš„ä¼˜ç‚¹ï¼Œåœ¨0ç‚¹å¤„é™„è¿‘é‡‡ç”¨äº†L2æŸå¤±ä¸­çš„å¹³æ–¹å‡½æ•°ï¼Œè§£å†³äº†L1æŸå¤±åœ¨0ç‚¹å¤„æ¢¯åº¦ä¸å¯å¯¼çš„é—®é¢˜ï¼Œä½¿å…¶æ›´åŠ å¹³æ»‘æ˜“äºæ”¶æ•›ã€‚æ­¤å¤–ï¼Œåœ¨|x|\u003e1çš„åŒºé—´ä¸Šï¼Œå®ƒåˆé‡‡ç”¨äº†L1æŸå¤±ä¸­çš„çº¿æ€§å‡½æ•°ï¼Œä½¿å¾—æ¢¯åº¦èƒ½å¤Ÿå¿«é€Ÿä¸‹é™ã€‚ é€šè¿‡å¯¹è¿™ä¸‰ä¸ªæŸå¤±å‡½æ•°è¿›è¡Œæ±‚å¯¼å¯ä»¥å‘ç°ï¼ŒL1æŸå¤±çš„å¯¼æ•°ä¸ºå¸¸æ•°ï¼Œå¦‚æœä¸åŠæ—¶è°ƒæ•´å­¦ä¹ ç‡ï¼Œé‚£ä¹ˆå½“å€¼è¿‡å°æ—¶ï¼Œä¼šå¯¼è‡´æ¨¡å‹å¾ˆéš¾æ”¶æ•›åˆ°ä¸€ä¸ªè¾ƒé«˜çš„ç²¾åº¦ï¼Œè€Œæ˜¯è¶‹å‘äºä¸€ä¸ªå›ºå®šå€¼é™„è¿‘æ³¢åŠ¨ã€‚åè¿‡æ¥ï¼Œå¯¹äºL2æŸå¤±æ¥è¯´ï¼Œç”±äºåœ¨è®­ç»ƒåˆæœŸå€¼è¾ƒå¤§æ—¶ï¼Œå…¶å¯¼æ•°å€¼ä¹Ÿä¼šç›¸åº”è¾ƒå¤§ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®šã€‚æœ€åï¼Œå¯ä»¥å‘ç°Smooth L1åœ¨è®­ç»ƒåˆæœŸè¾“å…¥æ•°å€¼è¾ƒå¤§æ—¶èƒ½å¤Ÿè¾ƒä¸ºç¨³å®šåœ¨æŸä¸€ä¸ªæ•°å€¼ï¼Œè€Œåœ¨åæœŸè¶‹å‘äºæ”¶æ•›æ—¶ä¹Ÿèƒ½å¤ŸåŠ é€Ÿæ¢¯åº¦çš„å›ä¼ ï¼Œå¾ˆå¥½çš„è§£å†³äº†å‰é¢ä¸¤è€…æ‰€å­˜åœ¨çš„é—®é¢˜ã€‚ ","date":"2021-04-19","objectID":"/smooth-l1-loss/:3:0","tags":["Deep Learning","æŸå¤±å‡½æ•°","Smooth L1 Loss"],"title":"Smooth L1 Loss","uri":"/smooth-l1-loss/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ— é‡å åŒºé—´ https://leetcode-cn.com/problems/non-overlapping-intervals/ åˆ©ç”¨äº†è´ªå¿ƒ ç§»é™¤çš„æ•°ç›®å°±æ˜¯æ€»æ•°ç›®å‡å»æ¡ä»¶æˆç«‹çš„æ•°ç›® class Solution: def eraseOverlapIntervals(self, intervals: List[List[int]]) -\u003e int: if len(intervals) == 0: return 0 res = 0 mins = -float(\"inf\") for i in sorted(intervals,key=lambda i:i[1]): if i[0] \u003e= mins: res += 1 mins = i[1] return len(intervals) - res æ³¨æ„æ˜¯æ ¹æ®endè¿›è¡Œæ’åºçš„ï¼Œå¼•ç”¨åˆ«äººçš„è§£é‡Š@HONGYANG æ¯”å¦‚ä½ ä¸€å¤©è¦å‚åŠ å‡ ä¸ªæ´»åŠ¨ï¼Œè¿™ä¸ªæ´»åŠ¨å¼€å§‹çš„å¤šæ—©å…¶å®ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä½ ç»“æŸçš„å¤šæ—©ï¼Œæ—©æ™¨7ç‚¹å°±å¼€å§‹äº†ç„¶åä¸€ææä¸€å¤©ï¼Œé‚£ä½ ä»Šå¤©ä¹Ÿå°±åªèƒ½å‚åŠ è¿™ä¸€ä¸ªæ´»åŠ¨ï¼›ä½†å¦‚æœè¿™ä¸ªæ´»åŠ¨å¼€å§‹çš„ä¸æ—©ï¼Œæ¯”å¦‚9ç‚¹æ‰å¼€å§‹ï¼Œä½†æ˜¯éšä¾¿ææ10ç‚¹å°±ç»“æŸäº†ï¼Œé‚£ä½ æ¥ä¸‹æ¥å°±è¿˜æœ‰å¤§åŠå¤©çš„æ—¶é—´å¯ä»¥å‚åŠ å…¶ä»–æ´»åŠ¨ã€‚ è¿™å°±æ˜¯ä¸ºå•¥è¦ç€çœ¼äºendï¼Œè€Œä¸æ˜¯startã€‚ è´ªå¿ƒå°±æ˜¯è€ƒè™‘å½“å‰æœ€ä¼˜è§£ ","date":"2021-04-16","objectID":"/%E6%97%A0%E9%87%8D%E5%8F%A0%E5%8C%BA%E9%97%B4/:0:0","tags":["ç®—æ³•é¢˜","æ— é‡å åŒºé—´"],"title":"æ— é‡å åŒºé—´","uri":"/%E6%97%A0%E9%87%8D%E5%8F%A0%E5%8C%BA%E9%97%B4/"},{"categories":["ç®—æ³•é¢˜"],"content":"å¯¹è§’çº¿éå† ","date":"2021-04-13","objectID":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/:0:0","tags":["ç®—æ³•é¢˜","å¯¹è§’çº¿éå†"],"title":"å¯¹è§’çº¿éå†","uri":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š â€‹ https://leetcode-cn.com/problems/diagonal-traverse/ ","date":"2021-04-13","objectID":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/:1:0","tags":["ç®—æ³•é¢˜","å¯¹è§’çº¿éå†"],"title":"å¯¹è§’çº¿éå†","uri":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š â€‹ æ¯ä¸ªå¯¹è§’çº¿çš„ä¸¤ç´¢å¼•ä¹‹å’Œæ˜¯ä¸€æ ·çš„ ","date":"2021-04-13","objectID":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/:2:0","tags":["ç®—æ³•é¢˜","å¯¹è§’çº¿éå†"],"title":"å¯¹è§’çº¿éå†","uri":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def findDiagonalOrder(self, matrix: List[List[int]]) -\u003e List[int]: if not matrix: return [] hashs = collections.defaultdict(list) row, col = len(matrix), len(matrix[0]) for i in range(row): for j in range(col): hashs[j + i].append(matrix[i][j]) res = [] flag = True for k, v in sorted(hashs.items()): if flag: res.extend(v[::-1]) else: res.extend(v) flag = not flag return res æ³¨æ„flagçš„ä½œç”¨ ","date":"2021-04-13","objectID":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/:3:0","tags":["ç®—æ³•é¢˜","å¯¹è§’çº¿éå†"],"title":"å¯¹è§’çº¿éå†","uri":"/%E5%AF%B9%E8%A7%92%E7%BA%BF%E9%81%8D%E5%8E%86/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"ä¸»æˆåˆ†åˆ†æ(PCA) ä¸»æˆåˆ†åˆ†æï¼ˆPrincipal components analysisï¼Œä»¥ä¸‹ç®€ç§°PCAï¼‰æ˜¯æœ€é‡è¦çš„é™ç»´æ–¹æ³•ä¹‹ä¸€ã€‚åœ¨æ•°æ®å‹ç¼©æ¶ˆé™¤å†—ä½™å’Œæ•°æ®å™ªéŸ³æ¶ˆé™¤ç­‰é¢†åŸŸéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚æ³¨æ„çš„æ˜¯PCAå±äºæ— ç›‘ç£å­¦ä¹ ã€‚ PCAé™ç»´çš„åŸåˆ™æ˜¯æŠ•å½±æ–¹å·®æœ€å¤§ã€‚ ä½¿ç”¨PCAæ—¶å¦‚æœæœ‰ä¸åŒç§ç±»çš„æ•°æ®ï¼ŒPCAä¼šæŠŠè¿™äº›æ•°æ®æ··åˆåœ¨ä¸€èµ·é™ç»´ã€‚ PCAé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ‰¾å‡ºæ•°æ®é‡Œæœ€ä¸»è¦çš„æ–¹é¢ï¼Œç”¨æ•°æ®é‡Œæœ€ä¸»è¦çš„æ–¹é¢æ¥ä»£æ›¿åŸå§‹æ•°æ®ã€‚å…·ä½“çš„ï¼Œå‡å¦‚æˆ‘ä»¬çš„æ•°æ®é›†æ˜¯nç»´çš„ï¼Œå…±æœ‰mä¸ªæ•°æ®(x(1),x(2),â€¦,x(m))ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™mä¸ªæ•°æ®çš„ç»´åº¦ä»nç»´é™åˆ°nâ€™ç»´ï¼Œå¸Œæœ›è¿™mä¸ªnâ€™ç»´çš„æ•°æ®é›†å°½å¯èƒ½çš„ä»£è¡¨åŸå§‹æ•°æ®é›†ã€‚æˆ‘ä»¬çŸ¥é“æ•°æ®ä»nç»´é™åˆ°nâ€™ç»´è‚¯å®šä¼šæœ‰æŸå¤±ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›æŸå¤±å°½å¯èƒ½çš„å°ã€‚é‚£ä¹ˆå¦‚ä½•è®©è¿™nâ€™ç»´çš„æ•°æ®å°½å¯èƒ½è¡¨ç¤ºåŸæ¥çš„æ•°æ®å‘¢ï¼Ÿ ","date":"2021-04-12","objectID":"/pca/:0:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"åæ–¹å·®çŸ©é˜µ åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œæ–¹å·®æ˜¯ç”¨æ¥åº¦é‡å•ä¸ªéšæœºå˜é‡çš„ç¦»æ•£ç¨‹åº¦ï¼Œè€Œåæ–¹å·®åˆ™ä¸€èˆ¬ç”¨æ¥åˆ»ç”»ä¸¤ä¸ªéšæœºå˜é‡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œå…¶ä¸­ï¼Œæ–¹å·®çš„è®¡ç®—å…¬å¼ä¸º: \\[ \\sigma_x^2 = \\frac{1}{n}\\sum_{i=1}^n(x-\\bar{x})^2 \\] åæ–¹å·®çš„å…¬å¼ä¸º: \\[ \\sigma(x,y) = \\frac{1}{n-1}\\sum_{i=1}^n(x_i-\\bar{x})(y_i-\\bar{y}) \\] æ ¹æ®æ–¹å·®çš„å®šä¹‰ï¼Œç»™å®šdä¸ªéšæœºå˜é‡\\(x_k,k=1,2,\\dots,d\\)ï¼Œè¿™äº›éšæœºå˜é‡çš„æ–¹å·®ä¸º \\[ \\sigma(x_k,x_k) = \\frac{1}{n-1}\\sum_{i=1}^n(x_{ki}-\\bar{x_k})^2,k=1,2,\\dots,d \\] å› æ­¤å¯ä»¥æ±‚å‡ºä¸¤ä¸¤ä¹‹é—´çš„åæ–¹å·® \\[ \\sigma(x_m,x_k) = \\frac{1}{n-1}\\sum_{i=1}^n(x_{mi}-\\bar{x_m})(x_{ki}-\\bar{x_k}) \\] å› æ­¤ï¼Œåæ–¹å·®çŸ©é˜µä¸º \\[ \\sum = \\begin{bmatrix} \\sigma(x_1,x_1) \u0026 \\cdots \u0026 \\sigma(x_1,x_d) \\\\\\\\ \\vdots \u0026 \\ddots \u0026 \\vdots \\\\\\\\ \\sigma(x_d,x_1) \u0026 \\cdots \u0026 \\sigma(x_d,x_d) \\end{bmatrix} \\] ","date":"2021-04-12","objectID":"/pca/:1:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•ä¼˜åŒ– è®¾åŸå§‹æ•°æ®çŸ©é˜µ X å¯¹åº”çš„åæ–¹å·®çŸ©é˜µä¸º Cï¼Œè€Œ P æ˜¯ä¸€ç»„åŸºæŒ‰è¡Œç»„æˆçš„çŸ©é˜µï¼Œè®¾ Y=PXï¼Œåˆ™ Y ä¸º X å¯¹ P åšåŸºå˜æ¢åçš„æ•°æ®ã€‚è®¾ Y çš„åæ–¹å·®çŸ©é˜µä¸º Dï¼Œæˆ‘ä»¬æ¨å¯¼ä¸€ä¸‹ D ä¸ C çš„å…³ç³»ï¼š \\[ D = \\frac{1}{m}YY^T \\\\\\\\ =\\frac{1}{m}(PX)(PX)^T \\\\\\\\ =\\frac{1}{m}PXX^TP^T \\\\\\\\ =P(\\frac{1}{m}XX^T)P^T \\\\\\\\ =PCP^T \\] æˆ‘ä»¬ä»¤P=\\(w^T\\),ä»¤åŸæœ¬çš„åæ–¹å·®ä¸ºAï¼Œäºæ˜¯æˆ‘ä»¬æœ‰ä¼˜åŒ–ç›®æ ‡å¦‚ä¸‹ï¼š \\[ \\begin{cases} \\max{w^TAw} \\\\\\\\ s.t. w^Tw = 1 \\end{cases} \\] ç„¶åæ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š \\[ L(w) = w^TAw + \\lambda(1-w^Tw) \\] å¯¹wæ±‚å¯¼ï¼š \\[ Aw = \\lambda w \\] åˆ™æ–¹å·®\\(D(x) = w^TAw = \\lambda w^Tw = \\lambda\\) äºæ˜¯æˆ‘ä»¬å‘ç°ï¼Œx æŠ•å½±åçš„æ–¹å·®å°±æ˜¯åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ã€‚æˆ‘ä»¬è¦æ‰¾åˆ°æœ€å¤§æ–¹å·®ä¹Ÿå°±æ˜¯åæ–¹å·®çŸ©é˜µæœ€å¤§çš„ç‰¹å¾å€¼ï¼Œæœ€ä½³æŠ•å½±æ–¹å‘å°±æ˜¯æœ€å¤§ç‰¹å¾å€¼æ‰€å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œæ¬¡ä½³å°±æ˜¯ç¬¬äºŒå¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ","date":"2021-04-12","objectID":"/pca/:2:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"å¯¹è§’çŸ©é˜µ ç”±ä¸Šæ–‡çŸ¥é“ï¼Œåæ–¹å·®çŸ©é˜µ C æ˜¯ä¸€ä¸ªæ˜¯å¯¹ç§°çŸ©é˜µï¼Œåœ¨çº¿æ€§ä»£æ•°ä¸­å®å¯¹ç§°çŸ©é˜µæœ‰ä¸€ç³»åˆ—éå¸¸å¥½çš„æ€§è´¨ï¼š å®å¯¹ç§°çŸ©é˜µä¸åŒç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å¿…ç„¶æ­£äº¤ã€‚ è®¾ç‰¹å¾å‘é‡\\(\\lambda\\) é‡æ•°ä¸º rï¼Œåˆ™å¿…ç„¶å­˜åœ¨ r ä¸ªçº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡å¯¹åº”äº \\(\\lambda\\) ï¼Œå› æ­¤å¯ä»¥å°†è¿™ r ä¸ªç‰¹å¾å‘é‡å•ä½æ­£äº¤åŒ–ã€‚ å®å¯¹ç§°çŸ©é˜µä¸€å®šå¯ä»¥å¯¹è§’åŒ– ç”±ä¸Šé¢ä¸¤æ¡å¯çŸ¥ï¼Œä¸€ä¸ª n è¡Œ n åˆ—çš„å®å¯¹ç§°çŸ©é˜µä¸€å®šå¯ä»¥æ‰¾åˆ° n ä¸ªå•ä½æ­£äº¤ç‰¹å¾å‘é‡ï¼Œè®¾è¿™ n ä¸ªç‰¹å¾å‘é‡ä¸º \\(e_1,e_2,\\cdots,e_n\\)ï¼Œæˆ‘ä»¬å°†å…¶æŒ‰åˆ—ç»„æˆçŸ©é˜µï¼š \\(E=(e_1,e_2,\\cdots,e_n)\\)ã€‚ å¯¹äºåæ–¹å·®çŸ©é˜µCæœ‰ä»¥ä¸‹ç»“è®º: \\[ E^TCE = \\begin{bmatrix} \\lambda_1 \\\\\\\\ \u0026\\lambda_2 \\\\\\\\ \u0026\u0026 \\ddots \\\\\\\\ \u0026\u0026\u0026 \\lambda_n \\end{bmatrix} \\] æ³¨ï¼šå› ä¸ºEä¸ºæ­£äº¤çŸ©é˜µï¼Œåˆ™\\(E^{-1}\\) = \\(E^T\\) ,è¿™ä¸ªè¿‡ç¨‹æˆä¸ºç›¸ä¼¼å¯¹è§’åŒ–ï¼Œ\\(\\lambda_n\\)ä¸ºCçš„ç‰¹å¾å€¼ï¼Œå¯¹åº”çš„ç‰¹å¾å‘é‡ä¸º\\(e_n\\) è¿™éƒ½æ˜¯çº¿ä»£çš„åŸºç¡€çŸ¥è¯†ã€‚ ","date":"2021-04-12","objectID":"/pca/:3:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"SVD å¤åˆ¶ä¸€ä¸‹å°†åæ–¹å·®çŸ©é˜µå†™æˆä¸­å¿ƒåŒ–çš„å½¢å¼ï¼š \\[ \\begin{align}S\u0026=\\frac{1}{N}\\sum\\limits_{i=1}^N(x_i-\\overline{x})(x_i-\\overline{x})^T\\nonumber\\\\\\\\ \u0026=\\frac{1}{N}(x_1-\\overline{x},x_2-\\overline{x},\\cdots,x_N-\\overline{x})(x_1-\\overline{x},x_2-\\overline{x},\\cdots,x_N-\\overline{x})^T\\nonumber\\\\\\\\ \u0026=\\frac{1}{N}(X^T-\\frac{1}{N}X^T\\mathbb{I}_{N1}\\mathbb{I}_{N1}^T)(X^T-\\frac{1}{N}X^T\\mathbb{I}_{N1}\\mathbb{I}_{N1}^T)^T\\nonumber\\\\\\\\ \u0026=\\frac{1}{N}X^T(E_N-\\frac{1}{N}\\mathbb{I}_{N1}\\mathbb{I}_{1N})(E_N-\\frac{1}{N}\\mathbb{I}_{N1}\\mathbb{I}_{1N})^TX\\nonumber\\\\\\\\ \u0026=\\frac{1}{N}X^TH_NH_N^TX\\nonumber\\\\\\\\ \u0026=\\frac{1}{N}X^TH_NH_NX=\\frac{1}{N}X^THX \\end{align} \\] å¯¹ä¸­å¿ƒåŒ–åçš„æ•°æ®é›†è¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼š \\[ HX=U\\Sigma V^T,U^TU=E_N,V^TV=E_p,\\Sigma:N\\times p \\] äºæ˜¯ï¼š \\[ S=\\frac{1}{N}X^THX=\\frac{1}{N}X^TH^THX=\\frac{1}{N}V\\Sigma^T\\Sigma V^T \\] å› æ­¤ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹ä¸­å¿ƒåŒ–åçš„æ•°æ®é›†è¿›è¡Œ SVDï¼Œå°±å¯ä»¥å¾—åˆ°ç‰¹å¾å€¼\\(\\Sigma^2\\)å’Œç‰¹å¾å‘é‡ \\(V\\)ï¼Œåœ¨æ–°åæ ‡ç³»ä¸­çš„åæ ‡å°±æ˜¯ï¼š \\[ HX\\cdot V \\] ## æ­¥éª¤ æ€»ç»“ä¸€ä¸‹ PCA çš„ç®—æ³•æ­¥éª¤ï¼š è®¾æœ‰ m æ¡ n ç»´æ•°æ®ã€‚ å¯¹æ‰€æœ‰çš„æ ·æœ¬è¿›è¡Œä¸­å¿ƒåŒ–ï¼š \\(x^{(i)} = x^{(i)}-\\frac{1}{m}\\sum_{j=1}^mx^{(j)}\\) è®¡ç®—æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ \\(XX^T\\) å¯¹çŸ©é˜µ\\(XX^T\\)è¿›è¡Œç‰¹å¾å€¼åˆ†è§£ 4ï¼‰å–å‡ºæœ€å¤§çš„nâ€™ä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡\\((w_1,w_2,...,w_{nâ€²})\\), å°†æ‰€æœ‰çš„ç‰¹å¾å‘é‡æ ‡å‡†åŒ–åï¼Œç»„æˆç‰¹å¾å‘é‡çŸ©é˜µWã€‚ 5ï¼‰å¯¹æ ·æœ¬é›†ä¸­çš„æ¯ä¸€ä¸ªæ ·æœ¬\\(x^{(i)}\\),è½¬åŒ–ä¸ºæ–°çš„æ ·æœ¬\\(z^{(i)}=W^Tx^{(i)}\\) 6) å¾—åˆ°è¾“å‡ºæ ·æœ¬é›†\\(D^â€²=(z^{(1)},z^{(2)},...,z^{(m)})\\) ","date":"2021-04-12","objectID":"/pca/:4:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"å®ä¾‹ å‡è®¾æˆ‘ä»¬çš„æ•°æ®é›†æœ‰10ä¸ªäºŒç»´æ•°æ®(2.5,2.4), (0.5,0.7), (2.2,2.9), (1.9,2.2), (3.1,3.0), (2.3, 2.7), (2, 1.6), (1, 1.1), (1.5, 1.6), (1.1, 0.9)ï¼Œéœ€è¦ç”¨PCAé™åˆ°1ç»´ç‰¹å¾ã€‚ é¦–å…ˆæˆ‘ä»¬å¯¹æ ·æœ¬ä¸­å¿ƒåŒ–ï¼Œè¿™é‡Œæ ·æœ¬çš„å‡å€¼ä¸º(1.81, 1.91),æ‰€æœ‰çš„æ ·æœ¬å‡å»è¿™ä¸ªå‡å€¼å‘é‡åï¼Œå³ä¸­å¿ƒåŒ–åçš„æ•°æ®é›†ä¸º(0.69, 0.49), (-1.31, -1.21), (0.39, 0.99), (0.09, 0.29), (1.29, 1.09), (0.49, 0.79), (0.19, -0.31), (-0.81, -0.81), (-0.31, -0.31), (-0.71, -1.01)ã€‚ ç°åœ¨æˆ‘ä»¬å¼€å§‹æ±‚æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µã€‚ ç„¶åæ±‚å‡ºç‰¹å¾å€¼\\((0.0490833989,1.28402771)\\)ï¼Œå¯¹åº”çš„ç‰¹å¾å‘é‡ä¸º \\((0.735178656,0.677873399)^T\\),\\((âˆ’0.677873399,âˆ’0.735178656)^T\\)ï¼Œ,ç”±äºæœ€å¤§çš„k=1ä¸ªç‰¹å¾å€¼ä¸º1.28402771,å¯¹äºçš„k=1ä¸ªç‰¹å¾å‘é‡ä¸º\\((âˆ’0.677873399,âˆ’0.735178656)^T\\). åˆ™æˆ‘ä»¬çš„W=\\((âˆ’0.677873399,âˆ’0.735178656)^T\\)ã€‚ ä»¬å¯¹æ‰€æœ‰çš„æ•°æ®é›†è¿›è¡ŒæŠ•å½±\\(z^{(i)}=W^Tx^{(i)}\\)ï¼Œå¾—åˆ°PCAé™ç»´åçš„10ä¸ªä¸€ç»´æ•°æ®é›†ä¸ºï¼š(-0.827970186ï¼Œ 1.77758033ï¼Œ -0.992197494ï¼Œ -0.274210416ï¼Œ -1.67580142ï¼Œ -0.912949103ï¼Œ 0.0991094375ï¼Œ 1.14457216, 0.438046137ï¼Œ 1.22382056) ","date":"2021-04-12","objectID":"/pca/:5:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"æ€§è´¨ ç¼“è§£ç»´åº¦ç¾éš¾ï¼šPCA ç®—æ³•é€šè¿‡èˆå»ä¸€éƒ¨åˆ†ä¿¡æ¯ä¹‹åèƒ½ä½¿å¾—æ ·æœ¬çš„é‡‡æ ·å¯†åº¦å¢å¤§ï¼ˆå› ä¸ºç»´æ•°é™ä½äº†ï¼‰ï¼Œè¿™æ˜¯ç¼“è§£ç»´åº¦ç¾éš¾çš„é‡è¦æ‰‹æ®µï¼› é™å™ªï¼šå½“æ•°æ®å—åˆ°å™ªå£°å½±å“æ—¶ï¼Œæœ€å°ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å¾€å¾€ä¸å™ªå£°æœ‰å…³ï¼Œå°†å®ƒä»¬èˆå¼ƒèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šèµ·åˆ°é™å™ªçš„æ•ˆæœï¼› è¿‡æ‹Ÿåˆï¼šPCA ä¿ç•™äº†ä¸»è¦ä¿¡æ¯ï¼Œä½†è¿™ä¸ªä¸»è¦ä¿¡æ¯åªæ˜¯é’ˆå¯¹è®­ç»ƒé›†çš„ï¼Œè€Œä¸”è¿™ä¸ªä¸»è¦ä¿¡æ¯æœªå¿…æ˜¯é‡è¦ä¿¡æ¯ã€‚æœ‰å¯èƒ½èˆå¼ƒäº†ä¸€äº›çœ‹ä¼¼æ— ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™äº›çœ‹ä¼¼æ— ç”¨çš„ä¿¡æ¯æ°å¥½æ˜¯é‡è¦ä¿¡æ¯ï¼Œåªæ˜¯åœ¨è®­ç»ƒé›†ä¸Šæ²¡æœ‰å¾ˆå¤§çš„è¡¨ç°ï¼Œæ‰€ä»¥ PCA ä¹Ÿå¯èƒ½åŠ å‰§äº†è¿‡æ‹Ÿåˆï¼› ç‰¹å¾ç‹¬ç«‹ï¼šPCA ä¸ä»…å°†æ•°æ®å‹ç¼©åˆ°ä½ç»´ï¼Œå®ƒä¹Ÿä½¿å¾—é™ç»´ä¹‹åçš„æ•°æ®å„ç‰¹å¾ç›¸äº’ç‹¬ç«‹ï¼› ","date":"2021-04-12","objectID":"/pca/:6:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["Machine Learning","é™ç»´ç®—æ³•"],"content":"ä»£ç  # æ‰‹åŠ¨å®ç°PCAç®—æ³• import numpy as np def pca(data): \"\"\" ä¸»æˆåˆ†åˆ†æ :param data: æ•°æ®é›† :return: \"\"\" # æ•°æ®é›†çš„è¡Œæ•° num_data, num_feat = data.shape # å¯¹æ¯ä¸€åˆ—çš„æ•°æ®è¿›è¡Œå¹³å‡å€¼çš„è®¡ç®— mean_vec = np.mean(data, axis=0) # å¯¹æ•°æ®é›†ä¸­æ¯ä¸€è¡Œçš„æ•°æ®è¿›è¡Œå¹³å‡å€¼çš„è®¡ç®— data_mean_centered = data - mean_vec # è®¡ç®—åæ–¹å·®çŸ©é˜µ sigma = np.dot(data_mean_centered.T, data_mean_centered) / num_data # è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ eig_val, eig_vec = np.linalg.eig(sigma) # å¯¹ç‰¹å¾å€¼è¿›è¡Œæ’åº eig_pairs = [(np.abs(eig_val[i]), eig_vec[:, i]) for i in range(len(eig_val))] eig_pairs.sort(key=lambda x: x[0], reverse=True) # è¦é™ç»´çš„ç»´æ•°ï¼Œè¿™é‡Œä»¥2ä¸ºä¾‹ã€‚å°†ç‰¹å¾å‘é‡ä»¥åˆ—å‘é‡å½¢å¼æ‹¼åˆã€‚ matrix_w = np.hstack([eig_pairs[i][1].reshape(-1, 1) for i in range(2)]) # å°†åŸå§‹æ•°æ®è¿›è¡ŒæŠ•å½±ã€‚ res = data.dot(matrix_w) print(res) pca(np.array([[1, 2, 5], [3, 4, 6], [5, 6, 9], [3, 2 ,5]])) [[ 4.78637704 -1.46926342] [ 7.62278435 -0.82094287] [11.68194836 -0.79767573] [ 5.77746434 0.2656909 ]] å‚è€ƒæ–‡ç«  https://zhuanlan.zhihu.com/p/77151308 https://www.cnblogs.com/pinard/p/6239403.html ","date":"2021-04-12","objectID":"/pca/:7:0","tags":["Machine Learning","é™ç»´ç®—æ³•","PCA"],"title":"PCA","uri":"/pca/"},{"categories":["NLP"],"content":"Bert BERT çš„æ¨¡å‹æ¶æ„éå¸¸ç®€å•ï¼Œä½ å·²ç»çŸ¥é“å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼šå®ƒåªæ˜¯ Transformer çš„ç¼–ç å™¨ã€‚æ–°çš„æ˜¯è®­ç»ƒç›®æ ‡å’Œ BERT ç”¨äºä¸‹æ¸¸ä»»åŠ¡çš„æ–¹å¼ã€‚ æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨çº¯æ–‡æœ¬è®­ç»ƒï¼ˆåŒå‘ï¼‰ç¼–ç å™¨ï¼Ÿæˆ‘ä»¬åªçŸ¥é“ä»å·¦åˆ°å³çš„è¯­è¨€å»ºæ¨¡ç›®æ ‡ï¼Œä½†å®ƒä»…é€‚ç”¨äºæ¯ä¸ªæ ‡è®°åªèƒ½ä½¿ç”¨ä»¥å‰çš„æ ‡è®°ï¼ˆå¹¶ä¸”çœ‹ä¸åˆ°æœªæ¥ï¼‰çš„è§£ç å™¨ã€‚BERT çš„ä½œè€…æå‡ºäº†å…¶ä»–æœªæ ‡è®°æ•°æ®çš„è®­ç»ƒç›®æ ‡ã€‚åœ¨è®¨è®ºå®ƒä»¬ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹ BERT ä½œä¸º Transformer ç¼–ç å™¨çš„è¾“å…¥ã€‚ è®­ç»ƒè¾“å…¥ï¼šå¸¦æœ‰ç‰¹æ®Šæ ‡è®°çš„å¥å­å¯¹ åœ¨è®­ç»ƒä¸­ï¼ŒBERT çœ‹åˆ°ç”¨ç‰¹æ®Šçš„æ ‡è®°åˆ†éš”ç¬¦Â [SEP] åˆ†éš”çš„å¥å­å¯¹ã€‚ä¸ºäº†è®©æ¨¡å‹è½»æ¾åŒºåˆ†è¿™äº›å¥å­ï¼Œé™¤äº†æ ‡è®°å’Œä½ç½®åµŒå…¥ä¹‹å¤–ï¼Œå®ƒè¿˜ä½¿ç”¨äº†æ®µåµŒå…¥ã€‚ å¦ä¸€ä¸ªç‰¹æ®Šæ ‡è®°æ˜¯ [CLS] ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒå°±æ˜¯è¡¨ç¤ºæ•´ä¸ªå¥å­çš„ç±»åˆ«çš„tokenã€‚åœ¨è®­ç»ƒä¸­ï¼Œå®ƒç”¨äºæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šçœ‹åˆ°çš„ NSP ç›®æ ‡ã€‚ä¸€æ—¦æ¨¡å‹è¢«è®­ç»ƒï¼Œå®ƒå°±ä¼šè¢«ç”¨äºä¸‹æ¸¸ä»»åŠ¡ã€‚ ","date":"2021-04-08","objectID":"/bert/:0:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"é¢„è®­ç»ƒç›®æ ‡ï¼šNSP Next Sentence Prediction (NSP) ç›®æ ‡æ˜¯ä¸€ä¸ªäºŒå…ƒåˆ†ç±»ä»»åŠ¡ã€‚æ ¹æ®ç‰¹æ®Šæ ‡è®°[CLS] çš„æœ€åä¸€å±‚è¡¨ç¤ºÂ ï¼Œè¯¥æ¨¡å‹é¢„æµ‹è¿™ä¸¤ä¸ªå¥å­æ˜¯å¦æ˜¯æŸäº›æ–‡æœ¬ä¸­çš„è¿ç»­å¥å­ã€‚ è¾“å…¥ï¼šÂ [CLS] è¿™ä¸ªäººå»äº† [MASK] å•†åº— [SEP] ä»–ä¹°äº†ä¸€åŠ ä»‘ [MASK] ç‰›å¥¶ [SEP] æ ‡ç­¾ï¼šÂ isNext è¾“å…¥ï¼šÂ [CLS] ç”·å­å»äº† [MASK] å•†åº— [SEP] ä¼é¹… [MASK] æ­£åœ¨é£è¡Œ##less é¸Ÿ [SEP] æ ‡ç­¾ï¼šÂ notNext è¯¥ä»»åŠ¡æ•™æ¨¡å‹ç†è§£å¥å­ä¹‹é—´çš„å…³ç³»ã€‚æ­£å¦‚æˆ‘ä»¬ç¨åå°†çœ‹åˆ°çš„ï¼Œè¿™å°†ä½¿ BERT èƒ½å¤Ÿç”¨äºéœ€è¦æŸç§æ¨ç†çš„å¤æ‚ä»»åŠ¡ã€‚ ","date":"2021-04-08","objectID":"/bert/:1:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"é¢„è®­ç»ƒç›®æ ‡ï¼šMLMï¼ˆæ©è”½è¯­è¨€æ¨¡å‹ï¼‰ BERT æœ‰ä¸¤ä¸ªè®­ç»ƒç›®æ ‡ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯ Masked Language Modeling (MLM) ç›®æ ‡ã€‚å¯¹äº MLM ç›®æ ‡ï¼Œåœ¨æ­¥éª¤ä¸­ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š é€‰æ‹©ä¸€äº›æ ‡è®° ï¼ˆæ¯ä¸ªæ ‡è®°ä»¥ 15% çš„æ¦‚ç‡è¢«é€‰ä¸­ï¼‰ æ›¿æ¢è¿™äº›é€‰å®šçš„æ ‡è®° ï¼ˆä½¿ç”¨ç‰¹æ®Šæ ‡è®° [MASK] (p=80%)ï¼Œéšæœºæ ‡è®° (p=10%)ï¼ŒåŸå§‹æ ‡è®°ï¼ˆä¿æŒä¸å˜ï¼‰(p=10%)ï¼‰ é¢„æµ‹åŸå§‹æ ‡è®°ï¼ˆè®¡ç®—æŸå¤±ï¼‰ å…¶æ€æƒ³æ¥è‡ªäºå®Œå½¢å¡«ç©ºï¼Œä¹Ÿå€Ÿé‰´äº†CBOWçš„æ€æƒ³ã€‚ MLM ä»ç„¶æ˜¯è¯­è¨€å»ºæ¨¡ï¼šç›®æ ‡æ˜¯æ ¹æ®æ–‡æœ¬çš„æŸäº›éƒ¨åˆ†é¢„æµ‹å¥å­/æ–‡æœ¬ä¸­çš„ä¸€äº›æ ‡è®°ã€‚ä¸ºäº†æ›´æ¸…æ¥šï¼Œè®©æˆ‘ä»¬å°† MLM ä¸æ ‡å‡†çš„ä»å·¦åˆ°å³çš„è¯­è¨€å»ºæ¨¡ç›®æ ‡è¿›è¡Œæ¯”è¾ƒ åœ¨æ¯ä¸€æ­¥ï¼Œæ ‡å‡†çš„ä»å·¦åˆ°å³çš„ LMs æ ¹æ®ä¹‹å‰çš„æ ‡è®°é¢„æµ‹ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚è¿™æ„å‘³ç€æœ€ç»ˆè¡¨ç¤ºï¼Œå³æ¥è‡ªæœ€ç»ˆå±‚çš„ç”¨äºé¢„æµ‹çš„è¡¨ç¤ºï¼Œä»…ç¼–ç å…ˆå‰çš„ä¸Šä¸‹æ–‡ï¼Œå³å®ƒä»¬Â çœ‹ä¸åˆ°æœªæ¥ã€‚ ä¸åŒçš„æ˜¯ï¼ŒMLMå¯ä»¥ä¸€æ¬¡çœ‹åˆ°æ•´ä¸ªæ–‡æœ¬ï¼Œä½†æœ‰äº›æ ‡è®°è¢«ç ´åäº†ï¼šè¿™å°±æ˜¯ BERT æ˜¯åŒå‘çš„åŸå› ã€‚è¯·æ³¨æ„ï¼Œä¸ºäº†è®© ELMo çŸ¥é“å·¦å³ä¸Šä¸‹æ–‡ï¼Œä½œè€…å¿…é¡»è®­ç»ƒä¸¤ä¸ªä¸åŒçš„å•å‘ LM(å³åŒå‘LSTM)ï¼Œç„¶åå°†å®ƒä»¬çš„è¡¨ç¤ºè¿æ¥èµ·æ¥ã€‚åœ¨ BERT ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™æ ·åšï¼šä¸€ä¸ªæ¨¡å‹å°±è¶³å¤Ÿäº†ã€‚ æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼Œåœ¨ä»£ç å®ç°çš„æ—¶å€™ï¼Œæ³¨æ„ç‰¹æ®Šçš„æ ‡è®°å¦‚[SEP][CLS] ç­‰ä¸è¦æ›¿æ¢ï¼Œ è¿˜æœ‰[PAD] ","date":"2021-04-08","objectID":"/bert/:2:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"æ•°æ®é›†æ„å»ºä»£ç  class BERTDataset(Dataset): def __init__(self, corpus_path, vocab, seq_len, encoding=\"utf-8\", corpus_lines=None, on_memory=True): self.vocab = vocab self.seq_len = seq_len self.on_memory = on_memory self.corpus_lines = corpus_lines self.corpus_path = corpus_path self.encoding = encoding with open(corpus_path, \"r\", encoding=encoding) as f: if self.corpus_lines is None and not on_memory: for _ in tqdm.tqdm(f, desc=\"Loading Dataset\", total=corpus_lines): self.corpus_lines += 1 if on_memory: self.lines = [line[:-1].split(\"\\t\") for line in tqdm.tqdm(f, desc=\"Loading Dataset\", total=corpus_lines)] # ä¸€è¡Œæœ‰ä¸¤ä¸ªå¥å­ï¼Œåˆ†éš”ç¬¦æ˜¯\\t self.corpus_lines = len(self.lines) if not on_memory: self.file = open(corpus_path, \"r\", encoding=encoding) self.random_file = open(corpus_path, \"r\", encoding=encoding) for _ in range(random.randint(self.corpus_lines if self.corpus_lines \u003c 1000 else 1000)): self.random_file.__next__() def __len__(self): return self.corpus_lines def __getitem__(self, item): t1, t2, is_next_label = self.random_sent(item) # is_next_label: 1 or 0ï¼Œ1ä»£è¡¨t2æ˜¯ç›¸é‚»å¥å­ï¼Œ0ä»£è¡¨ä¸æ˜¯ç›¸é‚»å¥å­ t1_random, t1_label = self.random_word(t1) # mlmä»»åŠ¡ t2_random, t2_label = self.random_word(t2) # [CLS] tag = SOS tag, [SEP] tag = EOS tag t1 = [self.vocab.sos_index] + t1_random + [self.vocab.eos_index] t2 = t2_random + [self.vocab.eos_index] t1_label = [self.vocab.pad_index] + t1_label + [self.vocab.pad_index] t2_label = t2_label + [self.vocab.pad_index] segment_label = ([1 for _ in range(len(t1))] + [2 for _ in range(len(t2))])[:self.seq_len] bert_input = (t1 + t2)[:self.seq_len] # æˆªæ–­ bert_label = (t1_label + t2_label)[:self.seq_len] padding = [self.vocab.pad_index for _ in range(self.seq_len - len(bert_input))] #pad bert_input.extend(padding), bert_label.extend(padding), segment_label.extend(padding) output = {\"bert_input\": bert_input, \"bert_label\": bert_label, \"segment_label\": segment_label, \"is_next\": is_next_label} return {key: torch.tensor(value) for key, value in output.items()} def random_word(self, sentence): # å¯¹sent tokenè¿›è¡Œmaskå¹¶è¿”å›maskåçš„label tokens = sentence.split() output_label = [] for i, token in enumerate(tokens): prob = random.random() if prob \u003c 0.15: prob /= 0.15 # 80% randomly change token to mask token if prob \u003c 0.8: tokens[i] = self.vocab.mask_index # 10% randomly change token to random token elif prob \u003c 0.9: tokens[i] = random.randrange(len(self.vocab)) # 10% randomly change token to current token else: tokens[i] = self.vocab.stoi.get(token, self.vocab.unk_index) output_label.append(self.vocab.stoi.get(token, self.vocab.unk_index)) # è¢«maskæ‰çš„tokenä½œä¸ºlabel else: tokens[i] = self.vocab.stoi.get(token, self.vocab.unk_index) output_label.append(0) # labelä¸º0ï¼Œè¿™æ ·è®¡ç®—lossæ—¶ä¸ç”¨è€ƒè™‘ï¼Œå› ä¸ºå¯ä»¥è®¾ç½®nn.NLLLoss(ignore_index=0) return tokens, output_label def random_sent(self, index): # æ ¹æ®idxé€‰æ‹©æŸå¯¹å¥å­å¹¶éšæœºè¿”å›ç›¸é‚»æˆ–ä¸ç›¸é‚»çš„å¥å­ã€‚ t1, t2 = self.get_corpus_line(index) # output_text, label(isNotNext:0, isNext:1) if random.random() \u003e 0.5: return t1, t2, 1 else: return t1, self.get_random_line(), 0 def get_corpus_line(self, item): # é€šè¿‡item idxé€‰æ‹©æŸå¯¹å¥å­ if self.on_memory: return self.lines[item][0], self.lines[item][1] else: line = self.file.__next__() if line is None: self.file.close() self.file = open(self.corpus_path, \"r\", encoding=self.encoding) line = self.file.__next__() t1, t2 = line[:-1].split(\"\\t\") return t1, t2 def get_random_line(self): # éšæœºé€‰ä¸€è¡Œ if self.on_memory: return self.lines[random.randrange(len(self.lines))][1] line = self.file.__next__() if line is None: self.file.close() self.file = open(self.corpus_path, \"r\", encoding=self.encoding) for _ in range(random.randint(self.corpus_lines if self.corpus_lines \u003c 1000 else 1000)): self.random_file.__next__() line = self.random_file.__next__() return line[:-1].split(\"\\t\")[1] ","date":"2021-04-08","objectID":"/bert/:3:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"å¾®è°ƒ ","date":"2021-04-08","objectID":"/bert/:4:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"åˆ†ç±» å¯¹äºåˆ†ç±»ä»»åŠ¡ç›´æ¥å–ç¬¬ä¸€ä¸ª[CLS] tokençš„final hidden stateï¼Œç„¶ååŠ ä¸€å±‚æƒé‡åsoftmaxè¾“å‡ºã€‚ \\[ P = softmax(CW^T) \\] ","date":"2021-04-08","objectID":"/bert/:4:1","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"å…¶å®ƒä»»åŠ¡ å…¶å®ƒä»»åŠ¡éœ€è¦ä¸€äº›è°ƒæ•´ ","date":"2021-04-08","objectID":"/bert/:4:2","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"é€‚é…å™¨(Adapter) åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè€ƒè™‘äº†å°†çŸ¥è¯†ä»é¢„è®­ç»ƒæ¨¡å‹ï¼ˆä¾‹å¦‚ BERTï¼‰è½¬ç§»åˆ°ä¸‹æ¸¸ä»»åŠ¡çš„æ ‡å‡†æ–¹æ³•ï¼šå¾®è°ƒã€‚â€œå¾®è°ƒâ€æ„å‘³ç€æ‚¨é‡‡ç”¨é¢„è®­ç»ƒæ¨¡å‹å¹¶ä»¥ç›¸å½“å°çš„å­¦ä¹ ç‡è®­ç»ƒæ‚¨æ„Ÿå…´è¶£çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œæƒ…æ„Ÿåˆ†ç±»ï¼‰ã€‚è¿™æ„å‘³ç€é¦–å…ˆï¼Œæ‚¨æ›´æ–°æ•´ä¸ªï¼ˆå¤§å‹ï¼‰æ¨¡å‹ï¼Œå…¶æ¬¡ï¼Œå¯¹äºæ¯ä¸ªä»»åŠ¡ï¼Œæ‚¨éœ€è¦å¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹çš„å•ç‹¬å‰¯æœ¬ã€‚æœ€åï¼Œå¯¹äºå‡ ä¸ªä¸‹æ¸¸ä»»åŠ¡ï¼Œæ‚¨æœ€ç»ˆä¼šå¾—åˆ°å¾ˆå¤šå¤§å‹æ¨¡å‹ - è¿™æ˜¯éå¸¸ä½æ•ˆçš„ï¼ Apdater-Bertçš„æƒ³æ³•æ˜¯å°†task-specific layeræ”¾åœ¨é¢„è®­ç»ƒæ¨¡å‹ä¸­é—´ï¼Œä¹Ÿå°±æ˜¯åŠ å…¥Adapterç»“æ„ï¼Œç„¶åå†»ç»“ä½é¢„è®­ç»ƒæ¨¡å‹å‚æ•°ï¼Œæœ€åæˆ‘ä»¬fientuningçš„æ—¶å€™ï¼Œåªæ›´æ–°Apdaterã€layerNormä»¥åŠä¸å…·ä½“ä»»åŠ¡ç›¸å…³çš„layerçš„å‚æ•°ã€‚å…·ä½“ç»“æ„å›¾å¦‚ä¸‹ï¼š å·¦å›¾æ˜¯Adapter-BERTä¸­çš„transformer layerï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªtransformer layerå¢åŠ äº†ä¸¤ä¸ªAdapter layerï¼Œåˆ†åˆ«åŠ åœ¨LayerNormä¹‹å‰ï¼Œå½“ç„¶äº†ï¼Œåœ¨è¿›è¡ŒLayerNormä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè®²Apdater layerçš„è¾“å‡ºè¿›è¡Œæ®‹å·®è¿æ¥ã€‚ å³å›¾æ˜¯Adapter layerçš„å…·ä½“ç»“æ„ç¤ºæ„ \u003eè¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨æ®‹å·®è¿æ¥ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå½“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæƒé‡éƒ½å¾ˆå°ï¼Œæ®‹å·®è¿æ¥å¯ä»¥ä¿è¯æ¨¡å‹è¾“å‡ºä¸é¢„è®­ç»ƒæ¨¡å‹ç›¸åŒã€‚ ","date":"2021-04-08","objectID":"/bert/:5:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"æ€»ç»“ æ€»ä¹‹BERTå°±åªæœ‰è¿™ä¹ˆå¤šæ–°çš„ç‰¹æ€§ï¼Œæˆ–è€…è¯´åˆ›æ–°ï¼Œä½†æ˜¯å®ƒä¸€ç»é—®ä¸–å°±æˆä¸ºäº†æ–°çš„éœ¸ä¸»ï¼Œå¯è§æ•ˆæœä¹‹å¥½ï¼ŒBERTè¿˜æœ‰å¾ˆå¤šç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œåé¢çœ‹åˆ°æˆ–è€…å­¦ä¹ åˆ°çš„æ—¶å€™ä¼šç»§ç»­è®°å½•ä¸‹æ¥ã€‚ ## ä¸€äº›é—®é¢˜ ","date":"2021-04-08","objectID":"/bert/:6:0","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"ä¸ºä»€ä¹ˆ Bert çš„ä¸‰ä¸ª Embedding å¯ä»¥è¿›è¡Œç›¸åŠ ï¼Ÿ å› ä¸ºä¸‰ä¸ª embedding ç›¸åŠ ç­‰ä»·äºä¸‰ä¸ªåŸå§‹ one-hot çš„æ‹¼æ¥å†ç»è¿‡ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œã€‚å’Œæ‹¼æ¥ç›¸æ¯”ï¼Œç›¸åŠ å¯ä»¥èŠ‚çº¦æ¨¡å‹å‚æ•°ã€‚ å¼•ç”¨è‹å»ºæ—è€å¸ˆçš„è¯ï¼š \u003e Embeddingçš„æ•°å­¦æœ¬è´¨ï¼Œå°±æ˜¯ä»¥one hotä¸ºè¾“å…¥çš„å•å±‚å…¨è¿æ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸–ç•Œä¸Šæœ¬æ²¡ä»€ä¹ˆEmbeddingï¼Œæœ‰çš„åªæ˜¯one hotã€‚ å‡è®¾ token Embedding çŸ©é˜µç»´åº¦æ˜¯ [4,768]ï¼›position Embedding çŸ©é˜µç»´åº¦æ˜¯ [3,768]ï¼›segment Embedding çŸ©é˜µç»´åº¦æ˜¯ [2,768]ã€‚ å¯¹äºä¸€ä¸ªå­—ï¼Œå‡è®¾å®ƒçš„ token one-hot æ˜¯[1,0,0,0]ï¼›å®ƒçš„ position one-hot æ˜¯[1,0,0]ï¼›å®ƒçš„ segment one-hot æ˜¯[1,0]ã€‚ é‚£è¿™ä¸ªå­—æœ€åçš„ word Embeddingï¼Œå°±æ˜¯ä¸Šé¢ä¸‰ç§ Embedding çš„åŠ å’Œã€‚ å¦‚æ­¤å¾—åˆ°çš„ word Embeddingï¼Œå’Œconcatåçš„ç‰¹å¾ï¼š[1,0,0,0,1,0,0,1,0]ï¼Œå†è¿‡ç»´åº¦ä¸º [4+3+2,768] = [9, 768] çš„å…¨è¿æ¥å±‚ï¼Œå¾—åˆ°çš„å‘é‡å…¶å®å°±æ˜¯ä¸€æ ·çš„ã€‚ ","date":"2021-04-08","objectID":"/bert/:6:1","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["NLP"],"content":"transformersä¸­bertæ¨¡å‹çš„è¾“å‡º ","date":"2021-04-08","objectID":"/bert/:6:2","tags":["NLP","BERT"],"title":"BERT","uri":"/bert/"},{"categories":["å·¥å…·"],"content":"å¸¸ç”¨å‘½ä»¤ ","date":"2021-04-04","objectID":"/git/:1:0","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"diff image.png git diffï¼šå½“å·¥ä½œåŒºæœ‰æ”¹åŠ¨ï¼Œä¸´æ—¶åŒºä¸ºç©ºï¼Œdiffçš„å¯¹æ¯”æ˜¯â€œå·¥ä½œåŒºâ€ä¸æœ€åä¸€æ¬¡commitæäº¤çš„ä»“åº“çš„å…±åŒæ–‡ä»¶â€ï¼›å½“å·¥ä½œåŒºæœ‰æ”¹åŠ¨ï¼Œä¸´æ—¶åŒºä¸ä¸ºç©ºï¼Œdiffå¯¹æ¯”çš„æ˜¯â€œå·¥ä½œåŒºâ€ä¸â€œæš‚å­˜åŒºâ€çš„å…±åŒæ–‡ä»¶â€ã€‚ git diff --cachedï¼šæ˜¾ç¤ºæš‚å­˜åŒºä¸æœ€åä¸€æ¬¡commitçš„æ”¹åŠ¨ã€‚ git diff \u003cåˆ†æ”¯1\u003e \u003cåˆ†æ”¯2\u003e æ˜¾ç¤ºä¸¤ä¸ªåˆ†æ”¯æœ€åä¸€æ¬¡commitçš„æ”¹åŠ¨ã€‚ ","date":"2021-04-04","objectID":"/git/:1:1","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"init git initåˆå§‹åŒ–ä¸€ä¸ªä»“åº“ ","date":"2021-04-04","objectID":"/git/:1:2","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"add git add .å°†é™¤.gitignoreä¸­å£°æ˜çš„æ‰€æœ‰æ–‡ä»¶åŠ å…¥æš‚å­˜åŒº ä¹Ÿå¯ä»¥git add ç‰¹å®šæ–‡ä»¶ï¼Œå°†æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºã€‚ ","date":"2021-04-04","objectID":"/git/:1:3","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"commit image.png git commit -m \"æäº¤è¯´æ˜\" æäº¤åˆ°å·¥ä½œåŒº git commit --amend ä¿®æ”¹ä¸Šæ¬¡çš„æäº¤è®°å½• ","date":"2021-04-04","objectID":"/git/:1:4","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"push git push æäº¤åˆ°è¿œç¨‹åº“ã€‚å¯ä»¥æŒ‡å®šåˆ†æ”¯æäº¤ æ¯”å¦‚ï¼šgit push origin main æŒ‡å®šä¸ºmainåˆ†æ”¯ ","date":"2021-04-04","objectID":"/git/:1:5","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"pull git pull å°†æ”¹åŠ¨æ‹‰å€’æœ¬åœ°åº“ï¼Œå¹¶åˆå¹¶ï¼Œé»˜è®¤ä¸ºMergeåˆå¹¶ å¦‚æœåŠ ä¸Šrebaseå‚æ•°åˆ™åˆå¹¶æ–¹å¼å˜ä¸ºrebaseåˆå¹¶ã€‚ ","date":"2021-04-04","objectID":"/git/:1:6","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"log git log æŸ¥çœ‹æäº¤å†å² git log --onelineç®€æ´è¾“å‡º ","date":"2021-04-04","objectID":"/git/:1:7","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"branch git branch xxx å»ºç«‹åˆ†æ”¯xxx ç„¶åç”¨git checkout xxx åˆ‡æ¢åˆ°åˆ†æ”¯xxx æˆ–è€…ç”¨git checkout -b xxx å®ŒæˆåŒæ ·çš„æ“ä½œ ","date":"2021-04-04","objectID":"/git/:1:8","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"checkout image.png git checkout å›é€€ç‰ˆæœ¬å³headåˆ†ç¦» ä½†masterä¸å˜ checkoutå¯ä»¥åˆ‡æ¢åˆ†æ”¯ï¼Œä¹Ÿå¯ä»¥headåˆ†ç¦»ï¼Œä½†æ˜¯åˆ†æ”¯çš„ä½ç½®ä¸å˜ï¼Œä½†åé¢çš„resetå’Œrevertéƒ½ä¼šæ”¹å˜åˆ†æ”¯ ","date":"2021-04-04","objectID":"/git/:1:9","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"reset git reset --hard HEAD^å›é€€ä¸€ä¸ªç‰ˆæœ¬ï¼ˆmasterä¹Ÿæ”¹å˜ï¼‰ git reset --hard HEAD~n å›é€€nä¸ªç‰ˆæœ¬ git reset --hard xxxxxx xxxxxxä¸ºç‰ˆæœ¬å· å³ä¸ºgit logæ˜¾ç¤ºçš„æ¯ä¸€ä¸ªç‰ˆæœ¬å· ä¸€èˆ¬ä¸ºå‰å…­ä½ resetçš„å‚æ•°æœ‰ä¸‰ç§ï¼Œå…¶ä½œç”¨å¦‚ä¸‹ï¼š æœ€å±é™©ä½†æœ€å¸¸ç”¨çš„å°±æ˜¯hardã€‚softä¹Ÿå¸¸ç”¨æ¥ä¿®æ”¹æŸä¸ªæäº¤ï¼Œåªä¿®æ”¹æäº¤ï¼Œä¹‹åå†è¿›è¡Œæäº¤å³å¯è¾¾åˆ°ä¿®æ”¹çš„ç›®çš„ã€‚ ","date":"2021-04-04","objectID":"/git/:1:10","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"revert git revertå‘½ä»¤ç”¨äºæ’¤æ¶ˆå¯¹ä»“åº“æäº¤å†å²çš„æ›´æ”¹ã€‚å…¶ä»–â€œæ’¤æ¶ˆâ€å‘½ä»¤ï¼Œä¾‹å¦‚ git checkout å’Œ git resetï¼Œå°†HEADå’Œåˆ†æ”¯å¼•ç”¨æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„æäº¤ã€‚git revertä¹Ÿéœ€è¦ä¸€ä¸ªæŒ‡å®šçš„æäº¤ï¼Œä½†æ˜¯ï¼Œå®ƒå¹¶ä¸ä¼šå°† ref æŒ‡é’ˆç§»åŠ¨åˆ°è¿™ä¸ªæäº¤ã€‚revert æ“ä½œå°†é‡‡ç”¨åè½¬æŒ‡å®šçš„æäº¤çš„æ›´æ”¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„â€œè¿˜åŸæäº¤â€ã€‚ç„¶åæ›´æ–° ref æŒ‡é’ˆä»¥æŒ‡å‘æ–°çš„è¿˜åŸæäº¤ï¼Œä½¿å…¶æˆä¸ºåˆ†æ”¯çš„HEADã€‚(åˆ›å»ºä¸€ä¸ªæ–°çš„commitç»“ç‚¹) ","date":"2021-04-04","objectID":"/git/:1:11","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"merge git merge æ¯”å¦‚åœ¨masteråˆ†æ”¯é‡Œ æ‰§è¡Œgit merge xxx å°†xxxåˆ†æ”¯åˆå¹¶åˆ°masterä¸­ï¼Œä¸€èˆ¬é¡¹ç›®å¼€å‘ï¼Œä¸€äººä¸€ä¸ªåˆ†æ”¯ï¼Œæœ€åæäº¤çš„æ—¶å€™åˆå¹¶å†æäº¤ã€‚ä¸è¿‡æ›´æ¨èç”¨git rebaseæ–¹æ³•ï¼Œè¿™æ ·åˆå¹¶åçš„åˆ†æ”¯æ›´åŠ ç›´è§‚ã€‚ä¸€èˆ¬æ˜¯è¿›è¡Œä¸‰æ–¹åˆå¹¶ã€‚ ","date":"2021-04-04","objectID":"/git/:1:12","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"branch æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ›å»ºå’Œåˆ é™¤åˆ†æ”¯ git branch -f master~3å°†åˆ†æ”¯å¼ºåˆ¶å›é€€ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä½†headä¸åŠ¨ ","date":"2021-04-04","objectID":"/git/:1:13","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"cherry-pick å½“éœ€è¦å¦ä¸€ä¸ªåˆ†æ”¯çš„æ‰€æœ‰æ”¹åŠ¨æ—¶ï¼Œç”¨git mergeï¼Œä½†å½“éœ€è¦éƒ¨åˆ†æ”¹åŠ¨æ—¶å€™ï¼Œè¦ç”¨git cherry-pick xxx xxxä¸ºå“ˆå¸Œå€¼æˆ–è€…åˆ†æ”¯åï¼ŒæŒ‡å®šä¸ºåˆ†æ”¯åæ—¶å€™ï¼Œå°†åˆ†æ”¯çš„æœ€æ–°æ”¹åŠ¨åˆå¹¶è¿‡æ¥ ","date":"2021-04-04","objectID":"/git/:1:14","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"rebase å½“ä¸çŸ¥é“æäº¤çš„å“ˆå¸Œå€¼æ—¶ï¼Œå¯ä»¥ç”¨git rebase -i HEAD~x æ¥å¯è§†åŒ–ç®¡ç†ï¼Œå¯ä»¥è°ƒæ•´æäº¤çš„é¡ºåºï¼Œå¯ä»¥åˆ é™¤ä¸æƒ³è¦çš„æäº¤ï¼Œæˆ–åˆå¹¶æäº¤ è¿™æ˜¯çº¿æ€§åŒ–çš„è‡ªåŠ¨çš„Â cherry-pick git rebase xx1 xx2å°†xx2åˆ†æ”¯ä¸Šçš„æäº¤è®°å½•æ”¾åˆ°xx1åé¢ æ­¤å¤–æ´»ç”¨git rebase -i ,è¿›è¡Œå¯è§†åŒ–çš„æ“ä½œã€‚ ### fetch git fetchè·å–è¿œç¨‹ä»“åº“çš„æ•°æ®ï¼Œä¸ä¼šæ”¹å˜ä½ æœ¬åœ°ä»“åº“çš„çŠ¶æ€ï¼Œä¸ä¼šæ›´æ–°ä½ çš„master,ä¹Ÿæ²¡æœ‰æ›´æ”¹ä½ çš„æœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºå•çº¯çš„ä¸‹è½½æ“ä½œã€‚è€Œgit pullç›¸å½“äºgit fetch + git mergeå³æŠ“å–ååˆå¹¶ ","date":"2021-04-04","objectID":"/git/:1:15","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"reflog git reflog æŸ¥çœ‹æ“ä½œè®°å½•ï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥æ’¤é”€ä¸å°å¿ƒç”¨git resetå›é€€ç‰ˆæœ¬çš„æ“ä½œ ","date":"2021-04-04","objectID":"/git/:1:16","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"stash å®ƒä¼šä¿å­˜å½“å‰å·¥ä½œè¿›åº¦ï¼Œä¼šæŠŠæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„æ”¹åŠ¨ä¿å­˜åˆ°ä¸€ä¸ªæœªå®Œç»“å˜æ›´çš„å †æ ˆä¸­ï¼›æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤åï¼Œåœ¨è¿è¡ŒÂ git statusÂ å‘½ä»¤ï¼Œå°±ä¼šå‘ç°å½“å‰æ˜¯ä¸€ä¸ªå¹²å‡€çš„å·¥ä½œåŒºï¼Œæ²¡æœ‰ä»»ä½•æ”¹åŠ¨ã€‚ git stashÂ æ˜¯æœ¬åœ°çš„ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼› å¯ä»¥é€šè¿‡ä½¿ç”¨git stash save 'message...'å¯ä»¥æ·»åŠ ä¸€äº›æ³¨é‡Šã€‚ image.png ","date":"2021-04-04","objectID":"/git/:1:17","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"åº•å±‚å†…å®¹ è¿™å‡ å¤©ç³»ç»Ÿå­¦ä¹ äº†ä¸€ä¸‹gitçš„åº•å±‚å†…å®¹ï¼Œé€šé€äº†å¾ˆå¤šï¼Œè®°å½•ä¸€äº›ã€‚è´´ä¸€ä¸‹åŸåšå®¢ï¼šhttps://www.lzane.com/tech/git-internal/ é¦–å…ˆçœ‹ä¸€ä¸ªå›¾ é¦–å…ˆè¦æ˜ç¡®æœ‰å››ç§objectï¼Œç¬¬ä¸€ç§æ˜¯è®°å½•æ–‡ä»¶å†…å®¹ï¼Œç¬¬äºŒç§æ˜¯è®°å½•ç›®å½•ç»“æ„ï¼Œç¬¬ä¸‰ç§æ˜¯è®°å½•æäº¤ä¿¡æ¯ï¼Œç¬¬å››ç§æ˜¯è®°å½•tagä¿¡æ¯ï¼Œç¬¬å››ç§æ— å…³ç´§è¦ã€‚ ä»ä¸‹é¢å¼€å§‹çœ‹ï¼Œæœ€ä¸‹é¢è®°å½•çš„æ–‡ä»¶å†…å®¹ï¼Œæ³¨æ„åªè®°å½•æ–‡ä»¶å†…å®¹ï¼Œä¸åŒ…æ‹¬æ–‡ä»¶åç­‰å…¶å®ƒå†…å®¹ã€‚æ˜¯ä¸€ä¸ªblobç±»å‹çš„èŠ‚ç‚¹ï¼Œå°†æ–‡ä»¶çš„å†…å®¹ä¿¡æ¯ç»è¿‡SHA1å“ˆå¸Œç®—æ³•å¾—åˆ°å¯¹åº”çš„å“ˆå¸Œå€¼ä½œä¸ºè¿™ä¸ªobjectåœ¨Gitä»“åº“ä¸­çš„å”¯ä¸€èº«ä»½è¯ã€‚ ç„¶åå†å¾€ä¸Šçš„ä¸‰è§’å½¢è®°å½•çš„æ˜¯ä»“åº“çš„ç›®å½•ç»“æ„ï¼Œå®ƒå°†å½“å‰çš„ç›®å½•ç»“æ„æ‰“äº†ä¸€ä¸ªå¿«ç…§ã€‚ä»å®ƒå‚¨å­˜çš„å†…å®¹æ¥çœ‹å¯ä»¥å‘ç°å®ƒå‚¨å­˜äº†ä¸€ä¸ªç›®å½•ç»“æ„ï¼ˆç±»ä¼¼äºæ–‡ä»¶å¤¹ï¼‰ï¼Œä»¥åŠæ¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–è€…å­æ–‡ä»¶å¤¹ï¼‰çš„æƒé™ã€ç±»å‹ã€å¯¹åº”çš„èº«ä»½è¯ï¼ˆSHA1å€¼ï¼‰ã€ä»¥åŠæ–‡ä»¶åã€‚ å†å¾€ä¸Šå°±æ˜¯è®°å½•çš„æäº¤çš„ä¿¡æ¯ï¼Œå®ƒå‚¨å­˜çš„æ˜¯ä¸€ä¸ªæäº¤çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯¹åº”ç›®å½•ç»“æ„çš„å¿«ç…§treeçš„å“ˆå¸Œå€¼ï¼Œä¸Šä¸€ä¸ªæäº¤çš„å“ˆå¸Œå€¼ï¼Œæäº¤çš„ä½œè€…ä»¥åŠæäº¤çš„å…·ä½“æ—¶é—´ï¼Œæœ€åæ˜¯è¯¥æäº¤çš„ä¿¡æ¯ã€‚ è¿˜æœ‰åˆ†æ”¯çš„ä¿¡æ¯å’ŒHeadã€‚HEADã€åˆ†æ”¯å’Œæ™®é€šçš„Tagå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¯¹åº”commitçš„sha1å€¼ã€‚ ä»“åº“æœ‰ä¸‰ä¸ªåˆ†åŒºï¼šå·¥ä½œç›®å½•ã€indexç´¢å¼•åŒºåŸŸã€Gitä»“åº“ã€‚ å½“æ–‡ä»¶è¢«ä¿®æ”¹åï¼Œåªæ˜¯å·¥ä½œç›®å½•å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä½™ä¸¤ä¸ªæ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–çš„ã€‚å½“è¿è¡Œgit add xxxå‘½ä»¤åï¼Œå³å°†xxxæ–‡ä»¶åŠ å…¥äº†ç´¢å¼•åŒºåŸŸï¼Œæ­¤æ—¶æ–°å»ºäº†ä¸€ä¸ªblob objectï¼Œå¹¶ä¸”å°†åŸæ¥æŒ‡å‘xxxæŒ‡å‘äº†æ–°å»ºçš„blob Objectï¼Œè®°ä½ç´¢å¼•ç´¢å¼•çš„æ˜¯addçš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™æ—¶è¿è¡Œgit commitï¼Œä¼šç”Ÿæˆä¸€ä¸ªtree objectï¼Œç„¶ååˆ›å»ºcommit objectï¼Œå°†åˆ†æ”¯ç­‰ä¿¡æ¯æŒ‡å‘æ–°çš„commitã€‚æ³¨æ„æ¯æ¬¡commitéƒ½æ˜¯å‚¨å­˜çš„å…¨æ–°çš„æ–‡ä»¶å¿«ç…§è€Œä¸æ˜¯å˜æ›´éƒ¨åˆ†ã€‚ ","date":"2021-04-04","objectID":"/git/:2:0","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"åˆå¹¶ç­–ç•¥ ","date":"2021-04-04","objectID":"/git/:3:0","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"Fast-forward(æ²¡æœ‰åˆ†å‰) image.png ","date":"2021-04-04","objectID":"/git/:3:1","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["å·¥å…·"],"content":"Recursive(æœ€å¸¸ç”¨æœ€é‡è¦) Recursiveæ˜¯Gitåˆ†æ”¯åˆå¹¶ç­–ç•¥ä¸­æœ€é‡è¦ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç­–ç•¥ï¼Œæ˜¯Gitåœ¨åˆå¹¶ä¸¤ä¸ªæœ‰åˆ†å‰çš„åˆ†æ”¯æ—¶çš„é»˜è®¤è¡Œä¸ºã€‚å…¶ç®—æ³•å¯ä»¥ç®€å•æè¿°ä¸ºï¼šé€’å½’å¯»æ‰¾è·¯å¾„æœ€çŸ­çš„å”¯ä¸€å…±åŒç¥–å…ˆèŠ‚ç‚¹ï¼Œç„¶åä»¥å…¶ä¸ºbaseèŠ‚ç‚¹è¿›è¡Œé€’å½’ä¸‰å‘åˆå¹¶ã€‚ é‚£æ€ä¹ˆä¿è¯Gitèƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„åˆå¹¶baseèŠ‚ç‚¹ï¼Œå°½å¯èƒ½çš„å‡å°‘å†²çªå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼ŒGitåœ¨å¯»æ‰¾è·¯å¾„æœ€çŸ­çš„å…±åŒç¥–å…ˆèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„ç¥–å…ˆèŠ‚ç‚¹ä¸å”¯ä¸€ï¼Œé‚£ä¹ˆGitä¼šç»§ç»­é€’å½’å¾€ä¸‹å¯»æ‰¾ç›´è‡³å”¯ä¸€ã€‚ä¸å”¯ä¸€çš„å¤šä¸ªç¥–å…ˆèŠ‚ç‚¹åšä¸€ä¸ªä¸´æ—¶çš„ä¸‰å‘åˆå¹¶èŠ‚ç‚¹ã€‚ Recursiveç­–ç•¥å·²ç»è¢«å¤§é‡çš„åœºæ™¯è¯æ˜å®ƒæ˜¯ä¸€ä¸ªå°½é‡å‡å°‘å†²çªçš„åˆå¹¶ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œå¯¹äºä¸¤ä¸ªåˆå¹¶åˆ†æ”¯çš„ä¸­é—´èŠ‚ç‚¹ï¼ˆå¦‚ä¸Šå›¾èŠ‚ç‚¹4ï¼Œ5ï¼‰ï¼Œåªå‚ä¸äº†baseçš„è®¡ç®—ï¼Œè€Œæœ€ç»ˆçœŸæ­£è¢«ä¸‰å‘åˆå¹¶æ‹¿æ¥åšåˆå¹¶çš„èŠ‚ç‚¹ï¼ŒåªåŒ…æ‹¬æœ«ç«¯ä»¥åŠbaseèŠ‚ç‚¹ã€‚ éœ€è¦æ³¨æ„Gitåªæ˜¯ä½¿ç”¨è¿™äº›ç­–ç•¥å°½é‡çš„å»å¸®ä½ å‡å°‘å†²çªï¼Œå¦‚æœå†²çªä¸å¯é¿å…ï¼Œé‚£Gitå°±ä¼šæç¤ºå†²çªï¼Œéœ€è¦æ‰‹å·¥è§£å†³ã€‚ï¼ˆä¹Ÿå°±æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å†²çªï¼‰ã€‚ ### Ours \u0026 Theirs ### Octopus ## å‚è€ƒ å›¾è§£Git (marklodato.github.io) è¿™æ‰æ˜¯çœŸæ­£çš„Gitâ€”â€”Gitå†…éƒ¨åŸç† - LZANE | ææ³½å¸†ï¼ˆé“ä»”ï¼‰ è¿™æ‰æ˜¯çœŸæ­£çš„Gitâ€”â€”åˆ†æ”¯åˆå¹¶ - LZANE | ææ³½å¸†ï¼ˆé“ä»”ï¼‰ ","date":"2021-04-04","objectID":"/git/:3:2","tags":["git","å·¥å…·"],"title":"git","uri":"/git/"},{"categories":["ç®—æ³•é¢˜"],"content":"ç¼–è¾‘è·ç¦» ","date":"2021-04-03","objectID":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/:0:0","tags":["ç®—æ³•é¢˜","ç¼–è¾‘è·ç¦»"],"title":"ç¼–è¾‘è·ç¦»","uri":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/"},{"categories":["ç®—æ³•é¢˜"],"content":"å®šä¹‰ ç¼–è¾‘è·ç¦»(Edit Distance)æ˜¯é’ˆå¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²S1å’ŒS2çš„å·®å¼‚ç¨‹åº¦è¿›è¡Œé‡åŒ–ï¼Œè®¡ç®—æ–¹å¼æ˜¯çœ‹è‡³å°‘éœ€è¦å¤šå°‘æ¬¡çš„å¤„ç†æ‰èƒ½å°†S1å˜æˆS2ï¼ˆå’ŒS2å˜æˆS1æ˜¯ç­‰ä»·çš„ï¼‰ï¼Œç”¨ EditDis(S1,S2)è¡¨ç¤ºã€‚ å…¶ä¸­å¤„ç†çš„æ–¹å¼æœ‰ä¸‰ç§ï¼š 1.æ’å…¥ä¸€ä¸ªå­—ç¬¦ 2.åˆ é™¤ä¸€ä¸ªå­—ç¬¦ 3.æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ è¿™æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„è·ç¦»ï¼Œæ»¡è¶³â€è·ç¦»ä¸‰å…¬ç†â€ï¼š 1.å¯¹ç§°æ€§ï¼ŒEditDis(S1,S2) = EditDis(S2,S1) 2.éè´Ÿæ€§ï¼ŒEditDis(S1,S2) \u003e= 0, å½“ä¸”ä»…å½“S1=S2æ—¶ï¼Œç­‰å·æˆç«‹ 3.ä¸‰è§’ä¸ç­‰å¼ï¼ŒEditDis(S1,S2) + EditDis(S1,S3) \u003e= EditDis(S2,S3) ","date":"2021-04-03","objectID":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/:1:0","tags":["ç®—æ³•é¢˜","ç¼–è¾‘è·ç¦»"],"title":"ç¼–è¾‘è·ç¦»","uri":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/"},{"categories":["ç®—æ³•é¢˜"],"content":"åŠ¨æ€è§„åˆ’æ±‚è§£ ä»¤ S1.substr(i)è¡¨ç¤º S1å‰iä¸ªå­—ç¬¦æ„æˆçš„å­ä¸²ï¼ŒS2.substr(j)è¡¨ç¤ºS2å‰jä¸ªå­—ç¬¦æ„æˆçš„å­ä¸² \\(dp[i][j]\\)è¡¨ç¤ºS1.substr(i)å’ŒS2.substr(j)çš„ç¼–è¾‘è·ç¦»ã€‚ æ³¨æ„ï¼Œè¿™å¥è¯çš„å¦ä¸€å±‚å«ä¹‰æ˜¯ï¼šå½“æˆ‘ä»¬è®¡ç®—å‡ºäº†EditDis(S1,S2)åˆ™é»˜è®¤äº†S1.substr(i)å·²ç»é€šè¿‡ä¸‰ç§å¤„ç†æ–¹å¼å˜æˆäº†S2.substr(j)ã€‚ æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è®¡ç®—\\(dp[i+1][j+1]\\)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨\\(dp[i][j]\\)ï¼Œ\\(dp[i+1][j]\\)ï¼Œ\\(dp[i][j+1]\\)çš„ä¿¡æ¯ã€‚ ","date":"2021-04-03","objectID":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/:2:0","tags":["ç®—æ³•é¢˜","ç¼–è¾‘è·ç¦»"],"title":"ç¼–è¾‘è·ç¦»","uri":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/"},{"categories":["ç®—æ³•é¢˜"],"content":"è¿‡ç¨‹ 1.ç¡®å®šæœ€åä¸€æ­¥ï¼š ä»¤ï¼ŒS1çš„é•¿åº¦ä¸ºlen1ï¼ŒS2çš„é•¿åº¦ä¸ºlen2 \\(dp[len1][len2]\\)æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥å®ç°ï¼Œä¸€ç§æ˜¯S1.substr(len1-1)æ’å…¥ä¸€ä¸ªå­—ç¬¦ä½¿ä¹‹ç­‰äºS2ï¼ˆ\\(dp[len1][len2-1] + 1\\)ï¼‰ï¼Œä¸€ç§æ˜¯S2.substr(len2)åˆ é™¤ä¸€ä¸ªå­—ç¬¦ä½¿ä¹‹ç­‰äºS1ï¼ˆ\\(dp[len1-1][len2] + 1\\)ï¼‰ï¼Œå¦ä¸€ç§æ˜¯æ›¿æ¢æœ€åä¸€ä¸ªå­—ç¬¦ä½¿S1å’ŒS2ç›¸ç­‰ï¼ˆ\\(dp[len1-1][len2-1] + 1\\)ï¼‰ ç¡®å®šè½¬ç§»æ–¹ç¨‹: 3.ç¡®å®šè¾¹ç•Œå’Œåˆå§‹çŠ¶æ€ æˆ‘ä»¬è®¾å®šDpäºŒç»´æ•°ç»„å¤§å°æ˜¯ï¼ˆLen+1ï¼‰ * ï¼ˆLen2+1ï¼‰ï¼Œç¬¬0è¡Œä»£è¡¨ S1ä¸ºç©ºä¸²ï¼Œç¬¬0åˆ—ä»£è¡¨S2ä¸ºç©ºä¸²ã€‚ æ˜¾ç„¶ï¼ŒS1å˜æˆä¸ºç©ºä¸²éœ€è¦çš„æ¯æ¬¡æ“ä½œæ˜¯\\(dp[i][0]=i\\) S2å˜æˆä¸ºç©ºä¸²éœ€è¦çš„æ¯æ¬¡æ“ä½œæ˜¯\\(dp[0][j] = j\\) ","date":"2021-04-03","objectID":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/:3:0","tags":["ç®—æ³•é¢˜","ç¼–è¾‘è·ç¦»"],"title":"ç¼–è¾‘è·ç¦»","uri":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç  class Solution: def minDistance(self, word1: str, word2: str) -\u003e int: import numpy as np len1, len2 = len(word1), len(word2) dp = [[0]*(len2+1) for _ in range(len1+1)] # å®šä¹‰ for i in range(1,len1+1): dp[i][0] = i # è¾¹ç•Œ for j in range(1,len2+1): dp[0][j] = j # è¾¹ç•Œ for i in range(1,len1+1): for j in range(1,len2+1): if word1[i-1] == word2[j-1]: dp[i][j] = dp[i-1][j-1] else: dp[i][j] = min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+1) return int(dp[len1][len2]) ","date":"2021-04-03","objectID":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/:4:0","tags":["ç®—æ³•é¢˜","ç¼–è¾‘è·ç¦»"],"title":"ç¼–è¾‘è·ç¦»","uri":"/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"é€šè¿‡sklearnæ¨¡å—å®ç° import numpy as np import matplotlib.pyplot as plt from sklearn import metrics from sklearn.datasets import make_blobs from sklearn.cluster import KMeans from sklearn.datasets import load_iris %matplotlib inline X,y = make_blobs(n_samples=100,n_features=2,centers=[[-1,-1],[0,0],[1,1],[2,2]],cluster_std=[0.4,0.2,0.2,0.2])#ä½¿ç”¨make_blobsç”Ÿæˆè®­ç»ƒæ•°æ®,ç”Ÿæˆ100ä¸ªæ ·æœ¬,æ¯ä¸ªæ ·æœ¬2ä¸ªç‰¹å¾,å…±4ä¸ªèšç±»,èšç±»ä¸­å¿ƒåˆ†åˆ«ä¸º[-1,-1],[0,0],[1,1],[2,2],èšç±»æ–¹å·®åˆ†åˆ«ä¸º0.4,0.2,0.2,0.2 plt.scatter(X[:,0],X[:,1])#ç”»å‡ºè®­ç»ƒæ ·æœ¬çš„æ•£ç‚¹å›¾,æ•£ç‚¹å›¾çš„æ¨ªåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬ä¸€ç»´ç‰¹å¾,çºµåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬äºŒç»´ç‰¹å¾ plt.show() kmeans = KMeans(n_clusters=3)#ç”Ÿæˆkmeansåˆ†ç±»å™¨,èšç±»æ•°é‡ä¸º3,å…¶ä½™å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ã€‚ y_pred = kmeans.fit_predict(X)#ä½¿ç”¨fit_predictæ–¹æ³•è®¡ç®—èšç±»ä¸­å¿ƒå¹¶ä¸”é¢„æµ‹æ¯ä¸ªæ ·æœ¬çš„èšç±»ç´¢å¼•ã€‚ plt.scatter(X[:,0],X[:,1],c=y_pred)#ç”»å‡ºè®­ç»ƒæ ·æœ¬çš„æ•£ç‚¹å›¾,æ•£ç‚¹å›¾çš„æ¨ªåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬ä¸€ç»´ç‰¹å¾,çºµåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬äºŒç»´ç‰¹å¾,å°†å„èšç±»ç»“æœæ˜¾ç¤ºä¸ºä¸åŒçš„é¢œè‰² plt.show() kmeans = KMeans(n_clusters=4)#ç”Ÿæˆkmeansåˆ†ç±»å™¨,èšç±»æ•°é‡ä¸º4,å…¶ä½™å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ã€‚ y_pred = kmeans.fit_predict(X)#ä½¿ç”¨fit_predictæ–¹æ³•è®¡ç®—èšç±»ä¸­å¿ƒå¹¶ä¸”é¢„æµ‹æ¯ä¸ªæ ·æœ¬çš„èšç±»ç´¢å¼•ã€‚ plt.scatter(X[:,0],X[:,1],c=y_pred)#ç”»å‡ºè®­ç»ƒæ ·æœ¬çš„æ•£ç‚¹å›¾,æ•£ç‚¹å›¾çš„æ¨ªåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬ä¸€ç»´ç‰¹å¾,çºµåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬äºŒç»´ç‰¹å¾,å°†å„èšç±»ç»“æœæ˜¾ç¤ºä¸ºä¸åŒçš„é¢œè‰² plt.show() iris = load_iris() #å¯¼å…¥irisæ•°æ®é›†,irisæ•°æ®é›†åŒ…å«äº†150ä¸ªæ ·æœ¬,åˆ†åˆ«å±äº3ç±»,æ¯ä¸ªæ ·æœ¬åŒ…å«4ä¸ªç‰¹å¾ data_train=iris.data #irisæ ·æœ¬é›†çš„æ ·æœ¬ç‰¹å¾ label_train=iris.target #irisæ ·æœ¬é›†çš„æ ·æœ¬æ ‡ç­¾ kmeans = KMeans(n_clusters=3)#ç”Ÿæˆkmeansåˆ†ç±»å™¨,èšç±»æ•°é‡ä¸º3,å…¶ä½™å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ã€‚ y_predict = kmeans.fit_predict(data_train)#ä½¿ç”¨fit_predictæ–¹æ³•è®¡ç®—èšç±»ä¸­å¿ƒå¹¶ä¸”é¢„æµ‹æ¯ä¸ªæ ·æœ¬çš„èšç±»ç´¢å¼•ã€‚ plt.scatter(data_train[:,0],data_train[:,2],c=y_predict)#ç”»å‡ºè®­ç»ƒæ ·æœ¬çš„æ•£ç‚¹å›¾,æ•£ç‚¹å›¾çš„æ¨ªåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬ä¸€ç»´ç‰¹å¾,çºµåæ ‡ä¸ºæ ·æœ¬çš„ç¬¬ä¸‰ç»´ç‰¹å¾,å°†å„èšç±»ç»“æœæ˜¾ç¤ºä¸ºä¸åŒçš„é¢œè‰² plt.show() ","date":"2021-03-28","objectID":"/kmeans/:1:0","tags":["Machine Learning","èšç±»ç®—æ³•","kmeans"],"title":"kmeans","uri":"/kmeans/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"æ‰‹åŠ¨å®ç° import numpy as np import matplotlib.pyplot as plt center = np.array([[0,0],[0,1]]) cls_num = 2 X = np.array([[0,0],[0,1],[2,1],[2,3],[3,4],[1,0]]) max_iter = 10 cls = np.zeros(X.shape[0]) run = True while run and max_iter \u003e 0: for i,x in enumerate(X): tmp = np.argmin(np.sum(np.power(x - center,2),axis=1)) cls[i] = tmp run = False # é‡æ–°è®¡ç®—èšç±»ä¸­å¿ƒ for i in range(cls_num): data = X[cls==i] # å–ç›¸åŒç±»åˆ«çš„æ ·æœ¬ new_center = np.mean(data,axis=0) # å¯¹ç›¸åŒç±»åˆ«çš„xå’Œyå–å¹³å‡å€¼ if np.sum(np.abs(center[i]-new_center),axis=0) \u003e 1e-4: center[i] = new_center # æ›´æ–°ä¸­å¿ƒ run = True max_iter -= 1 plt.scatter(X[:,0],X[:,1],c=cls) plt.show() ## kernel kmeans å·²çŸ¥kmeansçš„æ ¸å¿ƒå…¬å¼ä¸ºä¸‹ï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°,å®é™…ä¸Šå°±æ˜¯è®¡ç®—æ¯ä¸ªæ ·æœ¬ç‚¹ç°‡ä¸­å¿ƒçš„è·ç¦»,ç„¶ååˆ¤æ–­å‡ºåˆ°å“ªä¸ªç°‡ä¸­å¿ƒè·ç¦»æœ€çŸ­,ç„¶ååˆ†ç»™é‚£ä¸ªç°‡ã€‚ç„¶åä¸‹æ¬¡è¿­ä»£æ—¶,ç°‡ä¸­å¿ƒå°±æŒ‰ç…§æ–°åˆ†é…çš„ç‚¹é‡æ–°è¿›è¡Œè®¡ç®—äº†,ç„¶åæ‰€æœ‰çš„ç‚¹å†åŒæ ·è®¡ç®—æ ·æœ¬ç‚¹åˆ°ç°‡ä¸­å¿ƒçš„è·ç¦»,é‡æ–°åˆ†é…åˆ°ä¸åŒçš„ç°‡ä¸­ã€‚æ‰€ä»¥è¿™æ ·ä¸æ–­è¿­ä»£ä¸‹å»,å°±èƒ½å¤Ÿæ”¶æ•›äº†,å¾—åˆ°æœ€åçš„èšç±»æ•ˆæœã€‚ æ ¸k-means,æ¦‚æ‹¬åœ°æ¥è¯´,å°±æ˜¯å°†æ•°æ®ç‚¹éƒ½æŠ•å½±åˆ°äº†ä¸€ä¸ªé«˜ç»´çš„ç‰¹å¾ç©ºé—´ä¸­ï¼ˆä¸ºå•¥è¦è¿™ä¹ˆåšå‘¢,ä¸»è¦æ˜¯çªæ˜¾å‡ºä¸åŒæ ·æœ¬ä¸­çš„å·®å¼‚ï¼‰,ç„¶åå†åœ¨è¿™ä¸ªé«˜ç»´çš„ç‰¹å¾ç©ºé—´ä¸­,è¿›è¡Œä¼ ç»Ÿçš„k-meansèšç±»ã€‚ä¸»è¦çš„æ€æƒ³å°±æ˜¯è¿™ä¹ˆç®€å•,æ¯”èµ·ä¼ ç»Ÿæ™®é€šçš„k-meanså°±å¤šäº†ä¸€ä¸ªæ­¥æ ¸å‡½æ•°çš„æ“ä½œã€‚æ‰€ä»¥å®ƒçš„å…¬å¼ä¹Ÿä¸ä¼ ç»Ÿk-meanså¾ˆç›¸è¿‘ï¼š ä½†å®é™…ä¸­å¾ˆéš¾è®¡ç®—,å› æ­¤éœ€è¦æ”¹é€ , æ”¹é€ æˆä¸º ","date":"2021-03-28","objectID":"/kmeans/:2:0","tags":["Machine Learning","èšç±»ç®—æ³•","kmeans"],"title":"kmeans","uri":"/kmeans/"},{"categories":["Machine Learning","èšç±»ç®—æ³•"],"content":"ä»£ç  class KernelKmeans: def __init__(self, n_clusters, max_iter, kernel): self.n_clusters = n_clusters self.max_iter = max_iter self.kernel = kernel def fit(self, X): self.centroids = X[np.random.choice(X.shape[0], self.n_clusters, replace=False)] for i in range(self.max_iter): distances = np.array([self.kernel(X, centroid) for centroid in self.centroids]) self.labels = np.argmin(distances, axis=0) self.centroids = np.array([X[self.labels == j].mean(axis=0) for j in range(self.n_clusters)], dtype=np.float32) def predict(self, X): distances = np.array([self.kernel(X, centroid) for centroid in self.centroids]) return np.argmin(distances, axis=0) def gaussian_kernel(X, y): return np.exp(-np.linalg.norm(X - y, axis=1)**2 / 2) ","date":"2021-03-28","objectID":"/kmeans/:2:1","tags":["Machine Learning","èšç±»ç®—æ³•","kmeans"],"title":"kmeans","uri":"/kmeans/"},{"categories":["ç®—æ³•é¢˜"],"content":"ç¿»è½¬äºŒå‰æ ‘ å¼€å§‹å­¦ä¹ äºŒå‰æ ‘äº† å…ˆæ¥ä¸ªç®€å•é¢˜ https://leetcode-cn.com/problems/invert-binary-tree/ å¾ˆç®€å• # Definition for a binary tree node. # class TreeNode: # def __init__(self, x): # self.val = x # self.left = None # self.right = None class Solution: def invertTree(self, root: TreeNode) -\u003e TreeNode: if root == None: return None temp = root.left root.left = root.right root.right = temp self.invertTree(root.left) self.invertTree(root.right) return root ","date":"2021-03-24","objectID":"/%E7%BF%BB%E8%BD%AC%E4%BA%8C%E5%8F%89%E6%A0%91/:0:0","tags":["ç®—æ³•é¢˜","ç¿»è½¬äºŒå‰æ ‘"],"title":"ç¿»è½¬äºŒå‰æ ‘","uri":"/%E7%BF%BB%E8%BD%AC%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"å¯¹ç§°äºŒå‰æ ‘ ","date":"2021-03-21","objectID":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/:0:0","tags":["ç®—æ³•é¢˜","å¯¹ç§°äºŒå‰æ ‘"],"title":"å¯¹ç§°äºŒå‰æ ‘","uri":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/symmetric-tree/ ","date":"2021-03-21","objectID":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/:1:0","tags":["ç®—æ³•é¢˜","å¯¹ç§°äºŒå‰æ ‘"],"title":"å¯¹ç§°äºŒå‰æ ‘","uri":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š åˆ©ç”¨åŒå‘é˜Ÿåˆ—ï¼Œæ¯æ¬¡æŠŠå¯¹ç§°çš„ä¸¤ä¸ªå¯¹åº”çš„èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åå–å‡ºæ¥æ¯”è¾ƒï¼Œå¦‚æœå€¼ä¸ç›¸ç­‰åˆ™è¿”å›false,å¦‚æœä¸€è¾¹ä¸ºç©º ä¸€è¾¹ä¸ä¸ºç©ºä¹Ÿè¿”å›false ç¬¦åˆæ¡ä»¶çš„è¯å°±ç»§ç»­æœç´¢ ","date":"2021-03-21","objectID":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/:2:0","tags":["ç®—æ³•é¢˜","å¯¹ç§°äºŒå‰æ ‘"],"title":"å¯¹ç§°äºŒå‰æ ‘","uri":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š # Definition for a binary tree node. # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: def isSymmetric(self, root: TreeNode) -\u003e bool: from collections import deque d = deque() d.append((root,root)) while d: left,right = d.popleft() if not left and not right: continue elif not left or not right: return False elif left.val != right.val: return False else: d.append((left.left,right.right)) d.append((left.right,right.left)) return True ","date":"2021-03-21","objectID":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/:3:0","tags":["ç®—æ³•é¢˜","å¯¹ç§°äºŒå‰æ ‘"],"title":"å¯¹ç§°äºŒå‰æ ‘","uri":"/%E5%AF%B9%E7%A7%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"categories":["ç®—æ³•é¢˜"],"content":"åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨ ","date":"2021-03-18","objectID":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/:0:0","tags":["ç®—æ³•é¢˜","åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨"],"title":"åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨","uri":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/merge-two-sorted-lists/ ","date":"2021-03-18","objectID":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/:1:0","tags":["ç®—æ³•é¢˜","åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨"],"title":"åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨","uri":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š åˆ©ç”¨é€’å½’çš„æ€æƒ³ï¼Œæ¯”è¾ƒä¸¤ä¸ªå½“å‰å€¼ï¼Œå› ä¸ºæ˜¯æœ‰åºé“¾è¡¨ ","date":"2021-03-18","objectID":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/:2:0","tags":["ç®—æ³•é¢˜","åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨"],"title":"åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨","uri":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š # Definition for singly-linked list. # class ListNode: # def __init__(self, val=0, next=None): # self.val = val # self.next = next class Solution: def mergeTwoLists(self, l1: ListNode, l2: ListNode) -\u003e ListNode: if l1 == None: return l2 if l2 == None: return l1 if l1.val \u003c= l2.val: l1.next = self.mergeTwoLists(l1.next,l2) return l1 else: l2.next = self.mergeTwoLists(l1,l2.next) return l2 ","date":"2021-03-18","objectID":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/:3:0","tags":["ç®—æ³•é¢˜","åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨"],"title":"åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨","uri":"/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8/"},{"categories":["ç®—æ³•é¢˜"],"content":"å¯è·å¾—çš„æœ€å¤§ç‚¹æ•° ","date":"2021-03-03","objectID":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜","å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°"],"title":"å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°","uri":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/maximum-points-you-can-obtain-from-cards/ ","date":"2021-03-03","objectID":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/:1:0","tags":["ç®—æ³•é¢˜","å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°"],"title":"å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°","uri":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š æ»‘åŠ¨çª—å£é¢˜ç›®ï¼Œé™å®šçª—å£å¤§å°ç„¶åæ»‘åŠ¨å³å¯ ","date":"2021-03-03","objectID":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/:2:0","tags":["ç®—æ³•é¢˜","å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°"],"title":"å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°","uri":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def maxScore(self, cardPoints: List[int], k: int) -\u003e int: n = len(cardPoints) # æ»‘åŠ¨çª—å£å¤§å°ä¸º n-k windowSize = n - k # é€‰å‰ n-k ä¸ªä½œä¸ºåˆå§‹å€¼ s = sum(cardPoints[:windowSize]) minSum = s for i in range(windowSize, n): # æ»‘åŠ¨çª—å£æ¯å‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œå¢åŠ ä»å³ä¾§è¿›å…¥çª—å£çš„å…ƒç´ å€¼ï¼Œå¹¶å‡å°‘ä»å·¦ä¾§ç¦»å¼€çª—å£çš„å…ƒç´ å€¼ s += cardPoints[i] - cardPoints[i - windowSize] minSum = min(minSum, s) return sum(cardPoints) - minSum ","date":"2021-03-03","objectID":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/:3:0","tags":["ç®—æ³•é¢˜","å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°"],"title":"å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°","uri":"/%E5%8F%AF%E8%8E%B7%E5%BE%97%E7%9A%84%E6%9C%80%E5%A4%A7%E7%82%B9%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ»‘åŠ¨çª—å£ä¸­ä½æ•° ","date":"2021-02-25","objectID":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/:0:0","tags":["ç®—æ³•é¢˜","æ»‘åŠ¨çª—å£ä¸­ä½æ•°"],"title":"æ»‘åŠ¨çª—å£ä¸­ä½æ•°","uri":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/sliding-window-median/ ","date":"2021-02-25","objectID":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/:1:0","tags":["ç®—æ³•é¢˜","æ»‘åŠ¨çª—å£ä¸­ä½æ•°"],"title":"æ»‘åŠ¨çª—å£ä¸­ä½æ•°","uri":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š å¾ˆæ˜æ˜¾çš„æ»‘åŠ¨çª—å£ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ±‚ä¸­ä½æ•°çš„åŒ¿åå‡½æ•°ï¼Œç„¶åä¸€ç‚¹ä¸€ç‚¹æ±‚å‡ºæ¥ ","date":"2021-02-25","objectID":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/:2:0","tags":["ç®—æ³•é¢˜","æ»‘åŠ¨çª—å£ä¸­ä½æ•°"],"title":"æ»‘åŠ¨çª—å£ä¸­ä½æ•°","uri":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def medianSlidingWindow(self, nums: List[int], k: int) -\u003e List[float]: median = lambda a: (a[(len(a)-1)//2] + a[len(a)//2]) / 2 res = [] for i in range(len(nums)-k+1): res.append(median(sorted(nums[i:i+k]))) return res ","date":"2021-02-25","objectID":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/:3:0","tags":["ç®—æ³•é¢˜","æ»‘åŠ¨çª—å£ä¸­ä½æ•°"],"title":"æ»‘åŠ¨çª—å£ä¸­ä½æ•°","uri":"/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%AD%E4%BD%8D%E6%95%B0/"},{"categories":["NLP"],"content":"Seq2Seqä¸­çš„Attention ","date":"2021-02-23","objectID":"/attention/:0:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"ç¼ºé™· åœ¨seq2seqè¿™ç¯‡æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº†seq2seqæ¨¡å‹çš„ç»†èŠ‚ï¼Œä½†æ˜¯ä»…ä»…ç”¨ä¸€ä¸ªè¯­ä¹‰ç¼–ç cæ˜¯å®Œå…¨ä¸èƒ½å¤Ÿè¡¨ç¤ºç¼–ç å™¨çš„è¾“å…¥çš„ï¼Œæºçš„å¯èƒ½å«ä¹‰çš„æ•°é‡æ˜¯æ— é™çš„ã€‚å½“ç¼–ç å™¨è¢«è¿«å°†æ‰€æœ‰ä¿¡æ¯æ”¾å…¥å•ä¸ªå‘é‡ä¸­æ—¶ï¼Œå®ƒå¾ˆå¯èƒ½ä¼šå¿˜è®°ä¸€äº›ä¸œè¥¿ã€‚ ä¸ä»…ç¼–ç å™¨å¾ˆéš¾å°†æ‰€æœ‰ä¿¡æ¯æ”¾å…¥ä¸€ä¸ªå‘é‡ä¸­â€”â€”è¿™å¯¹è§£ç å™¨æ¥è¯´ä¹Ÿå¾ˆå›°éš¾ã€‚è§£ç å™¨åªçœ‹åˆ°æºçš„ä¸€ç§è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œåœ¨æ¯ä¸ªç”Ÿæˆæ­¥éª¤ä¸­ï¼Œæºçš„ä¸åŒéƒ¨åˆ†å¯èƒ½æ¯”å…¶ä»–éƒ¨åˆ†æ›´æœ‰ç”¨ã€‚ä½†åœ¨ç›®å‰çš„æƒ…å†µä¸‹ï¼Œè§£ç å™¨å¿…é¡»ä»ç›¸åŒçš„å›ºå®šè¡¨ç¤ºä¸­æå–ç›¸å…³ä¿¡æ¯â€”â€”è¿™ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶äº†ï¼Œæ³¨æ„è¿™é‡Œçš„æ³¨æ„åŠ›æœºåˆ¶å’Œtransformerä¸­çš„self-attentionæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚æ³¨æ„å‡ ä¸ªåè¯ï¼šæ³¨æ„åŠ›å¾—åˆ†ã€æ³¨æ„åŠ›æƒé‡ã€‚å…¶ä¸­æ³¨æ„åŠ›å¾—åˆ†å³scoreçš„è®¡ç®—æœ‰å¤šç§æ–¹æ³•ï¼Œæƒé‡å°±æ˜¯å¯¹å¾—åˆ†è¿›è¡Œsoftmaxå½’ä¸€åŒ–ã€‚ ","date":"2021-02-23","objectID":"/attention/:1:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"attention æ³¨æ„æœºåˆ¶æ˜¯ç¥ç»ç½‘ç»œçš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¯ä¸ªè§£ç å™¨æ­¥éª¤ä¸­ï¼Œå®ƒå†³å®šå“ªäº›æºéƒ¨åˆ†æ›´é‡è¦ã€‚åœ¨æ­¤è®¾ç½®ä¸­ï¼Œç¼–ç å™¨ä¸å¿…å°†æ•´ä¸ªæºå‹ç¼©ä¸ºå•ä¸ªå‘é‡ - å®ƒä¸ºæ‰€æœ‰æºæ ‡è®°æä¾›è¡¨ç¤ºï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰ RNN çŠ¶æ€è€Œä¸æ˜¯æœ€åä¸€ä¸ªï¼‰ã€‚ æ­¥éª¤ï¼š - æ¥å—æ³¨æ„è¾“å…¥ï¼šè§£ç å™¨çŠ¶æ€\\(h_t\\)ä»¥åŠæ‰€æœ‰ç¼–ç å™¨çŠ¶æ€\\(s_1,s_2,\\dots,s_m\\) - è®¡ç®—æ¯ä¸ªç¼–ç å™¨çŠ¶æ€çš„æ³¨æ„åŠ›åˆ†æ•°\\(s_k\\)ï¼Œæ³¨æ„åŠ›åˆ†æ•°è¡¨ç¤ºå®ƒå¯¹è§£ç å™¨çŠ¶æ€\\(h_t\\)çš„ç›¸å…³æ€§ï¼Œä½¿ç”¨æ³¨æ„åŠ›å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè§£ç å™¨çŠ¶æ€å’Œä¸€ä¸ªç¼–ç å™¨çŠ¶æ€å¹¶è¿”å›ä¸€ä¸ªæ ‡é‡åˆ†æ•°ï¼Œå³å›¾ä¸­çš„\\(score(h_t,s_k)\\) - è®¡ç®—æ³¨æ„åŠ›æƒé‡ï¼šå³æ¦‚ç‡åˆ†å¸ƒ- ä½¿ç”¨Softmaxå‡½æ•° - è®¡ç®—æ³¨æ„åŠ›è¾“å‡ºï¼šå…·æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨çŠ¶æ€çš„åŠ æƒå’Œ å³ä¸ºå¦‚å›¾æ‰€ç¤ºå†…å®¹ä¸ºå¦‚ä½•è®¡ç®—æ³¨æ„åŠ›ã€‚ æ³¨æ„æˆ‘ä»¬æåˆ°çš„æ³¨æ„åŠ›å‡½æ•°ï¼Œè¿™é‡Œçš„æ³¨æ„åŠ›åˆ†æ•°çš„è®¡ç®—æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œä¸‹é¢ä»‹ç»å‡ ç§æ¯”è¾ƒå¸¸è§çš„åŠæ³•ï¼š - ç‚¹ç§¯ï¼š æœ€ç®€å•çš„åŠæ³•ã€‚ - åŒçº¿æ€§å‡½æ•° - å¤šå±‚æ„ŸçŸ¥æœº æ³¨æ„åä¸¤è€…éƒ½æœ‰è¦ä¼˜åŒ–çš„å‚æ•°çš„ï¼Œç¬¬ä¸€ä¸ªç‚¹ç§¯æ˜¯ç›´æ¥è¿ç®—ï¼Œå› æ­¤å¾ˆç®€å•ã€‚ åœ¨åº”ç”¨æ—¶å¯ä»¥ç›´æ¥å°†æ³¨æ„åŠ›çš„ç»“æœä¼ è¾“åˆ°æœ€åçš„softmaxï¼Œä¹Ÿå¯ä»¥å°†åŸå§‹çš„\\(h_t\\)åˆå¹¶ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å˜ä½“ã€‚ ","date":"2021-02-23","objectID":"/attention/:2:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"Bahdanau Model - ç¼–ç å™¨ä½¿ç”¨åŒå‘çš„RNN - åˆ©ç”¨ä¸Šä¸€æ—¶åˆ»çš„éšå±‚çŠ¶æ€è®¡ç®—æ³¨æ„åŠ›è¾“å‡ºcï¼Œç„¶åå’Œéšå±‚çŠ¶æ€ä¸€èµ·ä½œä¸ºå½“å‰æ—¶åˆ»çš„è¾“å…¥ï¼Œå†å¾—åˆ°ç»“æœ\\(\\hat{y}\\)ã€‚è¿™é‡Œå†è¯´ä¸€ä¸‹è®­ç»ƒçš„è¿‡ç¨‹ä¸­å½“å‰æ­¥çš„è¾“å…¥ä½¿ç”¨çš„æ˜¯çœŸå®çš„\\(y\\)ï¼Œæµ‹è¯•çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ä¸Šä¸€æ­¥çš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚å¯ä»¥å°†ä¸Šä¸‹æ–‡å‘é‡cï¼ˆä¹Ÿå°±æ˜¯æ³¨æ„åŠ›è¾“å‡ºï¼‰ä¸\\(x\\)æ‹¼æ¥åä½œä¸ºè¾“å…¥ã€‚ - æ³¨æ„åŠ›å¾—åˆ†ä½¿ç”¨çš„æ˜¯æ„ŸçŸ¥æœºã€‚ è¿™é‡Œå¼•ç”¨ä¸€ä¸‹ææ²å¤§ä½¬çš„ä»£ç ï¼š class Seq2SeqAttentionDecoder(AttentionDecoder): def __init__(self, vocab_size, embed_size, num_hiddens, num_layers, dropout=0, **kwargs): super(Seq2SeqAttentionDecoder, self).__init__(**kwargs) self.attention = d2l.AdditiveAttention( num_hiddens, num_hiddens, num_hiddens, dropout) self.embedding = nn.Embedding(vocab_size, embed_size) self.rnn = nn.GRU( embed_size + num_hiddens, num_hiddens, num_layers, dropout=dropout) self.dense = nn.Linear(num_hiddens, vocab_size) def init_state(self, enc_outputs, enc_valid_lens, *args): # outputsçš„å½¢çŠ¶ä¸º(batch_sizeï¼Œnum_stepsï¼Œnum_hiddens). # hidden_stateçš„å½¢çŠ¶ä¸º(num_layersï¼Œbatch_sizeï¼Œnum_hiddens) outputs, hidden_state = enc_outputs return (outputs.permute(1, 0, 2), hidden_state, enc_valid_lens) def forward(self, X, state): # enc_outputsçš„å½¢çŠ¶ä¸º(batch_size,num_steps,num_hiddens). # hidden_stateçš„å½¢çŠ¶ä¸º(num_layers,batch_size, # num_hiddens) enc_outputs, hidden_state, enc_valid_lens = state # è¾“å‡ºXçš„å½¢çŠ¶ä¸º(num_steps,batch_size,embed_size) X = self.embedding(X).permute(1, 0, 2) # è½¬æ¢æ˜¯ä¸ºäº†æ–¹ä¾¿åé¢å¾ªç¯è®¡ç®—ã€‚ outputs, self._attention_weights = [], [] for x in X: # queryçš„å½¢çŠ¶ä¸º(batch_size,1,num_hiddens) query = torch.unsqueeze(hidden_state[-1], dim=1) # -1æ˜¯æŒ‡åœ¨æœ€åä¸€å±‚æœ€åæ—¶åˆ»çš„éšè—çŠ¶æ€ï¼Œä½œä¸ºquery # contextçš„å½¢çŠ¶ä¸º(batch_size,1,num_hiddens) context = self.attention( query, enc_outputs, enc_outputs, enc_valid_lens) # åœ¨ç‰¹å¾ç»´åº¦ä¸Šè¿ç»“ x = torch.cat((context, torch.unsqueeze(x, dim=1)), dim=-1) # å°†xå˜å½¢ä¸º(1,batch_size,embed_size+num_hiddens) out, hidden_state = self.rnn(x.permute(1, 0, 2), hidden_state) outputs.append(out) self._attention_weights.append(self.attention.attention_weights) # å…¨è¿æ¥å±‚å˜æ¢åï¼Œoutputsçš„å½¢çŠ¶ä¸º # (num_steps,batch_size,vocab_size) outputs = self.dense(torch.cat(outputs, dim=0)) return outputs.permute(1, 0, 2), [enc_outputs, hidden_state, enc_valid_lens] @property def attention_weights(self): return self._attention_weights ","date":"2021-02-23","objectID":"/attention/:3:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"Luong Model è¿™ä¸ªæ¨¡å‹çš„ç¼–ç å™¨æ¯”è¾ƒå¸¸è§„ï¼Œä½¿ç”¨å½“å‰çŠ¶æ€è®¡ç®—æ³¨æ„åŠ›è¾“å‡ºï¼Œç„¶åè§£ç å™¨ä¸­å°†éšå±‚çŠ¶æ€ä¸æ³¨æ„åŠ›è¾“å‡ºåšä¸€æ­¥ç»“åˆï¼Œè¿™æ ·å¾—åˆ°äº†æ–°çš„éšå±‚çŠ¶æ€ï¼Œç„¶åå†ä¼ é€’å¾—åˆ°é¢„æµ‹ç»“æœã€‚ ","date":"2021-02-23","objectID":"/attention/:4:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"æ³¨æ„åŠ›å¯¹é½ å¯ä»¥çœ‹åˆ°è§£ç å™¨å…³æ³¨çš„æºtokenã€‚ åˆ°æ­¤seq2seqä¸­çš„attentionå°±ä»‹ç»å®Œæ¯•äº†ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ï¼Œä»¥åé‡åˆ°äº†ä¼šæŒç»­è¡¥å……ã€‚ Self-attention ç§»æ­¥transformerã€‚Transformer MQA image.png æ ‡å‡†çš„mhaä¸­ï¼ŒKV headsçš„æ•°é‡å’ŒQuery headsçš„æ•°é‡ç›¸åŒï¼Œæ¯ä¸€ä¸ªq headå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„kv headï¼Œä½†è¿™æ ·çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ MQA (Multi Queries Attention): MQAæ¯”è¾ƒæç«¯ï¼Œåªä¿ç•™ä¸€ä¸ªKV Headï¼Œå¤šä¸ªQuery Headså…±äº«ç›¸åŒçš„KV Headã€‚è¿™ç›¸å½“äºä¸åŒHeadçš„Attentionå·®å¼‚ï¼Œå…¨éƒ¨éƒ½æ”¾åœ¨äº†Queryä¸Šï¼Œéœ€è¦æ¨¡å‹ä»…ä»ä¸åŒçš„Query Headsä¸Šå°±èƒ½å¤Ÿå…³æ³¨åˆ°è¾“å…¥hidden statesä¸åŒæ–¹é¢çš„ä¿¡æ¯ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæå¤§åœ°é™ä½äº†KV Cacheçš„éœ€æ±‚ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ¨¡å‹æ•ˆæœæœ‰æ‰€ä¸‹é™ã€‚ï¼ˆå±‚å†…å…±äº«ï¼‰ # GQA å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒGQAå°±æ˜¯åœ¨MHAå’ŒMQAä¹‹é—´åšäº†ä¸€ä¸ªå¹³è¡¡ã€‚å¯¹query headsè¿›è¡Œåˆ†ç»„ï¼Œåˆ†æˆå‡ ç»„å°±å¯¹åº”å¤šå°‘ä¸ªkv headsï¼Œç„¶åæ¯ä¸€ç»„å†…çš„query Headså…±äº«ç›¸åŒçš„KV headã€‚ GQAå¯ä»¥åœ¨å‡å°‘è®¡ç®—é‡å’ŒKV CacheåŒæ—¶ç¡®ä¿æ¨¡å‹æ•ˆæœä¸å—åˆ°å¤§çš„å½±å“ã€‚ # online attention ### 3-pass \\(\\mathsf{NO}\\)TATIONS \\(\\{m_i\\}{:}\\max_{j=1}^i\\left\\{x_j\\right\\}\\), with initial value \\(m_0=-\\infty.\\) \\(\\{d_i\\}{:}\\sum_{j=1}^ie^{x_j-m_N}\\), with initial value \\(d_0=0,d_N\\) is the denominator of safe softmax. \\(\\{a_i\\}{:\\text{ the final softmax value}}.\\) BODY \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[m_i\\leftarrow\\max\\left(m_{i-1},x_i\\right)\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[d_i\\leftarrow d_{i-1}+e^{x_i-m_N}\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[a_i\\leftarrow\\frac{e^{x_i-m_N}}{d_N}\\] \\(\\mathbf{end}\\) è¿™æ˜¯3stepè®¡ç®—attentionçš„æ–¹æ³•ï¼Œæ¯ä¸€æ­¥éƒ½éœ€è¦ä¸Šä¸€æ­¥çš„ç»“æœæ‰å¯ä»¥ç»§ç»­è®¡ç®—ã€‚è¿™æ ·çš„è¯ç”±äºsramä¸­æ²¡æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤éœ€è¦å¤šæ¬¡è®¿å­˜ã€‚ ### online attention \\[\\begin{aligned} d_i^{\\prime}\u0026 =\\sum_{j=1}^ie^{x_j-m_i} \\\\ \u0026= \\left(\\sum_{j=1}^{i-1} e^{x_j-m_i}\\right)+e^{x_i-m_i} \\\\ \u0026= \\left(\\sum_{j=1}^{i-1} e^{x_j-m_{i-1}}\\right)e^{m_{i-1}-m_i}+e^{x_i-m_i} \\\\ \u0026= d_{i-1}' e^{m_{i-1}-m_i}+e^{x_i-m_i} \\end{aligned}\\] æ‰¾åˆ°è¿­ä»£å¼ä¹‹åå°±å¯ä»¥ä»3stepé™åˆ°2step \\[\\begin{aligned}\u0026\\mathbf{for~}i\\leftarrow1,N\\textbf{ do}\\\\\u0026\u0026\u0026m_i\u0026\u0026\\leftarrow\u0026\\max\\left(m_{i-1},x_i\\right)\\\\\u0026\u0026\u0026d_i^{\\prime}\u0026\u0026\\leftarrow\u0026d_{i-1}^{\\prime}e^{m_{i-1}-m_i}+e^{x_i-m_i}\\\\\u0026\\mathbf{end}\\\\\u0026\\mathbf{for~}i\\leftarrow1,N\\textbf{ do}\\\\\u0026\u0026\u0026a_i\\leftarrow\u0026\u0026\\frac{e^{x_i-m_N}}{d_N^{\\prime}}\\\\\u0026\\mathbf{end}\\end{aligned}\\] å¥½åƒFLOPsè®¡ç®—é‡å¹¶æ²¡æœ‰å‡å°‘ï¼Œç”šè‡³è¿˜ç•¥æœ‰å¢åŠ ï¼Œå› ä¸ºç°åœ¨æ¯æ¬¡éƒ½éœ€è¦è®¡ç®—é¢å¤–çš„scale xå€¼ï¼Œä¹Ÿå°±æ˜¯pre-softmax logitsï¼Œç”±äºéœ€è¦O(N^2)çš„æ˜¾å­˜æ— æ³•æ”¾åœ¨SRAMä¸­ã€‚å› æ­¤ï¼š 1. è¦ä¹ˆæå‰è®¡ç®—å¥½xï¼Œä¿å­˜åœ¨å…¨å±€æ˜¾å­˜ä¸­ï¼Œéœ€è¦O(N^2)çš„æ˜¾å­˜ï¼Œå®¹æ˜“çˆ†æ˜¾å­˜ã€‚ 2. è¦ä¹ˆåœ¨ç®—æ³•ä¸­onlineè®¡ç®—ï¼Œæ¯æ¬¡å¾ªç¯ä¸­å»loadä¸€éƒ¨åˆ†Qï¼ŒKåˆ°ç‰‡ä¸Šå†…å­˜ï¼Œè®¡ç®—å¾—åˆ°xã€‚ Attentionä¼˜åŒ–çš„ç›®æ ‡å°±æ˜¯é¿å¼€ç¬¬ä¸€ç§æƒ…å†µï¼Œå°½å¯èƒ½èŠ‚çœæ˜¾å­˜ï¼Œå¦åˆ™ï¼ŒLLMæ ¹æœ¬æ— æ³•å¤„ç†ç±»ä¼¼100Kä»¥ä¸Šè¿™ç§long contextçš„æƒ…å†µã€‚è€Œå¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿å­˜ä¸­é—´çŸ©é˜µxï¼ŒèŠ‚çœäº†æ˜¾å­˜ï¼Œä½†æ˜¯è®¡ç®—æ²¡æœ‰èŠ‚çœï¼Œå¹¶ä¸”å¢åŠ äº†HBM IO Accessesï¼ˆéœ€è¦ä¸æ–­åœ°load Q, Kï¼‰ã€‚æ­¤æ—¶ï¼Œ2-passç®—æ³•ç›¸å¯¹äº3-passç®—æ³•ï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡æ•´ä½“çš„load Q, Kä»¥åŠå‡å°‘ä¸€æ¬¡å¯¹Â xiÂ çš„online recomputeï¼Œå› ä¸ºåœ¨2-passçš„ç¬¬ä¸€ä¸ªpassä¸­ï¼ŒÂ xiÂ æ˜¯è¢«ä¸¤æ¬¡è®¡ç®—å…±äº«çš„ã€‚ç±»ä¼¼online-softmaxè¿™ç§ç®—æ³•ï¼Œå¯¹åº”åˆ°Attentionä¸­çš„åº”ç”¨ï¼Œå°±æ˜¯Memory Efficient Attentionï¼ˆæ³¨æ„ä¸æ˜¯FlashAttentionï¼‰ã€‚ flash attention safe softmaxå¹¶æ²¡æœ‰1-passç®—æ³•ï¼Œé‚£ä¹ˆAttentionä¼šä¸ä¼šæœ‰å‘¢ï¼Ÿæœ‰ï¼è¿™å°±æ˜¯FlashAttentionï¼ åœ¨ä½¿ç”¨online attentionçš„æƒ…å†µä¸‹ï¼Œä»å¤´å¼€å§‹è®¡ç®—attention scoreçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š \\(\\operatorname{NOTATIONS}\\) \\(Q[k,:]:\\)the \\(k\\)-th row vector of \\(Q\\) matrix. \\(\\begin{aligned}O[k,:]:\\mathrm{~the~}k\\text{-th row of output }O\\mathrm{~matrix.}\\\\\\mathbf{V}[i,i]:\\mathrm{~the~}k\\text{-th row of output }O\\mathrm{~matrix.}\\end{aligned}\\) \\(V[i,:]{:\\text{ the }i\\text{-th row of }V\\text{ matrix}}.\\) \\(\\{\\boldsymbol{o}_i\\}{:}\\sum_{j=1}^ia_jV[j,:]\\), a row vector storing partial aggregation result \\(A[k,:i]\\times V[:i,:]\\) BODY \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[\\begin{aligned}x_i\u0026\\leftarrow\\quad Q[k,:]\\:K^T[:,i]\\\\m_i\u0026\\leftarrow\\quad\\max\\left(m_{i-1},x_i\\right)\\\\d_i'\u0026\\leftarrow\\quad d_{i-1}'e^{m_{i-1}-m_i}+e^{x_i-m_i}\\end{aligned}\\] \\(\\mathbf{end}\\) \\(\\textbf{for }i\\leftarrow 1, N\\textbf{ do}\\) \\[\\begin{aligned}\u0026a_i\\:\\leftarrow\\:\\frac{e^{x_i-m_N}}{d_N^{\\prime}}\\\\\u0026o_i\\:\\leftarrow\\:o_{i-1}+a_i\\:V[i,:\\:]\\end{aligned}\\] \\(\\mathbf{end}\\) \\[O[k,:]\\leftarrow\\boldsymbol{o}_N\\] ä¼˜åŒ–æ€è·¯å’Œonline attentionä¸€æ ·ï¼Œå°†\\(o_{i}\\)çš„è®¡ç®—ç®€åŒ–ä»¥ä¾¿äºå¯ä»¥å†™æˆè¿­ä»£å¼ã€‚ åŸæ¥çš„\\(o_{i}\\)ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼Œä¾èµ–äºå…¨å±€çš„\\(m_{N}\\)å’Œ\\(d_{N}\\)ã€‚ \\[\\boldsymbol{o}_i:=\\sum_{j=1}^i\\left(\\frac{e^{x_j-m_N}}{d_N^{\\prime}}V[j,:]\\right)\\] å°†å…¶æ”¹å†™æˆå¦‚ä¸‹å½¢å¼ï¼š \\[\\boldsymbol{o}_i^{\\prime}:=\\left(\\sum_{j=1}^i\\frac{e^{x_j-m_i}}{d_i^{\\prime}}V[j,:]\\right)\\] è¿™æ ·æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼æ‹“å±•ä¸‹å»ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ªç¯è¿­ä»£å¼ã€‚ \\[\\begin{aligned} \\mathbf{o}_i^{\\prime}\u0026 =\\sum_{j=1}^i\\frac{e^{x_j-m_i}}{d'}V[j,:] \\\\ \u0026= \\left(\\sum_{j=1}^{i-1}\\frac{e^{x_j-m_i}}{d_i^{\\prime}}V[j,:] \\right)+\\frac{e^{x_i-m_i}}{d_i^{\\prime}}V[i,:] \\\\ \u0026= \\left(\\sum_{j=1}^{i-1}\\frac{e^{x_j-m_{i-1}}}{d_{i-1}^{\\prime}}\\frac{e^{x_","date":"2021-02-23","objectID":"/attention/:5:0","tags":["NLP","Attention"],"title":"Attention","uri":"/attention/"},{"categories":["NLP"],"content":"PMI ç‚¹äº’ä¿¡æ¯ å¯¹äºä¸¤ä¸ªå•è¯ä¹‹é—´çš„PMIæ¥è¯´ï¼Œå¯ä»¥è¿™æ ·è®¡ç®—ï¼š \\[ PMI(w,c) = \\log \\frac{p(w,c)}{p(w)p(c)} = \\log \\frac{N(w,c) |w,c|}{N(w)N(c)} \\] ## MI åœ¨æ¦‚ç‡è®ºå’Œä¿¡æ¯è®ºä¸­ï¼Œä¸¤ä¸ªéšæœºå˜é‡çš„äº’ä¿¡æ¯ï¼ˆMutual Informationï¼Œç®€ç§°MIï¼‰æˆ–è½¬ç§»ä¿¡æ¯ï¼ˆtransinformationï¼‰æ˜¯å˜é‡é—´ç›¸äº’ä¾èµ–æ€§çš„é‡åº¦ã€‚ä¸åŒäºç›¸å…³ç³»æ•°ï¼Œäº’ä¿¡æ¯å¹¶ä¸å±€é™äºå®å€¼éšæœºå˜é‡ï¼Œå®ƒæ›´åŠ ä¸€èˆ¬ä¸”å†³å®šç€è”åˆåˆ†å¸ƒ p(X,Y) å’Œåˆ†è§£çš„è¾¹ç¼˜åˆ†å¸ƒçš„ä¹˜ç§¯ p(X)p(Y) çš„ç›¸ä¼¼ç¨‹åº¦ã€‚äº’ä¿¡æ¯(Mutual Information)æ˜¯åº¦é‡ä¸¤ä¸ªäº‹ä»¶é›†åˆä¹‹é—´çš„ç›¸å…³æ€§(mutual dependence)ã€‚äº’ä¿¡æ¯æœ€å¸¸ç”¨çš„å•ä½æ˜¯bitã€‚ ","date":"2021-02-22","objectID":"/ppmi/:1:0","tags":["NLP","PPMI"],"title":"PPMI","uri":"/ppmi/"},{"categories":["NLP"],"content":"å®šä¹‰ æ­£å¼åœ°ï¼Œä¸¤ä¸ªç¦»æ•£éšæœºå˜é‡ X å’Œ Y çš„äº’ä¿¡æ¯å¯ä»¥å®šä¹‰ä¸ºï¼š å…¶ä¸­ p(x,y) æ˜¯ X å’Œ Y çš„è”åˆæ¦‚ç‡åˆ†å¸ƒå‡½æ•°ï¼Œè€Œp(x)å’Œp(y)åˆ†åˆ«æ˜¯ X å’Œ Y çš„è¾¹ç¼˜æ¦‚ç‡åˆ†å¸ƒå‡½æ•°ã€‚ åœ¨ç»“æœä¸Šäº’ä¿¡æ¯ä¸ä¿¡æ¯å¢ç›Šæ˜¯ä¸€æ ·çš„ï¼Œä¸‹é¢æ˜¯è¯¦ç»†çš„æ¨å¯¼ã€‚ åº”ç”¨åˆ°æ–‡æœ¬ç‰¹å¾é€‰æ‹©ï¼š Uã€Céƒ½æ˜¯äºŒå€¼éšæœºå˜é‡ï¼Œå½“æ–‡æ¡£åŒ…å«è¯é¡¹tæ—¶ï¼ŒUçš„å–å€¼ä¸º1ï¼Œå¦åˆ™0ï¼›å½“æ–‡æ¡£å±äºç±»åˆ«cæ—¶ï¼ŒCçš„å–å€¼1ï¼Œå¦åˆ™0ã€‚ç®€å•çš„ç†è§£å°±æ˜¯å¯¹äºæ–‡æœ¬æ¥è¯´ï¼Œæ¯ä¸€ä¸ªtokenå°±æ˜¯å®ƒçš„ç‰¹å¾ï¼Œå–å€¼åªæœ‰æœ‰æˆ–è€…æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯0æˆ–è€…1ï¼Œäº’ä¿¡æ¯å¸¸ç”¨äºæ–‡æœ¬ç‰¹å¾çš„é€‰æ‹©ï¼Œä¹Ÿå°± æ˜¯é€‰æ‹©æœ‰ä»·å€¼çš„tokenã€‚åœ¨è´å¶æ–¯æ–‡æœ¬åˆ†ç±»ä¸­ç”¨åˆ°äº†ï¼Œç‰¹æ­¤è®°å½•ã€‚ \\[ I_k = \\sum_{\\tilde{y}=0}^1 \\bigg(p(X = k | Y = \\tilde{y})p(Y = \\tilde{y}) \\log\\frac{p(X = k | Y = \\tilde{y})}{p(X=k)} + (1-p(X = k | Y = \\tilde{y}))p(Y = \\tilde{y}) \\log\\frac{1 - p(X = k | Y = \\tilde{y})}{1 - p(X = k)}\\bigg), \\] å…¬å¼å¦‚ä¸Šã€‚\\(I_k\\)æ„å‘³ç€å•è¯kä¸Yä¹‹é—´çš„äº’ä¿¡æ¯ã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š def calculateMI(dtm_ham_train, dtm_spam_train): ham_sums = np.sum(dtm_ham_train, axis=0) ham_probs = ham_sums / np.sum(ham_sums) spam_sums = np.sum(dtm_spam_train, axis=0) spam_probs = spam_sums / np.sum(spam_sums) all_sums = ham_sums + spam_sums all_probs = all_sums / sum(all_sums) mi = [] for i in range(len(all_probs)): if all_probs[i] == 0 or np.isnan(all_probs[i]): mi.append(0) else: mi.append(.5 * ham_probs[i] * np.log(ham_probs[i] / all_probs[i]) + .5 * (1 - ham_probs[i]) * np.log((1 - ham_probs[i])/(1 - all_probs[i])) + .5 * spam_probs[i] * np.log(spam_probs[i] / all_probs[i]) + .5 * (1 - spam_probs[i]) * np.log((1 - spam_probs[i])/(1 - all_probs[i]))) mi = np.array(mi) mi = np.where(np.isnan(mi), 0, mi) return mi ","date":"2021-02-22","objectID":"/ppmi/:1:1","tags":["NLP","PPMI"],"title":"PPMI","uri":"/ppmi/"},{"categories":["NLP"],"content":"PPMI ","date":"2021-02-22","objectID":"/ppmi/:2:0","tags":["NLP","PPMI"],"title":"PPMI","uri":"/ppmi/"},{"categories":["ç®—æ³•é¢˜"],"content":"è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸² ","date":"2021-02-18","objectID":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/:0:0","tags":["ç®—æ³•é¢˜","è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"],"title":"è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²","uri":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/longest-substring-with-at-least-k-repeating-characters/ ","date":"2021-02-18","objectID":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/:1:0","tags":["ç®—æ³•é¢˜","è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"],"title":"è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²","uri":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š åˆ©ç”¨é€’å½’ï¼Œå¦‚æœsä¸­å­—ç¬¦cçš„æ•°ç›®å°äºk,åˆ™ä»¥cä½œåˆ†å‰²ï¼Œåˆ†æˆçš„å­—ä¸²å†æ¬¡è°ƒç”¨å‡½æ•°å½¢æˆé€’å½’ï¼Œç„¶åä»ä¼—å¤šç»“æœä¸­æ‰¾å¯»æœ€å¤§é•¿åº¦çš„ã€‚ ","date":"2021-02-18","objectID":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/:2:0","tags":["ç®—æ³•é¢˜","è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"],"title":"è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²","uri":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution(object): def longestSubstring(self, s, k): if len(s) \u003c k: return 0 for c in set(s): if s.count(c) \u003c k: return max(self.longestSubstring(t, k) for t in s.split(c)) return len(s) ","date":"2021-02-18","objectID":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/:3:0","tags":["ç®—æ³•é¢˜","è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"],"title":"è‡³å°‘æœ‰kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²","uri":"/%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/"},{"categories":["ç®—æ³•é¢˜"],"content":"æœ€é•¿é€’å¢å­åºåˆ— ","date":"2021-02-17","objectID":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/:0:0","tags":["ç®—æ³•é¢˜","æœ€é•¿é€’å¢å­åºåˆ—"],"title":"æœ€é•¿é€’å¢å­åºåˆ—","uri":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/longest-increasing-subsequence/ ","date":"2021-02-17","objectID":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/:1:0","tags":["ç®—æ³•é¢˜","æœ€é•¿é€’å¢å­åºåˆ—"],"title":"æœ€é•¿é€’å¢å­åºåˆ—","uri":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š åŠ¨æ€è§„åˆ’ å®šä¹‰dp[i]ä¸ºåˆ°nums[i]çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œå…¨éƒ¨éƒ½åˆå§‹åŒ–ä¸º1,å› ä¸ºæœ¬èº«å°±æ˜¯é•¿åº¦ä¸º1çš„é€’å¢å­åºåˆ— ","date":"2021-02-17","objectID":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/:2:0","tags":["ç®—æ³•é¢˜","æœ€é•¿é€’å¢å­åºåˆ—"],"title":"æœ€é•¿é€’å¢å­åºåˆ—","uri":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def lengthOfLIS(self, nums: List[int]) -\u003e int: dp = [1 for _ in range(len(nums))] for i in range(1,len(nums)): for j in range(i): if nums[j] \u003c nums[i]: dp[i] = max(dp[i],dp[j]+1) return max(dp) ","date":"2021-02-17","objectID":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/:3:0","tags":["ç®—æ³•é¢˜","æœ€é•¿é€’å¢å­åºåˆ—"],"title":"æœ€é•¿é€’å¢å­åºåˆ—","uri":"/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"å¤–è§‚æ•°åˆ— https://leetcode-cn.com/problems/count-and-say/ è¿™é¢˜æœ‰æ„æ€ å¯ä»¥æ‰“è¡¨ï¼Œä¸è¿‡æ‰“è¡¨çš„è¿‡ç¨‹ä¹Ÿç›¸å½“äºåšå‡ºæ¥äº† class Solution: def countAndSay(self,n: int) -\u003e str: if n == 1: return '1' s = self.countAndSay(n - 1) n,res = 0,'' for ii,ss in enumerate(s): if ss != s[n]: res += str(ii-n) + s[n] n = ii res += str(len(s) - n) + s[-1] return res print(Solution().countAndSay(3)) æ€è·¯ï¼š â€‹ é€’å½’ï¼Œå°†ä¸Šä¸€å±‚è®¡ç®—å‡ºæ¥çš„ä¸œè¥¿ä½œä¸ºè¿­ä»£å¯¹è±¡ã€‚ ","date":"2021-02-16","objectID":"/%E5%A4%96%E8%A7%82%E6%95%B0%E5%88%97/:0:0","tags":["ç®—æ³•é¢˜","å¤–è§‚æ•°åˆ—"],"title":"å¤–è§‚æ•°åˆ—","uri":"/%E5%A4%96%E8%A7%82%E6%95%B0%E5%88%97/"},{"categories":["pandas","api"],"content":"è°ƒç”¨ä¸ºnp.lib.stride_tricks.as_strided() å¯ä»¥åˆ†å‰²ä¸€ä¸ªæ•°ç»„ä¸ºä¸åŒçš„shapeå—ï¼Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ä»€ä¹ˆæ˜¯strideså‘¢ï¼Ÿå¯ä»¥çœ‹ä¸ªä¾‹å­ï¼š a = np.arange(9, dtype=np.int32).reshape(3,3) print(a) ''' [[0 1 2] [3 4 5] [6 7 8]] ''' print(a.strides) ''' (12, 4) ''' è¿™é‡Œï¼ˆ12ï¼Œ 4ï¼‰ä¸­çš„12è¡¨ç¤ºåœ¨å†…å­˜ä¸­a[n, 0]åˆ°a[n+1, 0]è·¨è¿‡å¤šå°‘byteï¼Œ4è¡¨ç¤ºåœ¨å†…å­˜ä¸­a[n, 0]åˆ°a[n, 1]è·¨è¿‡å¤šå°‘byteã€‚ 32intéœ€è¦4byteæ˜¯ä¼—æ‰€å‘¨çŸ¥ã€‚ çœ‹ä¸€ä¸‹å‡½æ•°çš„å‚æ•°ï¼š numpy.lib.stride_tricks.as_strided(x, shape=None, strides=None, subok=False, writeable=True) xå°±æ˜¯æˆ‘ä»¬è¦åˆ†å‰²çš„çŸ©é˜µï¼Œå¯ä»¥å½“åšæ˜¯ä¸€ä¸ªè“å›¾ï¼Œshapeï¼Œstrideséƒ½æ˜¯æ–°çŸ©é˜µçš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‡½æ•°æŒ‰ç…§ç»™å®šçš„shapeå’Œstridesæ¥åˆ’åˆ†xï¼Œè¿”å›ä¸€ä¸ªæ–°çš„çŸ©é˜µã€‚ å¯¹äºXï¼š å¦‚æœå·ç§¯æ ¸çš„å¤§å°æ˜¯2x2ï¼Œstrideä¸º1ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠçŸ©é˜µXè½¬æ¢ä¸ºåŒ…å«å¦‚ä¸‹4ä¸ªå°çŸ©é˜µçš„æ–°çŸ©é˜µAï¼š å¾ˆæ˜æ˜¾Açš„ç»´åº¦ä¸º(2,2,2,2)ã€‚ æ‰€ä»¥shapeå¯ä»¥ç¡®å®šï¼Œä½†stridesè¿˜ä¸ç¡®å®šï¼š A = as_strided(X, shape=(2,2,2,2), strides) ä¸‹é¢ç¡®å®šstridesï¼Œä»å›¾ä¸­å¯ä»¥ç¡®å®šæœ€ä½ç»´çš„ä¸º4ï¼Œå› ä¸ºæ‰€æœ‰æ•°æ®éƒ½åœ¨Xä¸Šï¼Œæ‰€ä»¥Açš„å„ä¸ªç»´åº¦çš„è·¨åº¦éƒ½è¦æ ¹æ®Xæ¥ç¡®å®šï¼Œè€Œä¸æ˜¯Aä¸­ï¼Œä»¥1å’Œ4ä¸ºä¾‹å­ï¼Œåœ¨Xä¸­çš„è·ç¦»ä¸º12å­—èŠ‚ï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥ç¡®å®šåä¸¤ç»´ï¼šï¼ˆ?,?,12,4ï¼‰ã€‚ å†çœ‹æ›´é«˜ç»´åº¦: ä»Xä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒç»´çš„è·ç¦»ä¸º4ã€‚ ç¬¬ä¸€ç»´ä¹Ÿä¸å¤šè¯´ï¼Œæ˜¯12ã€‚ æœ€åå¯ä»¥strides =ï¼ˆ12ï¼Œ4ï¼Œ12ï¼Œ4ï¼‰ã€‚ è¿™å°±æ˜¯æ•´ä¸ªåˆ†æçš„è¿‡ç¨‹ï¼Œå¯ä»¥æ–¹ä¾¿å·ç§¯æ“ä½œï¼Œä¸æ˜¯å˜›ã€‚ å†çœ‹ä¸€ä¸ªä¾‹å­å°±ç»“æŸäº†ï¼Œä¼°è®¡ä»¥åä¼šå¿˜ï¼Œè®°å½•ä¸‹æ¥ã€‚ æ„æ€å°±æ˜¯å°†ä¸€ä¸ªå‘é‡æ‹“å±•æˆè¿™æ ·çš„å½¢å¼ï¼Œç”¨å¾ªç¯çš„æ–¹æ³•å¾ˆå®¹æ˜“å®ç°ï¼š def sliding_stack_py(v, k): \"Stack sliding windows of v of length k.\" rows = [] for i in range(len(v) - k + 1): rows.append(v[i : (i + k)]) return np.array(rows) ä½†å¦‚æœä¸èƒ½ä½¿ç”¨å¾ªç¯å‘¢ï¼Œå°±å¯ä»¥ç”¨åˆšè¯´çš„è¿™ä¸ªå‡½æ•°äº†: def sliding_stack_np(v, k): return np.lib.stride_tricks.as_strided(v, shape=(len(v) - k + 1, k), strides=(v.strides[0], v.strides[0])) å› ä¸ºåŸå‘é‡æ˜¯1ç»´çš„ï¼Œæ‰€ä»¥è½¬æ¢åçš„stridesä¸º[4,4]ã€‚å¸Œæœ›å¯ä»¥å¸®åŠ©ç†è§£ã€‚ ","date":"2021-02-14","objectID":"/as_strided/:0:0","tags":["pandas","api","as_strided"],"title":"as_strided","uri":"/as_strided/"},{"categories":["NLP"],"content":"NER(å‘½åå®ä½“è¯†åˆ«) å‚è€ƒï¼šhttps://www.jianshu.com/p/16e1f6a7aaef å‘½åå®ä½“è¯†åˆ«ï¼ˆNamed Entity Recognitionï¼Œç®€ç§°NERï¼‰æ˜¯ä¿¡æ¯æå–ã€é—®ç­”ç³»ç»Ÿã€å¥æ³•åˆ†æã€æœºå™¨ç¿»è¯‘ç­‰åº”ç”¨é¢†åŸŸçš„é‡è¦åŸºç¡€å·¥å…·ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯èµ°å‘å®ç”¨åŒ–çš„è¿‡ç¨‹ä¸­å æœ‰é‡è¦åœ°ä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘½åå®ä½“è¯†åˆ«çš„ä»»åŠ¡å°±æ˜¯è¯†åˆ«å‡ºå¾…å¤„ç†æ–‡æœ¬ä¸­ä¸‰å¤§ç±»ï¼ˆå®ä½“ç±»ã€æ—¶é—´ç±»å’Œæ•°å­—ç±»ï¼‰ã€ä¸ƒå°ç±»ï¼ˆäººåã€æœºæ„åã€åœ°åã€æ—¶é—´ã€æ—¥æœŸã€è´§å¸å’Œç™¾åˆ†æ¯”ï¼‰å‘½åå®ä½“ã€‚ ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨å¥å­â€œå°æ˜æ—©ä¸Š8ç‚¹å»å­¦æ ¡ä¸Šè¯¾ã€‚â€ä¸­ï¼Œå¯¹å…¶è¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼Œåº”è¯¥èƒ½æå–ä¿¡æ¯ äººåï¼šå°æ˜ï¼Œæ—¶é—´ï¼šæ—©ä¸Š8ç‚¹ï¼Œåœ°ç‚¹ï¼šå­¦æ ¡ã€‚ ","date":"2021-02-06","objectID":"/ner/:0:0","tags":["NLP","NER"],"title":"NER","uri":"/ner/"},{"categories":["ç®—æ³•é¢˜"],"content":"é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜) ","date":"2021-02-05","objectID":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/:0:0","tags":["ç®—æ³•é¢˜","é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)"],"title":"é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)","uri":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/preimage-size-of-factorial-zeroes-function/ ","date":"2021-02-05","objectID":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/:1:0","tags":["ç®—æ³•é¢˜","é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)"],"title":"é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)","uri":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š é¦–å…ˆå…ˆå†™ä¸ªåˆ¤æ–­é˜¶ä¹˜åæœ‰å¤šå°‘ä¸ªé›¶çš„å‡½æ•°ï¼Œæ€è·¯å°±æ˜¯æ‰¾æ‰€æœ‰ç›¸ä¹˜çš„æ•°ä¸­å› æ•°æœ‰5çš„ä¸ªæ•°ã€‚ ç„¶åå†ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ‰Kä¸ª0çš„å·¦ç•Œå’Œå³ç•Œï¼Œç„¶åç›¸å‡å³å¯ï¼Œå°±æ˜¯è¦æ‰¾çš„æ•°ç›® class Solution: def preimageSizeFZF(self, K: int) -\u003e int: return self.findright(K) - self.findleft(K) def whatzero(self,n): dis = 5 res = 0 while dis \u003c= n: res += n // dis dis *= 5 return res def findleft(self,K): mins,maxs = 0,sys.maxsize while (mins \u003c maxs): mid = mins + (maxs-mins) // 2 if self.whatzero(mid) \u003c K: mins = mid + 1 elif self.whatzero(mid) \u003e K: maxs = mid else: maxs = mid return mins def findright(self,K): mins,maxs = 0,sys.maxsize while (mins \u003c maxs): mid = mins + (maxs-mins) // 2 if self.whatzero(mid) \u003c K: mins = mid + 1 elif self.whatzero(mid) \u003e K: maxs = mid else: mins = mid + 1 return maxs æ³¨æ„è¿™é‡Œçš„æœ€å¤§å€¼è¦åˆå§‹åŒ–ä¸ºsysåº“é‡Œçš„maxsize ç”¨float(â€œinfâ€)ä¼šè¿”å›nanå€¼ ","date":"2021-02-05","objectID":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/:2:0","tags":["ç®—æ³•é¢˜","é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)"],"title":"é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶(é¦–ä¸ªå›°éš¾é¢˜)","uri":"/%E9%98%B6%E4%B9%98%E5%87%BD%E6%95%B0%E5%90%8Ek%E4%B8%AA%E9%9B%B6%E9%A6%96%E4%B8%AA%E5%9B%B0%E9%9A%BE%E9%A2%98/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ‰“å®¶åŠ«èˆ ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:0:0","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ‰“å®¶åŠ«èˆI ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:1:0","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/house-robber/ ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:1:1","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯: ä¸€ä¸ªç®€å•é¢˜ï¼Œä¸è¿‡è¸©äº†ç‰¹ä¾‹çš„å‘ã€‚ã€‚å¯ä»¥æš´åŠ›è§£å†³ ä¹Ÿå¯ä»¥åŠ¨æ€è§„åˆ’ ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:1:2","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç : æš´åŠ›è§£å†³ class Solution: def rob(nums): if nums == []: return 0 if len(nums) == 1: return nums[0] if len(nums) == 2: return max(nums[0],nums[1]) maxs = [] #max[i]ä»£è¡¨åˆ°i+1å®¶çš„æœ€å¤§ä»·é’± maxs.append(nums[0]) maxs.append(nums[1]) for i in range(2,len(nums)): maxs.append(max(maxs[:i-1])+nums[i]) #ä»å¤´åˆ°è¿™å®¶å‰é¢çš„ç¬¬äºŒå®¶æœ€å¤§çš„ä»·é’±åŠ ä¸Šè¿™ä¸€å®¶çš„ä»·é’± return max(maxs) åŠ¨æ€è§„åˆ’ class Solution: def rob(self, nums: List[int]) -\u003e int: if len(nums) \u003c= 2: return max(nums) dp = [0] * len(nums) dp[0], dp[1] = nums[0], max(nums[0], nums[1]) for i in range(2, len(nums)): dp[i] = max(dp[i-1], dp[i-2] + nums[i]) return max(dp) ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:1:3","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ‰“å®¶åŠ«èˆII ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:2:0","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/house-robber-ii/ ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:2:1","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š è·Ÿä¸Šé¢çš„é¢˜ç›®éå¸¸ç±»ä¼¼ï¼Œåªæ˜¯åŠ äº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼Œå°±æ˜¯ç¬¬ä¸€å®¶å’Œæœ€åä¸€å®¶ä¸èƒ½åŒæ—¶æ‰“åŠ«ã€‚ è¿™é‡Œå…ˆå†™ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºä»start åˆ°end èŒƒå›´é‡Œé¢çš„æœ€å¤§å€¼ï¼Œç„¶ååœ¨ä¸»å‡½æ•°é‡Œé¢è¿›è¡Œé€‰æ‹© å¦‚æœæ‰“åŠ«ç¬¬ä¸€å®¶ï¼Œå°±ä¸èƒ½æ‰“åŠ«æœ€åä¸€å®¶ä»¥åŠä¸æ‰“åŠ«ç¬¬ä¸€å®¶å»æ‰“åŠ«æœ€åä¸€å®¶ï¼Œè¿™ä¸¤è€…ä¹‹é—´çš„æœ€å¤§å€¼ ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:2:2","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def rob(self, nums: List[int]) -\u003e int: if len(nums) == 1: return nums[0] return max(self.dp(0,len(nums)-2,nums),self.dp(1,len(nums)-1,nums)) def dp(self,start,end,nums): dp = [0 for _ in range(len(nums)+2)] for i in range(end,start-1,-1): dp[i] = max(dp[i+1],dp[i+2]+nums[i]) return dp[start] ","date":"2021-02-04","objectID":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/:2:3","tags":["ç®—æ³•é¢˜","æ‰“å®¶åŠ«èˆ"],"title":"æ‰“å®¶åŠ«èˆ","uri":"/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/"},{"categories":["python"],"content":"import threading import time ç®€å•çš„åˆ›å»º def run(n): print(\"task\", n) time.sleep(1) print('2s') time.sleep(1) print('1s') time.sleep(1) print('0s') time.sleep(1) if __name__ == '__main__': t1 = threading.Thread(target=run, args=(\"t1\",)) t2 = threading.Thread(target=run, args=(\"t2\",)) t1.start() t2.start() é€šè¿‡ç±»åˆ›å»º class MyThread(threading.Thread): def __init__(self, n): super(MyThread, self).__init__() # é‡æ„runå‡½æ•°å¿…é¡»è¦å†™ self.n = n def run(self): print(\"task\", self.n) time.sleep(1) print('2s') time.sleep(1) print('1s') time.sleep(1) print('0s') time.sleep(1) if __name__ == \"__main__\": t1 = MyThread(\"t1\") t2 = MyThread(\"t2\") t1.start() t2.start() å¯¹æ¯”æ²¡æœ‰join()å’Œjoin()çš„åŒºåˆ« def run(n): print(\"task\", n) time.sleep(1) #æ­¤æ—¶å­çº¿ç¨‹åœ1s print('3') time.sleep(1) print('2') time.sleep(1) print('1') if __name__ == '__main__': t = threading.Thread(target=run, args=(\"t1\",)) t.setDaemon(True) #æŠŠå­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¿…é¡»åœ¨start()ä¹‹å‰è®¾ç½® t.start() print(\"end\") def run(n): print(\"task\", n) time.sleep(1) #æ­¤æ—¶å­çº¿ç¨‹åœ1s print('3') time.sleep(1) print('2') time.sleep(1) print('1') if __name__ == '__main__': t = threading.Thread(target=run, args=(\"t1\",)) t.setDaemon(True) #æŠŠå­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¿…é¡»åœ¨start()ä¹‹å‰è®¾ç½® t.start() t.join() # è®¾ç½®ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ç»“æŸ print(\"end\") é”çš„åº”ç”¨ def run(n, semaphore): semaphore.acquire() #åŠ é” time.sleep(1) print(\"run the thread:%s\\n\" % n) semaphore.release() #é‡Šæ”¾ if __name__ == '__main__': num = 0 semaphore = threading.BoundedSemaphore(5) # æœ€å¤šå…è®¸5ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ for i in range(22): t = threading.Thread(target=run, args=(\"t-%s\" % i, semaphore)) t.start() while threading.active_count() != 1: pass # print threading.active_count() else: print('--') äº‹ä»¶ç±» event = threading.Event() def lighter(): count = 0 event.set() #åˆå§‹å€¼ä¸ºç»¿ç¯ while True: if 5 \u003c count \u003c=10 : event.clear() # çº¢ç¯ï¼Œæ¸…é™¤æ ‡å¿—ä½ print(\"\\33[41;1mred light is on...\\033[0m\") elif count \u003e 10: event.set() # ç»¿ç¯ï¼Œè®¾ç½®æ ‡å¿—ä½ count = 0 else: print(\"\\33[42;1mgreen light is on...\\033[0m\") time.sleep(1) count += 1 def car(name): while True: if event.is_set(): #åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†æ ‡å¿—ä½ï¼ˆç»¿ç¯ï¼‰ print(\"[%s] running...\"%name) time.sleep(1) else: print(\"[%s] sees red light,waiting...\"%name) event.wait()#å¦‚æœå˜ä¸ºç»¿ç¯ print(\"[%s] green light is on,start going...\"%name) light = threading.Thread(target=lighter,) light.start() car = threading.Thread(target=car,args=(\"MINI\",)) car.start() queueé˜Ÿåˆ— import threading import queue,time q=queue.Queue(maxsize=10) def Producer(name): count=1 while True: q.put(\"éª¨å¤´ %s\"%count) print(\"{}ç”Ÿäº§äº†éª¨å¤´\".format(name),count) count+=1 time.sleep(1) def Consumer(name): while True: print(\"[%s] å–åˆ° [%s] å¹¶ä¸”åƒäº†å®ƒã€‚ã€‚ã€‚\"%(name,q.get())) time.sleep(1) p=threading.Thread(target=Producer,args=('wlb',)) c=threading.Thread(target=Consumer,args=(\"dog\",)) c1=threading.Thread(target=Consumer,args=(\"cat\",)) p.start() c.start() c1.start() äº’æ–¥é” ç”±äºçº¿ç¨‹ä¹‹é—´æ˜¯è¿›è¡Œéšæœºè°ƒåº¦ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹å¯èƒ½åªæ‰§è¡Œnæ¡æ‰§è¡Œä¹‹åï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€æ¡æ•°æ®æ—¶å¯èƒ½ä¼šå‡ºç°è„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œå‡ºç°äº†çº¿ç¨‹é”ï¼Œå³åŒä¸€æ—¶åˆ»å…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ“ä½œã€‚çº¿ç¨‹é”ç”¨äºé”å®šèµ„æºï¼Œä½ å¯ä»¥å®šä¹‰å¤šä¸ªé”, åƒä¸‹é¢çš„ä»£ç , å½“ä½ éœ€è¦ç‹¬å æŸä¸€èµ„æºæ—¶ï¼Œä»»ä½•ä¸€ä¸ªé”éƒ½å¯ä»¥é”è¿™ä¸ªèµ„æºï¼Œå°±å¥½æ¯”ä½ ç”¨ä¸åŒçš„é”éƒ½å¯ä»¥æŠŠç›¸åŒçš„ä¸€ä¸ªé—¨é”ä½æ˜¯ä¸€ä¸ªé“ç†ã€‚ ç”±äºçº¿ç¨‹ä¹‹é—´æ˜¯è¿›è¡Œéšæœºè°ƒåº¦ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å¾ˆå¥½åœ°ä¿æŠ¤è¯¥å¯¹è±¡ï¼Œä¼šé€ æˆç¨‹åºç»“æœçš„ä¸å¯é¢„æœŸï¼Œæˆ‘ä»¬ä¹Ÿç§°æ­¤ä¸ºâ€œçº¿ç¨‹ä¸å®‰å…¨â€ã€‚ ä¸ºäº†æ–¹å¼ä¸Šé¢æƒ…å†µçš„å‘ç”Ÿï¼Œå°±å‡ºç°äº†äº’æ–¥é”(Lock) from threading import Thread,Lock import os,time def work(): global n lock.acquire() temp=n time.sleep(0.1) n=temp-1 lock.release() if __name__ == '__main__': lock=Lock() n=100 l=[] for i in range(100): p=Thread(target=work) l.append(p) p.start() for p in l: p.join() ä¿¡å·é‡ äº’æ–¥é”åŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹æ•°æ®ï¼Œè€ŒSemaphoreæ˜¯åŒæ—¶å…è®¸ä¸€å®šæ•°é‡çš„çº¿ç¨‹æ›´æ”¹æ•°æ® ï¼Œæ¯”å¦‚å•æ‰€æœ‰3ä¸ªå‘ï¼Œé‚£æœ€å¤šåªå…è®¸3ä¸ªäººä¸Šå•æ‰€ï¼Œåé¢çš„äººåªèƒ½ç­‰é‡Œé¢æœ‰äººå‡ºæ¥äº†æ‰èƒ½å†è¿›å»ã€‚ import threading import time def run(n, semaphore): semaphore.acquire() #åŠ é” time.sleep(1) print(\"run the thread:%s\\n\" % n) semaphore.release() #é‡Šæ”¾ if __name__ == '__main__': num = 0 semaphore = threading.BoundedSemaphore(5) # æœ€å¤šå…è®¸5ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ for i in range(22): t = threading.Thread(target=run, args=(\"t-%s\" % i, semaphore)) t.start() while threading.active_count() != 1: pass # print threading.active_count() else: print('--') GILï¼ˆGlobal Interpreter Lockï¼‰å…¨å±€è§£é‡Šå™¨é” åœ¨épythonç¯å¢ƒä¸­ï¼Œå•æ ¸æƒ…å†µä¸‹ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚å¤šæ ¸æ—¶å¯ä»¥æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚ä½†æ˜¯åœ¨pythonä¸­ï¼Œæ— è®ºæœ‰å¤šå°‘æ ¸ï¼ŒåŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚ç©¶å…¶åŸå› ï¼Œè¿™å°±æ˜¯ç”±äºGILçš„å­˜åœ¨å¯¼è‡´çš„ã€‚ GILçš„å…¨ç§°æ˜¯Global Interpreter Lock(å…¨å±€è§£é‡Šå™¨é”)ï¼Œæ¥æºæ˜¯pythonè®¾è®¡ä¹‹åˆçš„è€ƒè™‘ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ‰€åšçš„å†³å®šã€‚æŸä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œï¼Œå¿…é¡»å…ˆæ‹¿åˆ°GILï¼Œæˆ‘ä»¬å¯ä»¥æŠŠGILçœ‹ä½œæ˜¯â€œé€šè¡Œè¯â€ï¼Œå¹¶ä¸”åœ¨","date":"2021-01-21","objectID":"/thread/:0:0","tags":["python","thread"],"title":"thread","uri":"/thread/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä¸‘æ•°ç³»åˆ— ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:0:0","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"1.ä¸‘æ•° ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:1:0","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/ugly-number/ ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:1:1","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š å°±æ˜¯è®©è¿™ä¸ªæ•°å­—ä¸æ–­åœ°é™¤ä»¥2.3.5 å¦‚æœæœ€åå˜æˆäº†1 å°±è¯´æ˜æ˜¯ä¸ªä¸‘æ•° ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:1:2","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def isUgly(self, num: int) -\u003e bool: if num\u003c=-231 or num\u003e=231-1: return False while num \u003e1: if num %2 == 0: num=int(num/2) elif num %3 ==0: num =int(num/3) elif num %5 ==0: num=int(num/5) else: break if num == 1: return True else: return False ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:1:3","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä¸‘æ•°II ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:2:0","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/ugly-number-ii/ ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:2:1","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯ï¼š åˆ©ç”¨ä¸‰æŒ‡é’ˆï¼Œç»´æŠ¤i2 i3 i5ä¸‰ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘2 3 5 ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:2:2","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š class Solution: def nthUglyNumber(self, n: int) -\u003e int: res = [1] # å…ˆåˆå§‹åŒ–ä¸º1 i2 = i3 = i5 = 0 # åˆå§‹åŒ–ä¸º0 for i in range(1,n): mins = min(res[i2]*2,res[i3]*3,res[i5]*5) # ä»å°åˆ°å¤§æ‰¾ res.append(mins) if res[i] == res[i2]*2: i2 += 1 if res[i] == res[i3]*3: i3 += 1 if res[i] == res[i5]*5: i5 += 1 return res[n-1] ","date":"2021-01-18","objectID":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/:2:3","tags":["ç®—æ³•é¢˜","ä¸‘æ•°ç³»åˆ—"],"title":"ä¸‘æ•°ç³»åˆ—","uri":"/%E4%B8%91%E6%95%B0%E7%B3%BB%E5%88%97/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"æ¢¯åº¦æå‡å†³ç­–æ ‘(GBDT) GBDT(Gradient Boosting Decision Tree)æ˜¯ä¸€ç§è¿­ä»£çš„å†³ç­–æ ‘ç®—æ³•ï¼Œç”±å¤šæ£µå†³ç­–æ ‘ç»„æˆï¼Œæ‰€æœ‰æ ‘çš„ç»“è®ºç´¯åŠ èµ·æ¥ä½œä¸ºæœ€ç»ˆç­”æ¡ˆã€‚ ","date":"2021-01-06","objectID":"/gbdt/:0:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"å›å½’æ ‘ é€‰æ‹©æœ€ä¼˜åˆ‡åˆ†å˜é‡jä¸åˆ‡åˆ†ç‚¹sï¼šéå†å˜é‡jï¼Œå¯¹è§„å®šçš„åˆ‡åˆ†å˜é‡jæ‰«æåˆ‡åˆ†ç‚¹sï¼Œé€‰æ‹©ä½¿ä¸‹å¼å¾—åˆ°æœ€å° å€¼æ—¶çš„(j,s)å¯¹ã€‚å…¶ä¸­Rmæ˜¯è¢«åˆ’åˆ†çš„è¾“å…¥ç©ºé—´ï¼Œ \\(\\mathrm{cm}\\) æ˜¯ç©ºé—´Rmå¯¹åº”çš„å›ºå®šè¾“å‡ºå€¼ã€‚ \\[ \\min_{j, s}\\left[\\min_{c_{1}} \\sum_{x_{i} \\in R_{i}(j, s)}\\left(y_{i}-c_{1}\\right)^{2}+\\min_{c_{2}} \\sum_{x_{i} \\in R_{i}(j, s)}\\left(y_{i}-c_{1}\\right)^{2}\\right] \\] ç”¨é€‰å®šçš„(j,s)å¯¹ï¼Œåˆ’åˆ†åŒºåŸŸå¹¶å†³å®šç›¸åº”çš„è¾“å‡ºå€¼ \\[ \\begin{gathered} R_{1}(j, s)=\\{x \\mid x^{(j)} \\leq s\\}, R_{2}(j, s)=\\{x \\mid x^{(j)}\u003es\\} \\\\\\\\ \\hat{c}_{m}=\\frac{1}{N_{m}} \\sum_{x_{i} \\in R_{m}(j, s)} y_{i} \\\\\\\\ x \\in R_{m}, m=1,2 \\end{gathered} \\] ç»§ç»­å¯¹ä¸¤ä¸ªå­åŒºåŸŸè°ƒç”¨ä¸Šè¿°æ­¥éª¤ï¼Œå°†è¾“å…¥ç©ºé—´åˆ’åˆ†ä¸º \\(M\\) ä¸ªåŒºåŸŸR1,R2,..,Rmï¼Œç”Ÿæˆå†³ç­–æ ‘ã€‚ \\[ f(x)=\\sum_{m=1}^{M} \\hat{c}_{m} I\\left(x \\epsilon R_{m}\\right) \\] å½“è¾“å…¥ç©ºé—´åˆ’åˆ†ç¡®å®šæ—¶ï¼Œå¯ä»¥ç”¨å¹³æ–¹è¯¯å·®æ¥è¡¨ç¤ºå›å½’æ ‘å¯¹äºè®­ç»ƒæ•°æ®çš„é¢„æµ‹æ–¹æ³•ï¼Œç”¨å¹³æ–¹è¯¯å·®æœ€å° çš„å‡†åˆ™æ±‚è§£æ¯ä¸ªå•å…ƒä¸Šçš„æœ€ä¼˜è¾“å‡ºå€¼ã€‚ ","date":"2021-01-06","objectID":"/gbdt/:1:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"æå‡æ ‘ æ¢¯åº¦æå‡æ ‘æ˜¯æå‡æ ‘ï¼ˆBoosting Treeï¼‰çš„ä¸€ç§æ”¹è¿›ç®—æ³•ï¼Œæ‰€ä»¥åœ¨è®²æ¢¯åº¦æå‡æ ‘ä¹‹å‰å…ˆæ¥è¯´ä¸€ä¸‹æå‡æ ‘ã€‚ å…ˆæ¥ä¸ªé€šä¿—ç†è§£ï¼šå‡å¦‚æœ‰ä¸ªäºº30å²ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨20å²å»æ‹Ÿåˆï¼Œå‘ç°æŸå¤±æœ‰10å²ï¼Œè¿™æ—¶æˆ‘ä»¬ç”¨6å²å»æ‹Ÿåˆå‰©ä¸‹çš„æŸå¤±ï¼Œå‘ç°å·®è·è¿˜æœ‰4å²ï¼Œç¬¬ä¸‰è½®æˆ‘ä»¬ç”¨3å²æ‹Ÿåˆå‰©ä¸‹çš„å·®è·ï¼Œå·®è·å°±åªæœ‰ä¸€å²äº†ã€‚å¦‚æœæˆ‘ä»¬çš„è¿­ä»£è½®æ•°è¿˜æ²¡æœ‰å®Œï¼Œå¯ä»¥ç»§ç»­è¿­ä»£ä¸‹é¢ï¼Œæ¯ä¸€è½®è¿­ä»£ï¼Œæ‹Ÿåˆçš„å²æ•°è¯¯å·®éƒ½ä¼šå‡å°ã€‚æœ€åå°†æ¯æ¬¡æ‹Ÿåˆçš„å²æ•°åŠ èµ·æ¥ä¾¿æ˜¯æ¨¡å‹è¾“å‡ºçš„ç»“æœã€‚ æå‡æ ‘ç®—æ³•: (1) åˆå§‹åŒ– \\(f_{0}(x)=0\\) (2) å¯¹ \\(m=1,2, \\ldots, M\\) (a) è®¡ç®—æ®‹å·® \\[ r_{m i}=y_{i}-f_{m-1}(x), i=1,2, \\ldots, N \\] ä¸ºä»€ä¹ˆæ®‹å·®æ˜¯è¿™ç§å½¢å¼ï¼Ÿ å½“é‡‡ç”¨å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°æ—¶, \\[ L(y, f(x))=(y-f(x))^2 \\] å…¶æŸå¤±å˜ä¸º \\[ \\begin{aligned} L\\left(y, f_{m-1}(x)+T\\left(x ; \\Theta_m\\right)\\right) \u0026=\\left[y-f_{m-1}(x)-T\\left(x ; \\Theta_m\\right)\\right]^2 \\\\\\\\ \u0026=\\left[r-T\\left(x ; \\Theta_m\\right)\\right]^2 \\end{aligned} \\] è¿™é‡Œ, \\[ r=y-f_{m-1}(x) \\] ä¹Ÿå¯ä»¥ç”¨ä¸Šä¸€æ­¥çš„æ®‹å·®ï¼ˆå®šä¹‰çš„ä¸Šä¸€æ­¥çš„æ ‡ç­¾ï¼‰å‡å»æ‹Ÿåˆä¸Šä¸€æ­¥æ®‹å·®çš„å›å½’æ ‘ã€‚å³ï¼š \\[ r_{mi} = r_{(m-1)i} - h_{m-1}(x) \\] æ˜“è¯æ˜è¿™ä¸¤ç§å½¢å¼ç­‰ä»·ã€‚ (b) æ‹Ÿåˆæ®‹å·® \\(r_{m i}\\) å­¦ä¹ ä¸€ä¸ªå›å½’æ ‘ï¼Œå¾—åˆ° \\(h_{m}(x)\\) (c) æ›´æ–° \\(f_{m}(x)=f_{m-1}+h_{m}(x)\\) (3) å¾—åˆ°å›å½’é—®é¢˜æå‡æ ‘ \\[ f_{M}(x)=\\sum_{m=1}^{M} h_{m}(x) \\] ","date":"2021-01-06","objectID":"/gbdt/:2:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"GBDT GBDTä¸æå‡æ ‘ä¸åŒçš„æ˜¯GBDTä½¿ç”¨è´Ÿæ¢¯åº¦æ¥è¿‘ä¼¼æ®‹å·®ã€‚ GBDTç®—æ³•: (1) åˆå§‹åŒ–å¼±å­¦ä¹ å™¨ \\[ f_{0}(x)=\\arg \\min_{c} \\sum_{i=1}^{N} L\\left(y_{i}, c\\right) \\] å¯¹ \\(m=1,2, \\ldots, M\\) æœ‰: å¯¹æ¯ä¸ªæ ·æœ¬ \\(i=1,2, \\ldots, N\\) ï¼Œè®¡ç®—è´Ÿæ¢¯åº¦ï¼Œå³æ®‹å·® \\[ r_{i m}=-\\left[\\frac{\\left.\\partial L\\left(y_{i}, f\\left(x_{i}\\right)\\right)\\right)}{\\partial f\\left(x_{i}\\right)}\\right]_{f(x)=f_{m-1}(x)} \\] ä¸€èˆ¬å›å½’çš„æŸå¤±å‡½æ•°å°±æ˜¯å‡æ–¹è¯¯å·®ï¼Œä½†ç¼ºç‚¹æ˜¯å¯¹äºoutlieræ¯”è¾ƒæ•æ„Ÿã€‚ å› æ­¤å¯ä»¥é€‰æ‹©ä½¿ç”¨MAEæˆ–è€…Huber lossã€‚æ‰€ä»¥è¯´è´Ÿæ¢¯åº¦å¹¶ä¸ç­‰äºæ®‹å·®ï¼ŒæŸå¤±å‡½æ•°é€‰æ‹©MSEçš„æ—¶å€™æ‰å¯ä»¥åˆ’ç­‰å·ã€‚ å°†ä¸Šæ­¥å¾—åˆ°çš„æ®‹å·®ä½œä¸ºæ ·æœ¬æ–°çš„çœŸå®å€¼ï¼Œå¹¶å°†æ•°æ® \\(\\left(x_{i}, r_{i m}\\right), i=1,2, . . N\\) ä½œä¸ºä¸‹æ£µæ ‘çš„è®­ç»ƒæ•°æ®ï¼Œå¾—åˆ°ä¸€é¢—æ–°çš„å›å½’æ ‘ \\(f_{m}(x)\\) å…¶å¯¹åº”çš„å¶å­èŠ‚ç‚¹åŒºåŸŸä¸º \\(R_{j m}, j=1,2, \\ldots, J\\) ã€‚å…¶ä¸­ \\(J\\) ä¸ºå›å½’æ ‘çš„å¶å­èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚ å¯¹å¶å­åŒºåŸŸ \\(j=1,2, . . J\\) è®¡ç®—æœ€ä½³æ‹Ÿåˆå€¼ \\[ \\Upsilon_{j m}=\\underbrace{\\arg \\min}_{\\Upsilon} \\sum_{x_{i} \\in R_{j m}} L\\left(y_{i}, f_{m-1}\\left(x_{i}\\right)+\\Upsilon\\right) \\] ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼š \\[ \\Upsilon_{jm} = \\underbrace{\\arg \\min}_{\\Upsilon} \\sum_{x_i \\in R_{jm}} L(r_{im}, \\Upsilon) \\] æŸå¤±å‡½æ•°Lä¸ºMSEæ—¶ï¼Œå°±ä¸å›å½’æ ‘çš„æ„å»ºç±»ä¼¼ï¼Œæœ€ä½³æ‹Ÿåˆå€¼å°±æ˜¯åˆ’åˆ†çš„å¶å­èŠ‚ç‚¹çš„å‡å€¼ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºæå‡æ ‘å’ŒGBDTçš„åŒºåˆ«å°±æ˜¯è®¡ç®—æ®‹å·®çš„æ–¹å¼ä¸åŒã€‚ æ›´æ–°å¼ºå­¦ä¹ å™¨ \\[ f_{m}(x)=f_{m-1}(x)+\\sum_{j=1}^{J} \\Upsilon_{j m} I\\left(x \\in R_{j m}\\right) \\] å¾—åˆ°æœ€ç»ˆå­¦ä¹ å™¨ \\[ f(x)=f_{M}(x)=f_{0}(x)+\\sum_{m=1}^{M} \\sum_{j=1}^{J} \\Upsilon_{j m} I\\left(x \\in R_{j m}\\right) \\] å®ä¾‹å¯ä»¥çœ‹å‚è€ƒé‡Œé¢ã€‚ ","date":"2021-01-06","objectID":"/gbdt/:3:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"ä¸æ¢¯åº¦ä¸‹é™ç®—æ³•çš„å…³ç³» ","date":"2021-01-06","objectID":"/gbdt/:4:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting"],"content":"ä»£ç  import numpy as np class RegressionTree: def __init__(self, max_depth=2, min_samples_split=2): self.max_depth = max_depth self.min_samples_split = min_samples_split self.tree = {} def fit(self, X, y): self.X = X self.y = y self.n_features = X.shape[1] self.n_samples = X.shape[0] self.tree = self._build_tree(X, y) def predict(self, X): return np.array([self._predict(inputs) for inputs in X]) def _build_tree(self, X, y, depth=0): m = X.shape[0] n = X.shape[1] # 1. ç»ˆæ­¢æ¡ä»¶ if m \u003c= self.min_samples_split or depth \u003e= self.max_depth: return self._leaf(y) # 2. æ‰¾åˆ°æœ€ä¼˜åˆ†è£‚ç‰¹å¾å’Œç‰¹å¾å€¼ feature, value = self._best_split(X, y) # 3. æ„å»ºå­æ ‘ left_idx, right_idx = self._split(X, feature, value) left = self._build_tree(X[left_idx, :], y[left_idx], depth + 1) right = self._build_tree(X[right_idx, :], y[right_idx], depth + 1) return {\"feature\": feature, \"value\": value, \"left\": left, \"right\": right} def _leaf(self, y): return np.mean(y) def _best_split(self, X, y): m = X.shape[0] n = X.shape[1] min_mse = np.inf best_feature = None best_value = None for feature in range(n): values = np.unique(X[:, feature]) for value in values: y1 = y[X[:, feature] \u003c value] y2 = y[X[:, feature] \u003e= value] mse = np.mean(y1) - np.mean(y2) if mse \u003c min_mse: min_mse = mse best_feature = feature best_value = value return best_feature, best_value def _split(self, X, feature, value): left_idx = np.argwhere(X[:, feature] \u003c value).flatten() right_idx = np.argwhere(X[:, feature] \u003e= value).flatten() return left_idx, right_idx class GBDT: def __init__(self, n_estimators=10, learning_rate=0.1, max_depth=3): self.n_estimators = n_estimators self.learning_rate = learning_rate self.max_depth = max_depth self.trees = [] def fit(self, X, y): y_pred = np.zeros_like(y, dtype=np.float) for i in range(self.n_estimators): tree = RegressionTree(self.max_depth) tree.fit(X, -self.gradient(y, y_pred)) y_pred += self.learning_rate * tree.predict(X) self.trees.append(tree) def predict(self, X): y_pred = np.zeros((X.shape[0], ), dtype=np.float) for tree in self.trees: y_pred += self.learning_rate * tree.predict(X) return y_pred def gradient(self, y_true, y_pred): return y_true - y_pred ä¸ºä»€ä¹ˆxgboost/gbdtåœ¨è°ƒå‚æ—¶ä¸ºä»€ä¹ˆæ ‘çš„æ·±åº¦å¾ˆå°‘å°±èƒ½è¾¾åˆ°å¾ˆé«˜çš„ç²¾åº¦ï¼Ÿ Boostingä¸»è¦å…³æ³¨é™ä½åå·®ï¼Œå› æ­¤Boostingèƒ½åŸºäºæ³›åŒ–æ€§èƒ½ç›¸å½“å¼±çš„å­¦ä¹ å™¨æ„å»ºå‡ºå¾ˆå¼ºçš„é›†æˆï¼›Baggingä¸»è¦å…³æ³¨é™ä½æ–¹å·®ï¼Œå› æ­¤å®ƒåœ¨ä¸å‰ªæçš„å†³ç­–æ ‘ã€ç¥ç»ç½‘ç»œç­‰å­¦ä¹ å™¨ä¸Šæ•ˆç”¨æ›´ä¸ºæ˜æ˜¾ã€‚ å¯¹äºBaggingç®—æ³•æ¥è¯´ï¼Œç”±äºæˆ‘ä»¬ä¼šå¹¶è¡Œåœ°è®­ç»ƒå¾ˆå¤šä¸åŒçš„åˆ†ç±»å™¨çš„ç›®çš„å°±æ˜¯é™ä½è¿™ä¸ªæ–¹å·®(variance) ,å› ä¸ºé‡‡ç”¨äº†ç›¸äº’ç‹¬ç«‹çš„åŸºåˆ†ç±»å™¨å¤šäº†ä»¥åï¼Œhçš„å€¼è‡ªç„¶å°±ä¼šé è¿‘ã€‚æ‰€ä»¥å¯¹äºæ¯ä¸ªåŸºåˆ†ç±»å™¨æ¥è¯´ï¼Œç›®æ ‡å°±æ˜¯å¦‚ä½•é™ä½è¿™ä¸ªåå·®ï¼ˆbias),æ‰€ä»¥æˆ‘ä»¬ä¼šé‡‡ç”¨æ·±åº¦å¾ˆæ·±ç”šè‡³ä¸å‰ªæçš„å†³ç­–æ ‘ã€‚ å¯¹äºBoostingæ¥è¯´ï¼Œæ¯ä¸€æ­¥æˆ‘ä»¬éƒ½ä¼šåœ¨ä¸Šä¸€è½®çš„åŸºç¡€ä¸Šæ›´åŠ æ‹ŸåˆåŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åå·®ï¼ˆbiasï¼‰,æ‰€ä»¥å¯¹äºæ¯ä¸ªåŸºåˆ†ç±»å™¨æ¥è¯´ï¼Œé—®é¢˜å°±åœ¨äºå¦‚ä½•é€‰æ‹©varianceæ›´å°çš„åˆ†ç±»å™¨ï¼Œå³æ›´ç®€å•çš„åˆ†ç±»å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†æ·±åº¦å¾ˆæµ…çš„å†³ç­–æ ‘ã€‚ ## å‚è€ƒ https://blog.csdn.net/zpalyq110/article/details/79527653 https://zhuanlan.zhihu.com/p/280222403 ","date":"2021-01-06","objectID":"/gbdt/:5:0","tags":["Machine Learning","é›†æˆå­¦ä¹ ","Boosting","GBDT"],"title":"GBDT","uri":"/gbdt/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ","date":"2021-01-03","objectID":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/:0:0","tags":["ç®—æ³•é¢˜","ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"],"title":"ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","uri":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"é¢˜ç›®ï¼š https://leetcode-cn.com/problems/swap-nodes-in-pairs/ ","date":"2021-01-03","objectID":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/:1:0","tags":["ç®—æ³•é¢˜","ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"],"title":"ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","uri":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"æ€è·¯: å…ˆæŠŠç¬¬äºŒä½å‚¨å­˜èµ·æ¥ï¼Œç„¶åå°†åé¢çš„é€’å½’æ“ä½œåï¼Œå†æŠŠç¬¬äºŒä½æŒ‡å‘ç¬¬ä¸€ä½ï¼Œå®Œæˆæ¢ä½ ","date":"2021-01-03","objectID":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/:2:0","tags":["ç®—æ³•é¢˜","ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"],"title":"ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","uri":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"ä»£ç ï¼š # Definition for singly-linked list. # class ListNode: # def __init__(self, val=0, next=None): # self.val = val # self.next = next class Solution: #å‡è®¾ä¸º[1,2,3,4] def swapPairs(self, head: ListNode) -\u003e ListNode: if not head or not head.next: #é€’å½’å‡ºå£ return head newnode = head.next #å‚¨å­˜ç¬¬äºŒä½2 head.next = self.swapPairs(head.next.next) #æ­¤æ—¶ä¸º[1,4,3] newnode.next = head #[2,1,4,3] return newnode ","date":"2021-01-03","objectID":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/:3:0","tags":["ç®—æ³•é¢˜","ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"],"title":"ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹","uri":"/%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/"},{"categories":["ç®—æ³•é¢˜"],"content":"ç§èŠ±é—®é¢˜ï¼ˆæ–°å¹´å¿«ä¹!2021ç¬¬ä¸€é¢˜ï¼‰ æ–°å¹´å¿«ä¹ï¼2021å¹´ç¬¬ä¸€é¢˜ï¼Œæ¯æ—¥ä¸€é¢˜ï¼å¸Œæœ›2021å¹´LCå’Œgithubå¯ä»¥å…¨ç»¿ï¼åŠ æ²¹ï¼ https://leetcode-cn.com/problems/can-place-flowers/ ä»£ç å¦‚ä¸‹ï¼š class Solution: def canPlaceFlowers(self, flowerbed: List[int], n: int) -\u003e bool: flowerbed = [0] + flowerbed + [0] for i in range(1,len(flowerbed)-1): if flowerbed[i-1] == 0 and flowerbed[i] == 0 and flowerbed[i+1] == 0: n -= 1 flowerbed[i] = 1 return n \u003c= 0 æ€è·¯å¾ˆæš´åŠ›ï¼Œå°±æ˜¯ä¸‰ä¸ª0åœ¨ä¸€èµ·å°±å¯ä»¥æ’è¿›å»ã€‚ã€‚ ä¸»è¦æ˜¯è¾¹ç•Œé—®é¢˜ï¼Œè¿™é‡Œæ„é€ äº†ä¸¤ä¸ªè¾¹ç•Œ æ–°çš„ä¸€å¹´å¼€å¼€å¿ƒå¿ƒï¼Œå®Œæˆè‡ªå·±çš„ç›®æ ‡ï¼Œè®©è‡ªå·±æ›´ä¼˜ç§€ï¼ ","date":"2021-01-01","objectID":"/%E7%A7%8D%E8%8A%B1%E9%97%AE%E9%A2%98%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%902021%E7%AC%AC%E4%B8%80%E9%A2%98/:0:0","tags":["ç®—æ³•é¢˜","ç§èŠ±é—®é¢˜ï¼ˆæ–°å¹´å¿«ä¹!2021ç¬¬ä¸€é¢˜ï¼‰"],"title":"ç§èŠ±é—®é¢˜ï¼ˆæ–°å¹´å¿«ä¹!2021ç¬¬ä¸€é¢˜ï¼‰","uri":"/%E7%A7%8D%E8%8A%B1%E9%97%AE%E9%A2%98%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%902021%E7%AC%AC%E4%B8%80%E9%A2%98/"},{"categories":["ç®—æ³•é¢˜"],"content":"é›¶é’±å…‘æ¢ https://leetcode-cn.com/problems/coin-change/ ä»¥æˆ‘ç›®å‰çš„æ°´å¹³åšå‡ºæ¥æœ‰ç‚¹åƒåŠ›ï¼Œçœ‹äº†æ€è·¯æ‰åšå‡ºæ¥ class Solution: def coinChange(self, coins: List[int], amount: int) -\u003e int: dp = [float('inf')] * (amount + 1) dp[0] = 0 for i in range(amount+1): for coin in coins: # if i \u003e= coin: dp[i] = min(dp[i],dp[i-coin]+1) return -1 if (dp[-1] == float(\"inf\")) else dp[-1] ä¼ªä»£ç å¦‚ä¸‹ # ä¼ªç æ¡†æ¶ def coinChange(coins: List[int], amount: int): # å®šä¹‰ï¼šè¦å‡‘å‡ºé‡‘é¢ nï¼Œè‡³å°‘è¦ dp(n) ä¸ªç¡¬å¸ def dp(n): # åšé€‰æ‹©ï¼Œé€‰æ‹©éœ€è¦ç¡¬å¸æœ€å°‘çš„é‚£ä¸ªç»“æœ for coin in coins: res = min(res, 1 + dp(n - coin)) return res # é¢˜ç›®è¦æ±‚çš„æœ€ç»ˆç»“æœæ˜¯ dp(amount) return dp(amount) ","date":"2020-10-10","objectID":"/%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/:0:0","tags":["ç®—æ³•é¢˜","é›¶é’±å…‘æ¢"],"title":"é›¶é’±å…‘æ¢","uri":"/%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/"},{"categories":["ç®—æ³•é¢˜"],"content":"å»é™¤é‡å¤å­—æ¯ ä¸€å¼€å§‹çœ‹åˆ°é¢˜ç›®æ„Ÿè§‰æŒºç®€å•çš„ï¼Œæ²¡æƒ³åˆ°å¯¹ç°åœ¨çš„æˆ‘æŒºæœ‰éš¾åº¦ã€‚ã€‚ https://leetcode-cn.com/problems/remove-duplicate-letters/ #1 class Solution: def removeDuplicateLetters(s: str): res = \"\" while s: #ç”¨é€’å½’ä¹Ÿå¯ä»¥ loc = min(map(s.rindex,s)) #s.rindexæ˜¯è¿”å›åˆ—è¡¨å„å€¼æœ€åå‡ºç°çš„ç´¢å¼• æ±‚è¿™ä¸ªæœ€å°çš„ç´¢å¼• a = min(s[:loc+1]) #æ±‚å­—å…¸åºæœ€å°çš„ res += a s = s[s.index(a):].replace(a,\"\") #æŠŠå·²ç»åŠ å…¥çš„å’Œä¸å…¶é‡å¤çš„éƒ½å»æ‰äº† return res #2 #éå†å­—ç¬¦ä¸²ï¼Œå‹å…¥æ ˆï¼Œå¦‚æœé‡åˆ°æ¯”æ ˆé¡¶å°çš„å…ƒç´ ä¸”å½“å‰å­—ç¬¦åé¢è¿˜æœ‰ä¸æ ˆé¡¶ç›¸åŒçš„å…ƒç´ æ—¶ï¼Œç§»é™¤æ ˆé¡¶å…ƒç´  class Solution: def removeDuplicateLetters(s: str) -\u003e str: stack = [] for i, t in enumerate(s): if t in stack: continue while stack !=[] and t \u003c stack[-1] and s[i:].find(stack[-1]) != -1: stack.pop() stack.append(t) return \"\".join(stack) ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬äºŒä¸ªæ–¹æ³•æ›´å¥½æƒ³ç‚¹ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯copyçš„ ","date":"2020-09-02","objectID":"/%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E5%AD%97%E6%AF%8D/:0:0","tags":["ç®—æ³•é¢˜","å»é™¤é‡å¤å­—æ¯"],"title":"å»é™¤é‡å¤å­—æ¯","uri":"/%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E5%AD%97%E6%AF%8D/"},{"categories":null,"content":" å¥½ä¹…æ²¡æŠ˜è…¾åšå®¢äº†ï¼Œæ€»è§‰å¾—mkdocsçš„å¯å®šä¹‰åŠŸèƒ½å¤ªå°‘äº†ï¼Œè€Œä¸”ä¸å¤ªç¾è§‚ï¼Œäºæ˜¯å°†åšå®¢ä»mkdocsè¿ç§»åˆ°Hugoäº†ï¼ŒåŸæœ¬æ˜¯æƒ³ç”¨hexoçš„ï¼Œä½†æ˜¯å›¾ç‰‡çš„å¼•ç”¨æ”¹è¿‡æ¥çš„è¯å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥é€‰æ‹©äº†hugoã€‚èŠ±è´¹äº†ä¸€ç‚¹æ—¶é—´è¿ç§»ï¼Œä¸»è¦æ˜¯å·¥ç¨‹é‡æœ‰ç‚¹å¤§ï¼Œä¹‹å‰å†™çš„åšæ–‡å†…å®¹ä¸ç¬¦åˆhugoçš„è§„èŒƒï¼Œæ‰€ä»¥å†™äº†ä¸€äº›è„šæœ¬ç”¨äºè¿ç§»ï¼Œæ€»ä½“è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©ï¼Œæœ¬æ¥æ˜¯æƒ³ä¸»è¦æ˜¯æƒ³åˆ›é€ ä¸€ä¸ªèˆ’æœçš„å†™ä½œç¯å¢ƒã€‚ç›®å‰æ˜¯obsidian+hugoï¼Œç„¶åéƒ¨ç½²åœ¨github pagesä¸Šé¢ã€‚ ","date":"0001-01-01","objectID":"/about/:0:0","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":"å…³äºæœ¬ç«™ ä»å¤§ä¸€å¼€å§‹å°±æŠ˜è…¾åšå®¢äº†ï¼Œä»ä¸€å¼€å§‹åªä¼špythonè¯­è¨€ï¼Œåˆ°ç°åœ¨ä¼šäº†ä¸€ç‚¹ç‚¹æœºå™¨å­¦ä¹ ï¼ŒæŠŠåšå®¢å½“åšè‡ªå·±çš„æˆé•¿è¿‡ç¨‹å§ï¼Œå…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯ç›´æ¥ç…§æ¬ç½‘ä¸Šçš„ä¸œè¥¿ï¼Œä¸è¿‡è‡ªå·±å¤ç°äº†ä¸€äº›ä»£ç ï¼Œæˆ‘è®¤ä¸ºç†è®ºä¸å®è·µè¦ç»Ÿä¸€ï¼Œä¸èƒ½åªæœ‰ç†è®ºçŸ¥è¯†ï¼Œä½†æ²¡æœ‰ç†è®ºå»å®è·µï¼Œå°±ç®—ç…§ç€å†™å‡ºæ¥ä¹Ÿä¸€å¤´é›¾æ°´ï¼Œåšè°ƒå‚ä¾ ï¼Œä½†è¦çŸ¥é“æ¯ä¸ªå‚æ•°çš„æ„ä¹‰ã€‚ ä¸çŸ¥é“å†™å•¥äº†ï¼Œå…ˆç©ºç€ã€‚ ","date":"0001-01-01","objectID":"/about/:1:0","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":" Table file.mtime as \"æœ€åä¿®æ”¹æ—¶é—´\" WHERE tags[0] = \"Reading\" and date(today) - file.mtime \u003c= dur(7 days) Sort file.mtime desc ","date":"0001-01-01","objectID":"/reading_for_oneweek/:0:0","tags":null,"title":"","uri":"/reading_for_oneweek/"},{"categories":null,"content":" Table rows.file.link as filename WHERE todo and title != \"\u003c% tp.file.title %\u003e\" Sort file.ctime desc GROUP BY tags[1] as \"category\" ","date":"0001-01-01","objectID":"/to_writing/:0:0","tags":null,"title":"","uri":"/to_writing/"},{"categories":null,"content":" Table file.mtime as \"æœ€åä¿®æ”¹æ—¶é—´\" WHERE !todo and date(today) - file.mtime \u003c= dur(7 days) and tags[0] != \"Reading\" and title Sort file.mtime desc ","date":"0001-01-01","objectID":"/writing_for_oneweek/:0:0","tags":null,"title":"","uri":"/writing_for_oneweek/"}]